<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [X2Go-Commits] nx-libs.git - build-main (branch) updated:	nxproxy/3.0.0-4
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/x2go-commits/2013-August/index.html" >
   <LINK REL="made" HREF="mailto:x2go-commits%40lists.berlios.de?Subject=Re%3A%20%5BX2Go-Commits%5D%20nx-libs.git%20-%20build-main%20%28branch%29%20updated%3A%0A%09nxproxy/3.0.0-4&In-Reply-To=%3C20130830142220.508065DB4F%40ymir%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011368.html">
   <LINK REL="Next"  HREF="011376.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[X2Go-Commits] nx-libs.git - build-main (branch) updated:	nxproxy/3.0.0-4</H1>
    <B>X2Go dev team</B> 
    <A HREF="mailto:x2go-commits%40lists.berlios.de?Subject=Re%3A%20%5BX2Go-Commits%5D%20nx-libs.git%20-%20build-main%20%28branch%29%20updated%3A%0A%09nxproxy/3.0.0-4&In-Reply-To=%3C20130830142220.508065DB4F%40ymir%3E"
       TITLE="[X2Go-Commits] nx-libs.git - build-main (branch) updated:	nxproxy/3.0.0-4">git-admin at x2go.org
       </A><BR>
    <I>Fri Aug 30 16:22:20 CEST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="011368.html">[X2Go-Commits] nx-libs.git - build-main (branch) updated:	nxproxy/3.3.0-2
</A></li>
        <LI>Next message: <A HREF="011376.html">[X2Go-Commits] nx-libs.git - build-main (branch) updated:	nxproxy/3.4.0-2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11369">[ date ]</a>
              <a href="thread.html#11369">[ thread ]</a>
              <a href="subject.html#11369">[ subject ]</a>
              <a href="author.html#11369">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch, build-main has been updated
  discards  bf85c6e696693ef5a277c0334c01493dedf4fadd (commit)
  discards  c70adf725d3fea94eabdde467b8b8b106a796c0a (commit)
  discards  2208f4f9ecf967579a364021f0847b3ad1d7777c (commit)
  discards  3d8e85c4749ee9e55601f6e540311008bf8f77af (commit)
  discards  3b4404668c6794f9d0665905f4e22c1a0fafac21 (commit)
  discards  9f7021392b921ad44163024ed8ca538195d3ac9c (commit)
  discards  c7dc0c3cdec2e0f2fa2d52f8d446d0e83623a8a0 (commit)
  discards  8fa612d1a931096ff57c9b90df0f13e6cd638da8 (commit)
       via  35472e34809a80b228f2763ef33d58acdb88dcce (commit)

This update added new revisions after undoing existing revisions.  That is
to say, the old revision is not a strict subset of the new revision.  This
situation occurs when you --force push a change and generate a repository
containing something like this:

 * -- * -- B -- O -- O -- O (bf85c6e696693ef5a277c0334c01493dedf4fadd)
            \
             N -- N -- N (35472e34809a80b228f2763ef33d58acdb88dcce)

When this happens we assume that you've already had alert emails for all
of the O revisions, and so we here report only the revisions in the N
branch from the common base, B.

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
-----------------------------------------------------------------------

Summary of changes:
 nxcompshad/CHANGELOG                               |  404 -----
 nxcompshad/Core.cpp                                |  614 --------
 nxcompshad/Core.h                                  |  204 ---
 nxcompshad/Input.cpp                               |  167 ---
 nxcompshad/Input.h                                 |   91 --
 nxcompshad/LICENSE                                 |   22 -
 nxcompshad/Logger.cpp                              |  116 --
 nxcompshad/Logger.h                                |  159 --
 nxcompshad/Makefile.in                             |  192 ---
 nxcompshad/Manager.cpp                             |  252 ----
 nxcompshad/Manager.h                               |  115 --
 nxcompshad/Poller.h                                |   31 -
 nxcompshad/Regions.h                               |   35 -
 nxcompshad/Shadow.cpp                              |  470 ------
 nxcompshad/Shadow.h                                |  101 --
 nxcompshad/Updater.cpp                             |  383 -----
 nxcompshad/Updater.h                               |   95 --
 nxcompshad/VERSION                                 |    1 -
 nxcompshad/Win.cpp                                 | 1137 --------------
 nxcompshad/Win.h                                   |  224 ---
 nxcompshad/X11.cpp                                 | 1586 --------------------
 nxcompshad/X11.h                                   |  131 --
 nxproxy/CHANGELOG                                  |  180 +++
 {nxcompshad =&gt; nxproxy}/COPYING                    |    0
 nxproxy/LICENSE                                    |   36 +
 nxcompshad/Misc.h =&gt; nxproxy/Main.c                |   67 +-
 nxproxy/Makefile.in                                |  101 ++
 nxproxy/README                                     |   14 +
 nxproxy/README-IPAQ                                |   27 +
 nxproxy/README-VALGRIND                            |   39 +
 nxproxy/VERSION                                    |    1 +
 .../configure =&gt; nxproxy/autom4te.cache/output.0   |  368 ++---
 nxproxy/autom4te.cache/requests                    |  115 ++
 nxproxy/autom4te.cache/traces.0                    |  134 ++
 {nxcompshad =&gt; nxproxy}/configure                  |  244 +--
 {nxcompshad =&gt; nxproxy}/configure.in               |  156 +-
 {nxcompshad =&gt; nxproxy}/install-sh                 |    0
 nxproxy/mkinstalldirs                              |   34 +
 38 files changed, 917 insertions(+), 7129 deletions(-)
 delete mode 100644 nxcompshad/CHANGELOG
 delete mode 100644 nxcompshad/Core.cpp
 delete mode 100644 nxcompshad/Core.h
 delete mode 100644 nxcompshad/Input.cpp
 delete mode 100644 nxcompshad/Input.h
 delete mode 100644 nxcompshad/LICENSE
 delete mode 100644 nxcompshad/Logger.cpp
 delete mode 100644 nxcompshad/Logger.h
 delete mode 100644 nxcompshad/Makefile.in
 delete mode 100644 nxcompshad/Manager.cpp
 delete mode 100644 nxcompshad/Manager.h
 delete mode 100644 nxcompshad/Poller.h
 delete mode 100644 nxcompshad/Regions.h
 delete mode 100644 nxcompshad/Shadow.cpp
 delete mode 100644 nxcompshad/Shadow.h
 delete mode 100644 nxcompshad/Updater.cpp
 delete mode 100644 nxcompshad/Updater.h
 delete mode 100644 nxcompshad/VERSION
 delete mode 100644 nxcompshad/Win.cpp
 delete mode 100644 nxcompshad/Win.h
 delete mode 100644 nxcompshad/X11.cpp
 delete mode 100644 nxcompshad/X11.h
 create mode 100644 nxproxy/CHANGELOG
 rename {nxcompshad =&gt; nxproxy}/COPYING (100%)
 create mode 100644 nxproxy/LICENSE
 rename nxcompshad/Misc.h =&gt; nxproxy/Main.c (52%)
 create mode 100644 nxproxy/Makefile.in
 create mode 100644 nxproxy/README
 create mode 100644 nxproxy/README-IPAQ
 create mode 100644 nxproxy/README-VALGRIND
 create mode 100644 nxproxy/VERSION
 copy nxcompshad/configure =&gt; nxproxy/autom4te.cache/output.0 (96%)
 mode change 100755 =&gt; 100644
 create mode 100644 nxproxy/autom4te.cache/requests
 create mode 100644 nxproxy/autom4te.cache/traces.0
 rename {nxcompshad =&gt; nxproxy}/configure (97%)
 rename {nxcompshad =&gt; nxproxy}/configure.in (57%)
 rename {nxcompshad =&gt; nxproxy}/install-sh (100%)
 create mode 100755 nxproxy/mkinstalldirs

The diff of changes is:
diff --git a/nxcompshad/CHANGELOG b/nxcompshad/CHANGELOG
deleted file mode 100644
index 3472a4a..0000000
--- a/nxcompshad/CHANGELOG
+++ /dev/null
@@ -1,404 +0,0 @@
-ChangeLog:
-
-nxcompshad-3.5.0-2
-
-- Fixed TR03G02189. Now key combinations involving the Shift keys
-  are recognized correctly.
-
-nxcompshad-3.5.0-1
-
-- Opened the 3.5.0 branch based on nxcompshad-3.4.0-3.
-
-- Updated copyright to year 2011.
-
-nxcompshad-3.4.0-3
-
-- Updated copyright to year 2010.
-
-nxcompshad-3.4.0-2
-
-- Fixed TR08G02256. Now the Shadow session is shown correctly with
-  MIT-SHM extension disabled.
-
-- Improved updateShadowFrameBuffer() and ~Poller() functions.
-
-- Avoided memory leak.
-
-nxcompshad-3.4.0-1
-
-- Opened the 3.4.0 branch based on nxcompshad-3.3.0-3.
-
-- Updated version number.
-
-- Updated copyright to year 2009.
-
-- Improved error messages logging in case of initialization failures.
-
-nxcompshad-3.3.0-3
-
-- Fixed TR01G02158. Keymap initialization could be incorrect because
-  of a type mismatch on 64 bit platforms.
-
-nxcompshad-3.3.0-2
-
-- Updated VERSION.
-
-nxcompshad-3.3.0-1
-
-- Opened the 3.3.0 branch based on nxcompshad-3.2.0-3.
-
-nxcompshad-3.2.0-3
-
-- Improved keycode translation.
-
-nxcompshad-3.2.0-2
-
-- Solved a problem when sending fake modifier events.
-
-- Added support for keyboard events handling for the web player.
-
-- Changed keycodes translation for Solaris keyboard.
-
-- Corrected a problem for keycodes translation from Solaris keyboard.
-
-- Fixed TR02F02001. In shadow session the shadower's keyboard layout
-  could be wrong. Now keycodes are correctly translated if master and
-  shadow keyboards have different layouts.
-
-- Added NXShadowGetScreenSize() and NXShadowSetScreenSize() functions,
-  so that the shadow session can handle correctly the resize of the
-  master session window.
-
-- Solved a compilation problem on GCC 4.3.
-
-nxcompshad-3.2.0-1
-
-- Opened the 3.2.0 branch based on nxcompshad-3.1.0-2.
-
-nxcompshad-3.1.0-2
-
-- Updated file VERSION to match the current release version.
-
-nxcompshad-3.1.0-1
-
-- Opened the 3.1.0 branch based on nxcompshad-3.0.0-19.
-
-nxcompshad-3.0.0-19
-
-- Skip initialization of damage extension if it was already disabled.
-
-nxcompshad-3.0.0-18
-
-- The poller destructor checks if the damage extension is in use.
-
-- Small changes to the function getting the screen content in the case
-  damage is not in use.
-
-nxcompshad-3.0.0-17
-
-- Cleanup of some log messages.
-
-nxcompshad-3.0.0-16
-
-- Disabled some log message in the functions initializing the poller.
-
-nxcompshad-3.0.0-15
-
-- Before calling XTest functions, it is checked if the connection to
-  master X server has been initialized.
-
-nxcompshad-3.0.0-14
-
-- After the shm segment is created, its mode is changed and it is
-  marked for destroying. A check on the number of attaches is done.
-
-nxcompshad-3.0.0-13
-
-- Creating the shm segment even if the uid of master X server can't be
-  retrieved.
-
-- Fixed reallocation of update region.
-
-- Checking if the master X server provides XTest extension.
-
-nxcompshad-3.0.0-12
-
-- Fixed a compiler warning on AMD64 platform.
-
-- Changed configure script to add -fPIC option.
-
-- Fixed a mismatch in UpdateManager destructor.
-
-nxcompshad-3.0.0-11
-
-- Fixed the function setting the uid of shm segment.
-
-- Sync with the master X server before marking the shm segment to be
-  destroyed.
-
-nxcompshad-3.0.0-10
-
-- Setting the shm segments as readable only by the master X server
-  process.
-
-- Mark shm segments to be destroyed when the last process detach.
-
-- Enabled keycode translation in order to allow keyboards of different
-  models to work.
-
-nxcompshad-3.0.0-9
-
-- Changed the LICENSE file to state that the software is only made
-  available under the version 2 of the GPL.
-
-- Added file COPYING.
-
-- Changes to translate keycodes between different keyboard types. The
-  keycodes are translated through the keysym.
-
-- Changes to convert a Mode_switch key to ISO_Level3_Shift if it is
-  needed.
-
-nxcompshad-3.0.0-8
-
-- Added interface function NXShadowDisableShm disabling the use of
-  MIT-SHM extension.
-
-- Added interface function NXShadowDisableDamage disabling the use of
-  DAMAGE extension.
-
-- Added interface function NXShadowSetDisplayUid setting the uid of
-  shadowed X server
-
-- Changed the owner of shared memory segments to the uid of the sha-
-  dowed X server.
-
-- Fixed logWarning method.
-
-- Moved the code initializing the use of shared memory to shmInit
-  method of X11 Poller.
-
-nxcompshad-3.0.0-7
-
-- Removed the class qualifier in the declaration of destroyUpdate-
-  ManagerRegion().
-
-nxcompshad-3.0.0-6
-
-- Fixed build errors on 64 bit platforms.
-
-- Called XTestGrabControl to override possible grabs of the X server.
-
-nxcompshad-3.0.0-5
-
-- Added some stub members to the Poller class. These are intended to
-  handle keyboard state.
-
-- Changes in the default polling algorithm to disable the line pri-
-  ority persistence.
-
-nxcompshad-3.0.0-4
-
-- If a low layer handling of screen changes is available (DAMAGE in
-  case of X11), polling routine uses it and returns immediately.
-
-- Creating a Damage notify object if the extension is supported.
-
-- DamageNotify events are saved in the update region. After all avail-
-  able events have been handled, the content of screen is retrieved
-  by ShnGetImage requests.
-
-- XDamageSubtract and XSync are done before any event handling.
-
-- Damages are requested as raw rectangles.
-
-- Added Xdamage and Xrandr to required libraries.
-
-- Fixed a problem with some lines not refreshed in shadowing mode.
-
-nxcompshad-3.0.0-3
-
-- Added destroyUpdateManagerRegion() method to UpdateManager class.
-
-- Turned off some log messages.
-
-- Changed configure.in to remove warnings related to deprecated header
-  files and options.
-
-- Changed Makefile.in to remove autom4te.cache dir if the target is
-  'distclean'.
-
-- Removed multi-word file names.
-
-nxcompshad-3.0.0-2
-
-- Changes to get the screen of original display by a ShmGetImage.
-
-- Exit the polling loop if more than 50 ms have elapsed.
-
-nxcompshad-3.0.0-1
-
-- Created nxcompshad based on nxshadow-3.0.0-7.
-
-nxshadow-3.0.0-7
-
-- Deleted files KeyCursorTmp.cpp, scancodes.h, constant.h.
-
-- Renamed NXshadow.h to Shadow.h.
-
-- Merged NXshadowEvent.h with Shadow.h.
-
-- Fixed configure.in, changed Makefile.in to build Xcompshad library,
-  rebuilt configure script.
-
-nxshadow-3.0.0-6
-
-- Implemented a callback mechanism to ask the caller program if screen
-  polling have to be suspended.
-
-nxshadow-3.0.0-5
-
-- Changes to comply with the library name.
-
-- Fixed a bug in CorePoller that could prevent the update of the last
-  line of a rectangle.
-
-nxshadow-3.0.0-4
-
-- Removed some parameters of the NXShadowAddUpdaterDisplay() function.
-
-nxshadow-3.0.0-3
-
-- Updated copyright notices to the current year.
-
-- Code cleanup in KeysCursorTmp.c file.
-
-nxshadow-3.0.0-2
-
-- If master agent uses shared memory extension, the GetImage is rea-
-  lized by XShmGetImage() function.
-
-- Added new parameters to NXShadowAddUpdaterDisplay() function, the
-  depth and bit mask color of the master display.
-
-nxshadow-3.0.0-1
-
-- Opened the nxshadow-3.0.0 branch based on the nxaccess-3.0.0-13.
-
-- Renamed NXaccess.h NXaccessEvent.h and RegionM.h files as NXshadow.h
-  NXshadowEvent.h and Regions.h.
-
-- Modified the Makefile.in file and configure scripts in order to
-  compile the component.
-
-nxaccess-3.0.0-13
-
-- Fixed X11Poller.cpp pre-processing.
-
-nxaccess-3.0.0-12
-
-- Fixed build problems on Solaris.
-
-nxaccess-3.0.0-11
-
-- Added NXShadowUpdateBuffer() function. This function creates the
-  buffer for the polling.
-
-- If the scaline fails, the polling will suspend for 50 ms.
-
-- Added some functions in order to access data member class.
-
-nxaccess-3.0.0-10
-
-- Used XTEST extension to make the shared display create input events.
-
-nxaccess-3.0.0-9
-
-- Added the mouse events.
-
-- Now, it's possible to connect to X server display or agent display,
-  the display's content is captured by GetImage and sent to another
-  display by PutImage.
-
-nxaccess-3.0.0-8
-
-- Added KeysCursorTmp.cpp file.
-
-- Solved a problem with the keys, when the window lost focus the Key-
-  Release events weren't propagated.
-
-nxaccess-3.0.0-7
-
-- Added functions in order to remove issues with some keys combina-
-  tion.
-
-nxaccess-3.0.0-6
-
-- Added functions to simulate keys Ctrl + Alt + Del in order to run
-  the Task Manager application.
-
-- Now nxaccess is able to manage all switches between desktops.
-
-nxaccess-3.0.0-5
-
-- Solved a problem with the cursor shape. After a while, the cursor
-  shape are no more updated.
-
-- Now the cursor is updated only when it changes its shape.
-
-- Removed a dirty lines after screen updates.
-
-- Removed the unused file Keyboard.cpp.
-
-- Added the colorCorrect() macro in NXaccess.h.
-
-- Removed the colorCorrect() function in Updater.cpp.
-
-nxaccess-3.0.0-4
-
-- Renamed some source files and functions conforming them to the name
-  of component.
-
-nxaccess-3.0.0-3
-
-- Removed the parameter of type Display in all methods of the class
-  Poller.
-
-- Print, Break and Pause keys are enabled.
-
-nxaccess-3.0.0-2
-
-- Modified the Makefile.in in order to avoid compiling the executive
-  file.
-
-- Removed the unused file Main.cpp.
-
-- The Windows keys are enabled.
-
-- Synchronized local and remote states of Num_Lock, Caps_Lock and
-  Scroll_Lock.
-
-- Updated the NoMachine copyright notices.
-
-nxaccess-3.0.0-1
-
-- Opened the 3.0.0 branch based on the nxmirror-2.0.0-3.
-
-nxmirror-2.0.0-3
-
-- Added the keyboard events for all layouts.
-
-- The mouse wheel button is enabled.
-
-nxmirror-2.0.0-2
-
-- Completed implementation of the keyboard events only for italian
-  layout.
-
-- Added the mouse events and shape cursor.
-
-nxmirror-2.0.0-1
-
-- Opened the 2.0.0 branch based on the 1.5.0-60.
-
-- Added CHANGELOG.
diff --git a/nxcompshad/Core.cpp b/nxcompshad/Core.cpp
deleted file mode 100644
index 6f94493..0000000
--- a/nxcompshad/Core.cpp
+++ /dev/null
@@ -1,614 +0,0 @@
-/**************************************************************************/
-/*                                                                        */
-/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
-/*                                                                        */
-/* NXCOMPSHAD, NX protocol compression and NX extensions to this software */
-/* are copyright of NoMachine. Redistribution and use of the present      */
-/* software is allowed according to terms specified in the file LICENSE   */
-/* which comes in the source distribution.                                */
-/*                                                                        */
-/* Check <A HREF="http://www.nomachine.com/licensing.html">http://www.nomachine.com/licensing.html</A> for applicability.       */
-/*                                                                        */
-/* NX and NoMachine are trademarks of Medialogic S.p.A.                   */
-/*                                                                        */
-/* All rights reserved.                                                   */
-/*                                                                        */
-/**************************************************************************/
-
-#include &lt;string.h&gt;
-#include &lt;sys/time.h&gt;
-
-#define PANIC
-#define WARNING
-#undef  TEST
-#undef  DEBUG
-
-#include &quot;Core.h&quot;
-#include &quot;Logger.h&quot;
-
-const int CorePoller::maxSliceHeight_ = 20;
-const int CorePoller::minSliceHeight_ = 3;
-
-const char CorePoller::interlace_[] =
-{
-  0, 16,
-  8, 24,
-  4, 20, 12, 28,
-  2, 18, 10, 26, 6, 22, 14, 30,
-  1, 17,
-  9, 25,
-  5, 21, 13, 29,
-  3, 19, 11, 27, 7, 23, 15, 31
-};
-
-CorePoller::CorePoller(Input *input, Display *display) : input_(input)
-{
-  logTrace(&quot;CorePoller::CorePoller&quot;);
-
-  buffer_ = NULL;
-  lastUpdatedRegion_ = NULL;
-  lineStatus_ = NULL;
-  linePriority_ = NULL;
-  lefts_ = NULL;
-  rights_ = NULL;
-}
-
-CorePoller::~CorePoller()
-{
-  logTrace(&quot;CorePoller::~CorePoller&quot;);
-
-  if (buffer_ != NULL)
-  {
-    delete [] buffer_;
-
-    buffer_ = NULL;
-  }
-
-  if (lastUpdatedRegion_ != NULL)
-  {
-    XDestroyRegion(lastUpdatedRegion_);
-
-    lastUpdatedRegion_ = NULL;
-  }
-
-  if (lineStatus_ != NULL)
-  {
-    delete [] lineStatus_;
-
-    lineStatus_ = NULL;
-  }
-
-  if (linePriority_ != NULL)
-  {
-    delete [] linePriority_;
-
-    linePriority_ = NULL;
-  }
-
-  if (lefts_ != NULL)
-  {
-    delete [] lefts_;
-
-    lefts_ = NULL;
-  }
-
-  if (rights_ != NULL)
-  {
-    delete [] rights_;
-
-    rights_ = NULL;
-  }
-}
-
-int CorePoller::init()
-{
-  logTrace(&quot;CorePoller::init&quot;);
-
-  createFrameBuffer();
-
-  if (buffer_ == NULL)
-  {
-    logError(&quot;CorePoller::init&quot;, ESET(ENOMEM));
-
-    return -1;
-  }
-
-  logTest(&quot;CorePoller::init&quot;, &quot;Allocated frame buffer at [%p] for [%d] bytes.&quot;,
-            buffer_, bpl_ * height_);
-
-  if (lastUpdatedRegion_ != NULL)
-  {
-    XDestroyRegion(lastUpdatedRegion_);
-
-    lastUpdatedRegion_ = NULL;
-  }
-
-  lastUpdatedRegion_ = XCreateRegion();
-
-  if (lineStatus_ != NULL)
-  {
-    delete[] lineStatus_;
-  }
-
-  lineStatus_ = new LineStatus[height_ + 1];
-
-  if (lineStatus_ == NULL)
-  {
-    logError(&quot;CorePoller::init&quot;, ESET(ENOMEM));
-
-    return -1;
-  }
-
-  //
-  // We need this boundary element to
-  // speed up the algo.
-  //
-
-  if (linePriority_ != NULL)
-  {
-    delete[] linePriority_;
-  }
-
-  linePriority_ = new int [height_ + 1];
-
-  if (linePriority_ == NULL)
-  {
-    logError(&quot;CorePoller::init&quot;, ESET(ENOMEM));
-
-    return -1;
-  }
-
-  for (unsigned int i = 0; i &lt; height_; i++)
-  {
-    linePriority_[i] = HIGHEST_PRIORITY;
-  }
-
-  if (lefts_ != NULL)
-  {
-    delete[] lefts_;
-  }
-
-  lefts_ = new int [height_];
-
-  if (rights_ != NULL)
-  {
-    delete[] rights_;
-  }
-
-  rights_ = new int [height_];
-
-  for (unsigned int i = 0; i &lt; height_; i++)
-  {
-    rights_[i] = lefts_[i] = 0;
-  }
-
-  return 1;
-}
-
-int CorePoller::isChanged(int (*checkIfInputCallback)(void *), void *arg, int *suspended)
-{
-  logTrace(&quot;CorePoller::isChanged&quot;);
-
-#if defined(__CYGWIN32__) || defined(WIN32)
-
-  checkDesktop();
-
-#endif
-
-#if !defined(__CYGWIN32__) &amp;&amp; !defined(WIN32)
-
-  if (mirror_ == 1)
-  {
-    int result = mirrorChanges_;
-
-    mirrorChanges_ = 0;
-
-    return result;
-  }
-
-#endif
-
-  logDebug(&quot;CorePoller:isChanged&quot;, &quot;Going to use default polling algorithm.\n&quot;);
-
-  //
-  // In order to allow this function to
-  // be suspended and resumed later, we
-  // need to save these two status vars.
-  // 
-
-  static int idxIlace = 0;
-  static int curLine = 0;
-
-
-  const long timeout = 50;
-  long oldTime;
-  long newTime;
-  struct timeval ts;
-
-  gettimeofday(&amp;ts, NULL);
-
-  oldTime = ts.tv_sec * 1000 + ts.tv_usec / 1000;
-
-  if (curLine == 0) // &amp;&amp; idxIlace == 0 ?
-  {
-    for (unsigned int i = 0; i &lt; height_; i++)
-    {
-      lineStatus_[i] = LINE_NOT_CHECKED;
-    }
-  }
-
-  int foundChanges = 0;
-
-  foundChanges = 0;
-
-  int curIlace = interlace_[idxIlace];
-
-  bool moveBackward = false;
-
-  logDebug(&quot;CorePoller::isChanged&quot;, &quot;Interlace index [%d] interlace [%d].&quot;, idxIlace, curIlace);
-
-  for (; curLine &lt; (int) height_; curLine++)
-  {
-    logDebug(&quot;CorePoller::isChanged&quot;, &quot;Analizing line [%d] move backward [%d] status [%d] priority [%d].&quot;,
-                curLine, moveBackward, lineStatus_[curIlace], linePriority_[curLine]);
-
-    //
-    // Ask the caller if the polling have to be suspended.
-    //
-
-    if ((*checkIfInputCallback)(arg) == 1)
-    {
-      *suspended = 1;
-
-      break;
-    }
-
-    //
-    // Suspend if too much time is elapsed.
-    //
-
-    gettimeofday(&amp;ts, NULL);
-
-    newTime = ts.tv_sec * 1000 + ts.tv_usec / 1000;
-
-    if (newTime - oldTime &gt;= timeout)
-    {
-      *suspended = 1;
-
-      break;
-    }
-
-    oldTime = newTime;
-
-    if (lineStatus_[curLine] != LINE_NOT_CHECKED)
-    {
-      continue;
-    }
-
-    if (moveBackward)
-    {
-      moveBackward = false;
-    }
-    else
-    {
-      switch (linePriority_[curLine])
-      {
-        case 1:
-        case 29:
-        {
-          //
-          // It was a priority,
-          // but now it may not be.
-          //
-        }
-        case 31:
-        {
-          //
-          // Not a priority, still isn't.
-          //
-
-          linePriority_[curLine] = NOT_PRIORITY;
-
-          break;
-        }
-        case 0:
-        {
-          //
-          // Make it a priority.
-          //
-
-          linePriority_[curLine] = PRIORITY;
-
-          break;
-        }
-        default:
-        {
-          linePriority_[curLine]--;
-
-          break;
-        }
-      }
-
-      if ((linePriority_[curLine] &gt; PRIORITY) &amp;&amp; ((curLine &amp; 31) != curIlace))
-      {
-        continue;
-      }
-    }
-
-    XRectangle rect = {0, curLine, width_, 1};
-
-    char *buffer;
-
-    logDebug(&quot;CorePoller::isChanged&quot;, &quot;Checking line [%d].&quot;, curLine);
-
-    if ((buffer = getRect(rect)) == NULL)
-    {
-      logDebug(&quot;CorePoller::isChanged&quot;, &quot;Failed to retrieve line [%d].&quot;, curLine);
-
-      return -1;
-    }
-
-    if (memcmp(buffer, buffer_ + curLine * bpl_, bpl_) == 0 || differ(buffer, rect) == 0)
-    {
-      logDebug(&quot;CorePoller::isChanged&quot;, &quot;Data buffer didn't change.&quot;);
-
-      lineStatus_[curLine] = LINE_NOT_CHANGED;
-
-      continue;
-    }
-
-    rect.x = lefts_[rect.y];
-    rect.width = rights_[rect.y] - lefts_[rect.y] + 1;
-
-    update(buffer + rect.x * bpp_, rect);
-
-    foundChanges = 1;
-
-    lineStatus_[curLine] = LINE_HAS_CHANGED;
-
-    //
-    // Wake up the next line.
-    //
-
-    if (linePriority_[curLine + 1] &gt; PRIORITY)
-    {
-      linePriority_[curLine + 1] = HIGHEST_PRIORITY;
-    }
-
-    //
-    // Give this line priority.
-    //
-
-    linePriority_[curLine] = HIGHEST_PRIORITY;
-
-    //
-    // Wake up previous line.
-    //
-
-    if (curLine &gt; 0 &amp;&amp; lineStatus_[curLine - 1] == LINE_NOT_CHECKED)
-    {
-      moveBackward = true;
-      curLine -= 2;
-    }
-  }
-
-  //
-  // Execution reached the end of loop.
-  //
-
-  if (curLine == (int) height_)
-  {
-    idxIlace = (idxIlace + 1) % 32;
-
-    curLine = 0;
-  }
-
-  //
-  // Create the region of changed pixels.
-  //
-
-  if (foundChanges)
-  {
-    int start, last, curLine, left, right;
-
-    for (curLine = 0; curLine &lt; (int) height_; curLine++)
-    {
-      if (lineStatus_[curLine] == LINE_HAS_CHANGED)
-      {
-        break;
-      }
-    }
-
-    start = curLine;
-    last = curLine;
-
-    left = lefts_[curLine];
-    right = rights_[curLine];
-    curLine++;
-
-    while (1)
-    {
-      for (; curLine &lt; (int) height_; curLine++)
-      {
-        if (lineStatus_[curLine] == LINE_HAS_CHANGED)
-        {
-          break;
-        }
-      }
-
-      if (curLine == (int) height_)
-      {
-        break;
-      }
-
-      if ((curLine - last &gt; minSliceHeight_) || (last - start &gt; maxSliceHeight_))
-      {
-        XRectangle rect = {left, start, right - left + 1, last - start + 1};
-
-        XUnionRectWithRegion(&amp;rect, lastUpdatedRegion_, lastUpdatedRegion_);
-
-        start = curLine;
-        left = lefts_[curLine];
-        right = rights_[curLine];
-      }
-      else
-      {
-        if (lefts_[curLine] &lt; left)
-        {
-          left = lefts_[curLine];
-        }
-
-        if (rights_[curLine] &gt; right)
-        {
-          right = rights_[curLine];
-        }
-      }
-
-      last = curLine;
-
-      curLine++;
-    }
-
-    //
-    // Send last block.
-    //
-
-    if (last &gt;= start)
-    {
-      XRectangle rect = {left, start, right - left + 1, last - start + 1};
-
-      XUnionRectWithRegion(&amp;rect, lastUpdatedRegion_, lastUpdatedRegion_);
-    }
-  }
-
-  return foundChanges;
-}
-
-int CorePoller::differ(char *buffer, XRectangle r)
-{
-  logTrace(&quot;CorePoller::differ&quot;);
-
-  int bpl = bpp_ * r.width;
-  int i;
-  char *pBuf;
-  char *pFb;
-
-  pBuf = (buffer);
-  pFb = (buffer_ + r.x + r.y * bpl_);
-
-  for (i = 0; i &lt; bpl; i++)
-  {
-    if (*pFb++ != *pBuf++)
-    {
-      lefts_[r.y] = i / bpp_;
-
-      break;
-    }
-  }
-
-  if (i == bpl)
-  {
-    return 0;
-  }
-
-  pBuf = (buffer) + bpl - 1;
-  pFb = (buffer_ + r.x + r.y * bpl_) + bpl - 1;
-
-  int j = i - 1;
-
-  for (i = bpl - 1; i &gt; j; i--)
-  {
-    if (*pFb-- != *pBuf--)
-    {
-      rights_[r.y] = i / bpp_;
-
-      break;
-    }
-  }
-
-  return 1;
-}
-
-void CorePoller::update(char *src, XRectangle r)
-{
-  logTrace(&quot;CorePoller::update&quot;);
-
-  char *dst = buffer_ + r.x * bpp_ + r.y * bpl_;
-  int bpl = bpp_ * r.width;
-
-  for (unsigned int i = 0; i &lt; r.height; i++)
-  {
-    if(((r.x * bpp_ + r.y * bpl_) + bpl) &gt; (bpl_ * height_))
-    {
-      //
-      // Out of bounds. Maybe a resize is going on.
-      //
-
-      continue;
-    }
-
-    memcpy(dst, src, bpl);
-
-    src += bpl;
-
-    dst += bpl_;
-  }
-}
-
-void CorePoller::handleEvent(Display *display, XEvent *event)
-{
-  logTrace(&quot;CorePoller::handleEvent&quot;);
-
-  switch (event -&gt; type)
-  {
-    case KeyPress:
-    case KeyRelease:
-    {
-      handleKeyboardEvent(display, event);
-      break;
-    }
-    case ButtonPress:
-    case ButtonRelease:
-    case MotionNotify:
-    {
-      handleMouseEvent(display, event);
-      break;
-    }
-    default:
-    {
-      logTest(&quot;CorePoller::handleEvent&quot;, &quot;Handling unexpected event [%d] from display [%p].&quot;,
-                  event -&gt; type, display);
-      break;
-    }
-  }
-}
-
-void CorePoller::handleWebKeyEvent(KeySym keysym, Bool isKeyPress)
-{
-  logTrace(&quot;CorePoller::handleWebKeyEvent&quot;);
-
-  handleWebKeyboardEvent(keysym, isKeyPress);
-}
-
-void CorePoller::handleInput()
-{
-  while (input_ -&gt; checkIfEvent())
-  {
-    Display *display = input_ -&gt; currentDisplay();
-    XEvent *event = input_ -&gt; popEvent();
-
-    handleEvent(display, event);
-
-    delete event;
-  }
-}
-
-void CorePoller::createFrameBuffer()
-{
-  logTrace(&quot;CorePoller::createFrameBuffer&quot;);
-
-  if (buffer_ == NULL)
-  {
-    buffer_ = new char[bpl_ * height_];
-  }
-}
diff --git a/nxcompshad/Core.h b/nxcompshad/Core.h
deleted file mode 100644
index 9bc8a64..0000000
--- a/nxcompshad/Core.h
+++ /dev/null
@@ -1,204 +0,0 @@
-/**************************************************************************/
-/*                                                                        */
-/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
-/*                                                                        */
-/* NXCOMPSHAD, NX protocol compression and NX extensions to this software */
-/* are copyright of NoMachine. Redistribution and use of the present      */
-/* software is allowed according to terms specified in the file LICENSE   */
-/* which comes in the source distribution.                                */
-/*                                                                        */
-/* Check <A HREF="http://www.nomachine.com/licensing.html">http://www.nomachine.com/licensing.html</A> for applicability.       */
-/*                                                                        */
-/* NX and NoMachine are trademarks of Medialogic S.p.A.                   */
-/*                                                                        */
-/* All rights reserved.                                                   */
-/*                                                                        */
-/**************************************************************************/
-
-#ifndef CorePoller_H
-#define CorePoller_H
-
-#include &lt;stdio.h&gt;
-
-#include &quot;Logger.h&quot;
-#include &quot;Regions.h&quot;
-#include &quot;Input.h&quot;
-
-typedef enum{
-  LINE_HAS_CHANGED,
-  LINE_NOT_CHECKED,
-  LINE_NOT_CHANGED
-} LineStatus;
-
-typedef enum{
-  HIGHEST_PRIORITY = 0,
-  PRIORITY = 30,
-  NOT_PRIORITY = 90
-} LinePriority;
-
-class CorePoller
-{
-  public:
-
-  CorePoller(Input*, Display*);
-
-  virtual ~CorePoller();
-
-  virtual int init();
-
-  unsigned int width() const;
-
-  unsigned int height() const;
-
-  unsigned char depth() const;
-
-  int isChanged(int (*)(void*), void *, int *);
-
-  char *getFrameBuffer() const;
-
-  void destroyFrameBuffer();
-
-  void createFrameBuffer();
-
-  Region lastUpdatedRegion();
-
-  Region getLastUpdatedRegion();
-
-  void handleInput();
-
-  void handleEvent(Display *, XEvent *);
-
-  void handleWebKeyEvent(KeySym keysym, Bool isKeyPress);
-
-  Display *getShadowDisplay();
-
-  void setShadowDisplay(Display *shadowDisplay);
-
-  protected:
-
-  unsigned int bpp_;
-
-  unsigned int bpl_;
-
-  unsigned int width_;
-
-  unsigned int height_;
-
-  int depth_;
-
-  char *buffer_;
-
-  unsigned long redMask_;
-  unsigned long greenMask_;
-  unsigned long blueMask_;
-  unsigned long colorMask_[3];
-
-  char mirror_;
-
-  char mirrorChanges_;
-
-  virtual int updateShadowFrameBuffer(void) = 0;
-
-  virtual char *getRect(XRectangle r) = 0;
-
-  int imageByteOrder_;
-
-  #ifdef __CYGWIN32__
-  virtual char checkDesktop(void) = 0;
-  #endif
-
-  Display *shadowDisplay_;
-
-  void update(char *src, XRectangle r);
-
-  Region lastUpdatedRegion_;
-
-  private:
-
-  virtual void handleKeyboardEvent(Display *, XEvent *) = 0;
-
-  virtual void handleWebKeyboardEvent(KeySym keysym, Bool isKeyPress) = 0;
-
-  virtual void handleMouseEvent(Display *, XEvent *) = 0;
-
-  Input *input_;
-
-  static const int maxSliceHeight_;
-  static const int minSliceHeight_;
-
-  LineStatus *lineStatus_;
-  int *linePriority_;
-
-  static const char interlace_[];
-
-  int *lefts_;
-  int *rights_;
-
-  // FIXME: Make them friend.
-
-  int differ(char *src, XRectangle r);
-};
-
-inline unsigned int CorePoller::width() const
-{
-  return width_;
-}
-
-inline unsigned int CorePoller::height() const
-{
-  return height_;
-}
-
-inline unsigned char CorePoller::depth() const
-{
-  return depth_;
-}
-
-inline char *CorePoller::getFrameBuffer() const
-{
-  return buffer_;
-}
-
-inline void CorePoller::destroyFrameBuffer()
-{
-  if (buffer_ != NULL)
-  {
-    delete[] buffer_;
-    buffer_ = NULL;
-  }
-}
-
-inline Region CorePoller::lastUpdatedRegion()
-{
-  Region region = lastUpdatedRegion_;
-
-  lastUpdatedRegion_ = XCreateRegion();
-
-  if (lastUpdatedRegion_ == NULL)
-  {
-    logError(&quot;CorePoller::lastUpdatedRegion&quot;, ESET(ENOMEM));
-
-    lastUpdatedRegion_ = region;
-
-    return NULL;
-  }
-
-  return region;
-}
-
-inline Region CorePoller::getLastUpdatedRegion()
-{
-  return lastUpdatedRegion_;
-}
-
-inline Display *CorePoller::getShadowDisplay()
-{
-  return shadowDisplay_ ;
-}
-
-inline void CorePoller::setShadowDisplay(Display *shadowDisplay)
-{
-  shadowDisplay_ = shadowDisplay;
-}
-
-#endif /* CorePoller_H */
diff --git a/nxcompshad/Input.cpp b/nxcompshad/Input.cpp
deleted file mode 100644
index f9bf181..0000000
--- a/nxcompshad/Input.cpp
+++ /dev/null
@@ -1,167 +0,0 @@
-/**************************************************************************/
-/*                                                                        */
-/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
-/*                                                                        */
-/* NXCOMPSHAD, NX protocol compression and NX extensions to this software */
-/* are copyright of NoMachine. Redistribution and use of the present      */
-/* software is allowed according to terms specified in the file LICENSE   */
-/* which comes in the source distribution.                                */
-/*                                                                        */
-/* Check <A HREF="http://www.nomachine.com/licensing.html">http://www.nomachine.com/licensing.html</A> for applicability.       */
-/*                                                                        */
-/* NX and NoMachine are trademarks of Medialogic S.p.A.                   */
-/*                                                                        */
-/* All rights reserved.                                                   */
-/*                                                                        */
-/**************************************************************************/
-
-#include &lt;string.h&gt;
-
-#define PANIC
-#define WARNING
-#undef  TEST
-#undef  DEBUG
-
-#include &quot;Input.h&quot;
-#include &quot;Logger.h&quot;
-
-Input::Input()
-{
-  logTrace(&quot;Input::Input&quot;);
-
-  eventsHead_ = NULL;
-  eventsTail_ = NULL;
-  keymap_ = NULL;
-}
-
-Input::~Input()
-{
-  logTrace(&quot;Input::~Input&quot;);
-
-  Event *head = eventsHead_;
-
-  while (head)
-  {
-    Event *next = head -&gt; next;
-
-    delete head -&gt; event;
-    delete head;
-
-    head = next;
-  }
-
-  if (keymap_ != NULL)
-  {
-    logDebug(&quot;Input::~Input&quot;, &quot;Delete keymap_ [%p].&quot;, keymap_);
-
-    delete [] keymap_;
-  }
-}
-
-void Input::pushEvent(Display *display, XEvent *event)
-{
-  Event *tail = new Event;
-
-  if (tail == NULL)
-  {
-    logError(&quot;Input::pushEvent&quot;, ESET(ENOMEM));
-
-    return;
-  }
-
-  tail -&gt; next = NULL;
-  tail -&gt; display = display;
-  tail -&gt; event = event;
-
-  if (eventsHead_ == NULL)
-  {
-    eventsHead_ = tail;
-  }
-  else
-  {
-    eventsTail_ -&gt; next = tail;
-  }
-
-  eventsTail_ = tail;
-}
-
-XEvent *Input::popEvent()
-{
-  Event *head = eventsHead_;
-
-  if (head == NULL)
-  {
-    return 0;
-  }
-
-  XEvent *event = head -&gt; event;
-
-  eventsHead_ = head -&gt; next;
-
-  delete head;
-
-  if (eventsHead_ == NULL)
-  {
-    eventsTail_ = NULL;
-  }
-
-  return event;
-}
-
-int Input::removeAllEvents(Display *display)
-{
-  logTrace(&quot;Input::removeAllEvents&quot;);
-
-  int nRemoved = 0;
-
-  Event *current = eventsHead_;
-
-  while (current)
-  {
-    if (display == current -&gt; display)
-    {
-      //
-      // Update head of list.
-      //
-
-      if (current == eventsHead_)
-      {
-        eventsHead_ = current -&gt; next;
-      }
-
-      //
-      // Update tail of list.
-      //
-
-      if (current == eventsTail_)
-      {
-        eventsTail_ = eventsHead_;
-
-        while (eventsTail_ &amp;&amp; eventsTail_ -&gt; next)
-        {
-          eventsTail_ = eventsTail_ -&gt; next;
-        }
-      }
-
-      //
-      // Remove event.
-      //
-
-      Event *next = current -&gt; next;
-
-      delete current -&gt; event;
-      delete current;
-
-      current = next;
-
-      nRemoved++;
-    }
-    else
-    {
-      current = current -&gt; next;
-    }
-  }
-
-  return nRemoved;
-}
-
diff --git a/nxcompshad/Input.h b/nxcompshad/Input.h
deleted file mode 100644
index 6250e79..0000000
--- a/nxcompshad/Input.h
+++ /dev/null
@@ -1,91 +0,0 @@
-/**************************************************************************/
-/*                                                                        */
-/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
-/*                                                                        */
-/* NXCOMPSHAD, NX protocol compression and NX extensions to this software */
-/* are copyright of NoMachine. Redistribution and use of the present      */
-/* software is allowed according to terms specified in the file LICENSE   */
-/* which comes in the source distribution.                                */
-/*                                                                        */
-/* Check <A HREF="http://www.nomachine.com/licensing.html">http://www.nomachine.com/licensing.html</A> for applicability.       */
-/*                                                                        */
-/* NX and NoMachine are trademarks of Medialogic S.p.A.                   */
-/*                                                                        */
-/* All rights reserved.                                                   */
-/*                                                                        */
-/**************************************************************************/
-
-#ifndef Input_H
-#define Input_H
-
-#include &lt;X11/Xlib.h&gt;
-
-typedef struct Event
-{
-  struct Event *next;
-  Display *display;
-  XEvent *event;
-} Event;
-
-class Input
-{
-  public:
-
-  Input();
-
-  ~Input();
-
-  int checkIfEvent();
-
-  void pushEvent(Display *, XEvent *);
-
-  XEvent *popEvent();
-  Display *currentDisplay();
-
-  int removeAllEvents(Display *);
-
-  void setKeymap(char *keymap);
-  char *getKeymap();
-
-  void setShadowDisplayName(char *shadowDisplayName);
-  char *getShadowDisplayName();
-
-  private:
-
-  Event *eventsHead_;
-  Event *eventsTail_;
-  char *keymap_;
-  char *shadowDisplayName_;
-};
-
-inline Display *Input::currentDisplay()
-{
-  return eventsHead_ ? eventsHead_ -&gt; display : NULL;
-}
-
-inline int Input::checkIfEvent()
-{
-  return (eventsHead_ != NULL);
-}
-
-inline void Input::setKeymap(char *keymap)
-{
-  keymap_ = keymap;
-}
-
-inline char *Input::getKeymap()
-{
-  return keymap_;
-}
-
-inline void Input::setShadowDisplayName(char *shadowDisplayName)
-{
-  shadowDisplayName_ = shadowDisplayName;
-}
-
-inline char *Input::getShadowDisplayName()
-{
-  return shadowDisplayName_;
-}
-
-#endif /* Input_H */
diff --git a/nxcompshad/LICENSE b/nxcompshad/LICENSE
deleted file mode 100644
index 2c7f95a..0000000
--- a/nxcompshad/LICENSE
+++ /dev/null
@@ -1,22 +0,0 @@
-Copyright (c) 2001, 2011 NoMachine - <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>
-
-NXCOMPSHAD and NX extensions to X are copyright of NoMachine.
-
-Redistribution and use of this software is allowed according to the
-following terms:
-
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License Version 2, and
-not any other version, as published by the Free Software Foundation.
-
-This program is distributed in the hope that it will be useful, but
-WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTA-
-BILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General
-Public License for more details.
-
-You should have received a copy of the GNU General Public License
-along with this program; if not, you can request a copy to NoMachine
-or write to the Free Software Foundation, Inc., 59 Temple Place,
-Suite 330, Boston, MA  02111-1307 USA
-
-All rights reserved.
diff --git a/nxcompshad/Logger.cpp b/nxcompshad/Logger.cpp
deleted file mode 100644
index c367c5d..0000000
--- a/nxcompshad/Logger.cpp
+++ /dev/null
@@ -1,116 +0,0 @@
-/**************************************************************************/
-/*                                                                        */
-/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
-/*                                                                        */
-/* NXCOMP, NX protocol compression and NX extensions to this software     */
-/* are copyright of NoMachine. Redistribution and use of the present      */
-/* software is allowed according to terms specified in the file LICENSE   */
-/* which comes in the source distribution.                                */
-/*                                                                        */
-/* Check <A HREF="http://www.nomachine.com/licensing.html">http://www.nomachine.com/licensing.html</A> for applicability.       */
-/*                                                                        */
-/* NX and NoMachine are trademarks of Medialogic S.p.A.                   */
-/*                                                                        */
-/* All rights reserved.                                                   */
-/*                                                                        */
-/**************************************************************************/
-
-#include &lt;stdio.h&gt;
-#include &lt;ctype.h&gt;
-#include &lt;unistd.h&gt;
-
-#define PANIC
-#define WARNING
-#undef  TEST
-#define DEBUG
-
-#include &quot;Misc.h&quot;
-#include &quot;Logger.h&quot;
-
-Logger logger;
-
-void Logger::user(const char *format, va_list arguments)
-{
-  char string[1024];
-
-  vsnprintf(string, 1024, format, arguments);
-
-  fprintf(stderr, &quot;%s\n&quot;, string);
-}
-
-void Logger::error(const char *name, int error)
-{
-  fprintf(stderr, &quot;PANIC! %s: Failed with code %d: %s\n&quot;,
-               name, error, strerror(error));
-}
-
-void Logger::warning(const char *name, const char *format, va_list arguments)
-{
-  char string[1024];
-
-  vsnprintf(string, 1024, format, arguments);
-
-  fprintf(stderr, &quot;%s: WARNING! %s\n&quot;, name, string);
-}
-
-void Logger::test(const char *name, const char *format, va_list arguments)
-{
-  char string[1024];
-
-  vsnprintf(string, 1024, format, arguments);
-
-  fprintf(stderr, &quot;%s: %s\n&quot;, name, string);
-}
-
-void Logger::trace(const char *name)
-{
-  fprintf(stderr, &quot;%s\n&quot;, name);
-}
-
-void Logger::debug(const char *name, const char *format, va_list arguments)
-{
-  char string[1024];
-
-  vsnprintf(string, 1024, format, arguments);
-
-  fprintf(stderr, &quot;%s: %s\n&quot;, name, string);
-}
-
-void Logger::dump(const char *name, const char *data, int size)
-{
-  fprintf(stderr, &quot;%s: Dumping %d bytes of data at %p\n&quot;,
-              name, size, data);
-
-  for (int i = 0; i &lt; size;)
-  {
-    fprintf(stderr, &quot;[%d]\t&quot;, i);
-
-    int t = i;
-
-    for (unsigned int ii = 0; i &lt; size &amp;&amp; ii &lt; 8; i++, ii++)
-    {
-      fprintf(stderr, &quot;%02x/%d\t&quot;, data[i] &amp; 0xff, data[i]);
-    }
-
-    for (unsigned int ii = i % 8; ii &gt; 0 &amp;&amp; ii &lt; 8; ii++)
-    {
-      fprintf(stderr, &quot;\t&quot;);
-    }
-
-    i = t;
-
-    for (unsigned int ii = 0; i &lt; size &amp;&amp; ii &lt; 8; i++, ii++)
-    {
-      if (isprint(data[i]))
-      {
-        fprintf(stderr, &quot;%c&quot;, data[i]);
-      }
-      else
-      {
-        fprintf(stderr, &quot;.&quot;);
-      }
-    }
-
-    fprintf(stderr, &quot;\n&quot;);
-  }
-}
diff --git a/nxcompshad/Logger.h b/nxcompshad/Logger.h
deleted file mode 100644
index 94e4da8..0000000
--- a/nxcompshad/Logger.h
+++ /dev/null
@@ -1,159 +0,0 @@
-/**************************************************************************/
-/*                                                                        */
-/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
-/*                                                                        */
-/* NXCOMP, NX protocol compression and NX extensions to this software     */
-/* are copyright of NoMachine. Redistribution and use of the present      */
-/* software is allowed according to terms specified in the file LICENSE   */
-/* which comes in the source distribution.                                */
-/*                                                                        */
-/* Check <A HREF="http://www.nomachine.com/licensing.html">http://www.nomachine.com/licensing.html</A> for applicability.       */
-/*                                                                        */
-/* NX and NoMachine are trademarks of Medialogic S.p.A.                   */
-/*                                                                        */
-/* All rights reserved.                                                   */
-/*                                                                        */
-/**************************************************************************/
-
-#ifndef Logger_H
-#define Logger_H
-
-#include &lt;errno.h&gt;
-#include &lt;stdarg.h&gt;
-
-//
-// Error handling macros.
-//
-
-#define ESET(e)  (errno = (e))
-#define EGET()   (errno)
-#define ESTR()   strerror(errno)
-
-extern class Logger logger;
-
-class Logger
-{
-  public:
-
-  void user(const char *format, va_list arguments);
-
-  void error(const char *name, int error);
-
-  void warning(const char *name, const char *format, va_list arguments);
-
-  void test(const char *name, const char *format, va_list arguments);
-
-  void trace(const char *name);
-
-  void debug(const char *name, const char *format, va_list arguments);
-
-  void dump(const char *name, const char *data, int size);
-};
-
-static inline void logUser(const char *format, ...) \
-    __attribute__((format(printf, 1, 2))) __attribute__((__unused__));
-
-static inline void logError(const char *name, int error) \
-    __attribute__((__unused__));
-
-static inline void logWarning(const char *name, const char *format, ...) \
-    __attribute__((__unused__));
-
-static inline void logTest(const char *name, const char *format, ...) \
-    __attribute__((format(printf, 2, 3))) __attribute__((__unused__));
-
-static inline void logTrace(const char *name) \
-    __attribute__((__unused__));
-
-static inline void logDebug(const char *name, const char *format, ...) \
-    __attribute__((format(printf, 2, 3))) __attribute__((__unused__));
-
-static inline void logDump(const char *name, const char *data, int size) \
-    __attribute__((__unused__));
-
-static inline void logUser(const char *format, ...)
-{
-  va_list arguments;
-
-  va_start(arguments, format);
-
-  logger.user(format, arguments);
-
-  va_end(arguments);
-}
-
-static inline void logError(const char *name, int error)
-{
-  #if defined(DEBUG) || defined(TEST) || \
-          defined(WARNING) || defined(PANIC)
-
-  logger.error(name, error);
-
-  #endif
-}
-
-static inline void logWarning(const char *name, const char *format, ...)
-{
-  #if defined(DEBUG) || defined(TEST) || \
-          defined(WARNING)
-
-  va_list arguments;
-
-  va_start(arguments, format);
-
-  logger.warning(name, format, arguments);
-
-  va_end(arguments);
-
-  #endif
-}
-
-static inline void logTest(const char *name, const char *format, ...)
-{
-  #if defined(TEST)
-
-  va_list arguments;
-
-  va_start(arguments, format);
-
-  logger.test(name, format, arguments);
-
-  va_end(arguments);
-
-  #endif
-}
-
-static inline void logTrace(const char *name)
-{
-  #if defined(DEBUG)
-
-  logger.trace(name);
-
-  #endif
-}
-
-static inline void logDebug(const char *name, const char *format, ...)
-{
-  #if defined(DEBUG)
-
-  va_list arguments;
-
-  va_start(arguments, format);
-
-  logger.debug(name, format, arguments);
-
-  va_end(arguments);
-
-  #endif
-}
-
-static inline void logDump(const char *name, const char *data, int size)
-{
-  #if defined(TEST)
-
-  logger.dump(name, data, size);
-
-  #endif
-}
-
-#endif /* Logger_H */
diff --git a/nxcompshad/Makefile.in b/nxcompshad/Makefile.in
deleted file mode 100644
index 1580a35..0000000
--- a/nxcompshad/Makefile.in
+++ /dev/null
@@ -1,192 +0,0 @@
-############################################################################
-#                                                                          #
-#  Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>          #
-#                                                                          #
-#  NXCOMP, NX protocol compression and NX extensions to this software      #
-#  are copyright of NoMachine. Redistribution and use of the present       #
-#  software is allowed according to terms specified in the file LICENSE    #
-#  which comes in the source distribution.                                 #
-#                                                                          #
-#  Check <A HREF="http://www.nomachine.com/licensing.html">http://www.nomachine.com/licensing.html</A> for applicability.        #
-#                                                                          #
-#  NX and NoMachine are trademarks of Medialogic S.p.A.                    #
-#                                                                          #
-#  All rights reserved.                                                    #
-#                                                                          #
-############################################################################
-
-#
-# Get values from configure script.
-#
-
-VERSION=@VERSION@
-LIBVERSION=@LIBVERSION@
-
-#
-# We would really like to enable all warnings, -Wredundant-decls,
-# though, gives a warning caused by pthread.h and unistd.h and
-# GCC 3.4 was changed in a way that it now complains about some
-# of the -W directives we used before (-Wmissing-declarations,
-# -Wnested-externs, -Wstrict-prototypes and -Wmissing-prototypes).
-#
-
-CXX         = @CXX@
-CXXFLAGS    = @CXXFLAGS@ @X_CFLAGS@ @DEFS@ \
-              -Wall -Wpointer-arith
-CXXINCLUDES =
-CXXDEFINES  =
-
-#
-# C programs don't share the C++ flags. They should
-# have their own @<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">CCFLAGS at .</A>
-#
-
-CC          = @CC@
-CCFLAGS     = @X_CFLAGS@ @DEFS@ \
-              -Wall -Wpointer-arith
-CCINCLUDES  =
-CCDEFINES   =
-
-LDFLAGS     = @LDFLAGS@
-LIBS        = @LIBS@ -L/usr/X11R6/lib -lX11
-
-#
-# Only if THREADS is defined.
-#
-# LIBS = $(LIBS) -lpthread
-#
-
-#
-# Only if you want ElectricFence.
-#
-# LIBS = $(LIBS) -lefence
-#
-
-#
-# Only if you want mpatrol.
-#
-# LIBS = $(LIBS) -lmpatrol -lbfd -liberty
-#
-
-srcdir      = @srcdir@
-prefix      = @prefix@
-exec_prefix = @exec_prefix@
-bindir      = @bindir@
-man1dir     = @mandir@/man1
-VPATH       = @srcdir@
-
-INSTALL         = @INSTALL@
-INSTALL_PROGRAM = @INSTALL_PROGRAM@
-INSTALL_DATA    = @INSTALL_DATA@
-
-#
-# This should be autodetected.
-#
-
-MAKEDEPEND     = @MAKEDEPEND@
-DEPENDINCLUDES = -I/usr/include/g++ -I/usr/include/g++-3
-
-.SUFFIXES: .cpp.c
-
-.cpp.o:
-	$(CXX) -c $(CXXFLAGS) $(CXXINCLUDES) $(CXXDEFINES) $&lt;
-.c.o:
-	$(CC) -c $(CCFLAGS) $(CCINCLUDES) $(CCDEFINES) $&lt;
-
-LIBRARY = Xcompshad
-
-LIBNAME    = lib$(LIBRARY)
-LIBFULL    = lib$(LIBRARY).so.$(VERSION)
-LIBLOAD    = lib$(LIBRARY).so.$(LIBVERSION)
-LIBSHARED  = lib$(LIBRARY).so
-LIBARCHIVE = lib$(LIBRARY).a
-
-MSRC   = Main.c
-
-CSRC   =
-
-CXXSRC = Core.cpp \
-	 Input.cpp \
-	 Logger.cpp \
-	 Shadow.cpp \
-	 X11.cpp \
-	 Win.cpp \
-	 Updater.cpp \
-	 Manager.cpp
-
-MOBJ   = $(MSRC:.c.cpp=.o)
-COBJ   = $(CSRC:.c=.o)
-CXXOBJ = $(CXXSRC:.cpp=.o)
-
-MLIBS  = -L. -lXShadow
-
-ifeq ($(findstring -lgdi32,$(LIBS)),-lgdi32)
-
-# We need a smarter way to detect windows
-# platform.
-
-LIBDLL       = cyg$(LIBRARY).dll
-LIBDLLSTATIC = lib${LIBRARY}.dll.a
-
-all: depend $(LIBARCHIVE) $(LIBDLL)
-
-else
-
-EXTRALIBS = -lXtst -lXrandr -lXdamage
-
-all: depend $(LIBFULL) $(LIBLOAD) $(LIBSHARED) $(LIBARCHIVE)
-
-endif
-
-$(LIBFULL):	$(CXXOBJ) $(COBJ)
-		$(CXX) -o $@ $(LDFLAGS) $(CXXOBJ) $(COBJ) $(LIBS) $(EXTRALIBS)
-
-$(LIBLOAD):	$(LIBFULL)
-		rm -f $(LIBLOAD)
-		ln -s $(LIBFULL) $(LIBLOAD)
-
-$(LIBSHARED):	$(LIBFULL)
-		rm -f $(LIBSHARED)
-		ln -s $(LIBFULL) $(LIBSHARED)
-
-$(LIBARCHIVE):	$(CXXOBJ) $(COBJ)
-		rm -f  $(LIBARCHIVE)
-		ar clq $(LIBARCHIVE) $(CXXOBJ) $(COBJ)
-		ranlib $(LIBARCHIVE)
-
-$(LIBDLL): $(LIBARCHIVE)
-		$(CC) -o $@ \
-		-shared \
-		-Wl,--out-implib=$(LIBDLLSTATIC) \
-		-Wl,--export-all-symbols \
-		-Wl,--enable-auto-import \
-		-Wl,--whole-archive ${LIBARCHIVE} \
-		-Wl,--no-whole-archive \
-		${LIBS} -L/usr/X11R6/lib
-
-$(PROGRAM):	$(MOBJ) $(COBJ) $(CXXOBJ) $(LIBDLL)
-#		$(CC) $(CCFLAGS) -o $@ $(MOBJ) $(MLIBS)
-
-depends:	depend.status
-
-depend:		depend.status
-
-depend.status:	
-		if [ -x $(MAKEDEPEND) ] ; then \
-			$(MAKEDEPEND) $(CXXINCLUDES) $(CCINCLUDES) \
-                        $(DEPENDINCLUDES) -f Makefile $(MSRC) $(CSRC) $(CXXSRC) 2&gt;/dev/null; \
-		fi
-		touch depend.status
-
-install:	install.bin install.man
-
-install.bin:
-
-install.man:
-
-clean:
-		-rm -f *~ *.o *.bak st?????? core core.* *.out.* *.exe.stackdump \
-		$(LIBFULL) $(LIBLOAD) $(LIBSHARED) $(LIBARCHIVE) $(LIBDLL) $(LIBDLLSTATIC) $(PROGRAM) $(PROGRAM).exe
-
-distclean:	clean
-		-rm -rf config.status config.log config.cache depend.status Makefile tags autom4te.cache
diff --git a/nxcompshad/Manager.cpp b/nxcompshad/Manager.cpp
deleted file mode 100644
index ba9260a..0000000
--- a/nxcompshad/Manager.cpp
+++ /dev/null
@@ -1,252 +0,0 @@
-/**************************************************************************/
-/*                                                                        */
-/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
-/*                                                                        */
-/* NXCOMPSHAD, NX protocol compression and NX extensions to this software */
-/* are copyright of NoMachine. Redistribution and use of the present      */
-/* software is allowed according to terms specified in the file LICENSE   */
-/* which comes in the source distribution.                                */
-/*                                                                        */
-/* Check <A HREF="http://www.nomachine.com/licensing.html">http://www.nomachine.com/licensing.html</A> for applicability.       */
-/*                                                                        */
-/* NX and NoMachine are trademarks of Medialogic S.p.A.                   */
-/*                                                                        */
-/* All rights reserved.                                                   */
-/*                                                                        */
-/**************************************************************************/
-
-#include &lt;X11/Xlib.h&gt;
-#include &lt;X11/Xutil.h&gt;
-#include &lt;X11/keysym.h&gt;
-#include &lt;string.h&gt;
-
-#define PANIC
-#define WARNING
-#undef  TEST
-#undef  DEBUG
-
-#include &quot;Manager.h&quot;
-#include &quot;Logger.h&quot;
-
-UpdateManager::UpdateManager(int w, int h, char *f, Input *i)
-  : width_(w), height_(h), frameBuffer_(f), input_(i)
-{
-  logTrace(&quot;UpdateManager::UpdateManager&quot;);
-
-  nUpdater = 0;
-  updaterVector = NULL;
-  updateManagerRegion_ = NULL;
-}
-
-UpdateManager::~UpdateManager()
-{
-  logTrace(&quot;UpdateManager::~UpdateManager&quot;);
-
-  for (int i = 0; i &lt; nUpdater; i++)
-  {
-    delete updaterVector[i];
-  }
-
-  delete [] updaterVector;
-}
-
-Updater *UpdateManager::createUpdater(char *displayName, Display *display)
-{
-  Updater *updater = new Updater(displayName, display);
-
-  if (updater == NULL)
-  {
-    logError(&quot;UpdateManager::createUpdater&quot;, ESET(ENOMEM));
-
-    return NULL;
-  }
-
-  if (updater -&gt; init(width_, height_, frameBuffer_, input_) == -1)
-  {
-    logError(&quot;UpdateManager::createUpdater&quot;, EGET());
-
-    delete updater;
-
-    return NULL;
-  }
-
-  return updater;
-}
-
-UpdaterHandle UpdateManager::addUpdater(char *displayName, Display *display)
-{
-  Updater *newUpdater = createUpdater(displayName, display);
-
-  if (newUpdater == NULL)
-  {
-    logError(&quot;UpdateManager::addUpdater&quot;, EGET());
-
-    return NULL;
-  }
-
-  Updater **newUpdaterVector = new Updater*[nUpdater + 1];
-
-  if (newUpdaterVector == NULL)
-  {
-    logError(&quot;UpdateManager::addUpdater&quot;, ESET(ENOMEM));
-
-    delete newUpdater;
-
-    return NULL;
-  }
-
-  for (int i = 0; i &lt; nUpdater; i++)
-  {
-    newUpdaterVector[i] = updaterVector[i];
-  }
-
-  newUpdaterVector[nUpdater] = newUpdater;
-
-  delete [] updaterVector;
-
-  updaterVector = newUpdaterVector;
-
-  nUpdater++;
-
-  logTest(&quot;UpdateManager::AddUpdater&quot;, &quot;Number of updaters [%d].&quot;, nUpdater);
-
-  return reinterpret_cast&lt;UpdaterHandle&gt;(newUpdater);
-}
-
-int UpdateManager::removeAllUpdaters()
-{
-  logTest(&quot;UpdateManager::removeAllUpdaters&quot;, &quot;Number of updaters [%d].&quot;, nUpdater);
-
-  int nullUpdaters = 0;
-
-  for (int i = nUpdater; i &gt; 0; i--)
-  {
-    if (removeUpdater(reinterpret_cast&lt;UpdaterHandle&gt;(updaterVector[i - 1])) == 0)
-    {
-      nullUpdaters++;
-    }
-  }
-
-  if (nUpdater == 0)
-  {
-    return 1;
-  }
-
-  if (nUpdater == nullUpdaters)
-  {
-    logTest(&quot;UpdateManager::removeAllUpdaters&quot;, &quot;Ignored null records in Updater vector.&quot;);
-
-    return 0;
-  }
-
-  logTest(&quot;UpdateManager::removeAllUpdaters&quot;, &quot;Failed to remove some updaters.&quot;);
-
-  return -1;
-}
-
-int UpdateManager::removeUpdater(UpdaterHandle handle)
-{
-  Updater * const updater = (Updater*) handle;
-
-  logTest(&quot;UpdateManager::removeUpdater&quot;, &quot;Removing Updater [%p].&quot;, updater);
-
-  if (updater == NULL)
-  {
-    return 0;
-  }
-
-  for (int i = 0; i &lt; nUpdater; i++)
-  {
-    if (updater == updaterVector[i])
-    {
-      updaterVector[i] = updaterVector[nUpdater - 1];
-
-      nUpdater--;
-
-      delete updater;
-
-      return 1;
-    }
-  }
-
-  logTest(&quot;UpdateManager::removeUpdater&quot;, &quot;Couldn't find Updater [%p].&quot;, updater);
-
-  return -1;
-}
-
-void UpdateManager::addRegion(Region region)
-{
-  logTrace(&quot;UpdateManager::addRegion&quot;);
-
-  for (int i = 0; i &lt; nUpdater; i++)
-  {
-    updaterVector[i] -&gt; addRegion(region);
-  }
-
-  XDestroyRegion(region);
-}
-
-void UpdateManager::update()
-{
-  logTrace(&quot;UpdateManager::update&quot;);
-
-  for (int i = 0; i &lt; nUpdater; i++)
-  {
-    /*updaterVector[i] -&gt; update();*/
-    if (updaterVector[i] -&gt; getUpdateRegion())
-    {
-      logDebug(&quot;UpdateManager::update&quot;, &quot;pRegion [%p] rect[%ld].&quot;,
-                   updaterVector[i] -&gt; getUpdateRegion(), (updaterVector[i] -&gt; getUpdateRegion()) -&gt; numRects);
-
-      updateManagerRegion_ = updaterVector[i] -&gt; getUpdateRegion();
-      //
-      // FIXME: Remove me.
-      //
-      for (int j = 0; j &lt; updateManagerRegion_ -&gt; numRects; j++)
-      {
-        int x = updateManagerRegion_ -&gt; rects[j].x1;
-        int y = updateManagerRegion_ -&gt; rects[j].y1;
-        unsigned int width = updateManagerRegion_ -&gt; rects[j].x2 - updateManagerRegion_ -&gt; rects[j].x1;
-        unsigned int height = updateManagerRegion_ -&gt; rects[j].y2 - updateManagerRegion_ -&gt; rects[j].y1;
-        logDebug(&quot;UpdateManager::update&quot;, &quot;x[%d]y[%d]width[%u]height[%u], updateManagerRegion_[%p]&quot;,
-                  x, y, width, height, updateManagerRegion_);
-      }
-    }
-  }
-}
-
-void UpdateManager::handleInput()
-{
-  logTrace(&quot;UpdateManager::handleInput&quot;);
-
-  for (int i = 0; i &lt; nUpdater; i++)
-  {
-    try
-    {
-      updaterVector[i] -&gt; handleInput();
-    }
-    catch (UpdaterClosing u)
-    {
-      logTest(&quot;UpdateManager::handleInput&quot;, &quot;Catched exception UpdaterClosing().&quot;);
-
-      removeUpdater((UpdaterHandle)updaterVector[i]);
-
-      //
-      // Now the i-element of the updaterVector
-      // is changed. We don't want to skip it.
-      //
-
-      i--;
-    }
-  }
-}
-
-void UpdateManager::newRegion()
-{
-  logTrace(&quot;UpdateManager::newRegion&quot;);
-
-  for (int i = 0; i &lt; nUpdater; i++)
-  {
-    updaterVector[i] -&gt; newRegion();
-  }
-}
diff --git a/nxcompshad/Manager.h b/nxcompshad/Manager.h
deleted file mode 100644
index 2677549..0000000
--- a/nxcompshad/Manager.h
+++ /dev/null
@@ -1,115 +0,0 @@
-/**************************************************************************/
-/*                                                                        */
-/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
-/*                                                                        */
-/* NXCOMPSHAD, NX protocol compression and NX extensions to this software */
-/* are copyright of NoMachine. Redistribution and use of the present      */
-/* software is allowed according to terms specified in the file LICENSE   */
-/* which comes in the source distribution.                                */
-/*                                                                        */
-/* Check <A HREF="http://www.nomachine.com/licensing.html">http://www.nomachine.com/licensing.html</A> for applicability.       */
-/*                                                                        */
-/* NX and NoMachine are trademarks of Medialogic S.p.A.                   */
-/*                                                                        */
-/* All rights reserved.                                                   */
-/*                                                                        */
-/**************************************************************************/
-
-#ifndef UpdateManager_H
-#define UpdateManager_H
-
-#include &lt;X11/Xlib.h&gt;
-
-#include &quot;Updater.h&quot;
-#include &quot;Regions.h&quot;
-#include &quot;Input.h&quot;
-
-typedef char* UpdaterHandle;
-
-class UpdateManager
-{
-  public:
-
-  UpdateManager(int, int, char *, Input *);
-
-  ~UpdateManager();
-
-  void handleInput();
-
-  void addRegion(Region);
-
-  void update();
-
-  UpdaterHandle addUpdater(char *displayName, Display *display);
-
-  int removeUpdater(UpdaterHandle);
-
-  int removeAllUpdaters();
-
-  int numberOfUpdaters();
-
-  int getWidth();
-
-  int getHeight();
-
-  char *getBuffer();
-
-  Region getUpdateManagerRegion();
-
-  void destroyUpdateManagerRegion();
-
-  void newRegion();
-
-  private:
-
-  Updater *createUpdater(char *displayName, Display *display);
-
-  int width_;
-  int height_;
-  char *frameBuffer_;
-  Input *input_;
-
-  int nUpdater;
-
-  Updater **updaterVector;
-
-  Region updateManagerRegion_;
-
-};
-
-inline int UpdateManager::numberOfUpdaters()
-{
-  return nUpdater;
-}
-
-inline int UpdateManager::getWidth()
-{
-  return width_;
-}
-
-inline int UpdateManager::getHeight()
-{
-  return height_;
-}
-
-inline char *UpdateManager::getBuffer()
-{
-  return frameBuffer_;
-}
-
-inline Region UpdateManager::getUpdateManagerRegion()
-{
-  return updateManagerRegion_;
-}
-
-inline void UpdateManager::destroyUpdateManagerRegion()
-{
-  if (updateManagerRegion_ != NULL)
-  {
-    XDestroyRegion(updateManagerRegion_);
-
-    updateManagerRegion_ = NULL;
-  }
-}
-
-#endif /* UpdateManager_H */
diff --git a/nxcompshad/Poller.h b/nxcompshad/Poller.h
deleted file mode 100644
index 4435b5b..0000000
--- a/nxcompshad/Poller.h
+++ /dev/null
@@ -1,31 +0,0 @@
-/**************************************************************************/
-/*                                                                        */
-/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
-/*                                                                        */
-/* NXCOMPSHAD, NX protocol compression and NX extensions to this software */
-/* are copyright of NoMachine. Redistribution and use of the present      */
-/* software is allowed according to terms specified in the file LICENSE   */
-/* which comes in the source distribution.                                */
-/*                                                                        */
-/* Check <A HREF="http://www.nomachine.com/licensing.html">http://www.nomachine.com/licensing.html</A> for applicability.       */
-/*                                                                        */
-/* NX and NoMachine are trademarks of Medialogic S.p.A.                   */
-/*                                                                        */
-/* All rights reserved.                                                   */
-/*                                                                        */
-/**************************************************************************/
-
-#ifndef Poller_H
-#define Poller_H
-
-#if defined(__CYGWIN32__) || defined(WIN32)
-
-#include &quot;Win.h&quot;
-
-#else
-
-#include &quot;X11.h&quot;
-
-#endif
-
-#endif /* Poller_H */
diff --git a/nxcompshad/Regions.h b/nxcompshad/Regions.h
deleted file mode 100644
index b9303dc..0000000
--- a/nxcompshad/Regions.h
+++ /dev/null
@@ -1,35 +0,0 @@
-/**************************************************************************/
-/*                                                                        */
-/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
-/*                                                                        */
-/* NXCOMPSHAD, NX protocol compression and NX extensions to this software */
-/* are copyright of NoMachine. Redistribution and use of the present      */
-/* software is allowed according to terms specified in the file LICENSE   */
-/* which comes in the source distribution.                                */
-/*                                                                        */
-/* Check <A HREF="http://www.nomachine.com/licensing.html">http://www.nomachine.com/licensing.html</A> for applicability.       */
-/*                                                                        */
-/* NX and NoMachine are trademarks of Medialogic S.p.A.                   */
-/*                                                                        */
-/* All rights reserved.                                                   */
-/*                                                                        */
-/**************************************************************************/
-
-#ifndef Region_H
-#define Region_H
-
-#include &lt;X11/Xlib.h&gt;
-#include &lt;X11/Xutil.h&gt;
-
-typedef struct {
-    short x1, x2, y1, y2;
-} Box, BOX, BoxRec, *BoxPtr;
-
-typedef struct _XRegion {
-    long size;
-    long numRects;
-    BOX *rects;
-    BOX extents;
-};
-
-#endif /* Region_H */
diff --git a/nxcompshad/Shadow.cpp b/nxcompshad/Shadow.cpp
deleted file mode 100644
index f9525ad..0000000
--- a/nxcompshad/Shadow.cpp
+++ /dev/null
@@ -1,470 +0,0 @@
-/**************************************************************************/
-/*                                                                        */
-/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
-/*                                                                        */
-/* NXCOMPSHAD, NX protocol compression and NX extensions to this software */
-/* are copyright of NoMachine. Redistribution and use of the present      */
-/* software is allowed according to terms specified in the file LICENSE   */
-/* which comes in the source distribution.                                */
-/*                                                                        */
-/* Check <A HREF="http://www.nomachine.com/licensing.html">http://www.nomachine.com/licensing.html</A> for applicability.       */
-/*                                                                        */
-/* NX and NoMachine are trademarks of Medialogic S.p.A.                   */
-/*                                                                        */
-/* All rights reserved.                                                   */
-/*                                                                        */
-/**************************************************************************/
-
-#include &lt;signal.h&gt;
-#include &lt;string.h&gt;
-
-#define PANIC
-#define WARNING
-#undef  TEST
-#undef  DEBUG
-
-#include &quot;Logger.h&quot;
-#include &quot;Shadow.h&quot;
-#include &quot;Poller.h&quot;
-#include &quot;Manager.h&quot;
-
-typedef struct {
-    KeySym  *map;
-    KeyCode minKeyCode,
-            maxKeyCode;
-    int     mapWidth;
-} KeySymsRec, *KeySymsPtr;
-
-KeySymsPtr NXShadowKeymap = NULL;
-
-ShadowOptions NXShadowOptions = {1, 1, -1};
-
-static int mirrorException = 0;
-
-static UpdateManager *updateManager;
-static Poller *poller;
-static Input *input;
-
-int NXShadowRemoveAllUpdaters();
-
-inline bool NXShadowNotInitialized()
-{
-  //
-  // updateManager depends on input and poller.
-  // So this test seem redundant.
-  //
-  // return (input == NULL) || (poller == NULL) || (updateManager == NULL);
-  //
-
-  return (updateManager == NULL);
-}
-
-#ifdef NEED_SIGNAL_HANDLER
-static void NXSignalHandler(int signal)
-{
-  logTest(&quot;NXSignalHandler&quot;, &quot;Got signal [%d]&quot;, signal);
-
-  if (signal == SIGINT)
-  {
-    mirrorException = 1;
-  }
-  else if (signal == SIGTERM)
-  {
-    mirrorException = 1;
-  }
-}
-
-static int NXInitSignal()
-{
-  logTrace(&quot;NXInitSignal&quot;);
-
-  struct sigaction sa;
-
-  sa.sa_handler = NXSignalHandler;
-  sigfillset(&amp;sa.sa_mask);
-  sa.sa_flags = 0;
-
-  int res;
-
-  while ((res = sigaction(SIGINT, &amp;sa, NULL)) == -1 &amp;&amp;
-             errno == EINTR);
-
-  if (res == -1)
-  {
-    logError(&quot;NXInitSignal&quot;, EGET());
-
-    return -1;
-  }
-
-  return 1;
-}
-#endif
-
-static void NXHandleException()
-{
-  if (mirrorException)
-  {
-    mirrorException = 0;
-
-    NXShadowRemoveAllUpdaters();
-  }
-}
-
-static int NXCreateInput(char *keymap, char *shadowDisplayName)
-{
-  logTrace(&quot;NXCreateInput&quot;);
-
-  input = new Input;
-
-  if (input == NULL)
-  {
-    logError(&quot;NXCreateInput&quot;, ESET(ENOMEM));
-
-    return -1;
-  }
-
-  input -&gt; setKeymap(keymap);
-
-  input -&gt; setShadowDisplayName(shadowDisplayName);
-
-  return 1;
-}
-
-static int NXCreatePoller(Display *display, Display **shadowDisplay)
-{
-  logTrace(&quot;NXCreatePoller&quot;);
-
-  if (input == NULL)
-  {
-    logError(&quot;NXCreatePoller&quot;, ESET(EBADFD));
-
-    return -1;
-  }
-
-  poller = new Poller(input,display);
-
-  if (poller == NULL)
-  {
-    logError(&quot;NXCreatePoller&quot;, ESET(ENOMEM));
-
-    return -1;
-  }
-
-  if (poller -&gt; init() == -1)
-  {
-    logWarning(&quot;NXCreatePoller&quot;, &quot;Failed to initialize poller.&quot;);
-
-    return -1;
-  }
-
-  *shadowDisplay = poller -&gt; getShadowDisplay();
-
-  logTest(&quot;NXCreatePoller&quot;, &quot;Poller geometry [%d, %d], ShadowDisplay[%p].&quot;, poller -&gt; width(),
-              poller -&gt; height(), (Display *) *shadowDisplay);
-
-  return 1;
-}
-
-static int NXCreateUpdateManager()
-{
-  logTrace(&quot;NXCreateUpdateManager&quot;);
-
-  if (input == NULL || poller == NULL)
-  {
-    logError(&quot;NXCreateUpdateManager&quot;, ESET(EBADFD));
-
-    return -1;
-  }
-
-  updateManager = new UpdateManager(poller -&gt; width(), poller -&gt; height(),
-                                        poller -&gt; getFrameBuffer(), input);
-
-  if (updateManager == NULL)
-  {
-    logError(&quot;NXCreateUpdateManager&quot;, ESET(ENOMEM));
-
-    return -1;
-  }
-
-  return 1;
-}
-
-void  NXShadowResetOptions()
-{
-  NXShadowOptions.optionShmExtension = 1;
-  NXShadowOptions.optionDamageExtension = 1;
-}
-
-//
-// Exported functions.
-//
-
-int NXShadowHasUpdaters()
-{
-  logTrace(&quot;NXShadowHasUpdaters&quot;);
-
-  return (updateManager &amp;&amp; updateManager -&gt; numberOfUpdaters()) ? 1 : 0;
-}
-
-int NXShadowRemoveAllUpdaters()
-{
-  logTrace(&quot;NXShadowRemoveAllUpdaters&quot;);
-
-  return updateManager ? updateManager -&gt; removeAllUpdaters() : 0;
-}
-
-int NXShadowRemoveUpdater(UpdaterHandle handle)
-{
-  logTrace(&quot;NXShadowRemoveUpdater&quot;);
-
-  return updateManager ? updateManager -&gt; removeUpdater(handle) : 0;
-}
-
-UpdaterHandle NXShadowAddUpdater(char *displayName)
-{
-  logTrace(&quot;NXShadowAddUpdater&quot;);
-
-  return updateManager ? updateManager -&gt; addUpdater(displayName, NULL) : NULL;
-}
-
-int NXShadowAddUpdaterDisplay(void *dpy, int *w, int *h, unsigned char *d)
-{
-  Display *display = reinterpret_cast&lt;Display*&gt;(dpy);
-
-  logTrace(&quot;NXShadowAddUpdaterDisplay&quot;);
-
-  if ((updateManager ? updateManager -&gt; addUpdater(NULL, display) : NULL) == NULL)
-  {
-    logTest(&quot;NXShadowAddUpdaterDisplay&quot;, &quot;Error&quot;);
-
-    return 0;
-  }
-
-  *w = updateManager -&gt; getWidth();
-  *h = updateManager -&gt; getHeight();
-  *d = poller -&gt; depth();
-
-  return 1;
-}
-
-int NXShadowCreate(void *dpy, char *keymap, char* shadowDisplayName, void **shadowDpy)
-{
-  logTrace(&quot;NXShadowCreate&quot;);
-
-  Display *display = reinterpret_cast&lt;Display*&gt;(dpy);
-  Display **shadowDisplay = reinterpret_cast&lt;Display**&gt;(shadowDpy);
-
-/*  if (NXInitSignal() != 1)
-  {
-    logError(&quot;NXShadowCreate&quot;, EGET());
-
-    return -1;
-  }*/
-
-  if (NXCreateInput(keymap, shadowDisplayName) != 1)
-  {
-    logError(&quot;NXShadowCreate&quot;, EGET());
-
-    return -1;
-  }
-
-  if (NXCreatePoller(display, shadowDisplay) != 1)
-  {
-    logWarning(&quot;NXShadowCreate&quot;, &quot;NXCreatePoller failed.&quot;);
-
-    return -1;
-  }
-
-  if (NXCreateUpdateManager() != 1)
-  {
-    logError(&quot;NXShadowCreate&quot;, EGET());
-
-    return -1;
-  }
-
-  return 1;
-}
-
-#if !defined(__CYGWIN32__) &amp;&amp; !defined(WIN32)
-
-void NXShadowSetDisplayUid(int uid)
-{
-  NXShadowOptions.optionShadowDisplayUid = uid;
-}
-
-void NXShadowDisableShm(void)
-{
-  logUser(&quot;NXShadowDisableShm: Disabling SHM.\n&quot;);
-
-  NXShadowOptions.optionShmExtension = 0;
-}
-
-void NXShadowDisableDamage(void)
-{
-  NXShadowOptions.optionDamageExtension = 0;
-}
-
-void NXShadowGetScreenSize(int *w, int *h)
-{
-  poller -&gt; getScreenSize(w, h);
-}
-
-void NXShadowSetScreenSize(int *w, int *h)
-{
-  poller -&gt; setScreenSize(w, h);
-}
-
-#endif
-
-void NXShadowDestroy()
-{
-  if (poller)
-  {
-    delete poller;
-
-    poller = NULL;
-  }
-
-  if (updateManager)
-  {
-    delete updateManager;
-
-    updateManager = NULL;
-  }
-
-  if (input)
-  {
-    delete input;
-
-    input = NULL;
-  }
-}
-
-void NXShadowHandleInput()
-{
-  logTrace(&quot;NXShadowHandleInput&quot;);
-
-  if (NXShadowNotInitialized())
-  {
-    logError(&quot;NXShadowHandleInput - NXShadow not properly initialized.&quot;, ESET(EBADFD));
-
-    return;
-  }
-
-  NXHandleException();
-
-  updateManager -&gt; handleInput();
-
-  poller -&gt; handleInput();
-}
-
-int NXShadowHasChanged(int (*callback)(void *), void *arg, int *suspended)
-{
-  int result;
-
-  logTrace(&quot;NXShadowHasChanged&quot;);
-
-  if (NXShadowNotInitialized())
-  {
-    logError(&quot;NXShadowHasChanged - NXShadow not properly initialized.&quot;, ESET(EBADFD));
-
-    return -1;
-  }
-
-  //
-  // FIXME
-  //updateManager -&gt; destroyUpdateManagerRegion();
-  //
-
-  updateManager -&gt; newRegion();
-
-#if !defined(__CYGWIN32__) &amp;&amp; !defined(WIN32)
-  poller -&gt; getEvents();
-#endif
-
-  result = poller -&gt; isChanged(callback, arg, suspended);
-
-  if (result == 1)
-  {
-    updateManager -&gt; addRegion(poller -&gt; lastUpdatedRegion());
-
-    return 1;
-  }
-  else if (result == -1)
-  {
-    logTest(&quot;NXShadowHasChanged&quot;, &quot;Scanline error.&quot;);
-    return -1;
-  }
-
-  return 0;
-}
-
-void NXShadowExportChanges(long *numRects, char **pBox)
-{
-  Region pReg;
-
-  logTrace(&quot;NXShadowExportChanges&quot;);
-
-  if (NXShadowNotInitialized())
-  {
-    logError(&quot;NXShadowExportChanges - NXShadow not properly initialized.&quot;, ESET(EBADFD));
-  }
-
-  updateManager -&gt; update();
-  pReg = updateManager -&gt; getUpdateManagerRegion();
-  *numRects = pReg -&gt; numRects;
-  *pBox = (char *)pReg -&gt; rects;
-
-  logTest(&quot;NXShadowExportChanges&quot;, &quot;numRects [%ld] pBox[%p], pReg-&gt;numRects[%ld], rects[%p], size[%lu]&quot;,
-              *numRects, *pBox, pReg -&gt; numRects, &amp;(pReg -&gt; rects -&gt; x2),
-                  (unsigned long) sizeof(pReg -&gt; rects -&gt; x2));
-}
-
-void NXShadowEvent(Display *display, XEvent event)
-{
-  poller -&gt; handleEvent(display, &amp;event);
-}
-
-void NXShadowWebKeyEvent(KeySym keysym, Bool isKeyPress)
-{
-  poller -&gt; handleWebKeyEvent(keysym, isKeyPress);
-}
-
-#ifdef __CYGWIN32__
-
-int NXShadowCaptureCursor(unsigned int wnd, void *vis)
-{
-  Window window = (Window)wnd;
-  Visual *visual = reinterpret_cast&lt;Visual*&gt;(vis);
-
-  logTrace(&quot;NXShadowCaptureCursor&quot;);
-
-  logTest(&quot;NXShadowCaptureCursor&quot;,&quot;Init&quot;);
-
-  return poller -&gt; updateCursor(window, visual);
-}
-
-#endif
-
-void NXShadowUpdateBuffer(void **buffer)
-{
-  char **fBuffer = reinterpret_cast&lt;char **&gt;(buffer);
-
-  if (*fBuffer != NULL)
-  {
-    poller -&gt; destroyFrameBuffer();
-
-    poller -&gt; init();
-  }
-
-  *fBuffer = poller -&gt; getFrameBuffer();
-
-  logTest(&quot;NXShadowUpdateBuffer&quot;,&quot;New frame buffer [0x%p]&quot;, (void *)*fBuffer);
-}
-
-void NXShadowInitKeymap(void *keysyms)
-{
-  NXShadowKeymap = (KeySymsPtr) keysyms;
-
-  logTest(&quot;NXShadowInitKeymap&quot;,&quot;KeySyms pointer [0x%p]&quot;, (void *)NXShadowKeymap);
-}
diff --git a/nxcompshad/Shadow.h b/nxcompshad/Shadow.h
deleted file mode 100644
index e1eddb9..0000000
--- a/nxcompshad/Shadow.h
+++ /dev/null
@@ -1,101 +0,0 @@
-/**************************************************************************/
-/*                                                                        */
-/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
-/*                                                                        */
-/* NXCOMPSHAD, NX protocol compression and NX extensions to this software */
-/* are copyright of NoMachine. Redistribution and use of the present      */
-/* software is allowed according to terms specified in the file LICENSE   */
-/* which comes in the source distribution.                                */
-/*                                                                        */
-/* Check <A HREF="http://www.nomachine.com/licensing.html">http://www.nomachine.com/licensing.html</A> for applicability.       */
-/*                                                                        */
-/* NX and NoMachine are trademarks of Medialogic S.p.A.                   */
-/*                                                                        */
-/* All rights reserved.                                                   */
-/*                                                                        */
-/**************************************************************************/
-
-#ifndef Shadow_H
-#define Shadow_H
-
-#include &lt;X11/Xlib.h&gt;
-
-#define NXShadowCorrectColor(length, buffer) \
-\
-{ \
-  unsigned short a; \
-  unsigned short b; \
-  unsigned short *shorts; \
-  int i; \
-\
-  length &gt;&gt;= 1; \
-  shorts = (unsigned short *)buffer; \
-  for (i = 0; i &lt; length ; i++) \
-  { \
-    a = shorts[i]; \
-\
-    b = a &amp; 63; \
-    a &lt;&lt;= 1; \
-    a = (a &amp; ~127) | b; \
-\
-    shorts[i] = a; \
-  } \
-}
-
-#ifdef __cplusplus
-extern &quot;C&quot; {
-#endif
-
-typedef char* UpdaterHandle;
-
-typedef struct _ShadowOptions
-{
-  char  optionShmExtension;
-  char  optionDamageExtension;
-  int   optionShadowDisplayUid;
-} ShadowOptions;
-
-extern ShadowOptions NXShadowOptions;
-
-extern int           NXShadowCreate(void *, char *, char *, void **);
-extern void          NXShadowDestroy(void);
-
-/*
- * Use an already opened Display connection.
- * We use &lt;void *&gt; instead of &lt;Display *&gt; to avoid
- * useless dependences from Xlib headers.
- */
-
-extern int NXShadowAddUpdaterDisplay(void *display, int *width, int *height,
-                                         unsigned char *depth);
-extern UpdaterHandle NXShadowAddUpdater(char *displayName);
-extern int           NXShadowRemoveUpdater(UpdaterHandle handle);
-extern int           NXShadowRemoveAllUpdaters(void);
-
-extern void          NXShadowHandleInput(void);
-extern int           NXShadowHasChanged(int (*)(void *), void *, int *);
-extern void          NXShadowExportChanges(long *, char **);
-extern int           NXShadowHasUpdaters(void);
-extern int           NXShadowCaptureCursor(unsigned int wnd, void *vis);
-extern void          NXShadowColorCorrect(int, int, unsigned int, unsigned int, char *);
-extern void          NXShadowUpdateBuffer(void **);
-
-extern void          NXShadowEvent(Display *, XEvent);
-extern void          NXShadowWebKeyEvent(KeySym keysym, Bool isKeyPress);
-
-extern void          NXShadowSetDisplayUid(int uid);
-
-extern void          NXShadowDisableShm(void);
-extern void          NXShadowDisableDamage(void);
-
-extern void          NXShadowGetScreenSize(int *width, int *height);
-extern void          NXShadowSetScreenSize(int *width, int *height);
-
-extern void          NXShadowInitKeymap(void *keysyms);
-
-#ifdef __cplusplus
-}
-#endif
-
-#endif /* Shadow_H */
-
diff --git a/nxcompshad/Updater.cpp b/nxcompshad/Updater.cpp
deleted file mode 100644
index 245c6ce..0000000
--- a/nxcompshad/Updater.cpp
+++ /dev/null
@@ -1,383 +0,0 @@
-/**************************************************************************/
-/*                                                                        */
-/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
-/*                                                                        */
-/* NXCOMPSHAD, NX protocol compression and NX extensions to this software */
-/* are copyright of NoMachine. Redistribution and use of the present      */
-/* software is allowed according to terms specified in the file LICENSE   */
-/* which comes in the source distribution.                                */
-/*                                                                        */
-/* Check <A HREF="http://www.nomachine.com/licensing.html">http://www.nomachine.com/licensing.html</A> for applicability.       */
-/*                                                                        */
-/* NX and NoMachine are trademarks of Medialogic S.p.A.                   */
-/*                                                                        */
-/* All rights reserved.                                                   */
-/*                                                                        */
-/**************************************************************************/
-
-#include &lt;X11/Xlib.h&gt;
-#include &lt;X11/Xutil.h&gt;
-#include &lt;X11/keysym.h&gt;
-#include &lt;string.h&gt;
-
-#define PANIC
-#define WARNING
-#undef  TEST
-#undef  DEBUG
-//
-#include &lt;stdio.h&gt;
-//
-#include &quot;Updater.h&quot;
-#include &quot;Logger.h&quot;
-
-Updater::Updater(char *displayName, Display *display)
-{
-  logTrace(&quot;Updater::Updater&quot;);
-
-  displayName_ = displayName;
-  display_ = display;
-  closeDisplay_ = false;
-  image_ = NULL;
-  updateRegion_ = NULL;
-  buffer_ = NULL;
-}
-
-Updater::~Updater()
-{
-  logTrace(&quot;Updater::~Updater&quot;);
-
-  if (input_)
-  {
-    int removedEvents = input_ -&gt; removeAllEvents(display_);
-
-    logTest(&quot;Updater::~Updater&quot;, &quot;Removed events in input queue is [%d].&quot;, removedEvents);
-  }
-
-  if (display_)
-  {
-    XDestroyWindow(display_, window_);
-    XFreePixmap(display_, pixmap_);
-
-    if (closeDisplay_)
-    {
-      XCloseDisplay(display_);
-    }
-  }
-
-  if (image_)
-  {
-    image_ -&gt; data = NULL;
-
-    XDestroyImage(image_);
-  }
-
-  if (updateRegion_)
-  {
-    XDestroyRegion(updateRegion_);
-  }
-}
-
-int Updater::init(int width, int height, char *fb, Input *input)
-{
-  logTrace(&quot;Updater::init&quot;);
-
-  if (fb == NULL || input == NULL || width &lt;= 0 || height &lt;= 0)
-  {
-    logError(&quot;Updater::init&quot;, ESET(EINVAL));
-
-    return -1;
-  }
-
-  width_ = width;
-  height_ = height;
-  buffer_ = fb;
-  input_ = input;
-/*
-  if (display_ == NULL)
-  {
-    display_ = XOpenDisplay(displayName_);
-
-    closeDisplay_ = true;
-
-    if (display_ == NULL)
-    {
-      logError(&quot;Updater::init&quot;, ESET(ENOMSG));
-
-      return -1;
-    }
-  }
-*/
-  depth_ = DefaultDepth(display_, DefaultScreen(display_));
-
-  if (depth_ == 8) bpl_ = width_;
-  else if (depth_ == 16) bpl_ = width_ * 2;
-  else bpl_ = width_ * 4;
-
-  logTest(&quot;Updater::init&quot;, &quot;Server geometry [%d, %d] depth [%d] bpl [%d].&quot;, width_, height_, depth_, bpl_);
-
-/*  int bitmap_pad = 8;
-
-  image_ = XCreateImage(display_, DefaultVisual(display_, DefaultScreen(display_)), depth_, ZPixmap, 0,
-                            buffer_, width_, height_, bitmap_pad, 0);
-
-  if (image_ == NULL)
-  {
-    logError(&quot;Updater::init&quot;, ESET(ENOMSG));
-
-    logTest(&quot;Updater::init&quot;, &quot;Failed to create default image.&quot;);
-
-    return -1;
-  }
-
-  pixmap_ = XCreatePixmap(display_, DefaultRootWindow(display_), width_, height_, depth_);
-
-  unsigned int mask = CWBackPixmap | CWBorderPixel | CWEventMask;
-
-  XSetWindowAttributes attributes;
-
-  attributes.background_pixmap = pixmap_;
-  attributes.border_pixel = WhitePixel(display_, DefaultScreen(display_));
-  attributes.event_mask = KeyPressMask | KeyReleaseMask | ButtonPressMask | ButtonReleaseMask;
-
-  window_ = XCreateWindow(display_, DefaultRootWindow(display_),
-                              0, 0, width_, height_, 0, depth_, InputOutput,
-                                  DefaultVisual(display_, DefaultScreen(display_)), mask, &amp;attributes);
-
-  if (window_ == None)
-  {
-    logError(&quot;Updater::init&quot;, ESET(ENOMSG));
-
-    return -1;
-  }
-
-  XSizeHints *size_hints;
-
-  if ((size_hints = XAllocSizeHints()) == NULL)
-  {
-    logError(&quot;Updater::init&quot;, ESET(ENOMEM));
-
-    return -1;
-  }
-
-  size_hints -&gt; flags = PMinSize | PMaxSize;
-  size_hints -&gt; min_width = width_;
-  size_hints -&gt; max_width = width_;
-  size_hints -&gt; min_height = height_;
-  size_hints -&gt; max_height = height_;
-
-  XSetWMNormalHints(display_, window_, size_hints);
-
-  XFree(size_hints);
-
-  Atom deleteWMatom = XInternAtom(display_, &quot;WM_DELETE_WINDOW&quot;, 1);
-
-  XSetWMProtocols(display_, window_, &amp;deleteWMatom, 1);
-
-  XMapWindow(display_, window_);*/
-
-  updateRegion_ = XCreateRegion();
-
-  logTest(&quot;Updater::init&quot;, &quot;updateRegion_[%p]&quot;, updateRegion_);
-  return 1;
-}
-
-void Updater::addRegion(Region region)
-{
-  //
-  // FIXME: Is this too paranoid ?
-  //
-
-  if (updateRegion_ == NULL)
-  {
-    logError(&quot;Updater::addRegion&quot;, ESET(EINVAL));
-
-    return;
-  }
-
-  XUnionRegion(region, updateRegion_, updateRegion_);
-}
-
-void Updater::update()
-{
-  logTrace(&quot;Updater::update&quot;);
-
-  if (updateRegion_ == NULL)
-  {
-    logError(&quot;Updater::update&quot;, ESET(EINVAL));
-
-    return;
-  }
-
-  logTest(&quot;Updater::update&quot;, &quot;Number of rectangles [%ld].&quot;, updateRegion_ -&gt; numRects);
-
-/*  for (; updateRegion_ -&gt; numRects &gt; 0; updateRegion_ -&gt; numRects--)
-  {
-    int n = updateRegion_ -&gt; numRects - 1;
-
-    int x = updateRegion_ -&gt; rects[n].x1;
-    int y = updateRegion_ -&gt; rects[n].y1;
-    unsigned int width = updateRegion_ -&gt; rects[n].x2 - updateRegion_ -&gt; rects[n].x1;
-    unsigned int height = updateRegion_ -&gt; rects[n].y2 - updateRegion_ -&gt; rects[n].y1;
-
-    logDebug(&quot;Updater::update&quot;, &quot;Sending rectangle: [%d, %d, %d, %d].&quot;, x, y, width, height);
-
-    //
-    // We need to update the extents.
-    //
-
-    int bitmap_pad;
-
-    if (depth_ == 32 || depth_ == 24)
-    {
-      bitmap_pad = 32;
-    }
-    else if (depth_ == 16)
-    {
-      if ((width &amp; 1) == 0)
-      {
-        bitmap_pad = 32;
-      }
-      else
-      {
-        bitmap_pad = 16;
-      }
-    }
-    else if ((width &amp; 3) == 0)
-    {
-      bitmap_pad = 32;
-    }
-    else if ((width &amp; 1) == 0)
-    {
-      bitmap_pad = 16;
-    }
-    else
-    {
-      bitmap_pad = 8;
-    }*/
-
-/*    image_ -&gt; bitmap_pad = bitmap_pad;*/
-
-   /* NXShadowCorrectColor(x, y, width, height);*/
-
-/*    XPutImage(display_, pixmap_, DefaultGC(display_, DefaultScreen(display_)),
-                  image_, x, y, x, y, width, height);
-
-    XClearArea(display_, window_, x, y, width, height, 0);
-  }*/
-
-  //
-  // Should we reduces the box vector ?
-  //
-  // BOX *box = Xrealloc(updateRegion_ -&gt; rects,
-  //                         updateRegion_ -&gt; numRects == 0 ? sizeof(BOX) :
-  //                             updateRegion_ -&gt; numRects * sizeof(BOX));
-  //
-  // if (box)
-  // {
-  //   updateRegion_ -&gt; rects = box;
-  //   updateRegion_ -&gt; size = 1;
-  // }
-  //
-
-  if (updateRegion_ -&gt; numRects == 0)
-  {
-    updateRegion_ -&gt; extents.x1 = 0;
-    updateRegion_ -&gt; extents.y1 = 0;
-    updateRegion_ -&gt; extents.x2 = 0;
-    updateRegion_ -&gt; extents.y2 = 0;
-  }
-  else
-  {
-    //
-    // FIXME: We have to update the region extents.
-    //
-
-    logTest(&quot;Updater::update&quot;, &quot;Region extents has not been updated.&quot;);
-  }
-}
-
-void Updater::handleInput()
-{
-  logTrace(&quot;Updater::handleInput&quot;);
-
-  XEvent *event = new XEvent;
-
-  if (event == NULL)
-  {
-    logError(&quot;Updater::handleInput&quot;, ESET(ENOMEM));
-
-    return;
-  }
-
-  while (XCheckIfEvent(display_, event, anyEventPredicate, NULL))
-  {
-    switch (event -&gt; type)
-    {
-     /* case ClientMessage:
-      {
-        Atom wmProtocols = XInternAtom(display_, &quot;WM_PROTOCOLS&quot;, 0);
-        Atom wmDeleteWindow = XInternAtom(display_, &quot;WM_DELETE_WINDOW&quot;, 0);
-
-        if (event -&gt; xclient.message_type == wmProtocols &amp;&amp;
-                (Atom)event -&gt; xclient.data.l[0] == wmDeleteWindow)
-        {
-          logTest(&quot;Updater::handleInput&quot;, &quot;Got client message of type WM_PROTOCOLS and value WM_DELETE_WINDOW,&quot;
-                      &quot; throwing exception UpdaterClosing.&quot;);
-
-          delete event;
-
-          throw UpdaterClosing();
-        }
-        else
-        {
-          logTest(&quot;Updater::handleInput&quot;, &quot;Unexpected client message type [%ld] format [%d] first value [%ld]&quot;,
-                      event -&gt; xclient.message_type, event -&gt; xclient.format, event -&gt; xclient.data.l[0]);
-        }
-
-        break;
-      }*/
-      case KeyPress:
-      case KeyRelease:
-      case ButtonPress:
-      case ButtonRelease:
-      case MotionNotify:
-      {
-        input_ -&gt; pushEvent(display_, event);
-
-        event = new XEvent;
-
-        if (event == NULL)
-        {
-          logError(&quot;Updater::handleInput&quot;, ESET(ENOMEM));
-
-          return;
-        }
-
-        break;
-      }
-      default:
-      {
-        logTest(&quot;Updater::handleInput&quot;, &quot;Handling unexpected event [%d].&quot;, event -&gt; type);
-
-        break;
-      }
-    }
-  }
-
-  delete event;
-}
-
-void Updater::newRegion()
-{
-  if (updateRegion_ != NULL)
-  {
-    XDestroyRegion(updateRegion_);
-  }
-
-  updateRegion_ = XCreateRegion();
-
-  logTest(&quot;Updater::newRegion&quot;, &quot;updateRegion_ [%p].&quot;, updateRegion_);
-}
-//
-// Private functions.
-//
diff --git a/nxcompshad/Updater.h b/nxcompshad/Updater.h
deleted file mode 100644
index daa26c1..0000000
--- a/nxcompshad/Updater.h
+++ /dev/null
@@ -1,95 +0,0 @@
-/**************************************************************************/
-/*                                                                        */
-/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
-/*                                                                        */
-/* NXCOMPSHAD, NX protocol compression and NX extensions to this software */
-/* are copyright of NoMachine. Redistribution and use of the present      */
-/* software is allowed according to terms specified in the file LICENSE   */
-/* which comes in the source distribution.                                */
-/*                                                                        */
-/* Check <A HREF="http://www.nomachine.com/licensing.html">http://www.nomachine.com/licensing.html</A> for applicability.       */
-/*                                                                        */
-/* NX and NoMachine are trademarks of Medialogic S.p.A.                   */
-/*                                                                        */
-/* All rights reserved.                                                   */
-/*                                                                        */
-/**************************************************************************/
-
-#ifndef Updater_H
-#define Updater_H
-
-#include &lt;X11/Xlib.h&gt;
-
-#include &quot;Regions.h&quot;
-#include &quot;Input.h&quot;
-
-class UpdaterClosing {};
-
-class Updater
-{
-  public:
-
-  Updater(char *displayName, Display *display);
-
-  ~Updater();
-
-  int init(int, int, char *, Input*);
-
-  void addRegion(Region r);
-
-  void update();
-
-  void handleInput();
-
-  XImage *getImage();
-
-  Region getUpdateRegion();
-
-  void newRegion();
-
-  private:
-
-  Input *input_;
-
-  static inline Bool anyEventPredicate(Display*, XEvent*, XPointer);
-
-  void handleKeyboardEvent(XEvent &amp;event);
-
-  char *displayName_;
-
-  char *buffer_;
-
-  bool closeDisplay_;
-
-  Display *display_;
-
-  int depth_;
-
-  int width_;
-  int height_;
-
-  int bpl_;
-
-  Window window_;
-  XImage *image_;
-
-  Pixmap pixmap_;
-
-  Region updateRegion_;
-
-};
-
-Bool Updater::anyEventPredicate(Display*, XEvent*, XPointer)
-{
-  return true;
-}
-
-inline XImage* Updater::getImage()
-{
-  return image_;
-}
-inline Region Updater::getUpdateRegion()
-{
-  return updateRegion_;
-}
-#endif /* Updater_H */
diff --git a/nxcompshad/VERSION b/nxcompshad/VERSION
deleted file mode 100644
index 1545d96..0000000
--- a/nxcompshad/VERSION
+++ /dev/null
@@ -1 +0,0 @@
-3.5.0
diff --git a/nxcompshad/Win.cpp b/nxcompshad/Win.cpp
deleted file mode 100644
index 481cbca..0000000
--- a/nxcompshad/Win.cpp
+++ /dev/null
@@ -1,1137 +0,0 @@
-/**************************************************************************/
-/*                                                                        */
-/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
-/*                                                                        */
-/* NXCOMPSHAD, NX protocol compression and NX extensions to this software */
-/* are copyright of NoMachine. Redistribution and use of the present      */
-/* software is allowed according to terms specified in the file LICENSE   */
-/* which comes in the source distribution.                                */
-/*                                                                        */
-/* Check <A HREF="http://www.nomachine.com/licensing.html">http://www.nomachine.com/licensing.html</A> for applicability.       */
-/*                                                                        */
-/* NX and NoMachine are trademarks of Medialogic S.p.A.                   */
-/*                                                                        */
-/* All rights reserved.                                                   */
-/*                                                                        */
-/**************************************************************************/
-
-#if defined(__CYGWIN32__) || defined(WIN32)
-
-#include &lt;X11/keysym.h&gt;
-
-#define PANIC
-#define WARNING
-#undef  TEST
-#undef  DEBUG
-
-#include &quot;Poller.h&quot;
-#include &quot;Logger.h&quot;
-
-Poller::Poller(Input *input, Display *display, int depth) : CorePoller(input, display)
-{
-  logTrace(&quot;Poller::Poller&quot;);
-
-  screenDC_ = NULL;
-  screenBmp_ = NULL;
-  memoryDC_ = NULL;
-  pDIBbits_ = NULL;
-  DIBBuffer_ = NULL;
-  pKey_ = NULL;
-  pMouse_ = NULL;
-  path_ = NULL;
-  keymapName_ = input -&gt; getKeymap();
-  keymap_ = NULL;
-  toggleButtonState_ = 0;
-  serverModifierState_ = 0;
-  display_ = display;
-  depth_ = DefaultDepth(display_, DefaultScreen(display_));
-  oldCursor_ = 0;
-  xCursor_ = 0;
-}
-
-Poller::~Poller()
-{
-  logTrace(&quot;Poller::~Poller&quot;);
-
-  if (screenDC_)
-  {
-    BOOL result = ReleaseDC(NULL, screenDC_);
-
-    logTest(&quot;Poller::~Poller&quot;, &quot;ReleaseDC returned [%d].&quot;, result);
-
-    screenDC_ = NULL;
-  }
-
-  if (memoryDC_)
-  {
-    BOOL result = DeleteDC(memoryDC_);
-
-    logTest(&quot;Poller::~Poller&quot;, &quot;DeleteDC returned [%d].&quot;, result);
-
-    memoryDC_ = NULL;
-  }
-
-  if (screenBmp_)
-  {
-    BOOL result = DeleteObject(screenBmp_);
-
-    logTest(&quot;Poller::~Poller&quot;, &quot;DeleteObject returned [%d].&quot;, result);
-
-    screenBmp_ = NULL;
-  }
-
-  if (DIBBuffer_)
-  {
-    logDebug(&quot;Poller::~Poller&quot;, &quot;Delete DIBBuffer_ [%p].&quot;, DIBBuffer_);
-
-    delete [] DIBBuffer_;
-  }
-
-  if (pKey_)
-  {
-    logDebug(&quot;Poller::~Poller&quot;, &quot; pKey_[%p].&quot;, pKey_);
-
-    delete [] pKey_;
-  }
-
-  if (pMouse_)
-  {
-    logDebug(&quot;Poller::~Poller&quot;, &quot; pMouse_[%p].&quot;, pMouse_);
-
-    delete [] pMouse_;
-  }
-
-  if (keymap_)
-  {
-    logDebug(&quot;Poller::~Poller&quot;, &quot; keymap_[%p].&quot;, keymap_);
-
-    delete [] keymap_;
-  }
-}
-
-int Poller::init()
-{
-  logTrace(&quot;Poller::init&quot;);
-
-  int maxLengthArrayINPUT = 6;
-
-  platformOS();
-
-  pKey_ = new INPUT [maxLengthArrayINPUT];
-
-  if (pKey_ == NULL)
-  {
-    logError(&quot;Poller::init&quot;, ESET(ENOMEM));
-
-    return -1;
-  }
-
-  for (int i = 0; i &lt; maxLengthArrayINPUT; i++)
-  {
-    pKey_[i].type = INPUT_KEYBOARD;
-    pKey_[i].ki.wVk = (WORD) 0;
-    pKey_[i].ki.time = (DWORD) 0;
-    pKey_[i].ki.dwExtraInfo = (DWORD) 0;
-  }
-
-  pMouse_ = new INPUT;
-
-  if (pMouse_ == NULL)
-  {
-    logError(&quot;Poller::init&quot;, ESET(ENOMEM));
-
-    return -1;
-  }
-
-  pMouse_ -&gt; type = INPUT_MOUSE;
-
-  pMouse_ -&gt; mi.dx = 0;
-  pMouse_ -&gt; mi.dy = 0;
-  pMouse_ -&gt; mi.mouseData = (DWORD) 0;
-  pMouse_ -&gt; mi.time = 0;
-  pMouse_ -&gt; mi.dwExtraInfo = (ULONG_PTR) NULL;
-
-  screenDC_ = GetDC(NULL);
-
-  if (screenDC_ == NULL)
-  {
-    logError(&quot;Poller::init&quot;, ESET(ENOMSG));
-
-    return -1;
-  }
-
-  switch(depth_)
-  {
-    case 8:
-    {
-      depth_ = 16;
-      break;
-    }
-    case 16:
-    {
-      depth_ = 16;
-      break;
-    }
-    case 24:
-    {
-      depth_ = 32;
-      break;
-    }
-    default:
-    {
-      logError(&quot;Poller::init&quot;, ESET(EINVAL));
-
-      return -1;
-    }
-  }
-
-  width_ = GetDeviceCaps(screenDC_, HORZRES);
-  height_ = GetDeviceCaps(screenDC_, VERTRES);
-
-  bpl_ = width_ * (depth_ &gt;&gt; 3);
-  bpp_ = (depth_ &gt;&gt; 3);
-
-  logTest(&quot;Poller::init&quot;, &quot;Screen geometry is [%d, %d] depth is [%d] bpl [%d] bpp [%d].&quot;,
-              width_, height_, depth_, bpl_, bpp_);
-
-  logTest(&quot;Poller::init&quot;, &quot;Got device context at [%p] screen size is (%d,%d).&quot;,
-            screenDC_, width_, height_);
-
-  memoryDC_ = CreateCompatibleDC(screenDC_);
-
-  if (memoryDC_ == NULL)
-  {
-    logError(&quot;Poller::init&quot;, ESET(ENOMSG));
-
-    return -1;
-  }
-
-  //
-  // Delete the old bitmap for the memory device.
-  //
-
-  HBITMAP bitmap = (HBITMAP) GetCurrentObject(memoryDC_, OBJ_BITMAP);
-
-  if (bitmap &amp;&amp; DeleteObject(bitmap) == 0)
-  {
-    logError(&quot;Poller::init&quot;, ESET(ENOMSG));
-  }
-
-  //
-  // Bitmap header describing the bitmap we want to get from GetDIBits.
-  //
-
-  bmi_.bmiHeader.biSize          = sizeof(BITMAPINFOHEADER);
-  bmi_.bmiHeader.biWidth         = width_;
-  bmi_.bmiHeader.biHeight        = -height_;
-  bmi_.bmiHeader.biPlanes        = 1;
-  bmi_.bmiHeader.biBitCount      = depth_;
-  bmi_.bmiHeader.biCompression   = BI_RGB;
-  bmi_.bmiHeader.biSizeImage     = 0;
-  bmi_.bmiHeader.biXPelsPerMeter = 0;
-  bmi_.bmiHeader.biYPelsPerMeter = 0;
-  bmi_.bmiHeader.biClrUsed       = 0;
-  bmi_.bmiHeader.biClrImportant  = 0;
-
-  screenBmp_ = CreateDIBSection(memoryDC_, &amp;bmi_, DIB_RGB_COLORS, &amp;pDIBbits_, NULL, 0);
-  ReleaseDC(NULL,memoryDC_);
-
-  if (screenBmp_ == NULL)
-  {
-    logTest (&quot;Poller::init&quot;, &quot;This video device is not supporting DIB section&quot;);
-
-    pDIBbits_ = NULL;
-
-    screenBmp_ = CreateCompatibleBitmap(screenDC_, width_, height_);
-
-    if (screenBmp_ == NULL)
-    {
-      logError(&quot;Poller::init&quot;, ESET(ENOMSG));
-
-      return -1;
-    }
-
-    if (SelectObject(memoryDC_, screenBmp_) == NULL)
-    {
-      logError(&quot;Poller::init&quot;, ESET(ENOMSG));
-
-      return -1;
-    }
-  }
-  else
-  {
-    logTest (&quot;Poller::init&quot;, &quot;Enabled the DIB section&quot;);
-
-    if (SelectObject(memoryDC_, screenBmp_) == NULL)
-    {
-      logError(&quot;Poller::init&quot;, ESET(ENOMSG));
-
-      return -1;
-    }
-  }
-
-  //
-  // Check if the screen device raster capabilities
-  // support the bitmap transfer.
-  //
-
-  if ((GetDeviceCaps(screenDC_, RASTERCAPS) &amp; RC_BITBLT) == 0)
-  {
-    logTest(&quot;Poller::init&quot;, &quot;This video device is not supporting the bitmap transfer.&quot;);
-
-    logError(&quot;Poller::init&quot;, ESET(ENOMSG));
-
-    return -1;
-  }
-
-  //
-  // Check if the memory device raster capabilities
-  // support the GetDIBits and SetDIBits functions.
-  //
-
-  if ((GetDeviceCaps(memoryDC_, RASTERCAPS) &amp; RC_DI_BITMAP) == 0)
-  {
-    logTest(&quot;Poller::init&quot;, &quot;This memory device is not supporting the GetDIBits and SetDIBits &quot;
-               &quot;function.&quot;);
-
-    logError(&quot;Poller::init&quot;, ESET(ENOMSG));
-
-    return -1;
-  }
-
-  if (GetDeviceCaps(screenDC_, PLANES) != 1)
-  {
-    logTest(&quot;Poller::init&quot;, &quot;This video device has more than 1 color plane.&quot;);
-
-    logError(&quot;Poller::init&quot;, ESET(ENOMSG));
-
-    return -1;
-  }
-
-  return CorePoller::init();
-}
-
-//
-// FIXME: Remove me.
-//
-
-void ErrorExit(LPTSTR lpszFunction)
-{
-    LPVOID lpMsgBuf;
-    DWORD dw = GetLastError();
-
-    FormatMessage(
-        FORMAT_MESSAGE_ALLOCATE_BUFFER |
-        FORMAT_MESSAGE_FROM_SYSTEM,
-        NULL,
-        dw,
-        MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT),
-        (LPTSTR) &amp;lpMsgBuf,
-        0, NULL );
-
-    logTest(lpszFunction, &quot; Failed with error [%ld]: %s&quot;, dw, (char*)lpMsgBuf);
-
-    LocalFree(lpMsgBuf);
-    ExitProcess(dw);
-}
-
-//
-// FIXME: End.
-//
-
-char *Poller::getRect(XRectangle r)
-{
-  logTrace(&quot;Poller::getRect&quot;);
-
-  logDebug(&quot;Poller::getRect&quot;, &quot;Going to retrive rectangle [%d, %d, %d, %d].&quot;,
-              r.x, r.y, r.width, r.height);
-
-  //
-  // The CAPTUREBLT operation could be a very
-  // cpu-consuming task. We should make some
-  // test to see how much it is expensive.
-  // Anyway we get tooltip windows and any
-  // other special effect not included with
-  // only the SRCCOPY operation.
-  //
-
-  if (BitBlt(memoryDC_, r.x, r.y, r.width, r.height,
-                 screenDC_, r.x, r.y, SRCCOPY | CAPTUREBLT) == 0)
-  {
-    logError(&quot;Poller::getRect&quot;, ESET(ENOMSG));
-
-    logTest(&quot;Poller::getRect&quot;, &quot;Failed to perform a bit-block transfer.&quot;);
-    logTest(&quot;Poller::getRect&quot;, &quot;bit-block error=%lu&quot;, GetLastError());
-
-    return NULL;
-  }
-
-  // bmi_.bmiHeader.biWidth = r.width;
-  // bmi_.bmiHeader.biHeight = -r.height;
-
-  if (pDIBbits_ == NULL)
-  {
-    static long nPixel = 0;
-
-    if (nPixel &lt; r.width * r.height)
-    {
-
-      if (DIBBuffer_)
-      {
-        delete [] DIBBuffer_;
-      }
-
-      nPixel = r.width * r.height;
-
-      DIBBuffer_ = new char [nPixel * bpp_];
-
-      if (DIBBuffer_ == NULL)
-      {
-        logError(&quot;Poller::getRect&quot;, ESET(ENOMEM));
-
-        nPixel = 0;
-
-        return NULL;
-      }
-    }
-
-    if (GetDIBits(memoryDC_, screenBmp_, height_ - r.height - r.y, r.height,
-                      DIBBuffer_, &amp;bmi_, DIB_RGB_COLORS) == 0)
-    {
-      logError(&quot;Poller::getRect&quot;, ESET(ENOMSG));
-
-      logTest(&quot;Poller::getRect&quot;, &quot;Failed to retrieve the screen bitmap.&quot;);
-
-      return NULL;
-    }
-
-    return DIBBuffer_;
-  }
-  else
-  {
-    return (char *) pDIBbits_ + r.y * bpl_ + r.x * bpp_;
-  }
-}
-
-void Poller::handleKeyboardEvent(Display *display, XEvent *event)
-{
-  KeySym keysym;
-  char *keyname = new char [31];
-  keyTranslation tr = {0, 0};
-  unsigned char scancode = 0;
-  int lengthArrayINPUT = 0;
-
-  if (XLookupString((XKeyEvent *) event, keyname, 30, &amp;keysym, NULL) &gt; 0)
-  {
-    logTest(&quot;Poller::handleKeyboardEvent&quot;, &quot;keyname %s, keysym [%x]&quot;, keyname, (unsigned int)keysym);
-  }
-
-  if (specialKeys(keysym, event -&gt; xkey.state, event -&gt; type) == 1)
-  {
-    delete[] keyname;
-    return;
-  }
-
-  tr = xkeymapTranslateKey(keysym, event -&gt; xkey.keycode, event -&gt; xkey.state);
-  scancode = tr.scancode;
-
-  logTest(&quot;Poller::handleKeyboardEvent&quot;, &quot;keyname [%s] scancode [0x%x], keycode[0x%x], keysym [%x]&quot;, keyname,
-              tr.scancode, event -&gt;xkey.keycode, (unsigned int)keysym);
-
-  if (scancode == 0)
-  {
-    delete[] keyname;
-    return;
-  }
-
-  if (event -&gt; type == KeyPress)
-  {
-    int test1 = MapVirtualKey(scancode, MAPVK_VSC_TO_VK_EX);
-    int test2 = MapVirtualKey(0x24, MAPVK_VSC_TO_VK_EX);
-
-    if (test1 == test2)
-    {
-      simulateCtrlAltDel();
-    }
-
-    if (isModifier(scancode) == 0)
-    {
-      savedServerModifierState_ = serverModifierState_;
-    }
-
-    ensureServerModifiers(tr, &amp;lengthArrayINPUT);
-    if (sendInput(scancode, 1, &amp;lengthArrayINPUT) == 0)
-    {
-      logTest(&quot;Poller::handleKeyboardEvent&quot;, &quot;lengthArrayINPUT [%d].&quot;, lengthArrayINPUT);
-    }
-    restoreServerModifiers(scancode);
-  }
-  else if (event -&gt; type == KeyRelease)
-  {
-    if (sendInput(scancode, 0, &amp;lengthArrayINPUT) == 0)
-    {
-      logTest(&quot;Poller::handleKeyboardEvent&quot;, &quot;lengthArrayINPUT [%d].&quot;, lengthArrayINPUT);
-    }
-  }
-
-  updateModifierState(scancode, (event -&gt; type == KeyPress));
-
-  delete[] keyname;
-}
-
-void Poller::handleWebKeyboardEvent(KeySym keysym, Bool isKeyPress)
-{
-/*
-FIXME
-*/
-}
-
-void Poller::handleMouseEvent(Display *display, XEvent *event)
-{
-  DWORD flg = 0;
-  DWORD whl = 0;
-
-  if (event -&gt; type == ButtonPress)
-  {
-    logTest(&quot;Poller::handleMouseEvent&quot;, &quot;ButtonPress.\n&quot;);
-    switch (event -&gt; xbutton.button)
-    {
-      case Button1:
-      {
-        flg = MOUSEEVENTF_LEFTDOWN;
-        break;
-      }
-      case Button2:
-      {
-        flg = MOUSEEVENTF_MIDDLEDOWN;
-        break;
-      }
-      case Button3:
-      {
-        flg = MOUSEEVENTF_RIGHTDOWN;
-        break;
-      }
-      case Button4:
-      {
-        flg = MOUSEEVENTF_WHEEL;
-        whl = WHEEL_DELTA;
-        pMouse_ -&gt; mi.mouseData = whl;
-        break;
-      }
-      case Button5:
-      {
-        flg = MOUSEEVENTF_WHEEL;
-        whl = (DWORD) (-WHEEL_DELTA);
-        pMouse_ -&gt; mi.mouseData = whl;
-        break;
-      }
-    }
-  }
-  else if (event -&gt; type == ButtonRelease)
-  {
-    switch (event -&gt; xbutton.button)
-    {
-      case Button1:
-      {
-        flg = MOUSEEVENTF_LEFTUP;
-        break;
-      }
-      case Button2:
-      {
-        flg = MOUSEEVENTF_MIDDLEUP;
-        break;
-      }
-      case Button3:
-      {
-        flg = MOUSEEVENTF_RIGHTUP;
-        break;
-      }
-      case Button4:
-      {
-        flg = MOUSEEVENTF_WHEEL;
-        whl = 0;
-        pMouse_ -&gt; mi.mouseData = whl;
-        break;
-      }
-      case Button5:
-      {
-        flg = MOUSEEVENTF_WHEEL;
-        whl = 0;
-        pMouse_ -&gt; mi.mouseData = whl;
-        break;
-      }
-    }
-  }
-  else if (event -&gt; type == MotionNotify)
-  {
-    logTest(&quot;Poller::handleMouseEvent&quot;, &quot;SetCursor - MotionNotify&quot;);
-
-    SetCursorPos(event -&gt; xmotion.x, event -&gt; xmotion.y);
-  }
-
-  if (flg &gt; 0)
-  {
-  //  logTest(&quot;Poller::handleMouseEvent&quot;, &quot;SetCursor - flg &gt; 0&quot;);
-    //
-    // FIXME: move the cursor to the pace the event occurred
-    //
-
-    SetCursorPos(event -&gt; xbutton.x, event -&gt; xbutton.y);
-
-    //
-    // FIXME: Remove me: send the click/release event
-    // mouse_event(flg, 0, 0, whl, (ULONG_PTR)NULL);
-    //
-
-    pMouse_ -&gt; mi.dwFlags = flg;
-
-    if (SendInput(1, pMouse_, sizeof(INPUT)) == 0)
-    {
-      logTest(&quot;Poller::handleMouseEvent&quot;, &quot;Failed SendInput&quot;);
-    }
-  }
-}
-
-int Poller::updateCursor(Window wnd, Visual* vis)
-{
-  BYTE *mBits, *andBits, *xorBits;
-
-  logTrace(&quot;Poller::Cursor&quot;);
-
-  //
-  // Retrieve mouse cursor handle.
-  //
-
-  CURSORINFO cursorInfo;
-  cursorInfo.cbSize = sizeof(CURSORINFO);
-
-  if (GetCursorInfo(&amp;cursorInfo) == 0)
-  {
-    logTest(&quot;Poller::Cursor&quot;, &quot;GetCursorInfo() failed [%u].\n&quot;, (unsigned int)GetLastError());
-    LocalFree(&amp;cursorInfo);
-    return -1;
-  }
-
-  HCURSOR hCursor = cursorInfo.hCursor;
-
-  if (hCursor == 0)
-  {
-    logTest(&quot;Poller::Cursor&quot;,&quot;Cursor Handle is NULL. Error[%u].\n&quot;, (unsigned int)GetLastError());
-    return 1;
-  }
-
-  if (hCursor == oldCursor_)
-  {
-    LocalFree(&amp;cursorInfo);
-    return 1;
-  }
-  else
-  {
-    oldCursor_ = hCursor;
-  }
-
-  //
-  // Get cursor info.
-  //
-
-  //  logTest(&quot;Poller::Cursor&quot;,&quot;hCursor [%xH] GetCursor [%xH].\n&quot;, hCursor, GetCursor());
-
-  ICONINFO iconInfo;
-  if (GetIconInfo(hCursor, &amp;iconInfo) == 0)
-  {
-    logTest(&quot;Poller::Cursor&quot;,&quot;GetIconInfo() failed. Error[%d].&quot;, (unsigned int)GetLastError());
-    LocalFree(&amp;iconInfo);
-    //    return -1;
-  }
-
-  BOOL isColorCursor = FALSE;
-  if (iconInfo.hbmColor != NULL)
-  {
-    isColorCursor = TRUE;
-  }
-
-  if (iconInfo.hbmMask == NULL)
-  {
-    logTest(&quot;Poller::Cursor&quot;,&quot;Cursor bitmap handle is NULL.\n&quot;);
-    return -1;
-  }
-
-  //
-  // Check bitmap info for the cursor
-  //
-
-  BITMAP bmMask;
-  if (!GetObject(iconInfo.hbmMask, sizeof(BITMAP), (LPVOID)&amp;bmMask))
-  {
-    logTest(&quot;Poller::Cursor&quot;,&quot;GetObject() for bitmap failed.\n&quot;);
-    DeleteObject(iconInfo.hbmMask);
-    LocalFree(&amp;bmMask);
-    return -1;
-  }
-
-  if (bmMask.bmPlanes != 1 || bmMask.bmBitsPixel != 1)
-  {
-    logTest(&quot;Poller::Cursor&quot;,&quot;Incorrect data in cursor bitmap.\n&quot;);
-    LocalFree(&amp;bmMask);
-    DeleteObject(iconInfo.hbmMask);
-    return -1;
-  }
-
-  // Get monochrome bitmap data for cursor
-  // NOTE: they say we should use GetDIBits() instead of GetBitmapBits().
-  mBits = new BYTE[bmMask.bmWidthBytes * bmMask.bmHeight];
-
-  if (mBits == NULL)//Data bitmap
-  {
-    DeleteObject(iconInfo.hbmMask);
-    DestroyCursor(cursorInfo.hCursor);
-    LocalFree(&amp;iconInfo);
-    LocalFree(&amp;bmMask);
-    delete[] mBits;
-    return -1;
-  }
-
-  BOOL success = GetBitmapBits(iconInfo.hbmMask, bmMask.bmWidthBytes * bmMask.bmHeight, mBits);
-
-  if (!success)
-  {
-    logTest(&quot;Poller::Cursor&quot;,&quot;GetBitmapBits() failed.\n&quot;);
-    delete[] mBits;
-    return -1;
-  }
-
-  andBits = mBits;
-
-  long width = bmMask.bmWidth;
-  long height = (isColorCursor) ? bmMask.bmHeight : bmMask.bmHeight/2;
-
-  //
-  // The bitmask is formatted so that the upper half is
-  // the icon AND bitmask and the lower half is the icon XOR bitmask.
-  //
-
-  if (!isColorCursor)
-  {
-    xorBits = andBits + bmMask.bmWidthBytes * height;
-
-/*    logTest(&quot;Poller::Cursor&quot;,&quot;no color widthB[%ld] width[%ld] height[%ld] totByte[%ld] mbits[%ld].\n&quot;,
-                 bmMask.bmWidthBytes,width,height,success,bmMask.bmHeight * bmMask.bmWidthBytes);*/
-
-    if (xCursor_ &gt; 0)
-    {
-      XFreeCursor(display_, xCursor_);
-    }
-
-    xCursor_ = createCursor(wnd, vis, (unsigned int)iconInfo.xHotspot, (unsigned int)iconInfo.yHotspot,
-                    width, height, (unsigned char *)xorBits, (unsigned char *)andBits);
-
-    XDefineCursor(display_, wnd, xCursor_);
-  }
-
-  delete []mBits;
-  DeleteObject(iconInfo.hbmMask);
-  LocalFree(&amp;bmMask);
-  DestroyCursor(cursorInfo.hCursor);
-  LocalFree(&amp;iconInfo);
-
-  return success;
-}
-
-unsigned char Poller::specialKeys(unsigned int keysym, unsigned int state, int pressed)
-{
-  return 0;
-}
-
-void Poller::ensureServerModifiers(keyTranslation tr, int *lengthArrayINPUT)
-{
-  return;
-}
-
-void Poller::restoreServerModifiers(UINT scancode)
-{
-  keyTranslation dummy;
-  int lengthArrayINPUT = 0;
-
-  if (isModifier(scancode) == 1)
-  {
-    return;
-  }
-
-  dummy.scancode = 0;
-  dummy.modifiers = savedServerModifierState_;
-  ensureServerModifiers(dummy, &amp;lengthArrayINPUT);
-  if (sendInput(0, 0, &amp;lengthArrayINPUT) == 0)
-  {
-    logTest(&quot;Poller::restoreServerModifiers&quot;, &quot;lengthArrayINPUT [%d]&quot;, lengthArrayINPUT);
-  }
-}
-
-int Poller::updateShadowFrameBuffer(void)
-{
-  return 1;
-}
-
-void Poller::addToKeymap(char *keyname, unsigned char scancode, unsigned short modifiers, char *mapname)
-{
-  return;
-}
-
-FILE *Poller::xkeymapOpen(char *filename)
-{
-  return NULL;
-}
-
-int Poller::xkeymapRead(char *mapname)
-{
-  return 1;
-}
-
-void Poller::xkeymapInit(char *keyMapName)
-{
-  return;
-}
-
-keyTranslation Poller::xkeymapTranslateKey(unsigned int keysym, unsigned int keycode,
-                                               unsigned int state)
-{
-  keyTranslation tr = { 0, 0 };
-
-  return tr;
-}
-
-unsigned char Poller::getKeyState(unsigned int state, unsigned int keysym)
-{
-  return 0;
-}
-
-char *Poller::getKsname(unsigned int keysym)
-{
-        char *ksname = NULL;
-
-        return ksname;
-}
-
-//
-// Routine used to fool Winlogon into thinking CtrlAltDel was pressed
-//
-char Poller::simulateCtrlAltDel(void)
-{
-  HDESK oldDesktop = GetThreadDesktop(GetCurrentThreadId());
-
-  //
-  // Switch into the Winlogon desktop.
-  //
-  if (selectDesktopByName(&quot;Winlogon&quot;) == 0)
-  {
-    logTest(&quot;SimulateCtrlAltDelThreadFn&quot;,&quot;Failed to select logon desktop.&quot;);
-    return 0;
-  }
-
-  logTest(&quot;SimulateCtrlAltDelThreadFn&quot;,&quot;Generating ctrl-alt-del.&quot;);
-
-  //
-  // Winlogon uses hotkeys to trap Ctrl-Alt-Del.
-  //
-  PostMessage(HWND_BROADCAST, WM_HOTKEY, 0, MAKELONG(MOD_ALT | MOD_CONTROL, VK_DELETE));
-
-  //
-  // Switch back to our original desktop.
-  //
-  if (oldDesktop != NULL)
-  {
-    selectDesktop(oldDesktop);
-  }
-
-  return 1;
-}
-
-// Switches the current thread into a different desktop by desktop handle
-// This call takes care of all the evil memory management involved
-char Poller::selectDesktop(HDESK newDesktop)
-{
-  //
-  // Only on NT.
-  //
-  if (isWinNT())
-  {
-    HDESK oldDesktop = GetThreadDesktop(GetCurrentThreadId());
-
-    DWORD dummy;
-    char newName[256];
-
-    if (GetUserObjectInformation(newDesktop, UOI_NAME, &amp;newName, 256, &amp;dummy) == 0)
-    {
-      logDebug(&quot;Poller::selectDesktop&quot;,&quot;GetUserObjectInformation() failed. Error[%lu].&quot;, GetLastError());
-      return 0;
-    }
-
-    logTest(&quot;Poller::selectDesktop&quot;,&quot;New Desktop to [%s] (%x) from (%x).&quot;,
-                 newName, (unsigned int)newDesktop, (unsigned int)oldDesktop);
-
-    //
-    // Switch the desktop.
-    //
-    if(SetThreadDesktop(newDesktop) == 0)
-    {
-      logDebug(&quot;Poller::SelectDesktop&quot;,&quot;Unable to SetThreadDesktop(), Error=%lu.&quot;, GetLastError());
-      return 0;
-    }
-
-    //
-    // Switched successfully - destroy the old desktop.
-    //
-    if (CloseDesktop(oldDesktop) == 0)
-    {
-      logDebug(&quot;Poller::selectHdesk&quot;,&quot;Failed to close old desktop (%x), Error=%lu.&quot;,
-                   (unsigned int)oldDesktop, GetLastError());
-      return 0;
-    }
-  }
-
-  return 1;
-}
-
-//
-// Switches the current thread into a different desktop, by name
-// Calling with a valid desktop name will place the thread in that desktop.
-// Calling with a NULL name will place the thread in the current input desktop.
-//
-
-char Poller::selectDesktopByName(char *name)
-{
-  //
-  // Only on NT.
-  //
-  if (isWinNT())
-  {
-    HDESK desktop;
-
-    if (name != NULL)
-    {
-      //
-      // Attempt to open the named desktop.
-      //
-      desktop = OpenDesktop(name, 0, FALSE,
-                                DESKTOP_CREATEMENU | DESKTOP_CREATEWINDOW |
-                                DESKTOP_ENUMERATE | DESKTOP_HOOKCONTROL |
-                                DESKTOP_WRITEOBJECTS | DESKTOP_READOBJECTS |
-                                DESKTOP_SWITCHDESKTOP | GENERIC_WRITE);
-    }
-    else
-    {
-      //
-      // Open the input desktop.
-      //
-      desktop = OpenInputDesktop(0, FALSE,
-                                     DESKTOP_CREATEMENU | DESKTOP_CREATEWINDOW |
-                                     DESKTOP_ENUMERATE | DESKTOP_HOOKCONTROL |
-                                     DESKTOP_WRITEOBJECTS | DESKTOP_READOBJECTS |
-                                     DESKTOP_SWITCHDESKTOP | GENERIC_WRITE);
-    }
-
-    if (desktop == NULL)
-    {
-      logDebug(&quot;Poller::selectDesktopByName&quot;,&quot;Unable to open desktop, Error=%lu.&quot;, GetLastError());
-      return 0;
-    }
-
-    //
-    // Switch to the new desktop
-    //
-    if (selectDesktop(desktop) == 0)
-    {
-      //
-      // Failed to enter the new desktop, so free it!
-      //
-      logDebug(&quot;Poller::selectDesktopByName&quot;,&quot;Failed to select desktop.&quot;);
-
-      if (CloseDesktop(desktop) == 0)
-      {
-        logDebug(&quot;Poller::selectDesktopByName&quot;,&quot;Failed to close desktop, Error=%lu.&quot;, GetLastError());
-        return 0;
-      }
-    }
-
-    return 1;
-  }
-
-  return (name == NULL);
-}
-
-void Poller::platformOS()
-{
-    OSVERSIONINFO osversioninfo;
-    osversioninfo.dwOSVersionInfoSize = sizeof(osversioninfo);
-
-    //
-    // Get the current OS version.
-    //
-    if (GetVersionEx(&amp;osversioninfo) == 0)
-    {
-      platformID_ = 0;
-    }
-    platformID_ = osversioninfo.dwPlatformId;
-
-//
-//    versionMajor = osversioninfo.dwMajorVersion;
-//    versionMinor = osversioninfo.dwMinorVersion;
-//
-}
-
-char Poller::checkDesktop()
-{
-  //
-  // Only on NT.
-  //
-  if (isWinNT())
-  {
-    //
-    // Get the input and thread desktops.
-    //
-    HDESK desktop = GetThreadDesktop(GetCurrentThreadId());
-    HDESK inputDesktop = OpenInputDesktop(0, FALSE,
-                        DESKTOP_CREATEMENU | DESKTOP_CREATEWINDOW |
-                        DESKTOP_ENUMERATE | DESKTOP_HOOKCONTROL |
-                        DESKTOP_WRITEOBJECTS | DESKTOP_READOBJECTS |
-                        DESKTOP_SWITCHDESKTOP | GENERIC_WRITE);
-
-    if (inputDesktop == NULL)
-    {
-      return 0;
-    }
-
-    DWORD dummy;
-    char desktopName[256];
-    char inputName[256];
-
-    if (GetUserObjectInformation(desktop, UOI_NAME, &amp;desktopName, 256, &amp;dummy) == 0)
-    {
-      if (CloseDesktop(inputDesktop) == 0)
-      {
-        logDebug(&quot;Poller::checkDesktop&quot;, &quot;Failed to close desktop, Error[%d].&quot;, (unsigned int)GetLastError());
-        return 0;
-      }
-    }
-
-    if (GetUserObjectInformation(inputDesktop, UOI_NAME, &amp;inputName, 256, &amp;dummy) == 0)
-    {
-      if (CloseDesktop(inputDesktop) == 0)
-      {
-        logDebug(&quot;Poller::checkDesktop&quot;, &quot;Failed to close input desktop, Error[%d].&quot;, (unsigned int)GetLastError());
-        return 0;
-      }
-    }
-
-    if (strcmp(desktopName, inputName) != 0)
-    {
-      //
-      // Switch to new desktop.
-      //
-      selectDesktop(inputDesktop);
-    }
-
-    if (CloseDesktop(desktop) == 0)
-    {
-      logDebug(&quot;Poller::checkDesktop&quot;, &quot;Failed to close input desktop, Error[%d].&quot;, (unsigned int)GetLastError());
-      return 0;
-    }
-
-    if (CloseDesktop(inputDesktop) == 0)
-    {
-      logDebug(&quot;Poller::checkDesktop&quot;, &quot;Failed to close input desktop, Error[%d].&quot;, (unsigned int)GetLastError());
-      return 0;
-    }
-  }
-
-  return 1;
-}
-
-unsigned char Poller::isModifier(UINT scancode)
-{
-  return 0;
-}
-
-void Poller::updateModifierState(UINT scancode, unsigned char pressed)
-{
-  return;
-}
-
-Cursor Poller::createCursor(Window wnd, Visual *vis,unsigned int x, unsigned int y,
-                                int width, int height, unsigned char *xormask, unsigned char *andmask)
-{
-  Pixmap maskglyph, cursorglyph;
-  XColor bg, fg;
-  Cursor xcursor;
-  unsigned char *cursor;
-  unsigned char *mask, *pmask, *pcursor, tmp;
-  int scanline, offset;
-
-  scanline = (width + 7) / 8;
-  offset = scanline * height;
-
-  pmask = andmask;
-  pcursor = xormask;
-  for (int i = 0; i &lt; offset; i++)
-  {
-    //
-    // The pixel is black if both the bit of andmask and xormask is one.
-    //
-
-    tmp = *pcursor &amp; *pmask;
-    *pcursor ^= tmp;
-    *pmask ^= tmp;
-
-    *pmask = ~(*pmask);
-
-    pmask++;
-    pcursor++;
-  }
-
-  cursor = new unsigned char[offset];
-  memcpy(cursor, xormask, offset);
-
-  mask = new unsigned char[offset];
-  memcpy(mask, andmask, offset);
-
-  fg.red = fg.blue = fg.green = 0xffff;
-  bg.red = bg.blue = bg.green = 0x0000;
-  fg.flags = bg.flags = DoRed | DoBlue | DoGreen;
-
-  cursorglyph = createGlyph(wnd, vis, width, height, cursor);
-  maskglyph = createGlyph(wnd, vis, width, height, mask);
-
-  xcursor = XCreatePixmapCursor(display_, cursorglyph, maskglyph, &amp;fg, &amp;bg, x, y);
-
-  XFreePixmap(display_, maskglyph);
-  XFreePixmap(display_, cursorglyph);
-  delete[]mask;
-  delete[]cursor;
-
-  return xcursor;
-}
-
-Pixmap Poller::createGlyph(Window wnd, Visual *visual, int width, int height, unsigned char *data)
-{
-  XImage *image;
-  Pixmap bitmap;
-  int scanline;
-  GC glyphGC;
-
-  scanline = (width + 7) / 8;
-
-  bitmap = XCreatePixmap(display_, wnd, width, height, 1);
-  glyphGC = XCreateGC(display_, bitmap, 0, NULL);
-
-  image = XCreateImage(display_, visual, 1, ZPixmap, 0, (char *)data, width, height, 8, scanline);
-  image-&gt;byte_order = 1; // MSBFirst -- LSBFirst = 0
-  image-&gt;bitmap_bit_order = 1;
-  XInitImage(image);
-
-/*  logTest(&quot;Poller::createGlyph&quot;,&quot;XPutImage on pixmap %d,%d,%d,%d.\n&quot;,
-              0, 0, width, height);*/
-  XPutImage(display_, bitmap, glyphGC, image, 0, 0, 0, 0, width, height);
-  XFree(image);
-
-  return bitmap;
-}
-#endif /* defined(__CYGWIN32__) || defined(WIN32) */
diff --git a/nxcompshad/Win.h b/nxcompshad/Win.h
deleted file mode 100644
index fe591ff..0000000
--- a/nxcompshad/Win.h
+++ /dev/null
@@ -1,224 +0,0 @@
-/**************************************************************************/
-/*                                                                        */
-/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
-/*                                                                        */
-/* NXCOMPSHAD, NX protocol compression and NX extensions to this software */
-/* are copyright of NoMachine. Redistribution and use of the present      */
-/* software is allowed according to terms specified in the file LICENSE   */
-/* which comes in the source distribution.                                */
-/*                                                                        */
-/* Check <A HREF="http://www.nomachine.com/licensing.html">http://www.nomachine.com/licensing.html</A> for applicability.       */
-/*                                                                        */
-/* NX and NoMachine are trademarks of Medialogic S.p.A.                   */
-/*                                                                        */
-/* All rights reserved.                                                   */
-/*                                                                        */
-/**************************************************************************/
-
-#ifdef __CYGWIN32__
-
-#ifndef Win32Poller_H
-#define Win32Poller_H
-
-//#include &lt;X11/X.h&gt;
-
-#include &lt;Windows.h&gt;
-#include &lt;wingdi.h&gt;
-#include &lt;winable.h&gt;
-#include &lt;winuser.h&gt;
-
-#define CAPTUREBLT 0x40000000
-
-#define KEYEVENTF_SCANCODE 0x00000008
-#define MAPVK_VSC_TO_VK_EX 3
-//
-// The CAPTUREBLT is a raster operation used
-// in bit blit transfer.
-//
-// Using this operation includes any windows
-// that are layered on top of your window in
-// the resulting image. By default, the image
-// only contains your window.
-//
-
-#include &quot;Core.h&quot;
-
-typedef struct _keyTranslation
-{
- unsigned char scancode;
- unsigned short modifiers;
-
-}keyTranslation;
-
-class Poller : public CorePoller
-{
-  public:
-
-  Display *display_;
-  keyTranslation *keymap_;
-  unsigned char keymapLoaded_;
-  int minKeycode_;
-
-  Poller(Input *, Display *display, int = 16);
-
-  ~Poller();
-
-  int init();
-
-  int updateCursor(Window, Visual*);
-
-  private:
-
-  
-  int Poller::updateShadowFrameBuffer(void);
-  void handleKeyboardEvent(Display *, XEvent *);
-  void handleWebKeyboardEvent(KeySym keysym, Bool isKeyPress);
-  void addToKeymap(char *keyname, unsigned char scancode, unsigned short modifiers, char *mapname);
-  int xkeymapRead(char *mapname);
-  FILE *xkeymapOpen(char *filename);
-  void xkeymapInit(char *keyMapName);
-  keyTranslation xkeymapTranslateKey(unsigned int keysym, unsigned int keycode, unsigned int state);
-  unsigned char getKeyState(unsigned int state, unsigned int keysym);
-  char *getKsname(unsigned int keysym);
-  unsigned char specialKeys(unsigned int keysym, unsigned int state, int pressed);
-
-  unsigned char toggleSwitch(unsigned char ToggleStateClient, unsigned char ToggleStateServer, UINT scancode,
-                                 int *lengthArrayINPUT);
-
-  void updateModifierState(UINT, unsigned char);
-
-  unsigned char toggleServerState(UINT scancode);
-  unsigned char keyState(UINT scancode, UINT mapType);
-  unsigned char keyStateAsync(UINT scancode);
-
-  void handleMouseEvent(Display *, XEvent *);
-
-  Cursor createCursor(Window wnd, Visual *vis, unsigned int x, unsigned int y, int width,
-                           int height, unsigned char *xormask, unsigned char *andmask);
-
-  Pixmap createGlyph(Window wnd, Visual *visual, int width, int height, unsigned char *data);
-
-  char isWinNT();
-  char selectDesktop(HDESK new_desktop);
-  char selectDesktopByName(char *name);
-  void platformOS();
-  char simulateCtrlAltDel(void);
-  DWORD platformID_;
-
-  INPUT *pKey_, *pMouse_;
-
-  char *keymapName_;
-  char *path_;
-
-  unsigned char toggleButtonState_;
-  unsigned short serverModifierState_;
-  unsigned short savedServerModifierState_;
-
-  void ensureServerModifiers(keyTranslation tr, int *lenghtArrayINPUT);
-  void restoreServerModifiers(UINT scancode);
-  unsigned char isModifier(UINT scancode);
-
-  char sendInput(unsigned char scancode, unsigned char pressed, int *lengthArrayINPUT);
-
-  char *getRect(XRectangle);
-  char checkDesktop();
-
-  char *DIBBuffer_;
-
-  HCURSOR oldCursor_;
-
-  VOID *pDIBbits_;
-  HDC screenDC_;
-  HDC memoryDC_;
-  BITMAPINFO bmi_;
-  HBITMAP screenBmp_;
-
-  Cursor xCursor_;
-
-};
-
-#undef TEST
-
-inline unsigned char Poller::toggleSwitch(unsigned char ToggleStateClient, unsigned char ToggleStateServer,
-                                              UINT scancode, int *lengthArrayINPUT)
-{
-  return 1;
-}
-
-inline unsigned char Poller::toggleServerState(UINT scancode)
-{
-  return (GetKeyState(MapVirtualKeyEx(scancode, 3, GetKeyboardLayout((DWORD)NULL))) &amp; 0x1);
-}
-
-inline unsigned char Poller::keyStateAsync(UINT vKeycode)
-{
-  return GetAsyncKeyState(vKeycode);
-}
-
-inline unsigned char Poller::keyState(UINT code, UINT mapType)
-{
-  if (mapType == 0)
-  {
-    //
-    // Virtual Keycode
-    //
-    return ((GetKeyState(code) &amp; 0x80) == 0x80);
-  }
-  else
-  {
-    //
-    // scancode
-    //
-    return ((GetKeyState(MapVirtualKeyEx(code, 3, GetKeyboardLayout((DWORD)NULL))) &amp; 0x80) == 0x80);
-  }
-}
-
-inline char Poller::isWinNT()
-{
-  return (platformID_ == VER_PLATFORM_WIN32_NT);
-}
-
-inline char Poller::sendInput(unsigned char scancode, unsigned char pressed, int *lengthArrayINPUT)
-{
-  DWORD keyEvent = 0;
-  DWORD extended = 0;
-
-  if (scancode &gt; 0)
-  {
-    if (pressed == 0)
-    {
-      keyEvent = KEYEVENTF_KEYUP;
-    }
-
-    if (scancode &amp; 0x80)
-    {
-      scancode &amp;= ~0x80;
-      extended = KEYEVENTF_EXTENDEDKEY;
-    }
-
-    pKey_[*lengthArrayINPUT].ki.wScan = (WORD) scancode;
-    pKey_[*lengthArrayINPUT].ki.dwFlags = (DWORD) (keyEvent | KEYEVENTF_SCANCODE | extended);
-    (*lengthArrayINPUT)++;
-  }
-
-
-  if (*lengthArrayINPUT &gt; 0)                                                                                                   {
-    // FIXME: Remove me.
-    logTest(&quot;Poller::sendInput&quot;, &quot;length Input [%d] event: %s&quot;, *lengthArrayINPUT,
-              pressed == 1 ? &quot;KeyPress&quot;: &quot;KeyRelease&quot;);
-
-    if (SendInput(*lengthArrayINPUT, pKey_, sizeof(INPUT)) == 0)
-    {
-      logTest(&quot;Poller::sendInput&quot;, &quot;Failed SendInput, event: %s&quot;, pressed == 1 ? &quot;KeyPress&quot;: &quot;KeyRelease&quot;);
-      *lengthArrayINPUT = 0;
-      return 0;
-    }
-
-    *lengthArrayINPUT = 0;
-  }
-
-  return 1;
-}
-#endif /* Win32Poller_H */
-
-#endif /* __CYGWIN32__ */
diff --git a/nxcompshad/X11.cpp b/nxcompshad/X11.cpp
deleted file mode 100644
index 2d1140f..0000000
--- a/nxcompshad/X11.cpp
+++ /dev/null
@@ -1,1586 +0,0 @@
-/**************************************************************************/
-/*                                                                        */
-/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
-/*                                                                        */
-/* NXCOMPSHAD, NX protocol compression and NX extensions to this software */
-/* are copyright of NoMachine. Redistribution and use of the present      */
-/* software is allowed according to terms specified in the file LICENSE   */
-/* which comes in the source distribution.                                */
-/*                                                                        */
-/* Check <A HREF="http://www.nomachine.com/licensing.html">http://www.nomachine.com/licensing.html</A> for applicability.       */
-/*                                                                        */
-/* NX and NoMachine are trademarks of Medialogic S.p.A.                   */
-/*                                                                        */
-/* All rights reserved.                                                   */
-/*                                                                        */
-/**************************************************************************/
-
-#if !defined(__CYGWIN32__) &amp;&amp; !defined(WIN32)
-
-#define PANIC
-#define WARNING
-#undef  TEST
-#undef  DEBUG
-
-#include &lt;X11/Xlibint.h&gt;
-#include &lt;X11/Xproto.h&gt;
-#include &lt;X11/extensions/XTest.h&gt;
-#include &lt;X11/keysym.h&gt;
-#include &lt;string.h&gt;
-#include &lt;sys/ipc.h&gt;
-#include &lt;sys/shm.h&gt;
-
-#include &quot;Poller.h&quot;
-#include &quot;Logger.h&quot;
-#include &quot;Shadow.h&quot;
-
-#define ROUNDUP(nbytes, pad) ((((nbytes) + ((pad)-1)) / (pad)) * ((pad)&gt;&gt;3))
-
-#undef  TRANSLATE_KEYCODES
-#define TRANSLATE_ALWAYS
-
-typedef struct {
-    KeySym  *map;
-    KeyCode minKeyCode,
-            maxKeyCode;
-    int     mapWidth;
-} KeySymsRec, *KeySymsPtr;
-
-extern KeySymsPtr NXShadowKeymap;
-
-typedef struct _KeyPressed
-{
-  KeyCode keyRcvd;
-  KeyCode keySent;
-  struct _KeyPressed *next;
-} KeyPressedRec;
-
-static KeyPressedRec *shadowKeyPressedPtr = NULL;
-
-static KeySym *shadowKeysyms = NULL;
-static KeySym *masterKeysyms = NULL;
-
-static KeySym *shadowKeymap = NULL;
-
-static int shadowMinKey, shadowMaxKey, shadowMapWidth;
-static int masterMinKey, masterMaxKey, masterMapWidth;
-
-static int leftShiftOn = 0;
-static int rightShiftOn = 0;
-static int modeSwitchOn = 0;
-static int level3ShiftOn = 0;
-static int altROn = 0;
-
-static int sentFakeLShiftPress = 0;
-static int sentFakeLShiftRelease = 0;
-static int sentFakeRShiftRelease = 0;
-static int sentFakeModeSwitchPress = 0;
-static int sentFakeModeSwitchRelease = 0;
-static int sentFakeLevel3ShiftPress = 0;
-static int sentFakeLevel3ShiftRelease = 0;
-static int sentFakeAltRRelease = 0;
-
-static int shmInitTrap = 0;
-
-Poller::Poller(Input *input, Display *display, int depth) : CorePoller(input, display)
-{
-  logTrace(&quot;Poller::Poller&quot;);
-
-  display_ = NULL;
-  shadowDisplayName_ = input -&gt; getShadowDisplayName();
-
-  tmpBuffer_ = NULL;
-
-  xtestExtension_  = -1;
-  shmExtension_    = -1;
-  randrExtension_  = -1;
-  damageExtension_ = -1;
-
-  shadowDisplayUid_ = -1;
-
-  image_ = NULL;
-
-  shminfo_ = NULL;
-}
-
-Poller::~Poller()
-{
-  logTrace(&quot;Poller::~Poller&quot;);
-
-  if (shmExtension_ == 1)
-  {
-    XShmDetach(display_, shminfo_);
-    XDestroyImage(image_);
-    shmdt(shminfo_ -&gt; shmaddr);
-    shmctl(shminfo_ -&gt; shmid, IPC_RMID, 0);
-  }
-
-  if (shminfo_ != NULL)
-  {
-    delete shminfo_;
-
-    shminfo_ = NULL;
-  }
-
-  if (display_ != NULL)
-  {
-    XCloseDisplay(display_);
-  }
-
-  if (tmpBuffer_ != NULL &amp;&amp; shmExtension_ != -1 &amp;&amp; damageExtension_ == 1)
-  {
-    XFree(tmpBuffer_);
-
-    tmpBuffer_ = NULL;
-  }
-}
-
-int Poller::init()
-{
-  logTrace(&quot;Poller::init&quot;);
-
-  if (display_ == NULL)
-  {
-    display_ = XOpenDisplay(shadowDisplayName_);
-
-    setShadowDisplay(display_);
-  }
-
-  logTest(&quot;Poller::init:&quot; ,&quot;Shadow display [%p] name [%s].&quot;, (Display *) display_, shadowDisplayName_);
-
-  if (display_ == NULL)
-  {
-    logTest(&quot;Poller::init&quot;, &quot;Failed to connect to display [%s].&quot;, shadowDisplayName_ ? shadowDisplayName_ : &quot;&quot;);
-
-    return -1;
-  }
-
-  setRootSize();
-
-  logTest(&quot;Poller::init&quot;, &quot;Screen geometry is [%d, %d] depth is [%d] bpl [%d] bpp [%d].&quot;,
-              width_, height_, depth_, bpl_, bpp_);
-
-  xtestInit();
-
-  shmInit();
-
-  randrInit();
-
-  damageInit();
-
-  return CorePoller::init();
-}
-
-int Poller::updateShadowFrameBuffer(void)
-{
-  if (shmExtension_ == 1)
-  {
-    if (XShmGetImage(display_, DefaultRootWindow(display_), image_, 0, 0, AllPlanes) == 0)
-    {
-      logDebug(&quot;Poller::updateShadowFrameBuffer&quot;, &quot;XShmGetImage failed!&quot;);
-
-      return -1;
-    }
-  }
-  else
-  {
-    image_ = XGetImage(display_, DefaultRootWindow(display_), 0, 0, width_,
-                           height_, AllPlanes, ZPixmap);
-
-    if (image_ == NULL)
-    {
-      logDebug(&quot;Poller::updateShadowFrameBuffer&quot;, &quot;XGetImage failed!&quot;);
-
-      return -1;
-    }
-  }
-
-  return 1;
-}
-
-char *Poller::getRect(XRectangle r)
-{
-  logTrace(&quot;Poller::getRect&quot;);
-
-  logDebug(&quot;Poller::getRect&quot;, &quot;Going to retrive rectangle [%d, %d, %d, %d].&quot;,
-              r.x, r.y, r.width, r.height);
-
-  if (shmExtension_ == 1)
-  {
-    if (damageExtension_ == 1)
-    {
-      image_ -&gt; width = r.width;
-      image_ -&gt; height = r.height;
-
-      image_ -&gt; bytes_per_line = ROUNDUP((image_ -&gt; bits_per_pixel * image_ -&gt; width), image_ -&gt; bitmap_pad);
-
-      if (XShmGetImage(display_, DefaultRootWindow(display_), image_, r.x, r.y, AllPlanes) == 0)
-      {
-        logDebug(&quot;Poller::getRect&quot;, &quot;XShmGetImage failed!&quot;);
-
-        return NULL;
-      }
-
-      tmpBuffer_ = image_ -&gt; data;
-    }
-    else
-    {
-      image_ -&gt; width  = r.width;
-      image_ -&gt; height = r.height; 
-
-      image_ -&gt; bytes_per_line = ROUNDUP((image_ -&gt; bits_per_pixel * image_ -&gt; width), image_ -&gt; bitmap_pad);
-
-      if (XShmGetImage(display_, DefaultRootWindow(display_), image_, r.x, r.y, AllPlanes) == 0)
-      {
-        logDebug(&quot;Poller::getRect&quot;, &quot;XShmGetImage failed!&quot;);
-      }
-
-      tmpBuffer_ = image_ -&gt; data;
-    }
-  }
-  else
-  {
-    if (tmpBuffer_)
-    {
-      XFree(tmpBuffer_);
-      tmpBuffer_ = NULL;
-    }
-
-    image_ = XGetImage(display_, DefaultRootWindow(display_), r.x, r.y, r.width, r.height, AllPlanes, ZPixmap);
-
-    if (image_ == NULL)
-    {
-      logError(&quot;Poller::getRect&quot;, ESET(ENOMSG));
-
-      return NULL;
-    }
-
-    tmpBuffer_ = image_ -&gt; data;
-
-    if (image_ -&gt; obdata)
-    {
-      XFree(image_ -&gt; obdata);
-    }
-
-    XFree(image_);
-
-    image_ = NULL;
-  }
-
-  return tmpBuffer_;
-}
-
-void Poller::shmInit(void)
-{
-  int major, minor;
-  int pixmaps;
-
-  logTest(&quot;Poller::shmInit&quot;, &quot;Added shmExtension_ [%d].&quot;, shmExtension_);
-
-  if (shmExtension_ &gt;= 0)
-  {
-    logDebug(&quot;Poller::shmInit&quot;, &quot;Called with shared memory already initialized.&quot;);
-
-    if (shmInitTrap == 0)
-    {
-      return;
-    }
-  }
-
-  if (shmExtension_ &lt; 0 &amp;&amp; NXShadowOptions.optionShmExtension == 0)
-  {
-    shmExtension_ = 0;
-
-    logUser(&quot;Poller::shmInit: Disabling use of MIT-SHM extension.\n&quot;);
-
-    return;
-  }
-
-  if (XShmQueryVersion(display_, &amp;major, &amp;minor, &amp;pixmaps) == 0)
-  {
-    logDebug(&quot;Poller::shmInit&quot;, &quot;MIT_SHM: Shared memory extension not available.&quot;);
-
-    shmExtension_ = 0;
-  }
-  else
-  {
-    logDebug(&quot;Poller::shmInit&quot;, &quot;MIT_SHM: Shared memory extension available.&quot;);
-
-    if (shminfo_ != NULL)
-    {
-      destroyShmImage();
-    }
-
-    shminfo_ = (XShmSegmentInfo* ) new XShmSegmentInfo;
-
-    if (shminfo_ == NULL)
-    {
-      logError(&quot;Poller::shmInit&quot;, ESET(ENOMEM));
-
-      shmExtension_ = 0;
-
-      return;
-    }
-
-    image_ = (XImage *)XShmCreateImage(display_, display_ -&gt; screens[0].root_visual, depth_, ZPixmap,
-                                           NULL,  shminfo_, width_, height_);
-
-    if (image_ == NULL)
-    {
-      logError(&quot;Poller::shmInit&quot;, ESET(ENOMSG));
-
-      shmExtension_ = 0;
-
-      return;
-    }
-
-    shadowDisplayUid_ = NXShadowOptions.optionShadowDisplayUid;
-
-    logDebug(&quot;Poller::shmInit&quot;, &quot;Master X server uid [%d].&quot;, NXShadowOptions.optionShadowDisplayUid);
-
-    shminfo_ -&gt; shmid = shmget(IPC_PRIVATE, image_ -&gt; bytes_per_line * image_ -&gt; height, IPC_CREAT | 0666);
-
-    if (shminfo_ -&gt; shmid &lt; 0)
-    {
-      logDebug(&quot;Poller::shmInit&quot;, &quot;kernel id error.&quot;);
-
-      shmExtension_ = 0;
-
-      return;
-    }
-
-    logDebug(&quot;Poller::shmInit&quot;, &quot;Created shm segment with shmid [%d].&quot;, shminfo_ -&gt; shmid);
-
-    shminfo_ -&gt; shmaddr = (char *)shmat(shminfo_ -&gt; shmid, 0, 0);
-
-    if (shminfo_ -&gt; shmaddr &lt; 0)
-    {
-      logWarning(&quot;Poller::shmInit&quot;, &quot;Couldn't attach to shm segment.&quot;);
-    }
-
-    logDebug(&quot;Poller::shmInit&quot;, &quot;shminfo_ -&gt; shmaddr [%p].&quot;, shminfo_ -&gt; shmaddr);
-
-    image_ -&gt; data = shminfo_ -&gt; shmaddr;
-
-    shminfo_ -&gt; readOnly = 0;
-
-    if (XShmAttach(display_, shminfo_) == 0)
-    {
-      logDebug(&quot;Poller::shmInit&quot;, &quot;XShmAttach failed.&quot;);
-
-      shmExtension_ = 0;
-
-      return;
-    }
-
-    //
-    // Mark the shm segment to be destroyed after
-    // the last process detach. Let the X server
-    // complete the X_ShmAttach request, before.
-    //
-
-    XSync(display_, 0);
-
-    struct shmid_ds ds;
-
-    shmctl(shminfo_ -&gt; shmid, IPC_STAT, &amp;ds);
-
-    if (shadowDisplayUid_ != -1)
-    {
-      ds.shm_perm.uid = (ushort) shadowDisplayUid_;
-    }
-    else
-    {
-      logWarning(&quot;Poller::shmInit&quot;, &quot;Couldn't set uid for shm segment.&quot;);
-    }
-
-    ds.shm_perm.mode = 0600;
-
-    shmctl(shminfo_ -&gt; shmid, IPC_SET, &amp;ds);
-
-    shmctl(shminfo_ -&gt; shmid, IPC_STAT, &amp;ds);
-
-    shmctl(shminfo_ -&gt; shmid, IPC_RMID, 0);
-
-    logDebug(&quot;Poller::shmInit&quot;, &quot;Number of attaches to shm segment [%d] are [%d].\n&quot;,
-                 shminfo_ -&gt; shmid, (int) ds.shm_nattch);
-
-    if (ds.shm_nattch &gt; 2)
-    {
-      logWarning(&quot;Poller::shmInit&quot;, &quot;More than two attaches to the shm segment.&quot;);
-
-      destroyShmImage();
-
-      shmExtension_ = 0;
-
-      return;
-    }
-
-    shmExtension_ = 1;
-  }
-}
-
-void Poller::keymapShadowInit(Display *display)
-{
-  int i, len;
-  CARD32 *map;
-
-  if (NXShadowKeymap != NULL)
-  {
-    shadowMinKey   = NXShadowKeymap -&gt; minKeyCode;
-    shadowMaxKey   = NXShadowKeymap -&gt; maxKeyCode;
-    shadowMapWidth = NXShadowKeymap -&gt; mapWidth;
-
-    len = (shadowMaxKey - shadowMinKey + 1) * shadowMapWidth;
-
-    map = (CARD32 *) NXShadowKeymap -&gt; map;
-
-    if (shadowKeymap != NULL)
-    {
-      free(shadowKeymap);
-    }
-
-    shadowKeymap = (KeySym *) malloc(len * sizeof(KeySym));
-
-    if (shadowKeymap != NULL)
-    {
-      for (i = 0; i &lt; len; i++)
-      {
-        shadowKeymap[i] = map[i];
-      }
-
-      shadowKeysyms = shadowKeymap;
-    }
-  }
-
-  if (shadowKeysyms == NULL)
-  {
-    XDisplayKeycodes(display, &amp;shadowMinKey, &amp;shadowMaxKey);
-
-    shadowKeysyms = XGetKeyboardMapping(display, shadowMinKey, shadowMaxKey - shadowMinKey + 1,
-                                            &amp;shadowMapWidth);
-  }
-
-  #ifdef DEBUG
-  if (shadowKeysyms != NULL)
-  {
-    for (i = 0; i &lt; (shadowMaxKey - shadowMinKey + 1) * shadowMapWidth; i++)
-    {
-      if (i % shadowMapWidth == 0)
-      {
-        logDebug(&quot;Poller::keymapShadowInit&quot;, &quot;keycode [%d]&quot;, (int) (i / shadowMapWidth));
-      }
-
-      logDebug(&quot;\tkeysym&quot;, &quot; [%x] [%s]&quot;, (unsigned int) shadowKeysyms[i], XKeysymToString(shadowKeysyms[i]));
-    }
-  }
-  #endif
-}
-
-void Poller::keymapMasterInit()
-{
-  XDisplayKeycodes(display_, &amp;masterMinKey, &amp;masterMaxKey);
-
-  masterKeysyms = XGetKeyboardMapping(display_, masterMinKey, masterMaxKey - masterMinKey + 1,
-                                          &amp;masterMapWidth);
-
-  #ifdef DEBUG
-  if (masterKeysyms != NULL)
-  {
-    for (int i = 0; i &lt; (masterMaxKey - masterMinKey + 1) * masterMapWidth; i++)
-    {
-      if (i % masterMapWidth == 0)
-      {
-        logDebug(&quot;Poller::keymapMasterInit&quot;, &quot;keycode [%d]&quot;, (int) (i / masterMapWidth));
-      }
-
-      logDebug(&quot;\tkeysym&quot;, &quot; [%x] [%s]&quot;, (unsigned int) masterKeysyms[i], XKeysymToString(masterKeysyms[i]));
-    }
-  }
-  #endif
-}
-
-KeySym Poller::keymapKeycodeToKeysym(KeyCode keycode, KeySym *keysyms,
-                                         int minKey, int mapWidth, int col)
-{
-  int index = ((keycode - minKey) * mapWidth) + col;
-  return keysyms[index];
-}
-
-KeyCode Poller::keymapKeysymToKeycode(KeySym keysym, KeySym *keysyms,
-                                          int minKey, int maxKey, int mapWidth, int *col)
-{
-  for (int i = 0; i &lt; (maxKey - minKey + 1) * mapWidth; i++)
-  {
-    if (keysyms[i] == keysym)
-    {
-      *col = i % mapWidth;
-      return i / mapWidth + minKey;
-    }
-  }
-  return 0;
-}
-
-KeyCode Poller::translateKeysymToKeycode(KeySym keysym, int *col)
-{
-  KeyCode keycode;
-
-  keycode = keymapKeysymToKeycode(keysym, masterKeysyms, masterMinKey,
-                                      masterMaxKey, masterMapWidth, col);
-
-  if (keycode == 0)
-  {
-    if (((keysym &gt;&gt; 8) == 0) &amp;&amp; (keysym &gt;= XK_a) &amp;&amp; (keysym &lt;= XK_z))
-    {
-      /*
-       * The master session has a Solaris keyboard.
-       */
-
-      keysym -= XK_a - XK_A;
-
-      keycode = keymapKeysymToKeycode(keysym, masterKeysyms, masterMinKey,
-                                          masterMaxKey, masterMapWidth, col);
-    }
-    else if (keysym == XK_Shift_R)
-    {
-      keysym = XK_Shift_L;
-
-      keycode = keymapKeysymToKeycode(keysym, masterKeysyms, masterMinKey,
-                                          masterMaxKey, masterMapWidth, col);
-    }
-    else if (keysym == XK_Shift_L)
-    {
-      keysym = XK_Shift_R;
-
-      keycode = keymapKeysymToKeycode(keysym, masterKeysyms, masterMinKey,
-                                          masterMaxKey, masterMapWidth, col);
-    }
-    else if (keysym == XK_ISO_Level3_Shift)
-    {
-      keysym = XK_Mode_switch;
-
-      if ((keycode = keymapKeysymToKeycode(keysym, masterKeysyms, masterMinKey,
-                                               masterMaxKey, masterMapWidth, col)) == 0)
-      {
-        keysym = XK_Alt_R;
-
-        keycode = keymapKeysymToKeycode(keysym, masterKeysyms, masterMinKey,
-                                            masterMaxKey, masterMapWidth, col);
-      }
-    }
-    else if (keysym == XK_Alt_R)
-    {
-      keysym = XK_ISO_Level3_Shift;
-
-      if ((keycode = keymapKeysymToKeycode(keysym, masterKeysyms, masterMinKey,
-                                               masterMaxKey, masterMapWidth, col)) == 0)
-      {
-        keysym = XK_Mode_switch;
-
-        keycode = keymapKeysymToKeycode(keysym, masterKeysyms, masterMinKey,
-                                            masterMaxKey, masterMapWidth, col);
-      }
-    }
-  }
-  return keycode;
-}
-
-Bool Poller::checkModifierKeys(KeySym keysym, Bool isKeyPress)
-{
-  switch (keysym)
-  {
-    case XK_Shift_L:
-      leftShiftOn = isKeyPress;
-      return True;
-    case XK_Shift_R:
-      rightShiftOn = isKeyPress;
-      return True;
-    case XK_Mode_switch:
-      modeSwitchOn = isKeyPress;
-      return True;
-    case XK_ISO_Level3_Shift:
-      level3ShiftOn = isKeyPress;
-      return True;
-    case XK_Alt_R:
-      altROn = isKeyPress;
-      return True;
-    default:
-      return False;
-  }
-}
-
-void Poller::sendFakeModifierEvents(int pos, Bool skip)
-{
-  KeySym fakeKeysym;
-  int col;
-
-  if ((!leftShiftOn &amp;&amp; !rightShiftOn) &amp;&amp;
-          (!modeSwitchOn &amp;&amp; !level3ShiftOn &amp;&amp; !altROn))
-  {
-    if (pos == 1 || pos == 3)
-    {
-      fakeKeysym = keymapKeysymToKeycode(XK_Shift_L, masterKeysyms, masterMinKey,
-                                             masterMaxKey, masterMapWidth, &amp;col);
-      XTestFakeKeyEvent(display_, fakeKeysym, 1, 0);
-      sentFakeLShiftPress = 1;
-    }
-    if (pos == 2 || pos == 3)
-    {
-      fakeKeysym = keymapKeysymToKeycode(XK_ISO_Level3_Shift, masterKeysyms, masterMinKey,
-                                             masterMaxKey, masterMapWidth, &amp;col);
-
-      if (fakeKeysym == 0)
-      {
-        fakeKeysym = keymapKeysymToKeycode(XK_Mode_switch, masterKeysyms, masterMinKey,
-                                               masterMaxKey, masterMapWidth, &amp;col);
-        sentFakeModeSwitchPress = 1;
-      }
-      else
-      {
-        sentFakeLevel3ShiftPress = 1;
-      }
-
-      XTestFakeKeyEvent(display_, fakeKeysym, 1, 0);
-    }
-  }
-
-  else if ((leftShiftOn || rightShiftOn) &amp;&amp;
-               (!modeSwitchOn &amp;&amp; !level3ShiftOn &amp;&amp; !altROn))
-  {
-    if ((pos == 0 &amp;&amp; !skip) || pos == 2)
-    {
-      if (leftShiftOn)
-      {
-        fakeKeysym = keymapKeysymToKeycode(XK_Shift_L, masterKeysyms, masterMinKey,
-                                               masterMaxKey, masterMapWidth, &amp;col);
-        XTestFakeKeyEvent(display_, fakeKeysym, 0, 0);
-        sentFakeLShiftRelease = 1;
-      }
-      if (rightShiftOn)
-      {
-        fakeKeysym = keymapKeysymToKeycode(XK_Shift_R, masterKeysyms, masterMinKey,
-                                               masterMaxKey, masterMapWidth, &amp;col);
-        XTestFakeKeyEvent(display_, fakeKeysym, 0, 0);
-        sentFakeRShiftRelease = 1;
-      }
-    }
-    if (pos == 2 || pos ==3)
-    {
-      fakeKeysym = keymapKeysymToKeycode(XK_ISO_Level3_Shift, masterKeysyms, masterMinKey,
-                                             masterMaxKey, masterMapWidth, &amp;col);
-
-      if (fakeKeysym == 0)
-      {
-        fakeKeysym = keymapKeysymToKeycode(XK_Mode_switch, masterKeysyms, masterMinKey,
-                                               masterMaxKey, masterMapWidth, &amp;col);
-        sentFakeModeSwitchPress = 1;
-      }
-      else
-      {
-        sentFakeLevel3ShiftPress = 1;
-      }
-
-      XTestFakeKeyEvent(display_, fakeKeysym, 1, 0);
-    }
-  }
-
-  else if ((!leftShiftOn &amp;&amp; !rightShiftOn) &amp;&amp;
-               (modeSwitchOn || level3ShiftOn || altROn))
-  {
-    if (pos == 1 || pos == 3)
-    {
-      fakeKeysym = keymapKeysymToKeycode(XK_Shift_L, masterKeysyms, masterMinKey,
-                                             masterMaxKey, masterMapWidth, &amp;col);
-      XTestFakeKeyEvent(display_, fakeKeysym, 1, 0);
-      sentFakeLShiftPress = 1;
-    }
-    if (pos == 0 || pos == 1)
-    {
-      if (modeSwitchOn)
-      {
-        fakeKeysym = keymapKeysymToKeycode(XK_Mode_switch, masterKeysyms, masterMinKey,
-                                               masterMaxKey, masterMapWidth, &amp;col);
-        XTestFakeKeyEvent(display_, fakeKeysym, 0, 0);
-        sentFakeModeSwitchRelease = 1;
-      }
-      if (level3ShiftOn)
-      {
-        fakeKeysym = keymapKeysymToKeycode(XK_ISO_Level3_Shift, masterKeysyms, masterMinKey,
-                                               masterMaxKey, masterMapWidth, &amp;col);
-        XTestFakeKeyEvent(display_, fakeKeysym, 0, 0);
-        sentFakeLevel3ShiftRelease = 1;
-      }
-      if (altROn)
-      {
-        fakeKeysym = keymapKeysymToKeycode(XK_Alt_R, masterKeysyms, masterMinKey,
-                                               masterMaxKey, masterMapWidth, &amp;col);
-        XTestFakeKeyEvent(display_, fakeKeysym, 0, 0);
-        sentFakeAltRRelease = 1;
-      }
-    }
-  }
-
-  else if ((leftShiftOn || rightShiftOn) &amp;&amp;
-               (modeSwitchOn || level3ShiftOn || altROn))
-  {
-    if (pos == 0 || pos == 2)
-    {
-      if (leftShiftOn)
-      {
-        fakeKeysym = keymapKeysymToKeycode(XK_Shift_L, masterKeysyms, masterMinKey,
-                                               masterMaxKey, masterMapWidth, &amp;col);
-        XTestFakeKeyEvent(display_, fakeKeysym, 0, 0);
-        sentFakeLShiftRelease = 1;
-      }
-      if (rightShiftOn)
-      {
-        fakeKeysym = keymapKeysymToKeycode(XK_Shift_R, masterKeysyms, masterMinKey,
-                                               masterMaxKey, masterMapWidth, &amp;col);
-        XTestFakeKeyEvent(display_, fakeKeysym, 0, 0);
-        sentFakeRShiftRelease = 1;
-      }
-    }
-    if (pos == 0 || pos == 1)
-    {
-      if (modeSwitchOn)
-      {
-        fakeKeysym = keymapKeysymToKeycode(XK_Mode_switch, masterKeysyms, masterMinKey,
-                                               masterMaxKey, masterMapWidth, &amp;col);
-        XTestFakeKeyEvent(display_, fakeKeysym, 0, 0);
-        sentFakeModeSwitchRelease = 1;
-      }
-      if (level3ShiftOn)
-      {
-        fakeKeysym = keymapKeysymToKeycode(XK_ISO_Level3_Shift, masterKeysyms, masterMinKey,
-                                               masterMaxKey, masterMapWidth, &amp;col);
-        XTestFakeKeyEvent(display_, fakeKeysym, 0, 0);
-        sentFakeLevel3ShiftRelease = 1;
-      }
-      if (altROn)
-      {
-        fakeKeysym = keymapKeysymToKeycode(XK_Alt_R, masterKeysyms, masterMinKey,
-                                               masterMaxKey, masterMapWidth, &amp;col);
-        XTestFakeKeyEvent(display_, fakeKeysym, 0, 0);
-        sentFakeAltRRelease = 1;
-      }
-    }
-  }
-}
-
-void Poller::cancelFakeModifierEvents()
-{
-  KeySym fakeKeysym;
-  int col;
-
-  if (sentFakeLShiftPress)
-  {
-    logTest(&quot;Poller::handleKeyboardEvent&quot;, &quot;Fake Shift_L key press event has been sent&quot;);
-    logTest(&quot;Poller::handleKeyboardEvent&quot;, &quot;Sending fake Shift_L key release event&quot;);
-
-    fakeKeysym = keymapKeysymToKeycode(XK_Shift_L, masterKeysyms, masterMinKey,
-                                           masterMaxKey, masterMapWidth, &amp;col);
-    XTestFakeKeyEvent(display_, fakeKeysym, 0, 0);
-
-    sentFakeLShiftPress = 0;
-  }
-
-  if (sentFakeLShiftRelease)
-  {
-    logTest(&quot;Poller::handleKeyboardEvent&quot;, &quot;Fake Shift_L key release event has been sent&quot;);
-    logTest(&quot;Poller::handleKeyboardEvent&quot;, &quot;Sending fake Shift_L key press event&quot;);
-
-    fakeKeysym = keymapKeysymToKeycode(XK_Shift_L, masterKeysyms, masterMinKey,
-                                           masterMaxKey, masterMapWidth, &amp;col);
-    XTestFakeKeyEvent(display_, fakeKeysym, 1, 0);
-
-    sentFakeLShiftRelease = 0;
-  }
-
-  if (sentFakeRShiftRelease)
-  {
-    logTest(&quot;Poller::handleKeyboardEvent&quot;, &quot;Fake Shift_R key release event has been sent&quot;);
-    logTest(&quot;Poller::handleKeyboardEvent&quot;, &quot;Sending fake Shift_R key press event&quot;);
-
-    fakeKeysym = keymapKeysymToKeycode(XK_Shift_R, masterKeysyms, masterMinKey,
-                                           masterMaxKey, masterMapWidth, &amp;col);
-    XTestFakeKeyEvent(display_, fakeKeysym, 1, 0);
-
-    sentFakeRShiftRelease = 0;
-  }
-
-  if (sentFakeModeSwitchPress)
-  {
-    logTest(&quot;Poller::handleKeyboardEvent&quot;, &quot;Fake Mode_switch key press event has been sent&quot;);
-    logTest(&quot;Poller::handleKeyboardEvent&quot;, &quot;Sending fake Mode_switch key release event&quot;);
-
-    fakeKeysym = keymapKeysymToKeycode(XK_Mode_switch, masterKeysyms, masterMinKey,
-                                           masterMaxKey, masterMapWidth, &amp;col);
-    XTestFakeKeyEvent(display_, fakeKeysym, 0, 0);
-
-    sentFakeModeSwitchPress = 0;
-  }
-
-  if (sentFakeModeSwitchRelease)
-  {
-    logTest(&quot;Poller::handleKeyboardEvent&quot;, &quot;Fake Mode_switch key release event has been sent&quot;);
-    logTest(&quot;Poller::handleKeyboardEvent&quot;, &quot;Sending Mode_switch key press event&quot;);
-
-    fakeKeysym = keymapKeysymToKeycode(XK_Mode_switch, masterKeysyms, masterMinKey,
-                                           masterMaxKey, masterMapWidth, &amp;col);
-    XTestFakeKeyEvent(display_, fakeKeysym, 1, 0);
-
-    sentFakeModeSwitchRelease = 0;
-  }
-
-  if (sentFakeLevel3ShiftPress)
-  {
-    logTest(&quot;Poller::handleKeyboardEvent&quot;, &quot;Fake ISO_Level3_Shift key press event has been sent&quot;);
-    logTest(&quot;Poller::handleKeyboardEvent&quot;, &quot;Sending fake ISO_Level3_Shift key release event&quot;);
-
-    fakeKeysym = keymapKeysymToKeycode(XK_ISO_Level3_Shift, masterKeysyms, masterMinKey,
-                                           masterMaxKey, masterMapWidth, &amp;col);
-    XTestFakeKeyEvent(display_, fakeKeysym, 0, 0);
-
-    sentFakeLevel3ShiftPress = 0;
-  }
-
-  if (sentFakeLevel3ShiftRelease)
-  {
-    logTest(&quot;Poller::handleKeyboardEvent&quot;, &quot;Fake ISO_Level3_Shift key release event has been sent&quot;);
-    logTest(&quot;Poller::handleKeyboardEvent&quot;, &quot;Sending fake ISO_Level3_Shift key press event&quot;);
-
-    fakeKeysym = keymapKeysymToKeycode(XK_ISO_Level3_Shift, masterKeysyms, masterMinKey,
-                                           masterMaxKey, masterMapWidth, &amp;col);
-    XTestFakeKeyEvent(display_, fakeKeysym, 1, 0);
-
-    sentFakeLevel3ShiftRelease = 0;
-  }
-
-  if (sentFakeAltRRelease)
-  {
-    logTest(&quot;Poller::handleKeyboardEvent&quot;, &quot;Fake XK_Alt_R key release event has been sent&quot;);
-    logTest(&quot;Poller::handleKeyboardEvent&quot;, &quot;Sending fake XK_Alt_R key press event&quot;);
-
-    fakeKeysym = keymapKeysymToKeycode(XK_Alt_R, masterKeysyms, masterMinKey,
-                                           masterMaxKey, masterMapWidth, &amp;col);
-    XTestFakeKeyEvent(display_, fakeKeysym, 1, 0);
-
-    sentFakeAltRRelease = 0;
-  }
-}
-
-Bool Poller::keyIsDown(KeyCode keycode)
-{
-  KeyPressedRec *downKey;
-
-  downKey = shadowKeyPressedPtr;
-
-  while (downKey)
-  {
-    if (downKey -&gt; keyRcvd == keycode)
-    {
-      return True;
-    }
-    downKey = downKey -&gt; next;
-  }
-
-  return False;
-}
-
-void Poller::addKeyPressed(KeyCode received, KeyCode sent)
-{
-  KeyPressedRec *downKey;
-
-  if (!keyIsDown(received))
-  {
-    if (shadowKeyPressedPtr == NULL)
-    {
-      shadowKeyPressedPtr = (KeyPressedRec *) malloc(sizeof(KeyPressedRec));
-
-      shadowKeyPressedPtr -&gt; keyRcvd = received;
-      shadowKeyPressedPtr -&gt; keySent = sent;
-      shadowKeyPressedPtr -&gt; next = NULL;
-    }
-    else
-    {
-      downKey = shadowKeyPressedPtr;
-
-      while (downKey -&gt; next != NULL)
-      {
-        downKey = downKey -&gt; next;
-      }
-
-      downKey -&gt; next = (KeyPressedRec *) malloc(sizeof(KeyPressedRec));
-
-      downKey -&gt; next -&gt; keyRcvd = received;
-      downKey -&gt; next -&gt; keySent = sent;
-      downKey -&gt; next -&gt; next = NULL;
-    }
-  }
-}
-
-KeyCode Poller::getKeyPressed(KeyCode received)
-{
-  KeyCode sent;
-  KeyPressedRec *downKey;
-  KeyPressedRec *tempKey;
-
-  if (shadowKeyPressedPtr != NULL)
-  {
-    if (shadowKeyPressedPtr -&gt; keyRcvd == received)
-    {
-      sent = shadowKeyPressedPtr -&gt; keySent;
-
-      tempKey = shadowKeyPressedPtr;
-      shadowKeyPressedPtr = shadowKeyPressedPtr -&gt; next;
-      free(tempKey);
-
-      return sent;
-    }
-    else
-    {
-      downKey = shadowKeyPressedPtr;
-
-      while (downKey -&gt; next != NULL)
-      {
-        if (downKey -&gt; next -&gt; keyRcvd == received)
-        {
-          sent = downKey -&gt; next -&gt; keySent;
-
-          tempKey = downKey -&gt; next;
-          downKey -&gt; next = downKey -&gt; next -&gt; next;
-          free(tempKey);
-
-          return sent;
-        }
-        else
-        {
-          downKey = downKey -&gt; next;
-        }
-      }
-    }
-  }
-  return 0;
-}
-
-void Poller::handleKeyboardEvent(Display *display, XEvent *event)
-{
-  if (xtestExtension_ == 0 || display_ == 0)
-  {
-    return;
-  }
-
-  logTest(&quot;Poller::handleKeyboardEvent&quot;, &quot;Handling event at [%p]&quot;, event);
-
-#ifdef TRANSLATE_ALWAYS
-
-  KeyCode keycode;
-  KeySym keysym;
-
-  int col = 0;
-
-  Bool isKeyPress = False;
-  Bool isModifier = False;
-  Bool isShiftComb = False;
-  Bool skip = False;
-
-  if (event -&gt; type == KeyPress)
-  {
-    isKeyPress = True;
-  }
-
-  if (shadowKeysyms == NULL)
-  {
-    keymapShadowInit(event -&gt; xkey.display);
-  }
-
-  if (masterKeysyms == NULL)
-  {
-    keymapMasterInit();
-  }
-
-  if (shadowKeysyms == NULL || masterKeysyms == NULL)
-  {
-    logTest(&quot;Poller::handleKeyboardEvent&quot;, &quot;Unable to initialize keymaps. Do not translate&quot;);
-
-    keycode = event -&gt; xkey.keycode;
-
-    goto SendKeycode;
-  }
-
-  keysym = keymapKeycodeToKeysym(event -&gt; xkey.keycode, shadowKeysyms,
-                                   shadowMinKey, shadowMapWidth, 0);
-
-  isModifier = checkModifierKeys(keysym, isKeyPress);
-
-  if (event -&gt; type == KeyRelease)
-  {
-    KeyCode keycodeToSend;
-
-    keycodeToSend = getKeyPressed(event -&gt; xkey.keycode);
-
-    if (keycodeToSend)
-    {
-      keycode = keycodeToSend;
-
-      goto SendKeycode;
-    }
-  }
-
-  /*
-   * Convert case for Solaris keyboard.
-   */
-
-  if (((keysym &gt;&gt; 8) == 0) &amp;&amp; (keysym &gt;= XK_A) &amp;&amp; (keysym &lt;= XK_Z))
-  {
-    if (!leftShiftOn &amp;&amp; !rightShiftOn)
-    {
-      keysym += XK_a - XK_A;
-    }
-    else
-    {
-      skip = True;
-    }
-  }
-
-  if (!isModifier)
-  {
-    if ((leftShiftOn || rightShiftOn) &amp;&amp;
-            (!modeSwitchOn &amp;&amp; !level3ShiftOn &amp;&amp; !altROn) &amp;&amp;
-                !skip)
-    {
-      KeySym tempKeysym = keymapKeycodeToKeysym(event -&gt; xkey.keycode, shadowKeysyms,
-                                                    shadowMinKey, shadowMapWidth, 1);
-
-      if (tempKeysym == 0)
-      {
-        isShiftComb = True;
-      }
-      else
-      {
-        keysym = tempKeysym;
-      }
-    }
-    else if ((!leftShiftOn &amp;&amp; !rightShiftOn) &amp;&amp;
-                 (modeSwitchOn || level3ShiftOn || altROn))
-    {
-      keysym = keymapKeycodeToKeysym(event -&gt; xkey.keycode, shadowKeysyms,
-                                         shadowMinKey, shadowMapWidth, 2);
-    }
-    else if ((leftShiftOn || rightShiftOn) &amp;&amp;
-                 (modeSwitchOn || level3ShiftOn || altROn))
-    {
-      keysym = keymapKeycodeToKeysym(event -&gt; xkey.keycode, shadowKeysyms,
-                                       shadowMinKey, shadowMapWidth, 3);
-    }
-  }
-
-  if (keysym == 0)
-  {
-    logTest(&quot;Poller::handleKeyboardEvent&quot;, &quot;Null keysym. Return&quot;);
-
-    return;
-  }
-
-  logTest(&quot;Poller::handleKeyboardEvent&quot;, &quot;keysym [%x] [%s]&quot;,
-              (unsigned int)keysym, XKeysymToString(keysym));
-
-  if (keysym == XK_Mode_switch)
-  {
-    keysym = XK_ISO_Level3_Shift;
-  }
-
-  keycode = translateKeysymToKeycode(keysym, &amp;col);
-
-  if (keycode == 0)
-  {
-    logTest(&quot;Poller::handleKeyboardEvent&quot;, &quot;No keycode found for keysym [%x] [%s]. Return&quot;,
-                (unsigned int)keysym, XKeysymToString(keysym));
-    return;
-  }
-
-  logTest(&quot;Poller::handleKeyboardEvent&quot;, &quot;keycode [%d] translated into keycode [%d]&quot;,
-              (int)event -&gt; xkey.keycode, (unsigned int)keycode);
-
-  if (event -&gt; type == KeyPress)
-  {
-    addKeyPressed(event -&gt; xkey.keycode, keycode);
-  }
-
-  /*
-   * Send fake modifier events.
-   */
-
-  if (!isModifier &amp;&amp; isShiftComb == False)
-  {
-    sendFakeModifierEvents(col, ((keysym &gt;&gt; 8) == 0) &amp;&amp; (keysym &gt;= XK_A) &amp;&amp; (keysym &lt;= XK_Z));
-  }
-
-SendKeycode:
-
-  /*
-   * Send the event.
-   */
-
-  XTestFakeKeyEvent(display_, keycode, isKeyPress, 0);
-
-  /*
-   * Check if fake modifier events have been sent.
-   */
-
-  cancelFakeModifierEvents();
-
-#else // TRANSLATE_ALWAYS
-
-  //
-  // Use keysyms to translate keycodes across different
-  // keyboard models. Unuseful when both keyboards have
-  // same keycodes (e.g. both are pc keyboards).
-  //
-
-  #ifdef TRANSLATE_KEYCODES
-
-  KeyCode keycode = XKeysymToKeycode(display_, XK_A);
-
-  if (XKeysymToKeycode(event -&gt; xkey.display, XK_A) != keycode)
-  {
-    KeySym keysym = XKeycodeToKeysym(event -&gt; xkey.display, event -&gt; xkey.keycode, 0);
-  
-    if (keysym == XK_Mode_switch || keysym == XK_ISO_Level3_Shift)
-    {
-      logUser(&quot;Poller::handleKeyboardEvent: keysym [%x].\n&quot;, (unsigned int)keysym);
-  
-      if (XKeycodeToKeysym(display_, 113, 0) == XK_ISO_Level3_Shift ||
-             (XKeycodeToKeysym(display_, 124, 0) == XK_ISO_Level3_Shift))
-      {
-        event -&gt; xkey.keycode = 113;
-      }
-      else
-      {
-        event -&gt; xkey.keycode = XKeysymToKeycode(display_, XK_Mode_switch);
-      }
-  
-      logUser(&quot;Poller::handleKeyboardEvent: keycode translated to [%x].\n&quot;, (unsigned int)event -&gt; xkey.keycode);
-    }
-    else
-    {
-      event -&gt; xkey.keycode = XKeysymToKeycode(display_, keysym);
-    }
-  }
-
-  #endif // TRANSLATE_KEYCODES
-
-  if (event -&gt; type == KeyPress)
-  {
-    XTestFakeKeyEvent(display_, event -&gt; xkey.keycode, 1, 0);
-  }
-  else if (event -&gt; type == KeyRelease)
-  {
-    XTestFakeKeyEvent(display_, event -&gt; xkey.keycode, 0, 0);
-  }
-
-#endif // TRANSLATE_ALWAYS
-}
-
-void Poller::handleWebKeyboardEvent(KeySym keysym, Bool isKeyPress)
-{
-  KeyCode keycode;
-  int col;
-
-  if (masterKeysyms == NULL)
-  {
-    keymapMasterInit();
-  }
-
-  if (masterKeysyms == NULL)
-  {
-    logTest(&quot;Poller::handleWebKeyboardEvent&quot;, &quot;Unable to initialize keymap&quot;);
-
-    return;
-  }
-
-  keycode = translateKeysymToKeycode(keysym, &amp;col);
-
-  if (keycode == 0)
-  {
-    logTest(&quot;Poller::handleKeyboardEvent&quot;, &quot;No keycode found for keysym [%x] [%s]. Return&quot;,
-                (unsigned int)keysym, XKeysymToString(keysym));
-    return;
-  }
-
-  logTest(&quot;Poller::handleKeyboardEvent&quot;, &quot;keysym [%x] [%s] translated into keycode [%x]&quot;,
-              (unsigned int)keysym, XKeysymToString(keysym), (unsigned int)keycode);
-
-  /*
-   * Send fake modifier events.
-   */
-
-  if (!checkModifierKeys(keysym, isKeyPress))
-  {
-    sendFakeModifierEvents(col, False);
-  }
-
-  /*
-   * Send the event.
-   */
-
-  XTestFakeKeyEvent(display_, keycode, isKeyPress, 0);
-
-  /*
-   * Check if fake modifier events have been sent.
-   */
-
-  cancelFakeModifierEvents();
-
-}
-
-void Poller::handleMouseEvent(Display *display, XEvent *event)
-{
-  if (xtestExtension_ == 0 || display_ == 0)
-  {
-    return;
-  }
-
-  if (event -&gt; type == MotionNotify)
-  {
-    XTestFakeMotionEvent(display_, 0, event -&gt; xmotion.x, event -&gt; xmotion.y, 0);
-  }
-  else if (event -&gt; type == ButtonPress)
-  {
-    XTestFakeButtonEvent(display_, event -&gt; xbutton.button, True, 0);
-  }
-  else if (event -&gt; type == ButtonRelease)
-  {
-    XTestFakeButtonEvent(display_, event -&gt; xbutton.button, False, 0);
-  }
-
-  XFlush(display_);
-}
-
-void Poller::setRootSize(void)
-{
-  width_ = WidthOfScreen(DefaultScreenOfDisplay(display_));
-  height_ = HeightOfScreen(DefaultScreenOfDisplay(display_));
-  depth_ = DefaultDepth(display_, DefaultScreen(display_));
-
-  if (depth_ == 8) bpp_ = 1;
-  else if (depth_ == 16) bpp_ = 2;
-  else bpp_ = 4;
-
-  bpl_ = width_ * bpp_;
-}
-
-void Poller::destroyShmImage(void)
-{
-    XShmDetach(display_, shminfo_);
-    XDestroyImage(image_);
-    image_ = NULL;
-
-    shmdt(shminfo_ -&gt; shmaddr);
-    shmctl(shminfo_ -&gt; shmid, IPC_RMID, 0);
-
-    delete shminfo_;
-    shminfo_ = NULL;
-}
-
-void Poller::xtestInit(void)
-{
-  int eventBase;
-  int errorBase;
-  int versionMajor;
-  int versionMinor;
-  int result;
-
-  xtestExtension_ = 0;
-
-  result = XTestQueryExtension(display_, &amp;eventBase, &amp;errorBase, &amp;versionMajor, &amp;versionMinor);
-
-  if (result == 0)
-  {
-    xtestExtension_ = 0;
-
-    logWarning(&quot;Poller::xtestInit&quot;, &quot;Failed while querying for XTEST extension.&quot;);
-  }
-  else
-  {
-    logDebug(&quot;Poller::xtestInit&quot;, &quot;XTEST version %d.%d.&quot;, versionMajor, versionMinor);
-
-    xtestExtension_ = 1;
-  }
-
-  //
-  // Make this client impervious to grabs.
-  //
-
-  if (xtestExtension_ == 1)
-  {
-    XTestGrabControl(display_, 1);
-  }
-}
-
-void Poller::randrInit(void)
-{
-  int randrEventBase;
-  int randrErrorBase;
-
-  if (XRRQueryExtension(display_, &amp;randrEventBase, &amp;randrErrorBase) == 0)
-  {
-    logWarning(&quot;Poller::randrInit&quot;, &quot;Randr extension not supported on this &quot;
-                   &quot;display.&quot;);
-
-    randrExtension_ = 0;
-
-    return;
-  }
-
-  XRRSelectInput(display_, DefaultRootWindow(display_),
-                     RRScreenChangeNotifyMask);
-
-  randrEventBase_ = randrEventBase;
-
-  randrExtension_ = 1;
-
-  return;
-}
-
-void Poller::damageInit(void)
-{
-  int damageMajorVersion = 0;
-  int damageMinorVersion = 0;
-
-  int damageEventBase = 0;
-  int damageErrorBase = 0;
-
-  if (damageExtension_ &gt;= 0)
-  {
-    logDebug(&quot;Poller::damageInit&quot;, &quot;Called with damage already initialized.&quot;);
-  }
-
-  if (damageExtension_ == 0)
-  {
-    logDebug(&quot;Poller::damageInit&quot;, &quot;Damage disabled. Skip initialization.&quot;);
-
-    return;
-  }
-
-  if (damageExtension_ &lt; 0 &amp;&amp; NXShadowOptions.optionDamageExtension == 0)
-  {
-    damageExtension_ = 0;
-
-    logUser(&quot;Poller::damageInit: Disabling use of DAMAGE extension.\n&quot;);
-
-    return;
-  }
-
-  damageExtension_ = 0;
-
-  mirrorChanges_ = 0;
-
-  if (XDamageQueryExtension(display_, &amp;damageEventBase, &amp;damageErrorBase) == 0)
-  {
-    logUser(&quot;Poller::damageInit: DAMAGE not supported.\n&quot;);
-
-    return;
-  }
-  #ifdef DEBUG
-  else
-  {
-    fprintf(stderr, &quot;Poller::damageInit: DAMAGE supported. &quot;
-                &quot;Event base [%d] error base [%d].\n&quot;, damageEventBase, damageErrorBase);
-  }
-  #endif
-
-  damageEventBase_ = damageEventBase;
-
-  if (XDamageQueryVersion(display_, &amp;damageMajorVersion, &amp;damageMinorVersion) == 0)
-  {
-    logWarning(&quot;Poller::damageInit&quot;, &quot;Error on querying DAMAGE version.\n&quot;);
-
-    damageExtension_ = 0;
-
-    return;
-  }
-  #ifdef DEBUG
-  else
-  {
-    fprintf(stderr, &quot;Poller::damageInit: DAMAGE version %d.%d.\n&quot;,
-                damageMajorVersion, damageMinorVersion);
-  }
-  #endif
-
-  damage_ = XDamageCreate(display_, DefaultRootWindow(display_), XDamageReportRawRectangles);
-
-  damageExtension_= 1;
-
-  mirror_ = 1;
-
-  return;
-}
-
-void Poller::getEvents(void)
-{
-  XEvent X;
-
-  if (damageExtension_ == 1)
-  {
-    XDamageSubtract(display_, damage_, None, None);
-  }
-
-  XSync(display_, 0);
-
-  while (XCheckIfEvent(display_, &amp;X, anyEventPredicate, NULL) == 1)
-  {
-    if (randrExtension_ == 1 &amp;&amp; (X.type == randrEventBase_ + RRScreenChangeNotify || X.type == ConfigureNotify))
-    {
-      XRRUpdateConfiguration(&amp;X);
-
-      handleRRScreenChangeNotify(&amp;X);
-
-      continue;
-    }
-
-    if (damageExtension_ == 1 &amp;&amp; X.type == damageEventBase_ + XDamageNotify)
-    {
-      handleDamageNotify(&amp;X);
-    }
-  }
-
-  if (damageExtension_ == 1)
-  {
-    updateDamagedAreas();
-  }
-
-  XFlush(display_);
-}
-
-void Poller::handleRRScreenChangeNotify(XEvent *X)
-{
-  return;
-}
-
-void Poller::handleDamageNotify(XEvent *X)
-{
-  XDamageNotifyEvent *e = (XDamageNotifyEvent *) X;
-
-  //
-  //  e-&gt;drawable is the window ID of the damaged window
-  //  e-&gt;geometry is the geometry of the damaged window
-  //  e-&gt;area     is the bounding rect for the damaged area
-  //  e-&gt;damage   is the damage handle returned by XDamageCreate()
-  //
-
-  #ifdef DEBUG
-  fprintf(stderr, &quot;handleDamageNotify: drawable [%d] damage [%d] geometry [%d][%d][%d][%d] area [%d][%d][%d][%d].\n&quot;,
-              (int) e -&gt; drawable, (int) e -&gt; damage, e -&gt; geometry.x, e -&gt; geometry.y,
-                  e -&gt; geometry.width, e -&gt; geometry.height, e -&gt; area.x, e -&gt; area.y,
-                      e -&gt; area.width, e -&gt; area.height);
-  #endif
-
-  XRectangle rectangle = {e -&gt; area.x, e -&gt; area.y, e -&gt; area.width, e -&gt; area.height};
-
-  XUnionRectWithRegion(&amp;rectangle, lastUpdatedRegion_, lastUpdatedRegion_);
-
-  mirrorChanges_ = 1;
-
-  return;
-}
-
-void Poller::updateDamagedAreas(void)
-{
-  BOX *boxPtr;
-
-  XRectangle rectangle;
-
-  int i;
-  int y;
-  
-  for (i = 0; i &lt; lastUpdatedRegion_ -&gt; numRects; i++)
-  {
-    boxPtr = lastUpdatedRegion_ -&gt; rects + i;
-
-    if (shmExtension_ == 1)
-    {
-      image_ -&gt; width  = boxPtr -&gt; x2 - boxPtr -&gt; x1;
-      image_ -&gt; height = boxPtr -&gt; y2 - boxPtr -&gt; y1;
-      image_ -&gt; bytes_per_line =
-          ROUNDUP((image_ -&gt; bits_per_pixel * image_ -&gt; width),
-                      image_ -&gt; bitmap_pad);
-      
-      if (XShmGetImage(display_, DefaultRootWindow(display_), image_,
-                           boxPtr -&gt; x1, boxPtr -&gt; y1, AllPlanes) == 0)
-      {
-        logDebug(&quot;Poller::updateDamagedAreas&quot;, &quot;XShmGetImage failed!&quot;);
-
-        return;
-      }
-    }
-    else if (shmExtension_ == 0)
-    {
-      image_ = XGetImage(display_, DefaultRootWindow(display_), boxPtr -&gt; x1,
-                             boxPtr -&gt; y1, boxPtr -&gt; x2 - boxPtr -&gt; x1,
-                                 boxPtr -&gt; y2 - boxPtr -&gt; y1, AllPlanes,
-                                     ZPixmap);
-
-      if (image_ == NULL)
-      {
-        logDebug(&quot;Poller::updateDamagedAreas&quot;, &quot;XGetImage failed!&quot;);
-
-        return;
-      }
-
-      image_ -&gt; width  = boxPtr -&gt; x2 - boxPtr -&gt; x1;
-      image_ -&gt; height = boxPtr -&gt; y2 - boxPtr -&gt; y1;
-      image_ -&gt; bytes_per_line =
-          ROUNDUP((image_ -&gt; bits_per_pixel * image_ -&gt; width),
-                      image_ -&gt; bitmap_pad);
-    }
-
-    rectangle.height = 1;
-    rectangle.width = image_ -&gt; width;
-    rectangle.x = boxPtr -&gt; x1;
-    rectangle.y = boxPtr -&gt; y1;
-
-    for (y = 0; y &lt; image_ -&gt; height; y++)
-    {
-      update(image_ -&gt; data + y * image_ -&gt; bytes_per_line, rectangle);
-
-      rectangle.y++; 
-    }
-
-    if (shmExtension_ != 1)
-    {
-       XDestroyImage(image_);
-
-      image_ = NULL;
-    }
-  }
-
-  return;
-}
-
-void Poller::getScreenSize(int *w, int *h)
-{
-  *w = WidthOfScreen(DefaultScreenOfDisplay(display_));
-  *h = HeightOfScreen(DefaultScreenOfDisplay(display_));
-}
-
-void Poller::setScreenSize(int *w, int *h)
-{
-  setRootSize();
-
-  shmInitTrap = 1;
-  shmInit();
-  shmInitTrap = 0;
-
-  *w = width_;
-  *h = height_;
-
-  logDebug(&quot;Poller::setScreenSize&quot;, &quot;New size of screen [%d, %d]&quot;, width_, height_);
-}
-
-int anyEventPredicate(Display *display, XEvent *event, XPointer parameter)
-{
-  return 1;
-}
-
-#endif /* !defined(__CYGWIN32__) &amp;&amp; !defined(WIN32) */
diff --git a/nxcompshad/X11.h b/nxcompshad/X11.h
deleted file mode 100644
index 2127542..0000000
--- a/nxcompshad/X11.h
+++ /dev/null
@@ -1,131 +0,0 @@
-/**************************************************************************/
-/*                                                                        */
-/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
-/*                                                                        */
-/* NXCOMPSHAD, NX protocol compression and NX extensions to this software */
-/* are copyright of NoMachine. Redistribution and use of the present      */
-/* software is allowed according to terms specified in the file LICENSE   */
-/* which comes in the source distribution.                                */
-/*                                                                        */
-/* Check <A HREF="http://www.nomachine.com/licensing.html">http://www.nomachine.com/licensing.html</A> for applicability.       */
-/*                                                                        */
-/* NX and NoMachine are trademarks of Medialogic S.p.A.                   */
-/*                                                                        */
-/* All rights reserved.                                                   */
-/*                                                                        */
-/**************************************************************************/
-
-#ifndef X11Poller_H
-#define X11Poller_H
-
-#include &lt;X11/Xlib.h&gt;
-#include &lt;X11/extensions/XShm.h&gt;
-#include &lt;X11/extensions/Xdamage.h&gt;
-#include &lt;X11/extensions/Xrandr.h&gt;
-
-#include &quot;Core.h&quot;
-
-class Poller : public CorePoller
-{
-  public:
-
-  Poller(Input *, Display *display, int = 0);
-
-  ~Poller();
-
-  int init();
-
-  void setRootSize();
-
-  void destroyShmImage();
-
-  void getEvents(void);
-
-  void getScreenSize(int *width, int *height);
-
-  void setScreenSize(int *width, int *height);
-
-  private:
-
-  Display *display_;
-
-  char *shadowDisplayName_;
-
-  int shadowDisplayUid_;
-
-  char *tmpBuffer_;
-
-  char xtestExtension_;
-
-  char shmExtension_;
-
-  char randrExtension_;
-
-  int randrEventBase_;
-
-  char damageExtension_;
-
-  int damageEventBase_;
-
-  Damage damage_;
-
-  Region repair_;
-
-  char damageChanges_;
-
-  XShmSegmentInfo *shminfo_;
-
-  XImage *image_;
-
-  int updateShadowFrameBuffer(void);
-
-  char *getRect(XRectangle);
-
-  void keymapShadowInit(Display *display);
-
-  void keymapMasterInit();
-
-  KeySym keymapKeycodeToKeysym(KeyCode keycode, KeySym *keysyms,
-                                   int minKey, int per, int col);
-
-  KeyCode keymapKeysymToKeycode(KeySym keysym, KeySym *keysyms,
-                                    int minKey, int maxKey, int per, int *col);
-
-  KeyCode translateKeysymToKeycode(KeySym keysym, int *col);
-
-  Bool checkModifierKeys(KeySym keysym, Bool isKeyPress);
-
-  void sendFakeModifierEvents(int pos, Bool skip);
-
-  void cancelFakeModifierEvents();
-
-  Bool keyIsDown(KeyCode keycode);
-
-  void addKeyPressed(KeyCode received, KeyCode sent);
-
-  KeyCode getKeyPressed(KeyCode received);
-
-  void handleKeyboardEvent(Display *display, XEvent *);
-
-  void handleWebKeyboardEvent(KeySym keysym, Bool isKeyPress);
-
-  void handleMouseEvent(Display *, XEvent *);
-
-  void xtestInit(void);
-
-  void shmInit(void);
-
-  void randrInit(void);
-
-  void damageInit(void);
-
-  void handleRRScreenChangeNotify(XEvent *);
-
-  void handleDamageNotify(XEvent *);
-
-  void updateDamagedAreas(void);
-};
-
-int anyEventPredicate(Display *display, XEvent *event, XPointer parameter);
-
-#endif /* X11Poller_H */
diff --git a/nxproxy/CHANGELOG b/nxproxy/CHANGELOG
new file mode 100644
index 0000000..f24de41
--- /dev/null
+++ b/nxproxy/CHANGELOG
@@ -0,0 +1,180 @@
+ChangeLog:
+
+nxproxy-3.0.0-4
+
+- Added file COPYING.
+
+- Changed the LICENSE file to state that the software is only made
+  available under the version 2 of the GPL.
+
+nxproxy-3.0.0-3
+
+- Updated the copyright notices to year 2007.
+
+nxproxy-3.0.0-2
+
+- Updated the file VERSION.
+
+nxproxy-3.0.0-1
+
+- Opened the 3.0.0 branch based on nxproxy-2.0.0-2.
+
+nxproxy-2.0.0-2
+
+- Updated copyright to year 2006.
+
+nxproxy-2.0.0-1
+
+- Opened the 2.0.0 branch based on nxproxy-1.5.0-10.
+
+nxproxy-1.5.0-10
+
+- Added the JPEG, PNG and Z libraries to the linker when compiling
+  on Cygwin. GCC 3.3.x requires that these libraries are explicitly
+  given while this is not required since GCC 3.4.x.
+
+- Created a new configure using autoconf 2.59.
+
+nxproxy-1.5.0-9
+
+- Removed provision for dynamically loading a different version of
+  the nxcomp library.
+
+nxproxy-1.5.0-8
+
+- Updated to reflect the new naming of the NX transport interfaces.
+
+nxproxy-1.5.0-7
+
+- Modified the Makefile.in to remove the *.out.* files generated by
+  Valgrind when running a 'make clean'.
+
+- Modified the README files and removed files that were outdated.
+
+nxproxy-1.5.0-6
+
+- Removed the NX_FORCE_IDLE_PROXY stubs.
+
+nxproxy-1.5.0-5
+
+- This version has NX_FORCE_IDLE_PROXY undefined, so it should work
+  in a way that is compatible with the old nxproxy.
+
+nxproxy-1.5.0-4
+
+- This software is crafted by default to test the new integration
+  between nxcomp and nxssh. The process will stay idle and will
+  let nxssh create the proxy. Note that the session log will go to
+  'sshlog', not to 'session'. This will have to be fixed in nxcomp
+  in future versions.
+
+- Removed the references to the &quot;bind&quot; functionality that is not
+  used in the current software.
+
+nxproxy-1.5.0-3
+
+- Added a NX_FORCE_IDLE_PROXY. If set, nxproxy will stay idle and
+  will not try to create a nxcomp proxy. This is used for testing
+  the new in-process nxcomp functionalities with the development
+  versions of nxclient and nxssh software.
+
+nxproxy-1.5.0-2
+
+- Small changes to this file.
+
+nxproxy-1.5.0-1
+
+- Opened the 1.5.0 branch.
+
+nxproxy-1.4.1-1
+
+- Opened the 1.4.1 branch.
+
+nxproxy-1.4.0-3
+
+- We were lucky. We found a machine where nxproxy failed exactly
+  in the same way described by multiple users in their reports.
+  The error was the same ('dlopen: win32 line 126') and neither
+  rebasing the Cygwin DLLs or removing all the other Cygwin li-
+  braries worked. So the problem had necessarily to be in a bug-
+  gy Cygwin dlopen() implementation. To solve this I had to make
+  changes to the nxproxy code on Windows, so it links to nxcomp
+  at compile time in the way specified below. As far as I can
+  tell, any other way fails. This seems to be another Cygwin bug:
+  the linker says that everything is OK but then the executable
+  can't be run. Both the Cygwin's bash and the command.com say
+  'Permission denied'.
+
+  LIBS = -L../nxcomp -lstdc++ -Wl,-e,_mainCRTStartup -lXcomp \
+         -lcygipc -static -lpng -static -ljpeg -lz
+
+nxproxy-1.4.0-2
+
+- Added a Binder class invoked when calling proxy with -B option.
+  It would serve as a replacement of the modifications I'm doing
+  in nxssh. The class is just a framework and the implementation
+  is unfinished.
+
+- Solved a potential problem in Main.c with NXExit() being called
+  after the dlclose(). This was unlikely to happen as proxy never
+  returns.
+
+nxproxy-1.4.0-1
+
+- Opened the 1.4.0 branch.
+
+nxproxy-1.3.2-1
+
+- Opened the 1.3.2 branch.
+
+nxproxy-1.3.1-2
+
+- Removed the underline characters and added a colon in the
+  title of this ChangeLog to fully comply with format used in
+  the release notices.
+
+nxproxy-1.3.1-1
+
+- Opened the 1.3.1 branch.
+
+nxproxy-1.3.0-7
+
+- Added a check on the OS version when running on MacOS/X.
+  Versions 10.2 and 10.3 differ in the way names are mangled.
+
+- Fixed error detection on dlsym(). The previous code was not
+  able to correctly identify missing symbols.
+
+nxproxy-1.3.0-6
+
+- Modified configure.in to compile under FreeBSD.
+
+nxproxy-1.3.0-5
+
+- Fixed a (further) compilation problem under Cygwin.
+
+nxproxy-1.3.0-4
+
+- New nxproxy is able to load libXcomp by dlopen() under
+  Cygwin. This simplifies both code in Main.c and the
+  configure.in script.
+
+- Changed configure.in to not link with -mwindows under
+  Cygwin. Linking with -mwindows prevented stderr to be
+  correctly output when running nxproxy on a console.
+
+nxproxy-1.3.0-3
+
+- Changed configure.in to first check for nx-X11 includes
+  and libraries. Added &quot;/usr/openwin/bin/makedepend&quot; to
+  path searched for the executable.
+
+nxproxy-1.3.0-2
+
+- Small cleanup in configure.in. A new configure script has
+  been generated using autoconf-2.57-3.
+
+nxproxy-1.3.0-1
+
+- Updated internal version, so this release tries to load
+  libXcomp version 1.3.0.
diff --git a/nxcompshad/COPYING b/nxproxy/COPYING
similarity index 100%
rename from nxcompshad/COPYING
rename to nxproxy/COPYING
diff --git a/nxproxy/LICENSE b/nxproxy/LICENSE
new file mode 100644
index 0000000..000fb98
--- /dev/null
+++ b/nxproxy/LICENSE
@@ -0,0 +1,36 @@
+Copyright (C) 2001, 2007 NoMachine - <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>
+
+NXPROXY and NX extensions to this software are copyright of NoMachine.
+Redistribution and use of this software is allowed according to the
+following terms:
+
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License Version 2, and
+not any other version, as published by the Free Software Foundation.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program; if not, write to the Free Software
+Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA
+
+Parts of this software are derived from DXPC project. These copyright
+notices apply to original DXPC code:
+
+Redistribution and use in source and binary forms are permitted provided
+that the above copyright notice and this paragraph are duplicated in all
+such forms.
+
+THIS SOFTWARE IS PROVIDED ``AS IS'' AND WITHOUT ANY EXPRESS OR IMPLIED
+WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE IMPLIED WARRANTIES OF
+MERCHANTIBILITY AND FITNESS FOR A PARTICULAR PURPOSE.
+
+Copyright (c) 1995,1996 Brian Pane
+Copyright (c) 1996,1997 Zachary Vonler and Brian Pane
+Copyright (c) 1999 Kevin Vigor and Brian Pane
+Copyright (c) 2000,2001 Gian Filippo Pinzari and Brian Pane
+
+All rights reserved.
diff --git a/nxcompshad/Misc.h b/nxproxy/Main.c
similarity index 52%
rename from nxcompshad/Misc.h
rename to nxproxy/Main.c
index 6dc8635..a5ce262 100644
--- a/nxcompshad/Misc.h
+++ b/nxproxy/Main.c
@@ -1,8 +1,8 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2007 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
-/* NXCOMPSHAD, NX protocol compression and NX extensions to this software */
+/* NXPROXY, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
 /* software is allowed according to terms specified in the file LICENSE   */
 /* which comes in the source distribution.                                */
@@ -11,32 +11,59 @@
 /*                                                                        */
 /* NX and NoMachine are trademarks of Medialogic S.p.A.                   */
 /*                                                                        */
-/* All rights reserved.                                                   */
+/* All rigths reserved.                                                   */
 /*                                                                        */
 /**************************************************************************/
 
-#ifndef Misc_H
-#define Misc_H
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;string.h&gt;
+#include &lt;unistd.h&gt;
 
-#include &lt;iostream&gt;
+#include &quot;NX.h&quot;
 
-#include &lt;errno.h&gt;
-#include &lt;string.h&gt;
+#define PANIC
+#define WARNING
+#undef  TEST
+#undef  DEBUG
+
+/*
+ * Entry point when running nxproxy stand-alone.
+ */
+
+int main(int argc, const char **argv)
+{
+  int result = -1;
+
+  char *options = NULL;
+
+  options = getenv(&quot;NX_DISPLAY&quot;);
+
+  if (NXTransParseCommandLine(argc, argv) &lt; 0)
+  {
+    NXTransCleanup();
+  }
+
+  if (NXTransParseEnvironment(options, 0) &lt; 0)
+  {
+    NXTransCleanup();
+  }
 
-using namespace std;
+  /*
+   * This should not return...
+   */
 
-//
-// Error handling macros.
-//
+  #ifdef TEST
+  fprintf(stderr, &quot;Main: Yielding control to NX entry point.\n&quot;);
+  #endif
 
-#define ESET(e)  (errno = (e))
-#define EGET()   (errno)
-#define ESTR()   strerror(errno)
+  result = NXTransProxy(NX_FD_ANY, NX_MODE_ANY, NX_DISPLAY_ANY);
 
-//
-// Log file.
-//
+  /*
+   * ...So these should not be called.
+   */
 
-extern ostream *logofs;
+  NXTransExit(result);
 
-#endif /* Misc_H */
+  return 0;
+}
diff --git a/nxproxy/Makefile.in b/nxproxy/Makefile.in
new file mode 100644
index 0000000..928e0d3
--- /dev/null
+++ b/nxproxy/Makefile.in
@@ -0,0 +1,101 @@
+#
+# Get values from configure script.
+#
+VERSION=@VERSION@
+LIBVERSION=@LIBVERSION@
+
+#
+# Enable really all warnings. This, though, gives
+# a warning due to pthread.h and unistd.h.
+#
+# -Wredundant-decls
+#
+CXX      = @CXX@
+CXXFLAGS = @CXXFLAGS@ @X_CFLAGS@ @DEFS@ \
+           -Wall -Wpointer-arith -Wstrict-prototypes -Wmissing-prototypes \
+           -Wmissing-declarations -Wnested-externs
+
+CXXINCLUDES = -I. -I../nxcomp
+
+CC         = @CC@
+CCFLAGS    = $(CXXFLAGS)
+CCINCLUDES = -I. -I../nxcomp
+CCDEFINES  =
+
+LDFLAGS = @LDFLAGS@
+LIBS    = @LIBS@
+
+#
+# Only if THREADS is defined.
+#
+# LIBS = $(LIBS) -lpthread
+#
+
+srcdir      = @srcdir@
+prefix      = @prefix@
+exec_prefix = @exec_prefix@
+bindir      = @bindir@
+man1dir     = @mandir@/man1
+VPATH       = @srcdir@
+
+INSTALL         = @INSTALL@
+INSTALL_PROGRAM = @INSTALL_PROGRAM@
+INSTALL_DATA    = @INSTALL_DATA@
+
+#
+# This should be autodetected.
+#
+
+MAKEDEPEND     = @MAKEDEPEND@
+DEPENDINCLUDES = -I/usr/include/g++ -I/usr/include/g++-3 
+
+.SUFFIXES: .cpp.c
+
+.cpp.o:
+	$(CXX) -c $(CXXFLAGS) $(CXXINCLUDES) $(CXXDEFINES) $&lt;
+.c.o:
+	$(CC) -c $(CCFLAGS) $(CCINCLUDES) $(CCDEFINES) $&lt;
+
+PROGRAM = nxproxy
+
+all: depend $(PROGRAM)
+
+MSRC   = Main.c
+
+CSRC   =
+
+CXXSRC =
+
+MOBJ   = $(MSRC:.c=.o)
+COBJ   = $(CSRC:.c=.o)
+CXXOBJ = $(CXXSRC:.cpp=.o)
+
+$(PROGRAM):	$(MOBJ) $(COBJ) $(CXXOBJ)
+		$(CXX) $(CXXFLAGS) -o $@ $(MOBJ) $(LDFLAGS) $(LIBS)
+
+depends:	depend.status
+
+depend:		depend.status
+
+depend.status:	
+		if [ -x $(MAKEDEPEND) ] ; then \
+			$(MAKEDEPEND) $(CXXINCLUDES) $(CCINCLUDES) \
+                        $(DEPENDINCLUDES) -f Makefile $(MSRC) $(CSRC) $(CXXSRC) 2&gt;/dev/null; \
+		fi
+		touch depend.status
+
+install:	install.bin install.man
+
+install.bin:	$(PROGRAM)
+		$(srcdir)/mkinstalldirs $(bindir)
+		$(INSTALL) $(PROGRAM) $(bindir)/$(PROGRAM)
+
+install.man:
+		$(srcdir)/mkinstalldirs $(man1dir)
+
+clean:
+		-rm -f *~ *.o *.bak st?????? core core.* *.out.* \
+		$(PROGRAM) $(PROGRAM).exe $(LIBFULL) $(LIBLOAD) $(LIBSHARED) $(LIBARCHIVE)
+
+distclean:	clean
+		-rm -f config.status config.log config.cache depend.status Makefile tags
diff --git a/nxproxy/README b/nxproxy/README
new file mode 100644
index 0000000..8f95d9f
--- /dev/null
+++ b/nxproxy/README
@@ -0,0 +1,14 @@
+README
+------
+
+1. To compile:
+
+   &gt; tar zxvf nxproxy-X.Y.Z-N.tar.gz
+   &gt; cd nxproxy
+   &gt; ./configure
+   &gt; make
+
+   You'll have to run gmake under Solaris.
+
+2. The 'make install' target is not currently supported
+   in the Makefile, but it should be simple to fix.
diff --git a/nxproxy/README-IPAQ b/nxproxy/README-IPAQ
new file mode 100644
index 0000000..7a8a8a9
--- /dev/null
+++ b/nxproxy/README-IPAQ
@@ -0,0 +1,27 @@
+README-IPAQ
+-----------
+
+1. Install a cross-compiler for ARM. You can find detailed
+   informations at:
+
+   <A HREF="http://www.ailis.de/~k/knowledge/crosscompiling/toolchain.php">http://www.ailis.de/~k/knowledge/crosscompiling/toolchain.php</A>
+
+   There are also binaries needed to install the cross-compiler.
+
+2. Configure and compile nxproxy using:
+
+   $ ./configure --with-ipaq
+   $ make
+
+   After compilation type:
+
+   $ arm-linux-strip nxproxy
+
+3. You need libXcomp.so to run nxproxy. Be sure you include the
+   library in your LD_LIBRARY_PATH. For example, you can run:
+
+   &gt; export LD_LIBRARY_PATH $HOME/NX/nxcomp
+   &gt; nxproxy -S localhost:8
+
+4. The package nxscripts contains many examples of NX usage that
+   you can modify to suit your needs.
diff --git a/nxproxy/README-VALGRIND b/nxproxy/README-VALGRIND
new file mode 100644
index 0000000..ce4d513
--- /dev/null
+++ b/nxproxy/README-VALGRIND
@@ -0,0 +1,39 @@
+README-VALGRIND
+---------------
+
+You can run nxproxy (and nxcomp) under the supervision of valgrind
+(a very good memory debugger) by wrapping nxproxy in the following
+script:
+
+&lt;snip&gt;
+#!/bin/bash
+
+# Enable core dumps.
+
+ulimit -c unlimited
+
+# Set this to directory where nxproxy is located.
+
+NXPROXY_DIR=~/NX/nxproxy
+
+# Set this to directory where valgrind is located.
+
+VALGRIND_DIR=/usr/local/bin
+
+exec ${VALGRIND_DIR}/valgrind -v --leak-check=yes --leak-resolution=high \
+                              --show-reachable=yes --show-reachable=yes \
+                              --suppressions=${NXPROXY_DIR}/nxproxy.supp \
+                              --num-callers=16 --logfile-fd=2 \
+\
+${NXPROXY_DIR}/nxproxy $1 $2 $3 $4 $5 $6 $7 $8 $9
+&lt;snip&gt;
+
+Run the following commands on your shell, right in the place where
+the nxproxy executable is to be placed in your setup:
+
+$ cat &gt;nxproxy
+&lt;copy paste the previous lines here&gt;
+$ chmod a+x nxproxy
+
+Output of valgrind will go on stderr, that is in session file, if
+run in NX environment.
diff --git a/nxproxy/VERSION b/nxproxy/VERSION
new file mode 100644
index 0000000..4a36342
--- /dev/null
+++ b/nxproxy/VERSION
@@ -0,0 +1 @@
+3.0.0
diff --git a/nxcompshad/configure b/nxproxy/autom4te.cache/output.0
old mode 100755
new mode 100644
similarity index 96%
copy from nxcompshad/configure
copy to nxproxy/autom4te.cache/output.0
index d5b4228..133967c
--- a/nxcompshad/configure
+++ b/nxproxy/autom4te.cache/output.0
@@ -1,10 +1,10 @@
-#! /bin/sh
-# Guess values for system-dependent variables and create Makefiles.
-# Generated by GNU Autoconf 2.59.
-#
-# Copyright (C) 2003 Free Software Foundation, Inc.
-# This configure script is free software; the Free Software Foundation
-# gives unlimited permission to copy, distribute and modify it.
+@%:@! /bin/sh
+@%:@ Guess values for system-dependent variables and create Makefiles.
+@%:@ Generated by GNU Autoconf 2.59.
+@%:@ 
+@%:@ Copyright (C) 2003 Free Software Foundation, Inc.
+@%:@ This configure script is free software; the Free Software Foundation
+@%:@ gives unlimited permission to copy, distribute and modify it.
 ## --------------------- ##
 ## M4sh Initialization.  ##
 ## --------------------- ##
@@ -271,8 +271,8 @@ PACKAGE_VERSION=
 PACKAGE_STRING=
 PACKAGE_BUGREPORT=
 
-ac_unique_file=&quot;Shadow.h&quot;
-ac_subst_vars='SHELL PATH_SEPARATOR PACKAGE_NAME PACKAGE_TARNAME PACKAGE_VERSION PACKAGE_STRING PACKAGE_BUGREPORT exec_prefix prefix program_transform_name bindir sbindir libexecdir datadir sysconfdir sharedstatedir localstatedir libdir includedir oldincludedir infodir mandir build_alias host_alias target_alias DEFS ECHO_C ECHO_N ECHO_T LIBS armcxx armcc CXX CXXFLAGS LDFLAGS CPPFLAGS ac_ct_CXX EXEEXT OBJEXT CC CFLAGS ac_ct_CC INSTALL_PROGRAM INSTALL_SCRIPT INSTALL_DATA CXXCPP X_CFLAGS X_PRE_LIBS X_LIBS X_EXTRA_LIBS LIBVERSION VERSION MAKEDEPEND LIBOBJS LTLIBOBJS'
+ac_unique_file=&quot;Main.c&quot;
+ac_subst_vars='SHELL PATH_SEPARATOR PACKAGE_NAME PACKAGE_TARNAME PACKAGE_VERSION PACKAGE_STRING PACKAGE_BUGREPORT exec_prefix prefix program_transform_name bindir sbindir libexecdir datadir sysconfdir sharedstatedir localstatedir libdir includedir oldincludedir infodir mandir build_alias host_alias target_alias DEFS ECHO_C ECHO_N ECHO_T LIBS armcxx armcc CXX CXXFLAGS LDFLAGS CPPFLAGS ac_ct_CXX EXEEXT OBJEXT CC CFLAGS ac_ct_CC INSTALL_PROGRAM INSTALL_SCRIPT INSTALL_DATA CXXCPP X_CFLAGS X_PRE_LIBS X_LIBS X_EXTRA_LIBS LIBVERSION VERSION MAKEDEPEND LIB@&amp;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">t at OBJS</A> LTLIBOBJS'
 ac_subst_files=''
 
 # Initialize some variables set by options.
@@ -946,9 +946,9 @@ generated by GNU Autoconf 2.59.  Invocation command line was
 _ACEOF
 {
 cat &lt;&lt;_ASUNAME
-## --------- ##
-## Platform. ##
-## --------- ##
+@%:@@%:@ --------- @%:@@%:@
+@%:@@%:@ Platform. @%:@@%:@
+@%:@@%:@ --------- @%:@@%:@
 
 hostname = `(hostname || uname -n) 2&gt;/dev/null | sed 1q`
 uname -m = `(uname -m) 2&gt;/dev/null || echo unknown`
@@ -982,9 +982,9 @@ done
 cat &gt;&amp;5 &lt;&lt;_ACEOF
 
 
-## ----------- ##
-## Core tests. ##
-## ----------- ##
+@%:@@%:@ ----------- @%:@@%:@
+@%:@@%:@ Core tests. @%:@@%:@
+@%:@@%:@ ----------- @%:@@%:@
 
 _ACEOF
 
@@ -1051,9 +1051,9 @@ trap 'exit_status=$?
     echo
 
     cat &lt;&lt;\_ASBOX
-## ---------------- ##
-## Cache variables. ##
-## ---------------- ##
+@%:@@%:@ ---------------- @%:@@%:@
+@%:@@%:@ Cache variables. @%:@@%:@
+@%:@@%:@ ---------------- @%:@@%:@
 _ASBOX
     echo
     # The following way of writing the cache mishandles newlines in values,
@@ -1074,9 +1074,9 @@ _ASBOX
     echo
 
     cat &lt;&lt;\_ASBOX
-## ----------------- ##
-## Output variables. ##
-## ----------------- ##
+@%:@@%:@ ----------------- @%:@@%:@
+@%:@@%:@ Output variables. @%:@@%:@
+@%:@@%:@ ----------------- @%:@@%:@
 _ASBOX
     echo
     for ac_var in $ac_subst_vars
@@ -1088,9 +1088,9 @@ _ASBOX
 
     if test -n &quot;$ac_subst_files&quot;; then
       cat &lt;&lt;\_ASBOX
-## ------------- ##
-## Output files. ##
-## ------------- ##
+@%:@@%:@ ------------- @%:@@%:@
+@%:@@%:@ Output files. @%:@@%:@
+@%:@@%:@ ------------- @%:@@%:@
 _ASBOX
       echo
       for ac_var in $ac_subst_files
@@ -1103,9 +1103,9 @@ _ASBOX
 
     if test -s confdefs.h; then
       cat &lt;&lt;\_ASBOX
-## ----------- ##
-## confdefs.h. ##
-## ----------- ##
+@%:@@%:@ ----------- @%:@@%:@
+@%:@@%:@ confdefs.h. @%:@@%:@
+@%:@@%:@ ----------- @%:@@%:@
 _ASBOX
       echo
       sed &quot;/^$/d&quot; confdefs.h | sort
@@ -1132,27 +1132,27 @@ echo &gt;confdefs.h
 # Predefined preprocessor variables.
 
 cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
-#define PACKAGE_NAME &quot;$PACKAGE_NAME&quot;
+@%:@define PACKAGE_NAME &quot;$PACKAGE_NAME&quot;
 _ACEOF
 
 
 cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
-#define PACKAGE_TARNAME &quot;$PACKAGE_TARNAME&quot;
+@%:@define PACKAGE_TARNAME &quot;$PACKAGE_TARNAME&quot;
 _ACEOF
 
 
 cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
-#define PACKAGE_VERSION &quot;$PACKAGE_VERSION&quot;
+@%:@define PACKAGE_VERSION &quot;$PACKAGE_VERSION&quot;
 _ACEOF
 
 
 cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
-#define PACKAGE_STRING &quot;$PACKAGE_STRING&quot;
+@%:@define PACKAGE_STRING &quot;$PACKAGE_STRING&quot;
 _ACEOF
 
 
 cat &gt;&gt;confdefs.h &lt;&lt;_ACEOF
-#define PACKAGE_BUGREPORT &quot;$PACKAGE_BUGREPORT&quot;
+@%:@define PACKAGE_BUGREPORT &quot;$PACKAGE_BUGREPORT&quot;
 _ACEOF
 
 
@@ -1273,10 +1273,6 @@ CXXFLAGS=&quot;-O3&quot;
 CPPFLAGS=&quot;-O3&quot;
 
 
-LIBSTATIC=&quot;&quot;
-LIBSHARED=&quot;&quot;
-
-
 if test -d &quot;../nx-X11/exports/include&quot; ; then
     CXXFLAGS=&quot;$CXXFLAGS -I../nx-X11/exports/include&quot;
     LIBS=&quot;$LIBS -L../nx-X11/exports/lib&quot;
@@ -1284,7 +1280,7 @@ fi
 
 
 if test &quot;${with_ipaq}&quot; = yes; then
-  echo -e &quot;enabling IPAQ configuration&quot;
+  echo -e &quot;enabling ipaq configuration&quot;
   CXX=&quot;arm-linux-c++&quot;
   CC=&quot;arm-linux-gcc&quot;
   unset ac_cv_prog_armcxx
@@ -1374,7 +1370,7 @@ else
   unset ac_cv_prog_CXX
   unset ac_cv_prog_CC
   unset ac_cv_prog_CXXCPP
-fi
+fi  
 
 
 ac_ext=cc
@@ -1836,7 +1832,7 @@ cat confdefs.h &gt;&gt;conftest.$ac_ext
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 $ac_declaration
-#include &lt;stdlib.h&gt;
+@%:@include &lt;stdlib.h&gt;
 int
 main ()
 {
@@ -2132,7 +2128,7 @@ if test $ac_prog_rejected = yes; then
   # We found a bogon in the path, so make sure we never use it.
   set dummy $ac_cv_prog_CC
   shift
-  if test $# != 0; then
+  if test $@%:@ != 0; then
     # We chose a different compiler from the bogus one.
     # However, it has the same basename, so the bogon will be chosen
     # first if we set CC to just the basename; use the full file name.
@@ -2496,7 +2492,7 @@ else
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
 fi
-rm -f conftest.err conftest.$ac_objext
+rm -f conftest.err conftest.$ac_objext 
 done
 rm -f conftest.$ac_ext conftest.$ac_objext
 CC=$ac_save_CC
@@ -2518,9 +2514,9 @@ esac
 # for both compiling C and C++ we need to have the C++ compiler decide
 # the declaration of exit, since it's the most demanding environment.
 cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-#ifndef __cplusplus
+@%:@ifndef __cplusplus
   choke me
-#endif
+@%:@endif
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
@@ -2559,7 +2555,7 @@ cat confdefs.h &gt;&gt;conftest.$ac_ext
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
 $ac_declaration
-#include &lt;stdlib.h&gt;
+@%:@include &lt;stdlib.h&gt;
 int
 main ()
 {
@@ -2670,41 +2666,6 @@ ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
 
 
 
-echo &quot;$as_me:$LINENO: checking whether compiler needs -Wno-deprecated&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking whether compiler needs -Wno-deprecated... $ECHO_C&quot; &gt;&amp;6
-gcc_version=`${CC} --version | grep 'gcc (GCC) [3-4].' | head -n 1`
-case &quot;${gcc_version}&quot; in
-     gcc*)
-        echo &quot;$as_me:$LINENO: result: yes&quot; &gt;&amp;5
-echo &quot;${ECHO_T}yes&quot; &gt;&amp;6
-        CXXFLAGS=&quot;$CXXFLAGS -Wno-deprecated&quot;
-        CPPFLAGS=&quot;$CPPFLAGS -Wno-deprecated&quot;
-        ;;
-
-     *)
-        echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
-        ;;
-esac
-
-echo &quot;$as_me:$LINENO: checking whether compiler accepts -Wmissing-declarations and -Wnested-externs&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking whether compiler accepts -Wmissing-declarations and -Wnested-externs... $ECHO_C&quot; &gt;&amp;6
-gcc_version=`${CC} --version | grep 'gcc (GCC) [3-4].' | head -n 1`
-case &quot;${gcc_version}&quot; in
-     gcc*)
-        echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
-        ;;
-
-     *)
-        echo &quot;$as_me:$LINENO: result: yes&quot; &gt;&amp;5
-echo &quot;${ECHO_T}yes&quot; &gt;&amp;6
-        CXXFLAGS=&quot;$CXXFLAGS -Wmissing-declarations -Wnested-externs&quot;
-        CPPFLAGS=&quot;$CPPFLAGS -Wmissing-declarations -Wnested-externs&quot;
-        ;;
-esac
-
-
 ac_aux_dir=
 for ac_dir in $srcdir $srcdir/.. $srcdir/../..; do
   if test -f $ac_dir/install-sh; then
@@ -2841,11 +2802,11 @@ _ACEOF
 cat confdefs.h &gt;&gt;conftest.$ac_ext
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
-#ifdef __STDC__
-# include &lt;limits.h&gt;
-#else
-# include &lt;assert.h&gt;
-#endif
+@%:@ifdef __STDC__
+@%:@ include &lt;limits.h&gt;
+@%:@else
+@%:@ include &lt;assert.h&gt;
+@%:@endif
 		     Syntax error
 _ACEOF
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_cpp conftest.$ac_ext\&quot;&quot;) &gt;&amp;5
@@ -2884,7 +2845,7 @@ _ACEOF
 cat confdefs.h &gt;&gt;conftest.$ac_ext
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
-#include &lt;ac_nonexistent.h&gt;
+@%:@include &lt;ac_nonexistent.h&gt;
 _ACEOF
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_cpp conftest.$ac_ext\&quot;&quot;) &gt;&amp;5
   (eval $ac_cpp conftest.$ac_ext) 2&gt;conftest.er1
@@ -2925,7 +2886,7 @@ fi
 
     done
     ac_cv_prog_CXXCPP=$CXXCPP
-
+  
 fi
   CXXCPP=$ac_cv_prog_CXXCPP
 else
@@ -2948,11 +2909,11 @@ _ACEOF
 cat confdefs.h &gt;&gt;conftest.$ac_ext
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
-#ifdef __STDC__
-# include &lt;limits.h&gt;
-#else
-# include &lt;assert.h&gt;
-#endif
+@%:@ifdef __STDC__
+@%:@ include &lt;limits.h&gt;
+@%:@else
+@%:@ include &lt;assert.h&gt;
+@%:@endif
 		     Syntax error
 _ACEOF
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_cpp conftest.$ac_ext\&quot;&quot;) &gt;&amp;5
@@ -2991,7 +2952,7 @@ _ACEOF
 cat confdefs.h &gt;&gt;conftest.$ac_ext
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
-#include &lt;ac_nonexistent.h&gt;
+@%:@include &lt;ac_nonexistent.h&gt;
 _ACEOF
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_cpp conftest.$ac_ext\&quot;&quot;) &gt;&amp;5
   (eval $ac_cpp conftest.$ac_ext) 2&gt;conftest.er1
@@ -3050,8 +3011,8 @@ echo $ECHO_N &quot;checking for X... $ECHO_C&quot; &gt;&amp;6
 # Check whether --with-x or --without-x was given.
 if test &quot;${with_x+set}&quot; = set; then
   withval=&quot;$with_x&quot;
-
-fi;
+  
+fi; 
 # $have_x is `yes', `no', `disabled', or empty when we do not yet know.
 if test &quot;x$with_x&quot; = xno; then
   # The user explicitly disabled X.
@@ -3146,7 +3107,7 @@ _ACEOF
 cat confdefs.h &gt;&gt;conftest.$ac_ext
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
-#include &lt;X11/Intrinsic.h&gt;
+@%:@include &lt;X11/Intrinsic.h&gt;
 _ACEOF
 if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_cpp conftest.$ac_ext\&quot;&quot;) &gt;&amp;5
   (eval $ac_cpp conftest.$ac_ext) 2&gt;conftest.er1
@@ -3194,7 +3155,7 @@ _ACEOF
 cat confdefs.h &gt;&gt;conftest.$ac_ext
 cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 /* end confdefs.h.  */
-#include &lt;X11/Intrinsic.h&gt;
+@%:@include &lt;X11/Intrinsic.h&gt;
 int
 main ()
 {
@@ -3279,9 +3240,9 @@ fi
 
 if test &quot;$no_x&quot; = yes; then
   # Not all programs may use this symbol, but it does not hurt to define it.
-
+  
 cat &gt;&gt;confdefs.h &lt;&lt;\_ACEOF
-#define X_DISPLAY_MISSING 1
+@%:@define X_DISPLAY_MISSING 1
 _ACEOF
 
   X_CFLAGS= X_PRE_LIBS= X_LIBS= X_EXTRA_LIBS=
@@ -4437,16 +4398,14 @@ ac_help=&quot;$ac_help
   --with-symbols          give -g flag to compiler to produce debug symbols
   --with-info             define INFO at compile time to get basic log output
   --with-valgrind         clean up allocated buffers to avoid valgrind warnings
-  --with-version          use this version for produced libraries
+  --with-version          use this version for produced libraries&quot;
 
-  --with-static-jpeg      enable static linking of JPEG library
-  --with-static-z         enable static linking of Z library&quot;
 
 
 
-echo &quot;$as_me:$LINENO: checking for Cygwin32 environment&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for Cygwin32 environment... $ECHO_C&quot; &gt;&amp;6
-if test &quot;${nxconf_cv_cygwin32+set}&quot; = set; then
+echo &quot;$as_me:$LINENO: checking for FreeBSD environment&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for FreeBSD environment... $ECHO_C&quot; &gt;&amp;6
+if test &quot;${nxconf_cv_freebsd+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
@@ -4459,7 +4418,7 @@ cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 int
 main ()
 {
-return __CYGWIN32__;
+return __FreeBSD__;
   ;
   return 0;
 }
@@ -4486,31 +4445,26 @@ if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
   ac_status=$?
   echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
   (exit $ac_status); }; }; then
-  nxconf_cv_cygwin32=yes
+  nxconf_cv_freebsd=yes
 else
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-nxconf_cv_cygwin32=no
+nxconf_cv_freebsd=no
 fi
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
 rm -f conftest*
 fi
-echo &quot;$as_me:$LINENO: result: $nxconf_cv_cygwin32&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$nxconf_cv_cygwin32&quot; &gt;&amp;6
-CYGWIN32=
-test &quot;$nxconf_cv_cygwin32&quot; = yes &amp;&amp; CYGWIN32=yes
-
-
-if test &quot;$CYGWIN32&quot; = yes; then
-    LIBS=&quot;$LIBS -lstdc++ -lcygipc -lgdi32&quot;
-fi
+echo &quot;$as_me:$LINENO: result: $nxconf_cv_freebsd&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$nxconf_cv_freebsd&quot; &gt;&amp;6
+FreeBSD=
+test &quot;$nxconf_cv_freebsd&quot; = yes &amp;&amp; FreeBSD=yes
 
 
 
-echo &quot;$as_me:$LINENO: checking for Darwin environment&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for Darwin environment... $ECHO_C&quot; &gt;&amp;6
-if test &quot;${nxconf_cv_darwin+set}&quot; = set; then
+echo &quot;$as_me:$LINENO: checking for Cygwin32 environment&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for Cygwin32 environment... $ECHO_C&quot; &gt;&amp;6
+if test &quot;${nxconf_cv_cygwin32+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
@@ -4523,7 +4477,7 @@ cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 int
 main ()
 {
-return __APPLE__;
+return __CYGWIN32__;
   ;
   return 0;
 }
@@ -4550,26 +4504,26 @@ if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
   ac_status=$?
   echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
   (exit $ac_status); }; }; then
-  nxconf_cv_darwin=yes
+  nxconf_cv_cygwin32=yes
 else
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-nxconf_cv_darwin=no
+nxconf_cv_cygwin32=no
 fi
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
 rm -f conftest*
 fi
-echo &quot;$as_me:$LINENO: result: $nxconf_cv_darwin&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$nxconf_cv_darwin&quot; &gt;&amp;6
-DARWIN=
-test &quot;$nxconf_cv_darwin&quot; = yes &amp;&amp; DARWIN=yes
+echo &quot;$as_me:$LINENO: result: $nxconf_cv_cygwin32&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$nxconf_cv_cygwin32&quot; &gt;&amp;6
+CYGWIN32=
+test &quot;$nxconf_cv_cygwin32&quot; = yes &amp;&amp; CYGWIN32=yes
 
 
 
-echo &quot;$as_me:$LINENO: checking for Solaris environment&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for Solaris environment... $ECHO_C&quot; &gt;&amp;6
-if test &quot;${nxconf_cv_sun+set}&quot; = set; then
+echo &quot;$as_me:$LINENO: checking for Darwin environment&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for Darwin environment... $ECHO_C&quot; &gt;&amp;6
+if test &quot;${nxconf_cv_darwin+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
@@ -4582,7 +4536,7 @@ cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 int
 main ()
 {
-return __sun;
+return __APPLE__;
   ;
   return 0;
 }
@@ -4609,26 +4563,26 @@ if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
   ac_status=$?
   echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
   (exit $ac_status); }; }; then
-  nxconf_cv_sun=yes
+  nxconf_cv_darwin=yes
 else
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-nxconf_cv_sun=no
+nxconf_cv_darwin=no
 fi
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
 rm -f conftest*
 fi
-echo &quot;$as_me:$LINENO: result: $nxconf_cv_sun&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$nxconf_cv_sun&quot; &gt;&amp;6
-SUN=
-test &quot;$nxconf_cv_sun&quot; = yes &amp;&amp; SUN=yes
+echo &quot;$as_me:$LINENO: result: $nxconf_cv_darwin&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$nxconf_cv_darwin&quot; &gt;&amp;6
+DARWIN=
+test &quot;$nxconf_cv_darwin&quot; = yes &amp;&amp; DARWIN=yes
 
 
 
-echo &quot;$as_me:$LINENO: checking for FreeBSD environment&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for FreeBSD environment... $ECHO_C&quot; &gt;&amp;6
-if test &quot;${nxconf_cv_freebsd+set}&quot; = set; then
+echo &quot;$as_me:$LINENO: checking for SunOS environment&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for SunOS environment... $ECHO_C&quot; &gt;&amp;6
+if test &quot;${nxconf_cv_sun+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
@@ -4641,93 +4595,7 @@ cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 int
 main ()
 {
-return __FreeBSD__;
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
-  (eval $ac_compile) 2&gt;conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 &gt;conftest.err
-  rm -f conftest.er1
-  cat conftest.err &gt;&amp;5
-  echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); } &amp;&amp;
-	 { ac_try='test -z &quot;$ac_cxx_werror_flag&quot;
-			 || test ! -s conftest.err'
-  { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_try\&quot;&quot;) &gt;&amp;5
-  (eval $ac_try) 2&gt;&amp;5
-  ac_status=$?
-  echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); }; } &amp;&amp;
-	 { ac_try='test -s conftest.$ac_objext'
-  { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_try\&quot;&quot;) &gt;&amp;5
-  (eval $ac_try) 2&gt;&amp;5
-  ac_status=$?
-  echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); }; }; then
-  nxconf_cv_freebsd=yes
-else
-  echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
-sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
-
-nxconf_cv_freebsd=no
-fi
-rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-rm -f conftest*
-fi
-echo &quot;$as_me:$LINENO: result: $nxconf_cv_freebsd&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$nxconf_cv_freebsd&quot; &gt;&amp;6
-FreeBSD=
-test &quot;$nxconf_cv_freebsd&quot; = yes &amp;&amp; FreeBSD=yes
-
-
-if test &quot;$CYGWIN32&quot; != yes -a &quot;$DARWIN&quot; != yes; then
-  CXXFLAGS=&quot;$CXXFLAGS -fPIC&quot;
-  CFLAGS=&quot;$CFLAGS -fPIC&quot;
-fi
-
-
-if test &quot;$SUN&quot; = yes; then
-  LIBS=&quot;$LIBS  -L/usr/sfw/lib -lsocket &quot;
-  CXXFLAGS=&quot;$CXXFLAGS -I/usr/sfw/include&quot;
-fi
-
-
-if test &quot;$FreeBSD&quot; = yes; then
-  LIBS=&quot;$LIBS  -L/usr/local/lib&quot;
-  CXXFLAGS=&quot;$CXXFLAGS -I/usr/local/include&quot;
-fi
-
-
-if test &quot;$DARWIN&quot; = yes; then
-  LDFLAGS=&quot;$LDFLAGS -bundle&quot;
-elif test &quot;$SUN&quot; = yes; then
-  LDFLAGS=&quot;$LDFLAGS -G -h \$(LIBLOAD)&quot;
-else
-  LDFLAGS=&quot;$LDFLAGS -Wl,-soname,\$(LIBLOAD)&quot;
-fi
-
-
-
-echo &quot;$as_me:$LINENO: checking for in_addr_t&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for in_addr_t... $ECHO_C&quot; &gt;&amp;6
-if test &quot;${nxconf_cv_inaddrt+set}&quot; = set; then
-  echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
-else
-  cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h &gt;&gt;conftest.$ac_ext
-cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* end confdefs.h.  */
-#include &lt;netinet/in.h&gt;
-int
-main ()
-{
-in_addr_t t; t = 1; return t;
+return __sun;
   ;
   return 0;
 }
@@ -4754,30 +4622,20 @@ if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
   ac_status=$?
   echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
   (exit $ac_status); }; }; then
-  nxconf_cv_inaddrt=yes
+  nxconf_cv_sun=yes
 else
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-nxconf_cv_inaddrt=no
+nxconf_cv_sun=no
 fi
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
 rm -f conftest*
 fi
-echo &quot;$as_me:$LINENO: result: $nxconf_cv_inaddrt&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$nxconf_cv_inaddrt&quot; &gt;&amp;6
-INADDRT=
-test &quot;$nxconf_cv_inaddrt&quot; = yes &amp;&amp; INADDRT=yes
-
-
-if test &quot;$INADDRT&quot; != yes ; then
-  echo -e &quot;using unsigned int for type in_addr_t&quot;
-  CXXFLAGS=&quot;$CXXFLAGS -DIN_ADDR_T=unsigned&quot;
-  CPPFLAGS=&quot;$CPPFLAGS -DIN_ADDR_T=unsigned&quot;
-else
-  CXXFLAGS=&quot;$CXXFLAGS -DIN_ADDR_T=in_addr_t&quot;
-  CPPFLAGS=&quot;$CPPFLAGS -DIN_ADDR_T=in_addr_t&quot;
-fi
+echo &quot;$as_me:$LINENO: result: $nxconf_cv_sun&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$nxconf_cv_sun&quot; &gt;&amp;6
+SUN=
+test &quot;$nxconf_cv_sun&quot; = yes &amp;&amp; SUN=yes
 
 
 
@@ -4795,15 +4653,6 @@ CXXFLAGS=&quot;$CXXFLAGS -DVERSION=\\\&quot;${VERSION}\\\&quot;&quot;
 CPPFLAGS=&quot;$CPPFLAGS -DVERSION=\\\&quot;${VERSION}\\\&quot;&quot;
 
 
-if test &quot;$DARWIN&quot; = yes ; then
-  LIBS=&quot;$LIBS $LIBSTATIC $LIBSHARED&quot;
-elif test &quot;$SUN&quot; = yes ; then
-  LIBS=&quot;$LIBS $LIBSTATIC $LIBSHARED&quot;
-else
-  LIBS=&quot;$LIBS $LIBSTATIC -shared $LIBSHARED&quot;
-fi
-
-
 if test &quot;${with_symbols}&quot; = yes; then
   echo -e &quot;enabling production of debug symbols&quot;
   CXXFLAGS=&quot;-g $CXXFLAGS&quot;
@@ -4831,6 +4680,13 @@ else
 fi
 
 
+if test &quot;$CYGWIN32&quot; = yes; then
+    LIBS=&quot;$LIBS -L../nxcomp -lXcomp -lstdc++ -Wl,-e,_mainCRTStartup -ljpeg -lpng -lz&quot;
+else
+    LIBS=&quot;$LIBS -L../nxcomp -lXcomp&quot;
+fi
+
+
 
 
 if test -x &quot;../nx-X11/config/makedepend/makedepend&quot; ; then
@@ -4957,7 +4813,7 @@ rm -f confdef2opt.sed
 
 ac_libobjs=
 ac_ltlibobjs=
-for ac_i in : $LIBOBJS; do test &quot;x$ac_i&quot; = x: &amp;&amp; continue
+for ac_i in : $LIB@&amp;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">t at OBJS</A>; do test &quot;x$ac_i&quot; = x: &amp;&amp; continue
   # 1. Remove the extension, and $U if already installed.
   ac_i=`echo &quot;$ac_i&quot; |
 	 sed 's/\$U\././;s/\.o$//;s/\.obj$//'`
@@ -4965,7 +4821,7 @@ for ac_i in : $LIBOBJS; do test &quot;x$ac_i&quot; = x: &amp;&amp; continue
   ac_libobjs=&quot;$ac_libobjs $ac_i\$U.$ac_objext&quot;
   ac_ltlibobjs=&quot;$ac_ltlibobjs $ac_i&quot;'$U.lo'
 done
-LIBOBJS=$ac_libobjs
+LIB@&amp;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">t at OBJS</A>=$ac_libobjs
 
 LTLIBOBJS=$ac_ltlibobjs
 
@@ -5235,8 +5091,8 @@ exec 6&gt;&amp;1
 exec 5&gt;&gt;config.log
 {
   echo
-  sed 'h;s/./-/g;s/^.../## /;s/...$/ ##/;p;x;p;x' &lt;&lt;_ASBOX
-## Running $as_me. ##
+  sed 'h;s/./-/g;s/^.../@%:@@%:@ /;s/...$/ @%:@@%:@/;p;x;p;x' &lt;&lt;_ASBOX
+@%:@@%:@ Running $as_me. @%:@@%:@
 _ASBOX
 } &gt;&amp;5
 cat &gt;&amp;5 &lt;&lt;_CSEOF
@@ -5506,7 +5362,7 @@ <A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">s, at X_EXTRA_LIBS</A>@,$X_EXTRA_LIBS,;t t
 <A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">s, at LIBVERSION</A>@,$LIBVERSION,;t t
 <A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">s, at VERSION</A>@,$VERSION,;t t
 <A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">s, at MAKEDEPEND</A>@,$MAKEDEPEND,;t t
<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">-s, at LIBOBJS</A>@,$LIBOBJS,;t t
<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">+s, at LIB</A>@&amp;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">t at OBJS</A>@,$LIB@&amp;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">t at OBJS</A>,;t t
 <A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">s, at LTLIBOBJS</A>@,$LTLIBOBJS,;t t
 CEOF
 
diff --git a/nxproxy/autom4te.cache/requests b/nxproxy/autom4te.cache/requests
new file mode 100644
index 0000000..6e49674
--- /dev/null
+++ b/nxproxy/autom4te.cache/requests
@@ -0,0 +1,115 @@
+# This file was generated.
+# It contains the lists of macros which have been traced.
+# It can be safely removed.
+
<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">+ at request</A> = (
+             bless( [
+                      '0',
+                      1,
+                      [
+                        '/usr/share/autoconf'
+                      ],
+                      [
+                        '/usr/share/autoconf/autoconf/autoconf.m4f',
+                        'configure.in'
+                      ],
+                      {
+                        'm4_pattern_forbid' =&gt; 1,
+                        'AC_CONFIG_LIBOBJ_DIR' =&gt; 1,
+                        'AC_TYPE_OFF_T' =&gt; 1,
+                        'AC_C_VOLATILE' =&gt; 1,
+                        'AC_FUNC_CLOSEDIR_VOID' =&gt; 1,
+                        'AC_REPLACE_FNMATCH' =&gt; 1,
+                        'AC_PROG_LIBTOOL' =&gt; 1,
+                        'AC_FUNC_STAT' =&gt; 1,
+                        'AC_HEADER_TIME' =&gt; 1,
+                        'AC_FUNC_WAIT3' =&gt; 1,
+                        'AM_AUTOMAKE_VERSION' =&gt; 1,
+                        'AC_STRUCT_TM' =&gt; 1,
+                        'AC_FUNC_LSTAT' =&gt; 1,
+                        'AC_TYPE_MODE_T' =&gt; 1,
+                        'AC_FUNC_GETMNTENT' =&gt; 1,
+                        'AC_FUNC_STRTOD' =&gt; 1,
+                        'AC_CHECK_HEADERS' =&gt; 1,
+                        'AC_FUNC_STRNLEN' =&gt; 1,
+                        'm4_sinclude' =&gt; 1,
+                        'AC_PROG_CXX' =&gt; 1,
+                        'AC_PATH_X' =&gt; 1,
+                        'AC_FUNC_LSTAT_FOLLOWS_SLASHED_SYMLINK' =&gt; 1,
+                        'AC_PROG_AWK' =&gt; 1,
+                        '_m4_warn' =&gt; 1,
+                        'AC_HEADER_STDC' =&gt; 1,
+                        'AC_HEADER_MAJOR' =&gt; 1,
+                        'AC_FUNC_ERROR_AT_LINE' =&gt; 1,
+                        'AC_PROG_GCC_TRADITIONAL' =&gt; 1,
+                        'AC_LIBSOURCE' =&gt; 1,
+                        'AC_FUNC_MBRTOWC' =&gt; 1,
+                        'AC_STRUCT_ST_BLOCKS' =&gt; 1,
+                        'AC_TYPE_SIGNAL' =&gt; 1,
+                        'AC_TYPE_UID_T' =&gt; 1,
+                        'AC_CONFIG_AUX_DIR' =&gt; 1,
+                        'AC_PROG_MAKE_SET' =&gt; 1,
+                        'sinclude' =&gt; 1,
+                        'm4_pattern_allow' =&gt; 1,
+                        'AC_DEFINE_TRACE_LITERAL' =&gt; 1,
+                        'AC_FUNC_STRERROR_R' =&gt; 1,
+                        'AC_PROG_CC' =&gt; 1,
+                        'AC_FUNC_FORK' =&gt; 1,
+                        'AC_DECL_SYS_SIGLIST' =&gt; 1,
+                        'AC_FUNC_VPRINTF' =&gt; 1,
+                        'AC_FUNC_STRCOLL' =&gt; 1,
+                        'AC_PROG_YACC' =&gt; 1,
+                        'AC_INIT' =&gt; 1,
+                        'AC_STRUCT_TIMEZONE' =&gt; 1,
+                        'AC_FUNC_CHOWN' =&gt; 1,
+                        'AC_SUBST' =&gt; 1,
+                        'AC_FUNC_ALLOCA' =&gt; 1,
+                        'AC_CANONICAL_HOST' =&gt; 1,
+                        'AC_FUNC_GETPGRP' =&gt; 1,
+                        'AC_PROG_RANLIB' =&gt; 1,
+                        'AM_INIT_AUTOMAKE' =&gt; 1,
+                        'AC_FUNC_SETPGRP' =&gt; 1,
+                        'AC_CONFIG_SUBDIRS' =&gt; 1,
+                        'AC_FUNC_MMAP' =&gt; 1,
+                        'AC_FUNC_REALLOC' =&gt; 1,
+                        'AC_TYPE_SIZE_T' =&gt; 1,
+                        'AC_CONFIG_LINKS' =&gt; 1,
+                        'AC_CHECK_TYPES' =&gt; 1,
+                        'AC_CHECK_MEMBERS' =&gt; 1,
+                        'AM_MAINTAINER_MODE' =&gt; 1,
+                        'AC_FUNC_UTIME_NULL' =&gt; 1,
+                        'AC_FUNC_SELECT_ARGTYPES' =&gt; 1,
+                        'AC_FUNC_STRFTIME' =&gt; 1,
+                        'AC_HEADER_STAT' =&gt; 1,
+                        'AC_C_INLINE' =&gt; 1,
+                        'AC_PROG_CPP' =&gt; 1,
+                        'AC_TYPE_PID_T' =&gt; 1,
+                        'AC_C_CONST' =&gt; 1,
+                        'AC_PROG_LEX' =&gt; 1,
+                        'AC_CONFIG_FILES' =&gt; 1,
+                        'include' =&gt; 1,
+                        'AC_FUNC_SETVBUF_REVERSED' =&gt; 1,
+                        'AC_PROG_INSTALL' =&gt; 1,
+                        'AM_GNU_GETTEXT' =&gt; 1,
+                        'AC_FUNC_OBSTACK' =&gt; 1,
+                        'AC_CHECK_LIB' =&gt; 1,
+                        'AC_FUNC_MALLOC' =&gt; 1,
+                        'AC_FUNC_GETGROUPS' =&gt; 1,
+                        'AC_FUNC_GETLOADAVG' =&gt; 1,
+                        'AH_OUTPUT' =&gt; 1,
+                        'AC_FUNC_FSEEKO' =&gt; 1,
+                        'AM_PROG_CC_C_O' =&gt; 1,
+                        'AM_CONDITIONAL' =&gt; 1,
+                        'AC_CANONICAL_SYSTEM' =&gt; 1,
+                        'AC_FUNC_MKTIME' =&gt; 1,
+                        'AC_CONFIG_HEADERS' =&gt; 1,
+                        'AC_HEADER_SYS_WAIT' =&gt; 1,
+                        'AC_FUNC_MEMCMP' =&gt; 1,
+                        'AC_PROG_LN_S' =&gt; 1,
+                        'm4_include' =&gt; 1,
+                        'AC_HEADER_DIRENT' =&gt; 1,
+                        'AC_CHECK_FUNCS' =&gt; 1
+                      }
+                    ], 'Autom4te::Request' )
+           );
+
diff --git a/nxproxy/autom4te.cache/traces.0 b/nxproxy/autom4te.cache/traces.0
new file mode 100644
index 0000000..282fc56
--- /dev/null
+++ b/nxproxy/autom4te.cache/traces.0
@@ -0,0 +1,134 @@
+m4trace:configure.in:5: -1- AC_INIT([Main.c])
+m4trace:configure.in:5: -1- m4_pattern_forbid([^_?A[CHUM]_])
+m4trace:configure.in:5: -1- m4_pattern_forbid([_AC_])
+m4trace:configure.in:5: -1- m4_pattern_forbid([^LIBOBJS$], [do not use LIBOBJS directly, use AC_LIBOBJ (see section `AC_LIBOBJ vs LIBOBJS'])
+m4trace:configure.in:5: -1- m4_pattern_allow([^AS_FLAGS$])
+m4trace:configure.in:5: -1- m4_pattern_forbid([^_?m4_])
+m4trace:configure.in:5: -1- m4_pattern_forbid([^dnl$])
+m4trace:configure.in:5: -1- m4_pattern_forbid([^_?AS_])
+m4trace:configure.in:5: -1- AC_SUBST([SHELL], [${CONFIG_SHELL-/bin/sh}])
+m4trace:configure.in:5: -1- AC_SUBST([PATH_SEPARATOR])
+m4trace:configure.in:5: -1- AC_SUBST([PACKAGE_NAME], [m4_ifdef([AC_PACKAGE_NAME],      ['AC_PACKAGE_NAME'])])
+m4trace:configure.in:5: -1- AC_SUBST([PACKAGE_TARNAME], [m4_ifdef([AC_PACKAGE_TARNAME],   ['AC_PACKAGE_TARNAME'])])
+m4trace:configure.in:5: -1- AC_SUBST([PACKAGE_VERSION], [m4_ifdef([AC_PACKAGE_VERSION],   ['AC_PACKAGE_VERSION'])])
+m4trace:configure.in:5: -1- AC_SUBST([PACKAGE_STRING], [m4_ifdef([AC_PACKAGE_STRING],    ['AC_PACKAGE_STRING'])])
+m4trace:configure.in:5: -1- AC_SUBST([PACKAGE_BUGREPORT], [m4_ifdef([AC_PACKAGE_BUGREPORT], ['AC_PACKAGE_BUGREPORT'])])
+m4trace:configure.in:5: -1- AC_SUBST([exec_prefix], [NONE])
+m4trace:configure.in:5: -1- AC_SUBST([prefix], [NONE])
+m4trace:configure.in:5: -1- AC_SUBST([program_transform_name], [s,x,x,])
+m4trace:configure.in:5: -1- AC_SUBST([bindir], ['${exec_prefix}/bin'])
+m4trace:configure.in:5: -1- AC_SUBST([sbindir], ['${exec_prefix}/sbin'])
+m4trace:configure.in:5: -1- AC_SUBST([libexecdir], ['${exec_prefix}/libexec'])
+m4trace:configure.in:5: -1- AC_SUBST([datadir], ['${prefix}/share'])
+m4trace:configure.in:5: -1- AC_SUBST([sysconfdir], ['${prefix}/etc'])
+m4trace:configure.in:5: -1- AC_SUBST([sharedstatedir], ['${prefix}/com'])
+m4trace:configure.in:5: -1- AC_SUBST([localstatedir], ['${prefix}/var'])
+m4trace:configure.in:5: -1- AC_SUBST([libdir], ['${exec_prefix}/lib'])
+m4trace:configure.in:5: -1- AC_SUBST([includedir], ['${prefix}/include'])
+m4trace:configure.in:5: -1- AC_SUBST([oldincludedir], ['/usr/include'])
+m4trace:configure.in:5: -1- AC_SUBST([infodir], ['${prefix}/info'])
+m4trace:configure.in:5: -1- AC_SUBST([mandir], ['${prefix}/man'])
+m4trace:configure.in:5: -1- AC_DEFINE_TRACE_LITERAL([PACKAGE_NAME])
+m4trace:configure.in:5: -1- AH_OUTPUT([PACKAGE_NAME], [/* Define to the full name of this package. */
+#undef PACKAGE_NAME])
+m4trace:configure.in:5: -1- AC_DEFINE_TRACE_LITERAL([PACKAGE_TARNAME])
+m4trace:configure.in:5: -1- AH_OUTPUT([PACKAGE_TARNAME], [/* Define to the one symbol short name of this package. */
+#undef PACKAGE_TARNAME])
+m4trace:configure.in:5: -1- AC_DEFINE_TRACE_LITERAL([PACKAGE_VERSION])
+m4trace:configure.in:5: -1- AH_OUTPUT([PACKAGE_VERSION], [/* Define to the version of this package. */
+#undef PACKAGE_VERSION])
+m4trace:configure.in:5: -1- AC_DEFINE_TRACE_LITERAL([PACKAGE_STRING])
+m4trace:configure.in:5: -1- AH_OUTPUT([PACKAGE_STRING], [/* Define to the full name and version of this package. */
+#undef PACKAGE_STRING])
+m4trace:configure.in:5: -1- AC_DEFINE_TRACE_LITERAL([PACKAGE_BUGREPORT])
+m4trace:configure.in:5: -1- AH_OUTPUT([PACKAGE_BUGREPORT], [/* Define to the address where bug reports for this package should be sent. */
+#undef PACKAGE_BUGREPORT])
+m4trace:configure.in:5: -1- AC_SUBST([build_alias])
+m4trace:configure.in:5: -1- AC_SUBST([host_alias])
+m4trace:configure.in:5: -1- AC_SUBST([target_alias])
+m4trace:configure.in:5: -1- AC_SUBST([DEFS])
+m4trace:configure.in:5: -1- AC_SUBST([ECHO_C])
+m4trace:configure.in:5: -1- AC_SUBST([ECHO_N])
+m4trace:configure.in:5: -1- AC_SUBST([ECHO_T])
+m4trace:configure.in:5: -1- AC_SUBST([LIBS])
+m4trace:configure.in:29: -1- AC_SUBST([armcxx])
+m4trace:configure.in:30: -1- AC_SUBST([armcc])
+m4trace:configure.in:45: -1- AC_PROG_CXX
+m4trace:configure.in:45: -1- AC_SUBST([CXX])
+m4trace:configure.in:45: -1- AC_SUBST([CXXFLAGS])
+m4trace:configure.in:45: -1- AC_SUBST([LDFLAGS])
+m4trace:configure.in:45: -1- AC_SUBST([CPPFLAGS])
+m4trace:configure.in:45: -1- AC_SUBST([CXX])
+m4trace:configure.in:45: -1- AC_SUBST([ac_ct_CXX])
+m4trace:configure.in:45: -1- AC_SUBST([EXEEXT], [$ac_cv_exeext])
+m4trace:configure.in:45: -1- AC_SUBST([OBJEXT], [$ac_cv_objext])
+m4trace:configure.in:46: -1- AC_PROG_CC
+m4trace:configure.in:46: -1- AC_SUBST([CC])
+m4trace:configure.in:46: -1- AC_SUBST([CFLAGS])
+m4trace:configure.in:46: -1- AC_SUBST([LDFLAGS])
+m4trace:configure.in:46: -1- AC_SUBST([CPPFLAGS])
+m4trace:configure.in:46: -1- AC_SUBST([CC])
+m4trace:configure.in:46: -1- AC_SUBST([ac_ct_CC])
+m4trace:configure.in:46: -1- AC_SUBST([CC])
+m4trace:configure.in:46: -1- AC_SUBST([ac_ct_CC])
+m4trace:configure.in:46: -1- AC_SUBST([CC])
+m4trace:configure.in:46: -1- AC_SUBST([CC])
+m4trace:configure.in:46: -1- AC_SUBST([ac_ct_CC])
+m4trace:configure.in:47: -1- _m4_warn([obsolete], [The macro `AC_LANG_CPLUSPLUS' is obsolete.
+You should run autoupdate.], [autoconf/c.m4:103: AC_LANG_CPLUSPLUS is expanded from...
+configure.in:47: the top level])
+m4trace:configure.in:51: -1- AC_PROG_INSTALL
+m4trace:configure.in:51: -1- AC_SUBST([INSTALL_PROGRAM])
+m4trace:configure.in:51: -1- AC_SUBST([INSTALL_SCRIPT])
+m4trace:configure.in:51: -1- AC_SUBST([INSTALL_DATA])
+m4trace:configure.in:55: -1- AC_PATH_X
+m4trace:configure.in:55: -1- AC_SUBST([CXXCPP])
+m4trace:configure.in:55: -1- AC_SUBST([CPPFLAGS])
+m4trace:configure.in:55: -1- AC_SUBST([CXXCPP])
+m4trace:configure.in:55: -1- AC_DEFINE_TRACE_LITERAL([X_DISPLAY_MISSING])
+m4trace:configure.in:55: -1- AH_OUTPUT([X_DISPLAY_MISSING], [/* Define to 1 if the X Window System is missing or not being used. */
+#undef X_DISPLAY_MISSING])
+m4trace:configure.in:55: -1- AC_CHECK_LIB([dnet], [dnet_ntoa], [X_EXTRA_LIBS=&quot;$X_EXTRA_LIBS -ldnet&quot;])
+m4trace:configure.in:55: -1- AC_CHECK_LIB([dnet_stub], [dnet_ntoa], [X_EXTRA_LIBS=&quot;$X_EXTRA_LIBS -ldnet_stub&quot;])
+m4trace:configure.in:55: -1- AC_CHECK_LIB([nsl], [gethostbyname], [X_EXTRA_LIBS=&quot;$X_EXTRA_LIBS -lnsl&quot;])
+m4trace:configure.in:55: -1- AC_CHECK_LIB([bsd], [gethostbyname], [X_EXTRA_LIBS=&quot;$X_EXTRA_LIBS -lbsd&quot;])
+m4trace:configure.in:55: -1- AC_CHECK_LIB([socket], [connect], [X_EXTRA_LIBS=&quot;-lsocket $X_EXTRA_LIBS&quot;], [], [$X_EXTRA_LIBS])
+m4trace:configure.in:55: -1- AC_CHECK_LIB([posix], [remove], [X_EXTRA_LIBS=&quot;$X_EXTRA_LIBS -lposix&quot;])
+m4trace:configure.in:55: -1- AC_CHECK_LIB([ipc], [shmat], [X_EXTRA_LIBS=&quot;$X_EXTRA_LIBS -lipc&quot;])
+m4trace:configure.in:55: -1- AC_CHECK_LIB([ICE], [IceConnectionNumber], [X_PRE_LIBS=&quot;$X_PRE_LIBS -lSM -lICE&quot;], [], [$X_EXTRA_LIBS])
+m4trace:configure.in:55: -1- AC_SUBST([X_CFLAGS])
+m4trace:configure.in:55: -1- AC_SUBST([X_PRE_LIBS])
+m4trace:configure.in:55: -1- AC_SUBST([X_LIBS])
+m4trace:configure.in:55: -1- AC_SUBST([X_EXTRA_LIBS])
+m4trace:configure.in:76: -1- _m4_warn([obsolete], [The macro `AC_TRY_COMPILE' is obsolete.
+You should run autoupdate.], [autoconf/general.m4:2180: AC_TRY_COMPILE is expanded from...
+autoconf/general.m4:1799: AC_CACHE_VAL is expanded from...
+autoconf/general.m4:1808: AC_CACHE_CHECK is expanded from...
+configure.in:75: nxconf_FreeBSD is expanded from...
+configure.in:76: the top level])
+m4trace:configure.in:86: -1- _m4_warn([obsolete], [The macro `AC_TRY_COMPILE' is obsolete.
+You should run autoupdate.], [autoconf/general.m4:2180: AC_TRY_COMPILE is expanded from...
+autoconf/general.m4:1799: AC_CACHE_VAL is expanded from...
+autoconf/general.m4:1808: AC_CACHE_CHECK is expanded from...
+configure.in:85: nxconf_CYGWIN32 is expanded from...
+configure.in:86: the top level])
+m4trace:configure.in:97: -1- _m4_warn([obsolete], [The macro `AC_TRY_COMPILE' is obsolete.
+You should run autoupdate.], [autoconf/general.m4:2180: AC_TRY_COMPILE is expanded from...
+autoconf/general.m4:1799: AC_CACHE_VAL is expanded from...
+autoconf/general.m4:1808: AC_CACHE_CHECK is expanded from...
+configure.in:96: nxconf_DARWIN is expanded from...
+configure.in:97: the top level])
+m4trace:configure.in:108: -1- _m4_warn([obsolete], [The macro `AC_TRY_COMPILE' is obsolete.
+You should run autoupdate.], [autoconf/general.m4:2180: AC_TRY_COMPILE is expanded from...
+autoconf/general.m4:1799: AC_CACHE_VAL is expanded from...
+autoconf/general.m4:1808: AC_CACHE_CHECK is expanded from...
+configure.in:107: nxconf_SUN is expanded from...
+configure.in:108: the top level])
+m4trace:configure.in:112: -1- AC_SUBST([LIBVERSION])
+m4trace:configure.in:113: -1- AC_SUBST([VERSION])
+m4trace:configure.in:169: -1- AC_SUBST([MAKEDEPEND])
+m4trace:configure.in:185: -1- AC_CONFIG_FILES([Makefile])
+m4trace:configure.in:185: -1- _m4_warn([obsolete], [AC_OUTPUT should be used without arguments.
+You should run autoupdate.], [])
+m4trace:configure.in:185: -1- AC_SUBST([LIB@&amp;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">t at OBJS</A>], [$ac_libobjs])
+m4trace:configure.in:185: -1- AC_SUBST([LTLIBOBJS], [$ac_ltlibobjs])
diff --git a/nxcompshad/configure b/nxproxy/configure
similarity index 97%
rename from nxcompshad/configure
rename to nxproxy/configure
index d5b4228..9d9f08c 100755
--- a/nxcompshad/configure
+++ b/nxproxy/configure
@@ -271,7 +271,7 @@ PACKAGE_VERSION=
 PACKAGE_STRING=
 PACKAGE_BUGREPORT=
 
-ac_unique_file=&quot;Shadow.h&quot;
+ac_unique_file=&quot;Main.c&quot;
 ac_subst_vars='SHELL PATH_SEPARATOR PACKAGE_NAME PACKAGE_TARNAME PACKAGE_VERSION PACKAGE_STRING PACKAGE_BUGREPORT exec_prefix prefix program_transform_name bindir sbindir libexecdir datadir sysconfdir sharedstatedir localstatedir libdir includedir oldincludedir infodir mandir build_alias host_alias target_alias DEFS ECHO_C ECHO_N ECHO_T LIBS armcxx armcc CXX CXXFLAGS LDFLAGS CPPFLAGS ac_ct_CXX EXEEXT OBJEXT CC CFLAGS ac_ct_CC INSTALL_PROGRAM INSTALL_SCRIPT INSTALL_DATA CXXCPP X_CFLAGS X_PRE_LIBS X_LIBS X_EXTRA_LIBS LIBVERSION VERSION MAKEDEPEND LIBOBJS LTLIBOBJS'
 ac_subst_files=''
 
@@ -1273,10 +1273,6 @@ CXXFLAGS=&quot;-O3&quot;
 CPPFLAGS=&quot;-O3&quot;
 
 
-LIBSTATIC=&quot;&quot;
-LIBSHARED=&quot;&quot;
-
-
 if test -d &quot;../nx-X11/exports/include&quot; ; then
     CXXFLAGS=&quot;$CXXFLAGS -I../nx-X11/exports/include&quot;
     LIBS=&quot;$LIBS -L../nx-X11/exports/lib&quot;
@@ -1284,7 +1280,7 @@ fi
 
 
 if test &quot;${with_ipaq}&quot; = yes; then
-  echo -e &quot;enabling IPAQ configuration&quot;
+  echo -e &quot;enabling ipaq configuration&quot;
   CXX=&quot;arm-linux-c++&quot;
   CC=&quot;arm-linux-gcc&quot;
   unset ac_cv_prog_armcxx
@@ -2670,41 +2666,6 @@ ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
 
 
 
-echo &quot;$as_me:$LINENO: checking whether compiler needs -Wno-deprecated&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking whether compiler needs -Wno-deprecated... $ECHO_C&quot; &gt;&amp;6
-gcc_version=`${CC} --version | grep 'gcc (GCC) [3-4].' | head -n 1`
-case &quot;${gcc_version}&quot; in
-     gcc*)
-        echo &quot;$as_me:$LINENO: result: yes&quot; &gt;&amp;5
-echo &quot;${ECHO_T}yes&quot; &gt;&amp;6
-        CXXFLAGS=&quot;$CXXFLAGS -Wno-deprecated&quot;
-        CPPFLAGS=&quot;$CPPFLAGS -Wno-deprecated&quot;
-        ;;
-
-     *)
-        echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
-        ;;
-esac
-
-echo &quot;$as_me:$LINENO: checking whether compiler accepts -Wmissing-declarations and -Wnested-externs&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking whether compiler accepts -Wmissing-declarations and -Wnested-externs... $ECHO_C&quot; &gt;&amp;6
-gcc_version=`${CC} --version | grep 'gcc (GCC) [3-4].' | head -n 1`
-case &quot;${gcc_version}&quot; in
-     gcc*)
-        echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
-echo &quot;${ECHO_T}no&quot; &gt;&amp;6
-        ;;
-
-     *)
-        echo &quot;$as_me:$LINENO: result: yes&quot; &gt;&amp;5
-echo &quot;${ECHO_T}yes&quot; &gt;&amp;6
-        CXXFLAGS=&quot;$CXXFLAGS -Wmissing-declarations -Wnested-externs&quot;
-        CPPFLAGS=&quot;$CPPFLAGS -Wmissing-declarations -Wnested-externs&quot;
-        ;;
-esac
-
-
 ac_aux_dir=
 for ac_dir in $srcdir $srcdir/.. $srcdir/../..; do
   if test -f $ac_dir/install-sh; then
@@ -4437,16 +4398,14 @@ ac_help=&quot;$ac_help
   --with-symbols          give -g flag to compiler to produce debug symbols
   --with-info             define INFO at compile time to get basic log output
   --with-valgrind         clean up allocated buffers to avoid valgrind warnings
-  --with-version          use this version for produced libraries
+  --with-version          use this version for produced libraries&quot;
 
-  --with-static-jpeg      enable static linking of JPEG library
-  --with-static-z         enable static linking of Z library&quot;
 
 
 
-echo &quot;$as_me:$LINENO: checking for Cygwin32 environment&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for Cygwin32 environment... $ECHO_C&quot; &gt;&amp;6
-if test &quot;${nxconf_cv_cygwin32+set}&quot; = set; then
+echo &quot;$as_me:$LINENO: checking for FreeBSD environment&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for FreeBSD environment... $ECHO_C&quot; &gt;&amp;6
+if test &quot;${nxconf_cv_freebsd+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
@@ -4459,7 +4418,7 @@ cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 int
 main ()
 {
-return __CYGWIN32__;
+return __FreeBSD__;
   ;
   return 0;
 }
@@ -4486,31 +4445,26 @@ if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
   ac_status=$?
   echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
   (exit $ac_status); }; }; then
-  nxconf_cv_cygwin32=yes
+  nxconf_cv_freebsd=yes
 else
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-nxconf_cv_cygwin32=no
+nxconf_cv_freebsd=no
 fi
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
 rm -f conftest*
 fi
-echo &quot;$as_me:$LINENO: result: $nxconf_cv_cygwin32&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$nxconf_cv_cygwin32&quot; &gt;&amp;6
-CYGWIN32=
-test &quot;$nxconf_cv_cygwin32&quot; = yes &amp;&amp; CYGWIN32=yes
-
-
-if test &quot;$CYGWIN32&quot; = yes; then
-    LIBS=&quot;$LIBS -lstdc++ -lcygipc -lgdi32&quot;
-fi
+echo &quot;$as_me:$LINENO: result: $nxconf_cv_freebsd&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$nxconf_cv_freebsd&quot; &gt;&amp;6
+FreeBSD=
+test &quot;$nxconf_cv_freebsd&quot; = yes &amp;&amp; FreeBSD=yes
 
 
 
-echo &quot;$as_me:$LINENO: checking for Darwin environment&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for Darwin environment... $ECHO_C&quot; &gt;&amp;6
-if test &quot;${nxconf_cv_darwin+set}&quot; = set; then
+echo &quot;$as_me:$LINENO: checking for Cygwin32 environment&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for Cygwin32 environment... $ECHO_C&quot; &gt;&amp;6
+if test &quot;${nxconf_cv_cygwin32+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
@@ -4523,7 +4477,7 @@ cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 int
 main ()
 {
-return __APPLE__;
+return __CYGWIN32__;
   ;
   return 0;
 }
@@ -4550,26 +4504,26 @@ if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
   ac_status=$?
   echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
   (exit $ac_status); }; }; then
-  nxconf_cv_darwin=yes
+  nxconf_cv_cygwin32=yes
 else
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-nxconf_cv_darwin=no
+nxconf_cv_cygwin32=no
 fi
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
 rm -f conftest*
 fi
-echo &quot;$as_me:$LINENO: result: $nxconf_cv_darwin&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$nxconf_cv_darwin&quot; &gt;&amp;6
-DARWIN=
-test &quot;$nxconf_cv_darwin&quot; = yes &amp;&amp; DARWIN=yes
+echo &quot;$as_me:$LINENO: result: $nxconf_cv_cygwin32&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$nxconf_cv_cygwin32&quot; &gt;&amp;6
+CYGWIN32=
+test &quot;$nxconf_cv_cygwin32&quot; = yes &amp;&amp; CYGWIN32=yes
 
 
 
-echo &quot;$as_me:$LINENO: checking for Solaris environment&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for Solaris environment... $ECHO_C&quot; &gt;&amp;6
-if test &quot;${nxconf_cv_sun+set}&quot; = set; then
+echo &quot;$as_me:$LINENO: checking for Darwin environment&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for Darwin environment... $ECHO_C&quot; &gt;&amp;6
+if test &quot;${nxconf_cv_darwin+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
@@ -4582,7 +4536,7 @@ cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 int
 main ()
 {
-return __sun;
+return __APPLE__;
   ;
   return 0;
 }
@@ -4609,26 +4563,26 @@ if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
   ac_status=$?
   echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
   (exit $ac_status); }; }; then
-  nxconf_cv_sun=yes
+  nxconf_cv_darwin=yes
 else
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-nxconf_cv_sun=no
+nxconf_cv_darwin=no
 fi
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
 rm -f conftest*
 fi
-echo &quot;$as_me:$LINENO: result: $nxconf_cv_sun&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$nxconf_cv_sun&quot; &gt;&amp;6
-SUN=
-test &quot;$nxconf_cv_sun&quot; = yes &amp;&amp; SUN=yes
+echo &quot;$as_me:$LINENO: result: $nxconf_cv_darwin&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$nxconf_cv_darwin&quot; &gt;&amp;6
+DARWIN=
+test &quot;$nxconf_cv_darwin&quot; = yes &amp;&amp; DARWIN=yes
 
 
 
-echo &quot;$as_me:$LINENO: checking for FreeBSD environment&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for FreeBSD environment... $ECHO_C&quot; &gt;&amp;6
-if test &quot;${nxconf_cv_freebsd+set}&quot; = set; then
+echo &quot;$as_me:$LINENO: checking for SunOS environment&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for SunOS environment... $ECHO_C&quot; &gt;&amp;6
+if test &quot;${nxconf_cv_sun+set}&quot; = set; then
   echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
 else
   cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
@@ -4641,93 +4595,7 @@ cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
 int
 main ()
 {
-return __FreeBSD__;
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
-  (eval $ac_compile) 2&gt;conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 &gt;conftest.err
-  rm -f conftest.er1
-  cat conftest.err &gt;&amp;5
-  echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); } &amp;&amp;
-	 { ac_try='test -z &quot;$ac_cxx_werror_flag&quot;
-			 || test ! -s conftest.err'
-  { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_try\&quot;&quot;) &gt;&amp;5
-  (eval $ac_try) 2&gt;&amp;5
-  ac_status=$?
-  echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); }; } &amp;&amp;
-	 { ac_try='test -s conftest.$ac_objext'
-  { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_try\&quot;&quot;) &gt;&amp;5
-  (eval $ac_try) 2&gt;&amp;5
-  ac_status=$?
-  echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
-  (exit $ac_status); }; }; then
-  nxconf_cv_freebsd=yes
-else
-  echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
-sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
-
-nxconf_cv_freebsd=no
-fi
-rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-rm -f conftest*
-fi
-echo &quot;$as_me:$LINENO: result: $nxconf_cv_freebsd&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$nxconf_cv_freebsd&quot; &gt;&amp;6
-FreeBSD=
-test &quot;$nxconf_cv_freebsd&quot; = yes &amp;&amp; FreeBSD=yes
-
-
-if test &quot;$CYGWIN32&quot; != yes -a &quot;$DARWIN&quot; != yes; then
-  CXXFLAGS=&quot;$CXXFLAGS -fPIC&quot;
-  CFLAGS=&quot;$CFLAGS -fPIC&quot;
-fi
-
-
-if test &quot;$SUN&quot; = yes; then
-  LIBS=&quot;$LIBS  -L/usr/sfw/lib -lsocket &quot;
-  CXXFLAGS=&quot;$CXXFLAGS -I/usr/sfw/include&quot;
-fi
-
-
-if test &quot;$FreeBSD&quot; = yes; then
-  LIBS=&quot;$LIBS  -L/usr/local/lib&quot;
-  CXXFLAGS=&quot;$CXXFLAGS -I/usr/local/include&quot;
-fi
-
-
-if test &quot;$DARWIN&quot; = yes; then
-  LDFLAGS=&quot;$LDFLAGS -bundle&quot;
-elif test &quot;$SUN&quot; = yes; then
-  LDFLAGS=&quot;$LDFLAGS -G -h \$(LIBLOAD)&quot;
-else
-  LDFLAGS=&quot;$LDFLAGS -Wl,-soname,\$(LIBLOAD)&quot;
-fi
-
-
-
-echo &quot;$as_me:$LINENO: checking for in_addr_t&quot; &gt;&amp;5
-echo $ECHO_N &quot;checking for in_addr_t... $ECHO_C&quot; &gt;&amp;6
-if test &quot;${nxconf_cv_inaddrt+set}&quot; = set; then
-  echo $ECHO_N &quot;(cached) $ECHO_C&quot; &gt;&amp;6
-else
-  cat &gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h &gt;&gt;conftest.$ac_ext
-cat &gt;&gt;conftest.$ac_ext &lt;&lt;_ACEOF
-/* end confdefs.h.  */
-#include &lt;netinet/in.h&gt;
-int
-main ()
-{
-in_addr_t t; t = 1; return t;
+return __sun;
   ;
   return 0;
 }
@@ -4754,30 +4622,20 @@ if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
   ac_status=$?
   echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
   (exit $ac_status); }; }; then
-  nxconf_cv_inaddrt=yes
+  nxconf_cv_sun=yes
 else
   echo &quot;$as_me: failed program was:&quot; &gt;&amp;5
 sed 's/^/| /' conftest.$ac_ext &gt;&amp;5
 
-nxconf_cv_inaddrt=no
+nxconf_cv_sun=no
 fi
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
 rm -f conftest*
 fi
-echo &quot;$as_me:$LINENO: result: $nxconf_cv_inaddrt&quot; &gt;&amp;5
-echo &quot;${ECHO_T}$nxconf_cv_inaddrt&quot; &gt;&amp;6
-INADDRT=
-test &quot;$nxconf_cv_inaddrt&quot; = yes &amp;&amp; INADDRT=yes
-
-
-if test &quot;$INADDRT&quot; != yes ; then
-  echo -e &quot;using unsigned int for type in_addr_t&quot;
-  CXXFLAGS=&quot;$CXXFLAGS -DIN_ADDR_T=unsigned&quot;
-  CPPFLAGS=&quot;$CPPFLAGS -DIN_ADDR_T=unsigned&quot;
-else
-  CXXFLAGS=&quot;$CXXFLAGS -DIN_ADDR_T=in_addr_t&quot;
-  CPPFLAGS=&quot;$CPPFLAGS -DIN_ADDR_T=in_addr_t&quot;
-fi
+echo &quot;$as_me:$LINENO: result: $nxconf_cv_sun&quot; &gt;&amp;5
+echo &quot;${ECHO_T}$nxconf_cv_sun&quot; &gt;&amp;6
+SUN=
+test &quot;$nxconf_cv_sun&quot; = yes &amp;&amp; SUN=yes
 
 
 
@@ -4795,15 +4653,6 @@ CXXFLAGS=&quot;$CXXFLAGS -DVERSION=\\\&quot;${VERSION}\\\&quot;&quot;
 CPPFLAGS=&quot;$CPPFLAGS -DVERSION=\\\&quot;${VERSION}\\\&quot;&quot;
 
 
-if test &quot;$DARWIN&quot; = yes ; then
-  LIBS=&quot;$LIBS $LIBSTATIC $LIBSHARED&quot;
-elif test &quot;$SUN&quot; = yes ; then
-  LIBS=&quot;$LIBS $LIBSTATIC $LIBSHARED&quot;
-else
-  LIBS=&quot;$LIBS $LIBSTATIC -shared $LIBSHARED&quot;
-fi
-
-
 if test &quot;${with_symbols}&quot; = yes; then
   echo -e &quot;enabling production of debug symbols&quot;
   CXXFLAGS=&quot;-g $CXXFLAGS&quot;
@@ -4831,6 +4680,13 @@ else
 fi
 
 
+if test &quot;$CYGWIN32&quot; = yes; then
+    LIBS=&quot;$LIBS -L../nxcomp -lXcomp -lstdc++ -Wl,-e,_mainCRTStartup -ljpeg -lpng -lz&quot;
+else
+    LIBS=&quot;$LIBS -L../nxcomp -lXcomp&quot;
+fi
+
+
 
 
 if test -x &quot;../nx-X11/config/makedepend/makedepend&quot; ; then
diff --git a/nxcompshad/configure.in b/nxproxy/configure.in
similarity index 57%
rename from nxcompshad/configure.in
rename to nxproxy/configure.in
index 3f16ee9..bd930f1 100644
--- a/nxcompshad/configure.in
+++ b/nxproxy/configure.in
@@ -2,7 +2,7 @@ dnl Process this file with autoconf to produce a configure script.
 
 dnl Prolog
 
-AC_INIT(Shadow.h)
+AC_INIT(Main.c)
 AC_PREREQ(2.13)
 
 dnl Reset default compilation flags.
@@ -10,12 +10,7 @@ dnl Reset default compilation flags.
 CXXFLAGS=&quot;-O3&quot;
 CPPFLAGS=&quot;-O3&quot;
 
-dnl Reset default linking directives.
-
-LIBSTATIC=&quot;&quot;
-LIBSHARED=&quot;&quot;
-
-dnl Prefer headers and libraries from nx-X11, if present.
+dnl Prefer headers and libraries from nx-X11 if present.
 
 if test -d &quot;../nx-X11/exports/include&quot; ; then
     CXXFLAGS=&quot;$CXXFLAGS -I../nx-X11/exports/include&quot;
@@ -25,7 +20,7 @@ fi
 dnl Check whether --with-ipaq was given.
 
 if test &quot;${with_ipaq}&quot; = yes; then
-  echo -e &quot;enabling IPAQ configuration&quot;
+  echo -e &quot;enabling ipaq configuration&quot;
   CXX=&quot;arm-linux-c++&quot;
   CC=&quot;arm-linux-gcc&quot;
   unset ac_cv_prog_armcxx
@@ -51,37 +46,6 @@ AC_PROG_CXX
 AC_PROG_CC
 AC_LANG_CPLUSPLUS
 
-dnl Check whether option -Wno-deprecated
-dnl is needed by GCC compiler.
-
-AC_MSG_CHECKING([whether compiler needs -Wno-deprecated])
-gcc_version=`${CC} --version | grep 'gcc (GCC) [[3-4]].' | head -n 1`
-case &quot;${gcc_version}&quot; in
-     gcc*)
-        AC_MSG_RESULT([yes])
-        CXXFLAGS=&quot;$CXXFLAGS -Wno-deprecated&quot;
-        CPPFLAGS=&quot;$CPPFLAGS -Wno-deprecated&quot;
-        ;;
-
-     *)
-        AC_MSG_RESULT([no])
-        ;;
-esac
-
-AC_MSG_CHECKING([whether compiler accepts -Wmissing-declarations and -Wnested-externs])
-gcc_version=`${CC} --version | grep 'gcc (GCC) [[3-4]].' | head -n 1`
-case &quot;${gcc_version}&quot; in
-     gcc*)
-        AC_MSG_RESULT([no])
-        ;;
-
-     *)
-        AC_MSG_RESULT([yes])
-        CXXFLAGS=&quot;$CXXFLAGS -Wmissing-declarations -Wnested-externs&quot;
-        CPPFLAGS=&quot;$CPPFLAGS -Wmissing-declarations -Wnested-externs&quot;
-        ;;
-esac
-
 dnl Check for BSD compatible install.
 
 AC_PROG_INSTALL
@@ -96,13 +60,22 @@ ac_help=&quot;$ac_help
   --with-symbols          give -g flag to compiler to produce debug symbols
   --with-info             define INFO at compile time to get basic log output
   --with-valgrind         clean up allocated buffers to avoid valgrind warnings
-  --with-version          use this version for produced libraries
-
-  --with-static-jpeg      enable static linking of JPEG library
-  --with-static-z         enable static linking of Z library&quot;
+  --with-version          use this version for produced libraries&quot;
 
 dnl Check to see if we're running under Cygwin32.
 
+
+dnl Check to see if we're running under FreeBSD.
+AC_DEFUN(nxconf_FreeBSD,
+[AC_CACHE_CHECK(for FreeBSD environment, nxconf_cv_freebsd,
+[AC_TRY_COMPILE(,[return __FreeBSD__;],
+nxconf_cv_freebsd=yes, nxconf_cv_freebsd=no)
+rm -f conftest*])
+FreeBSD=
+test &quot;$nxconf_cv_freebsd&quot; = yes &amp;&amp; FreeBSD=yes])
+nxconf_FreeBSD
+
+
 AC_DEFUN(nxconf_CYGWIN32,
 [AC_CACHE_CHECK(for Cygwin32 environment, nxconf_cv_cygwin32,
 [AC_TRY_COMPILE(,[return __CYGWIN32__;],
@@ -112,12 +85,6 @@ CYGWIN32=
 test &quot;$nxconf_cv_cygwin32&quot; = yes &amp;&amp; CYGWIN32=yes])
 nxconf_CYGWIN32
 
-dnl Cygwin32 requires the stdc++ library explicitly linked.
-
-if test &quot;$CYGWIN32&quot; = yes; then
-    LIBS=&quot;$LIBS -lstdc++ -lcygipc -lgdi32&quot;
-fi
-
 dnl Check for Darwin environment.
 
 AC_DEFUN(nxconf_DARWIN,
@@ -132,7 +99,7 @@ nxconf_DARWIN
 dnl Check to see if we're running under Solaris.
 
 AC_DEFUN(nxconf_SUN,
-[AC_CACHE_CHECK(for Solaris environment, nxconf_cv_sun,
+[AC_CACHE_CHECK(for SunOS environment, nxconf_cv_sun,
 [AC_TRY_COMPILE(,[return __sun;],
 nxconf_cv_sun=yes, nxconf_cv_sun=no)
 rm -f conftest*])
@@ -140,75 +107,6 @@ SUN=
 test &quot;$nxconf_cv_sun&quot; = yes &amp;&amp; SUN=yes])
 nxconf_SUN
 
-dnl Check to see if we're running under FreeBSD.
-
-AC_DEFUN(nxconf_FreeBSD,
-[AC_CACHE_CHECK(for FreeBSD environment, nxconf_cv_freebsd,
-[AC_TRY_COMPILE(,[return __FreeBSD__;],
-nxconf_cv_freebsd=yes, nxconf_cv_freebsd=no)
-rm -f conftest*])
-FreeBSD=
-test &quot;$nxconf_cv_freebsd&quot; = yes &amp;&amp; FreeBSD=yes])
-nxconf_FreeBSD
-
-dnl Build PIC libraries.
-
-if test &quot;$CYGWIN32&quot; != yes -a &quot;$DARWIN&quot; != yes; then
-  CXXFLAGS=&quot;$CXXFLAGS -fPIC&quot;
-  CFLAGS=&quot;$CFLAGS -fPIC&quot;
-fi
-
-dnl Solaris requires the socket and gcc_s libs explicitly linked.
-dnl Note also that headers from default /usr/openwin/include/X11
-dnl cause a warning due to pragma in Xmd.h.
-
-if test &quot;$SUN&quot; = yes; then
-  LIBS=&quot;$LIBS  -L/usr/sfw/lib -lsocket &quot;
-  CXXFLAGS=&quot;$CXXFLAGS -I/usr/sfw/include&quot;
-fi
-
-dnl On FreeBSD search libraries and includes under /usr/local.
-
-if test &quot;$FreeBSD&quot; = yes; then
-  LIBS=&quot;$LIBS  -L/usr/local/lib&quot;
-  CXXFLAGS=&quot;$CXXFLAGS -I/usr/local/include&quot;
-fi
-
-dnl Under Darwin we don't have support for -soname option and
-dnl we need the -bundle flag. Under Solaris, instead, we need
-dnl the options -G -h.
-
-if test &quot;$DARWIN&quot; = yes; then
-  LDFLAGS=&quot;$LDFLAGS -bundle&quot;
-elif test &quot;$SUN&quot; = yes; then
-  LDFLAGS=&quot;$LDFLAGS -G -h \$(LIBLOAD)&quot;
-else
-  LDFLAGS=&quot;$LDFLAGS -Wl,-soname,\$(LIBLOAD)&quot;
-fi
-
-dnl Check to see if in_addr_t is defined.
-dnl Could use a specific configure test.
-
-AC_DEFUN(nxconf_INADDRT,
-[AC_CACHE_CHECK(for in_addr_t, nxconf_cv_inaddrt,
-[AC_TRY_COMPILE([#include &lt;netinet/in.h&gt;],[in_addr_t t; t = 1; return t;],
-nxconf_cv_inaddrt=yes, nxconf_cv_inaddrt=no)
-rm -f conftest*])
-INADDRT=
-test &quot;$nxconf_cv_inaddrt&quot; = yes &amp;&amp; INADDRT=yes])
-nxconf_INADDRT
-
-dnl If in_addr_t is not defined use unsigned int.
-
-if test &quot;$INADDRT&quot; != yes ; then
-  echo -e &quot;using unsigned int for type in_addr_t&quot;
-  CXXFLAGS=&quot;$CXXFLAGS -DIN_ADDR_T=unsigned&quot;
-  CPPFLAGS=&quot;$CPPFLAGS -DIN_ADDR_T=unsigned&quot;
-else
-  CXXFLAGS=&quot;$CXXFLAGS -DIN_ADDR_T=in_addr_t&quot;
-  CPPFLAGS=&quot;$CPPFLAGS -DIN_ADDR_T=in_addr_t&quot;
-fi
-
 dnl Check whether --with-version was given.
 
 AC_SUBST(LIBVERSION)
@@ -225,16 +123,6 @@ LIBVERSION=`echo ${VERSION} | cut -d '.' -f 1`
 CXXFLAGS=&quot;$CXXFLAGS -DVERSION=\\\&quot;${VERSION}\\\&quot;&quot;
 CPPFLAGS=&quot;$CPPFLAGS -DVERSION=\\\&quot;${VERSION}\\\&quot;&quot;
 
-dnl Finally compose the LIB variable.
-
-if test &quot;$DARWIN&quot; = yes ; then
-  LIBS=&quot;$LIBS $LIBSTATIC $LIBSHARED&quot;
-elif test &quot;$SUN&quot; = yes ; then
-  LIBS=&quot;$LIBS $LIBSTATIC $LIBSHARED&quot;
-else
-  LIBS=&quot;$LIBS $LIBSTATIC -shared $LIBSHARED&quot;
-fi
-
 dnl Check whether --with-symbols or --without-symbols was
 dnl given and set the required optimization level.
 
@@ -266,6 +154,16 @@ else
   echo -e &quot;disabling valgrind memory checker workarounds&quot;
 fi
 
+dnl Cygwin requires that the stdc++ library is linked explicitly.
+dnl GCC 3.3.x requires also the z, png and jpeg libraries. This is
+dnl not true anymore since GCC 3.4.x.
+
+if test &quot;$CYGWIN32&quot; = yes; then
+    LIBS=&quot;$LIBS -L../nxcomp -lXcomp -lstdc++ -Wl,-e,_mainCRTStartup -ljpeg -lpng -lz&quot;
+else
+    LIBS=&quot;$LIBS -L../nxcomp -lXcomp&quot;
+fi
+
 dnl Find makedepend somewhere.
 
 AC_SUBST(MAKEDEPEND)
diff --git a/nxcompshad/install-sh b/nxproxy/install-sh
similarity index 100%
rename from nxcompshad/install-sh
rename to nxproxy/install-sh
diff --git a/nxproxy/mkinstalldirs b/nxproxy/mkinstalldirs
new file mode 100755
index 0000000..936cf34
--- /dev/null
+++ b/nxproxy/mkinstalldirs
@@ -0,0 +1,34 @@
+#! /bin/sh
+# mkinstalldirs --- make directory hierarchy
+# Author: Noah Friedman &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">friedman at prep.ai.mit.edu</A>&gt;
+# Created: 1993-05-16
+# Last modified: 1995-03-05
+# Public domain
+
+errstatus=0
+
+for file in ${1+&quot;$@&quot;} ; do
+   set fnord `echo &quot;:$file&quot; | sed -ne 's/^:\//#/;s/^://;s/\// /g;s/^#/\//;p'`
+   shift
+
+   pathcomp=
+   for d in ${1+&quot;$@&quot;} ; do
+     pathcomp=&quot;$pathcomp$d&quot;
+     case &quot;$pathcomp&quot; in
+       -* ) pathcomp=./$pathcomp ;;
+     esac
+
+     if test ! -d &quot;$pathcomp&quot;; then
+        echo &quot;mkdir $pathcomp&quot; 1&gt;&amp;2
+        mkdir &quot;$pathcomp&quot; &gt; /dev/null 2&gt;&amp;1 || lasterr=$?
+     fi
+
+     if test ! -d &quot;$pathcomp&quot;; then
+	errstatus=$lasterr
+     fi
+
+     pathcomp=&quot;$pathcomp/&quot;
+   done
+done
+
+exit $errstatus


hooks/post-receive
-- 
nx-libs.git (NX (redistributed))

This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;nx-libs.git&quot; (NX (redistributed)).

</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011368.html">[X2Go-Commits] nx-libs.git - build-main (branch) updated:	nxproxy/3.3.0-2
</A></li>
	<LI>Next message: <A HREF="011376.html">[X2Go-Commits] nx-libs.git - build-main (branch) updated:	nxproxy/3.4.0-2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11369">[ date ]</a>
              <a href="thread.html#11369">[ thread ]</a>
              <a href="subject.html#11369">[ subject ]</a>
              <a href="author.html#11369">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/x2go-commits">More information about the X2Go-commits
mailing list</a><br>
</body></html>
