<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [X2Go-Commits] nx-libs.git - build-main (branch) updated:	nx-X11/3.1.0-4
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/x2go-commits/2013-August/index.html" >
   <LINK REL="made" HREF="mailto:x2go-commits%40lists.berlios.de?Subject=Re%3A%20%5BX2Go-Commits%5D%20nx-libs.git%20-%20build-main%20%28branch%29%20updated%3A%0A%09nx-X11/3.1.0-4&In-Reply-To=%3C20130830142143.0F0BC5DB20%40ymir%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011300.html">
   <LINK REL="Next"  HREF="011302.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[X2Go-Commits] nx-libs.git - build-main (branch) updated:	nx-X11/3.1.0-4</H1>
    <B>X2Go dev team</B> 
    <A HREF="mailto:x2go-commits%40lists.berlios.de?Subject=Re%3A%20%5BX2Go-Commits%5D%20nx-libs.git%20-%20build-main%20%28branch%29%20updated%3A%0A%09nx-X11/3.1.0-4&In-Reply-To=%3C20130830142143.0F0BC5DB20%40ymir%3E"
       TITLE="[X2Go-Commits] nx-libs.git - build-main (branch) updated:	nx-X11/3.1.0-4">git-admin at x2go.org
       </A><BR>
    <I>Fri Aug 30 16:21:42 CEST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="011300.html">[X2Go-Commits] nx-libs.git - build-main (branch) updated:	nx-X11/3.1.0-3
</A></li>
        <LI>Next message: <A HREF="011302.html">[X2Go-Commits] nx-libs.git - build-main (branch) updated:	nx-X11/3.2.0-2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11301">[ date ]</a>
              <a href="thread.html#11301">[ thread ]</a>
              <a href="subject.html#11301">[ subject ]</a>
              <a href="author.html#11301">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch, build-main has been updated
       via  3d1c57d5ef429e51ab7a626540c30b81e74a8f17 (commit)
      from  844a4094f098684dd1da5bc11e73479fb61373a3 (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
-----------------------------------------------------------------------

Summary of changes:
 nx-X11/CHANGELOG                                   |    7 +++
 nx-X11/CHANGELOG.NX.original                       |    7 +++
 nx-X11/lib/font/bitmap/pcfread.c                   |    6 +++
 nx-X11/programs/Xserver/Xext/EVI.c                 |   15 +++++-
 nx-X11/programs/Xserver/Xext/cup.c                 |    3 ++
 nx-X11/programs/Xserver/Xext/sampleEVI.c           |   29 ++++++++++--
 nx-X11/programs/Xserver/Xext/security.c            |   10 ++--
 .../programs/Xserver/Xext/security.c.NX.original   |   10 ++--
 nx-X11/programs/Xserver/Xext/security.c.X.original |    6 +--
 nx-X11/programs/Xserver/Xext/shm.c                 |   50 ++++++++++++++++----
 nx-X11/programs/Xserver/Xi/chgfctl.c               |    8 +---
 nx-X11/programs/Xserver/Xi/chgkmap.c               |   15 +++---
 nx-X11/programs/Xserver/Xi/chgprop.c               |   11 ++---
 nx-X11/programs/Xserver/Xi/grabdev.c               |   13 ++---
 nx-X11/programs/Xserver/Xi/grabdevb.c              |   11 ++---
 nx-X11/programs/Xserver/Xi/grabdevk.c              |   10 +---
 nx-X11/programs/Xserver/Xi/selectev.c              |   12 ++---
 nx-X11/programs/Xserver/Xi/sendexev.c              |   15 +++---
 nx-X11/programs/Xserver/dix/dixfonts.c             |    7 +++
 nx-X11/programs/Xserver/dix/dixfonts.c.NX.original |    7 +++
 nx-X11/programs/Xserver/dix/dixfonts.c.X.original  |    7 +++
 .../Xserver/hw/xfree86/common/xf86MiscExt.c        |    4 ++
 22 files changed, 174 insertions(+), 89 deletions(-)

The diff of changes is:
diff --git a/nx-X11/CHANGELOG b/nx-X11/CHANGELOG
index ec5d6f8..fe29e19 100644
--- a/nx-X11/CHANGELOG
+++ b/nx-X11/CHANGELOG
@@ -1,5 +1,12 @@
 ChangeLog:
 
+nx-X11-3.1.0-4
+
+- Imported patch fixing issues from  X.Org security advisory, January
+  17th, 2008: Multiple vulnerabilities in the X server.  CVE IDs:
+  CVE-2007-5760    CVE-2007-5958    CVE-2007-6427   CVE-2007-6428
+  CVE-2007-6429    CVE-2008-0006.
+
 nx-X11-3.1.0-3
 
 - Moved a variable definition placed in _mesa_make_current().
diff --git a/nx-X11/CHANGELOG.NX.original b/nx-X11/CHANGELOG.NX.original
index ec5d6f8..fe29e19 100644
--- a/nx-X11/CHANGELOG.NX.original
+++ b/nx-X11/CHANGELOG.NX.original
@@ -1,5 +1,12 @@
 ChangeLog:
 
+nx-X11-3.1.0-4
+
+- Imported patch fixing issues from  X.Org security advisory, January
+  17th, 2008: Multiple vulnerabilities in the X server.  CVE IDs:
+  CVE-2007-5760    CVE-2007-5958    CVE-2007-6427   CVE-2007-6428
+  CVE-2007-6429    CVE-2008-0006.
+
 nx-X11-3.1.0-3
 
 - Moved a variable definition placed in _mesa_make_current().
diff --git a/nx-X11/lib/font/bitmap/pcfread.c b/nx-X11/lib/font/bitmap/pcfread.c
index dd76868..75916da 100644
--- a/nx-X11/lib/font/bitmap/pcfread.c
+++ b/nx-X11/lib/font/bitmap/pcfread.c
@@ -565,6 +565,9 @@ pcfReadFont(FontPtr pFont, FontFilePtr file,
     pFont-&gt;info.lastRow = pcfGetINT16(file, format);
     pFont-&gt;info.defaultCh = pcfGetINT16(file, format);
     if (IS_EOF(file)) goto Bail;
+    if (pFont-&gt;info.firstCol &gt; pFont-&gt;info.lastCol ||
+       pFont-&gt;info.firstRow &gt; pFont-&gt;info.lastRow ||
+       pFont-&gt;info.lastCol-pFont-&gt;info.firstCol &gt; 255) goto Bail;
 
     nencoding = (pFont-&gt;info.lastCol - pFont-&gt;info.firstCol + 1) *
 	(pFont-&gt;info.lastRow - pFont-&gt;info.firstRow + 1);
@@ -703,6 +706,9 @@ pcfReadFontInfo(FontInfoPtr pFontInfo, FontFilePtr file)
     pFontInfo-&gt;lastRow = pcfGetINT16(file, format);
     pFontInfo-&gt;defaultCh = pcfGetINT16(file, format);
     if (IS_EOF(file)) goto Bail;
+    if (pFontInfo-&gt;firstCol &gt; pFontInfo-&gt;lastCol ||
+       pFontInfo-&gt;firstRow &gt; pFontInfo-&gt;lastRow ||
+       pFontInfo-&gt;lastCol-pFontInfo-&gt;firstCol &gt; 255) goto Bail;
 
     nencoding = (pFontInfo-&gt;lastCol - pFontInfo-&gt;firstCol + 1) *
 	(pFontInfo-&gt;lastRow - pFontInfo-&gt;firstRow + 1);
diff --git a/nx-X11/programs/Xserver/Xext/EVI.c b/nx-X11/programs/Xserver/Xext/EVI.c
index b591806..93ed19f 100644
--- a/nx-X11/programs/Xserver/Xext/EVI.c
+++ b/nx-X11/programs/Xserver/Xext/EVI.c
@@ -36,6 +36,7 @@ THE USE OR PERFORMANCE OF THIS SOFTWARE.
 #include &lt;X11/extensions/XEVIstr.h&gt;
 #include &quot;EVIstruct.h&quot;
 #include &quot;modinit.h&quot;
+#include &quot;scrnintstr.h&quot;
 
 #if 0
 static unsigned char XEVIReqCode = 0;
@@ -89,10 +90,22 @@ ProcEVIGetVisualInfo(ClientPtr client)
 {
     REQUEST(xEVIGetVisualInfoReq);
     xEVIGetVisualInfoReply rep;
-    int n, n_conflict, n_info, sz_info, sz_conflict;
+    int i, n, n_conflict, n_info, sz_info, sz_conflict;
     VisualID32 *conflict;
+    unsigned int total_visuals = 0;
     xExtendedVisualInfo *eviInfo;
     int status;
+
+    /*
+     * do this first, otherwise REQUEST_FIXED_SIZE can overflow.  we assume
+     * here that you don't have more than 2^32 visuals over all your screens;
+     * this seems like a safe assumption.
+     */
+    for (i = 0; i &lt; screenInfo.numScreens; i++)
+	total_visuals += screenInfo.screens[i]-&gt;numVisuals;
+    if (stuff-&gt;n_visual &gt; total_visuals)
+	return BadValue;
+
     REQUEST_FIXED_SIZE(xEVIGetVisualInfoReq, stuff-&gt;n_visual * sz_VisualID32);
     status = eviPriv-&gt;getVisualInfo((VisualID32 *)&amp;stuff[1], (int)stuff-&gt;n_visual,
 		&amp;eviInfo, &amp;n_info, &amp;conflict, &amp;n_conflict);
diff --git a/nx-X11/programs/Xserver/Xext/cup.c b/nx-X11/programs/Xserver/Xext/cup.c
index 4db62cf..198aa80 100644
--- a/nx-X11/programs/Xserver/Xext/cup.c
+++ b/nx-X11/programs/Xserver/Xext/cup.c
@@ -202,6 +202,9 @@ int ProcGetReservedColormapEntries(
 
     REQUEST_SIZE_MATCH (xXcupGetReservedColormapEntriesReq);
 
+    if (stuff-&gt;screen &gt;= screenInfo.numScreens)
+	return BadValue;
+
 #ifndef HAVE_SPECIAL_DESKTOP_COLORS
     citems[CUP_BLACK_PIXEL].pixel = 
 	screenInfo.screens[stuff-&gt;screen]-&gt;blackPixel;
diff --git a/nx-X11/programs/Xserver/Xext/sampleEVI.c b/nx-X11/programs/Xserver/Xext/sampleEVI.c
index 67caa56..500a585 100644
--- a/nx-X11/programs/Xserver/Xext/sampleEVI.c
+++ b/nx-X11/programs/Xserver/Xext/sampleEVI.c
@@ -36,6 +36,13 @@ THE USE OR PERFORMANCE OF THIS SOFTWARE.
 #include &lt;X11/extensions/XEVIstr.h&gt;
 #include &quot;EVIstruct.h&quot;
 #include &quot;scrnintstr.h&quot;
+
+#if HAVE_STDINT_H
+#include &lt;stdint.h&gt;
+#elif !defined(UINT32_MAX)
+#define UINT32_MAX 0xffffffffU
+#endif
+
 static int sampleGetVisualInfo(
     VisualID32 *visual,
     int n_visual,
@@ -44,24 +51,36 @@ static int sampleGetVisualInfo(
     VisualID32 **conflict_rn,
     int *n_conflict_rn)
 {
-    int max_sz_evi = n_visual * sz_xExtendedVisualInfo * screenInfo.numScreens;
+    unsigned int max_sz_evi;
     VisualID32 *temp_conflict;
     xExtendedVisualInfo *evi;
-    int max_visuals = 0, max_sz_conflict, sz_conflict = 0;
+    unsigned int max_visuals = 0, max_sz_conflict, sz_conflict = 0;
     register int visualI, scrI, sz_evi = 0, conflictI, n_conflict;
-    *evi_rn = evi = (xExtendedVisualInfo *)xalloc(max_sz_evi);
-    if (!*evi_rn)
-         return BadAlloc;
+
+    if (n_visual &gt; UINT32_MAX/(sz_xExtendedVisualInfo * screenInfo.numScreens))
+	return BadAlloc;
+    max_sz_evi = n_visual * sz_xExtendedVisualInfo * screenInfo.numScreens;
+    
     for (scrI = 0; scrI &lt; screenInfo.numScreens; scrI++) {
         if (screenInfo.screens[scrI]-&gt;numVisuals &gt; max_visuals)
             max_visuals = screenInfo.screens[scrI]-&gt;numVisuals;
     }
+
+    if (n_visual &gt; UINT32_MAX/(sz_VisualID32 * screenInfo.numScreens 
+			       * max_visuals)) 
+	return BadAlloc;
     max_sz_conflict = n_visual * sz_VisualID32 * screenInfo.numScreens * max_visuals;
+
+    *evi_rn = evi = (xExtendedVisualInfo *)xalloc(max_sz_evi);
+    if (!*evi_rn)
+         return BadAlloc;
+
     temp_conflict = (VisualID32 *)xalloc(max_sz_conflict);
     if (!temp_conflict) {
         xfree(*evi_rn);
         return BadAlloc;
     }
+
     for (scrI = 0; scrI &lt; screenInfo.numScreens; scrI++) {
         for (visualI = 0; visualI &lt; n_visual; visualI++) {
 	    evi[sz_evi].core_visual_id = visual[visualI];
diff --git a/nx-X11/programs/Xserver/Xext/security.c b/nx-X11/programs/Xserver/Xext/security.c
index f37be69..cee8935 100644
--- a/nx-X11/programs/Xserver/Xext/security.c
+++ b/nx-X11/programs/Xserver/Xext/security.c
@@ -1822,11 +1822,11 @@ SecurityLoadPropertyAccessList(void)
 
 #ifdef NXAGENT_SERVER
 
-    f = fopen(_NXGetPolicyFilePath(SecurityPolicyFile), &quot;r&quot;);
+    f = Fopen(_NXGetPolicyFilePath(SecurityPolicyFile), &quot;r&quot;);
 
 #else
 
-    f = fopen(SecurityPolicyFile, &quot;r&quot;);
+    f = Fopen(SecurityPolicyFile, &quot;r&quot;);
 
 #endif
 
@@ -1834,11 +1834,11 @@ SecurityLoadPropertyAccessList(void)
 
 #ifdef NXAGENT_SERVER
 
-    f = fopen((char*)__XOS2RedirRoot( _NXGetPolicyFilePath(SecurityPolicyFile)), &quot;r&quot;);
+    f = Fopen((char*)__XOS2RedirRoot( _NXGetPolicyFilePath(SecurityPolicyFile)), &quot;r&quot;);
 
 #else
 
-    f = fopen((char*)__XOS2RedirRoot(SecurityPolicyFile), &quot;r&quot;);
+    f = Fopen((char*)__XOS2RedirRoot(SecurityPolicyFile), &quot;r&quot;);
 
 #endif
 
@@ -1960,7 +1960,7 @@ SecurityLoadPropertyAccessList(void)
     }
 #endif /* PROPDEBUG */
 
-    fclose(f);
+    Fclose(f);
 } /* SecurityLoadPropertyAccessList */
 
 
diff --git a/nx-X11/programs/Xserver/Xext/security.c.NX.original b/nx-X11/programs/Xserver/Xext/security.c.NX.original
index f37be69..cee8935 100644
--- a/nx-X11/programs/Xserver/Xext/security.c.NX.original
+++ b/nx-X11/programs/Xserver/Xext/security.c.NX.original
@@ -1822,11 +1822,11 @@ SecurityLoadPropertyAccessList(void)
 
 #ifdef NXAGENT_SERVER
 
-    f = fopen(_NXGetPolicyFilePath(SecurityPolicyFile), &quot;r&quot;);
+    f = Fopen(_NXGetPolicyFilePath(SecurityPolicyFile), &quot;r&quot;);
 
 #else
 
-    f = fopen(SecurityPolicyFile, &quot;r&quot;);
+    f = Fopen(SecurityPolicyFile, &quot;r&quot;);
 
 #endif
 
@@ -1834,11 +1834,11 @@ SecurityLoadPropertyAccessList(void)
 
 #ifdef NXAGENT_SERVER
 
-    f = fopen((char*)__XOS2RedirRoot( _NXGetPolicyFilePath(SecurityPolicyFile)), &quot;r&quot;);
+    f = Fopen((char*)__XOS2RedirRoot( _NXGetPolicyFilePath(SecurityPolicyFile)), &quot;r&quot;);
 
 #else
 
-    f = fopen((char*)__XOS2RedirRoot(SecurityPolicyFile), &quot;r&quot;);
+    f = Fopen((char*)__XOS2RedirRoot(SecurityPolicyFile), &quot;r&quot;);
 
 #endif
 
@@ -1960,7 +1960,7 @@ SecurityLoadPropertyAccessList(void)
     }
 #endif /* PROPDEBUG */
 
-    fclose(f);
+    Fclose(f);
 } /* SecurityLoadPropertyAccessList */
 
 
diff --git a/nx-X11/programs/Xserver/Xext/security.c.X.original b/nx-X11/programs/Xserver/Xext/security.c.X.original
index 26c8428..765769a 100644
--- a/nx-X11/programs/Xserver/Xext/security.c.X.original
+++ b/nx-X11/programs/Xserver/Xext/security.c.X.original
@@ -1647,9 +1647,9 @@ SecurityLoadPropertyAccessList(void)
 	return;
 
 #ifndef __UNIXOS2__
-    f = fopen(SecurityPolicyFile, &quot;r&quot;);
+    f = Fopen(SecurityPolicyFile, &quot;r&quot;);
 #else
-    f = fopen((char*)__XOS2RedirRoot(SecurityPolicyFile), &quot;r&quot;);
+    f = Fopen((char*)__XOS2RedirRoot(SecurityPolicyFile), &quot;r&quot;);
 #endif    
     if (!f)
     {
@@ -1733,7 +1733,7 @@ SecurityLoadPropertyAccessList(void)
     }
 #endif /* PROPDEBUG */
 
-    fclose(f);
+    Fclose(f);
 } /* SecurityLoadPropertyAccessList */
 
 
diff --git a/nx-X11/programs/Xserver/Xext/shm.c b/nx-X11/programs/Xserver/Xext/shm.c
index 806008c..e2cf8cd 100644
--- a/nx-X11/programs/Xserver/Xext/shm.c
+++ b/nx-X11/programs/Xserver/Xext/shm.c
@@ -728,6 +728,8 @@ ProcPanoramiXShmCreatePixmap(
     int i, j, result;
     ShmDescPtr shmdesc;
     REQUEST(xShmCreatePixmapReq);
+    unsigned int width, height, depth;
+    unsigned long size;
     PanoramiXRes *newPix;
 
     REQUEST_SIZE_MATCH(xShmCreatePixmapReq);
@@ -737,11 +739,18 @@ ProcPanoramiXShmCreatePixmap(
     LEGAL_NEW_RESOURCE(stuff-&gt;pid, client);
     VERIFY_GEOMETRABLE(pDraw, stuff-&gt;drawable, client);
     VERIFY_SHMPTR(stuff-&gt;shmseg, stuff-&gt;offset, TRUE, shmdesc, client);
-    if (!stuff-&gt;width || !stuff-&gt;height)
+
+    width = stuff-&gt;width;
+    height = stuff-&gt;height;
+    depth = stuff-&gt;depth;
+    if (!width || !height || !depth)
     {
 	client-&gt;errorValue = 0;
         return BadValue;
     }
+    if (width &gt; 32767 || height &gt; 32767)
+        return BadAlloc;
+
     if (stuff-&gt;depth != 1)
     {
         pDepth = pDraw-&gt;pScreen-&gt;allowedDepths;
@@ -751,10 +760,18 @@ ProcPanoramiXShmCreatePixmap(
 	client-&gt;errorValue = stuff-&gt;depth;
         return BadValue;
     }
+
 CreatePmap:
-    VERIFY_SHMSIZE(shmdesc, stuff-&gt;offset,
-		   PixmapBytePad(stuff-&gt;width, stuff-&gt;depth) * stuff-&gt;height,
-		   client);
+    size = PixmapBytePad(width, depth) * height;
+    if (sizeof(size) == 4 &amp;&amp; BitsPerPixel(depth) &gt; 8) {
+        if (size &lt; width * height)
+            return BadAlloc;
+        /* thankfully, offset is unsigned */
+        if (stuff-&gt;offset + size &lt; size)
+            return BadAlloc;
+    }
+
+    VERIFY_SHMSIZE(shmdesc, stuff-&gt;offset, size, client);
 
     if(!(newPix = (PanoramiXRes *) xalloc(sizeof(PanoramiXRes))))
 	return BadAlloc;
@@ -1052,6 +1069,8 @@ ProcShmCreatePixmap(client)
     register int i;
     ShmDescPtr shmdesc;
     REQUEST(xShmCreatePixmapReq);
+    unsigned int width, height, depth;
+    unsigned long size;
 
     REQUEST_SIZE_MATCH(xShmCreatePixmapReq);
     client-&gt;errorValue = stuff-&gt;pid;
@@ -1060,11 +1079,18 @@ ProcShmCreatePixmap(client)
     LEGAL_NEW_RESOURCE(stuff-&gt;pid, client);
     VERIFY_GEOMETRABLE(pDraw, stuff-&gt;drawable, client);
     VERIFY_SHMPTR(stuff-&gt;shmseg, stuff-&gt;offset, TRUE, shmdesc, client);
-    if (!stuff-&gt;width || !stuff-&gt;height)
+    
+    width = stuff-&gt;width;
+    height = stuff-&gt;height;
+    depth = stuff-&gt;depth;
+    if (!width || !height || !depth)
     {
 	client-&gt;errorValue = 0;
         return BadValue;
     }
+    if (width &gt; 32767 || height &gt; 32767)
+	return BadAlloc;
+
     if (stuff-&gt;depth != 1)
     {
         pDepth = pDraw-&gt;pScreen-&gt;allowedDepths;
@@ -1074,10 +1100,18 @@ ProcShmCreatePixmap(client)
 	client-&gt;errorValue = stuff-&gt;depth;
         return BadValue;
     }
+
 CreatePmap:
-    VERIFY_SHMSIZE(shmdesc, stuff-&gt;offset,
-		   PixmapBytePad(stuff-&gt;width, stuff-&gt;depth) * stuff-&gt;height,
-		   client);
+    size = PixmapBytePad(width, depth) * height;
+    if (sizeof(size) == 4 &amp;&amp; BitsPerPixel(depth) &gt; 8) {
+	if (size &lt; width * height)
+	    return BadAlloc;
+	/* thankfully, offset is unsigned */
+	if (stuff-&gt;offset + size &lt; size)
+	    return BadAlloc;
+    }
+
+    VERIFY_SHMSIZE(shmdesc, stuff-&gt;offset, size, client);
     pMap = (*shmFuncs[pDraw-&gt;pScreen-&gt;myNum]-&gt;CreatePixmap)(
 			    pDraw-&gt;pScreen, stuff-&gt;width,
 			    stuff-&gt;height, stuff-&gt;depth,
diff --git a/nx-X11/programs/Xserver/Xi/chgfctl.c b/nx-X11/programs/Xserver/Xi/chgfctl.c
index c502db3..fe8bd1f 100644
--- a/nx-X11/programs/Xserver/Xi/chgfctl.c
+++ b/nx-X11/programs/Xserver/Xi/chgfctl.c
@@ -506,7 +506,6 @@ ChangeStringFeedback (client, dev, mask, s, f)
     xStringFeedbackCtl 	*f;
     {
     register char n;
-    register long *p;
     int		i, j;
     KeySym	*syms, *sup_syms;
 
@@ -514,12 +513,7 @@ ChangeStringFeedback (client, dev, mask, s, f)
     if (client-&gt;swapped)
 	{
 	swaps(&amp;f-&gt;length,n);	/* swapped num_keysyms in calling proc */
-	p = (long *) (syms);
-	for (i=0; i&lt;f-&gt;num_keysyms; i++)
-	    {
-	    swapl(p, n);
-	    p++;
-	    }
+	SwapLongs((CARD32 *) syms, f-&gt;num_keysyms);
 	}
 
     if (f-&gt;num_keysyms &gt; s-&gt;ctrl.max_symbols)
diff --git a/nx-X11/programs/Xserver/Xi/chgkmap.c b/nx-X11/programs/Xserver/Xi/chgkmap.c
index 6b2a15a..3df376d 100644
--- a/nx-X11/programs/Xserver/Xi/chgkmap.c
+++ b/nx-X11/programs/Xserver/Xi/chgkmap.c
@@ -83,19 +83,14 @@ SProcXChangeDeviceKeyMapping(client)
     register ClientPtr client;
     {
     register char n;
-    register long *p;
-    register int i, count;
+    unsigned int count;
 
     REQUEST(xChangeDeviceKeyMappingReq);
     swaps(&amp;stuff-&gt;length, n);
     REQUEST_AT_LEAST_SIZE(xChangeDeviceKeyMappingReq);
-    p = (long *) &amp;stuff[1];
     count = stuff-&gt;keyCodes * stuff-&gt;keySymsPerKeyCode;
-    for (i = 0; i &lt; count; i++)
-        {
-        swapl(p, n);
-	p++;
-        }
+    REQUEST_FIXED_SIZE(xChangeDeviceKeyMappingReq, count * sizeof(CARD32));
+    SwapLongs((CARD32 *) (&amp;stuff[1]), count);
     return(ProcXChangeDeviceKeyMapping(client));
     }
 
@@ -112,10 +107,14 @@ ProcXChangeDeviceKeyMapping(client)
     int	ret;
     unsigned len;
     DeviceIntPtr dev;
+    unsigned int count;
 
     REQUEST(xChangeDeviceKeyMappingReq);
     REQUEST_AT_LEAST_SIZE(xChangeDeviceKeyMappingReq);
 
+    count = stuff-&gt;keyCodes * stuff-&gt;keySymsPerKeyCode;
+    REQUEST_FIXED_SIZE(xChangeDeviceKeyMappingReq, count * sizeof(CARD32));
+
     dev = LookupDeviceIntRec (stuff-&gt;deviceid);
     if (dev == NULL)
 	{
diff --git a/nx-X11/programs/Xserver/Xi/chgprop.c b/nx-X11/programs/Xserver/Xi/chgprop.c
index 20c654e..6e345d5 100644
--- a/nx-X11/programs/Xserver/Xi/chgprop.c
+++ b/nx-X11/programs/Xserver/Xi/chgprop.c
@@ -85,20 +85,15 @@ SProcXChangeDeviceDontPropagateList(client)
     register ClientPtr client;
     {
     register char n;
-    register long *p;
-    register int i;
 
     REQUEST(xChangeDeviceDontPropagateListReq);
     swaps(&amp;stuff-&gt;length, n);
     REQUEST_AT_LEAST_SIZE(xChangeDeviceDontPropagateListReq);
     swapl(&amp;stuff-&gt;window, n);
     swaps(&amp;stuff-&gt;count, n);
-    p = (long *) &amp;stuff[1];
-    for (i=0; i&lt;stuff-&gt;count; i++)
-        {
-        swapl(p, n);
-	p++;
-        }
+    REQUEST_FIXED_SIZE(xChangeDeviceDontPropagateListReq,
+                      stuff-&gt;count * sizeof(CARD32));
+    SwapLongs((CARD32 *) (&amp;stuff[1]), stuff-&gt;count);
     return(ProcXChangeDeviceDontPropagateList(client));
     }
 
diff --git a/nx-X11/programs/Xserver/Xi/grabdev.c b/nx-X11/programs/Xserver/Xi/grabdev.c
index 3b124a0..21e920a 100644
--- a/nx-X11/programs/Xserver/Xi/grabdev.c
+++ b/nx-X11/programs/Xserver/Xi/grabdev.c
@@ -87,8 +87,6 @@ SProcXGrabDevice(client)
     register ClientPtr client;
     {
     register char n;
-    register long *p;
-    register int i;
 
     REQUEST(xGrabDeviceReq);
     swaps(&amp;stuff-&gt;length, n);
@@ -96,12 +94,11 @@ SProcXGrabDevice(client)
     swapl(&amp;stuff-&gt;grabWindow, n);
     swapl(&amp;stuff-&gt;time, n);
     swaps(&amp;stuff-&gt;event_count, n);
-    p = (long *) &amp;stuff[1];
-    for (i=0; i&lt;stuff-&gt;event_count; i++)
-        {
-        swapl(p, n);
-	p++;
-        }
+
+    if (stuff-&gt;length != (sizeof(xGrabDeviceReq) &gt;&gt; 2) + stuff-&gt;event_count)
+       return BadLength;
+    
+    SwapLongs((CARD32 *) (&amp;stuff[1]), stuff-&gt;event_count);
 
     return(ProcXGrabDevice(client));
     }
diff --git a/nx-X11/programs/Xserver/Xi/grabdevb.c b/nx-X11/programs/Xserver/Xi/grabdevb.c
index 84f0610..ad43c29 100644
--- a/nx-X11/programs/Xserver/Xi/grabdevb.c
+++ b/nx-X11/programs/Xserver/Xi/grabdevb.c
@@ -84,8 +84,6 @@ SProcXGrabDeviceButton(client)
     register ClientPtr client;
     {
     register char n;
-    register long *p;
-    register int i;
 
     REQUEST(xGrabDeviceButtonReq);
     swaps(&amp;stuff-&gt;length, n);
@@ -93,12 +91,9 @@ SProcXGrabDeviceButton(client)
     swapl(&amp;stuff-&gt;grabWindow, n);
     swaps(&amp;stuff-&gt;modifiers, n);
     swaps(&amp;stuff-&gt;event_count, n);
-    p = (long *) &amp;stuff[1];
-    for (i=0; i&lt;stuff-&gt;event_count; i++)
-        {
-        swapl(p, n);
-	p++;
-        }
+    REQUEST_FIXED_SIZE(xGrabDeviceButtonReq,
+                      stuff-&gt;event_count * sizeof(CARD32));
+    SwapLongs((CARD32 *) (&amp;stuff[1]), stuff-&gt;event_count);
 
     return(ProcXGrabDeviceButton(client));
     }
diff --git a/nx-X11/programs/Xserver/Xi/grabdevk.c b/nx-X11/programs/Xserver/Xi/grabdevk.c
index 17a9a9c..952c5d8 100644
--- a/nx-X11/programs/Xserver/Xi/grabdevk.c
+++ b/nx-X11/programs/Xserver/Xi/grabdevk.c
@@ -84,8 +84,6 @@ SProcXGrabDeviceKey(client)
     register ClientPtr client;
     {
     register char n;
-    register long *p;
-    register int i;
 
     REQUEST(xGrabDeviceKeyReq);
     swaps(&amp;stuff-&gt;length, n);
@@ -93,12 +91,8 @@ SProcXGrabDeviceKey(client)
     swapl(&amp;stuff-&gt;grabWindow, n);
     swaps(&amp;stuff-&gt;modifiers, n);
     swaps(&amp;stuff-&gt;event_count, n);
-    p = (long *) &amp;stuff[1];
-    for (i=0; i&lt;stuff-&gt;event_count; i++)
-        {
-        swapl(p, n);
-	p++;
-        }
+    REQUEST_FIXED_SIZE(xGrabDeviceKeyReq, stuff-&gt;event_count * sizeof(CARD32));
+    SwapLongs((CARD32 *) (&amp;stuff[1]), stuff-&gt;event_count);
     return(ProcXGrabDeviceKey(client));
     }
 
diff --git a/nx-X11/programs/Xserver/Xi/selectev.c b/nx-X11/programs/Xserver/Xi/selectev.c
index c8a55f5..a9b7318 100644
--- a/nx-X11/programs/Xserver/Xi/selectev.c
+++ b/nx-X11/programs/Xserver/Xi/selectev.c
@@ -88,20 +88,16 @@ SProcXSelectExtensionEvent (client)
 register ClientPtr client;
     {
     register char n;
-    register long *p;
-    register int i;
 
     REQUEST(xSelectExtensionEventReq);
     swaps(&amp;stuff-&gt;length, n);
     REQUEST_AT_LEAST_SIZE(xSelectExtensionEventReq);
     swapl(&amp;stuff-&gt;window, n);
     swaps(&amp;stuff-&gt;count, n);
-    p = (long *) &amp;stuff[1];
-    for (i=0; i&lt;stuff-&gt;count; i++)
-        {
-        swapl(p, n);
-	p++;
-        }
+    REQUEST_FIXED_SIZE(xSelectExtensionEventReq,
+                      stuff-&gt;count * sizeof(CARD32));
+    SwapLongs((CARD32 *) (&amp;stuff[1]), stuff-&gt;count);
+
     return(ProcXSelectExtensionEvent(client));
     }
 
diff --git a/nx-X11/programs/Xserver/Xi/sendexev.c b/nx-X11/programs/Xserver/Xi/sendexev.c
index c005aec..9b441f2 100644
--- a/nx-X11/programs/Xserver/Xi/sendexev.c
+++ b/nx-X11/programs/Xserver/Xi/sendexev.c
@@ -87,7 +87,7 @@ SProcXSendExtensionEvent(client)
     register ClientPtr client;
     {
     register char n;
-    register long *p;
+    CARD32 *p;
     register int i;
     xEvent eventT;
     xEvent *eventP;
@@ -98,6 +98,11 @@ SProcXSendExtensionEvent(client)
     REQUEST_AT_LEAST_SIZE(xSendExtensionEventReq);
     swapl(&amp;stuff-&gt;destination, n);
     swaps(&amp;stuff-&gt;count, n);
+
+    if (stuff-&gt;length != (sizeof(xSendExtensionEventReq) &gt;&gt; 2) + stuff-&gt;count +
+       (stuff-&gt;num_events * (sizeof(xEvent) &gt;&gt; 2)))
+       return BadLength;
+
     eventP = (xEvent *) &amp;stuff[1];
     for (i=0; i&lt;stuff-&gt;num_events; i++,eventP++)
         {
@@ -108,12 +113,8 @@ SProcXSendExtensionEvent(client)
 	*eventP = eventT;
 	}
 
-    p = (long *) (((xEvent *) &amp;stuff[1]) + stuff-&gt;num_events);
-    for (i=0; i&lt;stuff-&gt;count; i++)
-        {
-        swapl(p, n);
-	p++;
-        }
+    p = (CARD32 *)(((xEvent *) &amp; stuff[1]) + stuff-&gt;num_events);
+    SwapLongs(p, stuff-&gt;count);
     return(ProcXSendExtensionEvent(client));
     }
 
diff --git a/nx-X11/programs/Xserver/dix/dixfonts.c b/nx-X11/programs/Xserver/dix/dixfonts.c
index e62f614..b66fe23 100644
--- a/nx-X11/programs/Xserver/dix/dixfonts.c
+++ b/nx-X11/programs/Xserver/dix/dixfonts.c
@@ -393,6 +393,13 @@ doOpenFont(ClientPtr client, OFclosurePtr c)
 	err = BadFontName;
 	goto bail;
     }
+    /* check values for firstCol, lastCol, firstRow, and lastRow */
+    if (pfont-&gt;info.firstCol &gt; pfont-&gt;info.lastCol ||
+       pfont-&gt;info.firstRow &gt; pfont-&gt;info.lastRow ||
+       pfont-&gt;info.lastCol - pfont-&gt;info.firstCol &gt; 255) {
+       err = AllocError;
+       goto bail;
+    }
     if (!pfont-&gt;fpe)
 	pfont-&gt;fpe = fpe;
     pfont-&gt;refcnt++;
diff --git a/nx-X11/programs/Xserver/dix/dixfonts.c.NX.original b/nx-X11/programs/Xserver/dix/dixfonts.c.NX.original
index e62f614..b66fe23 100644
--- a/nx-X11/programs/Xserver/dix/dixfonts.c.NX.original
+++ b/nx-X11/programs/Xserver/dix/dixfonts.c.NX.original
@@ -393,6 +393,13 @@ doOpenFont(ClientPtr client, OFclosurePtr c)
 	err = BadFontName;
 	goto bail;
     }
+    /* check values for firstCol, lastCol, firstRow, and lastRow */
+    if (pfont-&gt;info.firstCol &gt; pfont-&gt;info.lastCol ||
+       pfont-&gt;info.firstRow &gt; pfont-&gt;info.lastRow ||
+       pfont-&gt;info.lastCol - pfont-&gt;info.firstCol &gt; 255) {
+       err = AllocError;
+       goto bail;
+    }
     if (!pfont-&gt;fpe)
 	pfont-&gt;fpe = fpe;
     pfont-&gt;refcnt++;
diff --git a/nx-X11/programs/Xserver/dix/dixfonts.c.X.original b/nx-X11/programs/Xserver/dix/dixfonts.c.X.original
index 9de9984..2c5874e 100644
--- a/nx-X11/programs/Xserver/dix/dixfonts.c.X.original
+++ b/nx-X11/programs/Xserver/dix/dixfonts.c.X.original
@@ -336,6 +336,13 @@ doOpenFont(ClientPtr client, OFclosurePtr c)
 	err = BadFontName;
 	goto bail;
     }
+    /* check values for firstCol, lastCol, firstRow, and lastRow */
+    if (pfont-&gt;info.firstCol &gt; pfont-&gt;info.lastCol ||
+       pfont-&gt;info.firstRow &gt; pfont-&gt;info.lastRow ||
+       pfont-&gt;info.lastCol - pfont-&gt;info.firstCol &gt; 255) {
+       err = AllocError;
+       goto bail;
+    }
     if (!pfont-&gt;fpe)
 	pfont-&gt;fpe = fpe;
     pfont-&gt;refcnt++;
diff --git a/nx-X11/programs/Xserver/hw/xfree86/common/xf86MiscExt.c b/nx-X11/programs/Xserver/hw/xfree86/common/xf86MiscExt.c
index 54c0cd5..de48027 100644
--- a/nx-X11/programs/Xserver/hw/xfree86/common/xf86MiscExt.c
+++ b/nx-X11/programs/Xserver/hw/xfree86/common/xf86MiscExt.c
@@ -647,6 +647,10 @@ MiscExtPassMessage(int scrnIndex, const char *msgtype, const char *msgval,
 
     DEBUG_P(&quot;MiscExtPassMessage&quot;);
 
+    /* should check this in the protocol, but xf86NumScreens isn't exported */
+    if (scrnIndex &gt;= xf86NumScreens)
+	return BadValue;
+
     if (*pScr-&gt;HandleMessage == NULL)
 	    return BadImplementation;
     return (*pScr-&gt;HandleMessage)(scrnIndex, msgtype, msgval, retstr);


hooks/post-receive
-- 
nx-libs.git (NX (redistributed))

This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;nx-libs.git&quot; (NX (redistributed)).

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011300.html">[X2Go-Commits] nx-libs.git - build-main (branch) updated:	nx-X11/3.1.0-3
</A></li>
	<LI>Next message: <A HREF="011302.html">[X2Go-Commits] nx-libs.git - build-main (branch) updated:	nx-X11/3.2.0-2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11301">[ date ]</a>
              <a href="thread.html#11301">[ thread ]</a>
              <a href="subject.html#11301">[ subject ]</a>
              <a href="author.html#11301">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/x2go-commits">More information about the X2Go-commits
mailing list</a><br>
</body></html>
