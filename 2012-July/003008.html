<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [X2go-Commits] x2goserver.git - build-main (branch) updated: 3.1.1.3
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/x2go-commits/2012-July/index.html" >
   <LINK REL="made" HREF="mailto:x2go-commits%40lists.berlios.de?Subject=Re%3A%20%5BX2go-Commits%5D%20x2goserver.git%20-%20build-main%20%28branch%29%20updated%3A%203.1.1.3&In-Reply-To=%3C20120703080151.76FE05DB68%40ymir%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003009.html">
   <LINK REL="Next"  HREF="003010.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[X2go-Commits] x2goserver.git - build-main (branch) updated: 3.1.1.3</H1>
    <B>X2Go dev team</B> 
    <A HREF="mailto:x2go-commits%40lists.berlios.de?Subject=Re%3A%20%5BX2go-Commits%5D%20x2goserver.git%20-%20build-main%20%28branch%29%20updated%3A%203.1.1.3&In-Reply-To=%3C20120703080151.76FE05DB68%40ymir%3E"
       TITLE="[X2go-Commits] x2goserver.git - build-main (branch) updated: 3.1.1.3">git-admin at x2go.org
       </A><BR>
    <I>Tue Jul  3 10:01:51 CEST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="003009.html">[X2go-Commits] x2goserver.git - master (branch) updated:	3.1.1.2-8-g1bbfded
</A></li>
        <LI>Next message: <A HREF="003010.html">[X2go-Commits] x2goserver.git - master (branch) updated:	3.1.1.3-1-g15f93bf
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3008">[ date ]</a>
              <a href="thread.html#3008">[ thread ]</a>
              <a href="subject.html#3008">[ subject ]</a>
              <a href="author.html#3008">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch, build-main has been updated
       via  1bbfded0225f0790c727cbf2e13e41aa19bee92d (commit)
       via  90f7a40a659b98d62f936890aa7c786ea914cc44 (commit)
       via  c13d693dfd13f19bac13ad430b2165b2e6322f2a (commit)
       via  33fc7739485510ff8fbc28e16aa038c99eac93b2 (commit)
       via  e305a0a9cc943453a2e3508926967dc6b38bd525 (commit)
       via  e1d66fc8929ff79495414e48068192a65c7d072d (commit)
       via  44cbc5037875d6f5755abfd39271ab1c41347228 (commit)
       via  f1f73d203353f5d5f29c156a0298a2de927602a4 (commit)
      from  4b25144ff4a9b71347e04e841c0b7dee3eb5f86d (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
-----------------------------------------------------------------------

Summary of changes:
 debian/changelog                                   |   17 +++++++++++++++++
 debian/x2goserver.init                             |    4 ++--
 x2goserver-compat/Makefile                         |    8 ++++----
 x2goserver-compat/VERSION.x2goserver-compat        |    2 +-
 x2goserver-extensions/Makefile                     |    8 ++++----
 .../VERSION.x2goserver-extensions                  |    2 +-
 x2goserver-fmbindings/Makefile                     |    8 ++++----
 .../VERSION.x2goserver-fmbindings                  |    2 +-
 x2goserver-printing/Makefile                       |    8 ++++----
 x2goserver-printing/VERSION.x2goserver-printing    |    2 +-
 x2goserver-printing/bin/x2goprint                  |    4 ++--
 x2goserver-pyhoca/Makefile                         |    8 ++++----
 x2goserver-pyhoca/VERSION.x2goserver-pyhoca        |    2 +-
 x2goserver-xsession/Makefile                       |   11 +++++------
 x2goserver-xsession/VERSION.x2goserver-xsession    |    2 +-
 x2goserver/Makefile                                |    8 ++++----
 x2goserver/VERSION.x2goserver                      |    2 +-
 x2goserver/bin/x2goresume-session                  |    8 ++++++--
 x2goserver/bin/x2gostartagent                      |   10 +++++++---
 19 files changed, 70 insertions(+), 46 deletions(-)

The diff of changes is:
diff --git a/debian/changelog b/debian/changelog
index f31cd4e..e69b220 100644
--- a/debian/changelog
+++ b/debian/changelog
@@ -1,3 +1,20 @@
+x2goserver (3.1.1.3-0~x2go1) unstable; urgency=low
+
+  [ Jan Engelhardt ]
+  * New upstream version (3.1.1.3):
+    - Do not block /etc/X11/Xresources with a directory (in Makefile).
+    - Avoid using archaic tools during free port detection.
+    - Avoid using ls in Makefiles.
+
+  [ Mike Gabriel ]
+  * New upstream version (3.1.1.3):
+    - Fix broken X2Go client-side printing. Adapt x2goprint to new spool job
+      directory.
+  * /debian/x2goserver.init:
+    + Orthography fix: X2Go instead of x2go.
+
+ -- Mike Gabriel &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">mike.gabriel at das-netzwerkteam.de</A>&gt;  Tue, 03 Jul 2012 10:00:32 +0200
+
 x2goserver (3.1.1.2-0~x2go1) unstable; urgency=low
 
   [ Mike Gabriel ]
diff --git a/debian/x2goserver.init b/debian/x2goserver.init
index be3631c..b56a4cb 100644
--- a/debian/x2goserver.init
+++ b/debian/x2goserver.init
@@ -12,7 +12,7 @@ PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
 
 case &quot;$1&quot; in
 	start)
-		echo &quot;Cleaning up stale x2go sessions.&quot;
+		echo &quot;Cleaning up stale X2Go sessions.&quot;
 		/usr/sbin/x2gocleansessions
 	;;
 	stop)
@@ -22,7 +22,7 @@ case &quot;$1&quot; in
 	reload|force-reload|restart)
 		# kill x2gocleansessions, ignore on failure
 		killall x2gocleansessions || true
-		echo &quot;Cleaning up stale x2go sessions.&quot;
+		echo &quot;Cleaning up stale X2Go sessions.&quot;
 		/usr/sbin/x2gocleansessions
 	;;
 	*)
diff --git a/x2goserver-compat/Makefile b/x2goserver-compat/Makefile
index 6bdc94c..d8a3c95 100755
--- a/x2goserver-compat/Makefile
+++ b/x2goserver-compat/Makefile
@@ -19,10 +19,10 @@ BINDIR=$(PREFIX)/bin
 MANDIR=$(PREFIX)/share/man
 SHAREDIR=$(PREFIX)/share/x2go
 
-BIN_SCRIPTS=$(shell cd bin &amp;&amp; ls)
-#SBIN_SCRIPTS=$(shell cd sbin &amp;&amp; ls)
-#LIB_FILES=$(shell cd lib &amp;&amp; ls)
-FEATURE_SCRIPTS=$(shell cd share/x2gofeature.d &amp;&amp; ls *.features)
+BIN_SCRIPTS=$(shell cd bin &amp;&amp; echo *)
+#SBIN_SCRIPTS=$(shell cd sbin &amp;&amp; echo *)
+#LIB_FILES=$(shell cd lib &amp;&amp; echo *)
+FEATURE_SCRIPTS=$(shell cd share/x2gofeature.d &amp;&amp; echo *.features)
 
 man_pages = `cd man &amp;&amp; find * -type f`
 
diff --git a/x2goserver-compat/VERSION.x2goserver-compat b/x2goserver-compat/VERSION.x2goserver-compat
index 2fc27ca..c7271d2 100644
--- a/x2goserver-compat/VERSION.x2goserver-compat
+++ b/x2goserver-compat/VERSION.x2goserver-compat
@@ -1 +1 @@
-3.1.1.2
\ No newline at end of file
+3.1.1.3
\ No newline at end of file
diff --git a/x2goserver-extensions/Makefile b/x2goserver-extensions/Makefile
index d3bbbb6..13cf560 100755
--- a/x2goserver-extensions/Makefile
+++ b/x2goserver-extensions/Makefile
@@ -19,10 +19,10 @@ LIBDIR=$(PREFIX)/lib/x2go
 MANDIR=$(PREFIX)/share/man
 SHAREDIR=$(PREFIX)/share/x2go
 
-BIN_SCRIPTS=$(shell cd bin &amp;&amp; ls)
-#SBIN_SCRIPTS=$(shell cd sbin &amp;&amp; ls)
-#LIB_FILES=$(shell cd lib &amp;&amp; ls)
-FEATURE_SCRIPTS=$(shell cd share/x2gofeature.d &amp;&amp; ls *.features .placeholder)
+BIN_SCRIPTS=$(shell cd bin &amp;&amp; echo *)
+#SBIN_SCRIPTS=$(shell cd sbin &amp;&amp; echo *)
+#LIB_FILES=$(shell cd lib &amp;&amp; echo *)
+FEATURE_SCRIPTS=$(shell cd share/x2gofeature.d &amp;&amp; echo *.features .placeholder)
 
 man_pages = `cd man &amp;&amp; find * -type f`
 
diff --git a/x2goserver-extensions/VERSION.x2goserver-extensions b/x2goserver-extensions/VERSION.x2goserver-extensions
index 2fc27ca..c7271d2 100644
--- a/x2goserver-extensions/VERSION.x2goserver-extensions
+++ b/x2goserver-extensions/VERSION.x2goserver-extensions
@@ -1 +1 @@
-3.1.1.2
\ No newline at end of file
+3.1.1.3
\ No newline at end of file
diff --git a/x2goserver-fmbindings/Makefile b/x2goserver-fmbindings/Makefile
index a9d8da5..8661e83 100755
--- a/x2goserver-fmbindings/Makefile
+++ b/x2goserver-fmbindings/Makefile
@@ -19,10 +19,10 @@ LIBDIR=$(PREFIX)/lib/x2go
 MANDIR=$(PREFIX)/share/man
 SHAREDIR=$(PREFIX)/share/x2go
 
-BIN_SCRIPTS=$(shell cd bin &amp;&amp; ls)
-#SBIN_SCRIPTS=$(shell cd sbin &amp;&amp; ls)
-#LIB_FILES=$(shell cd lib &amp;&amp; ls)
-FEATURE_SCRIPTS=$(shell cd share/x2go/x2gofeature.d &amp;&amp; ls *.features)
+BIN_SCRIPTS=$(shell cd bin &amp;&amp; echo *)
+#SBIN_SCRIPTS=$(shell cd sbin &amp;&amp; echo *)
+#LIB_FILES=$(shell cd lib &amp;&amp; echo *)
+FEATURE_SCRIPTS=$(shell cd share/x2go/x2gofeature.d &amp;&amp; echo *.features)
 
 man_pages = `cd man &amp;&amp; find * -type f`
 
diff --git a/x2goserver-fmbindings/VERSION.x2goserver-fmbindings b/x2goserver-fmbindings/VERSION.x2goserver-fmbindings
index ff03238..c7271d2 100644
--- a/x2goserver-fmbindings/VERSION.x2goserver-fmbindings
+++ b/x2goserver-fmbindings/VERSION.x2goserver-fmbindings
@@ -1 +1 @@
-3.1.1.2
+3.1.1.3
\ No newline at end of file
diff --git a/x2goserver-printing/Makefile b/x2goserver-printing/Makefile
index 28ee92a..1c956f4 100755
--- a/x2goserver-printing/Makefile
+++ b/x2goserver-printing/Makefile
@@ -19,10 +19,10 @@ BINDIR=$(PREFIX)/bin
 MANDIR=$(PREFIX)/share/man
 SHAREDIR=$(PREFIX)/share/x2go
 
-BIN_SCRIPTS=$(shell cd bin &amp;&amp; ls)
-#SBIN_SCRIPTS=$(shell cd sbin &amp;&amp; ls)
-#LIB_FILES=$(shell cd lib &amp;&amp; ls)
-FEATURE_SCRIPTS=$(shell cd share/x2gofeature.d &amp;&amp; ls *.features)
+BIN_SCRIPTS=$(shell cd bin &amp;&amp; echo *)
+#SBIN_SCRIPTS=$(shell cd sbin &amp;&amp; echo *)
+#LIB_FILES=$(shell cd lib &amp;&amp; echo *)
+FEATURE_SCRIPTS=$(shell cd share/x2gofeature.d &amp;&amp; echo *.features)
 
 man_pages = `cd man &amp;&amp; find * -type f`
 
diff --git a/x2goserver-printing/VERSION.x2goserver-printing b/x2goserver-printing/VERSION.x2goserver-printing
index 2fc27ca..c7271d2 100644
--- a/x2goserver-printing/VERSION.x2goserver-printing
+++ b/x2goserver-printing/VERSION.x2goserver-printing
@@ -1 +1 @@
-3.1.1.2
\ No newline at end of file
+3.1.1.3
\ No newline at end of file
diff --git a/x2goserver-printing/bin/x2goprint b/x2goserver-printing/bin/x2goprint
index 113e5f6..e3f3f8f 100755
--- a/x2goserver-printing/bin/x2goprint
+++ b/x2goserver-printing/bin/x2goprint
@@ -92,8 +92,8 @@ syslog('notice', &quot;x2goprint is processing $printdir/$pdfFile with print job titl
 # with user privileges
 ($tm,$tm,$uid,$gid,$tm,$tm,$tm,$homedir)=getpwnam($user);
 
-my $spoolbase=&quot;/tmp/spool_$user&quot;;
-my $spooldir=&quot;$spoolbase/$session&quot;;
+my $spoolbase=&quot;/tmp/.x2go-$user/spool&quot;;
+my $spooldir=&quot;$spoolbase/C-$session&quot;;
 my $spooltmp=&quot;$spoolbase/tmp&quot;;
 mkpath($spooltmp);
 chown $uid, $gid, &quot;$spooltmp&quot;;
diff --git a/x2goserver-pyhoca/Makefile b/x2goserver-pyhoca/Makefile
index c24be41..95ab06d 100755
--- a/x2goserver-pyhoca/Makefile
+++ b/x2goserver-pyhoca/Makefile
@@ -19,10 +19,10 @@ LIBDIR=$(PREFIX)/lib/x2go
 MANDIR=$(PREFIX)/share/man
 SHAREDIR=$(PREFIX)/share/x2go
 
-BIN_SCRIPTS=$(shell cd bin &amp;&amp; ls)
-#SBIN_SCRIPTS=$(shell cd sbin &amp;&amp; ls)
-#LIB_FILES=$(shell cd lib &amp;&amp; ls)
-FEATURE_SCRIPTS=$(shell cd share/x2gofeature.d &amp;&amp; ls *.features)
+BIN_SCRIPTS=$(shell cd bin &amp;&amp; echo *)
+#SBIN_SCRIPTS=$(shell cd sbin &amp;&amp; echo *)
+#LIB_FILES=$(shell cd lib &amp;&amp; echo *)
+FEATURE_SCRIPTS=$(shell cd share/x2gofeature.d &amp;&amp; echo *.features)
 
 man_pages = `cd man &amp;&amp; find * -type f`
 
diff --git a/x2goserver-pyhoca/VERSION.x2goserver-pyhoca b/x2goserver-pyhoca/VERSION.x2goserver-pyhoca
index 2fc27ca..c7271d2 100644
--- a/x2goserver-pyhoca/VERSION.x2goserver-pyhoca
+++ b/x2goserver-pyhoca/VERSION.x2goserver-pyhoca
@@ -1 +1 @@
-3.1.1.2
\ No newline at end of file
+3.1.1.3
\ No newline at end of file
diff --git a/x2goserver-xsession/Makefile b/x2goserver-xsession/Makefile
index 7a56c87..50c2818 100755
--- a/x2goserver-xsession/Makefile
+++ b/x2goserver-xsession/Makefile
@@ -20,11 +20,11 @@ ETCDIR=/etc/x2go
 MANDIR=$(PREFIX)/share/man
 SHAREDIR=$(PREFIX)/share/x2go
 
-#BIN_SCRIPTS=$(shell cd bin &amp;&amp; ls)
-#SBIN_SCRIPTS=$(shell cd sbin &amp;&amp; ls)
-#LIB_FILES=$(shell cd lib &amp;&amp; ls)
-ETC_FILES=$(shell cd etc &amp;&amp; ls)
-FEATURE_SCRIPTS=$(shell cd share/x2gofeature.d &amp;&amp; ls *.features)
+#BIN_SCRIPTS=$(shell cd bin &amp;&amp; echo *)
+#SBIN_SCRIPTS=$(shell cd sbin &amp;&amp; echo *)
+#LIB_FILES=$(shell cd lib &amp;&amp; echo *)
+ETC_FILES=$(shell cd etc &amp;&amp; echo *)
+FEATURE_SCRIPTS=$(shell cd share/x2gofeature.d &amp;&amp; echo *.features)
 
 #man_pages = `cd man &amp;&amp; find * -type f`
 
@@ -64,7 +64,6 @@ install_scripts:
 install_config:
 	$(INSTALL_DIR) $(DESTDIR)$(ETCDIR)
 #       provide target dirs for X11 related symlinks
-	mkdir -p $(DESTDIR)/etc/X11/Xresources
 	mkdir -p $(DESTDIR)/etc/X11/Xsession.d
 	touch $(DESTDIR)/etc/X11/Xsession.options
 	$(INSTALL_FILE) etc/Xsession                    $(DESTDIR)$(ETCDIR)/
diff --git a/x2goserver-xsession/VERSION.x2goserver-xsession b/x2goserver-xsession/VERSION.x2goserver-xsession
index 2fc27ca..c7271d2 100644
--- a/x2goserver-xsession/VERSION.x2goserver-xsession
+++ b/x2goserver-xsession/VERSION.x2goserver-xsession
@@ -1 +1 @@
-3.1.1.2
\ No newline at end of file
+3.1.1.3
\ No newline at end of file
diff --git a/x2goserver/Makefile b/x2goserver/Makefile
index be689c5..115c929 100755
--- a/x2goserver/Makefile
+++ b/x2goserver/Makefile
@@ -19,10 +19,10 @@ LIBDIR=$(PREFIX)/lib/x2go
 MANDIR=$(PREFIX)/share/man
 SHAREDIR=$(PREFIX)/share/x2go
 
-BIN_SCRIPTS=$(shell cd bin &amp;&amp; ls)
-SBIN_SCRIPTS=$(shell cd sbin &amp;&amp; ls)
-LIB_FILES=$(shell cd lib &amp;&amp; ls)
-FEATURE_SCRIPTS=$(shell cd share/x2gofeature.d &amp;&amp; ls *.features)
+BIN_SCRIPTS=$(shell cd bin &amp;&amp; echo *)
+SBIN_SCRIPTS=$(shell cd sbin &amp;&amp; echo *)
+LIB_FILES=$(shell cd lib &amp;&amp; echo *)
+FEATURE_SCRIPTS=$(shell cd share/x2gofeature.d &amp;&amp; echo *.features)
 
 man_pages = `cd man &amp;&amp; find * -type f`
 
diff --git a/x2goserver/VERSION.x2goserver b/x2goserver/VERSION.x2goserver
index 2fc27ca..c7271d2 100644
--- a/x2goserver/VERSION.x2goserver
+++ b/x2goserver/VERSION.x2goserver
@@ -1 +1 @@
-3.1.1.2
\ No newline at end of file
+3.1.1.3
\ No newline at end of file
diff --git a/x2goserver/bin/x2goresume-session b/x2goserver/bin/x2goresume-session
index 3a9772f..cddbf05 100755
--- a/x2goserver/bin/x2goresume-session
+++ b/x2goserver/bin/x2goresume-session
@@ -64,8 +64,12 @@ SERVER=`echo &quot;$SESSIONINFO&quot; | awk -F, {'print $4'}`
 
 $X2GO_LIB_PATH/x2gosyslog &quot;$0&quot; &quot;debug&quot; &quot;old ports: $GR_PORT, $SOUND_PORT, $FS_PORT&quot;
 
-#Get all used in system ports from netstat output
-SYSTEM_PORTS=`netstat -nt -all | awk '{ n=split($0,lines,&quot;\n&quot;); for(i=1;i&lt;=n;i++){split (lines[i],words,&quot; &quot;);delim=split(words[4],ports,&quot;:&quot;); if(delim&gt;1)printf (&quot;|%s|\n&quot;,ports[delim])} }'`
+#Get all used in system ports from ss output
+ss=$(PATH=&quot;$PATH:/usr/sbin:/sbin&quot; type -P ss);
+USED_PORTS=$(
+	&quot;$ss&quot; -lnt |
+	perl -lne 'print$d{$2}=&quot;|$2|&quot;if/^(\S+\s+){2}\S+:(\d+)/&amp;&amp;!exists$d{$2}';
+);
 
 #check if saved in DB ports free
 if grep -q &quot;|${GR_PORT}|&quot; &lt;&lt;&lt;$SYSTEM_PORTS ; then
diff --git a/x2goserver/bin/x2gostartagent b/x2goserver/bin/x2gostartagent
index fedd6ba..abf1422 100755
--- a/x2goserver/bin/x2gostartagent
+++ b/x2goserver/bin/x2gostartagent
@@ -124,9 +124,13 @@ fi
 
 USED_DISPLAYS=`$X2GO_LIB_PATH/x2gogetdisplays $HOSTNAME`
 
-#Get all used in system ports from X2Go database and netstat output
-USED_PORTS=`$X2GO_LIB_PATH/x2gogetports $HOSTNAME ; netstat -nt -all | awk '{ n=split($0,lines,&quot;\n&quot;); for(i=1;i&lt;=n;i++){split (lines[i],words,&quot; &quot;);delim=split(words[4],ports,&quot;:&quot;); if(delim&gt;1)printf (&quot;|%s|\n&quot;,ports[delim])} }'`
-
+#Get all used in system ports from X2Go database and ss output
+ss=$(PATH=&quot;$PATH:/usr/sbin:/sbin&quot; type -P ss);
+USED_PORTS=$(
+	&quot;$X2GO_LIB_PATH/x2gogetports&quot; &quot;$HOSTNAME&quot;;
+	&quot;$ss&quot; -lnt |
+	perl -lne 'print$d{$2}=&quot;|$2|&quot;if/^(\S+\s+){2}\S+:(\d+)/&amp;&amp;!exists$d{$2}';
+);
 
 while [ &quot;$OUTPUT&quot;  != &quot;inserted&quot; ]; do
 	X2GO_PORT=$(($X2GO_PORT + 1))


hooks/post-receive
-- 
x2goserver.git (X2Go Server)

This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;x2goserver.git&quot; (X2Go Server).

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003009.html">[X2go-Commits] x2goserver.git - master (branch) updated:	3.1.1.2-8-g1bbfded
</A></li>
	<LI>Next message: <A HREF="003010.html">[X2go-Commits] x2goserver.git - master (branch) updated:	3.1.1.3-1-g15f93bf
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3008">[ date ]</a>
              <a href="thread.html#3008">[ thread ]</a>
              <a href="subject.html#3008">[ subject ]</a>
              <a href="author.html#3008">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/x2go-commits">More information about the X2go-commits
mailing list</a><br>
</body></html>
