<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [X2go-Commits] x2goserver.git - build-main (branch) updated:	3.1.1.4-15-g66f1507
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/x2go-commits/2012-November/index.html" >
   <LINK REL="made" HREF="mailto:x2go-commits%40lists.berlios.de?Subject=Re%3A%20%5BX2go-Commits%5D%20x2goserver.git%20-%20build-main%20%28branch%29%20updated%3A%0A%093.1.1.4-15-g66f1507&In-Reply-To=%3C20121107154017.EF92D5DB19%40ymir%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003486.html">
   <LINK REL="Next"  HREF="003488.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[X2go-Commits] x2goserver.git - build-main (branch) updated:	3.1.1.4-15-g66f1507</H1>
    <B>X2Go dev team</B> 
    <A HREF="mailto:x2go-commits%40lists.berlios.de?Subject=Re%3A%20%5BX2go-Commits%5D%20x2goserver.git%20-%20build-main%20%28branch%29%20updated%3A%0A%093.1.1.4-15-g66f1507&In-Reply-To=%3C20121107154017.EF92D5DB19%40ymir%3E"
       TITLE="[X2go-Commits] x2goserver.git - build-main (branch) updated:	3.1.1.4-15-g66f1507">git-admin at x2go.org
       </A><BR>
    <I>Wed Nov  7 16:40:17 CET 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="003486.html">[X2go-Commits] x2goclient.git - master (branch) updated:	3.99.3.0-1-g5c545c9
</A></li>
        <LI>Next message: <A HREF="003488.html">[X2go-Commits] x2goserver.git - master (branch) updated:	3.1.1.3-84-g9abab8a
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3487">[ date ]</a>
              <a href="thread.html#3487">[ thread ]</a>
              <a href="subject.html#3487">[ subject ]</a>
              <a href="author.html#3487">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch, build-main has been updated
       via  66f150790fc68cc50eade2e070876d04adf2e851 (commit)
       via  07524db03a6c42a54941a03be6637b0ded80a448 (commit)
       via  de0ef239a7408fd7299f2ea599da91f975f3ffad (commit)
       via  ec11165bab6086fa649109a0814eba328a47d69a (commit)
       via  3e7f787ba06ffd6a90e48816cd1789b76ada4d64 (commit)
       via  fe8874ec148a015f0bff75407e00aa1b9ee9a99a (commit)
       via  abf5ce667307f34bfb034c4ff19dee74665c37e8 (commit)
       via  e8c4fc15d16b315d4471243f8dbb33d2eda2f900 (commit)
       via  c7d7bc79b50bd7c5691793218f11ec7375f2dcc8 (commit)
       via  3a9f412b1710c1b20a9e9b233c92532611dda001 (commit)
       via  cb4796d026014e9e07ec9ea3e80106bc03697f2f (commit)
       via  5cc4d72358fd7f99aeec74ce346f526315f33999 (commit)
       via  f8015d5c95b5d376bdf02b2fc7096c21ed368ce0 (commit)
       via  8da7d3082b406641fa2d4f363b51300b1c639bfa (commit)
       via  97ae712cc1fbfab753c0a0a1634550e97cc9aac7 (commit)
      from  7dced6158846f4cd2a7f1c9f2f94eef8225ff387 (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
commit 66f150790fc68cc50eade2e070876d04adf2e851
Author: Mike Gabriel &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">mike.gabriel at das-netzwerkteam.de</A>&gt;
Date:   Wed Nov 7 16:37:33 2012 +0100

    release 3.1.1.5

-----------------------------------------------------------------------

Summary of changes:
 debian/changelog                                   |   23 +++++++++++++
 debian/control                                     |    1 +
 x2goserver-compat/VERSION.x2goserver-compat        |    2 +-
 .../VERSION.x2goserver-extensions                  |    2 +-
 .../VERSION.x2goserver-fmbindings                  |    2 +-
 x2goserver-printing/VERSION.x2goserver-printing    |    2 +-
 x2goserver-pyhoca/VERSION.x2goserver-pyhoca        |    2 +-
 x2goserver-xsession/VERSION.x2goserver-xsession    |    2 +-
 x2goserver/VERSION.x2goserver                      |    2 +-
 x2goserver/bin/x2gogetapps                         |   18 ++++++++--
 x2goserver/bin/x2gomountdirs                       |   33 +++++++++++++++++-
 x2goserver/bin/x2goruncommand                      |   12 ++++---
 x2goserver/bin/x2goumount-session                  |   35 +++++++++++++++++++-
 x2goserver/lib/x2gogetagent                        |    4 +--
 x2goserver/sbin/x2gocleansessions                  |    1 +
 15 files changed, 123 insertions(+), 18 deletions(-)

The diff of changes is:
diff --git a/debian/changelog b/debian/changelog
index 48f929a..0cae7bf 100644
--- a/debian/changelog
+++ b/debian/changelog
@@ -1,3 +1,26 @@
+x2goserver (3.1.1.5-0~x2go1) unstable; urgency=low
+
+  [ St&#233;phane Graber ]
+  * New upstream version (3.1.1.5):
+    - Add a very basic SIGCHLD handler to x2gocleansessions. on SIGCHLD
+      let the script wait for cleaning up after its children. (Closes
+      upstream issue #38).
+
+  [ Mike Gabriel ]
+  * New upstream version (3.1.1.5):
+    - Fix x2gogetapps when rendering multi-section .desktop files. (Closes
+      upstream issue #43).
+    - Remove redundant setting of loglevel in x2gogetapps.
+    - Fix ,,Only extend LD_LIBRARY_PATH by Xrandr extension for KDE. Breaks
+      GNOME.'' from last release.
+    - Detect i18n name of Desktop folder via XDG_DESKTOP_DIR environment
+      variable.
+    - Put option of database call in x2gogetagent into parantheses.
+  * /debian/control:
+    + Depend on libfile-basedir-perl.
+
+ -- Mike Gabriel &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">mike.gabriel at das-netzwerkteam.de</A>&gt;  Wed, 07 Nov 2012 16:36:36 +0100
+
 x2goserver (3.1.1.4-0~x2go1) unstable; urgency=low
 
   [ Jan Engelhardt ]
diff --git a/debian/control b/debian/control
index 4cfca15..ba29b5a 100644
--- a/debian/control
+++ b/debian/control
@@ -26,6 +26,7 @@ Depends:
  makepasswd,
  libdbd-pg-perl,
  libdbd-sqlite3-perl,
+ libfile-basedir-perl,
  adduser,
  xauth,
  psmisc,
diff --git a/x2goserver-compat/VERSION.x2goserver-compat b/x2goserver-compat/VERSION.x2goserver-compat
index f927970..787e085 100644
--- a/x2goserver-compat/VERSION.x2goserver-compat
+++ b/x2goserver-compat/VERSION.x2goserver-compat
@@ -1 +1 @@
-3.1.1.4
\ No newline at end of file
+3.1.1.5
\ No newline at end of file
diff --git a/x2goserver-extensions/VERSION.x2goserver-extensions b/x2goserver-extensions/VERSION.x2goserver-extensions
index f927970..787e085 100644
--- a/x2goserver-extensions/VERSION.x2goserver-extensions
+++ b/x2goserver-extensions/VERSION.x2goserver-extensions
@@ -1 +1 @@
-3.1.1.4
\ No newline at end of file
+3.1.1.5
\ No newline at end of file
diff --git a/x2goserver-fmbindings/VERSION.x2goserver-fmbindings b/x2goserver-fmbindings/VERSION.x2goserver-fmbindings
index f927970..787e085 100644
--- a/x2goserver-fmbindings/VERSION.x2goserver-fmbindings
+++ b/x2goserver-fmbindings/VERSION.x2goserver-fmbindings
@@ -1 +1 @@
-3.1.1.4
\ No newline at end of file
+3.1.1.5
\ No newline at end of file
diff --git a/x2goserver-printing/VERSION.x2goserver-printing b/x2goserver-printing/VERSION.x2goserver-printing
index f927970..787e085 100644
--- a/x2goserver-printing/VERSION.x2goserver-printing
+++ b/x2goserver-printing/VERSION.x2goserver-printing
@@ -1 +1 @@
-3.1.1.4
\ No newline at end of file
+3.1.1.5
\ No newline at end of file
diff --git a/x2goserver-pyhoca/VERSION.x2goserver-pyhoca b/x2goserver-pyhoca/VERSION.x2goserver-pyhoca
index f927970..787e085 100644
--- a/x2goserver-pyhoca/VERSION.x2goserver-pyhoca
+++ b/x2goserver-pyhoca/VERSION.x2goserver-pyhoca
@@ -1 +1 @@
-3.1.1.4
\ No newline at end of file
+3.1.1.5
\ No newline at end of file
diff --git a/x2goserver-xsession/VERSION.x2goserver-xsession b/x2goserver-xsession/VERSION.x2goserver-xsession
index f927970..787e085 100644
--- a/x2goserver-xsession/VERSION.x2goserver-xsession
+++ b/x2goserver-xsession/VERSION.x2goserver-xsession
@@ -1 +1 @@
-3.1.1.4
\ No newline at end of file
+3.1.1.5
\ No newline at end of file
diff --git a/x2goserver/VERSION.x2goserver b/x2goserver/VERSION.x2goserver
index f927970..787e085 100644
--- a/x2goserver/VERSION.x2goserver
+++ b/x2goserver/VERSION.x2goserver
@@ -1 +1 @@
-3.1.1.4
\ No newline at end of file
+3.1.1.5
\ No newline at end of file
diff --git a/x2goserver/bin/x2gogetapps b/x2goserver/bin/x2gogetapps
index 9460cd3..dbcd8c1 100755
--- a/x2goserver/bin/x2gogetapps
+++ b/x2goserver/bin/x2gogetapps
@@ -117,9 +117,24 @@ sub proc_desktop_file
 	if (open(F,&quot;&lt;$file&quot;))
 	{
 		print(&quot;&lt;desktop&gt;\n&quot;);
+		my $is_desktop_entry = 0;
 		while(!eof(F))
 		{
 			my $line=&lt;F&gt;;
+			if ( $line=~m/^\[Desktop Entry\] */ )
+			{
+				$is_desktop_entry = 1;
+				next;
+			}
+			if ( ! $is_desktop_entry )
+			{
+				next;
+			}
+			if ( $line=~m/^\[.*\] */ )
+			{
+				$is_desktop_entry = 0;
+				next;
+			}
 			if( $line=~m/^Categories/i || $line=~m/^Name/i || $line=~m/^Terminal/i || $line=~m/^Comment/i ||  $line=~m/^Exec/i)
 			{
 				print $line;
@@ -155,9 +170,6 @@ sub proc_desktop_file
 	}
 }
 
-openlog($0,'cons,pid','user');
-setlogmask( LOG_UPTO(x2gologlevel()) );
-
 if ( @ARGV ) {
 	syslog('info', &quot;x2gogetapps has been called with options: @ARGV&quot;);
 } else {
diff --git a/x2goserver/bin/x2gomountdirs b/x2goserver/bin/x2gomountdirs
index d4249ad..8d18b92 100755
--- a/x2goserver/bin/x2gomountdirs
+++ b/x2goserver/bin/x2gomountdirs
@@ -22,6 +22,7 @@
 
 use strict;
 use Sys::Syslog qw( :standard :macros );
+use File::BaseDir qw( xdg_config_home );
 
 use lib `echo -n \$(x2gobasepath)/lib/x2go`;
 use x2godbwrapper;
@@ -33,6 +34,28 @@ setlogmask( LOG_UPTO(x2gologlevel()) );
 
 syslog('info', &quot;x2gomountdirs has been called with options: @ARGV&quot;);
 
+sub source {
+    my $name = shift;
+
+    open my $fh, &quot;&lt;&quot;, $name
+        or die &quot;could not open $name: $!&quot;;
+
+    while (&lt;$fh&gt;) {
+        chomp;
+        my $line = $_;
+        if ( $line =~ m/^#.*/ )
+        {
+            next;
+        }
+        my ($k, $v) = split /=/, $line, 2;
+        if (
+        $v =~ s/^(['&quot;])(.*)\1/$2/; #' fix highlighter
+        $v =~ s/\$([a-zA-Z]\w*)/$ENV{$1}/g;
+        $v =~ s/`(.*?)`/`$1`/ge; #dangerous
+        $ENV{$k} = $v;
+    }
+}
+
 my $tmp_dir = '/tmp';
 
 my $type=shift;
@@ -107,6 +130,8 @@ my $spooldir=&quot;$tmp_dir/.x2go-$ENV{'USER'}/spool&quot;;
 my $mimeboxdir_lnk=&quot;$ENV{'HOME'}/.x2go/C-$session/mimebox&quot;;
 my $mimeboxdir=&quot;$tmp_dir/.x2go-$ENV{'USER'}/mimebox&quot;;
 
+source_environment(xdg_config_home() . &quot;/user-dirs.dirs&quot;);
+
 if (! -e $mdir)
 {
 	mkdir($mdir);
@@ -268,7 +293,13 @@ for (my $i=0;$i&lt;@dirs;$i++)
 			if (! $printspool &amp;&amp; ! $mimeboxspool &amp;&amp; ! $useplasmoid )
 			{
 
-				my $fname=&quot;$ENV{'HOME'}/Desktop&quot;;
+				my $fname;
+				if ( $ENV{'XDG_DESKTOP_DIR'} )
+				{
+					$fname=&quot;$ENV{'XDG_DESKTOP_DIR'}&quot;;
+				} else {
+					$fname=&quot;$ENV{'HOME'}/Desktop&quot;;
+				}
 				my $current_desktop = &quot;NONE&quot;;
 				if (($session =~ m/_stDGNOME_dp/) &amp;&amp; system(&quot;x2gofeature X2GO_GNOMEBINDINGS &gt;/dev/null&quot;) == 0)
 				{
diff --git a/x2goserver/bin/x2goruncommand b/x2goserver/bin/x2goruncommand
index d783a3a..d26fa82 100755
--- a/x2goserver/bin/x2goruncommand
+++ b/x2goserver/bin/x2goruncommand
@@ -119,10 +119,6 @@ elif ([ &quot;$cmd&quot; == &quot;UNITY&quot; ] || [ &quot;$cmd&quot; == &quot;unity&quot; ]); then
 
 elif [ &quot;$cmd&quot; == &quot;KDE&quot; ]; then
 	cmd=&quot;/usr/bin/startkde&quot;
-	NX_XRANDR_LIBS=/usr/lib/nx/X11/Xrandr
-	LD_LIBRARY_PATH=&quot;$NX_XRANDR_LIBS:$LD_LIBRARY_PATH&quot;
-	$X2GO_LIB_PATH/x2gosyslog &quot;$0&quot; &quot;debug&quot; &quot;extending LD_LIBRARY_PATH=$LD_LIBRARY_PATH by Xrandr extension&quot;
-	export LD_LIBRARY_PATH
 elif [ &quot;$cmd&quot; == &quot;XFCE4&quot; ]; then
 	cmd=&quot;/usr/bin/xfce4-session&quot;
 elif [ &quot;$cmd&quot; == &quot;LXDE&quot; ]; then
@@ -207,6 +203,14 @@ then
 	X2GO_SESS_TYPE=&quot;R&quot;
 fi
 
+if [ &quot;$cmd&quot; == &quot;startkde&quot; ]; then
+	NX_XRANDR_LIBS=/usr/lib/nx/X11/Xrandr
+	LD_LIBRARY_PATH=&quot;$NX_XRANDR_LIBS:$LD_LIBRARY_PATH&quot;
+	$X2GO_LIB_PATH/x2gosyslog &quot;$0&quot; &quot;debug&quot; &quot;extending LD_LIBRARY_PATH=$LD_LIBRARY_PATH by Xrandr extension&quot;
+	export LD_LIBRARY_PATH
+fi
+
+
 # run x2goserver-extensions for pre-runcommand
 x2gofeature X2GO_RUN_EXTENSIONS &amp;&gt;/dev/null &amp;&amp; x2goserver-run-extensions &quot;$X2GO_SESSION&quot; pre-runcommand || true
 
diff --git a/x2goserver/bin/x2goumount-session b/x2goserver/bin/x2goumount-session
index 01d3857..ca52174 100755
--- a/x2goserver/bin/x2goumount-session
+++ b/x2goserver/bin/x2goumount-session
@@ -23,6 +23,7 @@
 use strict;
 use Sys::Hostname;
 use Sys::Syslog qw( :standard :macros );
+use File::BaseDir qw( xdg_config_home );
 
 use lib `echo -n \$(x2gobasepath)/lib/x2go`;
 use x2godbwrapper; 
@@ -34,6 +35,29 @@ setlogmask( LOG_UPTO(x2gologlevel()) );
 
 syslog('info', &quot;x2goumount-session has been called with options: @ARGV&quot;);
 
+# this function is a code duplication from x2gomountdirs and it will go away with
+# X2Go Server 3.2.0.0 (as the code has been moved into X2Go::Utils already in Vcs).
+sub source_environment {
+    my $name = shift;
+
+    open my $fh, &quot;&lt;&quot;, $name
+        or die &quot;could not open $name: $!&quot;;
+
+    while (&lt;$fh&gt;) {
+        chomp;
+        my $line = $_;
+        if ( $line =~ m/^#.*/ )
+        {
+            next;
+        }
+        my ($k, $v) = split /=/, $line, 2;
+        $v =~ s/^(['&quot;])(.*)\1/$2/; #' fix highlighter
+        $v =~ s/\$([a-zA-Z]\w*)/$ENV{$1}/g;
+        $v =~ s/`(.*?)`/`$1`/ge; #dangerous
+        $ENV{$k} = $v;
+    }
+}
+
 my $tmp_dir = '/tmp';
 
 my $session=shift;
@@ -45,6 +69,8 @@ my $mdir=&quot;$tmp_dir/.x2go-$ENV{'USER'}/media&quot;;
 my $spooldir=&quot;$tmp_dir/.x2go-$ENV{'USER'}/spool&quot;;
 my $mimeboxdir=&quot;$tmp_dir/.x2go-$ENV{'USER'}/mimebox&quot;;
 
+source_environment(xdg_config_home() . &quot;/user-dirs.dirs&quot;);
+
 if ($only_path)
 {
 	$only_path=~s/\/ramdrive\/mnt\///;
@@ -156,7 +182,14 @@ break:
 		$remote=~s/ /_/g;
 		$remote=~s/\\040/_/g;
 		$remote=(split(&quot;:&quot;,&quot;$remote&quot;))[1];
-		$remote=&quot;$ENV{'HOME'}/Desktop/$remote&quot;;
+		my $desktopdir;
+		if ( $ENV{'XDG_DESKTOP_DIR'} )
+		{
+			$desktopdir=&quot;$ENV{'XDG_DESKTOP_DIR'}&quot;;
+		} else {
+			$desktopdir=&quot;$ENV{'HOME'}/Desktop&quot;;
+		}
+		$remote=&quot;$desktopdir/$remote&quot;;
 
 		my $current_desktop = 'NONE';
 		if (($session =~ m/_stDGNOME_dp/) &amp;&amp; system(&quot;x2gofeature X2GO_GNOMEBINDINGS &gt;/dev/null&quot;) == 0)
diff --git a/x2goserver/lib/x2gogetagent b/x2goserver/lib/x2gogetagent
index 7462550..897d75e 100755
--- a/x2goserver/lib/x2gogetagent
+++ b/x2goserver/lib/x2gogetagent
@@ -31,8 +31,8 @@ openlog($0,'cons,pid','user');
 setlogmask( LOG_UPTO(x2gologlevel()) );
 
 my $sid=shift or die;
-my $agent = db_getagent $sid;
+my $agent = db_getagent($sid);
 print $agent;
 
 # closing syslog 
-closelog;
\ No newline at end of file
+closelog;
diff --git a/x2goserver/sbin/x2gocleansessions b/x2goserver/sbin/x2gocleansessions
index aaed31d..8d52d85 100755
--- a/x2goserver/sbin/x2gocleansessions
+++ b/x2goserver/sbin/x2gocleansessions
@@ -90,6 +90,7 @@ elsif ($pid == 0 )
 	for (glob &quot;/proc/$$/fd/*&quot;) { POSIX::close($1) if m{/(\d+)$}; }
 
 	$SIG{TERM}=\&amp;catch_term;
+	$SIG{CHLD} = sub { wait };
 
 	while(sleep 5)
 	{


hooks/post-receive
-- 
x2goserver.git (X2Go Server)

This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;x2goserver.git&quot; (X2Go Server).

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003486.html">[X2go-Commits] x2goclient.git - master (branch) updated:	3.99.3.0-1-g5c545c9
</A></li>
	<LI>Next message: <A HREF="003488.html">[X2go-Commits] x2goserver.git - master (branch) updated:	3.1.1.3-84-g9abab8a
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3487">[ date ]</a>
              <a href="thread.html#3487">[ thread ]</a>
              <a href="subject.html#3487">[ subject ]</a>
              <a href="author.html#3487">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/x2go-commits">More information about the X2go-commits
mailing list</a><br>
</body></html>
