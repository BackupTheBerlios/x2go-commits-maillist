<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [X2Go-Commits] nx-libs.git - build-baikal (branch) updated:	redist-client/3.5.0.18-5-ge77bf36
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/x2go-commits/2013-March/index.html" >
   <LINK REL="made" HREF="mailto:x2go-commits%40lists.berlios.de?Subject=Re%3A%20%5BX2Go-Commits%5D%20nx-libs.git%20-%20build-baikal%20%28branch%29%20updated%3A%0A%09redist-client/3.5.0.18-5-ge77bf36&In-Reply-To=%3C20130328075723.4D9E75DB20%40ymir%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005217.html">
   <LINK REL="Next"  HREF="005219.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[X2Go-Commits] nx-libs.git - build-baikal (branch) updated:	redist-client/3.5.0.18-5-ge77bf36</H1>
    <B>X2Go dev team</B> 
    <A HREF="mailto:x2go-commits%40lists.berlios.de?Subject=Re%3A%20%5BX2Go-Commits%5D%20nx-libs.git%20-%20build-baikal%20%28branch%29%20updated%3A%0A%09redist-client/3.5.0.18-5-ge77bf36&In-Reply-To=%3C20130328075723.4D9E75DB20%40ymir%3E"
       TITLE="[X2Go-Commits] nx-libs.git - build-baikal (branch) updated:	redist-client/3.5.0.18-5-ge77bf36">git-admin at x2go.org
       </A><BR>
    <I>Thu Mar 28 08:57:22 CET 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="005217.html">[X2Go-Commits] nx-libs.git - master (branch) updated:	redist-client/3.5.0.18-5-ge77bf36
</A></li>
        <LI>Next message: <A HREF="005219.html">[X2Go-Commits] nx-libs.git - build-main (branch) updated:	redist-client/3.5.0.18-7-g436d067
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5218">[ date ]</a>
              <a href="thread.html#5218">[ thread ]</a>
              <a href="subject.html#5218">[ subject ]</a>
              <a href="author.html#5218">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch, build-baikal has been updated
       via  e77bf36d9afbc7e56522574b06217d57c11dd095 (commit)
       via  d16188f08b659a6dc2a150d84c5ed5d7bf5cf02b (commit)
       via  478015eb1d1f076baee0e3ff403888716b97338b (commit)
       via  a40d4b7b1a7f2d34efe3682c3ad362f276672245 (commit)
       via  1af59b317d4e4120d6aa82dabe401a1f78a95168 (commit)
      from  1b4092e0f1c9760e4d34e9fed7ce3a559c327417 (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
-----------------------------------------------------------------------

Summary of changes:
 debian/Makefile.replace.sh                         |   24 +
 debian/VERSION.x2goagent                           |    2 +-
 debian/changelog                                   |    8 +
 debian/rules                                       |    3 +-
 nx-X11/Makefile                                    |   70 +-
 nx-X11/config/cf/Imake.rules                       |   12 +-
 nx-X11/config/cf/Imake.tmpl                        |    6 +-
 nx-X11/config/cf/Motif.tmpl                        |    4 +-
 nx-X11/config/cf/X11.rules                         |   16 +-
 nx-X11/config/cf/X11.tmpl                          |  246 +-
 nx-X11/config/cf/bsdLib.rules                      |    6 +-
 nx-X11/config/cf/bsdLib.tmpl                       |    2 +-
 nx-X11/config/cf/bsdiLib.tmpl                      |    2 +-
 nx-X11/config/cf/convex.cf                         |    6 +-
 nx-X11/config/cf/cygwin.tmpl                       |    2 +-
 nx-X11/config/cf/darwinLib.tmpl                    |    2 +-
 nx-X11/config/cf/gnuLib.tmpl                       |    2 +-
 nx-X11/config/cf/host.def                          |   13 +-
 nx-X11/config/cf/ibmLib.rules                      |   12 +-
 nx-X11/config/cf/ibmLib.tmpl                       |    2 +-
 nx-X11/config/cf/linux.cf                          |    2 +-
 nx-X11/config/cf/lnxLib.rules                      |   16 +-
 nx-X11/config/cf/lnxLib.tmpl                       |    4 +-
 nx-X11/config/cf/mingw.tmpl                        |    2 +-
 nx-X11/config/cf/nto.rules                         |    2 +-
 nx-X11/config/cf/os2Lib.tmpl                       |   58 +-
 nx-X11/config/cf/sco5.cf                           |    2 +-
 nx-X11/config/cf/site.def                          |    4 +-
 nx-X11/config/cf/sv3Lib.tmpl                       |   24 +-
 nx-X11/config/cf/sv4Lib.tmpl                       |    2 +-
 nx-X11/config/cf/usl.cf                            |    2 +-
 nx-X11/config/imake/Makefile.ini                   |    1 -
 nx-X11/extras/Mesa/Makefile                        |    2 +-
 nx-X11/extras/Mesa/src/mesa/main/Imakefile         |    2 +-
 nx-X11/extras/Xpm/Makefile.noX                     |    1 -
 nx-X11/extras/Xpm/lib/Imakefile                    |    2 +-
 nx-X11/extras/drm/libdrm.pc.in                     |    2 +-
 nx-X11/extras/drm/linux-core/Makefile              |    4 +-
 nx-X11/extras/drm/linux/Makefile                   |    4 +-
 nx-X11/extras/expat/conftools/config.guess         | 1034 +-
 nx-X11/extras/expat/conftools/config.sub           |  553 +-
 nx-X11/extras/expat/conftools/ltmain.sh            |13302 +++++++++++++-------
 nx-X11/extras/fontconfig/config.guess              |  801 +-
 nx-X11/extras/fontconfig/config.sub                |  270 +-
 nx-X11/extras/fontconfig/fontconfig.pc.in          |    2 +-
 nx-X11/extras/freetype2/builds/unix/config.guess   |  845 +-
 nx-X11/extras/freetype2/builds/unix/config.sub     |  307 +-
 .../extras/ogl-sample/main/gfx/lib/glu/Imakefile   |    2 +-
 nx-X11/extras/ttf2pt1/Makefile                     |    4 +-
 nx-X11/lib/FS/Imakefile                            |    2 +-
 nx-X11/lib/GLw/Imakefile                           |    2 +-
 nx-X11/lib/ICE/Imakefile                           |    2 +-
 nx-X11/lib/SM/Imakefile                            |    2 +-
 nx-X11/lib/X11/Imakefile                           |   37 +-
 nx-X11/lib/X11/Imakefile.NX.original               |   14 +-
 nx-X11/lib/X11/Imakefile.X.original                |    2 +-
 nx-X11/lib/XRes/Imakefile                          |    2 +-
 nx-X11/lib/XTrap/Imakefile                         |    2 +-
 nx-X11/lib/Xau/Imakefile                           |    2 +-
 nx-X11/lib/Xaw/Imakefile                           |    2 +-
 nx-X11/lib/Xaw6/Imakefile                          |    2 +-
 nx-X11/lib/Xaw7/Imakefile                          |    2 +-
 nx-X11/lib/Xcomposite/Imakefile                    |    2 +-
 nx-X11/lib/Xcomposite/xcomposite.pc.in             |    2 +-
 nx-X11/lib/Xcursor/Imakefile                       |    2 +-
 nx-X11/lib/Xcursor/xcursor.pc.in                   |    2 +-
 nx-X11/lib/Xdamage/Imakefile                       |    2 +-
 nx-X11/lib/Xdamage/xdamage.pc.in                   |    2 +-
 nx-X11/lib/Xdmcp/Imakefile                         |    2 +-
 nx-X11/lib/Xevie/Imakefile                         |    2 +-
 nx-X11/lib/Xevie/xevie.pc.in                       |    2 +-
 nx-X11/lib/Xext/Imakefile                          |    2 +-
 nx-X11/lib/Xfixes/Imakefile                        |    2 +-
 nx-X11/lib/Xfixes/xfixes.pc.in                     |    2 +-
 nx-X11/lib/Xfontcache/Imakefile                    |    2 +-
 nx-X11/lib/Xft/Imakefile                           |    2 +-
 nx-X11/lib/Xft/config.guess                        |  856 +-
 nx-X11/lib/Xft/config.sub                          |  377 +-
 nx-X11/lib/Xft/xft.pc.in                           |    2 +-
 nx-X11/lib/Xft1/Imakefile                          |    2 +-
 nx-X11/lib/Xi/Imakefile                            |    2 +-
 nx-X11/lib/Xinerama/Imakefile                      |    2 +-
 nx-X11/lib/Xinerama/Xinerama.c                     |   98 +-
 nx-X11/lib/Xmu/Imakefile                           |    2 +-
 nx-X11/lib/Xmuu/Imakefile                          |    2 +-
 nx-X11/lib/Xp/Imakefile                            |    2 +-
 nx-X11/lib/Xpm/Imakefile                           |    2 +-
 nx-X11/lib/Xpm/Imakefile.NX.original               |    2 +-
 nx-X11/lib/Xpm/Imakefile.X.original                |    2 +-
 nx-X11/lib/XprintAppUtil/Imakefile                 |    2 +-
 nx-X11/lib/XprintUtil/Imakefile                    |    2 +-
 nx-X11/lib/Xrandr/Imakefile                        |    2 +-
 nx-X11/lib/Xrender/Imakefile                       |    2 +-
 nx-X11/lib/Xrender/xrender.pc.in                   |    2 +-
 nx-X11/lib/Xss/Imakefile                           |    2 +-
 nx-X11/lib/Xt/Imakefile                            |    2 +-
 nx-X11/lib/Xt/Imakefile.NX.original                |    2 +-
 nx-X11/lib/Xt/Imakefile.X.original                 |    2 +-
 nx-X11/lib/Xtst/Imakefile                          |    2 +-
 nx-X11/lib/Xv/Imakefile                            |    2 +-
 nx-X11/lib/XvMC/Imakefile                          |    2 +-
 nx-X11/lib/XvMC/hw/i810/Imakefile                  |    2 +-
 nx-X11/lib/XvMC/hw/via/unichrome/Imakefile         |    2 +-
 nx-X11/lib/XvMC/hw/via/unichromeProA/Imakefile     |    2 +-
 nx-X11/lib/XvMC/wrapper/Imakefile                  |    2 +-
 nx-X11/lib/Xxf86dga/Imakefile                      |    2 +-
 nx-X11/lib/Xxf86misc/Imakefile                     |    2 +-
 nx-X11/lib/Xxf86rush/Imakefile                     |    2 +-
 nx-X11/lib/Xxf86vm/Imakefile                       |    2 +-
 nx-X11/lib/apple/Imakefile                         |    2 +-
 nx-X11/lib/dmx/Imakefile                           |    2 +-
 nx-X11/lib/dps/Imakefile                           |    2 +-
 nx-X11/lib/dpstk/Imakefile                         |    2 +-
 nx-X11/lib/expat/Imakefile                         |   14 +-
 nx-X11/lib/font/Imakefile                          |    2 +-
 nx-X11/lib/fontconfig/Imakefile                    |    2 +-
 nx-X11/lib/fontenc/Imakefile                       |    2 +-
 nx-X11/lib/freetype2/Imakefile                     |    2 +-
 nx-X11/lib/oldX/Imakefile                          |    2 +-
 nx-X11/lib/psres/Imakefile                         |    2 +-
 nx-X11/lib/regex/Imakefile                         |    2 +-
 nx-X11/lib/windows/Imakefile                       |    2 +-
 nx-X11/lib/xkbfile/Imakefile                       |    2 +-
 nx-X11/lib/xkbui/Imakefile                         |    2 +-
 nx-X11/lib/zlib/Imakefile                          |    2 +-
 nx-X11/programs/Xserver/Imakefile                  |   29 +-
 nx-X11/programs/Xserver/Xext/panoramiX.c           |    9 -
 nx-X11/programs/Xserver/Xext/panoramiX.h           |    2 +-
 nx-X11/programs/Xserver/Xext/security.c            |    2 +-
 nx-X11/programs/Xserver/hw/nxagent/Args.c          |   23 +
 nx-X11/programs/Xserver/hw/nxagent/Args.h          |    2 +
 nx-X11/programs/Xserver/hw/nxagent/Clipboard.c     |   29 +-
 nx-X11/programs/Xserver/hw/nxagent/Display.c       |   64 +-
 nx-X11/programs/Xserver/hw/nxagent/Error.c         |    2 +-
 nx-X11/programs/Xserver/hw/nxagent/Error.h         |    2 +
 nx-X11/programs/Xserver/hw/nxagent/Handlers.c      |    2 +-
 nx-X11/programs/Xserver/hw/nxagent/Icons.h         |    2 +
 nx-X11/programs/Xserver/hw/nxagent/Image.c         |    7 +
 nx-X11/programs/Xserver/hw/nxagent/Imakefile       |   11 +-
 nx-X11/programs/Xserver/hw/nxagent/Init.c          |   28 +
 nx-X11/programs/Xserver/hw/nxagent/Init.h          |    2 +
 nx-X11/programs/Xserver/hw/nxagent/Keyboard.c      |   46 +-
 nx-X11/programs/Xserver/hw/nxagent/Keystroke.c     |  699 +-
 nx-X11/programs/Xserver/hw/nxagent/Keystroke.h     |   47 +
 nx-X11/programs/Xserver/hw/nxagent/NXdispatch.c    |   17 +
 nx-X11/programs/Xserver/hw/nxagent/Options.c       |    1 +
 nx-X11/programs/Xserver/hw/nxagent/Options.h       |    7 +
 nx-X11/programs/Xserver/hw/nxagent/Render.c        |   16 +-
 nx-X11/programs/Xserver/hw/nxagent/Screen.c        |   36 +
 nx-X11/programs/Xserver/hw/nxagent/Splash.c        |  162 +-
 nx-X11/programs/Xserver/hw/nxagent/Splash.h        |    1 +
 nx-X11/programs/Xserver/hw/nxagent/Window.c        |   30 +
 nx-X11/programs/Xserver/hw/nxagent/X/NXpicture.c   |    4 +
 .../programs/Xserver/hw/nxagent/X/NXpicturestr.h   |    1 +
 nx-X11/programs/Xserver/hw/nxagent/X/NXxvdisp.c    |   30 +-
 .../programs/Xserver/hw/xfree86/parser/Imakefile   |    2 +-
 nx-X11/programs/Xserver/os/oscolor.c               |    2 +-
 nx-X11/programs/nxauth/Imakefile                   |    2 +-
 nx-X11/programs/nxauth/nxauth.man                  |   42 +-
 nx-X11/programs/xterm/config.guess                 |  347 +-
 nx-X11/programs/xterm/config.sub                   |  255 +-
 nxcomp/Agent.h                                     |   28 +-
 nxcomp/Auth.cpp                                    |   17 +-
 nxcomp/Loop.cpp                                    |   64 +-
 nxcomp/Makefile.in                                 |   41 +-
 nxcomp/Message.cpp                                 |    4 +-
 nxcomp/Misc.cpp                                    |   18 +-
 nxcomp/Misc.h                                      |   12 +-
 nxcomp/Pgn.cpp                                     |    6 +-
 nxcomp/Proxy.cpp                                   |    4 +-
 nxcomp/Split.cpp                                   |    2 +-
 nxcomp/configure.in                                |    4 +-
 nxcompext/Makefile.in                              |   37 +-
 nxcompext/configure.in                             |    4 +-
 nxcompshad/Logger.h                                |    4 +-
 nxcompshad/Makefile.in                             |   45 +-
 nxcompshad/Misc.h                                  |    4 +-
 nxcompshad/configure.in                            |    6 +-
 nxproxy/Makefile.in                                |   21 +-
 nxproxy/configure.in                               |    4 +-
 180 files changed, 14114 insertions(+), 7406 deletions(-)

The diff of changes is:
diff --git a/debian/Makefile.replace.sh b/debian/Makefile.replace.sh
index d47d92b..83d6b5b 100644
--- a/debian/Makefile.replace.sh
+++ b/debian/Makefile.replace.sh
@@ -1,5 +1,29 @@
 # from <A HREF="http://mywiki.wooledge.org/BashFAQ/021">http://mywiki.wooledge.org/BashFAQ/021</A>
 
+# The ${a/b/c} substitution is not POSIX compatible. Additionally, in
+# bash 3.x, quotes do not escape slashes. This causes screwed up
+# installation paths.
+#
+#     SLES 11, bash-3.2-147.9.13
+#     $ dirname=&quot;foo/bar&quot;
+#     $ echo ${dirname//&quot;foo/bar&quot;/&quot;omg/nei&quot;}
+#     bar/omg/nei/bar
+#
+#     openSUSE 12.2, bash-4.2-51.6.1
+#     $ dirname=&quot;foo/bar&quot;
+#     $ echo ${dirname//&quot;foo/bar&quot;/&quot;omg/nei&quot;}
+#     omg/nei
+#
+#     openSUSE 12.2, dash-0.5.7-5.1.2.x86_64
+#     $ dirname=&quot;foo/bar&quot;
+#     $ echo ${dirname//&quot;foo/bar&quot;/&quot;omg/nei&quot;}
+#     dash: 2: Bad substitution
+#
+# Source this file into your bash scripts to make available
+# a replacement (the string_rep function) for this substitution
+# mess.
+#
+
 string_rep()
 {
 	# initialize vars
diff --git a/debian/VERSION.x2goagent b/debian/VERSION.x2goagent
index ce56e1c..46c6c4a 100644
--- a/debian/VERSION.x2goagent
+++ b/debian/VERSION.x2goagent
@@ -1 +1 @@
-3.5.0.18
+3.5.0.19
diff --git a/debian/changelog b/debian/changelog
index d8f4382..a99a722 100644
--- a/debian/changelog
+++ b/debian/changelog
@@ -1,3 +1,11 @@
+nx-libs (2:3.5.0.19-0) unstable; urgency=low
+
+  * Add Jan's reasoning for using string_rep() instead of bash based
+    string substitutions as comment to /debian/Makefile.replaces.sh.
+  * Fix FTBFS for .deb packages after including fix for #145.
+
+ -- Mike Gabriel &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">mike.gabriel at das-netzwerkteam.de</A>&gt;  Thu, 28 Mar 2013 08:55:02 +0100
+
 nx-libs (2:3.5.0.18-0) unstable; urgency=low
 
   [ Mike Gabriel ]
diff --git a/debian/rules b/debian/rules
index 6e0892d..732f2e6 100755
--- a/debian/rules
+++ b/debian/rules
@@ -20,7 +20,7 @@ override_dh_clean:
 	rm -f nx*/changelog
 	rm -f nx-X11/programs/Xserver/hw/nxagent/changelog
 	rm -f nx-X11/programs/nxauth/changelog
-	rm -Rf Makefile bin rgb VERSION.x2goagent
+	rm -Rf replace.sh Makefile bin rgb VERSION.x2goagent
 	dh_clean
 
 override_dh_auto_install:
@@ -36,6 +36,7 @@ override_dh_auto_build:
 	cp -a nx-X11/programs/nxauth/CHANGELOG nx-X11/programs/nxauth/changelog
 	cp -a nxproxy/CHANGELOG nxproxy/changelog
 	ln -s debian/Makefile.nx-libs Makefile
+	ln -s debian/Makefile.replace.sh replace.sh
 	ln -s debian/wrappers bin
 	ln -s debian/rgb
 	ln -s debian/VERSION.x2goagent
diff --git a/nx-X11/Makefile b/nx-X11/Makefile
index 3aefb79..3533c91 100644
--- a/nx-X11/Makefile
+++ b/nx-X11/Makefile
@@ -32,8 +32,8 @@ VERSSRC = $(CONFIGSRC)/util/printver.c
 VERSPROG = $(CONFIGSRC)/util/printver.exe
 
 all:
-	@$(MAKE_CMD) xmakefile-exists || $(MAKE) all-initial
-	@$(MAKE_CMD) $@
+	@${MAKE} ${MAKE_OPTS} xmakefile-exists || $(MAKE) all-initial
+	@${MAKE} ${MAKE_OPTS} $@
 
 all-initial:
 	@echo Please use make World, or on NT use nmake World.Win32.
@@ -57,8 +57,8 @@ World:
 	@date
 	@echo &quot;&quot;
 	@if [ -f xmakefile ]; then \
-	    $(MAKE_CMD) -k distclean || \
-	    $(MAKE_CMD) -k clean || \
+	    ${MAKE} ${MAKE_OPTS} -k distclean || \
+	    ${MAKE} ${MAKE_OPTS} -k clean || \
 	    $(RM) xmakefile; \
 	fi
 	@if [ ! -f $(IRULESRC)/host.def ]; then \
@@ -84,14 +84,14 @@ World:
 #	fi
 	cd $(IMAKESRC) &amp;&amp; $(MAKE) $(FLAGS) clean
 	$(MAKE) $(MFLAGS) Makefile.boot
-	$(MAKE_CMD) $(MFLAGS) version.def
+	${MAKE} ${MAKE_OPTS} $(MFLAGS) version.def
 	$(MAKE) $(MFLAGS) Makefile.boot
-	$(MAKE_CMD) $(MFLAGS) VerifyOS
-	$(MAKE_CMD) $(MFLAGS) Makefiles
-	$(MAKE_CMD) $(MFLAGS) BOOTSTRAPSUBDIRS= clean
-	$(MAKE_CMD) $(MFLAGS) includes
-	$(MAKE_CMD) $(MFLAGS) depend
-	$(MAKE_CMD) $(MFLAGS) $(WORLDOPTS) World
+	${MAKE} ${MAKE_OPTS} $(MFLAGS) VerifyOS
+	${MAKE} ${MAKE_OPTS} $(MFLAGS) Makefiles
+	${MAKE} ${MAKE_OPTS} $(MFLAGS) BOOTSTRAPSUBDIRS= clean
+	${MAKE} ${MAKE_OPTS} $(MFLAGS) includes
+	${MAKE} ${MAKE_OPTS} $(MFLAGS) depend
+	${MAKE} ${MAKE_OPTS} $(MFLAGS) $(WORLDOPTS) World
 	@echo &quot;&quot;
 	@date
 	@echo &quot;&quot;
@@ -138,6 +138,7 @@ Makefile::
 
 xmakefile: Imakefile
 	$(RM) xmakefile
+	@rm -f $(IRULESRC)/date.def; echo &quot;&quot; &gt; $(IRULESRC)/date.def;
 	$(IMAKE_CMD) -s xmakefile -DTOPDIR=$(TOP) -DCURDIR=$(CURRENT_DIR)
 
 World.Win32:
@@ -153,15 +154,15 @@ World.Win32:
 	-if exist xmakefile.bak del xmakefile.bak
 	-if exist xmakefile ren xmakefile xmakefile.bak
 	$(IMAKE:/=\) -s xmakefile -I$(IRULESRC) $(IMAKE_DEFINES) -DTOPDIR=$(TOP) -DCURDIR=$(CURRENT_DIR)
-	$(MAKE_CMD) $(MFLAGS) VerifyOS
-	$(MAKE_CMD) $(MFLAGS) Makefiles
-	$(MAKE_CMD) $(MFLAGS) clean
+	${MAKE} ${MAKE_OPTS} $(MFLAGS) VerifyOS
+	${MAKE} ${MAKE_OPTS} $(MFLAGS) Makefiles
+	${MAKE} ${MAKE_OPTS} $(MFLAGS) clean
 	cd $(CONFIGSRC)\util
 	$(MAKE) mkdirhier.exe
 	cd ..\..
-	$(MAKE_CMD) $(MFLAGS) includes
-	$(MAKE_CMD) $(MFLAGS) depend
-	$(MAKE_CMD) $(MFLAGS) $(WIN32WORLDOPTS)
+	${MAKE} ${MAKE_OPTS} $(MFLAGS) includes
+	${MAKE} ${MAKE_OPTS} $(MFLAGS) depend
+	${MAKE} ${MAKE_OPTS} $(MFLAGS) $(WIN32WORLDOPTS)
 	@echo :
 	@echo :
 	@echo Full build of $(RELEASE) complete.
@@ -197,33 +198,38 @@ World.OS2:
 # a copy of every rule that might be invoked at top level
 
 clean:
-	    $(MAKE_CMD) $@
+	    -${MAKE_CMD} ${MAKE_OPTS} $@
+	    find config -type f | egrep '.*/Makefile$$' | while read makefile; do rm -f $$makefile; done
+	    find lib -type f | egrep '.*/Makefile$$' | while read makefile; do rm -f $$makefile; done
+	    find programs -type f | egrep '.*/Makefile$$' | while read makefile; do rm -f $$makefile; done
+	    find include -type f | egrep '.*/Makefile$$' | while read makefile; do rm -f $$makefile; done
+	    rm -f config/cf/{version.def,date.def}
 dangerous_strip_clean:
-	    $(MAKE_CMD) $@
+	    ${MAKE} ${MAKE_OPTS} $@
 distclean:
-	    $(MAKE_CMD) $@
+	    -${MAKE} ${MAKE_OPTS} $@
 	    $(RM) xmakefile $(IRULESRC)/version.def $(IRULESRC)/date.def
 depend:
-	    $(MAKE_CMD) $@
+	    ${MAKE} ${MAKE_OPTS} $@
 Everything:
-	    $(MAKE_CMD) $@
+	    ${MAKE} ${MAKE_OPTS} $@
 external.ln:
-	    $(MAKE_CMD) $@
+	    ${MAKE} ${MAKE_OPTS} $@
 includes:
-	    $(MAKE_CMD) $@
+	    ${MAKE} ${MAKE_OPTS} $@
 install.sdk:
-	    $(MAKE_CMD) $@
+	    ${MAKE} ${MAKE_OPTS} $@
 install.ln:
-	    $(MAKE_CMD) $@
+	    ${MAKE} ${MAKE_OPTS} $@
 install.man:
-	    $(MAKE_CMD) $@
+	    ${MAKE} ${MAKE_OPTS} $@
 install:
-	    $(MAKE_CMD) $@
+	    ${MAKE} ${MAKE_OPTS} $@
 Makefiles:
-	    $(MAKE_CMD) $@
+	    ${MAKE} ${MAKE_OPTS} $@
 man_keywords:
-	    $(MAKE_CMD) $@
+	    ${MAKE} ${MAKE_OPTS} $@
 tags:
-	    $(MAKE_CMD) $@
+	    ${MAKE} ${MAKE_OPTS} $@
 VerifyOS:
-	    $(MAKE_CMD) $@
+	    ${MAKE} ${MAKE_OPTS} $@
diff --git a/nx-X11/config/cf/Imake.rules b/nx-X11/config/cf/Imake.rules
index 21c223d..3923e4a 100644
--- a/nx-X11/config/cf/Imake.rules
+++ b/nx-X11/config/cf/Imake.rules
@@ -2124,9 +2124,9 @@ LintLibReferences(varname,libname,libsource)
  */
 #ifndef ProjectUnsharedFontLibReferences
 #define ProjectUnsharedFontLibReferences()					@@\
-DEPFONTLIB = _UseCat($(USRLIBDIR)/,XBuildLibDir/,LibraryTargetName(Xfont))	@@\
-FONTLIB = -L$(FREETYPELIBDIR) -L$(FONTLIBSRC) LoaderLibPrefix -lXfont		@@\
-LintLibReferences(XFONT,Xfont,$(FONTLIBSRC))
+DEPFONTLIB = _UseCat($(USRLIBDIR)/,XBuildLibDir/,LibraryTargetName(NX_Xfont))	@@\
+FONTLIB = -L$(FREETYPELIBDIR) -L$(FONTLIBSRC) LoaderLibPrefix -lNX_Xfont		@@\
+LintLibReferences(XFONT,NX_Xfont,$(FONTLIBSRC))
 #endif
 
 /*
@@ -2142,9 +2142,9 @@ LintLibReferences(XFONT,Xfont,$(FONTLIBSRC))
 #ifndef SharedFontLibReferences
 #define SharedFontLibReferences()					@@\
 SOFONTREV = SharedFontRev						@@\
-DEPFONTLIB = SharedLibDependencies(Xfont,$(FONTLIBSRC),SOFONTREV)	@@\
-FONTLIB = -L$(FREETYPELIBDIR) -L$(FONTLIBSRC) LoaderLibPrefix -lXfont	@@\
-LintLibReferences(XFONT,Xfont,$(FONTLIBSRC))
+DEPFONTLIB = SharedLibDependencies(NX_Xfont,$(FONTLIBSRC),SOFONTREV)	@@\
+FONTLIB = -L$(FREETYPELIBDIR) -L$(FONTLIBSRC) LoaderLibPrefix -lNX_Xfont	@@\
+LintLibReferences(XFONT,NX_Xfont,$(FONTLIBSRC))
 #endif
 
 /*
diff --git a/nx-X11/config/cf/Imake.tmpl b/nx-X11/config/cf/Imake.tmpl
index 2681108..8390b61 100644
--- a/nx-X11/config/cf/Imake.tmpl
+++ b/nx-X11/config/cf/Imake.tmpl
@@ -820,12 +820,12 @@ TCLIBDIR = TclLibDir
 
 #ifndef UsrLibDir
 #ifdef ProjectRoot
-#define UsrLibDir Concat3(ProjectRoot,/,LibDirName)
+#define UsrLibDir Concat4(ProjectRoot,/,LibDirName,/nx)
 #ifndef AlternateUsrLibDir
 #define AlternateUsrLibDir YES
 #endif
 #else
-#define UsrLibDir Concat3(/usr,/,LibDirName)
+#define UsrLibDir Concat4(/usr,/,LibDirName,/nx)
 #ifndef AlternateUsrLibDir
 #define AlternateUsrLibDir NO
 #endif
@@ -863,7 +863,7 @@ TCLIBDIR = TclLibDir
 #endif
 #ifndef IncRoot
 #ifdef ProjectRoot
-#define IncRoot Concat(ProjectRoot,/include)
+#define IncRoot Concat(ProjectRoot,/include/nx)
 #ifndef AlternateIncRoot
 #define AlternateIncRoot YES
 #endif
diff --git a/nx-X11/config/cf/Motif.tmpl b/nx-X11/config/cf/Motif.tmpl
index d4b7d3a..daa1896 100644
--- a/nx-X11/config/cf/Motif.tmpl
+++ b/nx-X11/config/cf/Motif.tmpl
@@ -465,9 +465,9 @@ TOP_MOTIF_INCLUDES = -I$(MINCLUDESRC)
 #endif
 
 #if SharedLibXm
-SharedLibReferences(XM,Xm,$(MWIDGETSRC),SOXMREV,SharedXmRev)
+SharedLibReferences(XM,NX_Xm,$(MWIDGETSRC),SOXMREV,SharedXmRev)
 #else
-ProjectUnsharedLibReferences(XM,Xm,$(MWIDGETSRC),MBuildLibDir)
+ProjectUnsharedLibReferences(XM,NX_Xm,$(MWIDGETSRC),MBuildLibDir)
 #endif
 
 #if SharedLibMrm
diff --git a/nx-X11/config/cf/X11.rules b/nx-X11/config/cf/X11.rules
index 8a176c7..51ae38c 100644
--- a/nx-X11/config/cf/X11.rules
+++ b/nx-X11/config/cf/X11.rules
@@ -36,17 +36,17 @@ XCOMM $XFree86: xc/config/cf/X11.rules,v 1.6 2001/01/17 16:22:31 dawes Exp $
 #endif
 
 #if defined(X11ProjectRoot)
-# define XBinDir	$(XPROJECTROOT)/bin
+# define XBinDir	$(XPROJECTROOT)/lib/nx/bin
 #elif defined(ProjectRoot) 
-# define XBinDir	$(PROJECTROOT)/bin
+# define XBinDir	$(PROJECTROOT)/lib/nx/bin
 #else
 # define XBinDir	$(BINDIR)
 #endif
 
 #ifdef X11ProjectRoot
-# define XUsrLibDirPath	$(USRLIBDIR):$(XPROJECTROOT)/lib
+# define XUsrLibDirPath	$(USRLIBDIR)/nx:$(XPROJECTROOT)
 #else
-# define XUsrLibDirPath	$(USRLIBDIR)
+# define XUsrLibDirPath	$(USRLIBDIR)/nx
 #endif
 #ifdef UsrLibDirPath
 # undef UsrLibDirPath
@@ -60,7 +60,7 @@ XCOMM $XFree86: xc/config/cf/X11.rules,v 1.6 2001/01/17 16:22:31 dawes Exp $
 #if ImportX11
 # define XLdPreLibs	-L$(LIBSRC)
 #elif defined(UseInstalledX11) &amp;&amp; defined(X11ProjectRoot)
-# define XLdPreLibs	-L$(XPROJECTROOT)/lib
+# define XLdPreLibs	-L$(XPROJECTROOT)
 #else
 # define XLdPreLibs	/**/
 #endif
@@ -70,7 +70,7 @@ XCOMM $XFree86: xc/config/cf/X11.rules,v 1.6 2001/01/17 16:22:31 dawes Exp $
 #define LdPreLibs	LdPreLib XLdPreLibs
 
 #ifdef X11ProjectRoot
-# define XLdPostLibs	-L$(XPROJECTROOT)/lib
+# define XLdPostLibs	-L$(XPROJECTROOT)
 #else
 # define XLdPostLibs	/**/
 #endif
@@ -86,7 +86,7 @@ XCOMM $XFree86: xc/config/cf/X11.rules,v 1.6 2001/01/17 16:22:31 dawes Exp $
 #  define TopXInclude	-I$(TOP)/exports/include
 #else
 #  ifdef X11ProjectRoot
-#   define TopXInclude	-I$(XPROJECTROOT)/include
+#   define TopXInclude	-I$(XPROJECTROOT)/../../include/nx
 #  else
 #   define TopXInclude	/**/
 #  endif
@@ -98,7 +98,7 @@ XCOMM $XFree86: xc/config/cf/X11.rules,v 1.6 2001/01/17 16:22:31 dawes Exp $
 #define TopIncludes	TopInclude $(TOP_X_INCLUDES)
 
 #if UseInstalledX11 &amp;&amp; defined(X11ProjectRoot)
-# define X11BuildLibPath	$(XPROJECTROOT)/lib
+# define X11BuildLibPath	$(XPROJECTROOT)
 #elif UseInstalledX11
 # define X11BuildLibPath	$(USRLIBDIR)
 #elif ImportX11
diff --git a/nx-X11/config/cf/X11.tmpl b/nx-X11/config/cf/X11.tmpl
index 12967d1..778e309 100644
--- a/nx-X11/config/cf/X11.tmpl
+++ b/nx-X11/config/cf/X11.tmpl
@@ -456,7 +456,7 @@ XORGRELSTRING = XorgManVersionString
 #define BuildXinerama		NO
 #endif
 #ifndef BuildXineramaLibrary
-#define BuildXineramaLibrary	(BuildXinerama &amp;&amp; !BuildServersOnly)
+#define BuildXineramaLibrary	(BuildXinerama)
 #endif
 #ifndef BuildDmxDevelTools
 #define BuildDmxDevelTools	NO
@@ -1401,7 +1401,7 @@ FCHOWN_DEFINES = -DHAS_FCHOWN
 
 #ifndef BinDir
 #ifdef ProjectRoot
-#define BinDir Concat(ProjectRoot,/bin)
+#define BinDir Concat(ProjectRoot,/lib/nx/bin)
 #else
 #define BinDir /usr/bin/X11
 #endif
@@ -1461,7 +1461,7 @@ FCHOWN_DEFINES = -DHAS_FCHOWN
 #endif
 #ifndef LibDir
 # ifdef ProjectRoot
-#  define LibDir Concat(ProjectRoot,/lib/X11)
+#  define LibDir Concat(ProjectRoot,/lib/nx/X11)
 # else
 #  define LibDir /usr/lib/X11
 # endif
@@ -1835,9 +1835,9 @@ VENDORSUPPORTDEFS = VendorSupportDefines
 #ifndef SharedX11Rev
 #define SharedX11Rev 6.2
 #endif
-SharedLibReferences(XONLY,X11,$(XLIBSRC),SOXLIBREV,SharedX11Rev)
+SharedLibReferences(XONLY,NX_X11,$(XLIBSRC),SOXLIBREV,SharedX11Rev)
 #else
-ProjectUnsharedLibReferences(XONLY,X11,$(XLIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XONLY,NX_X11,$(XLIBSRC),XBuildLibDir)
 #endif
       /* Common alternate spellings */
       DEPXLIBONLY = $(DEPXONLYLIB)
@@ -2466,9 +2466,9 @@ ProjectUnsharedLibReferences(XONLY,X11,$(XLIBSRC),XBuildLibDir)
 #ifndef SharedXextRev
 #define SharedXextRev 6.4
 #endif
-SharedLibReferences(EXTENSION,Xext,$(XEXTLIBSRC),SOXEXTREV,SharedXextRev)
+SharedLibReferences(EXTENSION,NX_Xext,$(XEXTLIBSRC),SOXEXTREV,SharedXextRev)
 #else
-ProjectUnsharedLibReferences(EXTENSION,Xext,$(XEXTLIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(EXTENSION,NX_Xext,$(XEXTLIBSRC),XBuildLibDir)
 #endif
 LINTEXTENSIONLIB = $(LINTEXTENSION)
           DEPXLIB = $(DEPEXTENSIONLIB) $(DEPXONLYLIB)
@@ -2480,9 +2480,9 @@ LINTEXTENSIONLIB = $(LINTEXTENSION)
 #ifndef SharedXssRev
 #define SharedXssRev 1.0
 #endif
-SharedLibReferences(XSS,Xss,$(XSSLIBSRC),SOXSSREV,SharedXssRev)
+SharedLibReferences(XSS,NX_Xss,$(XSSLIBSRC),SOXSSREV,SharedXssRev)
 #else
-ProjectUnsharedLibReferences(XSS,Xss,$(XSSLIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XSS,NX_Xss,$(XSSLIBSRC),XBuildLibDir)
 #endif
 
     XXF86MISCLIBSRC = $(LIBSRC)/Xxf86misc
@@ -2490,9 +2490,9 @@ ProjectUnsharedLibReferences(XSS,Xss,$(XSSLIBSRC),XBuildLibDir)
 #ifndef SharedXxf86miscRev
 #define SharedXxf86miscRev 1.1
 #endif
-SharedLibReferences(XXF86MISC,Xxf86misc,$(XXF86MISCLIBSRC),SOXXF86MISCREV,SharedXxf86miscRev)
+SharedLibReferences(XXF86MISC,NX_Xxf86misc,$(XXF86MISCLIBSRC),SOXXF86MISCREV,SharedXxf86miscRev)
 #else
-ProjectUnsharedLibReferences(XXF86MISC,Xxf86misc,$(XXF86MISCLIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XXF86MISC,NX_Xxf86misc,$(XXF86MISCLIBSRC),XBuildLibDir)
 #endif
 
     XXF86VMLIBSRC = $(LIBSRC)/Xxf86vm
@@ -2500,9 +2500,9 @@ ProjectUnsharedLibReferences(XXF86MISC,Xxf86misc,$(XXF86MISCLIBSRC),XBuildLibDir
 #ifndef SharedXxf86vmRev
 #define SharedXxf86vmRev 1.0
 #endif
-SharedLibReferences(XXF86VM,Xxf86vm,$(XXF86VMLIBSRC),SOXXF86VMREV,SharedXxf86vmRev)
+SharedLibReferences(XXF86VM,NX_Xxf86vm,$(XXF86VMLIBSRC),SOXXF86VMREV,SharedXxf86vmRev)
 #else
-ProjectUnsharedLibReferences(XXF86VM,Xxf86vm,$(XXF86VMLIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XXF86VM,NX_Xxf86vm,$(XXF86VMLIBSRC),XBuildLibDir)
 #endif
 
     XXF86DGALIBSRC = $(LIBSRC)/Xxf86dga
@@ -2510,9 +2510,9 @@ ProjectUnsharedLibReferences(XXF86VM,Xxf86vm,$(XXF86VMLIBSRC),XBuildLibDir)
 #ifndef SharedXxf86dgaRev
 #define SharedXxf86dgaRev 1.0
 #endif
-SharedLibReferences(XXF86DGA,Xxf86dga,$(XXF86DGALIBSRC),SOXXF86DGAREV,SharedXxf86dgaRev)
+SharedLibReferences(XXF86DGA,NX_Xxf86dga,$(XXF86DGALIBSRC),SOXXF86DGAREV,SharedXxf86dgaRev)
 #else
-ProjectUnsharedLibReferences(XXF86DGA,Xxf86dga,$(XXF86DGALIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XXF86DGA,NX_Xxf86dga,$(XXF86DGALIBSRC),XBuildLibDir)
 #endif
 
 #if BuildDmxLibrary
@@ -2544,9 +2544,9 @@ ProjectUnsharedLibReferences(XXF86DGA,Xxf86dga,$(XXF86DGALIBSRC),XBuildLibDir)
 #ifndef SharedXxf86rushRev
 #define SharedXxf86rushRev 1.0
 #endif
-SharedLibReferences(XXF86RUSH,Xxf86rush,$(XXF86RUSHLIBSRC),SOXXF86RUSHREV,SharedXxf86rushRev)
+SharedLibReferences(XXF86RUSH,NX_Xxf86rush,$(XXF86RUSHLIBSRC),SOXXF86RUSHREV,SharedXxf86rushRev)
 #else
-ProjectUnsharedLibReferences(XXF86RUSH,Xxf86rush,$(XXF86RUSHLIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XXF86RUSH,NX_Xxf86rush,$(XXF86RUSHLIBSRC),XBuildLibDir)
 #endif
 
 
@@ -2555,9 +2555,9 @@ ProjectUnsharedLibReferences(XXF86RUSH,Xxf86rush,$(XXF86RUSHLIBSRC),XBuildLibDir
 #ifndef SharedXvRev
 #define SharedXvRev 1.0
 #endif
-SharedLibReferences(XV,Xv,$(XVLIBSRC),SOXVREV,SharedXvRev)
+SharedLibReferences(XV,NX_Xv,$(XVLIBSRC),SOXVREV,SharedXvRev)
 #else
-ProjectUnsharedLibReferences(XV,Xv,$(XVLIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XV,NX_Xv,$(XVLIBSRC),XBuildLibDir)
 #endif
 
 
@@ -2566,9 +2566,9 @@ ProjectUnsharedLibReferences(XV,Xv,$(XVLIBSRC),XBuildLibDir)
 #ifndef SharedXvMCRev
 #define SharedXvMCRev 1.0
 #endif
-SharedLibReferences(XVMC,XvMC,$(XVMCLIBSRC),SOXVMCREV,SharedXvMCRev)
+SharedLibReferences(XVMC,NX_XvMC,$(XVMCLIBSRC),SOXVMCREV,SharedXvMCRev)
 #else
-ProjectUnsharedLibReferences(XVMC,XvMC,$(XVMCLIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XVMC,NX_XvMC,$(XVMCLIBSRC),XBuildLibDir)
 #endif
 
     XINERAMALIBSRC = $(LIBSRC)/Xinerama
@@ -2576,9 +2576,9 @@ ProjectUnsharedLibReferences(XVMC,XvMC,$(XVMCLIBSRC),XBuildLibDir)
 #ifndef SharedXineramaRev
 #define SharedXineramaRev 1.0
 #endif
-SharedLibReferences(XINERAMA,Xinerama,$(XINERAMALIBSRC),SOXINERAMAREV,SharedXineramaRev)
+SharedLibReferences(XINERAMA,NX_Xinerama,$(XINERAMALIBSRC),SOXINERAMAREV,SharedXineramaRev)
 #else
-ProjectUnsharedLibReferences(XINERAMA,Xinerama,$(XINERAMALIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XINERAMA,NX_Xinerama,$(XINERAMALIBSRC),XBuildLibDir)
 #endif
 
     XRESLIBSRC = $(LIBSRC)/XRes
@@ -2586,9 +2586,9 @@ ProjectUnsharedLibReferences(XINERAMA,Xinerama,$(XINERAMALIBSRC),XBuildLibDir)
 #ifndef SharedXResRev
 #define SharedXResRev 1.0
 #endif
-SharedLibReferences(XRES,XRes,$(XRESLIBSRC),SOXRESREV,SharedXResRev)
+SharedLibReferences(XRES,NX_XRes,$(XRESLIBSRC),SOXRESREV,SharedXResRev)
 #else
-ProjectUnsharedLibReferences(XRES,XRes,$(XRESLIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XRES,NX_XRes,$(XRESLIBSRC),XBuildLibDir)
 #endif
 
     DMXLIBSRC = $(LIBSRC)/dmx
@@ -2596,9 +2596,9 @@ ProjectUnsharedLibReferences(XRES,XRes,$(XRESLIBSRC),XBuildLibDir)
 #ifndef SharedDmxRev
 #define SharedDmxRev 1.0
 #endif
-SharedLibReferences(DMX,dmx,$(DMXLIBSRC),SODMXREV,SharedDmxRev)
+SharedLibReferences(DMX,NX_dmx,$(DMXLIBSRC),SODMXREV,SharedDmxRev)
 #else
-ProjectUnsharedLibReferences(DMX,dmx,$(DMXLIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(DMX,NX_dmx,$(DMXLIBSRC),XBuildLibDir)
 #endif
 
     DPSLIBSRC = $(LIBSRC)/dps
@@ -2606,9 +2606,9 @@ ProjectUnsharedLibReferences(DMX,dmx,$(DMXLIBSRC),XBuildLibDir)
 #ifndef SharedDpsRev
 #define SharedDpsRev 1.0
 #endif
-SharedLibReferences(DPS,dps,$(DPSLIBSRC),SODPSREV,SharedDpsRev)
+SharedLibReferences(DPS,NX_dps,$(DPSLIBSRC),SODPSREV,SharedDpsRev)
 #else
-ProjectUnsharedLibReferences(DPS,dps,$(DPSLIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(DPS,NX_dps,$(DPSLIBSRC),XBuildLibDir)
 #endif
 
     DPSTKLIBSRC = $(LIBSRC)/dpstk
@@ -2616,9 +2616,9 @@ ProjectUnsharedLibReferences(DPS,dps,$(DPSLIBSRC),XBuildLibDir)
 #ifndef SharedDpsTkRev
 #define SharedDpsTkRev 1.0
 #endif
-SharedLibReferences(DPSTK,dpstk,$(DPSTKLIBSRC),SODPSTKREV,SharedDpsTkRev)
+SharedLibReferences(DPSTK,NX_dpstk,$(DPSTKLIBSRC),SODPSTKREV,SharedDpsTkRev)
 #else
-ProjectUnsharedLibReferences(DPSTK,dpstk,$(DPSTKLIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(DPSTK,NX_dpstk,$(DPSTKLIBSRC),XBuildLibDir)
 #endif
 
     PSRESLIBSRC = $(LIBSRC)/psres
@@ -2626,9 +2626,9 @@ ProjectUnsharedLibReferences(DPSTK,dpstk,$(DPSTKLIBSRC),XBuildLibDir)
 #ifndef SharedPSResRev
 #define SharedPSResRev 1.0
 #endif
-SharedLibReferences(PSRES,psres,$(PSRESLIBSRC),SOPSRESREV,SharedPSResRev)
+SharedLibReferences(PSRES,NX_psres,$(PSRESLIBSRC),SOPSRESREV,SharedPSResRev)
 #else
-ProjectUnsharedLibReferences(PSRES,psres,$(PSRESLIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(PSRES,NX_psres,$(PSRESLIBSRC),XBuildLibDir)
 #endif
 
     GLULIBSRC = $(LIBSRC)/GLU
@@ -2636,9 +2636,9 @@ ProjectUnsharedLibReferences(PSRES,psres,$(PSRESLIBSRC),XBuildLibDir)
 #ifndef SharedGluRev
 #define SharedGluRev 1.3
 #endif
-SharedLibReferences(GLU,GLU,$(GLULIBSRC),SOGLUREV,SharedGluRev)
+SharedLibReferences(GLU,NX_GLU,$(GLULIBSRC),SOGLUREV,SharedGluRev)
 #else
-ProjectUnsharedLibReferences(GLU,GLU,$(GLULIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(GLU,NX_GLU,$(GLULIBSRC),XBuildLibDir)
 #endif
 
     GLXLIBSRC = $(LIBSRC)/GL
@@ -2646,18 +2646,18 @@ ProjectUnsharedLibReferences(GLU,GLU,$(GLULIBSRC),XBuildLibDir)
 #ifndef SharedGlxRev
 #define SharedGlxRev 1.2
 #endif
-SharedLibReferences(GLX,GL,$(GLXLIBSRC),SOGLREV,SharedGlxRev)
+SharedLibReferences(GLX,NX_GL,$(GLXLIBSRC),SOGLREV,SharedGlxRev)
 #else
-ProjectUnsharedLibReferences(GLX,GL,$(GLXLIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(GLX,NX_GL,$(GLXLIBSRC),XBuildLibDir)
 #endif
     GLWIDGETSRC = $(LIBSRC)/GLw
 #if SharedLibGLw
 #ifndef SharedGLwRev
 #define SharedGLwRev 1.0		/* used to name the shared library */
 #endif
-SharedDSLibReferences(GLW,GLw,$(GLWIDGETSRC),SOGLWREV,SharedGLwRev)
+SharedDSLibReferences(GLW,NX_GLw,$(GLWIDGETSRC),SOGLWREV,SharedGLwRev)
 #else
-ProjectUnsharedLibReferences(GLW,GLw,$(GLWIDGETSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(GLW,NX_GLw,$(GLWIDGETSRC),XBuildLibDir)
 #endif
 
     XRENDERLIBSRC = $(LIBSRC)/Xrender
@@ -2665,9 +2665,9 @@ ProjectUnsharedLibReferences(GLW,GLw,$(GLWIDGETSRC),XBuildLibDir)
 #ifndef SharedXrenderRev
 #define SharedXrenderRev 1.2.2
 #endif
-SharedLibReferences(XRENDER,Xrender,$(XRENDERLIBSRC),SOXRENDERREV,SharedXrenderRev)
+SharedLibReferences(XRENDER,NX_Xrender,$(XRENDERLIBSRC),SOXRENDERREV,SharedXrenderRev)
 #else
-ProjectUnsharedLibReferences(XRENDER,Xrender,$(XRENDERLIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XRENDER,NX_Xrender,$(XRENDERLIBSRC),XBuildLibDir)
 #endif
 
     XRANDRLIBSRC = $(LIBSRC)/Xrandr
@@ -2675,9 +2675,9 @@ ProjectUnsharedLibReferences(XRENDER,Xrender,$(XRENDERLIBSRC),XBuildLibDir)
 #ifndef SharedXrandrRev
 #define SharedXrandrRev 2.0
 #endif
-SharedLibReferences(XRANDR,Xrandr,$(XRANDRLIBSRC),SOXRANDRREV,SharedXrandrRev)
+SharedLibReferences(XRANDR,NX_Xrandr,$(XRANDRLIBSRC),SOXRANDRREV,SharedXrandrRev)
 #else
-ProjectUnsharedLibReferences(XRANDR,Xrandr,$(XRANDRLIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XRANDR,NX_Xrandr,$(XRANDRLIBSRC),XBuildLibDir)
 #endif
 
     XFIXESLIBSRC = $(LIBSRC)/Xfixes
@@ -2685,9 +2685,9 @@ ProjectUnsharedLibReferences(XRANDR,Xrandr,$(XRANDRLIBSRC),XBuildLibDir)
 #ifndef SharedXfixesRev
 #define SharedXfixesRev 3.0
 #endif
-SharedLibReferences(XFIXES,Xfixes,$(XFIXESLIBSRC),SOXFIXESREV,SharedXfixesRev)
+SharedLibReferences(XFIXES,NX_Xfixes,$(XFIXESLIBSRC),SOXFIXESREV,SharedXfixesRev)
 #else
-ProjectUnsharedLibReferences(XFIXES,Xfixes,$(XFIXESLIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XFIXES,NX_Xfixes,$(XFIXESLIBSRC),XBuildLibDir)
 #endif
 
    XDAMAGELIBSRC = $(LIBSRC)/Xdamage
@@ -2695,9 +2695,9 @@ ProjectUnsharedLibReferences(XFIXES,Xfixes,$(XFIXESLIBSRC),XBuildLibDir)
 #ifndef SharedXdamageRev
 #define SharedXdamageRev 1.0
 #endif
-SharedLibReferences(XDAMAGE,Xdamage,$(XDAMAGELIBSRC),SOXDAMAGEREV,SharedXdamageRev)
+SharedLibReferences(XDAMAGE,NX_Xdamage,$(XDAMAGELIBSRC),SOXDAMAGEREV,SharedXdamageRev)
 #else
-ProjectUnsharedLibReferences(XDAMAGE,Xdamage,$(XDAMAGELIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XDAMAGE,NX_Xdamage,$(XDAMAGELIBSRC),XBuildLibDir)
 #endif
 
 XCOMPOSITELIBSRC = $(LIBSRC)/Xcomposite
@@ -2705,9 +2705,9 @@ XCOMPOSITELIBSRC = $(LIBSRC)/Xcomposite
 #ifndef SharedXcompositeRev
 #define SharedXcompositeRev 1.0
 #endif
-SharedLibReferences(XCOMPOSITE,Xcomposite,$(XCOMPOSITELIBSRC),SOXCOMPOSITEREV,SharedXcompositeRev)
+SharedLibReferences(XCOMPOSITE,NX_Xcomposite,$(XCOMPOSITELIBSRC),SOXCOMPOSITEREV,SharedXcompositeRev)
 #else
-ProjectUnsharedLibReferences(XCOMPOSITE,Xcomposite,$(XCOMPOSITELIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XCOMPOSITE,NX_Xcomposite,$(XCOMPOSITELIBSRC),XBuildLibDir)
 #endif
 
 XEVIELIBSRC = $(LIBSRC)/Xevie
@@ -2715,9 +2715,9 @@ XEVIELIBSRC = $(LIBSRC)/Xevie
 #ifndef SharedXevieRev
 #define SharedXevieRev 1.0
 #endif
-SharedLibReferences(XEVIE,Xevie,$(XEVIELIBSRC),SOXEVIEREV,SharedXevieRev)
+SharedLibReferences(XEVIE,NX_Xevie,$(XEVIELIBSRC),SOXEVIEREV,SharedXevieRev)
 #else
-ProjectUnsharedLibReferences(XEVIE,Xevie,$(XEVIELIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XEVIE,NX_Xevie,$(XEVIELIBSRC),XBuildLibDir)
 #endif
 
    XCURSORLIBSRC = $(LIBSRC)/Xcursor
@@ -2725,9 +2725,9 @@ ProjectUnsharedLibReferences(XEVIE,Xevie,$(XEVIELIBSRC),XBuildLibDir)
 #ifndef SharedXcursorRev
 #define SharedXcursorRev 1.0.2
 #endif
-SharedLibReferences(XCURSOR,Xcursor,$(XCURSORLIBSRC),SOXCURSORREV,SharedXcursorRev)
+SharedLibReferences(XCURSOR,NX_Xcursor,$(XCURSORLIBSRC),SOXCURSORREV,SharedXcursorRev)
 #else
-ProjectUnsharedLibReferences(XCURSOR,Xcursor,$(XCURSORLIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XCURSOR,NX_Xcursor,$(XCURSORLIBSRC),XBuildLibDir)
 #endif
 
    APPLEWMLIBSRC = $(LIBSRC)/apple
@@ -2735,9 +2735,9 @@ ProjectUnsharedLibReferences(XCURSOR,Xcursor,$(XCURSORLIBSRC),XBuildLibDir)
 #ifndef SharedAppleWMRev
 #define SharedAppleWMRev 1.0
 #endif
-SharedLibReferences(APPLEWM,AppleWM,$(APPLEWMLIBSRC),SOAPPLEWMREV,SharedAppleWMRev)
+SharedLibReferences(APPLEWM,NX_AppleWM,$(APPLEWMLIBSRC),SOAPPLEWMREV,SharedAppleWMRev)
 #else
-ProjectUnsharedLibReferences(APPLEWM,AppleWM,$(APPLEWMLIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(APPLEWM,NX_AppleWM,$(APPLEWMLIBSRC),XBuildLibDir)
 #endif
 
    WINDOWSWMLIBSRC = $(LIBSRC)/windows
@@ -2745,9 +2745,9 @@ ProjectUnsharedLibReferences(APPLEWM,AppleWM,$(APPLEWMLIBSRC),XBuildLibDir)
 #ifndef SharedWindowsWMRev
 #define SharedWindowsWMRev 1.0
 #endif
-SharedLibReferences(WINDOWSWM,WindowsWM,$(WINDOWSWMLIBSRC),SOWINDOWSWMREV,SharedWindowsWMRev)
+SharedLibReferences(WINDOWSWM,NX_WindowsWM,$(WINDOWSWMLIBSRC),SOWINDOWSWMREV,SharedWindowsWMRev)
 #else
-ProjectUnsharedLibReferences(WINDOWSWM,WindowsWM,$(WINDOWSWMLIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(WINDOWSWM,NX_WindowsWM,$(WINDOWSWMLIBSRC),XBuildLibDir)
 #endif
 
 # ifndef SharedLibXfontcache
@@ -2768,9 +2768,9 @@ ProjectUnsharedLibReferences(WINDOWSWM,WindowsWM,$(WINDOWSWMLIBSRC),XBuildLibDir
 #ifndef SharedXfontcacheRev
 #define SharedXfontcacheRev 1.2
 #endif
-SharedLibReferences(XFONTCACHE,Xfontcache,$(XFONTCACHELIBSRC),SOXFONTCACHEREV,SharedXfontcacheRev)
+SharedLibReferences(XFONTCACHE,NX_Xfontcache,$(XFONTCACHELIBSRC),SOXFONTCACHEREV,SharedXfontcacheRev)
 #else
-ProjectUnsharedLibReferences(XFONTCACHE,Xfontcache,$(XFONTCACHELIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XFONTCACHE,NX_Xfontcache,$(XFONTCACHELIBSRC),XBuildLibDir)
 #endif
 
 #ifndef SharedLibXau
@@ -2790,12 +2790,12 @@ ProjectUnsharedLibReferences(XFONTCACHE,Xfontcache,$(XFONTCACHELIBSRC),XBuildLib
 #ifndef SharedXauRev
 #define SharedXauRev 6.0
 #endif
-SharedLibReferences(XAUTH,Xau,$(XAUTHSRC),SOXAUTHREV,SharedXauRev)
+SharedLibReferences(XAUTH,NX_Xau,$(XAUTHSRC),SOXAUTHREV,SharedXauRev)
 #else
 #if !UseInstalledXauLib
-ProjectUnsharedLibReferences(XAUTH,Xau,$(XAUTHSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XAUTH,NX_Xau,$(XAUTHSRC),XBuildLibDir)
 #else
-ProjectUnsharedLibReferences(XAUTH,Xau,$(XAUTHSRC),$(USRLIBDIR))
+ProjectUnsharedLibReferences(XAUTH,NX_Xau,$(XAUTHSRC),$(USRLIBDIR))
 #endif
 #endif
 
@@ -2816,12 +2816,12 @@ ProjectUnsharedLibReferences(XAUTH,Xau,$(XAUTHSRC),$(USRLIBDIR))
 #ifndef SharedXdmcpRev
 #define SharedXdmcpRev 6.0
 #endif
-SharedLibReferences(XDMCP,Xdmcp,$(XDMCPLIBSRC),SOXDMCPREV,SharedXdmcpRev)
+SharedLibReferences(XDMCP,NX_Xdmcp,$(XDMCPLIBSRC),SOXDMCPREV,SharedXdmcpRev)
 #else
 #if !UseInstalledXdmcpLib
-ProjectUnsharedLibReferences(XDMCP,Xdmcp,$(XDMCPLIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XDMCP,NX_Xdmcp,$(XDMCPLIBSRC),XBuildLibDir)
 #else
-ProjectUnsharedLibReferences(XDMCP,Xdmcp,$(XDMCPLIBSRC),$(USRLIBDIR))
+ProjectUnsharedLibReferences(XDMCP,NX_Xdmcp,$(XDMCPLIBSRC),$(USRLIBDIR))
 #endif
 #endif
 
@@ -2842,9 +2842,9 @@ ProjectUnsharedLibReferences(XDMCP,Xdmcp,$(XDMCPLIBSRC),$(USRLIBDIR))
 #ifndef SharedXmuRev
 #define SharedXmuRev 6.2
 #endif
-SharedDSLibReferences(XMU,Xmu,$(XMUSRC),SOXMUREV,SharedXmuRev)
+SharedDSLibReferences(XMU,NX_Xmu,$(XMUSRC),SOXMUREV,SharedXmuRev)
 #else
-ProjectUnsharedLibReferences(XMU,Xmu,$(XMUSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XMU,NX_Xmu,$(XMUSRC),XBuildLibDir)
 #endif
 
 #ifndef SharedLibXmuu
@@ -2864,9 +2864,9 @@ ProjectUnsharedLibReferences(XMU,Xmu,$(XMUSRC),XBuildLibDir)
 #ifndef SharedXmuuRev
 #define SharedXmuuRev 1.0
 #endif
-SharedLibReferences(XMUU,Xmuu,$(XMUUSRC),SOXMUUREV,SharedXmuuRev)
+SharedLibReferences(XMUU,NX_Xmuu,$(XMUUSRC),SOXMUUREV,SharedXmuuRev)
 #else
-ProjectUnsharedLibReferences(XMUU,Xmuu,$(XMUUSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XMUU,NX_Xmuu,$(XMUUSRC),XBuildLibDir)
 #endif
 
 #ifndef SharedOldX
@@ -2886,9 +2886,9 @@ ProjectUnsharedLibReferences(XMUU,Xmuu,$(XMUUSRC),XBuildLibDir)
 #ifndef SharedOldXRev
 #define SharedOldXRev 6.0
 #endif
-SharedLibReferences(OLDX,oldX,$(OLDXLIBSRC),SOOLDXREV,SharedOldXRev)
+SharedLibReferences(OLDX,NX_oldX,$(OLDXLIBSRC),SOOLDXREV,SharedOldXRev)
 #else
-ProjectUnsharedLibReferences(OLDX,oldX,$(OLDXLIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(OLDX,NX_oldX,$(OLDXLIBSRC),XBuildLibDir)
 #endif
 
 #ifndef SharedLibXp
@@ -2908,9 +2908,9 @@ ProjectUnsharedLibReferences(OLDX,oldX,$(OLDXLIBSRC),XBuildLibDir)
 #ifndef SharedXpRev
 #define SharedXpRev 6.2
 #endif
-SharedLibReferences(XP,Xp,$(XPLIBSRC),SOXPREV,SharedXpRev)
+SharedLibReferences(XP,NX_Xp,$(XPLIBSRC),SOXPREV,SharedXpRev)
 #else
-ProjectUnsharedLibReferences(XP,Xp,$(XPLIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XP,NX_Xp,$(XPLIBSRC),XBuildLibDir)
 #endif
 
 #ifndef SharedLibXt
@@ -2930,9 +2930,9 @@ ProjectUnsharedLibReferences(XP,Xp,$(XPLIBSRC),XBuildLibDir)
 #ifndef SharedXtRev
 #define SharedXtRev 6.0
 #endif
-SharedDSLibReferences(XTOOLONLY,Xt,$(TOOLKITSRC),SOXTREV,SharedXtRev)
+SharedDSLibReferences(XTOOLONLY,NX_Xt,$(TOOLKITSRC),SOXTREV,SharedXtRev)
 #else
-ProjectUnsharedLibReferences(XTOOLONLY,Xt,$(TOOLKITSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XTOOLONLY,NX_Xt,$(TOOLKITSRC),XBuildLibDir)
 #endif
       DEPXTOOLLIB = $(DEPXTOOLONLYLIB) $(DEPSMLIB) $(DEPICELIB)
          XTOOLLIB = $(XTOOLONLYLIB) $(SMLIB) $(ICELIB)
@@ -2956,9 +2956,9 @@ ProjectUnsharedLibReferences(XTOOLONLY,Xt,$(TOOLKITSRC),XBuildLibDir)
 #ifndef SharedXaRev
 #define SharedXaRev 1.0
 #endif
-SharedLibReferences(XA,Xa,$(XALIBSRC),SOXAREV,SharedXaRev)
+SharedLibReferences(XA,NX_Xa,$(XALIBSRC),SOXAREV,SharedXaRev)
 #else
-UnsharedLibReferences(XA,Xa,$(XALIBSRC))
+UnsharedLibReferences(XA,NX_Xa,$(XALIBSRC))
 #endif
 
 #ifndef BuildXaw
@@ -2985,9 +2985,9 @@ UnsharedLibReferences(XA,Xa,$(XALIBSRC))
 #ifndef SharedXawRev
 #define SharedXawRev 8.0
 #endif
-SharedDSLibReferences(XAW,Xaw,$(AWIDGETSRC),SOXAWREV,SharedXawRev)
+SharedDSLibReferences(XAW,NX_Xaw,$(AWIDGETSRC),SOXAWREV,SharedXawRev)
 #else
-ProjectUnsharedLibReferences(XAW,Xaw,$(AWIDGETSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XAW,NX_Xaw,$(AWIDGETSRC),XBuildLibDir)
 #endif
 #endif
 
@@ -3013,14 +3013,14 @@ ProjectUnsharedLibReferences(XAW,Xaw,$(AWIDGETSRC),XBuildLibDir)
 #ifndef SharedXaw7Rev
 #define SharedXaw7Rev 7.0
 #endif
-SharedDSLibReferences(XAW7,Xaw,$(AWIDGET7SRC),SOXAW7REV,SharedXaw7Rev)
+SharedDSLibReferences(XAW7,NX_Xaw,$(AWIDGET7SRC),SOXAW7REV,SharedXaw7Rev)
 #if !BuildXaw
-SharedDSLibReferences(XAW,Xaw,$(AWIDGET7SRC),SOXAWREV,SharedXawRev)
+SharedDSLibReferences(XAW,NX_Xaw,$(AWIDGET7SRC),SOXAWREV,SharedXawRev)
 #endif
 #else
-ProjectUnsharedLibReferences(XAW7,Xaw,$(AWIDGET7SRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XAW7,NX_Xaw,$(AWIDGET7SRC),XBuildLibDir)
 #if !BuildXaw
-ProjectUnsharedLibReferences(XAW,Xaw,$(AWIDGET7SRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XAW,NX_Xaw,$(AWIDGET7SRC),XBuildLibDir)
 #endif
 #endif
 #endif
@@ -3048,14 +3048,14 @@ ProjectUnsharedLibReferences(XAW,Xaw,$(AWIDGET7SRC),XBuildLibDir)
 #ifndef SharedXaw6Rev
 #define SharedXaw6Rev 6.1
 #endif
-SharedDSLibReferences(XAW6,Xaw,$(AWIDGET6SRC),SOXAW6REV,SharedXaw6Rev)
+SharedDSLibReferences(XAW6,NX_Xaw,$(AWIDGET6SRC),SOXAW6REV,SharedXaw6Rev)
 #if !BuildXaw &amp;&amp; !BuildXaw7
-SharedDSLibReferences(XAW,Xaw,$(AWIDGET6SRC),SOXAWREV,SharedXawRev)
+SharedDSLibReferences(XAW,NX_Xaw,$(AWIDGET6SRC),SOXAWREV,SharedXawRev)
 #endif
 #else
-ProjectUnsharedLibReferences(XAW6,Xaw,$(AWIDGET6SRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XAW6,NX_Xaw,$(AWIDGET6SRC),XBuildLibDir)
 #if !BuildXaw &amp;&amp; !BuildXaw7
-ProjectUnsharedLibReferences(XAW,Xaw,$(AWIDGET6SRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XAW,NX_Xaw,$(AWIDGET6SRC),XBuildLibDir)
 #endif
 #endif
 #endif
@@ -3077,9 +3077,9 @@ ProjectUnsharedLibReferences(XAW,Xaw,$(AWIDGET6SRC),XBuildLibDir)
 #ifndef SharedXiRev
 #define SharedXiRev 6.0
 #endif
-SharedLibReferences(XI,Xi,$(XILIBSRC),SOXINPUTREV,SharedXiRev)
+SharedLibReferences(XI,NX_Xi,$(XILIBSRC),SOXINPUTREV,SharedXiRev)
 #else
-ProjectUnsharedLibReferences(XI,Xi,$(XILIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XI,NX_Xi,$(XILIBSRC),XBuildLibDir)
 #endif
 
 #ifndef SharedLibXtst
@@ -3099,12 +3099,12 @@ ProjectUnsharedLibReferences(XI,Xi,$(XILIBSRC),XBuildLibDir)
 #ifndef SharedXtstRev
 #define SharedXtstRev 6.1
 #endif
-SharedLibReferences(XTEST,Xtst,$(XTESTLIBSRC),SOXTESTREV,SharedXtstRev)
+SharedLibReferences(XTEST,NX_Xtst,$(XTESTLIBSRC),SOXTESTREV,SharedXtstRev)
 #else
-ProjectUnsharedLibReferences(XTEST,Xtst,$(XTESTLIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XTEST,NX_Xtst,$(XTESTLIBSRC),XBuildLibDir)
 #endif
 
-ProjectUnsharedLibReferences(XBSD,Xbsd,$(LIBSRC)/Xbsd,XBuildLibDir)
+ProjectUnsharedLibReferences(XBSD,NX_Xbsd,$(LIBSRC)/Xbsd,XBuildLibDir)
 
 #ifndef SharedLibICE
 #define SharedLibICE HasSharedLibraries
@@ -3123,9 +3123,9 @@ ProjectUnsharedLibReferences(XBSD,Xbsd,$(LIBSRC)/Xbsd,XBuildLibDir)
 #ifndef SharedICERev
 #define SharedICERev 6.4
 #endif
-SharedLibReferences(ICE,ICE,$(ICESRC),SOICEREV,SharedICERev)
+SharedLibReferences(ICE,NX_ICE,$(ICESRC),SOICEREV,SharedICERev)
 #else
-ProjectUnsharedLibReferences(ICE,ICE,$(ICESRC),XBuildLibDir)
+ProjectUnsharedLibReferences(ICE,NX_ICE,$(ICESRC),XBuildLibDir)
 #endif
 
 #ifndef SharedLibSM
@@ -3145,9 +3145,9 @@ ProjectUnsharedLibReferences(ICE,ICE,$(ICESRC),XBuildLibDir)
 #ifndef SharedSMRev
 #define SharedSMRev 6.0
 #endif
-SharedLibReferences(SM,SM,$(SMSRC),SOSMREV,SharedSMRev)
+SharedLibReferences(SM,NX_SM,$(SMSRC),SOSMREV,SharedSMRev)
 #else
-ProjectUnsharedLibReferences(SM,SM,$(SMSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(SM,NX_SM,$(SMSRC),XBuildLibDir)
 #endif
 
 #ifndef SharedLibXkey
@@ -3167,9 +3167,9 @@ ProjectUnsharedLibReferences(SM,SM,$(SMSRC),XBuildLibDir)
 #ifndef SharedXkeyRev
 #define SharedXkeyRev 6.0
 #endif
-SharedLibReferences(XKEY,Xkey,$(XKEYSRC),SOXKEYREV,SharedXkeyRev)
+SharedLibReferences(XKEY,NX_Xkey,$(XKEYSRC),SOXKEYREV,SharedXkeyRev)
 #else
-ProjectUnsharedLibReferences(XKEY,Xkey,$(XKEYSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XKEY,NX_Xkey,$(XKEYSRC),XBuildLibDir)
 #endif
 
 #ifndef SharedLibFS
@@ -3189,9 +3189,9 @@ ProjectUnsharedLibReferences(XKEY,Xkey,$(XKEYSRC),XBuildLibDir)
 #ifndef SharedFSRev
 #define SharedFSRev 6.0
 #endif
-SharedLibReferences(FS,FS,$(FSLIBSRC),SOFSREV,SharedFSRev)
+SharedLibReferences(FS,NX_FS,$(FSLIBSRC),SOFSREV,SharedFSRev)
 #else
-ProjectUnsharedLibReferences(FS,FS,$(FSLIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(FS,NX_FS,$(FSLIBSRC),XBuildLibDir)
 #endif
 
 #ifndef SharedLibFont
@@ -3212,14 +3212,14 @@ ProjectUnsharedLibReferences(FS,FS,$(FSLIBSRC),XBuildLibDir)
 #define SharedFontRev 1.5
 #endif
 SharedFontLibReferences()
-XCOMM SharedLibReferences(XFONT,Xfont,$(FONTLIBSRC),SOFONTREV,SharedFontRev)
+XCOMM SharedLibReferences(XFONT,NX_Xfont,$(FONTLIBSRC),SOFONTREV,SharedFontRev)
 #else
 ProjectUnsharedFontLibReferences()
-XCOMM ProjectUnsharedLibReferences(XFONT,Xfont,$(FONTLIBSRC),XBuildLibDir)
+XCOMM ProjectUnsharedLibReferences(XFONT,NX_Xfont,$(FONTLIBSRC),XBuildLibDir)
 #endif
 
      FONTSTUBLIBSRC = $(FONTLIBSRC)/stubs
-ProjectUnsharedLibReferences(FONTSTUB,fntstubs,$(FONTSUBLIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(FONTSTUB,NX_fntstubs,$(FONTSUBLIBSRC),XBuildLibDir)
          DEPFONTLIB = $(DEPXFONTLIB) $(DEPFONTSTUBLIB)
             FONTLIB = $(XFONTLIB) $(FONTSTUBLIB) $(FREETYPE2LIB)
 
@@ -3241,9 +3241,9 @@ ProjectUnsharedLibReferences(FONTSTUB,fntstubs,$(FONTSUBLIBSRC),XBuildLibDir)
 #ifndef SharedFontEncRev
 #define SharedFontEncRev 1.0
 #endif
-SharedLibReferences(XFONTENC,fontenc,$(FONTENCLIBSRC),SOFONTENCREV,SharedFontEncRev)
+SharedLibReferences(XFONTENC,NX_fontenc,$(FONTENCLIBSRC),SOFONTENCREV,SharedFontEncRev)
 #else
-ProjectUnsharedLibReferences(XFONTENC,fontenc,$(FONTENCLIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XFONTENC,NX_fontenc,$(FONTENCLIBSRC),XBuildLibDir)
 #endif
 
 #ifndef SharedLibXpm
@@ -3263,9 +3263,9 @@ ProjectUnsharedLibReferences(XFONTENC,fontenc,$(FONTENCLIBSRC),XBuildLibDir)
 #ifndef SharedXpmRev
 #define SharedXpmRev 4.11
 #endif
-SharedLibReferences(XPM,Xpm,$(XPMLIBSRC),SOXPMREV,SharedXpmRev)
+SharedLibReferences(XPM,NX_Xpm,$(XPMLIBSRC),SOXPMREV,SharedXpmRev)
 #else
-ProjectUnsharedLibReferences(XPM,Xpm,$(XPMLIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XPM,NX_Xpm,$(XPMLIBSRC),XBuildLibDir)
 #endif
 
 #if UseFreetype2
@@ -3313,9 +3313,9 @@ ProjectUnsharedLibReferences(XPM,Xpm,$(XPMLIBSRC),XBuildLibDir)
 #define SharedFreetype2Rev 9.0
 #endif
 #endif
-SharedLibReferences(FREETYPE2,freetype,$(FREETYPE2LIBSRC),SOFREETYPE2REV,SharedFreetype2Rev)
+SharedLibReferences(FREETYPE2,NX_freetype,$(FREETYPE2LIBSRC),SOFREETYPE2REV,SharedFreetype2Rev)
 #else
-ProjectUnsharedLibReferences(FREETYPE2,freetype,$(FREETYPE2LIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(FREETYPE2,NX_freetype,$(FREETYPE2LIBSRC),XBuildLibDir)
 #endif
 
 #ifdef UseInstalled
@@ -3470,9 +3470,9 @@ MOTIFINCLUDES = -I$(MOTIFINCDIR)
 #define SharedExpatRev 4.0
 #endif
 #endif
-SharedLibReferences(EXPAT,expat,$(EXPATLIBSRC),SOEXPATREV,SharedExpatRev)
+SharedLibReferences(EXPAT,NX_expat,$(EXPATLIBSRC),SOEXPATREV,SharedExpatRev)
 #else
-ProjectUnsharedLibReferences(EXPAT,expat,$(EXPATLIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(EXPAT,NX_expat,$(EXPATLIBSRC),XBuildLibDir)
 #endif
 
 #if UseExpat
@@ -3552,9 +3552,9 @@ EXPATDEFINES = -DEXPAT
 #ifndef SharedXft1Rev
 #define SharedXft1Rev 1.1
 #endif
-SharedLibReferences(XFT1,Xft,$(XFT1LIBSRC),SOXFT1REV,SharedXft1Rev)
+SharedLibReferences(XFT1,NX_Xft,$(XFT1LIBSRC),SOXFT1REV,SharedXft1Rev)
 #else
-ProjectUnsharedLibReferences(XFT1,Xft,$(XFT1LIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XFT1,NX_Xft,$(XFT1LIBSRC),XBuildLibDir)
 #endif
 
 #ifndef Xft1ClientDepLibs
@@ -3589,9 +3589,9 @@ ProjectUnsharedLibReferences(XFT1,Xft,$(XFT1LIBSRC),XBuildLibDir)
 #ifndef SharedXftRev
 #define SharedXftRev 2.1.2
 #endif
-SharedLibReferences(XFT,Xft,$(XFTLIBSRC),SOXFTREV,SharedXftRev)
+SharedLibReferences(XFT,NX_Xft,$(XFTLIBSRC),SOXFTREV,SharedXftRev)
 #else
-ProjectUnsharedLibReferences(XFT,Xft,$(XFTLIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XFT,NX_Xft,$(XFTLIBSRC),XBuildLibDir)
 #endif
 
 #ifndef XftClientDepLibs
@@ -3622,9 +3622,9 @@ ProjectUnsharedLibReferences(XFT,Xft,$(XFTLIBSRC),XBuildLibDir)
 #ifndef SharedFontconfigRev
 #define SharedFontconfigRev 1.0.4
 #endif
-SharedLibReferences(FONTCONFIG,fontconfig,$(FONTCONFIGLIBSRC),SOFONTCONFIGREV,SharedFontconfigRev)
+SharedLibReferences(FONTCONFIG,NX_fontconfig,$(FONTCONFIGLIBSRC),SOFONTCONFIGREV,SharedFontconfigRev)
 #else
-ProjectUnsharedLibReferences(FONTCONFIG,fontconfig,$(FONTCONFIGLIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(FONTCONFIG,NX_fontconfig,$(FONTCONFIGLIBSRC),XBuildLibDir)
 #endif
 
 #ifdef UseInstalled
@@ -3827,9 +3827,9 @@ LIBPNGLIB = -L$(LIBPNGLIBDIR) LinkerRuntimeLibraryPathFlag($(LIBPNGLIBDIR)) -lpn
 # ifndef SharedxkbfileRev
 #  define SharedxkbfileRev	1.0
 # endif
-SharedLibReferences(XKBFILE,xkbfile,$(XKBFILESRC),SOXKBFILEREV, SharedxkbfileRev)
+SharedLibReferences(XKBFILE,NX_xkbfile,$(XKBFILESRC),SOXKBFILEREV, SharedxkbfileRev)
 #else
-ProjectUnsharedLibReferences(XKBFILE,xkbfile,$(XKBFILELIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XKBFILE,NX_xkbfile,$(XKBFILELIBSRC),XBuildLibDir)
 #endif
 
 #if BuildXKBlib
@@ -3899,9 +3899,9 @@ ProjectUnsharedLibReferences(XKBFILE,xkbfile,$(XKBFILELIBSRC),XBuildLibDir)
 # ifndef SharedxkbuiRev
 #  define SharedxkbuiRev	1.0
 # endif
-SharedLibReferences(XKBUI,xkbui,$(XKBUISRC),SOXKBUIREV, SharedxkbuiRev)
+SharedLibReferences(XKBUI,NX_xkbui,$(XKBUISRC),SOXKBUIREV, SharedxkbuiRev)
 #else
-ProjectUnsharedLibReferences(XKBUI,xkbui,$(XKBUILIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XKBUI,NX_xkbui,$(XKBUILIBSRC),XBuildLibDir)
 #endif
 
 #ifndef XkbuiLibs
@@ -3974,9 +3974,9 @@ EXTRAXAWCLIENTLIBS = ExtraXawClientLibs
 #ifndef SharedXTrapRev
 #define SharedXTrapRev 6.4
 #endif
-SharedLibReferences(XTRAP,XTrap,$(XTRAPLIBSRC),SOXTRAPREV,SharedXTrapRev)
+SharedLibReferences(XTRAP,NX_XTrap,$(XTRAPLIBSRC),SOXTRAPREV,SharedXTrapRev)
 #else
-ProjectUnsharedLibReferences(XTRAP,XTrap,$(XTRAPLIBSRC),XBuildLibDir)
+ProjectUnsharedLibReferences(XTRAP,NX_XTrap,$(XTRAPLIBSRC),XBuildLibDir)
 #endif
 
 #ifndef NeedDefaultDepLibs
diff --git a/nx-X11/config/cf/bsdLib.rules b/nx-X11/config/cf/bsdLib.rules
index b293b3f..303d579 100644
--- a/nx-X11/config/cf/bsdLib.rules
+++ b/nx-X11/config/cf/bsdLib.rules
@@ -134,9 +134,9 @@ LintLibReferences(varname,libname,libsource)
 #ifndef SharedFontLibReferences
 #define SharedFontLibReferences()					@@\
 SOFONTREV = SharedFontRev						@@\
-DEPFONTLIB = SharedLibDependencies(Xfont,$(FONTLIBSRC),SOFONTREV)	@@\
-FONTLIB = -L$(FREETYPELIBDIR) -L$(FONTLIBSRC) LoaderLibPrefix -lXfont	@@\
-LintLibReferences(XFONT,Xfont,$(FONTLIBSRC))
+DEPFONTLIB = SharedLibDependencies(NX_Xfont,$(FONTLIBSRC),SOFONTREV)	@@\
+FONTLIB = -L$(FREETYPELIBDIR) -L$(FONTLIBSRC) LoaderLibPrefix -lNX_Xfont	@@\
+LintLibReferences(XFONT,NX_Xfont,$(FONTLIBSRC))
 #endif
 
 /*
diff --git a/nx-X11/config/cf/bsdLib.tmpl b/nx-X11/config/cf/bsdLib.tmpl
index 8d55581..0c9d620 100644
--- a/nx-X11/config/cf/bsdLib.tmpl
+++ b/nx-X11/config/cf/bsdLib.tmpl
@@ -38,7 +38,7 @@ XCOMM $XFree86: xc/config/cf/bsdLib.tmpl,v 3.23 2003/11/04 01:59:31 dawes Exp $
 
 #ifndef FixupLibReferences
 #define FixupLibReferences()						@@\
-XMULIBONLY = -lXmu							@@\
+XMULIBONLY = -lNX_Xmu							@@\
 XMULIB = $(XMULIBONLY) $(XTOOLLIB) $(XLIB)
 #endif
 
diff --git a/nx-X11/config/cf/bsdiLib.tmpl b/nx-X11/config/cf/bsdiLib.tmpl
index 28087bf..c8b1e0c 100644
--- a/nx-X11/config/cf/bsdiLib.tmpl
+++ b/nx-X11/config/cf/bsdiLib.tmpl
@@ -11,7 +11,7 @@ XCOMM $XFree86: xc/config/cf/bsdiLib.tmpl,v 3.3 2003/05/29 21:56:57 herrb Exp $
 
 #ifndef FixupLibReferences
 #define FixupLibReferences()						@@\
-XMULIBONLY = -lXmu							@@\
+XMULIBONLY = -lNX_Xmu							@@\
 XMULIB = $(XMULIBONLY) $(XTOOLLIB) $(XLIB)
 #endif
 
diff --git a/nx-X11/config/cf/convex.cf b/nx-X11/config/cf/convex.cf
index 3b522f7..859d9a0 100644
--- a/nx-X11/config/cf/convex.cf
+++ b/nx-X11/config/cf/convex.cf
@@ -90,9 +90,9 @@ DEPMRESOURCELIB = _UseCat($(USRLIBDIR),$(MRESOURCESRC),/libMrm.a)
 LINTMRESOURCELIB= _UseCat($(LINTLIBDIR),$(MRESOURCESRC),/llib-lMrm.ln)
 
        XMLIBSRC = $(LIBSRC)/Xm
-       DEPXMLIB = _UseCat($(USRLIBDIR),$(XMLIBSRC),/libXm.a)
-          XMLIB = LoaderLibPrefix _Use(-lXm,$(DEPXMLIB))
-      LINTXMLIB = _UseCat($(LINTLIBDIR),$(XMLIBSRC),/llib-lXm.ln)
+       DEPXMLIB = _UseCat($(USRLIBDIR),$(XMLIBSRC),/libNX_Xm.a)
+          XMLIB = LoaderLibPrefix _Use(-lNX_Xm,$(DEPXMLIB))
+      LINTXMLIB = _UseCat($(LINTLIBDIR),$(XMLIBSRC),/llib-lNX_Xm.ln)
 
       UILLIBSRC = $(LIBSRC)/uil
       DEPUILLIB = _UseCat($(USRLIBDIR),$(UILLIBSRC),/libUil.a)
diff --git a/nx-X11/config/cf/cygwin.tmpl b/nx-X11/config/cf/cygwin.tmpl
index 404b628..9041eea 100644
--- a/nx-X11/config/cf/cygwin.tmpl
+++ b/nx-X11/config/cf/cygwin.tmpl
@@ -50,7 +50,7 @@ XCOMM $XFree86: xc/config/cf/cygwin.tmpl,v 3.18 2003/10/19 08:27:05 herrb Exp $
 
 #ifndef FixupLibReferences
 # define FixupLibReferences()						@@\
-XMULIBONLY = -lXmu							@@\
+XMULIBONLY = -lNX_Xmu							@@\
 XMULIB = $(XMULIBONLY) $(XTOOLLIB) $(XLIB)
 #endif
 
diff --git a/nx-X11/config/cf/darwinLib.tmpl b/nx-X11/config/cf/darwinLib.tmpl
index 0d3c436..4169e60 100644
--- a/nx-X11/config/cf/darwinLib.tmpl
+++ b/nx-X11/config/cf/darwinLib.tmpl
@@ -5,7 +5,7 @@ XCOMM $XFree86: xc/config/cf/darwinLib.tmpl,v 1.19 2003/11/04 00:24:36 torrey Ex
 
 #ifndef FixupLibReferences
 #define FixupLibReferences()						@@\
-XMULIBONLY = -lXmu							@@\
+XMULIBONLY = -lNX_Xmu							@@\
 XMULIB = $(XMULIBONLY) $(XTOOLLIB) $(XLIB)
 #endif
 
diff --git a/nx-X11/config/cf/gnuLib.tmpl b/nx-X11/config/cf/gnuLib.tmpl
index 012277c..2a0fcd1 100644
--- a/nx-X11/config/cf/gnuLib.tmpl
+++ b/nx-X11/config/cf/gnuLib.tmpl
@@ -6,7 +6,7 @@ XCOMM
 
 #ifndef FixupLibReferences
 #define FixupLibReferences()						@@\
-XMULIBONLY = -lXmu							@@\
+XMULIBONLY = -lNX_Xmu							@@\
 XMULIB = $(XMULIBONLY) $(XTOOLLIB) $(XLIB)
 #endif
 
diff --git a/nx-X11/config/cf/host.def b/nx-X11/config/cf/host.def
index e9f53c2..2193a47 100644
--- a/nx-X11/config/cf/host.def
+++ b/nx-X11/config/cf/host.def
@@ -138,7 +138,7 @@ XCOMM $XFree86: xc/config/cf/xf86site.def,v 3.186 2003/06/25 18:06:22 eich Exp $
 #define BuildRenderLibrary	YES
 #define SharedLibFreetype2	YES
 #define NormalLibFreetype2	YES
-#define FontLibSharedFreeType 	NO
+#define FontLibSharedFreeType 	YES
 #endif
 
 /*
@@ -649,6 +649,7 @@ XCOMM $XFree86: xc/config/cf/xf86site.def,v 3.186 2003/06/25 18:06:22 eich Exp $
  *
 #define XserverStaticFontLib	NO
  */
+#define XserverStaticFontLib	YES
 
 /*
  * To enable binary compatibility with previous versions of the font
@@ -686,7 +687,7 @@ XCOMM $XFree86: xc/config/cf/xf86site.def,v 3.186 2003/06/25 18:06:22 eich Exp $
  *
 #define BuildXinerama		NO
  */
-#define BuildXinerama		NO
+#define BuildXinerama		YES
 
 /*
  * If you don't want to build support for the GLX extension, uncomment this.
@@ -733,7 +734,7 @@ XCOMM $XFree86: xc/config/cf/xf86site.def,v 3.186 2003/06/25 18:06:22 eich Exp $
 #define BuildXKB		YES
 #define BuildXKBlib		YES
 
-#define SharedLibXau		NO
+#define SharedLibXau		YES
 
 /*
  * If you are running NetBSD 0.9C or later, and have the aperture driver
@@ -956,9 +957,9 @@ XCOMM $XFree86: xc/config/cf/xf86site.def,v 3.186 2003/06/25 18:06:22 eich Exp $
 #define BuildXterm YES
  */
 
-#define SharedLibXau           NO
+#define SharedLibXau           YES
 
-#define SharedLibXdmcp         NO
+#define SharedLibXdmcp         YES
 
 #define BuildXaw7              YES
 
@@ -976,7 +977,7 @@ XCOMM $XFree86: xc/config/cf/xf86site.def,v 3.186 2003/06/25 18:06:22 eich Exp $
 #define BuildFontServer             NO
 #define BuildFreeType               NO
 #define BuildXTrueType              NO
-#define FontLibSharedFreeType       NO
+#define FontLibSharedFreeType       YES
 #endif
 
 #if !defined(NXZaurusXServer) &amp;&amp; defined(NXiPAQXServer)
diff --git a/nx-X11/config/cf/ibmLib.rules b/nx-X11/config/cf/ibmLib.rules
index eb60713..53d5bb1 100644
--- a/nx-X11/config/cf/ibmLib.rules
+++ b/nx-X11/config/cf/ibmLib.rules
@@ -127,23 +127,23 @@ LintLibReferences(varname,libname,libsource)
 #   ifndef SharedFontLibReferences
 #    define SharedFontLibReferences()					@@\
 DEPFONTLIB = /**/							@@\
-FONTLIB = -L$(FREETYPELIBDIR) _Use(-lXfont,$(FONTLIBSRC)/libXfont.a)	@@\
-LintLibReferences(XFONT,Xfont,$(FONTLIBSRC))
+FONTLIB = -L$(FREETYPELIBDIR) _Use(-lNX_Xfont,$(FONTLIBSRC)/libNX_Xfont.a)	@@\
+LintLibReferences(XFONT,NX_Xfont,$(FONTLIBSRC))
 #   endif
 #  else
 #   ifndef SharedFontLibReferences
 #    define SharedFontLibReferences()					@@\
 DEPFONTLIB = /**/							@@\
-FONTLIB = -L$(FREETYPELIBDIR) _Use(-lXfont,$(BUILDLIBDIR)/font.imp) $(BUILDLIBDI)/libXfont.a)) @@\
-LintLibReferences(XFONT,Xfont,$(FONTLIBSRC))
+FONTLIB = -L$(FREETYPELIBDIR) _Use(-lNX_Xfont,$(BUILDLIBDIR)/font.imp) $(BUILDLIBDI)/libNX_Xfont.a)) @@\
+LintLibReferences(XFONT,NX_Xfont,$(FONTLIBSRC))
 #   endif
 #  endif
 # else /* OSMajorVersion &lt; 5 */
 #  ifndef SharedFontLibReferences
 #   define SharedFontLibReferences()					@@\
 DEPFONTLIB = /**/							@@\
-FONTLIB = -L$(FREETYPELIBDIR) _Use(-lXfont,$(BUILDLIBDI)/libXfont.so)) @@\
-LintLibReferences(XFONT,Xfont,$(FONTLIBSRC))
+FONTLIB = -L$(FREETYPELIBDIR) _Use(-lNX_Xfont,$(BUILDLIBDI)/libNX_Xfont.so)) @@\
+LintLibReferences(XFONT,NX_Xfont,$(FONTLIBSRC))
 #  endif
 
 # endif
diff --git a/nx-X11/config/cf/ibmLib.tmpl b/nx-X11/config/cf/ibmLib.tmpl
index ff196aa..04ae2cb 100644
--- a/nx-X11/config/cf/ibmLib.tmpl
+++ b/nx-X11/config/cf/ibmLib.tmpl
@@ -81,7 +81,7 @@ XCOMM $XFree86: xc/config/cf/ibmLib.tmpl,v 1.3tsi Exp $
    /* we want this to be defined only when building X */
 # ifndef FixupLibReferences
 # define FixupLibReferences()						@@\
-DEPXTOOLLIB = _UseCat($(USRLIBDIR),$(TOOLKITSRC),/libXt.a)
+DEPXTOOLLIB = _UseCat($(USRLIBDIR),$(TOOLKITSRC),/libNX_Xt.a)
 # endif
 #endif
 
diff --git a/nx-X11/config/cf/linux.cf b/nx-X11/config/cf/linux.cf
index 98981d7..25d2547 100644
--- a/nx-X11/config/cf/linux.cf
+++ b/nx-X11/config/cf/linux.cf
@@ -1054,7 +1054,7 @@ InstallNamedTargetNoClobber(install,file.ad,$(INSTAPPFLAGS),$(XAPPLOADDIR),class
 
 #if HaveLib64
 # ifndef LibDirName
-#  define LibDirName		lib64
+#  define LibDirName		lib
 # endif
 # ifndef SystemUsrLibDir
 #  define SystemUsrLibDir	/usr/lib64
diff --git a/nx-X11/config/cf/lnxLib.rules b/nx-X11/config/cf/lnxLib.rules
index 0cc71d3..4092031 100644
--- a/nx-X11/config/cf/lnxLib.rules
+++ b/nx-X11/config/cf/lnxLib.rules
@@ -389,7 +389,7 @@ JUMP_LDLIBS_libc = `$(CC) --print-libgcc-file-name` -lc
 XCOMM libX11.so (X11, SM, ICE)
 JUMP_ROOT_X11 = $(XLIBSRC)
 JUMP_IS_HOST_X11 = YES
-JUMP_STUBLIBS_X11 = libX11.sa libSM.sa libICE.sa
+JUMP_STUBLIBS_X11 = libNX_X11.sa libNX_SM.sa libNX_ICE.sa
 JUMP_SIBDIRS_X11 = $(JUMP_ROOT_SM) $(JUMP_ROOT_ICE)
 JUMP_DIR_X11 = $(JUMP_ROOT_X11)/shared
 JUMP_DEFS_X11 = $(XDMAUTHDEFS) $(XKB_DEFINES)
@@ -400,9 +400,9 @@ JUMP_EXPORT_X11 = $(JUMP_DIR_X11)/jump.vars
 JUMP_ADDRESS_X11 = 0x60200000
 JUMP_JUMPTABLESIZE_X11 = 0x4000
 JUMP_GOTSIZE_X11 = 4096
-JUMP_STUBNAMES_X11 = libX11 libSM libICE
+JUMP_STUBNAMES_X11 = libNX_X11 libNX_SM libNX_ICE
 JUMP_STUBS_IMPORT_X11 = $(LIBC_SA)
-JUMP_SIBARS_X11 = jump/libSM.a~ jump/libICE.a~
+JUMP_SIBARS_X11 = jump/libNX_SM.a~ jump/libNX_ICE.a~
 JUMP_LDLIBS_X11 = $(JUMP_SIBARS_X11) $(JUMP_LDLIBS_libc)
 
 XCOMM libSM (part of libX11.so)
@@ -435,9 +435,9 @@ JUMP_JUMPTABLESIZE_Xt = 0x4000
 JUMP_GOTSIZE_Xt = 4096
 JUMP_STUBNAMES_Xt = libXt libXmu libXext libXi libXtst libXp
 JUMP_STUBS_IMPORT_Xt = $(JUMP_STUBS_IMPORT_X11)
-JUMP_SIBARS_Xt = jump/libXmu.a~ jump/libXext.a~ jump/libXi.a~ jump/libXtst.a~ jump/libXp.a~
-JUMP_LDLIBS_Xt = $(JUMP_SIBARS_Xt) $(JUMP_ROOT_ICE)/libICE.sa \
-	$(JUMP_ROOT_SM)/libSM.sa $(JUMP_ROOT_X11)/libX11.sa $(JUMP_LDLIBS_libc)
+JUMP_SIBARS_Xt = jump/libNX_Xmu.a~ jump/libNX_Xext.a~ jump/libNX_Xi.a~ jump/libNX_Xtst.a~ jump/libNX_Xp.a~
+JUMP_LDLIBS_Xt = $(JUMP_SIBARS_Xt) $(JUMP_ROOT_ICE)/libNX_ICE.sa \
+	$(JUMP_ROOT_SM)/libNX_SM.sa $(JUMP_ROOT_X11)/libNX_X11.sa $(JUMP_LDLIBS_libc)
 
 XCOMM libXmu (part of libXt.so)
 JUMP_ROOT_Xmu = $(XMUSRC)
@@ -485,8 +485,8 @@ JUMP_JUMPTABLESIZE_Xaw = 0x4000
 JUMP_GOTSIZE_Xaw = 4096
 JUMP_STUBNAMES_Xaw = libXaw
 JUMP_STUBS_IMPORT_Xaw = $(JUMP_STUBS_IMPORT_X11)
-JUMP_LDLIBS_Xaw = $(JUMP_ROOT_Xt)/libXt.sa $(JUMP_ROOT_Xt)/libXmu.sa \
-	$(JUMP_ROOT_Xt)/libXext.sa $(JUMP_ROOT_X11)/libX11.sa \
+JUMP_LDLIBS_Xaw = $(JUMP_ROOT_Xt)/libNX_Xt.sa $(JUMP_ROOT_Xt)/libNX_Xmu.sa \
+	$(JUMP_ROOT_Xt)/libNX_Xext.sa $(JUMP_ROOT_X11)/libNX_X11.sa \
 	$(JUMP_LDLIBS_libc)
 
 # endif /* !UseInstalled */
diff --git a/nx-X11/config/cf/lnxLib.tmpl b/nx-X11/config/cf/lnxLib.tmpl
index f1eb5ac..788733c 100644
--- a/nx-X11/config/cf/lnxLib.tmpl
+++ b/nx-X11/config/cf/lnxLib.tmpl
@@ -9,7 +9,7 @@ XCOMM $XFree86: xc/config/cf/lnxLib.tmpl,v 3.19 2003/10/15 22:47:48 herrb Exp $
 
 #ifndef FixupLibReferences
 #define FixupLibReferences()						@@\
-XMULIBONLY = -lXmu							@@\
+XMULIBONLY = -lNX_Xmu							@@\
 XMULIB = $(XMULIBONLY) $(XTOOLLIB) $(XLIB)
 #endif
 
@@ -66,7 +66,7 @@ XMULIB = $(XMULIBONLY) $(XTOOLLIB) $(XLIB)
 
 #ifndef FixupLibReferences
 #define FixupLibReferences()						@@\
-XMULIB = -lXmu $(XLIB)
+XMULIB = -lNX_Xmu $(XLIB)
 #endif
 
 #endif	/* UseElfFormat */
diff --git a/nx-X11/config/cf/mingw.tmpl b/nx-X11/config/cf/mingw.tmpl
index 6be56d1..f9c3ec9 100644
--- a/nx-X11/config/cf/mingw.tmpl
+++ b/nx-X11/config/cf/mingw.tmpl
@@ -50,7 +50,7 @@ XCOMM $XFree86: xc/config/cf/cygwin.tmpl,v 3.18 2003/10/19 08:27:05 herrb Exp $
 
 #ifndef FixupLibReferences
 # define FixupLibReferences()						@@\
-XMULIBONLY = -lXmu							@@\
+XMULIBONLY = -lNX_Xmu							@@\
 XMULIB = $(XMULIBONLY) $(XTOOLLIB) $(XLIB)
 #endif
 
diff --git a/nx-X11/config/cf/nto.rules b/nx-X11/config/cf/nto.rules
index e5023e2..87960ef 100644
--- a/nx-X11/config/cf/nto.rules
+++ b/nx-X11/config/cf/nto.rules
@@ -104,7 +104,7 @@ ComplexHostProgramTarget(program)
 
 #ifndef FixupLibReferences
 #define FixupLibReferences()						@@\
-XMULIBONLY = -lXmu							@@\
+XMULIBONLY = -lNX_Xmu							@@\
 XMULIB = $(XMULIBONLY) $(XTOOLLIB) $(XLIB)
 #endif
 
diff --git a/nx-X11/config/cf/os2Lib.tmpl b/nx-X11/config/cf/os2Lib.tmpl
index 5229930..38c05ce 100644
--- a/nx-X11/config/cf/os2Lib.tmpl
+++ b/nx-X11/config/cf/os2Lib.tmpl
@@ -107,35 +107,35 @@ XCOMM $XFree86: xc/config/cf/os2Lib.tmpl,v 3.18 2003/11/12 00:10:23 dawes Exp $
 #endif
 
 #if LinkStatically
-#define SDlibX11 -lX11_s
-#define SDlibXExt -lXExt_s
-#define SDlibXmu -lXmu_s
-#define SDlibXt -lXt_s
-#define SDlibXaw -lXaw_s
-#define SDlibXaw7 -lXaw_s
-#define SDlibXaw6 -lXaw_s
-#define SDlibXi -lXi_s
-#define SDlibXtst -lXtst_s
-#define SDlibXp -lXp_s
-#define SDlibXv -lXv_s
-#define SDlibGL -lGL_s
-#define SDlibDPS -lDPS_s
-#define SDlibDPSTK -lDPSTK_s
+#define SDlibX11 -lNX_X11_s
+#define SDlibXExt -lNX_XExt_s
+#define SDlibXmu -lNX_Xmu_s
+#define SDlibXt -lNX_Xt_s
+#define SDlibXaw -lNX_Xaw_s
+#define SDlibXaw7 -lNX_Xaw_s
+#define SDlibXaw6 -lNX_Xaw_s
+#define SDlibXi -lNX_Xi_s
+#define SDlibXtst -lNX_Xtst_s
+#define SDlibXp -lNX_Xp_s
+#define SDlibXv -lNX_Xv_s
+#define SDlibGL -lNX_GL_s
+#define SDlibDPS -lNX_DPS_s
+#define SDlibDPSTK -lNX_DPSTK_s
 #else
-#define SDlibX11 -lX11
-#define SDlibXExt -lXExt
-#define SDlibXmu -lXmu
-#define SDlibXt -lXt
-#define SDlibXaw -lXaw
-#define SDlibXaw7 -lXaw
-#define SDlibXaw6 -lXaw
-#define SDlibXi -lXi
-#define SDlibXtst -lXtst
-#define SDlibXp -lXp
-#define SDlibXv -lXv
-#define SDlibGL -lGL
-#define SDlibDPS -lDPS
-#define SDlibDPSTK -lDPSTK
+#define SDlibX11 -lNX_X11
+#define SDlibXExt -lNX_XExt
+#define SDlibXmu -lNX_Xmu
+#define SDlibXt -lNX_Xt
+#define SDlibXaw -lNX_Xaw
+#define SDlibXaw7 -lNX_Xaw
+#define SDlibXaw6 -lNX_Xaw
+#define SDlibXi -lNX_Xi
+#define SDlibXtst -lNX_Xtst
+#define SDlibXp -lNX_Xp
+#define SDlibXv -lNX_Xv
+#define SDlibGL -lNX_GL
+#define SDlibDPS -lNX_DPS
+#define SDlibDPSTK -lNX_DPSTK
 #endif
 
 /*
@@ -159,7 +159,7 @@ XCOMM $XFree86: xc/config/cf/os2Lib.tmpl,v 3.18 2003/11/12 00:10:23 dawes Exp $
 #endif
 #if SharedOldX
       DEPOLDXLIB = 
-         OLDXLIB = _Use(-loldX,-L$(OLDXLIBSRC) -loldX)
+         OLDXLIB = _Use(-lNX_oldX,-L$(OLDXLIBSRC) -lNX_oldX)
 #endif
 #if SharedLibXt
      DEPXTOOLLIB = 
diff --git a/nx-X11/config/cf/sco5.cf b/nx-X11/config/cf/sco5.cf
index c6fa54b..b53640f 100644
--- a/nx-X11/config/cf/sco5.cf
+++ b/nx-X11/config/cf/sco5.cf
@@ -318,7 +318,7 @@ XCOMM $XdotOrg: xc/config/cf/sco5.cf,v 1.9 2005/12/20 22:30:48 alanc Exp $
  */
 #ifndef FixupLibReferences
 #define FixupLibReferences()						@@\
-XMULIBONLY = -lXmu							@@\
+XMULIBONLY = -lNX_Xmu							@@\
 XMULIB = $(XMULIBONLY) $(XTOOLLIB) $(XLIB)
 #endif
 
diff --git a/nx-X11/config/cf/site.def b/nx-X11/config/cf/site.def
index c242f0e..071116f 100644
--- a/nx-X11/config/cf/site.def
+++ b/nx-X11/config/cf/site.def
@@ -72,7 +72,7 @@ XCOMM site:  $XFree86: xc/config/cf/site.def,v 3.24 2000/06/25 20:17:29 dawes Ex
 #ifdef AfterVendorCF
 
 #ifndef ProjectRoot
-#define ProjectRoot /usr/local/lib/nx
+#define ProjectRoot /usr/local
 #endif
 
 /*
@@ -87,7 +87,7 @@ XCOMM site:  $XFree86: xc/config/cf/site.def,v 3.24 2000/06/25 20:17:29 dawes Ex
  * ProjectRoot rather than in /etc/X11.  See also HasVarDirectory,
  * UseEtcX11 and UseSeparateConfDir.
  *
-#define EtcX11Directory ProjectRoot/etc
+#define EtcX11Directory /etc/nx
  */
 
 
diff --git a/nx-X11/config/cf/sv3Lib.tmpl b/nx-X11/config/cf/sv3Lib.tmpl
index c9fd323..fbd9b62 100644
--- a/nx-X11/config/cf/sv3Lib.tmpl
+++ b/nx-X11/config/cf/sv3Lib.tmpl
@@ -40,31 +40,31 @@ XCOMM $XFree86: xc/config/cf/sv3Lib.tmpl,v 3.2 2001/01/17 16:38:49 dawes Exp $
  * are using shared libraries, we really do not need to depend on anything
  */
 #if SharedLibXext
-  DEPEXTENSIONLIB = _UseCat($(USRLIBDIR),$(EXTENSIONSRC)/lib,/libXext_s.a)
-     EXTENSIONLIB = LoaderLibPrefix _Use(-lXext_s, $(DEPEXTENSIONLIB))
+  DEPEXTENSIONLIB = _UseCat($(USRLIBDIR),$(EXTENSIONSRC)/lib,/libNX_Xext_s.a)
+     EXTENSIONLIB = LoaderLibPrefix _Use(-lNX_Xext_s, $(DEPEXTENSIONLIB))
 #endif
 #if SharedLibX
-          DEPXLIB = $(DEPEXTENSIONLIB) _UseCat($(USRLIBDIR),$(XLIBSRC),/libX11_s.a)
-             XLIB = $(EXTENSIONLIB) LoaderLibPrefix _Use(-lX11_s,$(XLIBSRC)/libX11_s.a)
+          DEPXLIB = $(DEPEXTENSIONLIB) _UseCat($(USRLIBDIR),$(XLIBSRC),/libNX_X11_s.a)
+             XLIB = $(EXTENSIONLIB) LoaderLibPrefix _Use(-lNX_X11_s,$(XLIBSRC)/libNX_X11_s.a)
 #endif
 #if SharedLibXmu
-        DEPXMULIB = _UseCat($(USRLIBDIR),$(XMUSRC),/libXmu_s.a)
-           XMULIB = LoaderLibPrefix _Use(-lXmu_s,$(DEPXMULIB))
+        DEPXMULIB = _UseCat($(USRLIBDIR),$(XMUSRC),/libNX_Xmu_s.a)
+           XMULIB = LoaderLibPrefix _Use(-lNX_Xmu_s,$(DEPXMULIB))
 #endif
 #if SharedOldLibX
        DEPOLDXLIB = _UseCat($(USRLIBDIR),$(OLDXLIBSRC),/liboldX_s.a)
           OLDXLIB = LoaderLibPrefix _Use(-loldX_s,$(DEPOLDXLIB))
 #endif
 #if SharedLibXt
-      DEPXTOOLLIB = _UseCat($(USRLIBDIR),$(TOOLKITSRC),/libXt_s.a)
-         XTOOLLIB = LoaderLibPrefix _Use(-lXt_s,$(DEPXTOOLLIB))
+      DEPXTOOLLIB = _UseCat($(USRLIBDIR),$(TOOLKITSRC),/libNX_Xt_s.a)
+         XTOOLLIB = LoaderLibPrefix _Use(-lNX_Xt_s,$(DEPXTOOLLIB))
 #endif
 #if SharedLibXaw
-        DEPXAWLIB = _UseCat($(USRLIBDIR),$(AWIDGETSRC),/libXaw_s.a)
-           XAWLIB = LoaderLibPrefix _Use(-lXaw_s,$(DEPXAWLIB))
+        DEPXAWLIB = _UseCat($(USRLIBDIR),$(AWIDGETSRC),/libNX_Xaw_s.a)
+           XAWLIB = LoaderLibPrefix _Use(-lNX_Xaw_s,$(DEPXAWLIB))
 #endif
 #if SharedLibXinput
-         DEPXILIB = _UseCat($(USRLIBDIR),$(XILIBSRC),/libXi_s.a)
-            XILIB = LoaderLibPrefix _Use(-lXi_s,$(DEPXILIB))
+         DEPXILIB = _UseCat($(USRLIBDIR),$(XILIBSRC),/libNX_Xi_s.a)
+            XILIB = LoaderLibPrefix _Use(-lNX_Xi_s,$(DEPXILIB))
 #endif
 
diff --git a/nx-X11/config/cf/sv4Lib.tmpl b/nx-X11/config/cf/sv4Lib.tmpl
index d209e83..65aa087 100644
--- a/nx-X11/config/cf/sv4Lib.tmpl
+++ b/nx-X11/config/cf/sv4Lib.tmpl
@@ -7,7 +7,7 @@ XCOMM $Xorg: sv4Lib.tmpl,v 1.3 2000/08/17 19:41:48 cpqbld Exp $
 XCOMM $XFree86: xc/config/cf/sv4Lib.tmpl,v 3.7 2003/05/29 21:56:57 herrb Exp $
 
 /* SVR4 shared libraries are deficient in link semantics */
-XMULIBONLY = -lXmu
+XMULIBONLY = -lNX_Xmu
 #ifndef FixupLibReferences
 # define FixupLibReferences()						@@\
 XMULIB = $(XMULIBONLY) -z nodefs
diff --git a/nx-X11/config/cf/usl.cf b/nx-X11/config/cf/usl.cf
index e54476b..be46645 100644
--- a/nx-X11/config/cf/usl.cf
+++ b/nx-X11/config/cf/usl.cf
@@ -262,7 +262,7 @@ XCOMM operating system: OSName (OSMajorVersion./**/OSMinorVersion./**/OSTeenyVer
  */
 #ifndef FixupLibReferences
 #define FixupLibReferences()						@@\
-XMULIBONLY = -lXmu							@@\
+XMULIBONLY = -lNX_Xmu							@@\
 XMULIB = $(XMULIBONLY) $(XTOOLLIB) $(XLIB)
 #endif
 
diff --git a/nx-X11/config/imake/Makefile.ini b/nx-X11/config/imake/Makefile.ini
index b9c2296..93dca85 100644
--- a/nx-X11/config/imake/Makefile.ini
+++ b/nx-X11/config/imake/Makefile.ini
@@ -21,7 +21,6 @@ IMAKEMDEP_CROSSCOMPILE = -DCROSSCOMPILE_CPP
 SHELL = /bin/sh
 RM = rm -f
 MV = mv
-MAKE = make
 RM_CMD = $(RM) *.CKP *.ln *.BAK *.bak *.o core errs ,* *~ *.a \
 	 tags TAGS make.log
 NPROC = 1
diff --git a/nx-X11/extras/Mesa/Makefile b/nx-X11/extras/Mesa/Makefile
index ea8d6fb..e6833c9 100644
--- a/nx-X11/extras/Mesa/Makefile
+++ b/nx-X11/extras/Mesa/Makefile
@@ -12,7 +12,7 @@ default: $(TOP)/configs/current
 
 
 doxygen:
-	(cd doxygen ; make) ; \
+	(cd doxygen ; ${MAKE}) ; \
 
 clean:
 	@for dir in $(SUBDIRS) ; do \
diff --git a/nx-X11/extras/Mesa/src/mesa/main/Imakefile b/nx-X11/extras/Mesa/src/mesa/main/Imakefile
index fe0658c..980eb07 100644
--- a/nx-X11/extras/Mesa/src/mesa/main/Imakefile
+++ b/nx-X11/extras/Mesa/src/mesa/main/Imakefile
@@ -2,7 +2,7 @@
 #define DoSharedLib YES
 #define DoDebugLib NO
 #define DoProfileLib NO
-#define LibName MESAGL
+#define LibName NX_MESAGL
 #define SoRev SOX11REV
 #define LibHeaders NO
 
diff --git a/nx-X11/extras/Xpm/Makefile.noX b/nx-X11/extras/Xpm/Makefile.noX
index aa94a2c..0308a6c 100644
--- a/nx-X11/extras/Xpm/Makefile.noX
+++ b/nx-X11/extras/Xpm/Makefile.noX
@@ -32,7 +32,6 @@
 
 SUBDIRS= lib sxpm cxpm
 
-MAKE=make
 MFLAGS=-f Makefile.noX
 INSTALL= install -c
 CURRENT_DIR=.
diff --git a/nx-X11/extras/Xpm/lib/Imakefile b/nx-X11/extras/Xpm/lib/Imakefile
index 4279607..78c5dbf 100644
--- a/nx-X11/extras/Xpm/lib/Imakefile
+++ b/nx-X11/extras/Xpm/lib/Imakefile
@@ -125,7 +125,7 @@ OS_NAME_DEFINES = OsNameDefines
     STD_DEFINES = LibraryDefines
     CDEBUGFLAGS = LibraryCDebugFlags
 #else
-#define LibName Xpm
+#define LibName NX_Xpm
 #define SoRev SOXPMLIBREV
 #define IncSubdir X11
 /* we have to cheat on Library.tmpl to get what we want... */
diff --git a/nx-X11/extras/drm/libdrm.pc.in b/nx-X11/extras/drm/libdrm.pc.in
index 6e00597..00b0248 100644
--- a/nx-X11/extras/drm/libdrm.pc.in
+++ b/nx-X11/extras/drm/libdrm.pc.in
@@ -6,5 +6,5 @@ includedir=@includedir@
 Name: libdrm
 Description: Userspace interface to kernel DRM services
 Version: @PACKAGE_VERSION@
-Libs: -L${libdir} -ldrm
+Libs: -L${libdir} -lNX_drm
 Cflags: -I${includedir} -I${includedir}/drm
diff --git a/nx-X11/extras/drm/linux-core/Makefile b/nx-X11/extras/drm/linux-core/Makefile
index ab3609b..36f670e 100644
--- a/nx-X11/extras/drm/linux-core/Makefile
+++ b/nx-X11/extras/drm/linux-core/Makefile
@@ -176,7 +176,7 @@ endif
 all: modules
 
 modules: includes
-	make -C $(LINUXDIR) $(GETCONFIG) SUBDIRS=`pwd` DRMSRCDIR=`pwd` modules
+	${MAKE} -C $(LINUXDIR) $(GETCONFIG) SUBDIRS=`pwd` DRMSRCDIR=`pwd` modules
 
 ifeq ($(HEADERFROMBOOT),1)
 
@@ -246,7 +246,7 @@ clean cleandir:
 	rm -rf $(CLEANFILES)
 
 $(MODULE_LIST)::
-	make DRM_MODULES=$@ modules
+	${MAKE} DRM_MODULES=$@ modules
 
 # Build test utilities
 
diff --git a/nx-X11/extras/drm/linux/Makefile b/nx-X11/extras/drm/linux/Makefile
index 44f56bd..b82ec7a 100644
--- a/nx-X11/extras/drm/linux/Makefile
+++ b/nx-X11/extras/drm/linux/Makefile
@@ -184,7 +184,7 @@ endif
 all: modules
 
 modules: includes
-	make -C $(LINUXDIR) $(GETCONFIG) SUBDIRS=`pwd` DRMSRCDIR=`pwd` modules
+	${MAKE} -C $(LINUXDIR) $(GETCONFIG) SUBDIRS=`pwd` DRMSRCDIR=`pwd` modules
 
 ifeq ($(HEADERFROMBOOT),1)
 
@@ -254,7 +254,7 @@ clean cleandir:
 	rm -rf $(CLEANFILES)
 
 $(MODULE_LIST)::
-	make DRM_MODULES=$@ modules
+	${MAKE} DRM_MODULES=$@ modules
 
 # Build test utilities
 
diff --git a/nx-X11/extras/expat/conftools/config.guess b/nx-X11/extras/expat/conftools/config.guess
index 6cfac28..c2246a4 100644
--- a/nx-X11/extras/expat/conftools/config.guess
+++ b/nx-X11/extras/expat/conftools/config.guess
@@ -1,9 +1,10 @@
 #! /bin/sh
 # Attempt to guess a canonical system name.
 #   Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999,
-#   2000, 2001, 2002 Free Software Foundation, Inc.
+#   2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010
+#   Free Software Foundation, Inc.
 
-timestamp='2002-03-20'
+timestamp='2009-12-30'
 
 # This file is free software; you can redistribute it and/or modify it
 # under the terms of the GNU General Public License as published by
@@ -17,28 +18,25 @@ timestamp='2002-03-20'
 #
 # You should have received a copy of the GNU General Public License
 # along with this program; if not, write to the Free Software
-# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+# Foundation, Inc., 51 Franklin Street - Fifth Floor, Boston, MA
+# 02110-1301, USA.
 #
 # As a special exception to the GNU General Public License, if you
 # distribute this file as part of a program that contains a
 # configuration script generated by Autoconf, you may include it under
 # the same distribution terms that you use for the rest of that program.
 
-#####################################################################
-# This file contains changes for Apache, clearly marked below.
-# These changes are hereby donated to the public domain.
-#####################################################################
 
-# Originally written by Per Bothner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">per at bothner.com</A>&gt;.
-# Please send patches to &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">config-patches at gnu.org</A>&gt;.  Submit a context
-# diff and a properly formatted ChangeLog entry.
+# Originally written by Per Bothner.  Please send patches (context
+# diff format) to &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">config-patches at gnu.org</A>&gt; and include a ChangeLog
+# entry.
 #
 # This script attempts to guess a canonical system name similar to
 # config.sub.  If it succeeds, it prints the system name on stdout, and
 # exits with 0.  Otherwise, it exits with 1.
 #
-# The plan is that this can be called by configure scripts if you
-# don't specify an explicit build system type.
+# You can get the latest version of this script from:
+# <A HREF="http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.guess;hb=HEAD">http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.guess;hb=HEAD</A>
 
 me=`echo &quot;$0&quot; | sed -e 's,.*/,,'`
 
@@ -58,8 +56,9 @@ version=&quot;\
 GNU config.guess ($timestamp)
 
 Originally written by Per Bothner.
-Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
-Free Software Foundation, Inc.
+Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000,
+2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010 Free
+Software Foundation, Inc.
 
 This is free software; see the source for copying conditions.  There is NO
 warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&quot;
@@ -71,11 +70,11 @@ Try \`$me --help' for more information.&quot;
 while test $# -gt 0 ; do
   case $1 in
     --time-stamp | --time* | -t )
-       echo &quot;$timestamp&quot; ; exit 0 ;;
+       echo &quot;$timestamp&quot; ; exit ;;
     --version | -v )
-       echo &quot;$version&quot; ; exit 0 ;;
+       echo &quot;$version&quot; ; exit ;;
     --help | --h* | -h )
-       echo &quot;$usage&quot;; exit 0 ;;
+       echo &quot;$usage&quot;; exit ;;
     -- )     # Stop option processing
        shift; break ;;
     - )	# Use stdin as input.
@@ -93,30 +92,42 @@ if test $# != 0; then
   exit 1
 fi
 
+trap 'exit 1' 1 2 15
 
-dummy=dummy-$$
-trap 'rm -f $dummy.c $dummy.o $dummy.rel $dummy; exit 1' 1 2 15
+# CC_FOR_BUILD -- compiler used by this script. Note that the use of a
+# compiler to aid in system detection is discouraged as it requires
+# temporary files to be created and, as you can see below, it is a
+# headache to deal with in a portable fashion.
 
-# CC_FOR_BUILD -- compiler used by this script.
 # Historically, `CC_FOR_BUILD' used to be named `HOST_CC'. We still
 # use `HOST_CC' if defined, but it is deprecated.
 
-set_cc_for_build='case $CC_FOR_BUILD,$HOST_CC,$CC in
- ,,)    echo &quot;int dummy(){}&quot; &gt; $dummy.c ;
+# Portable tmp directory creation inspired by the Autoconf team.
+
+set_cc_for_build='
+trap &quot;exitcode=\$?; (rm -f \$tmpfiles 2&gt;/dev/null; rmdir \$tmp 2&gt;/dev/null) &amp;&amp; exit \$exitcode&quot; 0 ;
+trap &quot;rm -f \$tmpfiles 2&gt;/dev/null; rmdir \$tmp 2&gt;/dev/null; exit 1&quot; 1 2 13 15 ;
+: ${TMPDIR=/tmp} ;
+ { tmp=`(umask 077 &amp;&amp; mktemp -d &quot;$TMPDIR/cgXXXXXX&quot;) 2&gt;/dev/null` &amp;&amp; test -n &quot;$tmp&quot; &amp;&amp; test -d &quot;$tmp&quot; ; } ||
+ { test -n &quot;$RANDOM&quot; &amp;&amp; tmp=$TMPDIR/cg$$-$RANDOM &amp;&amp; (umask 077 &amp;&amp; mkdir $tmp) ; } ||
+ { tmp=$TMPDIR/cg-$$ &amp;&amp; (umask 077 &amp;&amp; mkdir $tmp) &amp;&amp; echo &quot;Warning: creating insecure temp directory&quot; &gt;&amp;2 ; } ||
+ { echo &quot;$me: cannot create a temporary directory in $TMPDIR&quot; &gt;&amp;2 ; exit 1 ; } ;
+dummy=$tmp/dummy ;
+tmpfiles=&quot;$dummy.c $dummy.o $dummy.rel $dummy&quot; ;
+case $CC_FOR_BUILD,$HOST_CC,$CC in
+ ,,)    echo &quot;int x;&quot; &gt; $dummy.c ;
 	for c in cc gcc c89 c99 ; do
-	  ($c $dummy.c -c -o $dummy.o) &gt;/dev/null 2&gt;&amp;1 ;
-	  if test $? = 0 ; then
+	  if ($c -c -o $dummy.o $dummy.c) &gt;/dev/null 2&gt;&amp;1 ; then
 	     CC_FOR_BUILD=&quot;$c&quot;; break ;
 	  fi ;
 	done ;
-	rm -f $dummy.c $dummy.o $dummy.rel ;
 	if test x&quot;$CC_FOR_BUILD&quot; = x ; then
 	  CC_FOR_BUILD=no_compiler_found ;
 	fi
 	;;
  ,,*)   CC_FOR_BUILD=$CC ;;
  ,*,*)  CC_FOR_BUILD=$HOST_CC ;;
-esac'
+esac ; set_cc_for_build= ;'
 
 # This is needed to find uname on a Pyramid OSx when run in the BSD universe.
 # (<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">ghazi at noc.rutgers.edu</A> 1994-08-24)
@@ -147,9 +158,11 @@ case &quot;${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}&quot; in
 	UNAME_MACHINE_ARCH=`(/sbin/$sysctl 2&gt;/dev/null || \
 	    /usr/sbin/$sysctl 2&gt;/dev/null || echo unknown)`
 	case &quot;${UNAME_MACHINE_ARCH}&quot; in
+	    armeb) machine=armeb-unknown ;;
 	    arm*) machine=arm-unknown ;;
 	    sh3el) machine=shl-unknown ;;
 	    sh3eb) machine=sh-unknown ;;
+	    sh5el) machine=sh5le-unknown ;;
 	    *) machine=${UNAME_MACHINE_ARCH}-unknown ;;
 	esac
 	# The Operating System including object format, if it has switched
@@ -158,7 +171,7 @@ case &quot;${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}&quot; in
 	    arm*|i386|m68k|ns32k|sh3*|sparc|vax)
 		eval $set_cc_for_build
 		if echo __ELF__ | $CC_FOR_BUILD -E - 2&gt;/dev/null \
-			| grep __ELF__ &gt;/dev/null
+			| grep -q __ELF__
 		then
 		    # Once all utilities can be ECOFF (netbsdecoff) or a.out (netbsdaout).
 		    # Return netbsd for either.  FIX?
@@ -172,159 +185,128 @@ case &quot;${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}&quot; in
 		;;
 	esac
 	# The OS release
-	release=`echo ${UNAME_RELEASE}|sed -e 's/[-_].*/\./'`
+	# Debian GNU/NetBSD machines have a different userland, and
+	# thus, need a distinct triplet. However, they do not need
+	# kernel version information, so it can be replaced with a
+	# suitable tag, in the style of linux-gnu.
+	case &quot;${UNAME_VERSION}&quot; in
+	    Debian*)
+		release='-gnu'
+		;;
+	    *)
+		release=`echo ${UNAME_RELEASE}|sed -e 's/[-_].*/\./'`
+		;;
+	esac
 	# Since CPU_TYPE-MANUFACTURER-KERNEL-OPERATING_SYSTEM:
 	# contains redundant information, the shorter form:
 	# CPU_TYPE-MANUFACTURER-OPERATING_SYSTEM is used.
 	echo &quot;${machine}-${os}${release}&quot;
-	exit 0 ;;
-    amiga:OpenBSD:*:*)
-	echo m68k-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    arc:OpenBSD:*:*)
-	echo mipsel-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    hp300:OpenBSD:*:*)
-	echo m68k-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    mac68k:OpenBSD:*:*)
-	echo m68k-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    macppc:OpenBSD:*:*)
-	echo powerpc-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    mvme68k:OpenBSD:*:*)
-	echo m68k-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    mvme88k:OpenBSD:*:*)
-	echo m88k-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    mvmeppc:OpenBSD:*:*)
-	echo powerpc-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    pmax:OpenBSD:*:*)
-	echo mipsel-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    sgi:OpenBSD:*:*)
-	echo mipseb-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    sun3:OpenBSD:*:*)
-	echo m68k-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    wgrisc:OpenBSD:*:*)
-	echo mipsel-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     *:OpenBSD:*:*)
-	echo ${UNAME_MACHINE}-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
+	UNAME_MACHINE_ARCH=`arch | sed 's/OpenBSD.//'`
+	echo ${UNAME_MACHINE_ARCH}-unknown-openbsd${UNAME_RELEASE}
+	exit ;;
+    *:ekkoBSD:*:*)
+	echo ${UNAME_MACHINE}-unknown-ekkobsd${UNAME_RELEASE}
+	exit ;;
+    *:SolidBSD:*:*)
+	echo ${UNAME_MACHINE}-unknown-solidbsd${UNAME_RELEASE}
+	exit ;;
+    macppc:MirBSD:*:*)
+	echo powerpc-unknown-mirbsd${UNAME_RELEASE}
+	exit ;;
+    *:MirBSD:*:*)
+	echo ${UNAME_MACHINE}-unknown-mirbsd${UNAME_RELEASE}
+	exit ;;
     alpha:OSF1:*:*)
-	if test $UNAME_RELEASE = &quot;V4.0&quot;; then
+	case $UNAME_RELEASE in
+	*4.0)
 		UNAME_RELEASE=`/usr/sbin/sizer -v | awk '{print $3}'`
-	fi
+		;;
+	*5.*)
+	        UNAME_RELEASE=`/usr/sbin/sizer -v | awk '{print $4}'`
+		;;
+	esac
+	# According to Compaq, /usr/sbin/psrinfo has been available on
+	# OSF/1 and Tru64 systems produced since 1995.  I hope that
+	# covers most systems running today.  This code pipes the CPU
+	# types through head -n 1, so we only detect the type of CPU 0.
+	ALPHA_CPU_TYPE=`/usr/sbin/psrinfo -v | sed -n -e 's/^  The alpha \(.*\) processor.*$/\1/p' | head -n 1`
+	case &quot;$ALPHA_CPU_TYPE&quot; in
+	    &quot;EV4 (21064)&quot;)
+		UNAME_MACHINE=&quot;alpha&quot; ;;
+	    &quot;EV4.5 (21064)&quot;)
+		UNAME_MACHINE=&quot;alpha&quot; ;;
+	    &quot;LCA4 (21066/21068)&quot;)
+		UNAME_MACHINE=&quot;alpha&quot; ;;
+	    &quot;EV5 (21164)&quot;)
+		UNAME_MACHINE=&quot;alphaev5&quot; ;;
+	    &quot;EV5.6 (21164A)&quot;)
+		UNAME_MACHINE=&quot;alphaev56&quot; ;;
+	    &quot;EV5.6 (21164PC)&quot;)
+		UNAME_MACHINE=&quot;alphapca56&quot; ;;
+	    &quot;EV5.7 (21164PC)&quot;)
+		UNAME_MACHINE=&quot;alphapca57&quot; ;;
+	    &quot;EV6 (21264)&quot;)
+		UNAME_MACHINE=&quot;alphaev6&quot; ;;
+	    &quot;EV6.7 (21264A)&quot;)
+		UNAME_MACHINE=&quot;alphaev67&quot; ;;
+	    &quot;EV6.8CB (21264C)&quot;)
+		UNAME_MACHINE=&quot;alphaev68&quot; ;;
+	    &quot;EV6.8AL (21264B)&quot;)
+		UNAME_MACHINE=&quot;alphaev68&quot; ;;
+	    &quot;EV6.8CX (21264D)&quot;)
+		UNAME_MACHINE=&quot;alphaev68&quot; ;;
+	    &quot;EV6.9A (21264/EV69A)&quot;)
+		UNAME_MACHINE=&quot;alphaev69&quot; ;;
+	    &quot;EV7 (21364)&quot;)
+		UNAME_MACHINE=&quot;alphaev7&quot; ;;
+	    &quot;EV7.9 (21364A)&quot;)
+		UNAME_MACHINE=&quot;alphaev79&quot; ;;
+	esac
+	# A Pn.n version is a patched version.
 	# A Vn.n version is a released version.
 	# A Tn.n version is a released field test version.
 	# A Xn.n version is an unreleased experimental baselevel.
 	# 1.2 uses &quot;1.2&quot; for uname -r.
-	cat &lt;&lt;EOF &gt;$dummy.s
-	.data
-\$Lformat:
-	.byte 37,100,45,37,120,10,0	# &quot;%d-%x\n&quot;
-
-	.text
-	.globl main
-	.align 4
-	.ent main
-main:
-	.frame \$30,16,\$26,0
-	ldgp \$29,0(\$27)
-	.prologue 1
-	.long 0x47e03d80 # implver \$0
-	lda \$2,-1
-	.long 0x47e20c21 # amask \$2,\$1
-	lda \$16,\$Lformat
-	mov \$0,\$17
-	not \$1,\$18
-	jsr \$26,printf
-	ldgp \$29,0(\$26)
-	mov 0,\$16
-	jsr \$26,exit
-	.end main
-EOF
-	eval $set_cc_for_build
-	$CC_FOR_BUILD $dummy.s -o $dummy 2&gt;/dev/null
-	if test &quot;$?&quot; = 0 ; then
-		case `./$dummy` in
-			0-0)
-				UNAME_MACHINE=&quot;alpha&quot;
-				;;
-			1-0)
-				UNAME_MACHINE=&quot;alphaev5&quot;
-				;;
-			1-1)
-				UNAME_MACHINE=&quot;alphaev56&quot;
-				;;
-			1-101)
-				UNAME_MACHINE=&quot;alphapca56&quot;
-				;;
-			2-303)
-				UNAME_MACHINE=&quot;alphaev6&quot;
-				;;
-			2-307)
-				UNAME_MACHINE=&quot;alphaev67&quot;
-				;;
-			2-1307)
-				UNAME_MACHINE=&quot;alphaev68&quot;
-				;;
-		esac
-	fi
-	rm -f $dummy.s $dummy
-	echo ${UNAME_MACHINE}-dec-osf`echo ${UNAME_RELEASE} | sed -e 's/^[VTX]//' | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz'`
-	exit 0 ;;
+	echo ${UNAME_MACHINE}-dec-osf`echo ${UNAME_RELEASE} | sed -e 's/^[PVTX]//' | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz'`
+	exit ;;
     Alpha\ *:Windows_NT*:*)
 	# How do we know it's Interix rather than the generic POSIX subsystem?
 	# Should we change UNAME_MACHINE based on the output of uname instead
 	# of the specific Alpha model?
 	echo alpha-pc-interix
-	exit 0 ;;
+	exit ;;
     21064:Windows_NT:50:3)
 	echo alpha-dec-winnt3.5
-	exit 0 ;;
+	exit ;;
     Amiga*:UNIX_System_V:4.0:*)
 	echo m68k-unknown-sysv4
-	exit 0;;
+	exit ;;
     *:[Aa]miga[Oo][Ss]:*:*)
 	echo ${UNAME_MACHINE}-unknown-amigaos
-	exit 0 ;;
+	exit ;;
     *:[Mm]orph[Oo][Ss]:*:*)
 	echo ${UNAME_MACHINE}-unknown-morphos
-	exit 0 ;;
-#########################
-# Apache changes
-#
-#   *:OS/390:*:*)
-#      echo i370-ibm-openedition
-#      exit 0 ;;
-    *:OS390:*:* | *:OS/390:*:*)
-       echo s390-ibm-os390
-       exit 0 ;; 
-    *:OS400:*:* | *:OS/400:*:*) 
-       echo as400-ibm-os400
-       exit 0 ;;
-    *:OS/2:*:*)
-       echo &quot;i386-pc-os2_emx&quot;
-       exit 0;;
-#
-# end Apache changes
-#########################
+	exit ;;
     *:OS/390:*:*)
 	echo i370-ibm-openedition
-	exit 0 ;;
+	exit ;;
+    *:z/VM:*:*)
+	echo s390-ibm-zvmoe
+	exit ;;
+    *:OS400:*:*)
+        echo powerpc-ibm-os400
+	exit ;;
     arm:RISC*:1.[012]*:*|arm:riscix:1.[012]*:*)
 	echo arm-acorn-riscix${UNAME_RELEASE}
-	exit 0;;
+	exit ;;
+    arm:riscos:*:*|arm:RISCOS:*:*)
+	echo arm-unknown-riscos
+	exit ;;
     SR2?01:HI-UX/MPP:*:* | SR8000:HI-UX/MPP:*:*)
 	echo hppa1.1-hitachi-hiuxmpp
-	exit 0;;
+	exit ;;
     Pyramid*:OSx*:*:* | MIS*:OSx*:*:* | MIS*:SMP_DC-OSx*:*:*)
 	# <A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">akee at wpdis03.wpafb.af.mil</A> (Earle F. Ake) contributed MIS and NILE.
 	if test &quot;`(/bin/universe) 2&gt;/dev/null`&quot; = att ; then
@@ -332,25 +314,51 @@ EOF
 	else
 		echo pyramid-pyramid-bsd
 	fi
-	exit 0 ;;
+	exit ;;
     NILE*:*:*:dcosx)
 	echo pyramid-pyramid-svr4
-	exit 0 ;;
+	exit ;;
+    DRS?6000:unix:4.0:6*)
+	echo sparc-icl-nx6
+	exit ;;
+    DRS?6000:UNIX_SV:4.2*:7* | DRS?6000:isis:4.2*:7*)
+	case `/usr/bin/uname -p` in
+	    sparc) echo sparc-icl-nx7; exit ;;
+	esac ;;
+    s390x:SunOS:*:*)
+	echo ${UNAME_MACHINE}-ibm-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
+	exit ;;
     sun4H:SunOS:5.*:*)
 	echo sparc-hal-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
-	exit 0 ;;
+	exit ;;
     sun4*:SunOS:5.*:* | tadpole*:SunOS:5.*:*)
 	echo sparc-sun-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
-	exit 0 ;;
-    i86pc:SunOS:5.*:*)
-	echo i386-pc-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
-	exit 0 ;;
+	exit ;;
+    i86pc:AuroraUX:5.*:* | i86xen:AuroraUX:5.*:*)
+	echo i386-pc-auroraux${UNAME_RELEASE}
+	exit ;;
+    i86pc:SunOS:5.*:* | i86xen:SunOS:5.*:*)
+	eval $set_cc_for_build
+	SUN_ARCH=&quot;i386&quot;
+	# If there is a compiler, see if it is configured for 64-bit objects.
+	# Note that the Sun cc does not turn __LP64__ into 1 like gcc does.
+	# This test works for both compilers.
+	if [ &quot;$CC_FOR_BUILD&quot; != 'no_compiler_found' ]; then
+	    if (echo '#ifdef __amd64'; echo IS_64BIT_ARCH; echo '#endif') | \
+		(CCOPTS= $CC_FOR_BUILD -E - 2&gt;/dev/null) | \
+		grep IS_64BIT_ARCH &gt;/dev/null
+	    then
+		SUN_ARCH=&quot;x86_64&quot;
+	    fi
+	fi
+	echo ${SUN_ARCH}-pc-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
+	exit ;;
     sun4*:SunOS:6*:*)
 	# According to config.sub, this is the proper way to canonicalize
 	# SunOS6.  Hard to guess exactly what SunOS6 will be like, but
 	# it's likely to be more like Solaris than SunOS4.
 	echo sparc-sun-solaris3`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
-	exit 0 ;;
+	exit ;;
     sun4*:SunOS:*:*)
 	case &quot;`/usr/bin/arch -k`&quot; in
 	    Series*|S4*)
@@ -359,10 +367,10 @@ EOF
 	esac
 	# Japanese Language versions have a version number like `4.1.3-JL'.
 	echo sparc-sun-sunos`echo ${UNAME_RELEASE}|sed -e 's/-/_/'`
-	exit 0 ;;
+	exit ;;
     sun3*:SunOS:*:*)
 	echo m68k-sun-sunos${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     sun*:*:4.2BSD:*)
 	UNAME_RELEASE=`(sed 1q /etc/motd | awk '{print substr($5,1,3)}') 2&gt;/dev/null`
 	test &quot;x${UNAME_RELEASE}&quot; = &quot;x&quot; &amp;&amp; UNAME_RELEASE=3
@@ -374,10 +382,10 @@ EOF
 		echo sparc-sun-sunos${UNAME_RELEASE}
 		;;
 	esac
-	exit 0 ;;
+	exit ;;
     aushp:SunOS:*:*)
 	echo sparc-auspex-sunos${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     # The situation for MiNT is a little confusing.  The machine name
     # can be virtually everything (everything which is not
     # &quot;atarist&quot; or &quot;atariste&quot; at least should have a processor
@@ -388,37 +396,40 @@ EOF
     # be no problem.
     atarist[e]:*MiNT:*:* | atarist[e]:*mint:*:* | atarist[e]:*TOS:*:*)
         echo m68k-atari-mint${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     atari*:*MiNT:*:* | atari*:*mint:*:* | atarist[e]:*TOS:*:*)
 	echo m68k-atari-mint${UNAME_RELEASE}
-        exit 0 ;;
+        exit ;;
     *falcon*:*MiNT:*:* | *falcon*:*mint:*:* | *falcon*:*TOS:*:*)
         echo m68k-atari-mint${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     milan*:*MiNT:*:* | milan*:*mint:*:* | *milan*:*TOS:*:*)
         echo m68k-milan-mint${UNAME_RELEASE}
-        exit 0 ;;
+        exit ;;
     hades*:*MiNT:*:* | hades*:*mint:*:* | *hades*:*TOS:*:*)
         echo m68k-hades-mint${UNAME_RELEASE}
-        exit 0 ;;
+        exit ;;
     *:*MiNT:*:* | *:*mint:*:* | *:*TOS:*:*)
         echo m68k-unknown-mint${UNAME_RELEASE}
-        exit 0 ;;
+        exit ;;
+    m68k:machten:*:*)
+	echo m68k-apple-machten${UNAME_RELEASE}
+	exit ;;
     powerpc:machten:*:*)
 	echo powerpc-apple-machten${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     RISC*:Mach:*:*)
 	echo mips-dec-mach_bsd4.3
-	exit 0 ;;
+	exit ;;
     RISC*:ULTRIX:*:*)
 	echo mips-dec-ultrix${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     VAX*:ULTRIX*:*:*)
 	echo vax-dec-ultrix${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     2020:CLIX:*:* | 2430:CLIX:*:*)
 	echo clipper-intergraph-clix${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     mips:*:*:UMIPS | mips:*:*:RISCos)
 	eval $set_cc_for_build
 	sed 's/^	//' &lt;&lt; EOF &gt;$dummy.c
@@ -442,27 +453,33 @@ EOF
 	  exit (-1);
 	}
 EOF
-	$CC_FOR_BUILD $dummy.c -o $dummy \
-	  &amp;&amp; ./$dummy `echo &quot;${UNAME_RELEASE}&quot; | sed -n 's/\([0-9]*\).*/\1/p'` \
-	  &amp;&amp; rm -f $dummy.c $dummy &amp;&amp; exit 0
-	rm -f $dummy.c $dummy
+	$CC_FOR_BUILD -o $dummy $dummy.c &amp;&amp;
+	  dummyarg=`echo &quot;${UNAME_RELEASE}&quot; | sed -n 's/\([0-9]*\).*/\1/p'` &amp;&amp;
+	  SYSTEM_NAME=`$dummy $dummyarg` &amp;&amp;
+	    { echo &quot;$SYSTEM_NAME&quot;; exit; }
 	echo mips-mips-riscos${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     Motorola:PowerMAX_OS:*:*)
 	echo powerpc-motorola-powermax
-	exit 0 ;;
+	exit ;;
+    Motorola:*:4.3:PL8-*)
+	echo powerpc-harris-powermax
+	exit ;;
+    Night_Hawk:*:*:PowerMAX_OS | Synergy:PowerMAX_OS:*:*)
+	echo powerpc-harris-powermax
+	exit ;;
     Night_Hawk:Power_UNIX:*:*)
 	echo powerpc-harris-powerunix
-	exit 0 ;;
+	exit ;;
     m88k:CX/UX:7*:*)
 	echo m88k-harris-cxux7
-	exit 0 ;;
+	exit ;;
     m88k:*:4*:R4*)
 	echo m88k-motorola-sysv4
-	exit 0 ;;
+	exit ;;
     m88k:*:3*:R3*)
 	echo m88k-motorola-sysv3
-	exit 0 ;;
+	exit ;;
     AViiON:dgux:*:*)
         # DG/UX returns AViiON for all architectures
         UNAME_PROCESSOR=`/usr/bin/uname -p`
@@ -478,29 +495,29 @@ EOF
 	else
 	    echo i586-dg-dgux${UNAME_RELEASE}
 	fi
- 	exit 0 ;;
+ 	exit ;;
     M88*:DolphinOS:*:*)	# DolphinOS (SVR3)
 	echo m88k-dolphin-sysv3
-	exit 0 ;;
+	exit ;;
     M88*:*:R3*:*)
 	# Delta 88k system running SVR3
 	echo m88k-motorola-sysv3
-	exit 0 ;;
+	exit ;;
     XD88*:*:*:*) # Tektronix XD88 system running UTekV (SVR3)
 	echo m88k-tektronix-sysv3
-	exit 0 ;;
+	exit ;;
     Tek43[0-9][0-9]:UTek:*:*) # Tektronix 4300 system running UTek (BSD)
 	echo m68k-tektronix-bsd
-	exit 0 ;;
+	exit ;;
     *:IRIX*:*:*)
 	echo mips-sgi-irix`echo ${UNAME_RELEASE}|sed -e 's/-/_/g'`
-	exit 0 ;;
+	exit ;;
     ????????:AIX?:[12].1:2)   # AIX 2.2.1 or AIX 2.1.1 is RT/PC AIX.
-	echo romp-ibm-aix      # uname -m gives an 8 hex-code CPU id
-	exit 0 ;;              # Note that: echo &quot;'`uname -s`'&quot; gives 'AIX '
+	echo romp-ibm-aix     # uname -m gives an 8 hex-code CPU id
+	exit ;;               # Note that: echo &quot;'`uname -s`'&quot; gives 'AIX '
     i*86:AIX:*:*)
 	echo i386-ibm-aix
-	exit 0 ;;
+	exit ;;
     ia64:AIX:*:*)
 	if [ -x /usr/bin/oslevel ] ; then
 		IBM_REV=`/usr/bin/oslevel`
@@ -508,7 +525,7 @@ EOF
 		IBM_REV=${UNAME_VERSION}.${UNAME_RELEASE}
 	fi
 	echo ${UNAME_MACHINE}-ibm-aix${IBM_REV}
-	exit 0 ;;
+	exit ;;
     *:AIX:2:3)
 	if grep bos325 /usr/include/stdio.h &gt;/dev/null 2&gt;&amp;1; then
 		eval $set_cc_for_build
@@ -523,16 +540,19 @@ EOF
 			exit(0);
 			}
 EOF
-		$CC_FOR_BUILD $dummy.c -o $dummy &amp;&amp; ./$dummy &amp;&amp; rm -f $dummy.c $dummy &amp;&amp; exit 0
-		rm -f $dummy.c $dummy
-		echo rs6000-ibm-aix3.2.5
+		if $CC_FOR_BUILD -o $dummy $dummy.c &amp;&amp; SYSTEM_NAME=`$dummy`
+		then
+			echo &quot;$SYSTEM_NAME&quot;
+		else
+			echo rs6000-ibm-aix3.2.5
+		fi
 	elif grep bos324 /usr/include/stdio.h &gt;/dev/null 2&gt;&amp;1; then
 		echo rs6000-ibm-aix3.2.4
 	else
 		echo rs6000-ibm-aix3.2
 	fi
-	exit 0 ;;
-    *:AIX:*:[45])
+	exit ;;
+    *:AIX:*:[456])
 	IBM_CPU_ID=`/usr/sbin/lsdev -C -c processor -S available | sed 1q | awk '{ print $1 }'`
 	if /usr/sbin/lsattr -El ${IBM_CPU_ID} | grep ' POWER' &gt;/dev/null 2&gt;&amp;1; then
 		IBM_ARCH=rs6000
@@ -545,28 +565,28 @@ EOF
 		IBM_REV=${UNAME_VERSION}.${UNAME_RELEASE}
 	fi
 	echo ${IBM_ARCH}-ibm-aix${IBM_REV}
-	exit 0 ;;
+	exit ;;
     *:AIX:*:*)
 	echo rs6000-ibm-aix
-	exit 0 ;;
+	exit ;;
     ibmrt:4.4BSD:*|romp-ibm:BSD:*)
 	echo romp-ibm-bsd4.4
-	exit 0 ;;
+	exit ;;
     ibmrt:*BSD:*|romp-ibm:BSD:*)            # covers RT/PC BSD and
 	echo romp-ibm-bsd${UNAME_RELEASE}   # 4.3 with uname added to
-	exit 0 ;;                           # report: romp-ibm BSD 4.3
+	exit ;;                             # report: romp-ibm BSD 4.3
     *:BOSX:*:*)
 	echo rs6000-bull-bosx
-	exit 0 ;;
+	exit ;;
     DPX/2?00:B.O.S.:*:*)
 	echo m68k-bull-sysv3
-	exit 0 ;;
+	exit ;;
     9000/[34]??:4.3bsd:1.*:*)
 	echo m68k-hp-bsd
-	exit 0 ;;
+	exit ;;
     hp300:4.4BSD:*:* | 9000/[34]??:4.3bsd:2.*:*)
 	echo m68k-hp-bsd4.4
-	exit 0 ;;
+	exit ;;
     9000/[34678]??:HP-UX:*:*)
 	HPUX_REV=`echo ${UNAME_RELEASE}|sed -e 's/[^.]*.[0B]*//'`
 	case &quot;${UNAME_MACHINE}&quot; in
@@ -622,17 +642,37 @@ EOF
                   exit (0);
               }
 EOF
-		    (CCOPTS= $CC_FOR_BUILD $dummy.c -o $dummy 2&gt;/dev/null) &amp;&amp; HP_ARCH=`./$dummy`
-		    if test -z &quot;$HP_ARCH&quot;; then HP_ARCH=hppa; fi
-		    rm -f $dummy.c $dummy
+		    (CCOPTS= $CC_FOR_BUILD -o $dummy $dummy.c 2&gt;/dev/null) &amp;&amp; HP_ARCH=`$dummy`
+		    test -z &quot;$HP_ARCH&quot; &amp;&amp; HP_ARCH=hppa
 		fi ;;
 	esac
+	if [ ${HP_ARCH} = &quot;hppa2.0w&quot; ]
+	then
+	    eval $set_cc_for_build
+
+	    # hppa2.0w-hp-hpux* has a 64-bit kernel and a compiler generating
+	    # 32-bit code.  hppa64-hp-hpux* has the same kernel and a compiler
+	    # generating 64-bit code.  GNU and HP use different nomenclature:
+	    #
+	    # $ CC_FOR_BUILD=cc ./config.guess
+	    # =&gt; hppa2.0w-hp-hpux11.23
+	    # $ CC_FOR_BUILD=&quot;cc +DA2.0w&quot; ./config.guess
+	    # =&gt; hppa64-hp-hpux11.23
+
+	    if echo __LP64__ | (CCOPTS= $CC_FOR_BUILD -E - 2&gt;/dev/null) |
+		grep -q __LP64__
+	    then
+		HP_ARCH=&quot;hppa2.0w&quot;
+	    else
+		HP_ARCH=&quot;hppa64&quot;
+	    fi
+	fi
 	echo ${HP_ARCH}-hp-hpux${HPUX_REV}
-	exit 0 ;;
+	exit ;;
     ia64:HP-UX:*:*)
 	HPUX_REV=`echo ${UNAME_RELEASE}|sed -e 's/[^.]*.[0B]*//'`
 	echo ia64-hp-hpux${HPUX_REV}
-	exit 0 ;;
+	exit ;;
     3050*:HI-UX:*:*)
 	eval $set_cc_for_build
 	sed 's/^	//' &lt;&lt; EOF &gt;$dummy.c
@@ -660,174 +700,248 @@ EOF
 	  exit (0);
 	}
 EOF
-	$CC_FOR_BUILD $dummy.c -o $dummy &amp;&amp; ./$dummy &amp;&amp; rm -f $dummy.c $dummy &amp;&amp; exit 0
-	rm -f $dummy.c $dummy
+	$CC_FOR_BUILD -o $dummy $dummy.c &amp;&amp; SYSTEM_NAME=`$dummy` &amp;&amp;
+		{ echo &quot;$SYSTEM_NAME&quot;; exit; }
 	echo unknown-hitachi-hiuxwe2
-	exit 0 ;;
+	exit ;;
     9000/7??:4.3bsd:*:* | 9000/8?[79]:4.3bsd:*:* )
 	echo hppa1.1-hp-bsd
-	exit 0 ;;
+	exit ;;
     9000/8??:4.3bsd:*:*)
 	echo hppa1.0-hp-bsd
-	exit 0 ;;
+	exit ;;
     *9??*:MPE/iX:*:* | *3000*:MPE/iX:*:*)
 	echo hppa1.0-hp-mpeix
-	exit 0 ;;
+	exit ;;
     hp7??:OSF1:*:* | hp8?[79]:OSF1:*:* )
 	echo hppa1.1-hp-osf
-	exit 0 ;;
+	exit ;;
     hp8??:OSF1:*:*)
 	echo hppa1.0-hp-osf
-	exit 0 ;;
+	exit ;;
     i*86:OSF1:*:*)
 	if [ -x /usr/sbin/sysversion ] ; then
 	    echo ${UNAME_MACHINE}-unknown-osf1mk
 	else
 	    echo ${UNAME_MACHINE}-unknown-osf1
 	fi
-	exit 0 ;;
+	exit ;;
     parisc*:Lites*:*:*)
 	echo hppa1.1-hp-lites
-	exit 0 ;;
+	exit ;;
     C1*:ConvexOS:*:* | convex:ConvexOS:C1*:*)
 	echo c1-convex-bsd
-        exit 0 ;;
+        exit ;;
     C2*:ConvexOS:*:* | convex:ConvexOS:C2*:*)
 	if getsysinfo -f scalar_acc
 	then echo c32-convex-bsd
 	else echo c2-convex-bsd
 	fi
-        exit 0 ;;
+        exit ;;
     C34*:ConvexOS:*:* | convex:ConvexOS:C34*:*)
 	echo c34-convex-bsd
-        exit 0 ;;
+        exit ;;
     C38*:ConvexOS:*:* | convex:ConvexOS:C38*:*)
 	echo c38-convex-bsd
-        exit 0 ;;
+        exit ;;
     C4*:ConvexOS:*:* | convex:ConvexOS:C4*:*)
 	echo c4-convex-bsd
-        exit 0 ;;
+        exit ;;
     CRAY*Y-MP:*:*:*)
 	echo ymp-cray-unicos${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
-	exit 0 ;;
+	exit ;;
     CRAY*[A-Z]90:*:*:*)
 	echo ${UNAME_MACHINE}-cray-unicos${UNAME_RELEASE} \
 	| sed -e 's/CRAY.*\([A-Z]90\)/\1/' \
 	      -e y/ABCDEFGHIJKLMNOPQRSTUVWXYZ/abcdefghijklmnopqrstuvwxyz/ \
 	      -e 's/\.[^.]*$/.X/'
-	exit 0 ;;
+	exit ;;
     CRAY*TS:*:*:*)
 	echo t90-cray-unicos${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
-	exit 0 ;;
-    CRAY*T3D:*:*:*)
-	echo alpha-cray-unicosmk${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
-	exit 0 ;;
+	exit ;;
     CRAY*T3E:*:*:*)
 	echo alphaev5-cray-unicosmk${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
-	exit 0 ;;
+	exit ;;
     CRAY*SV1:*:*:*)
 	echo sv1-cray-unicos${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
-	exit 0 ;;
+	exit ;;
+    *:UNICOS/mp:*:*)
+	echo craynv-cray-unicosmp${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
+	exit ;;
     F30[01]:UNIX_System_V:*:* | F700:UNIX_System_V:*:*)
 	FUJITSU_PROC=`uname -m | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz'`
         FUJITSU_SYS=`uname -p | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/\///'`
         FUJITSU_REL=`echo ${UNAME_RELEASE} | sed -e 's/ /_/'`
         echo &quot;${FUJITSU_PROC}-fujitsu-${FUJITSU_SYS}${FUJITSU_REL}&quot;
-        exit 0 ;;
+        exit ;;
+    5000:UNIX_System_V:4.*:*)
+        FUJITSU_SYS=`uname -p | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/\///'`
+        FUJITSU_REL=`echo ${UNAME_RELEASE} | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/ /_/'`
+        echo &quot;sparc-fujitsu-${FUJITSU_SYS}${FUJITSU_REL}&quot;
+	exit ;;
     i*86:BSD/386:*:* | i*86:BSD/OS:*:* | *:Ascend\ Embedded/OS:*:*)
 	echo ${UNAME_MACHINE}-pc-bsdi${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     sparc*:BSD/OS:*:*)
 	echo sparc-unknown-bsdi${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     *:BSD/OS:*:*)
 	echo ${UNAME_MACHINE}-unknown-bsdi${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     *:FreeBSD:*:*)
-	echo ${UNAME_MACHINE}-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'`
-	exit 0 ;;
+	case ${UNAME_MACHINE} in
+	    pc98)
+		echo i386-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'` ;;
+	    amd64)
+		echo x86_64-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'` ;;
+	    *)
+		echo ${UNAME_MACHINE}-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'` ;;
+	esac
+	exit ;;
     i*:CYGWIN*:*)
 	echo ${UNAME_MACHINE}-pc-cygwin
-	exit 0 ;;
-    i*:MINGW*:*)
+	exit ;;
+    *:MINGW*:*)
 	echo ${UNAME_MACHINE}-pc-mingw32
-	exit 0 ;;
+	exit ;;
+    i*:windows32*:*)
+    	# uname -m includes &quot;-pc&quot; on this system.
+    	echo ${UNAME_MACHINE}-mingw32
+	exit ;;
     i*:PW*:*)
 	echo ${UNAME_MACHINE}-pc-pw32
-	exit 0 ;;
-    x86:Interix*:3*)
-	echo i386-pc-interix3
-	exit 0 ;;
+	exit ;;
+    *:Interix*:*)
+    	case ${UNAME_MACHINE} in
+	    x86)
+		echo i586-pc-interix${UNAME_RELEASE}
+		exit ;;
+	    authenticamd | genuineintel | EM64T)
+		echo x86_64-unknown-interix${UNAME_RELEASE}
+		exit ;;
+	    IA64)
+		echo ia64-unknown-interix${UNAME_RELEASE}
+		exit ;;
+	esac ;;
+    [345]86:Windows_95:* | [345]86:Windows_98:* | [345]86:Windows_NT:*)
+	echo i${UNAME_MACHINE}-pc-mks
+	exit ;;
+    8664:Windows_NT:*)
+	echo x86_64-pc-mks
+	exit ;;
     i*:Windows_NT*:* | Pentium*:Windows_NT*:*)
 	# How do we know it's Interix rather than the generic POSIX subsystem?
 	# It also conflicts with pre-2.0 versions of AT&amp;T UWIN. Should we
 	# UNAME_MACHINE based on the output of uname instead of i386?
-	echo i386-pc-interix
-	exit 0 ;;
+	echo i586-pc-interix
+	exit ;;
     i*:UWIN*:*)
 	echo ${UNAME_MACHINE}-pc-uwin
-	exit 0 ;;
+	exit ;;
+    amd64:CYGWIN*:*:* | x86_64:CYGWIN*:*:*)
+	echo x86_64-unknown-cygwin
+	exit ;;
     p*:CYGWIN*:*)
 	echo powerpcle-unknown-cygwin
-	exit 0 ;;
+	exit ;;
     prep*:SunOS:5.*:*)
 	echo powerpcle-unknown-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
-	exit 0 ;;
+	exit ;;
     *:GNU:*:*)
+	# the GNU system
 	echo `echo ${UNAME_MACHINE}|sed -e 's,[-/].*$,,'`-unknown-gnu`echo ${UNAME_RELEASE}|sed -e 's,/.*$,,'`
-	exit 0 ;;
+	exit ;;
+    *:GNU/*:*:*)
+	# other systems with GNU libc and userland
+	echo ${UNAME_MACHINE}-unknown-`echo ${UNAME_SYSTEM} | sed 's,^[^/]*/,,' | tr '[A-Z]' '[a-z]'``echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'`-gnu
+	exit ;;
     i*86:Minix:*:*)
 	echo ${UNAME_MACHINE}-pc-minix
-	exit 0 ;;
+	exit ;;
+    alpha:Linux:*:*)
+	case `sed -n '/^cpu model/s/^.*: \(.*\)/\1/p' &lt; /proc/cpuinfo` in
+	  EV5)   UNAME_MACHINE=alphaev5 ;;
+	  EV56)  UNAME_MACHINE=alphaev56 ;;
+	  PCA56) UNAME_MACHINE=alphapca56 ;;
+	  PCA57) UNAME_MACHINE=alphapca56 ;;
+	  EV6)   UNAME_MACHINE=alphaev6 ;;
+	  EV67)  UNAME_MACHINE=alphaev67 ;;
+	  EV68*) UNAME_MACHINE=alphaev68 ;;
+        esac
+	objdump --private-headers /bin/sh | grep -q ld.so.1
+	if test &quot;$?&quot; = 0 ; then LIBC=&quot;libc1&quot; ; else LIBC=&quot;&quot; ; fi
+	echo ${UNAME_MACHINE}-unknown-linux-gnu${LIBC}
+	exit ;;
     arm*:Linux:*:*)
+	eval $set_cc_for_build
+	if echo __ARM_EABI__ | $CC_FOR_BUILD -E - 2&gt;/dev/null \
+	    | grep -q __ARM_EABI__
+	then
+	    echo ${UNAME_MACHINE}-unknown-linux-gnu
+	else
+	    echo ${UNAME_MACHINE}-unknown-linux-gnueabi
+	fi
+	exit ;;
+    avr32*:Linux:*:*)
 	echo ${UNAME_MACHINE}-unknown-linux-gnu
-	exit 0 ;;
+	exit ;;
+    cris:Linux:*:*)
+	echo cris-axis-linux-gnu
+	exit ;;
+    crisv32:Linux:*:*)
+	echo crisv32-axis-linux-gnu
+	exit ;;
+    frv:Linux:*:*)
+    	echo frv-unknown-linux-gnu
+	exit ;;
+    i*86:Linux:*:*)
+	LIBC=gnu
+	eval $set_cc_for_build
+	sed 's/^	//' &lt;&lt; EOF &gt;$dummy.c
+	#ifdef __dietlibc__
+	LIBC=dietlibc
+	#endif
+EOF
+	eval `$CC_FOR_BUILD -E $dummy.c 2&gt;/dev/null | grep '^LIBC'`
+	echo &quot;${UNAME_MACHINE}-pc-linux-${LIBC}&quot;
+	exit ;;
     ia64:Linux:*:*)
 	echo ${UNAME_MACHINE}-unknown-linux-gnu
-	exit 0 ;;
+	exit ;;
+    m32r*:Linux:*:*)
+	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	exit ;;
     m68*:Linux:*:*)
 	echo ${UNAME_MACHINE}-unknown-linux-gnu
-	exit 0 ;;
-    mips:Linux:*:*)
+	exit ;;
+    mips:Linux:*:* | mips64:Linux:*:*)
 	eval $set_cc_for_build
 	sed 's/^	//' &lt;&lt; EOF &gt;$dummy.c
 	#undef CPU
-	#undef mips
-	#undef mipsel
+	#undef ${UNAME_MACHINE}
+	#undef ${UNAME_MACHINE}el
 	#if defined(__MIPSEL__) || defined(__MIPSEL) || defined(_MIPSEL) || defined(MIPSEL)
-	CPU=mipsel
+	CPU=${UNAME_MACHINE}el
 	#else
 	#if defined(__MIPSEB__) || defined(__MIPSEB) || defined(_MIPSEB) || defined(MIPSEB)
-	CPU=mips
+	CPU=${UNAME_MACHINE}
 	#else
 	CPU=
 	#endif
 	#endif
 EOF
-	eval `$CC_FOR_BUILD -E $dummy.c 2&gt;/dev/null | grep ^CPU=`
-	rm -f $dummy.c
-	test x&quot;${CPU}&quot; != x &amp;&amp; echo &quot;${CPU}-pc-linux-gnu&quot; &amp;&amp; exit 0
+	eval `$CC_FOR_BUILD -E $dummy.c 2&gt;/dev/null | grep '^CPU'`
+	test x&quot;${CPU}&quot; != x &amp;&amp; { echo &quot;${CPU}-unknown-linux-gnu&quot;; exit; }
 	;;
-    ppc:Linux:*:*)
-	echo powerpc-unknown-linux-gnu
-	exit 0 ;;
-    ppc64:Linux:*:*)
-	echo powerpc64-unknown-linux-gnu
-	exit 0 ;;
-    alpha:Linux:*:*)
-	case `sed -n '/^cpu model/s/^.*: \(.*\)/\1/p' &lt; /proc/cpuinfo` in
-	  EV5)   UNAME_MACHINE=alphaev5 ;;
-	  EV56)  UNAME_MACHINE=alphaev56 ;;
-	  PCA56) UNAME_MACHINE=alphapca56 ;;
-	  PCA57) UNAME_MACHINE=alphapca56 ;;
-	  EV6)   UNAME_MACHINE=alphaev6 ;;
-	  EV67)  UNAME_MACHINE=alphaev67 ;;
-	  EV68*) UNAME_MACHINE=alphaev68 ;;
-        esac
-	objdump --private-headers /bin/sh | grep ld.so.1 &gt;/dev/null
-	if test &quot;$?&quot; = 0 ; then LIBC=&quot;libc1&quot; ; else LIBC=&quot;&quot; ; fi
-	echo ${UNAME_MACHINE}-unknown-linux-gnu${LIBC}
-	exit 0 ;;
+    or32:Linux:*:*)
+	echo or32-unknown-linux-gnu
+	exit ;;
+    padre:Linux:*:*)
+	echo sparc-unknown-linux-gnu
+	exit ;;
+    parisc64:Linux:*:* | hppa64:Linux:*:*)
+	echo hppa64-unknown-linux-gnu
+	exit ;;
     parisc:Linux:*:* | hppa:Linux:*:*)
 	# Look for CPU level
 	case `grep '^cpu[^a-z]*:' /proc/cpuinfo 2&gt;/dev/null | cut -d' ' -f2` in
@@ -835,82 +949,40 @@ EOF
 	  PA8*) echo hppa2.0-unknown-linux-gnu ;;
 	  *)    echo hppa-unknown-linux-gnu ;;
 	esac
-	exit 0 ;;
-    parisc64:Linux:*:* | hppa64:Linux:*:*)
-	echo hppa64-unknown-linux-gnu
-	exit 0 ;;
+	exit ;;
+    ppc64:Linux:*:*)
+	echo powerpc64-unknown-linux-gnu
+	exit ;;
+    ppc:Linux:*:*)
+	echo powerpc-unknown-linux-gnu
+	exit ;;
     s390:Linux:*:* | s390x:Linux:*:*)
 	echo ${UNAME_MACHINE}-ibm-linux
-	exit 0 ;;
+	exit ;;
+    sh64*:Linux:*:*)
+    	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	exit ;;
     sh*:Linux:*:*)
 	echo ${UNAME_MACHINE}-unknown-linux-gnu
-	exit 0 ;;
+	exit ;;
     sparc:Linux:*:* | sparc64:Linux:*:*)
 	echo ${UNAME_MACHINE}-unknown-linux-gnu
-	exit 0 ;;
+	exit ;;
+    vax:Linux:*:*)
+	echo ${UNAME_MACHINE}-dec-linux-gnu
+	exit ;;
     x86_64:Linux:*:*)
 	echo x86_64-unknown-linux-gnu
-	exit 0 ;;
-    i*86:Linux:*:*)
-	# The BFD linker knows what the default object file format is, so
-	# first see if it will tell us. cd to the root directory to prevent
-	# problems with other programs or directories called `ld' in the path.
-	# Set LC_ALL=C to ensure ld outputs messages in English.
-	ld_supported_targets=`cd /; LC_ALL=C ld --help 2&gt;&amp;1 \
-			 | sed -ne '/supported targets:/!d
-				    s/[ 	][ 	]*/ /g
-				    s/.*supported targets: *//
-				    s/ .*//
-				    p'`
-        case &quot;$ld_supported_targets&quot; in
-	  elf32-i386)
-		TENTATIVE=&quot;${UNAME_MACHINE}-pc-linux-gnu&quot;
-		;;
-	  a.out-i386-linux)
-		echo &quot;${UNAME_MACHINE}-pc-linux-gnuaout&quot;
-		exit 0 ;;		
-	  coff-i386)
-		echo &quot;${UNAME_MACHINE}-pc-linux-gnucoff&quot;
-		exit 0 ;;
-	  &quot;&quot;)
-		# Either a pre-BFD a.out linker (linux-gnuoldld) or
-		# one that does not give us useful --help.
-		echo &quot;${UNAME_MACHINE}-pc-linux-gnuoldld&quot;
-		exit 0 ;;
-	esac
-	# Determine whether the default compiler is a.out or elf
-	eval $set_cc_for_build
-	sed 's/^	//' &lt;&lt; EOF &gt;$dummy.c
-	#include &lt;features.h&gt;
-	#ifdef __ELF__
-	# ifdef __GLIBC__
-	#  if __GLIBC__ &gt;= 2
-	LIBC=gnu
-	#  else
-	LIBC=gnulibc1
-	#  endif
-	# else
-	LIBC=gnulibc1
-	# endif
-	#else
-	#ifdef __INTEL_COMPILER
-	LIBC=gnu
-	#else
-	LIBC=gnuaout
-	#endif
-	#endif
-EOF
-	eval `$CC_FOR_BUILD -E $dummy.c 2&gt;/dev/null | grep ^LIBC=`
-	rm -f $dummy.c
-	test x&quot;${LIBC}&quot; != x &amp;&amp; echo &quot;${UNAME_MACHINE}-pc-linux-${LIBC}&quot; &amp;&amp; exit 0
-	test x&quot;${TENTATIVE}&quot; != x &amp;&amp; echo &quot;${TENTATIVE}&quot; &amp;&amp; exit 0
-	;;
+	exit ;;
+    xtensa*:Linux:*:*)
+    	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	exit ;;
     i*86:DYNIX/ptx:4*:*)
 	# ptx 4.0 does uname -s correctly, with DYNIX/ptx in there.
 	# earlier versions are messed up and put the nodename in both
 	# sysname and nodename.
 	echo i386-sequent-sysv4
-	exit 0 ;;
+	exit ;;
     i*86:UNIX_SV:4.2MP:2.*)
         # Unixware is an offshoot of SVR4, but it has its own version
         # number series starting with 2...
@@ -918,7 +990,27 @@ EOF
 	# I just have to hope.  -- rms.
         # Use sysv4.2uw... so that sysv4* matches it.
 	echo ${UNAME_MACHINE}-pc-sysv4.2uw${UNAME_VERSION}
-	exit 0 ;;
+	exit ;;
+    i*86:OS/2:*:*)
+	# If we were able to find `uname', then EMX Unix compatibility
+	# is probably installed.
+	echo ${UNAME_MACHINE}-pc-os2-emx
+	exit ;;
+    i*86:XTS-300:*:STOP)
+	echo ${UNAME_MACHINE}-unknown-stop
+	exit ;;
+    i*86:atheos:*:*)
+	echo ${UNAME_MACHINE}-unknown-atheos
+	exit ;;
+    i*86:syllable:*:*)
+	echo ${UNAME_MACHINE}-pc-syllable
+	exit ;;
+    i*86:LynxOS:2.*:* | i*86:LynxOS:3.[01]*:* | i*86:LynxOS:4.[02]*:*)
+	echo i386-unknown-lynxos${UNAME_RELEASE}
+	exit ;;
+    i*86:*DOS:*:*)
+	echo ${UNAME_MACHINE}-pc-msdosdjgpp
+	exit ;;
     i*86:*:4.*:* | i*86:SYSTEM_V:4.*:*)
 	UNAME_REL=`echo ${UNAME_RELEASE} | sed 's/\/MP$//'`
 	if grep Novell /usr/include/link.h &gt;/dev/null 2&gt;/dev/null; then
@@ -926,99 +1018,113 @@ EOF
 	else
 		echo ${UNAME_MACHINE}-pc-sysv${UNAME_REL}
 	fi
-	exit 0 ;;
-    i*86:*:5:[78]*)
+	exit ;;
+    i*86:*:5:[678]*)
+    	# UnixWare 7.x, OpenUNIX and OpenServer 6.
 	case `/bin/uname -X | grep &quot;^Machine&quot;` in
 	    *486*)	     UNAME_MACHINE=i486 ;;
 	    *Pentium)	     UNAME_MACHINE=i586 ;;
 	    *Pent*|*Celeron) UNAME_MACHINE=i686 ;;
 	esac
 	echo ${UNAME_MACHINE}-unknown-sysv${UNAME_RELEASE}${UNAME_SYSTEM}${UNAME_VERSION}
-	exit 0 ;;
+	exit ;;
     i*86:*:3.2:*)
 	if test -f /usr/options/cb.name; then
 		UNAME_REL=`sed -n 's/.*Version //p' &lt;/usr/options/cb.name`
 		echo ${UNAME_MACHINE}-pc-isc$UNAME_REL
 	elif /bin/uname -X 2&gt;/dev/null &gt;/dev/null ; then
-		UNAME_REL=`(/bin/uname -X|egrep Release|sed -e 's/.*= //')`
-		(/bin/uname -X|egrep i80486 &gt;/dev/null) &amp;&amp; UNAME_MACHINE=i486
-		(/bin/uname -X|egrep '^Machine.*Pentium' &gt;/dev/null) \
+		UNAME_REL=`(/bin/uname -X|grep Release|sed -e 's/.*= //')`
+		(/bin/uname -X|grep i80486 &gt;/dev/null) &amp;&amp; UNAME_MACHINE=i486
+		(/bin/uname -X|grep '^Machine.*Pentium' &gt;/dev/null) \
 			&amp;&amp; UNAME_MACHINE=i586
-		(/bin/uname -X|egrep '^Machine.*Pent ?II' &gt;/dev/null) \
+		(/bin/uname -X|grep '^Machine.*Pent *II' &gt;/dev/null) \
 			&amp;&amp; UNAME_MACHINE=i686
-		(/bin/uname -X|egrep '^Machine.*Pentium Pro' &gt;/dev/null) \
+		(/bin/uname -X|grep '^Machine.*Pentium Pro' &gt;/dev/null) \
 			&amp;&amp; UNAME_MACHINE=i686
 		echo ${UNAME_MACHINE}-pc-sco$UNAME_REL
 	else
 		echo ${UNAME_MACHINE}-pc-sysv32
 	fi
-	exit 0 ;;
-    i*86:*DOS:*:*)
-	echo ${UNAME_MACHINE}-pc-msdosdjgpp
-	exit 0 ;;
+	exit ;;
     pc:*:*:*)
 	# Left here for compatibility:
         # uname -m prints for DJGPP always 'pc', but it prints nothing about
-        # the processor, so we play safe by assuming i386.
-	echo i386-pc-msdosdjgpp
-        exit 0 ;;
+        # the processor, so we play safe by assuming i586.
+	# Note: whatever this is, it MUST be the same as what config.sub
+	# prints for the &quot;djgpp&quot; host, or else GDB configury will decide that
+	# this is a cross-build.
+	echo i586-pc-msdosdjgpp
+        exit ;;
     Intel:Mach:3*:*)
 	echo i386-pc-mach3
-	exit 0 ;;
+	exit ;;
     paragon:*:*:*)
 	echo i860-intel-osf1
-	exit 0 ;;
+	exit ;;
     i860:*:4.*:*) # i860-SVR4
 	if grep Stardent /usr/include/sys/uadmin.h &gt;/dev/null 2&gt;&amp;1 ; then
 	  echo i860-stardent-sysv${UNAME_RELEASE} # Stardent Vistra i860-SVR4
 	else # Add other i860-SVR4 vendors below as they are discovered.
 	  echo i860-unknown-sysv${UNAME_RELEASE}  # Unknown i860-SVR4
 	fi
-	exit 0 ;;
+	exit ;;
     mini*:CTIX:SYS*5:*)
 	# &quot;miniframe&quot;
 	echo m68010-convergent-sysv
-	exit 0 ;;
-    M68*:*:R3V[567]*:*)
-	test -r /sysV68 &amp;&amp; echo 'm68k-motorola-sysv' &amp;&amp; exit 0 ;;
-    3[34]??:*:4.0:3.0 | 3[34]??A:*:4.0:3.0 | 3[34]??,*:*:4.0:3.0 | 3[34]??/*:*:4.0:3.0 | 4850:*:4.0:3.0 | SKA40:*:4.0:3.0)
+	exit ;;
+    mc68k:UNIX:SYSTEM5:3.51m)
+	echo m68k-convergent-sysv
+	exit ;;
+    M680?0:D-NIX:5.3:*)
+	echo m68k-diab-dnix
+	exit ;;
+    M68*:*:R3V[5678]*:*)
+	test -r /sysV68 &amp;&amp; { echo 'm68k-motorola-sysv'; exit; } ;;
+    3[345]??:*:4.0:3.0 | 3[34]??A:*:4.0:3.0 | 3[34]??,*:*:4.0:3.0 | 3[34]??/*:*:4.0:3.0 | 4400:*:4.0:3.0 | 4850:*:4.0:3.0 | SKA40:*:4.0:3.0 | SDS2:*:4.0:3.0 | SHG2:*:4.0:3.0 | S7501*:*:4.0:3.0)
 	OS_REL=''
 	test -r /etc/.relid \
 	&amp;&amp; OS_REL=.`sed -n 's/[^ ]* [^ ]* \([0-9][0-9]\).*/\1/p' &lt; /etc/.relid`
 	/bin/uname -p 2&gt;/dev/null | grep 86 &gt;/dev/null \
-	  &amp;&amp; echo i486-ncr-sysv4.3${OS_REL} &amp;&amp; exit 0
+	  &amp;&amp; { echo i486-ncr-sysv4.3${OS_REL}; exit; }
 	/bin/uname -p 2&gt;/dev/null | /bin/grep entium &gt;/dev/null \
-	  &amp;&amp; echo i586-ncr-sysv4.3${OS_REL} &amp;&amp; exit 0 ;;
+	  &amp;&amp; { echo i586-ncr-sysv4.3${OS_REL}; exit; } ;;
     3[34]??:*:4.0:* | 3[34]??,*:*:4.0:*)
         /bin/uname -p 2&gt;/dev/null | grep 86 &gt;/dev/null \
-          &amp;&amp; echo i486-ncr-sysv4 &amp;&amp; exit 0 ;;
+          &amp;&amp; { echo i486-ncr-sysv4; exit; } ;;
+    NCR*:*:4.2:* | MPRAS*:*:4.2:*)
+	OS_REL='.3'
+	test -r /etc/.relid \
+	    &amp;&amp; OS_REL=.`sed -n 's/[^ ]* [^ ]* \([0-9][0-9]\).*/\1/p' &lt; /etc/.relid`
+	/bin/uname -p 2&gt;/dev/null | grep 86 &gt;/dev/null \
+	    &amp;&amp; { echo i486-ncr-sysv4.3${OS_REL}; exit; }
+	/bin/uname -p 2&gt;/dev/null | /bin/grep entium &gt;/dev/null \
+	    &amp;&amp; { echo i586-ncr-sysv4.3${OS_REL}; exit; }
+	/bin/uname -p 2&gt;/dev/null | /bin/grep pteron &gt;/dev/null \
+	    &amp;&amp; { echo i586-ncr-sysv4.3${OS_REL}; exit; } ;;
     m68*:LynxOS:2.*:* | m68*:LynxOS:3.0*:*)
 	echo m68k-unknown-lynxos${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     mc68030:UNIX_System_V:4.*:*)
 	echo m68k-atari-sysv4
-	exit 0 ;;
-    i*86:LynxOS:2.*:* | i*86:LynxOS:3.[01]*:* | i*86:LynxOS:4.0*:*)
-	echo i386-unknown-lynxos${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     TSUNAMI:LynxOS:2.*:*)
 	echo sparc-unknown-lynxos${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     rs6000:LynxOS:2.*:*)
 	echo rs6000-unknown-lynxos${UNAME_RELEASE}
-	exit 0 ;;
-    PowerPC:LynxOS:2.*:* | PowerPC:LynxOS:3.[01]*:* | PowerPC:LynxOS:4.0*:*)
+	exit ;;
+    PowerPC:LynxOS:2.*:* | PowerPC:LynxOS:3.[01]*:* | PowerPC:LynxOS:4.[02]*:*)
 	echo powerpc-unknown-lynxos${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     SM[BE]S:UNIX_SV:*:*)
 	echo mips-dde-sysv${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     RM*:ReliantUNIX-*:*:*)
 	echo mips-sni-sysv4
-	exit 0 ;;
+	exit ;;
     RM*:SINIX-*:*:*)
 	echo mips-sni-sysv4
-	exit 0 ;;
+	exit ;;
     *:SINIX-*:*:*)
 	if uname -p 2&gt;/dev/null &gt;/dev/null ; then
 		UNAME_MACHINE=`(uname -p) 2&gt;/dev/null`
@@ -1026,61 +1132,94 @@ EOF
 	else
 		echo ns32k-sni-sysv
 	fi
-	exit 0 ;;
+	exit ;;
     PENTIUM:*:4.0*:*) # Unisys `ClearPath HMP IX 4000' SVR4/MP effort
                       # says &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">Richard.M.Bartel at ccMail.Census.GOV</A>&gt;
         echo i586-unisys-sysv4
-        exit 0 ;;
+        exit ;;
     *:UNIX_System_V:4*:FTX*)
 	# From Gerald Hewes &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">hewes at openmarket.com</A>&gt;.
 	# How about differentiating between stratus architectures? -djm
 	echo hppa1.1-stratus-sysv4
-	exit 0 ;;
+	exit ;;
     *:*:*:FTX*)
 	# From <A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">seanf at swdc.stratus.com.</A>
 	echo i860-stratus-sysv4
-	exit 0 ;;
+	exit ;;
+    i*86:VOS:*:*)
+	# From <A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">Paul.Green at stratus.com.</A>
+	echo ${UNAME_MACHINE}-stratus-vos
+	exit ;;
     *:VOS:*:*)
 	# From <A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">Paul.Green at stratus.com.</A>
 	echo hppa1.1-stratus-vos
-	exit 0 ;;
+	exit ;;
     mc68*:A/UX:*:*)
 	echo m68k-apple-aux${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     news*:NEWS-OS:6*:*)
 	echo mips-sony-newsos6
-	exit 0 ;;
+	exit ;;
     R[34]000:*System_V*:*:* | R4000:UNIX_SYSV:*:* | R*000:UNIX_SV:*:*)
 	if [ -d /usr/nec ]; then
 	        echo mips-nec-sysv${UNAME_RELEASE}
 	else
 	        echo mips-unknown-sysv${UNAME_RELEASE}
 	fi
-        exit 0 ;;
+        exit ;;
     BeBox:BeOS:*:*)	# BeOS running on hardware made by Be, PPC only.
 	echo powerpc-be-beos
-	exit 0 ;;
+	exit ;;
     BeMac:BeOS:*:*)	# BeOS running on Mac or Mac clone, PPC only.
 	echo powerpc-apple-beos
-	exit 0 ;;
+	exit ;;
     BePC:BeOS:*:*)	# BeOS running on Intel PC compatible.
 	echo i586-pc-beos
-	exit 0 ;;
+	exit ;;
+    BePC:Haiku:*:*)	# Haiku running on Intel PC compatible.
+	echo i586-pc-haiku
+	exit ;;
     SX-4:SUPER-UX:*:*)
 	echo sx4-nec-superux${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     SX-5:SUPER-UX:*:*)
 	echo sx5-nec-superux${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
+    SX-6:SUPER-UX:*:*)
+	echo sx6-nec-superux${UNAME_RELEASE}
+	exit ;;
+    SX-7:SUPER-UX:*:*)
+	echo sx7-nec-superux${UNAME_RELEASE}
+	exit ;;
+    SX-8:SUPER-UX:*:*)
+	echo sx8-nec-superux${UNAME_RELEASE}
+	exit ;;
+    SX-8R:SUPER-UX:*:*)
+	echo sx8r-nec-superux${UNAME_RELEASE}
+	exit ;;
     Power*:Rhapsody:*:*)
 	echo powerpc-apple-rhapsody${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     *:Rhapsody:*:*)
 	echo ${UNAME_MACHINE}-apple-rhapsody${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     *:Darwin:*:*)
-	echo `uname -p`-apple-darwin${UNAME_RELEASE}
-	exit 0 ;;
+	UNAME_PROCESSOR=`uname -p` || UNAME_PROCESSOR=unknown
+	case $UNAME_PROCESSOR in
+	    i386)
+		eval $set_cc_for_build
+		if [ &quot;$CC_FOR_BUILD&quot; != 'no_compiler_found' ]; then
+		  if (echo '#ifdef __LP64__'; echo IS_64BIT_ARCH; echo '#endif') | \
+		      (CCOPTS= $CC_FOR_BUILD -E - 2&gt;/dev/null) | \
+		      grep IS_64BIT_ARCH &gt;/dev/null
+		  then
+		      UNAME_PROCESSOR=&quot;x86_64&quot;
+		  fi
+		fi ;;
+	    unknown) UNAME_PROCESSOR=powerpc ;;
+	esac
+	echo ${UNAME_PROCESSOR}-apple-darwin${UNAME_RELEASE}
+	exit ;;
     *:procnto*:*:* | *:QNX:[0123456789]*:*)
 	UNAME_PROCESSOR=`uname -p`
 	if test &quot;$UNAME_PROCESSOR&quot; = &quot;x86&quot;; then
@@ -1088,22 +1227,25 @@ EOF
 		UNAME_MACHINE=pc
 	fi
 	echo ${UNAME_PROCESSOR}-${UNAME_MACHINE}-nto-qnx${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     *:QNX:*:4*)
 	echo i386-pc-qnx
-	exit 0 ;;
-    NSR-[GKLNPTVW]:NONSTOP_KERNEL:*:*)
+	exit ;;
+    NSE-?:NONSTOP_KERNEL:*:*)
+	echo nse-tandem-nsk${UNAME_RELEASE}
+	exit ;;
+    NSR-?:NONSTOP_KERNEL:*:*)
 	echo nsr-tandem-nsk${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     *:NonStop-UX:*:*)
 	echo mips-compaq-nonstopux
-	exit 0 ;;
+	exit ;;
     BS2000:POSIX*:*:*)
 	echo bs2000-siemens-sysv
-	exit 0 ;;
+	exit ;;
     DS/*:UNIX_System_V:*:*)
 	echo ${UNAME_MACHINE}-${UNAME_SYSTEM}-${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     *:Plan9:*:*)
 	# &quot;uname -m&quot; is not consistent, so use $cputype instead. 386
 	# is converted to i386 for consistency with other x86
@@ -1114,36 +1256,50 @@ EOF
 	    UNAME_MACHINE=&quot;$cputype&quot;
 	fi
 	echo ${UNAME_MACHINE}-unknown-plan9
-	exit 0 ;;
-    i*86:OS/2:*:*)
-	# If we were able to find `uname', then EMX Unix compatibility
-	# is probably installed.
-	echo ${UNAME_MACHINE}-pc-os2-emx
-	exit 0 ;;
+	exit ;;
     *:TOPS-10:*:*)
 	echo pdp10-unknown-tops10
-	exit 0 ;;
+	exit ;;
     *:TENEX:*:*)
 	echo pdp10-unknown-tenex
-	exit 0 ;;
+	exit ;;
     KS10:TOPS-20:*:* | KL10:TOPS-20:*:* | TYPE4:TOPS-20:*:*)
 	echo pdp10-dec-tops20
-	exit 0 ;;
+	exit ;;
     XKL-1:TOPS-20:*:* | TYPE5:TOPS-20:*:*)
 	echo pdp10-xkl-tops20
-	exit 0 ;;
+	exit ;;
     *:TOPS-20:*:*)
 	echo pdp10-unknown-tops20
-	exit 0 ;;
+	exit ;;
     *:ITS:*:*)
 	echo pdp10-unknown-its
-	exit 0 ;;
-    i*86:XTS-300:*:STOP)
-	echo ${UNAME_MACHINE}-unknown-stop
-	exit 0 ;;
-    i*86:atheos:*:*)
-	echo ${UNAME_MACHINE}-unknown-atheos
-	exit 0 ;;
+	exit ;;
+    SEI:*:*:SEIUX)
+        echo mips-sei-seiux${UNAME_RELEASE}
+	exit ;;
+    *:DragonFly:*:*)
+	echo ${UNAME_MACHINE}-unknown-dragonfly`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'`
+	exit ;;
+    *:*VMS:*:*)
+    	UNAME_MACHINE=`(uname -p) 2&gt;/dev/null`
+	case &quot;${UNAME_MACHINE}&quot; in
+	    A*) echo alpha-dec-vms ; exit ;;
+	    I*) echo ia64-dec-vms ; exit ;;
+	    V*) echo vax-dec-vms ; exit ;;
+	esac ;;
+    *:XENIX:*:SysV)
+	echo i386-pc-xenix
+	exit ;;
+    i*86:skyos:*:*)
+	echo ${UNAME_MACHINE}-pc-skyos`echo ${UNAME_RELEASE}` | sed -e 's/ .*$//'
+	exit ;;
+    i*86:rdos:*:*)
+	echo ${UNAME_MACHINE}-pc-rdos
+	exit ;;
+    i*86:AROS:*:*)
+	echo ${UNAME_MACHINE}-pc-aros
+	exit ;;
 esac
 
 #echo '(No uname command or uname output not recognized.)' 1&gt;&amp;2
@@ -1175,7 +1331,7 @@ main ()
 #endif
 
 #if defined (__arm) &amp;&amp; defined (__acorn) &amp;&amp; defined (__unix)
-  printf (&quot;arm-acorn-riscix&quot;); exit (0);
+  printf (&quot;arm-acorn-riscix\n&quot;); exit (0);
 #endif
 
 #if defined (hp300) &amp;&amp; !defined (hpux)
@@ -1264,12 +1420,12 @@ main ()
 }
 EOF
 
-$CC_FOR_BUILD $dummy.c -o $dummy 2&gt;/dev/null &amp;&amp; ./$dummy &amp;&amp; rm -f $dummy.c $dummy &amp;&amp; exit 0
-rm -f $dummy.c $dummy
+$CC_FOR_BUILD -o $dummy $dummy.c 2&gt;/dev/null &amp;&amp; SYSTEM_NAME=`$dummy` &amp;&amp;
+	{ echo &quot;$SYSTEM_NAME&quot;; exit; }
 
 # Apollos put the system type in the environment.
 
-test -d /usr/apollo &amp;&amp; { echo ${ISP}-apollo-${SYSTYPE}; exit 0; }
+test -d /usr/apollo &amp;&amp; { echo ${ISP}-apollo-${SYSTYPE}; exit; }
 
 # Convex versions that predate uname can use getsysinfo(1)
 
@@ -1278,22 +1434,22 @@ then
     case `getsysinfo -f cpu_type` in
     c1*)
 	echo c1-convex-bsd
-	exit 0 ;;
+	exit ;;
     c2*)
 	if getsysinfo -f scalar_acc
 	then echo c32-convex-bsd
 	else echo c2-convex-bsd
 	fi
-	exit 0 ;;
+	exit ;;
     c34*)
 	echo c34-convex-bsd
-	exit 0 ;;
+	exit ;;
     c38*)
 	echo c38-convex-bsd
-	exit 0 ;;
+	exit ;;
     c4*)
 	echo c4-convex-bsd
-	exit 0 ;;
+	exit ;;
     esac
 fi
 
@@ -1304,7 +1460,9 @@ This script, last modified $timestamp, has failed to recognize
 the operating system you are using. It is advised that you
 download the most up to date version of the config scripts from
 
-    <A HREF="ftp://ftp.gnu.org/pub/gnu/config/">ftp://ftp.gnu.org/pub/gnu/config/</A>
+  <A HREF="http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.guess;hb=HEAD">http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.guess;hb=HEAD</A>
+and
+  <A HREF="http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.sub;hb=HEAD">http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.sub;hb=HEAD</A>
 
 If the version you run ($0) is already up to date, please
 send the following data and any information you think might be
diff --git a/nx-X11/extras/expat/conftools/config.sub b/nx-X11/extras/expat/conftools/config.sub
index 043d45b..c2d1257 100644
--- a/nx-X11/extras/expat/conftools/config.sub
+++ b/nx-X11/extras/expat/conftools/config.sub
@@ -1,9 +1,10 @@
 #! /bin/sh
 # Configuration validation subroutine script.
 #   Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999,
-#   2000, 2001, 2002 Free Software Foundation, Inc.
+#   2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010
+#   Free Software Foundation, Inc.
 
-timestamp='2002-03-07'
+timestamp='2010-01-22'
 
 # This file is (in principle) common to ALL GNU software.
 # The presence of a machine in this file suggests that SOME GNU software
@@ -21,27 +22,26 @@ timestamp='2002-03-07'
 #
 # You should have received a copy of the GNU General Public License
 # along with this program; if not, write to the Free Software
-# Foundation, Inc., 59 Temple Place - Suite 330,
-# Boston, MA 02111-1307, USA.
-
+# Foundation, Inc., 51 Franklin Street - Fifth Floor, Boston, MA
+# 02110-1301, USA.
+#
 # As a special exception to the GNU General Public License, if you
 # distribute this file as part of a program that contains a
 # configuration script generated by Autoconf, you may include it under
 # the same distribution terms that you use for the rest of that program.
 
-#####################################################################
-# This file contains changes for Apache, clearly marked below.
-# These changes are hereby donated to the public domain.
-#####################################################################
 
 # Please send patches to &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">config-patches at gnu.org</A>&gt;.  Submit a context
-# diff and a properly formatted ChangeLog entry.
+# diff and a properly formatted GNU ChangeLog entry.
 #
 # Configuration subroutine to validate and canonicalize a configuration type.
 # Supply the specified configuration type as an argument.
 # If it is invalid, we print an error message on stderr and exit with code 1.
 # Otherwise, we print the canonical config type on stdout and succeed.
 
+# You can get the latest version of this script from:
+# <A HREF="http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.sub;hb=HEAD">http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.sub;hb=HEAD</A>
+
 # This file is supposed to be the same for all GNU packages
 # and recognize all the CPU types, system types and aliases
 # that are meaningful with *any* GNU software.
@@ -75,8 +75,9 @@ Report bugs and patches to &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">config-patches at gnu.org</A>&gt;.&quot;
 version=&quot;\
 GNU config.sub ($timestamp)
 
-Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
-Free Software Foundation, Inc.
+Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000,
+2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010 Free
+Software Foundation, Inc.
 
 This is free software; see the source for copying conditions.  There is NO
 warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&quot;
@@ -88,11 +89,11 @@ Try \`$me --help' for more information.&quot;
 while test $# -gt 0 ; do
   case $1 in
     --time-stamp | --time* | -t )
-       echo &quot;$timestamp&quot; ; exit 0 ;;
+       echo &quot;$timestamp&quot; ; exit ;;
     --version | -v )
-       echo &quot;$version&quot; ; exit 0 ;;
+       echo &quot;$version&quot; ; exit ;;
     --help | --h* | -h )
-       echo &quot;$usage&quot;; exit 0 ;;
+       echo &quot;$usage&quot;; exit ;;
     -- )     # Stop option processing
        shift; break ;;
     - )	# Use stdin as input.
@@ -104,7 +105,7 @@ while test $# -gt 0 ; do
     *local*)
        # First pass through any local machine types.
        echo $1
-       exit 0;;
+       exit ;;
 
     * )
        break ;;
@@ -123,28 +124,13 @@ esac
 # Here we must recognize all the valid KERNEL-OS combinations.
 maybe_os=`echo $1 | sed 's/^\(.*\)-\([^-]*-[^-]*\)$/\2/'`
 case $maybe_os in
-  nto-qnx* | linux-gnu* | storm-chaos* | os2-emx* | windows32-* | rtmk-nova*)
+  nto-qnx* | linux-gnu* | linux-dietlibc | linux-newlib* | linux-uclibc* | \
+  uclinux-uclibc* | uclinux-gnu* | kfreebsd*-gnu* | knetbsd*-gnu* | netbsd*-gnu* | \
+  kopensolaris*-gnu* | \
+  storm-chaos* | os2-emx* | rtmk-nova*)
     os=-$maybe_os
     basic_machine=`echo $1 | sed 's/^\(.*\)-\([^-]*-[^-]*\)$/\1/'`
     ;;
-########################
-# changes for Apache
-#
-  tpf | os390 | vmcms)
-    os=-$maybe_os
-    basic_machine=s390;
-    ;;
-  os400)
-    os=-$maybe_os
-    basic_machine=as400;
-    ;;
-  mvs)
-    os=-mvs
-    basic_machine=i370;
-    ;;
-#
-# end Apache changes
-########################
   *)
     basic_machine=`echo $1 | sed 's/-[^-]*$//'`
     if [ $basic_machine != $1 ]
@@ -167,10 +153,13 @@ case $os in
 	-convergent* | -ncr* | -news | -32* | -3600* | -3100* | -hitachi* |\
 	-c[123]* | -convex* | -sun | -crds | -omron* | -dg | -ultra | -tti* | \
 	-harris | -dolphin | -highlevel | -gould | -cbm | -ns | -masscomp | \
-	-apple | -axis)
+	-apple | -axis | -knuth | -cray | -microblaze)
 		os=
 		basic_machine=$1
 		;;
+        -bluegene*)
+	        os=-cnk
+		;;
 	-sim | -cisco | -oki | -wec | -winbond)
 		os=
 		basic_machine=$1
@@ -192,6 +181,10 @@ case $os in
 	-hiux*)
 		os=-hiuxwe2
 		;;
+	-sco6)
+		os=-sco5v6
+		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
+		;;
 	-sco5)
 		os=-sco3.2v5
 		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
@@ -208,6 +201,10 @@ case $os in
 		# Don't forget version if it is 3.2v4 or newer.
 		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
 		;;
+	-sco5v6*)
+		# Don't forget version if it is 3.2v4 or newer.
+		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
+		;;
 	-sco*)
 		os=-sco3.2v2
 		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
@@ -251,41 +248,71 @@ case $basic_machine in
 	| a29k \
 	| alpha | alphaev[4-8] | alphaev56 | alphaev6[78] | alphapca5[67] \
 	| alpha64 | alpha64ev[4-8] | alpha64ev56 | alpha64ev6[78] | alpha64pca5[67] \
-	| arc | arm | arm[bl]e | arme[lb] | armv[2345] | armv[345][lb] | avr \
+	| am33_2.0 \
+	| arc | arm | arm[bl]e | arme[lb] | armv[2345] | armv[345][lb] | avr | avr32 \
+	| bfin \
 	| c4x | clipper \
-	| d10v | d30v | dsp16xx \
-	| fr30 \
+	| d10v | d30v | dlx | dsp16xx \
+	| fido | fr30 | frv \
 	| h8300 | h8500 | hppa | hppa1.[01] | hppa2.0 | hppa2.0[nw] | hppa64 \
 	| i370 | i860 | i960 | ia64 \
-	| m32r | m68000 | m68k | m88k | mcore \
-	| mips | mips16 | mips64 | mips64el | mips64orion | mips64orionel \
-	| mips64vr4100 | mips64vr4100el | mips64vr4300 \
-	| mips64vr4300el | mips64vr5000 | mips64vr5000el \
-	| mipsbe | mipseb | mipsel | mipsle | mipstx39 | mipstx39el \
-	| mipsisa32 | mipsisa64 \
+	| ip2k | iq2000 \
+	| lm32 \
+	| m32c | m32r | m32rle | m68000 | m68k | m88k \
+	| maxq | mb | microblaze | mcore | mep | metag \
+	| mips | mipsbe | mipseb | mipsel | mipsle \
+	| mips16 \
+	| mips64 | mips64el \
+	| mips64octeon | mips64octeonel \
+	| mips64orion | mips64orionel \
+	| mips64r5900 | mips64r5900el \
+	| mips64vr | mips64vrel \
+	| mips64vr4100 | mips64vr4100el \
+	| mips64vr4300 | mips64vr4300el \
+	| mips64vr5000 | mips64vr5000el \
+	| mips64vr5900 | mips64vr5900el \
+	| mipsisa32 | mipsisa32el \
+	| mipsisa32r2 | mipsisa32r2el \
+	| mipsisa64 | mipsisa64el \
+	| mipsisa64r2 | mipsisa64r2el \
+	| mipsisa64sb1 | mipsisa64sb1el \
+	| mipsisa64sr71k | mipsisa64sr71kel \
+	| mipstx39 | mipstx39el \
 	| mn10200 | mn10300 \
+	| moxie \
+	| mt \
+	| msp430 \
+	| nios | nios2 \
 	| ns16k | ns32k \
-	| openrisc | or32 \
+	| or32 \
 	| pdp10 | pdp11 | pj | pjl \
 	| powerpc | powerpc64 | powerpc64le | powerpcle | ppcbe \
 	| pyramid \
-	| sh | sh[34] | sh[34]eb | shbe | shle | sh64 \
-	| sparc | sparc64 | sparc86x | sparclet | sparclite | sparcv9 | sparcv9b \
-	| strongarm \
-	| tahoe | thumb | tic80 | tron \
+	| rx \
+	| score \
+	| sh | sh[1234] | sh[24]a | sh[24]aeb | sh[23]e | sh[34]eb | sheb | shbe | shle | sh[1234]le | sh3ele \
+	| sh64 | sh64le \
+	| sparc | sparc64 | sparc64b | sparc64v | sparc86x | sparclet | sparclite \
+	| sparcv8 | sparcv9 | sparcv9b | sparcv9v \
+	| spu | strongarm \
+	| tahoe | thumb | tic4x | tic80 | tron \
+	| ubicom32 \
 	| v850 | v850e \
 	| we32k \
-	| x86 | xscale | xstormy16 | xtensa \
-	| z8k)
+	| x86 | xc16x | xscale | xscalee[bl] | xstormy16 | xtensa \
+	| z8k | z80)
 		basic_machine=$basic_machine-unknown
 		;;
-	m6811 | m68hc11 | m6812 | m68hc12)
+	m6811 | m68hc11 | m6812 | m68hc12 | picochip)
 		# Motorola 68HC11/12.
 		basic_machine=$basic_machine-unknown
 		os=-none
 		;;
 	m88110 | m680[12346]0 | m683?2 | m68360 | m5200 | v70 | w65 | z8k)
 		;;
+	ms1)
+		basic_machine=mt-unknown
+		;;
 
 	# We use `pc' rather than `unknown'
 	# because (1) that's what they normally are, and
@@ -304,40 +331,70 @@ case $basic_machine in
 	| alpha-* | alphaev[4-8]-* | alphaev56-* | alphaev6[78]-* \
 	| alpha64-* | alpha64ev[4-8]-* | alpha64ev56-* | alpha64ev6[78]-* \
 	| alphapca5[67]-* | alpha64pca5[67]-* | arc-* \
-	| arm-*  | armbe-* | armle-* | armv*-* \
-	| avr-* \
-	| bs2000-* \
-	| c[123]* | c30-* | [cjt]90-* | c54x-* \
-	| clipper-* | cydra-* \
-	| d10v-* | d30v-* \
+	| arm-*  | armbe-* | armle-* | armeb-* | armv*-* \
+	| avr-* | avr32-* \
+	| bfin-* | bs2000-* \
+	| c[123]* | c30-* | [cjt]90-* | c4x-* | c54x-* | c55x-* | c6x-* \
+	| clipper-* | craynv-* | cydra-* \
+	| d10v-* | d30v-* | dlx-* \
 	| elxsi-* \
-	| f30[01]-* | f700-* | fr30-* | fx80-* \
+	| f30[01]-* | f700-* | fido-* | fr30-* | frv-* | fx80-* \
 	| h8300-* | h8500-* \
 	| hppa-* | hppa1.[01]-* | hppa2.0-* | hppa2.0[nw]-* | hppa64-* \
 	| i*86-* | i860-* | i960-* | ia64-* \
-	| m32r-* \
+	| ip2k-* | iq2000-* \
+	| lm32-* \
+	| m32c-* | m32r-* | m32rle-* \
 	| m68000-* | m680[012346]0-* | m68360-* | m683?2-* | m68k-* \
-	| m88110-* | m88k-* | mcore-* \
-	| mips-* | mips16-* | mips64-* | mips64el-* | mips64orion-* \
-	| mips64orionel-* | mips64vr4100-* | mips64vr4100el-* \
-	| mips64vr4300-* | mips64vr4300el-* | mipsbe-* | mipseb-* \
-	| mipsle-* | mipsel-* | mipstx39-* | mipstx39el-* \
+	| m88110-* | m88k-* | maxq-* | mcore-* | metag-* | microblaze-* \
+	| mips-* | mipsbe-* | mipseb-* | mipsel-* | mipsle-* \
+	| mips16-* \
+	| mips64-* | mips64el-* \
+	| mips64octeon-* | mips64octeonel-* \
+	| mips64orion-* | mips64orionel-* \
+	| mips64r5900-* | mips64r5900el-* \
+	| mips64vr-* | mips64vrel-* \
+	| mips64vr4100-* | mips64vr4100el-* \
+	| mips64vr4300-* | mips64vr4300el-* \
+	| mips64vr5000-* | mips64vr5000el-* \
+	| mips64vr5900-* | mips64vr5900el-* \
+	| mipsisa32-* | mipsisa32el-* \
+	| mipsisa32r2-* | mipsisa32r2el-* \
+	| mipsisa64-* | mipsisa64el-* \
+	| mipsisa64r2-* | mipsisa64r2el-* \
+	| mipsisa64sb1-* | mipsisa64sb1el-* \
+	| mipsisa64sr71k-* | mipsisa64sr71kel-* \
+	| mipstx39-* | mipstx39el-* \
+	| mmix-* \
+	| mt-* \
+	| msp430-* \
+	| nios-* | nios2-* \
 	| none-* | np1-* | ns16k-* | ns32k-* \
 	| orion-* \
 	| pdp10-* | pdp11-* | pj-* | pjl-* | pn-* | power-* \
 	| powerpc-* | powerpc64-* | powerpc64le-* | powerpcle-* | ppcbe-* \
 	| pyramid-* \
-	| romp-* | rs6000-* \
-	| sh-* | sh[34]-* | sh[34]eb-* | shbe-* | shle-* | sh64-* \
-	| sparc-* | sparc64-* | sparc86x-* | sparclet-* | sparclite-* \
-	| sparcv9-* | sparcv9b-* | strongarm-* | sv1-* | sx?-* \
-	| tahoe-* | thumb-* | tic30-* | tic54x-* | tic80-* | tron-* \
+	| romp-* | rs6000-* | rx-* \
+	| sh-* | sh[1234]-* | sh[24]a-* | sh[24]aeb-* | sh[23]e-* | sh[34]eb-* | sheb-* | shbe-* \
+	| shle-* | sh[1234]le-* | sh3ele-* | sh64-* | sh64le-* \
+	| sparc-* | sparc64-* | sparc64b-* | sparc64v-* | sparc86x-* | sparclet-* \
+	| sparclite-* \
+	| sparcv8-* | sparcv9-* | sparcv9b-* | sparcv9v-* | strongarm-* | sv1-* | sx?-* \
+	| tahoe-* | thumb-* \
+	| tic30-* | tic4x-* | tic54x-* | tic55x-* | tic6x-* | tic80-* \
+	| tile-* | tilegx-* \
+	| tron-* \
+	| ubicom32-* \
 	| v850-* | v850e-* | vax-* \
 	| we32k-* \
-	| x86-* | x86_64-* | xps100-* | xscale-* | xstormy16-* \
-	| xtensa-* \
+	| x86-* | x86_64-* | xc16x-* | xps100-* | xscale-* | xscalee[bl]-* \
+	| xstormy16-* | xtensa*-* \
 	| ymp-* \
-	| z8k-*)
+	| z8k-* | z80-*)
+		;;
+	# Recognize the basic CPU types without company name, with glob match.
+	xtensa*)
+		basic_machine=$basic_machine-unknown
 		;;
 	# Recognize the various machine names and aliases which stand
 	# for a CPU type and a company and sometimes even an OS.
@@ -355,6 +412,9 @@ case $basic_machine in
 		basic_machine=a29k-amd
 		os=-udi
 		;;
+    	abacus)
+		basic_machine=abacus-unknown
+		;;
 	adobe68k)
 		basic_machine=m68010-adobe
 		os=-scout
@@ -369,6 +429,12 @@ case $basic_machine in
 		basic_machine=a29k-none
 		os=-bsd
 		;;
+	amd64)
+		basic_machine=x86_64-pc
+		;;
+	amd64-*)
+		basic_machine=x86_64-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
 	amdahl)
 		basic_machine=580-amdahl
 		os=-sysv
@@ -392,6 +458,10 @@ case $basic_machine in
 		basic_machine=m68k-apollo
 		os=-bsd
 		;;
+	aros)
+		basic_machine=i386-pc
+		os=-aros
+		;;
 	aux)
 		basic_machine=m68k-apple
 		os=-aux
@@ -400,10 +470,26 @@ case $basic_machine in
 		basic_machine=ns32k-sequent
 		os=-dynix
 		;;
+	blackfin)
+		basic_machine=bfin-unknown
+		os=-linux
+		;;
+	blackfin-*)
+		basic_machine=bfin-`echo $basic_machine | sed 's/^[^-]*-//'`
+		os=-linux
+		;;
+	bluegene*)
+		basic_machine=powerpc-ibm
+		os=-cnk
+		;;
 	c90)
 		basic_machine=c90-cray
 		os=-unicos
 		;;
+        cegcc)
+		basic_machine=arm-unknown
+		os=-cegcc
+		;;
 	convex-c1)
 		basic_machine=c1-convex
 		os=-bsd
@@ -428,12 +514,27 @@ case $basic_machine in
 		basic_machine=j90-cray
 		os=-unicos
 		;;
+	craynv)
+		basic_machine=craynv-cray
+		os=-unicosmp
+		;;
+	cr16)
+		basic_machine=cr16-unknown
+		os=-elf
+		;;
 	crds | unos)
 		basic_machine=m68k-crds
 		;;
+	crisv32 | crisv32-* | etraxfs*)
+		basic_machine=crisv32-axis
+		;;
 	cris | cris-* | etrax*)
 		basic_machine=cris-axis
 		;;
+	crx)
+		basic_machine=crx-unknown
+		os=-elf
+		;;
 	da30 | da30-*)
 		basic_machine=m68k-da30
 		;;
@@ -456,6 +557,14 @@ case $basic_machine in
 		basic_machine=m88k-motorola
 		os=-sysv3
 		;;
+	dicos)
+		basic_machine=i686-pc
+		os=-dicos
+		;;
+	djgpp)
+		basic_machine=i586-pc
+		os=-msdosdjgpp
+		;;
 	dpx20 | dpx20-*)
 		basic_machine=rs6000-bull
 		os=-bosx
@@ -606,6 +715,14 @@ case $basic_machine in
 		basic_machine=m68k-isi
 		os=-sysv
 		;;
+	m68knommu)
+		basic_machine=m68k-unknown
+		os=-linux
+		;;
+	m68knommu-*)
+		basic_machine=m68k-`echo $basic_machine | sed 's/^[^-]*-//'`
+		os=-linux
+		;;
 	m88k-omron*)
 		basic_machine=m88k-omron
 		;;
@@ -617,10 +734,17 @@ case $basic_machine in
 		basic_machine=ns32k-utek
 		os=-sysv
 		;;
+        microblaze)
+		basic_machine=microblaze-xilinx
+		;;
 	mingw32)
 		basic_machine=i386-pc
 		os=-mingw32
 		;;
+	mingw32ce)
+		basic_machine=arm-unknown
+		os=-mingw32ce
+		;;
 	miniframe)
 		basic_machine=m68000-convergent
 		;;
@@ -634,10 +758,6 @@ case $basic_machine in
 	mips3*)
 		basic_machine=`echo $basic_machine | sed -e 's/mips3/mips64/'`-unknown
 		;;
-	mmix*)
-		basic_machine=mmix-knuth
-		os=-mmixware
-		;;
 	monitor)
 		basic_machine=m68k-rom68k
 		os=-coff
@@ -650,6 +770,9 @@ case $basic_machine in
 		basic_machine=i386-pc
 		os=-msdos
 		;;
+	ms1-*)
+		basic_machine=`echo $basic_machine | sed -e 's/ms1-/mt-/'`
+		;;
 	mvs)
 		basic_machine=i370-ibm
 		os=-mvs
@@ -725,9 +848,12 @@ case $basic_machine in
 		basic_machine=hppa1.1-oki
 		os=-proelf
 		;;
-	or32 | or32-*)
+	openrisc | openrisc-*)
 		basic_machine=or32-unknown
-		os=-coff
+		;;
+	os400)
+		basic_machine=powerpc-ibm
+		os=-os400
 		;;
 	OSE68000 | ose68000)
 		basic_machine=m68000-ericsson
@@ -745,55 +871,75 @@ case $basic_machine in
 		basic_machine=i860-intel
 		os=-osf
 		;;
+	parisc)
+		basic_machine=hppa-unknown
+		os=-linux
+		;;
+	parisc-*)
+		basic_machine=hppa-`echo $basic_machine | sed 's/^[^-]*-//'`
+		os=-linux
+		;;
 	pbd)
 		basic_machine=sparc-tti
 		;;
 	pbb)
 		basic_machine=m68k-tti
 		;;
-        pc532 | pc532-*)
+	pc532 | pc532-*)
 		basic_machine=ns32k-pc532
 		;;
+	pc98)
+		basic_machine=i386-pc
+		;;
+	pc98-*)
+		basic_machine=i386-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
 	pentium | p5 | k5 | k6 | nexgen | viac3)
 		basic_machine=i586-pc
 		;;
-	pentiumpro | p6 | 6x86 | athlon)
+	pentiumpro | p6 | 6x86 | athlon | athlon_*)
 		basic_machine=i686-pc
 		;;
-	pentiumii | pentium2)
+	pentiumii | pentium2 | pentiumiii | pentium3)
 		basic_machine=i686-pc
 		;;
+	pentium4)
+		basic_machine=i786-pc
+		;;
 	pentium-* | p5-* | k5-* | k6-* | nexgen-* | viac3-*)
 		basic_machine=i586-`echo $basic_machine | sed 's/^[^-]*-//'`
 		;;
 	pentiumpro-* | p6-* | 6x86-* | athlon-*)
 		basic_machine=i686-`echo $basic_machine | sed 's/^[^-]*-//'`
 		;;
-	pentiumii-* | pentium2-*)
+	pentiumii-* | pentium2-* | pentiumiii-* | pentium3-*)
 		basic_machine=i686-`echo $basic_machine | sed 's/^[^-]*-//'`
 		;;
+	pentium4-*)
+		basic_machine=i786-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
 	pn)
 		basic_machine=pn-gould
 		;;
 	power)	basic_machine=power-ibm
 		;;
 	ppc)	basic_machine=powerpc-unknown
-	        ;;
+		;;
 	ppc-*)	basic_machine=powerpc-`echo $basic_machine | sed 's/^[^-]*-//'`
 		;;
 	ppcle | powerpclittle | ppc-le | powerpc-little)
 		basic_machine=powerpcle-unknown
-	        ;;
+		;;
 	ppcle-* | powerpclittle-*)
 		basic_machine=powerpcle-`echo $basic_machine | sed 's/^[^-]*-//'`
 		;;
 	ppc64)	basic_machine=powerpc64-unknown
-	        ;;
+		;;
 	ppc64-*) basic_machine=powerpc64-`echo $basic_machine | sed 's/^[^-]*-//'`
 		;;
 	ppc64le | powerpc64little | ppc64-le | powerpc64-little)
 		basic_machine=powerpc64le-unknown
-	        ;;
+		;;
 	ppc64le-* | powerpc64little-*)
 		basic_machine=powerpc64le-`echo $basic_machine | sed 's/^[^-]*-//'`
 		;;
@@ -804,6 +950,10 @@ case $basic_machine in
 		basic_machine=i586-unknown
 		os=-pw32
 		;;
+	rdos)
+		basic_machine=i386-pc
+		os=-rdos
+		;;
 	rom68k)
 		basic_machine=m68k-rom68k
 		os=-coff
@@ -824,15 +974,20 @@ case $basic_machine in
 		basic_machine=a29k-amd
 		os=-udi
 		;;
-########################
-# changes for Apache
-#
-	as400*)
-		basic_machine=as400-ibm
+	sb1)
+		basic_machine=mipsisa64sb1-unknown
+		;;
+	sb1el)
+		basic_machine=mipsisa64sb1el-unknown
+		;;
+	sde)
+		basic_machine=mipsisa32-sde
+		os=-elf
+		;;
+	sei)
+		basic_machine=mips-sei
+		os=-seiux
 		;;
-# 
-# end Apache changes
-########################
 	sequent)
 		basic_machine=i386-sequent
 		;;
@@ -840,6 +995,12 @@ case $basic_machine in
 		basic_machine=sh-hitachi
 		os=-hms
 		;;
+	sh5el)
+		basic_machine=sh5le-unknown
+		;;
+	sh64)
+		basic_machine=sh64-unknown
+		;;
 	sparclite-wrs | simso-wrs)
 		basic_machine=sparclite-wrs
 		os=-vxworks
@@ -898,7 +1059,7 @@ case $basic_machine in
 	sun386 | sun386i | roadrunner)
 		basic_machine=i386-sun
 		;;
-        sv1)
+	sv1)
 		basic_machine=sv1-cray
 		os=-unicos
 		;;
@@ -906,10 +1067,6 @@ case $basic_machine in
 		basic_machine=i386-sequent
 		os=-dynix
 		;;
-	t3d)
-		basic_machine=alpha-cray
-		os=-unicos
-		;;
 	t3e)
 		basic_machine=alphaev5-cray
 		os=-unicos
@@ -922,6 +1079,23 @@ case $basic_machine in
 		basic_machine=tic54x-unknown
 		os=-coff
 		;;
+	tic55x | c55x*)
+		basic_machine=tic55x-unknown
+		os=-coff
+		;;
+	tic6x | c6x*)
+		basic_machine=tic6x-unknown
+		os=-coff
+		;;
+        # This must be matched before tile*.
+        tilegx*)
+		basic_machine=tilegx-unknown
+		os=-linux-gnu
+		;;
+	tile*)
+		basic_machine=tile-unknown
+		os=-linux-gnu
+		;;
 	tx39)
 		basic_machine=mipstx39-unknown
 		;;
@@ -935,6 +1109,10 @@ case $basic_machine in
 	tower | tower-32)
 		basic_machine=m68k-ncr
 		;;
+	tpf)
+		basic_machine=s390x-ibm
+		os=-tpf
+		;;
 	udi29k)
 		basic_machine=a29k-amd
 		os=-udi
@@ -956,8 +1134,8 @@ case $basic_machine in
 		os=-vms
 		;;
 	vpp*|vx|vx-*)
-               basic_machine=f301-fujitsu
-               ;;
+		basic_machine=f301-fujitsu
+		;;
 	vxworks960)
 		basic_machine=i960-wrs
 		os=-vxworks
@@ -978,11 +1156,11 @@ case $basic_machine in
 		basic_machine=hppa1.1-winbond
 		os=-proelf
 		;;
-	windows32)
-		basic_machine=i386-pc
-		os=-windows32-msvcrt
+	xbox)
+		basic_machine=i686-pc
+		os=-mingw32
 		;;
-        xps | xps100)
+	xps | xps100)
 		basic_machine=xps100-honeywell
 		;;
 	ymp)
@@ -993,6 +1171,10 @@ case $basic_machine in
 		basic_machine=z8k-unknown
 		os=-sim
 		;;
+	z80-*-coff)
+		basic_machine=z80-unknown
+		os=-sim
+		;;
 	none)
 		basic_machine=none-none
 		os=-none
@@ -1012,6 +1194,9 @@ case $basic_machine in
 	romp)
 		basic_machine=romp-ibm
 		;;
+	mmix)
+		basic_machine=mmix-knuth
+		;;
 	rs6000)
 		basic_machine=rs6000-ibm
 		;;
@@ -1028,16 +1213,13 @@ case $basic_machine in
 	we32k)
 		basic_machine=we32k-att
 		;;
-	sh3 | sh4 | sh3eb | sh4eb)
+	sh[1234] | sh[24]a | sh[24]aeb | sh[34]eb | sh[1234]le | sh[23]ele)
 		basic_machine=sh-unknown
 		;;
-	sh64)
-		basic_machine=sh64-unknown
-		;;
-	sparc | sparcv9 | sparcv9b)
+	sparc | sparcv8 | sparcv9 | sparcv9b | sparcv9v)
 		basic_machine=sparc-sun
 		;;
-        cydra)
+	cydra)
 		basic_machine=cydra-cydrome
 		;;
 	orion)
@@ -1052,10 +1234,6 @@ case $basic_machine in
 	pmac | pmac-mpw)
 		basic_machine=powerpc-apple
 		;;
-	c4x*)
-		basic_machine=c4x-none
-		os=-coff
-		;;
 	*-unknown)
 		# Make sure to match an already-canonicalized machine name.
 		;;
@@ -1085,6 +1263,9 @@ case $os in
         # First match some system type aliases
         # that might get confused with valid system types.
 	# -solaris* is a basic system type, with this one exception.
+        -auroraux)
+	        os=-auroraux
+		;;
 	-solaris1 | -solaris1.*)
 		os=`echo $os | sed -e 's|solaris1|sunos4|'`
 		;;
@@ -1100,37 +1281,35 @@ case $os in
 	-gnu/linux*)
 		os=`echo $os | sed -e 's|gnu/linux|linux-gnu|'`
 		;;
-########################
-# changes for Apache
-#
-	-os2_emx | -tpf* | -os390* | -vmcms* | -os400* )
-        	;;
-#
-# end Apache changes
-########################
 	# First accept the basic system types.
 	# The portable systems comes first.
 	# Each alternative MUST END IN A *, to match a version number.
 	# -sysv* is not here because it comes later, after sysvr4.
 	-gnu* | -bsd* | -mach* | -minix* | -genix* | -ultrix* | -irix* \
-	      | -*vms* | -sco* | -esix* | -isc* | -aix* | -sunos | -sunos[34]*\
-	      | -hpux* | -unos* | -osf* | -luna* | -dgux* | -solaris* | -sym* \
+	      | -*vms* | -sco* | -esix* | -isc* | -aix* | -cnk* | -sunos | -sunos[34]*\
+	      | -hpux* | -unos* | -osf* | -luna* | -dgux* | -auroraux* | -solaris* \
+	      | -sym* | -kopensolaris* \
 	      | -amigaos* | -amigados* | -msdos* | -newsos* | -unicos* | -aof* \
-	      | -aos* \
+	      | -aos* | -aros* \
 	      | -nindy* | -vxsim* | -vxworks* | -ebmon* | -hms* | -mvs* \
 	      | -clix* | -riscos* | -uniplus* | -iris* | -rtu* | -xenix* \
-	      | -hiux* | -386bsd* | -netbsd* | -openbsd* | -freebsd* | -riscix* \
-	      | -lynxos* | -bosx* | -nextstep* | -cxux* | -aout* | -elf* | -oabi* \
+	      | -hiux* | -386bsd* | -knetbsd* | -mirbsd* | -netbsd* \
+	      | -openbsd* | -solidbsd* \
+	      | -ekkobsd* | -kfreebsd* | -freebsd* | -riscix* | -lynxos* \
+	      | -bosx* | -nextstep* | -cxux* | -aout* | -elf* | -oabi* \
 	      | -ptx* | -coff* | -ecoff* | -winnt* | -domain* | -vsta* \
 	      | -udi* | -eabi* | -lites* | -ieee* | -go32* | -aux* \
-	      | -chorusos* | -chorusrdb* \
+	      | -chorusos* | -chorusrdb* | -cegcc* \
 	      | -cygwin* | -pe* | -psos* | -moss* | -proelf* | -rtems* \
-	      | -mingw32* | -linux-gnu* | -uxpv* | -beos* | -mpeix* | -udk* \
-	      | -interix* | -uwin* | -rhapsody* | -darwin* | -opened* \
+	      | -mingw32* | -linux-gnu* | -linux-newlib* | -linux-uclibc* \
+	      | -uxpv* | -beos* | -mpeix* | -udk* \
+	      | -interix* | -uwin* | -mks* | -rhapsody* | -darwin* | -opened* \
 	      | -openstep* | -oskit* | -conix* | -pw32* | -nonstopux* \
 	      | -storm-chaos* | -tops10* | -tenex* | -tops20* | -its* \
 	      | -os2* | -vos* | -palmos* | -uclinux* | -nucleus* \
-	      | -morphos* | -superux* | -rtmk* | -rtmk-nova*)
+	      | -morphos* | -superux* | -rtmk* | -rtmk-nova* | -windiss* \
+	      | -powermax* | -dnix* | -nx6 | -nx7 | -sei* | -dragonfly* \
+	      | -skyos* | -haiku* | -rdos* | -toppers* | -drops* | -es*)
 	# Remember, each alternative MUST END IN *, to match a version number.
 		;;
 	-qnx*)
@@ -1142,16 +1321,21 @@ case $os in
 			;;
 		esac
 		;;
+	-nto-qnx*)
+		;;
 	-nto*)
-		os=-nto-qnx
+		os=`echo $os | sed -e 's|nto|nto-qnx|'`
 		;;
 	-sim | -es1800* | -hms* | -xray | -os68k* | -none* | -v88r* \
-	      | -windows* | -osx | -abug | -netware* | -os9* | -beos* \
+	      | -windows* | -osx | -abug | -netware* | -os9* | -beos* | -haiku* \
 	      | -macos* | -mpw* | -magic* | -mmixware* | -mon960* | -lnews*)
 		;;
 	-mac*)
 		os=`echo $os | sed -e 's|mac|macos|'`
 		;;
+	-linux-dietlibc)
+		os=-linux-dietlibc
+		;;
 	-linux*)
 		os=`echo $os | sed -e 's|linux|linux-gnu|'`
 		;;
@@ -1164,6 +1348,9 @@ case $os in
 	-opened*)
 		os=-openedition
 		;;
+        -os400*)
+		os=-os400
+		;;
 	-wince*)
 		os=-wince
 		;;
@@ -1185,6 +1372,9 @@ case $os in
 	-atheos*)
 		os=-atheos
 		;;
+	-syllable*)
+		os=-syllable
+		;;
 	-386bsd)
 		os=-bsd
 		;;
@@ -1195,7 +1385,7 @@ case $os in
 		os=-rtmk-nova
 		;;
 	-ns2 )
-	        os=-nextstep2
+		os=-nextstep2
 		;;
 	-nsk*)
 		os=-nsk
@@ -1207,6 +1397,9 @@ case $os in
 	-sinix*)
 		os=-sysv4
 		;;
+        -tpf*)
+		os=-tpf
+		;;
 	-triton*)
 		os=-sysv3
 		;;
@@ -1234,9 +1427,23 @@ case $os in
 	-xenix)
 		os=-xenix
 		;;
-        -*mint | -mint[0-9]* | -*MiNT | -MiNT[0-9]*)
-	        os=-mint
+	-*mint | -mint[0-9]* | -*MiNT | -MiNT[0-9]*)
+		os=-mint
+		;;
+	-aros*)
+		os=-aros
+		;;
+	-kaos*)
+		os=-kaos
+		;;
+	-zvmoe)
+		os=-zvmoe
 		;;
+	-dicos*)
+		os=-dicos
+		;;
+        -nacl*)
+	        ;;
 	-none)
 		;;
 	*)
@@ -1259,6 +1466,12 @@ else
 # system, and we'll never get to this point.
 
 case $basic_machine in
+        score-*)
+		os=-elf
+		;;
+        spu-*)
+		os=-elf
+		;;
 	*-acorn)
 		os=-riscix1.2
 		;;
@@ -1268,11 +1481,14 @@ case $basic_machine in
 	arm*-semi)
 		os=-aout
 		;;
+        c4x-* | tic4x-*)
+        	os=-coff
+		;;
 	# This must come before the *-dec entry.
 	pdp10-*)
 		os=-tops20
 		;;
-        pdp11-*)
+	pdp11-*)
 		os=-none
 		;;
 	*-dec | vax-*)
@@ -1293,6 +1509,9 @@ case $basic_machine in
 	m68*-cisco)
 		os=-aout
 		;;
+        mep-*)
+		os=-elf
+		;;
 	mips*-cisco)
 		os=-elf
 		;;
@@ -1311,33 +1530,15 @@ case $basic_machine in
 	*-be)
 		os=-beos
 		;;
-########################
-# changes for Apache
-#
-#	*-ibm)
-#		os=-aix
-#		;;
-#
+	*-haiku)
+		os=-haiku
+		;;
 	*-ibm)
-		case $basic_machine in
-			s390*)
-				os=-os390;
-				;;
-			i370*)
-				os=-mvs;
-				;;
-			as400*)
-				os=-os400;
-				;;
-			*)
-				os=-aix
-				;;
-		esac
-                ;;
-# 
-# end Apache changes
-########################
-
+		os=-aix
+		;;
+    	*-knuth)
+		os=-mmixware
+		;;
 	*-wec)
 		os=-proelf
 		;;
@@ -1389,19 +1590,19 @@ case $basic_machine in
 	*-next)
 		os=-nextstep3
 		;;
-        *-gould)
+	*-gould)
 		os=-sysv
 		;;
-        *-highlevel)
+	*-highlevel)
 		os=-bsd
 		;;
 	*-encore)
 		os=-bsd
 		;;
-        *-sgi)
+	*-sgi)
 		os=-irix
 		;;
-        *-siemens)
+	*-siemens)
 		os=-sysv4
 		;;
 	*-masscomp)
@@ -1440,7 +1641,7 @@ case $basic_machine in
 			-sunos*)
 				vendor=sun
 				;;
-			-aix*)
+			-cnk*|-aix*)
 				vendor=ibm
 				;;
 			-beos*)
@@ -1470,10 +1671,16 @@ case $basic_machine in
 			-mvs* | -opened*)
 				vendor=ibm
 				;;
+			-os400*)
+				vendor=ibm
+				;;
 			-ptx*)
 				vendor=sequent
 				;;
-			-vxsim* | -vxworks*)
+			-tpf*)
+				vendor=ibm
+				;;
+			-vxsim* | -vxworks* | -windiss*)
 				vendor=wrs
 				;;
 			-aux*)
@@ -1497,7 +1704,7 @@ case $basic_machine in
 esac
 
 echo $basic_machine$os
-exit 0
+exit
 
 # Local variables:
 # eval: (add-hook 'write-file-hooks 'time-stamp)
diff --git a/nx-X11/extras/expat/conftools/ltmain.sh b/nx-X11/extras/expat/conftools/ltmain.sh
index 6e5bf36..6f650ae 100644
--- a/nx-X11/extras/expat/conftools/ltmain.sh
+++ b/nx-X11/extras/expat/conftools/ltmain.sh
@@ -1,3353 +1,3456 @@
-# ltmain.sh - Provide generalized library-building support services.
-# NOTE: Changing this file will not affect anything until you rerun configure.
-#
-# Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001
-# Free Software Foundation, Inc.
-# Originally by Gordon Matzigkeit &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">gord at gnu.ai.mit.edu</A>&gt;, 1996
-#
-# This program is free software; you can redistribute it and/or modify
+
+# libtool (GNU libtool) 2.4
+# Written by Gordon Matzigkeit &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">gord at gnu.ai.mit.edu</A>&gt;, 1996
+
+# Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2003, 2004, 2005, 2006,
+# 2007, 2008, 2009, 2010 Free Software Foundation, Inc.
+# This is free software; see the source for copying conditions.  There is NO
+# warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
+
+# GNU Libtool is free software; you can redistribute it and/or modify
 # it under the terms of the GNU General Public License as published by
 # the Free Software Foundation; either version 2 of the License, or
 # (at your option) any later version.
 #
-# This program is distributed in the hope that it will be useful, but
+# As a special exception to the GNU General Public License,
+# if you distribute this file as part of a program or library that
+# is built using GNU Libtool, you may include this file under the
+# same distribution terms that you use for the rest of that program.
+#
+# GNU Libtool is distributed in the hope that it will be useful, but
 # WITHOUT ANY WARRANTY; without even the implied warranty of
 # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 # General Public License for more details.
 #
 # You should have received a copy of the GNU General Public License
-# along with this program; if not, write to the Free Software
-# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
-#
-# As a special exception to the GNU General Public License, if you
-# distribute this file as part of a program that contains a
-# configuration script generated by Autoconf, you may include it under
-# the same distribution terms that you use for the rest of that program.
-
-# Check that we have a working $echo.
-if test &quot;X$1&quot; = X--no-reexec; then
-  # Discard the --no-reexec flag, and continue.
-  shift
-elif test &quot;X$1&quot; = X--fallback-echo; then
-  # Avoid inline document here, it may be left over
-  :
-elif test &quot;X`($echo '\t') 2&gt;/dev/null`&quot; = 'X\t'; then
-  # Yippee, $echo works!
-  :
-else
-  # Restart under the correct shell, and then maybe $echo will work.
-  exec $SHELL &quot;$0&quot; --no-reexec ${1+&quot;$@&quot;}
-fi
-
-if test &quot;X$1&quot; = X--fallback-echo; then
-  # used as fallback echo
-  shift
-  cat &lt;&lt;EOF
-$*
-EOF
-  exit 0
-fi
+# along with GNU Libtool; see the file COPYING.  If not, a copy
+# can be downloaded from <A HREF="http://www.gnu.org/licenses/gpl.html,">http://www.gnu.org/licenses/gpl.html,</A>
+# or obtained by writing to the Free Software Foundation, Inc.,
+# 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
 
-# The name of this program.
-progname=`$echo &quot;$0&quot; | sed 's%^.*/%%'`
-modename=&quot;$progname&quot;
+# Usage: $progname [OPTION]... [MODE-ARG]...
+#
+# Provide generalized library-building support services.
+#
+#       --config             show all configuration variables
+#       --debug              enable verbose shell tracing
+#   -n, --dry-run            display commands without modifying any files
+#       --features           display basic configuration information and exit
+#       --mode=MODE          use operation mode MODE
+#       --preserve-dup-deps  don't remove duplicate dependency libraries
+#       --quiet, --silent    don't print informational messages
+#       --no-quiet, --no-silent
+#                            print informational messages (default)
+#       --tag=TAG            use configuration variables from tag TAG
+#   -v, --verbose            print more informational messages than default
+#       --no-verbose         don't print the extra informational messages
+#       --version            print version information
+#   -h, --help, --help-all   print short, long, or detailed help message
+#
+# MODE must be one of the following:
+#
+#         clean              remove files from the build directory
+#         compile            compile a source file into a libtool object
+#         execute            automatically set library path, then run a program
+#         finish             complete the installation of libtool libraries
+#         install            install libraries or executables
+#         link               create a library or an executable
+#         uninstall          remove libraries from an installed directory
+#
+# MODE-ARGS vary depending on the MODE.  When passed as first option,
+# `--mode=MODE' may be abbreviated as `MODE' or a unique abbreviation of that.
+# Try `$progname --help --mode=MODE' for a more detailed description of MODE.
+#
+# When reporting a bug, please describe a test case to reproduce it and
+# include the following information:
+#
+#         host-triplet:	$host
+#         shell:		$SHELL
+#         compiler:		$LTCC
+#         compiler flags:		$LTCFLAGS
+#         linker:		$LD (gnu? $with_gnu_ld)
+#         $progname:	(GNU libtool) 2.4 Debian-2.4-2
+#         automake:	$automake_version
+#         autoconf:	$autoconf_version
+#
+# Report bugs to &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">bug-libtool at gnu.org</A>&gt;.
+# GNU libtool home page: &lt;<A HREF="http://www.gnu.org/software/libtool/">http://www.gnu.org/software/libtool/</A>&gt;.
+# General help using GNU software: &lt;<A HREF="http://www.gnu.org/gethelp/">http://www.gnu.org/gethelp/</A>&gt;.
 
-# Constants.
-PROGRAM=ltmain.sh
+PROGRAM=libtool
 PACKAGE=libtool
-VERSION=1.4.2
-TIMESTAMP=&quot; (1.922.2.53 2001/09/11 03:18:52)&quot;
-
-default_mode=
-help=&quot;Try \`$progname --help' for more information.&quot;
-magic=&quot;%%%MAGIC variable%%%&quot;
-mkdir=&quot;mkdir&quot;
-mv=&quot;mv -f&quot;
-rm=&quot;rm -f&quot;
-
-# Sed substitution that helps us do robust quoting.  It backslashifies
-# metacharacters that are still active within double-quoted strings.
-Xsed='sed -e 1s/^X//'
-sed_quote_subst='s/\([\\`\\&quot;$\\\\]\)/\\\1/g'
-SP2NL='tr \040 \012'
-NL2SP='tr \015\012 \040\040'
-
-# NLS nuisances.
-# Only set LANG and LC_ALL to C if already set.
-# These must not be set unconditionally because not all systems understand
-# e.g. LANG=C (notably SCO).
-# We save the old values to restore during execute mode.
-if test &quot;${LC_ALL+set}&quot; = set; then
-  save_LC_ALL=&quot;$LC_ALL&quot;; LC_ALL=C; export LC_ALL
-fi
-if test &quot;${LANG+set}&quot; = set; then
-  save_LANG=&quot;$LANG&quot;; LANG=C; export LANG
-fi
-
-# Make sure IFS has a sensible default
-: ${IFS=&quot; 	&quot;}
-
-if test &quot;$build_libtool_libs&quot; != yes &amp;&amp; test &quot;$build_old_libs&quot; != yes; then
-  echo &quot;$modename: not configured to build any kind of library&quot; 1&gt;&amp;2
-  echo &quot;Fatal configuration error.  See the $PACKAGE docs for more information.&quot; 1&gt;&amp;2
-  exit 1
+VERSION=&quot;2.4 Debian-2.4-2&quot;
+TIMESTAMP=&quot;&quot;
+package_revision=1.3293
+
+# Be Bourne compatible
+if test -n &quot;${ZSH_VERSION+set}&quot; &amp;&amp; (emulate sh) &gt;/dev/null 2&gt;&amp;1; then
+  emulate sh
+  NULLCMD=:
+  # Zsh 3.x and 4.x performs word splitting on ${1+&quot;$@&quot;}, which
+  # is contrary to our usage.  Disable this feature.
+  alias -g '${1+&quot;$@&quot;}'='&quot;$@&quot;'
+  setopt NO_GLOB_SUBST
+else
+  case `(set -o) 2&gt;/dev/null` in *posix*) set -o posix;; esac
 fi
+BIN_SH=xpg4; export BIN_SH # for Tru64
+DUALCASE=1; export DUALCASE # for MKS sh
+
+# A function that is used when there is no print builtin or printf.
+func_fallback_echo ()
+{
+  eval 'cat &lt;&lt;_LTECHO_EOF
+$1
+_LTECHO_EOF'
+}
 
-# Global variables.
-mode=$default_mode
-nonopt=
-prev=
-prevopt=
-run=
-show=&quot;$echo&quot;
-show_help=
-execute_dlfiles=
-lo2o=&quot;s/\\.lo\$/.${objext}/&quot;
-o2lo=&quot;s/\\.${objext}\$/.lo/&quot;
-
-# Parse our command line options once, thoroughly.
-while test $# -gt 0
+# NLS nuisances: We save the old values to restore during execute mode.
+lt_user_locale=
+lt_safe_locale=
+for lt_var in LANG LANGUAGE LC_ALL LC_CTYPE LC_COLLATE LC_MESSAGES
 do
-  arg=&quot;$1&quot;
-  shift
+  eval &quot;if test \&quot;\${$lt_var+set}\&quot; = set; then
+          save_$lt_var=\$$lt_var
+          $lt_var=C
+	  export $lt_var
+	  lt_user_locale=\&quot;$lt_var=\\\$save_\$lt_var; \$lt_user_locale\&quot;
+	  lt_safe_locale=\&quot;$lt_var=C; \$lt_safe_locale\&quot;
+	fi&quot;
+done
+LC_ALL=C
+LANGUAGE=C
+export LANGUAGE LC_ALL
 
-  case $arg in
-  -*=*) optarg=`$echo &quot;X$arg&quot; | $Xsed -e 's/[-_a-zA-Z0-9]*=//'` ;;
-  *) optarg= ;;
-  esac
+$lt_unset CDPATH
 
-  # If the previous option needs an argument, assign it.
-  if test -n &quot;$prev&quot;; then
-    case $prev in
-    execute_dlfiles)
-      execute_dlfiles=&quot;$execute_dlfiles $arg&quot;
-      ;;
-    *)
-      eval &quot;$prev=\$arg&quot;
-      ;;
-    esac
 
-    prev=
-    prevopt=
-    continue
-  fi
+# Work around backward compatibility issue on IRIX 6.5. On IRIX 6.4+, sh
+# is ksh but when the shell is invoked as &quot;sh&quot; and the current value of
+# the _XPG environment variable is not equal to 1 (one), the special
+# positional parameter $0, within a function call, is the name of the
+# function.
+progpath=&quot;$0&quot;
 
-  # Have we seen a non-optional argument yet?
-  case $arg in
-  --help)
-    show_help=yes
-    ;;
 
-  --version)
-    echo &quot;$PROGRAM (GNU $PACKAGE) $VERSION$TIMESTAMP&quot;
-    exit 0
-    ;;
 
-  --config)
-    sed -e '1,/^# ### BEGIN LIBTOOL CONFIG/d' -e '/^# ### END LIBTOOL CONFIG/,$d' $0
-    exit 0
-    ;;
+: ${CP=&quot;cp -f&quot;}
+test &quot;${ECHO+set}&quot; = set || ECHO=${as_echo-'printf %s\n'}
+: ${EGREP=&quot;/bin/grep -E&quot;}
+: ${FGREP=&quot;/bin/grep -F&quot;}
+: ${GREP=&quot;/bin/grep&quot;}
+: ${LN_S=&quot;ln -s&quot;}
+: ${MAKE=&quot;make&quot;}
+: ${MKDIR=&quot;mkdir&quot;}
+: ${MV=&quot;mv -f&quot;}
+: ${RM=&quot;rm -f&quot;}
+: ${SED=&quot;/bin/sed&quot;}
+: ${SHELL=&quot;${CONFIG_SHELL-/bin/sh}&quot;}
+: ${Xsed=&quot;$SED -e 1s/^X//&quot;}
 
-  --debug)
-    echo &quot;$progname: enabling shell trace mode&quot;
-    set -x
-    ;;
+# Global variables:
+EXIT_SUCCESS=0
+EXIT_FAILURE=1
+EXIT_MISMATCH=63  # $? = 63 is used to indicate version mismatch to missing.
+EXIT_SKIP=77	  # $? = 77 is used to indicate a skipped test to automake.
 
-  --dry-run | -n)
-    run=:
-    ;;
+exit_status=$EXIT_SUCCESS
 
-  --features)
-    echo &quot;host: $host&quot;
-    if test &quot;$build_libtool_libs&quot; = yes; then
-      echo &quot;enable shared libraries&quot;
+# Make sure IFS has a sensible default
+lt_nl='
+'
+IFS=&quot; 	$lt_nl&quot;
+
+dirname=&quot;s,/[^/]*$,,&quot;
+basename=&quot;s,^.*/,,&quot;
+
+# func_dirname file append nondir_replacement
+# Compute the dirname of FILE.  If nonempty, add APPEND to the result,
+# otherwise set result to NONDIR_REPLACEMENT.
+func_dirname ()
+{
+    func_dirname_result=`$ECHO &quot;${1}&quot; | $SED &quot;$dirname&quot;`
+    if test &quot;X$func_dirname_result&quot; = &quot;X${1}&quot;; then
+      func_dirname_result=&quot;${3}&quot;
     else
-      echo &quot;disable shared libraries&quot;
+      func_dirname_result=&quot;$func_dirname_result${2}&quot;
     fi
-    if test &quot;$build_old_libs&quot; = yes; then
-      echo &quot;enable static libraries&quot;
+} # func_dirname may be replaced by extended shell implementation
+
+
+# func_basename file
+func_basename ()
+{
+    func_basename_result=`$ECHO &quot;${1}&quot; | $SED &quot;$basename&quot;`
+} # func_basename may be replaced by extended shell implementation
+
+
+# func_dirname_and_basename file append nondir_replacement
+# perform func_basename and func_dirname in a single function
+# call:
+#   dirname:  Compute the dirname of FILE.  If nonempty,
+#             add APPEND to the result, otherwise set result
+#             to NONDIR_REPLACEMENT.
+#             value returned in &quot;$func_dirname_result&quot;
+#   basename: Compute filename of FILE.
+#             value retuned in &quot;$func_basename_result&quot;
+# Implementation must be kept synchronized with func_dirname
+# and func_basename. For efficiency, we do not delegate to
+# those functions but instead duplicate the functionality here.
+func_dirname_and_basename ()
+{
+    # Extract subdirectory from the argument.
+    func_dirname_result=`$ECHO &quot;${1}&quot; | $SED -e &quot;$dirname&quot;`
+    if test &quot;X$func_dirname_result&quot; = &quot;X${1}&quot;; then
+      func_dirname_result=&quot;${3}&quot;
     else
-      echo &quot;disable static libraries&quot;
+      func_dirname_result=&quot;$func_dirname_result${2}&quot;
     fi
-    exit 0
+    func_basename_result=`$ECHO &quot;${1}&quot; | $SED -e &quot;$basename&quot;`
+} # func_dirname_and_basename may be replaced by extended shell implementation
+
+
+# func_stripname prefix suffix name
+# strip PREFIX and SUFFIX off of NAME.
+# PREFIX and SUFFIX must not contain globbing or regex special
+# characters, hashes, percent signs, but SUFFIX may contain a leading
+# dot (in which case that matches only a dot).
+# func_strip_suffix prefix name
+func_stripname ()
+{
+    case ${2} in
+      .*) func_stripname_result=`$ECHO &quot;${3}&quot; | $SED &quot;s%^${1}%%; s%\\\\${2}\$%%&quot;`;;
+      *)  func_stripname_result=`$ECHO &quot;${3}&quot; | $SED &quot;s%^${1}%%; s%${2}\$%%&quot;`;;
+    esac
+} # func_stripname may be replaced by extended shell implementation
+
+
+# These SED scripts presuppose an absolute path with a trailing slash.
+pathcar='s,^/\([^/]*\).*$,\1,'
+pathcdr='s,^/[^/]*,,'
+removedotparts=':dotsl
+		s@/\./@/@g
+		t dotsl
+		s,/\.$,/,'
+collapseslashes='s@/\{1,\}@/@g'
+finalslash='s,/*$,/,'
+
+# func_normal_abspath PATH
+# Remove doubled-up and trailing slashes, &quot;.&quot; path components,
+# and cancel out any &quot;..&quot; path components in PATH after making
+# it an absolute path.
+#             value returned in &quot;$func_normal_abspath_result&quot;
+func_normal_abspath ()
+{
+  # Start from root dir and reassemble the path.
+  func_normal_abspath_result=
+  func_normal_abspath_tpath=$1
+  func_normal_abspath_altnamespace=
+  case $func_normal_abspath_tpath in
+    &quot;&quot;)
+      # Empty path, that just means $cwd.
+      func_stripname '' '/' &quot;`pwd`&quot;
+      func_normal_abspath_result=$func_stripname_result
+      return
     ;;
-
-  --finish) mode=&quot;finish&quot; ;;
-
-  --mode) prevopt=&quot;--mode&quot; prev=mode ;;
-  --mode=*) mode=&quot;$optarg&quot; ;;
-
-  --quiet | --silent)
-    show=:
+    # The next three entries are used to spot a run of precisely
+    # two leading slashes without using negated character classes;
+    # we take advantage of case's first-match behaviour.
+    ///*)
+      # Unusual form of absolute path, do nothing.
     ;;
-
-  -dlopen)
-    prevopt=&quot;-dlopen&quot;
-    prev=execute_dlfiles
+    //*)
+      # Not necessarily an ordinary path; POSIX reserves leading '//'
+      # and for example Cygwin uses it to access remote file shares
+      # over CIFS/SMB, so we conserve a leading double slash if found.
+      func_normal_abspath_altnamespace=/
     ;;
-
-  -*)
-    $echo &quot;$modename: unrecognized option \`$arg'&quot; 1&gt;&amp;2
-    $echo &quot;$help&quot; 1&gt;&amp;2
-    exit 1
+    /*)
+      # Absolute path, do nothing.
     ;;
-
-  *)
-    nonopt=&quot;$arg&quot;
-    break
+    *)
+      # Relative path, prepend $cwd.
+      func_normal_abspath_tpath=`pwd`/$func_normal_abspath_tpath
     ;;
   esac
-done
-
-if test -n &quot;$prevopt&quot;; then
-  $echo &quot;$modename: option \`$prevopt' requires an argument&quot; 1&gt;&amp;2
-  $echo &quot;$help&quot; 1&gt;&amp;2
-  exit 1
-fi
-
-# If this variable is set in any of the actions, the command in it
-# will be execed at the end.  This prevents here-documents from being
-# left over by shells.
-exec_cmd=
-
-if test -z &quot;$show_help&quot;; then
-
-  # Infer the operation mode.
-  if test -z &quot;$mode&quot;; then
-    case $nonopt in
-    *cc | *++ | gcc* | *-gcc*)
-      mode=link
-      for arg
-      do
-	case $arg in
-	-c)
-	   mode=compile
-	   break
-	   ;;
-	esac
-      done
-      ;;
-    *db | *dbx | *strace | *truss)
-      mode=execute
+  # Cancel out all the simple stuff to save iterations.  We also want
+  # the path to end with a slash for ease of parsing, so make sure
+  # there is one (and only one) here.
+  func_normal_abspath_tpath=`$ECHO &quot;$func_normal_abspath_tpath&quot; | $SED \
+        -e &quot;$removedotparts&quot; -e &quot;$collapseslashes&quot; -e &quot;$finalslash&quot;`
+  while :; do
+    # Processed it all yet?
+    if test &quot;$func_normal_abspath_tpath&quot; = / ; then
+      # If we ascended to the root using &quot;..&quot; the result may be empty now.
+      if test -z &quot;$func_normal_abspath_result&quot; ; then
+        func_normal_abspath_result=/
+      fi
+      break
+    fi
+    func_normal_abspath_tcomponent=`$ECHO &quot;$func_normal_abspath_tpath&quot; | $SED \
+        -e &quot;$pathcar&quot;`
+    func_normal_abspath_tpath=`$ECHO &quot;$func_normal_abspath_tpath&quot; | $SED \
+        -e &quot;$pathcdr&quot;`
+    # Figure out what to do with it
+    case $func_normal_abspath_tcomponent in
+      &quot;&quot;)
+        # Trailing empty path component, ignore it.
       ;;
-    *install*|cp|mv)
-      mode=install
+      ..)
+        # Parent dir; strip last assembled component from result.
+        func_dirname &quot;$func_normal_abspath_result&quot;
+        func_normal_abspath_result=$func_dirname_result
       ;;
-    *rm)
-      mode=uninstall
+      *)
+        # Actual path component, append it.
+        func_normal_abspath_result=$func_normal_abspath_result/$func_normal_abspath_tcomponent
       ;;
-    *)
-      # If we have no mode, but dlfiles were specified, then do execute mode.
-      test -n &quot;$execute_dlfiles&quot; &amp;&amp; mode=execute
+    esac
+  done
+  # Restore leading double-slash if one was found on entry.
+  func_normal_abspath_result=$func_normal_abspath_altnamespace$func_normal_abspath_result
+}
 
-      # Just use the default operation mode.
-      if test -z &quot;$mode&quot;; then
-	if test -n &quot;$nonopt&quot;; then
-	  $echo &quot;$modename: warning: cannot infer operation mode from \`$nonopt'&quot; 1&gt;&amp;2
-	else
-	  $echo &quot;$modename: warning: cannot infer operation mode without MODE-ARGS&quot; 1&gt;&amp;2
-	fi
-      fi
-      ;;
+# func_relative_path SRCDIR DSTDIR
+# generates a relative path from SRCDIR to DSTDIR, with a trailing
+# slash if non-empty, suitable for immediately appending a filename
+# without needing to append a separator.
+#             value returned in &quot;$func_relative_path_result&quot;
+func_relative_path ()
+{
+  func_relative_path_result=
+  func_normal_abspath &quot;$1&quot;
+  func_relative_path_tlibdir=$func_normal_abspath_result
+  func_normal_abspath &quot;$2&quot;
+  func_relative_path_tbindir=$func_normal_abspath_result
+
+  # Ascend the tree starting from libdir
+  while :; do
+    # check if we have found a prefix of bindir
+    case $func_relative_path_tbindir in
+      $func_relative_path_tlibdir)
+        # found an exact match
+        func_relative_path_tcancelled=
+        break
+        ;;
+      $func_relative_path_tlibdir*)
+        # found a matching prefix
+        func_stripname &quot;$func_relative_path_tlibdir&quot; '' &quot;$func_relative_path_tbindir&quot;
+        func_relative_path_tcancelled=$func_stripname_result
+        if test -z &quot;$func_relative_path_result&quot;; then
+          func_relative_path_result=.
+        fi
+        break
+        ;;
+      *)
+        func_dirname $func_relative_path_tlibdir
+        func_relative_path_tlibdir=${func_dirname_result}
+        if test &quot;x$func_relative_path_tlibdir&quot; = x ; then
+          # Have to descend all the way to the root!
+          func_relative_path_result=../$func_relative_path_result
+          func_relative_path_tcancelled=$func_relative_path_tbindir
+          break
+        fi
+        func_relative_path_result=../$func_relative_path_result
+        ;;
     esac
+  done
+
+  # Now calculate path; take care to avoid doubling-up slashes.
+  func_stripname '' '/' &quot;$func_relative_path_result&quot;
+  func_relative_path_result=$func_stripname_result
+  func_stripname '/' '/' &quot;$func_relative_path_tcancelled&quot;
+  if test &quot;x$func_stripname_result&quot; != x ; then
+    func_relative_path_result=${func_relative_path_result}/${func_stripname_result}
   fi
 
-  # Only execute mode is allowed to have -dlopen flags.
-  if test -n &quot;$execute_dlfiles&quot; &amp;&amp; test &quot;$mode&quot; != execute; then
-    $echo &quot;$modename: unrecognized option \`-dlopen'&quot; 1&gt;&amp;2
-    $echo &quot;$help&quot; 1&gt;&amp;2
-    exit 1
+  # Normalisation. If bindir is libdir, return empty string,
+  # else relative path ending with a slash; either way, target
+  # file name can be directly appended.
+  if test ! -z &quot;$func_relative_path_result&quot;; then
+    func_stripname './' '' &quot;$func_relative_path_result/&quot;
+    func_relative_path_result=$func_stripname_result
   fi
+}
 
-  # Change the help message to a mode-specific one.
-  generic_help=&quot;$help&quot;
-  help=&quot;Try \`$modename --help --mode=$mode' for more information.&quot;
+# The name of this program:
+func_dirname_and_basename &quot;$progpath&quot;
+progname=$func_basename_result
+
+# Make sure we have an absolute path for reexecution:
+case $progpath in
+  [\\/]*|[A-Za-z]:\\*) ;;
+  *[\\/]*)
+     progdir=$func_dirname_result
+     progdir=`cd &quot;$progdir&quot; &amp;&amp; pwd`
+     progpath=&quot;$progdir/$progname&quot;
+     ;;
+  *)
+     save_IFS=&quot;$IFS&quot;
+     IFS=:
+     for progdir in $PATH; do
+       IFS=&quot;$save_IFS&quot;
+       test -x &quot;$progdir/$progname&quot; &amp;&amp; break
+     done
+     IFS=&quot;$save_IFS&quot;
+     test -n &quot;$progdir&quot; || progdir=`pwd`
+     progpath=&quot;$progdir/$progname&quot;
+     ;;
+esac
 
-  # These modes are in order of execution frequency so that they run quickly.
-  case $mode in
-  # libtool compile mode
-  compile)
-    modename=&quot;$modename: compile&quot;
-    # Get the compilation command and the source file.
-    base_compile=
-    prev=
-    lastarg=
-    srcfile=&quot;$nonopt&quot;
-    suppress_output=
+# Sed substitution that helps us do robust quoting.  It backslashifies
+# metacharacters that are still active within double-quoted strings.
+Xsed=&quot;${SED}&quot;' -e 1s/^X//'
+sed_quote_subst='s/\([`&quot;$\\]\)/\\\1/g'
+
+# Same as above, but do not quote variable references.
+double_quote_subst='s/\([&quot;`\\]\)/\\\1/g'
+
+# Sed substitution that turns a string into a regex matching for the
+# string literally.
+sed_make_literal_regex='s,[].[^$\\*\/],\\&amp;,g'
+
+# Sed substitution that converts a w32 file name or path
+# which contains forward slashes, into one that contains
+# (escaped) backslashes.  A very naive implementation.
+lt_sed_naive_backslashify='s|\\\\*|\\|g;s|/|\\|g;s|\\|\\\\|g'
+
+# Re-`\' parameter expansions in output of double_quote_subst that were
+# `\'-ed in input to the same.  If an odd number of `\' preceded a '$'
+# in input to double_quote_subst, that '$' was protected from expansion.
+# Since each input `\' is now two `\'s, look for any number of runs of
+# four `\'s followed by two `\'s and then a '$'.  `\' that '$'.
+bs='\\'
+bs2='\\\\'
+bs4='\\\\\\\\'
+dollar='\$'
+sed_double_backslash=&quot;\
+  s/$bs4/&amp;\\
+/g
+  s/^$bs2$dollar/$bs&amp;/
+  s/\\([^$bs]\\)$bs2$dollar/\\1$bs2$bs$dollar/g
+  s/\n//g&quot;
+
+# Standard options:
+opt_dry_run=false
+opt_help=false
+opt_quiet=false
+opt_verbose=false
+opt_warning=:
+
+# func_echo arg...
+# Echo program name prefixed message, along with the current mode
+# name if it has been set yet.
+func_echo ()
+{
+    $ECHO &quot;$progname: ${opt_mode+$opt_mode: }$*&quot;
+}
 
-    user_target=no
-    for arg
-    do
-      case $prev in
-      &quot;&quot;) ;;
-      xcompiler)
-	# Aesthetically quote the previous argument.
-	prev=
-	lastarg=`$echo &quot;X$arg&quot; | $Xsed -e &quot;$sed_quote_subst&quot;`
+# func_verbose arg...
+# Echo program name prefixed message in verbose mode only.
+func_verbose ()
+{
+    $opt_verbose &amp;&amp; func_echo ${1+&quot;$@&quot;}
 
-	case $arg in
-	# Double-quote args containing other shell metacharacters.
-	# Many Bourne shells cannot handle close brackets correctly
-	# in scan sets, so we specify it separately.
-	*[\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;&quot;)
-	  arg=&quot;\&quot;$arg\&quot;&quot;
-	  ;;
-	esac
+    # A bug in bash halts the script if the last line of a function
+    # fails when set -e is in force, so we need another command to
+    # work around that:
+    :
+}
 
-	# Add the previous argument to base_compile.
-	if test -z &quot;$base_compile&quot;; then
-	  base_compile=&quot;$lastarg&quot;
-	else
-	  base_compile=&quot;$base_compile $lastarg&quot;
-	fi
-	continue
-	;;
-      esac
+# func_echo_all arg...
+# Invoke $ECHO with all args, space-separated.
+func_echo_all ()
+{
+    $ECHO &quot;$*&quot;
+}
 
-      # Accept any command-line options.
-      case $arg in
-      -o)
-	if test &quot;$user_target&quot; != &quot;no&quot;; then
-	  $echo &quot;$modename: you cannot specify \`-o' more than once&quot; 1&gt;&amp;2
-	  exit 1
-	fi
-	user_target=next
-	;;
+# func_error arg...
+# Echo program name prefixed message to standard error.
+func_error ()
+{
+    $ECHO &quot;$progname: ${opt_mode+$opt_mode: }&quot;${1+&quot;$@&quot;} 1&gt;&amp;2
+}
 
-      -static)
-	build_old_libs=yes
-	continue
-	;;
+# func_warning arg...
+# Echo program name prefixed warning message to standard error.
+func_warning ()
+{
+    $opt_warning &amp;&amp; $ECHO &quot;$progname: ${opt_mode+$opt_mode: }warning: &quot;${1+&quot;$@&quot;} 1&gt;&amp;2
 
-      -prefer-pic)
-	pic_mode=yes
-	continue
-	;;
+    # bash bug again:
+    :
+}
 
-      -prefer-non-pic)
-	pic_mode=no
-	continue
-	;;
+# func_fatal_error arg...
+# Echo program name prefixed message to standard error, and exit.
+func_fatal_error ()
+{
+    func_error ${1+&quot;$@&quot;}
+    exit $EXIT_FAILURE
+}
 
-      -Xcompiler)
-	prev=xcompiler
-	continue
-	;;
+# func_fatal_help arg...
+# Echo program name prefixed message to standard error, followed by
+# a help hint, and exit.
+func_fatal_help ()
+{
+    func_error ${1+&quot;$@&quot;}
+    func_fatal_error &quot;$help&quot;
+}
+help=&quot;Try \`$progname --help' for more information.&quot;  ## default
 
-      -Wc,*)
-	args=`$echo &quot;X$arg&quot; | $Xsed -e &quot;s/^-Wc,//&quot;`
-	lastarg=
-	save_ifs=&quot;$IFS&quot;; IFS=','
-	for arg in $args; do
-	  IFS=&quot;$save_ifs&quot;
 
-	  # Double-quote args containing other shell metacharacters.
-	  # Many Bourne shells cannot handle close brackets correctly
-	  # in scan sets, so we specify it separately.
-	  case $arg in
-	    *[\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;&quot;)
-	    arg=&quot;\&quot;$arg\&quot;&quot;
-	    ;;
-	  esac
-	  lastarg=&quot;$lastarg $arg&quot;
-	done
-	IFS=&quot;$save_ifs&quot;
-	lastarg=`$echo &quot;X$lastarg&quot; | $Xsed -e &quot;s/^ //&quot;`
+# func_grep expression filename
+# Check whether EXPRESSION matches any line of FILENAME, without output.
+func_grep ()
+{
+    $GREP &quot;$1&quot; &quot;$2&quot; &gt;/dev/null 2&gt;&amp;1
+}
 
-	# Add the arguments to base_compile.
-	if test -z &quot;$base_compile&quot;; then
-	  base_compile=&quot;$lastarg&quot;
-	else
-	  base_compile=&quot;$base_compile $lastarg&quot;
-	fi
-	continue
-	;;
-      esac
 
-      case $user_target in
-      next)
-	# The next one is the -o target name
-	user_target=yes
-	continue
-	;;
-      yes)
-	# We got the output file
-	user_target=set
-	libobj=&quot;$arg&quot;
-	continue
-	;;
+# func_mkdir_p directory-path
+# Make sure the entire path to DIRECTORY-PATH is available.
+func_mkdir_p ()
+{
+    my_directory_path=&quot;$1&quot;
+    my_dir_list=
+
+    if test -n &quot;$my_directory_path&quot; &amp;&amp; test &quot;$opt_dry_run&quot; != &quot;:&quot;; then
+
+      # Protect directory names starting with `-'
+      case $my_directory_path in
+        -*) my_directory_path=&quot;./$my_directory_path&quot; ;;
       esac
 
-      # Accept the current argument as the source file.
-      lastarg=&quot;$srcfile&quot;
-      srcfile=&quot;$arg&quot;
+      # While some portion of DIR does not yet exist...
+      while test ! -d &quot;$my_directory_path&quot;; do
+        # ...make a list in topmost first order.  Use a colon delimited
+	# list incase some portion of path contains whitespace.
+        my_dir_list=&quot;$my_directory_path:$my_dir_list&quot;
+
+        # If the last portion added has no slash in it, the list is done
+        case $my_directory_path in */*) ;; *) break ;; esac
+
+        # ...otherwise throw away the child directory and loop
+        my_directory_path=`$ECHO &quot;$my_directory_path&quot; | $SED -e &quot;$dirname&quot;`
+      done
+      my_dir_list=`$ECHO &quot;$my_dir_list&quot; | $SED 's,:*$,,'`
+
+      save_mkdir_p_IFS=&quot;$IFS&quot;; IFS=':'
+      for my_dir in $my_dir_list; do
+	IFS=&quot;$save_mkdir_p_IFS&quot;
+        # mkdir can fail with a `File exist' error if two processes
+        # try to create one of the directories concurrently.  Don't
+        # stop in that case!
+        $MKDIR &quot;$my_dir&quot; 2&gt;/dev/null || :
+      done
+      IFS=&quot;$save_mkdir_p_IFS&quot;
+
+      # Bail out if we (or some other process) failed to create a directory.
+      test -d &quot;$my_directory_path&quot; || \
+        func_fatal_error &quot;Failed to create \`$1'&quot;
+    fi
+}
+
+
+# func_mktempdir [string]
+# Make a temporary directory that won't clash with other running
+# libtool processes, and avoids race conditions if possible.  If
+# given, STRING is the basename for that directory.
+func_mktempdir ()
+{
+    my_template=&quot;${TMPDIR-/tmp}/${1-$progname}&quot;
+
+    if test &quot;$opt_dry_run&quot; = &quot;:&quot;; then
+      # Return a directory name, but don't create it in dry-run mode
+      my_tmpdir=&quot;${my_template}-$$&quot;
+    else
+
+      # If mktemp works, use that first and foremost
+      my_tmpdir=`mktemp -d &quot;${my_template}-XXXXXXXX&quot; 2&gt;/dev/null`
+
+      if test ! -d &quot;$my_tmpdir&quot;; then
+        # Failing that, at least try and use $RANDOM to avoid a race
+        my_tmpdir=&quot;${my_template}-${RANDOM-0}$$&quot;
+
+        save_mktempdir_umask=`umask`
+        umask 0077
+        $MKDIR &quot;$my_tmpdir&quot;
+        umask $save_mktempdir_umask
+      fi
+
+      # If we're not in dry-run mode, bomb out on failure
+      test -d &quot;$my_tmpdir&quot; || \
+        func_fatal_error &quot;cannot create temporary directory \`$my_tmpdir'&quot;
+    fi
+
+    $ECHO &quot;$my_tmpdir&quot;
+}
 
-      # Aesthetically quote the previous argument.
 
-      # Backslashify any backslashes, double quotes, and dollar signs.
-      # These are the only characters that are still specially
-      # interpreted inside of double-quoted scrings.
-      lastarg=`$echo &quot;X$lastarg&quot; | $Xsed -e &quot;$sed_quote_subst&quot;`
+# func_quote_for_eval arg
+# Aesthetically quote ARG to be evaled later.
+# This function returns two values: FUNC_QUOTE_FOR_EVAL_RESULT
+# is double-quoted, suitable for a subsequent eval, whereas
+# FUNC_QUOTE_FOR_EVAL_UNQUOTED_RESULT has merely all characters
+# which are still active within double quotes backslashified.
+func_quote_for_eval ()
+{
+    case $1 in
+      *[\\\`\&quot;\$]*)
+	func_quote_for_eval_unquoted_result=`$ECHO &quot;$1&quot; | $SED &quot;$sed_quote_subst&quot;` ;;
+      *)
+        func_quote_for_eval_unquoted_result=&quot;$1&quot; ;;
+    esac
 
-      # Double-quote args containing other shell metacharacters.
+    case $func_quote_for_eval_unquoted_result in
+      # Double-quote args containing shell metacharacters to delay
+      # word splitting, command substitution and and variable
+      # expansion for a subsequent eval.
       # Many Bourne shells cannot handle close brackets correctly
       # in scan sets, so we specify it separately.
-      case $lastarg in
       *[\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;&quot;)
-	lastarg=&quot;\&quot;$lastarg\&quot;&quot;
-	;;
-      esac
+        func_quote_for_eval_result=&quot;\&quot;$func_quote_for_eval_unquoted_result\&quot;&quot;
+        ;;
+      *)
+        func_quote_for_eval_result=&quot;$func_quote_for_eval_unquoted_result&quot;
+    esac
+}
 
-      # Add the previous argument to base_compile.
-      if test -z &quot;$base_compile&quot;; then
-	base_compile=&quot;$lastarg&quot;
-      else
-	base_compile=&quot;$base_compile $lastarg&quot;
-      fi
-    done
 
-    case $user_target in
-    set)
-      ;;
-    no)
-      # Get the name of the library object.
-      libobj=`$echo &quot;X$srcfile&quot; | $Xsed -e 's%^.*/%%'`
-      ;;
-    *)
-      $echo &quot;$modename: you must specify a target with \`-o'&quot; 1&gt;&amp;2
-      exit 1
-      ;;
+# func_quote_for_expand arg
+# Aesthetically quote ARG to be evaled later; same as above,
+# but do not quote variable references.
+func_quote_for_expand ()
+{
+    case $1 in
+      *[\\\`\&quot;]*)
+	my_arg=`$ECHO &quot;$1&quot; | $SED \
+	    -e &quot;$double_quote_subst&quot; -e &quot;$sed_double_backslash&quot;` ;;
+      *)
+        my_arg=&quot;$1&quot; ;;
     esac
 
-    # Recognize several different file suffixes.
-    # If the user specifies -o file.o, it is replaced with file.lo
-    xform='[cCFSfmso]'
-    case $libobj in
-    *.ada) xform=ada ;;
-    *.adb) xform=adb ;;
-    *.ads) xform=ads ;;
-    *.asm) xform=asm ;;
-    *.c++) xform=c++ ;;
-    *.cc) xform=cc ;;
-    *.cpp) xform=cpp ;;
-    *.cxx) xform=cxx ;;
-    *.f90) xform=f90 ;;
-    *.for) xform=for ;;
+    case $my_arg in
+      # Double-quote args containing shell metacharacters to delay
+      # word splitting and command substitution for a subsequent eval.
+      # Many Bourne shells cannot handle close brackets correctly
+      # in scan sets, so we specify it separately.
+      *[\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;&quot;)
+        my_arg=&quot;\&quot;$my_arg\&quot;&quot;
+        ;;
     esac
 
-    libobj=`$echo &quot;X$libobj&quot; | $Xsed -e &quot;s/\.$xform$/.lo/&quot;`
+    func_quote_for_expand_result=&quot;$my_arg&quot;
+}
 
-    case $libobj in
-    *.lo) obj=`$echo &quot;X$libobj&quot; | $Xsed -e &quot;$lo2o&quot;` ;;
-    *)
-      $echo &quot;$modename: cannot determine name of library object from \`$libobj'&quot; 1&gt;&amp;2
-      exit 1
-      ;;
-    esac
 
-    if test -z &quot;$base_compile&quot;; then
-      $echo &quot;$modename: you must specify a compilation command&quot; 1&gt;&amp;2
-      $echo &quot;$help&quot; 1&gt;&amp;2
-      exit 1
+# func_show_eval cmd [fail_exp]
+# Unless opt_silent is true, then output CMD.  Then, if opt_dryrun is
+# not true, evaluate CMD.  If the evaluation of CMD fails, and FAIL_EXP
+# is given, then evaluate it.
+func_show_eval ()
+{
+    my_cmd=&quot;$1&quot;
+    my_fail_exp=&quot;${2-:}&quot;
+
+    ${opt_silent-false} || {
+      func_quote_for_expand &quot;$my_cmd&quot;
+      eval &quot;func_echo $func_quote_for_expand_result&quot;
+    }
+
+    if ${opt_dry_run-false}; then :; else
+      eval &quot;$my_cmd&quot;
+      my_status=$?
+      if test &quot;$my_status&quot; -eq 0; then :; else
+	eval &quot;(exit $my_status); $my_fail_exp&quot;
+      fi
     fi
+}
 
-    # Delete any leftover library objects.
-    if test &quot;$build_old_libs&quot; = yes; then
-      removelist=&quot;$obj $libobj&quot;
-    else
-      removelist=&quot;$libobj&quot;
+
+# func_show_eval_locale cmd [fail_exp]
+# Unless opt_silent is true, then output CMD.  Then, if opt_dryrun is
+# not true, evaluate CMD.  If the evaluation of CMD fails, and FAIL_EXP
+# is given, then evaluate it.  Use the saved locale for evaluation.
+func_show_eval_locale ()
+{
+    my_cmd=&quot;$1&quot;
+    my_fail_exp=&quot;${2-:}&quot;
+
+    ${opt_silent-false} || {
+      func_quote_for_expand &quot;$my_cmd&quot;
+      eval &quot;func_echo $func_quote_for_expand_result&quot;
+    }
+
+    if ${opt_dry_run-false}; then :; else
+      eval &quot;$lt_user_locale
+	    $my_cmd&quot;
+      my_status=$?
+      eval &quot;$lt_safe_locale&quot;
+      if test &quot;$my_status&quot; -eq 0; then :; else
+	eval &quot;(exit $my_status); $my_fail_exp&quot;
+      fi
     fi
+}
 
-    $run $rm $removelist
-    trap &quot;$run $rm $removelist; exit 1&quot; 1 2 15
+# func_tr_sh
+# Turn $1 into a string suitable for a shell variable name.
+# Result is stored in $func_tr_sh_result.  All characters
+# not in the set a-zA-Z0-9_ are replaced with '_'. Further,
+# if $1 begins with a digit, a '_' is prepended as well.
+func_tr_sh ()
+{
+  case $1 in
+  [0-9]* | *[!a-zA-Z0-9_]*)
+    func_tr_sh_result=`$ECHO &quot;$1&quot; | $SED 's/^\([0-9]\)/_\1/; s/[^a-zA-Z0-9_]/_/g'`
+    ;;
+  * )
+    func_tr_sh_result=$1
+    ;;
+  esac
+}
 
-    # On Cygwin there's no &quot;real&quot; PIC flag so we must build both object types
-    case $host_os in
-    cygwin* | mingw* | pw32* | os2*)
-      pic_mode=default
-      ;;
-    esac
-    if test $pic_mode = no &amp;&amp; test &quot;$deplibs_check_method&quot; != pass_all; then
-      # non-PIC code in shared libraries is not supported
-      pic_mode=default
-    fi
 
-    # Calculate the filename of the output object if compiler does
-    # not support -o with -c
-    if test &quot;$compiler_c_o&quot; = no; then
-      output_obj=`$echo &quot;X$srcfile&quot; | $Xsed -e 's%^.*/%%' -e 's%\.[^.]*$%%'`.${objext}
-      lockfile=&quot;$output_obj.lock&quot;
-      removelist=&quot;$removelist $output_obj $lockfile&quot;
-      trap &quot;$run $rm $removelist; exit 1&quot; 1 2 15
-    else
-      need_locks=no
-      lockfile=
+# func_version
+# Echo version message to standard output and exit.
+func_version ()
+{
+    $opt_debug
+
+    $SED -n '/(C)/!b go
+	:more
+	/\./!{
+	  N
+	  s/\n# / /
+	  b more
+	}
+	:go
+	/^# '$PROGRAM' (GNU /,/# warranty; / {
+        s/^# //
+	s/^# *$//
+        s/\((C)\)[ 0-9,-]*\( [1-9][0-9]*\)/\1\2/
+        p
+     }' &lt; &quot;$progpath&quot;
+     exit $?
+}
+
+# func_usage
+# Echo short help message to standard output and exit.
+func_usage ()
+{
+    $opt_debug
+
+    $SED -n '/^# Usage:/,/^#  *.*--help/ {
+        s/^# //
+	s/^# *$//
+	s/\$progname/'$progname'/
+	p
+    }' &lt; &quot;$progpath&quot;
+    echo
+    $ECHO &quot;run \`$progname --help | more' for full usage&quot;
+    exit $?
+}
+
+# func_help [NOEXIT]
+# Echo long help message to standard output and exit,
+# unless 'noexit' is passed as argument.
+func_help ()
+{
+    $opt_debug
+
+    $SED -n '/^# Usage:/,/# Report bugs to/ {
+	:print
+        s/^# //
+	s/^# *$//
+	s*\$progname*'$progname'*
+	s*\$host*'&quot;$host&quot;'*
+	s*\$SHELL*'&quot;$SHELL&quot;'*
+	s*\$LTCC*'&quot;$LTCC&quot;'*
+	s*\$LTCFLAGS*'&quot;$LTCFLAGS&quot;'*
+	s*\$LD*'&quot;$LD&quot;'*
+	s/\$with_gnu_ld/'&quot;$with_gnu_ld&quot;'/
+	s/\$automake_version/'&quot;`(automake --version) 2&gt;/dev/null |$SED 1q`&quot;'/
+	s/\$autoconf_version/'&quot;`(autoconf --version) 2&gt;/dev/null |$SED 1q`&quot;'/
+	p
+	d
+     }
+     /^# .* home page:/b print
+     /^# General help using/b print
+     ' &lt; &quot;$progpath&quot;
+    ret=$?
+    if test -z &quot;$1&quot;; then
+      exit $ret
     fi
+}
 
-    # Lock this critical section if it is needed
-    # We use this script file to make the link, it avoids creating a new file
-    if test &quot;$need_locks&quot; = yes; then
-      until $run ln &quot;$0&quot; &quot;$lockfile&quot; 2&gt;/dev/null; do
-	$show &quot;Waiting for $lockfile to be removed&quot;
-	sleep 2
-      done
-    elif test &quot;$need_locks&quot; = warn; then
-      if test -f &quot;$lockfile&quot;; then
-	echo &quot;\
-*** ERROR, $lockfile exists and contains:
-`cat $lockfile 2&gt;/dev/null`
+# func_missing_arg argname
+# Echo program name prefixed message to standard error and set global
+# exit_cmd.
+func_missing_arg ()
+{
+    $opt_debug
 
-This indicates that another process is trying to use the same
-temporary object file, and libtool could not work around it because
-your compiler does not support \`-c' and \`-o' together.  If you
-repeat this compilation, it may succeed, by chance, but you had better
-avoid parallel builds (make -j) in this platform, or get a better
-compiler.&quot;
+    func_error &quot;missing argument for $1.&quot;
+    exit_cmd=exit
+}
 
-	$run $rm $removelist
-	exit 1
-      fi
-      echo $srcfile &gt; &quot;$lockfile&quot;
-    fi
 
-    if test -n &quot;$fix_srcfile_path&quot;; then
-      eval srcfile=\&quot;$fix_srcfile_path\&quot;
-    fi
+# func_split_short_opt shortopt
+# Set func_split_short_opt_name and func_split_short_opt_arg shell
+# variables after splitting SHORTOPT after the 2nd character.
+func_split_short_opt ()
+{
+    my_sed_short_opt='1s/^\(..\).*$/\1/;q'
+    my_sed_short_rest='1s/^..\(.*\)$/\1/;q'
 
-    # Only build a PIC object if we are building libtool libraries.
-    if test &quot;$build_libtool_libs&quot; = yes; then
-      # Without this assignment, base_compile gets emptied.
-      fbsd_hideous_sh_bug=$base_compile
+    func_split_short_opt_name=`$ECHO &quot;$1&quot; | $SED &quot;$my_sed_short_opt&quot;`
+    func_split_short_opt_arg=`$ECHO &quot;$1&quot; | $SED &quot;$my_sed_short_rest&quot;`
+} # func_split_short_opt may be replaced by extended shell implementation
 
-      if test &quot;$pic_mode&quot; != no; then
-	# All platforms use -DPIC, to notify preprocessed assembler code.
-	command=&quot;$base_compile $srcfile $pic_flag -DPIC&quot;
-      else
-	# Don't build PIC code
-	command=&quot;$base_compile $srcfile&quot;
-      fi
-      if test &quot;$build_old_libs&quot; = yes; then
-	lo_libobj=&quot;$libobj&quot;
-	dir=`$echo &quot;X$libobj&quot; | $Xsed -e 's%/[^/]*$%%'`
-	if test &quot;X$dir&quot; = &quot;X$libobj&quot;; then
-	  dir=&quot;$objdir&quot;
-	else
-	  dir=&quot;$dir/$objdir&quot;
-	fi
-	libobj=&quot;$dir/&quot;`$echo &quot;X$libobj&quot; | $Xsed -e 's%^.*/%%'`
 
-	if test -d &quot;$dir&quot;; then
-	  $show &quot;$rm $libobj&quot;
-	  $run $rm $libobj
-	else
-	  $show &quot;$mkdir $dir&quot;
-	  $run $mkdir $dir
-	  status=$?
-	  if test $status -ne 0 &amp;&amp; test ! -d $dir; then
-	    exit $status
-	  fi
-	fi
-      fi
-      if test &quot;$compiler_o_lo&quot; = yes; then
-	output_obj=&quot;$libobj&quot;
-	command=&quot;$command -o $output_obj&quot;
-      elif test &quot;$compiler_c_o&quot; = yes; then
-	output_obj=&quot;$obj&quot;
-	command=&quot;$command -o $output_obj&quot;
-      fi
+# func_split_long_opt longopt
+# Set func_split_long_opt_name and func_split_long_opt_arg shell
+# variables after splitting LONGOPT at the `=' sign.
+func_split_long_opt ()
+{
+    my_sed_long_opt='1s/^\(--[^=]*\)=.*/\1/;q'
+    my_sed_long_arg='1s/^--[^=]*=//'
 
-      $run $rm &quot;$output_obj&quot;
-      $show &quot;$command&quot;
-      if $run eval &quot;$command&quot;; then :
-      else
-	test -n &quot;$output_obj&quot; &amp;&amp; $run $rm $removelist
-	exit 1
-      fi
+    func_split_long_opt_name=`$ECHO &quot;$1&quot; | $SED &quot;$my_sed_long_opt&quot;`
+    func_split_long_opt_arg=`$ECHO &quot;$1&quot; | $SED &quot;$my_sed_long_arg&quot;`
+} # func_split_long_opt may be replaced by extended shell implementation
 
-      if test &quot;$need_locks&quot; = warn &amp;&amp;
-	 test x&quot;`cat $lockfile 2&gt;/dev/null`&quot; != x&quot;$srcfile&quot;; then
-	echo &quot;\
-*** ERROR, $lockfile contains:
-`cat $lockfile 2&gt;/dev/null`
+exit_cmd=:
 
-but it should contain:
-$srcfile
 
-This indicates that another process is trying to use the same
-temporary object file, and libtool could not work around it because
-your compiler does not support \`-c' and \`-o' together.  If you
-repeat this compilation, it may succeed, by chance, but you had better
-avoid parallel builds (make -j) in this platform, or get a better
-compiler.&quot;
 
-	$run $rm $removelist
-	exit 1
-      fi
 
-      # Just move the object if needed, then go on to compile the next one
-      if test x&quot;$output_obj&quot; != x&quot;$libobj&quot;; then
-	$show &quot;$mv $output_obj $libobj&quot;
-	if $run $mv $output_obj $libobj; then :
-	else
-	  error=$?
-	  $run $rm $removelist
-	  exit $error
-	fi
-      fi
 
-      # If we have no pic_flag, then copy the object into place and finish.
-      if (test -z &quot;$pic_flag&quot; || test &quot;$pic_mode&quot; != default) &amp;&amp;
-	 test &quot;$build_old_libs&quot; = yes; then
-	# Rename the .lo from within objdir to obj
-	if test -f $obj; then
-	  $show $rm $obj
-	  $run $rm $obj
-	fi
+magic=&quot;%%%MAGIC variable%%%&quot;
+magic_exe=&quot;%%%MAGIC EXE variable%%%&quot;
 
-	$show &quot;$mv $libobj $obj&quot;
-	if $run $mv $libobj $obj; then :
-	else
-	  error=$?
-	  $run $rm $removelist
-	  exit $error
-	fi
+# Global variables.
+nonopt=
+preserve_args=
+lo2o=&quot;s/\\.lo\$/.${objext}/&quot;
+o2lo=&quot;s/\\.${objext}\$/.lo/&quot;
+extracted_archives=
+extracted_serial=0
 
-	xdir=`$echo &quot;X$obj&quot; | $Xsed -e 's%/[^/]*$%%'`
-	if test &quot;X$xdir&quot; = &quot;X$obj&quot;; then
-	  xdir=&quot;.&quot;
-	else
-	  xdir=&quot;$xdir&quot;
-	fi
-	baseobj=`$echo &quot;X$obj&quot; | $Xsed -e &quot;s%.*/%%&quot;`
-	libobj=`$echo &quot;X$baseobj&quot; | $Xsed -e &quot;$o2lo&quot;`
-	# Now arrange that obj and lo_libobj become the same file
-	$show &quot;(cd $xdir &amp;&amp; $LN_S $baseobj $libobj)&quot;
-	if $run eval '(cd $xdir &amp;&amp; $LN_S $baseobj $libobj)'; then
-	  # Unlock the critical section if it was locked
-	  if test &quot;$need_locks&quot; != no; then
-	    $run $rm &quot;$lockfile&quot;
-	  fi
-	  exit 0
-	else
-	  error=$?
-	  $run $rm $removelist
-	  exit $error
-	fi
-      fi
+# If this variable is set in any of the actions, the command in it
+# will be execed at the end.  This prevents here-documents from being
+# left over by shells.
+exec_cmd=
 
-      # Allow error messages only from the first compilation.
-      suppress_output=' &gt;/dev/null 2&gt;&amp;1'
-    fi
+# func_append var value
+# Append VALUE to the end of shell variable VAR.
+func_append ()
+{
+    eval &quot;${1}=\$${1}\${2}&quot;
+} # func_append may be replaced by extended shell implementation
+
+# func_append_quoted var value
+# Quote VALUE and append to the end of shell variable VAR, separated
+# by a space.
+func_append_quoted ()
+{
+    func_quote_for_eval &quot;${2}&quot;
+    eval &quot;${1}=\$${1}\\ \$func_quote_for_eval_result&quot;
+} # func_append_quoted may be replaced by extended shell implementation
+
+
+# func_arith arithmetic-term...
+func_arith ()
+{
+    func_arith_result=`expr &quot;${@}&quot;`
+} # func_arith may be replaced by extended shell implementation
+
+
+# func_len string
+# STRING may not start with a hyphen.
+func_len ()
+{
+    func_len_result=`expr &quot;${1}&quot; : &quot;.*&quot; 2&gt;/dev/null || echo $max_cmd_len`
+} # func_len may be replaced by extended shell implementation
+
+
+# func_lo2o object
+func_lo2o ()
+{
+    func_lo2o_result=`$ECHO &quot;${1}&quot; | $SED &quot;$lo2o&quot;`
+} # func_lo2o may be replaced by extended shell implementation
+
+
+# func_xform libobj-or-source
+func_xform ()
+{
+    func_xform_result=`$ECHO &quot;${1}&quot; | $SED 's/\.[^.]*$/.lo/'`
+} # func_xform may be replaced by extended shell implementation
+
+
+# func_fatal_configuration arg...
+# Echo program name prefixed message to standard error, followed by
+# a configuration failure hint, and exit.
+func_fatal_configuration ()
+{
+    func_error ${1+&quot;$@&quot;}
+    func_error &quot;See the $PACKAGE documentation for more information.&quot;
+    func_fatal_error &quot;Fatal configuration error.&quot;
+}
 
-    # Only build a position-dependent object if we build old libraries.
+
+# func_config
+# Display the configuration for all the tags in this script.
+func_config ()
+{
+    re_begincf='^# ### BEGIN LIBTOOL'
+    re_endcf='^# ### END LIBTOOL'
+
+    # Default configuration.
+    $SED &quot;1,/$re_begincf CONFIG/d;/$re_endcf CONFIG/,\$d&quot; &lt; &quot;$progpath&quot;
+
+    # Now print the configurations for the tags.
+    for tagname in $taglist; do
+      $SED -n &quot;/$re_begincf TAG CONFIG: $tagname\$/,/$re_endcf TAG CONFIG: $tagname\$/p&quot; &lt; &quot;$progpath&quot;
+    done
+
+    exit $?
+}
+
+# func_features
+# Display the features supported by this script.
+func_features ()
+{
+    echo &quot;host: $host&quot;
+    if test &quot;$build_libtool_libs&quot; = yes; then
+      echo &quot;enable shared libraries&quot;
+    else
+      echo &quot;disable shared libraries&quot;
+    fi
     if test &quot;$build_old_libs&quot; = yes; then
-      if test &quot;$pic_mode&quot; != yes; then
-	# Don't build PIC code
-	command=&quot;$base_compile $srcfile&quot;
+      echo &quot;enable static libraries&quot;
+    else
+      echo &quot;disable static libraries&quot;
+    fi
+
+    exit $?
+}
+
+# func_enable_tag tagname
+# Verify that TAGNAME is valid, and either flag an error and exit, or
+# enable the TAGNAME tag.  We also add TAGNAME to the global $taglist
+# variable here.
+func_enable_tag ()
+{
+  # Global variable:
+  tagname=&quot;$1&quot;
+
+  re_begincf=&quot;^# ### BEGIN LIBTOOL TAG CONFIG: $tagname\$&quot;
+  re_endcf=&quot;^# ### END LIBTOOL TAG CONFIG: $tagname\$&quot;
+  sed_extractcf=&quot;/$re_begincf/,/$re_endcf/p&quot;
+
+  # Validate tagname.
+  case $tagname in
+    *[!-_A-Za-z0-9,/]*)
+      func_fatal_error &quot;invalid tag name: $tagname&quot;
+      ;;
+  esac
+
+  # Don't test for the &quot;default&quot; C tag, as we know it's
+  # there but not specially marked.
+  case $tagname in
+    CC) ;;
+    *)
+      if $GREP &quot;$re_begincf&quot; &quot;$progpath&quot; &gt;/dev/null 2&gt;&amp;1; then
+	taglist=&quot;$taglist $tagname&quot;
+
+	# Evaluate the configuration.  Be careful to quote the path
+	# and the sed script, to avoid splitting on whitespace, but
+	# also don't use non-portable quotes within backquotes within
+	# quotes we have to do it in 2 steps:
+	extractedcf=`$SED -n -e &quot;$sed_extractcf&quot; &lt; &quot;$progpath&quot;`
+	eval &quot;$extractedcf&quot;
       else
-	# All platforms use -DPIC, to notify preprocessed assembler code.
-	command=&quot;$base_compile $srcfile $pic_flag -DPIC&quot;
-      fi
-      if test &quot;$compiler_c_o&quot; = yes; then
-	command=&quot;$command -o $obj&quot;
-	output_obj=&quot;$obj&quot;
+	func_error &quot;ignoring unknown tag $tagname&quot;
       fi
+      ;;
+  esac
+}
 
-      # Suppress compiler output if we already did a PIC compilation.
-      command=&quot;$command$suppress_output&quot;
-      $run $rm &quot;$output_obj&quot;
-      $show &quot;$command&quot;
-      if $run eval &quot;$command&quot;; then :
+# func_check_version_match
+# Ensure that we are using m4 macros, and libtool script from the same
+# release of libtool.
+func_check_version_match ()
+{
+  if test &quot;$package_revision&quot; != &quot;$macro_revision&quot;; then
+    if test &quot;$VERSION&quot; != &quot;$macro_version&quot;; then
+      if test -z &quot;$macro_version&quot;; then
+        cat &gt;&amp;2 &lt;&lt;_LT_EOF
+$progname: Version mismatch error.  This is $PACKAGE $VERSION, but the
+$progname: definition of this LT_INIT comes from an older release.
+$progname: You should recreate aclocal.m4 with macros from $PACKAGE $VERSION
+$progname: and run autoconf again.
+_LT_EOF
       else
-	$run $rm $removelist
-	exit 1
+        cat &gt;&amp;2 &lt;&lt;_LT_EOF
+$progname: Version mismatch error.  This is $PACKAGE $VERSION, but the
+$progname: definition of this LT_INIT comes from $PACKAGE $macro_version.
+$progname: You should recreate aclocal.m4 with macros from $PACKAGE $VERSION
+$progname: and run autoconf again.
+_LT_EOF
       fi
+    else
+      cat &gt;&amp;2 &lt;&lt;_LT_EOF
+$progname: Version mismatch error.  This is $PACKAGE $VERSION, revision $package_revision,
+$progname: but the definition of this LT_INIT comes from revision $macro_revision.
+$progname: You should recreate aclocal.m4 with macros from revision $package_revision
+$progname: of $PACKAGE $VERSION and run autoconf again.
+_LT_EOF
+    fi
 
-      if test &quot;$need_locks&quot; = warn &amp;&amp;
-	 test x&quot;`cat $lockfile 2&gt;/dev/null`&quot; != x&quot;$srcfile&quot;; then
-	echo &quot;\
-*** ERROR, $lockfile contains:
-`cat $lockfile 2&gt;/dev/null`
+    exit $EXIT_MISMATCH
+  fi
+}
 
-but it should contain:
-$srcfile
 
-This indicates that another process is trying to use the same
-temporary object file, and libtool could not work around it because
-your compiler does not support \`-c' and \`-o' together.  If you
-repeat this compilation, it may succeed, by chance, but you had better
-avoid parallel builds (make -j) in this platform, or get a better
-compiler.&quot;
+# Shorthand for --mode=foo, only valid as the first argument
+case $1 in
+clean|clea|cle|cl)
+  shift; set dummy --mode clean ${1+&quot;$@&quot;}; shift
+  ;;
+compile|compil|compi|comp|com|co|c)
+  shift; set dummy --mode compile ${1+&quot;$@&quot;}; shift
+  ;;
+execute|execut|execu|exec|exe|ex|e)
+  shift; set dummy --mode execute ${1+&quot;$@&quot;}; shift
+  ;;
+finish|finis|fini|fin|fi|f)
+  shift; set dummy --mode finish ${1+&quot;$@&quot;}; shift
+  ;;
+install|instal|insta|inst|ins|in|i)
+  shift; set dummy --mode install ${1+&quot;$@&quot;}; shift
+  ;;
+link|lin|li|l)
+  shift; set dummy --mode link ${1+&quot;$@&quot;}; shift
+  ;;
+uninstall|uninstal|uninsta|uninst|unins|unin|uni|un|u)
+  shift; set dummy --mode uninstall ${1+&quot;$@&quot;}; shift
+  ;;
+esac
 
-	$run $rm $removelist
-	exit 1
-      fi
 
-      # Just move the object if needed
-      if test x&quot;$output_obj&quot; != x&quot;$obj&quot;; then
-	$show &quot;$mv $output_obj $obj&quot;
-	if $run $mv $output_obj $obj; then :
-	else
-	  error=$?
-	  $run $rm $removelist
-	  exit $error
-	fi
-      fi
 
-      # Create an invalid libtool object if no PIC, so that we do not
-      # accidentally link it into a program.
-      if test &quot;$build_libtool_libs&quot; != yes; then
-	$show &quot;echo timestamp &gt; $libobj&quot;
-	$run eval &quot;echo timestamp &gt; \$libobj&quot; || exit $?
-      else
-	# Move the .lo from within objdir
-	$show &quot;$mv $libobj $lo_libobj&quot;
-	if $run $mv $libobj $lo_libobj; then :
-	else
-	  error=$?
-	  $run $rm $removelist
-	  exit $error
-	fi
-      fi
-    fi
+# Option defaults:
+opt_debug=:
+opt_dry_run=false
+opt_config=false
+opt_preserve_dup_deps=false
+opt_features=false
+opt_finish=false
+opt_help=false
+opt_help_all=false
+opt_silent=:
+opt_verbose=:
+opt_silent=false
+opt_verbose=false
+
+
+# Parse options once, thoroughly.  This comes as soon as possible in the
+# script to make things like `--version' happen as quickly as we can.
+{
+  # this just eases exit handling
+  while test $# -gt 0; do
+    opt=&quot;$1&quot;
+    shift
+    case $opt in
+      --debug|-x)	opt_debug='set -x'
+			func_echo &quot;enabling shell trace mode&quot;
+			$opt_debug
+			;;
+      --dry-run|--dryrun|-n)
+			opt_dry_run=:
+			;;
+      --config)
+			opt_config=:
+func_config
+			;;
+      --dlopen|-dlopen)
+			optarg=&quot;$1&quot;
+			opt_dlopen=&quot;${opt_dlopen+$opt_dlopen
+}$optarg&quot;
+			shift
+			;;
+      --preserve-dup-deps)
+			opt_preserve_dup_deps=:
+			;;
+      --features)
+			opt_features=:
+func_features
+			;;
+      --finish)
+			opt_finish=:
+set dummy --mode finish ${1+&quot;$@&quot;}; shift
+			;;
+      --help)
+			opt_help=:
+			;;
+      --help-all)
+			opt_help_all=:
+opt_help=': help-all'
+			;;
+      --mode)
+			test $# = 0 &amp;&amp; func_missing_arg $opt &amp;&amp; break
+			optarg=&quot;$1&quot;
+			opt_mode=&quot;$optarg&quot;
+case $optarg in
+  # Valid mode arguments:
+  clean|compile|execute|finish|install|link|relink|uninstall) ;;
+
+  # Catch anything else as an error
+  *) func_error &quot;invalid argument for $opt&quot;
+     exit_cmd=exit
+     break
+     ;;
+esac
+			shift
+			;;
+      --no-silent|--no-quiet)
+			opt_silent=false
+func_append preserve_args &quot; $opt&quot;
+			;;
+      --no-verbose)
+			opt_verbose=false
+func_append preserve_args &quot; $opt&quot;
+			;;
+      --silent|--quiet)
+			opt_silent=:
+func_append preserve_args &quot; $opt&quot;
+        opt_verbose=false
+			;;
+      --verbose|-v)
+			opt_verbose=:
+func_append preserve_args &quot; $opt&quot;
+opt_silent=false
+			;;
+      --tag)
+			test $# = 0 &amp;&amp; func_missing_arg $opt &amp;&amp; break
+			optarg=&quot;$1&quot;
+			opt_tag=&quot;$optarg&quot;
+func_append preserve_args &quot; $opt $optarg&quot;
+func_enable_tag &quot;$optarg&quot;
+			shift
+			;;
+
+      -\?|-h)		func_usage				;;
+      --help)		func_help				;;
+      --version)	func_version				;;
+
+      # Separate optargs to long options:
+      --*=*)
+			func_split_long_opt &quot;$opt&quot;
+			set dummy &quot;$func_split_long_opt_name&quot; &quot;$func_split_long_opt_arg&quot; ${1+&quot;$@&quot;}
+			shift
+			;;
+
+      # Separate non-argument short options:
+      -\?*|-h*|-n*|-v*)
+			func_split_short_opt &quot;$opt&quot;
+			set dummy &quot;$func_split_short_opt_name&quot; &quot;-$func_split_short_opt_arg&quot; ${1+&quot;$@&quot;}
+			shift
+			;;
+
+      --)		break					;;
+      -*)		func_fatal_help &quot;unrecognized option \`$opt'&quot; ;;
+      *)		set dummy &quot;$opt&quot; ${1+&quot;$@&quot;};	shift; break  ;;
+    esac
+  done
 
-    # Unlock the critical section if it was locked
-    if test &quot;$need_locks&quot; != no; then
-      $run $rm &quot;$lockfile&quot;
-    fi
+  # Validate options:
 
-    exit 0
-    ;;
+  # save first non-option argument
+  if test &quot;$#&quot; -gt 0; then
+    nonopt=&quot;$opt&quot;
+    shift
+  fi
 
-  # libtool link mode
-  link | relink)
-    modename=&quot;$modename: link&quot;
-    case $host in
-    *-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-os2*)
-      # It is impossible to link a dll without this setting, and
-      # we shouldn't force the makefile maintainer to figure out
-      # which system we are compiling for in order to pass an extra
-      # flag for every libtool invokation.
-      # allow_undefined=no
+  # preserve --debug
+  test &quot;$opt_debug&quot; = : || func_append preserve_args &quot; --debug&quot;
 
-      # FIXME: Unfortunately, there are problems with the above when trying
-      # to make a dll which has undefined symbols, in which case not
-      # even a static library is built.  For now, we need to specify
-      # -no-undefined on the libtool link line when we can be certain
-      # that all symbols are satisfied, otherwise we get a static library.
-      allow_undefined=yes
+  case $host in
+    *cygwin* | *mingw* | *pw32* | *cegcc*)
+      # don't eliminate duplications in $postdeps and $predeps
+      opt_duplicate_compiler_generated_deps=:
       ;;
     *)
-      allow_undefined=yes
+      opt_duplicate_compiler_generated_deps=$opt_preserve_dup_deps
       ;;
-    esac
-    libtool_args=&quot;$nonopt&quot;
-    compile_command=&quot;$nonopt&quot;
-    finalize_command=&quot;$nonopt&quot;
+  esac
 
-    compile_rpath=
-    finalize_rpath=
-    compile_shlibpath=
-    finalize_shlibpath=
-    convenience=
-    old_convenience=
-    deplibs=
-    old_deplibs=
-    compiler_flags=
-    linker_flags=
-    dllsearchpath=
-    lib_search_path=`pwd`
+  $opt_help || {
+    # Sanity checks first:
+    func_check_version_match
 
-    avoid_version=no
-    dlfiles=
-    dlprefiles=
-    dlself=no
-    export_dynamic=no
-    export_symbols=
-    export_symbols_regex=
-    generated=
-    libobjs=
-    ltlibs=
-    module=no
-    no_install=no
-    objs=
-    prefer_static_libs=no
-    preload=no
-    prev=
-    prevarg=
-    release=
-    rpath=
-    xrpath=
-    perm_rpath=
-    temp_rpath=
-    thread_safe=no
-    vinfo=
+    if test &quot;$build_libtool_libs&quot; != yes &amp;&amp; test &quot;$build_old_libs&quot; != yes; then
+      func_fatal_configuration &quot;not configured to build any kind of library&quot;
+    fi
 
-    # We need to know -static, to get the right output filenames.
-    for arg
-    do
-      case $arg in
-      -all-static | -static)
-	if test &quot;X$arg&quot; = &quot;X-all-static&quot;; then
-	  if test &quot;$build_libtool_libs&quot; = yes &amp;&amp; test -z &quot;$link_static_flag&quot;; then
-	    $echo &quot;$modename: warning: complete static linking is impossible in this configuration&quot; 1&gt;&amp;2
-	  fi
-	  if test -n &quot;$link_static_flag&quot;; then
-	    dlopen_self=$dlopen_self_static
-	  fi
-	else
-	  if test -z &quot;$pic_flag&quot; &amp;&amp; test -n &quot;$link_static_flag&quot;; then
-	    dlopen_self=$dlopen_self_static
-	  fi
-	fi
-	build_libtool_libs=no
-	build_old_libs=yes
-	prefer_static_libs=yes
-	break
-	;;
-      esac
-    done
+    # Darwin sucks
+    eval std_shrext=\&quot;$shrext_cmds\&quot;
 
-    # See if our shared archives depend on static archives.
-    test -n &quot;$old_archive_from_new_cmds&quot; &amp;&amp; build_old_libs=yes
+    # Only execute mode is allowed to have -dlopen flags.
+    if test -n &quot;$opt_dlopen&quot; &amp;&amp; test &quot;$opt_mode&quot; != execute; then
+      func_error &quot;unrecognized option \`-dlopen'&quot;
+      $ECHO &quot;$help&quot; 1&gt;&amp;2
+      exit $EXIT_FAILURE
+    fi
 
-    # Go through the arguments, transforming them on the way.
-    while test $# -gt 0; do
-      arg=&quot;$1&quot;
-      shift
-      case $arg in
-      *[\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;&quot;)
-	qarg=\&quot;`$echo &quot;X$arg&quot; | $Xsed -e &quot;$sed_quote_subst&quot;`\&quot; ### testsuite: skip nested quoting test
-	;;
-      *) qarg=$arg ;;
-      esac
-      libtool_args=&quot;$libtool_args $qarg&quot;
+    # Change the help message to a mode-specific one.
+    generic_help=&quot;$help&quot;
+    help=&quot;Try \`$progname --help --mode=$opt_mode' for more information.&quot;
+  }
 
-      # If the previous option needs an argument, assign it.
-      if test -n &quot;$prev&quot;; then
-	case $prev in
-	output)
-	  compile_command=&quot;$compile_command @OUTPUT@&quot;
-	  finalize_command=&quot;$finalize_command @OUTPUT@&quot;
-	  ;;
-	esac
 
-	case $prev in
-	dlfiles|dlprefiles)
-	  if test &quot;$preload&quot; = no; then
-	    # Add the symbol object into the linking commands.
-	    compile_command=&quot;$compile_command @SYMFILE@&quot;
-	    finalize_command=&quot;$finalize_command @SYMFILE@&quot;
-	    preload=yes
-	  fi
-	  case $arg in
-	  *.la | *.lo) ;;  # We handle these cases below.
-	  force)
-	    if test &quot;$dlself&quot; = no; then
-	      dlself=needless
-	      export_dynamic=yes
-	    fi
-	    prev=
-	    continue
-	    ;;
-	  self)
-	    if test &quot;$prev&quot; = dlprefiles; then
-	      dlself=yes
-	    elif test &quot;$prev&quot; = dlfiles &amp;&amp; test &quot;$dlopen_self&quot; != yes; then
-	      dlself=yes
-	    else
-	      dlself=needless
-	      export_dynamic=yes
-	    fi
-	    prev=
-	    continue
-	    ;;
-	  *)
-	    if test &quot;$prev&quot; = dlfiles; then
-	      dlfiles=&quot;$dlfiles $arg&quot;
-	    else
-	      dlprefiles=&quot;$dlprefiles $arg&quot;
-	    fi
-	    prev=
-	    continue
-	    ;;
-	  esac
-	  ;;
-	expsyms)
-	  export_symbols=&quot;$arg&quot;
-	  if test ! -f &quot;$arg&quot;; then
-	    $echo &quot;$modename: symbol file \`$arg' does not exist&quot;
-	    exit 1
-	  fi
-	  prev=
-	  continue
-	  ;;
-	expsyms_regex)
-	  export_symbols_regex=&quot;$arg&quot;
-	  prev=
-	  continue
-	  ;;
-	release)
-	  release=&quot;-$arg&quot;
-	  prev=
-	  continue
-	  ;;
-	rpath | xrpath)
-	  # We need an absolute path.
-	  case $arg in
-	  [\\/]* | [A-Za-z]:[\\/]*) ;;
-	  *)
-	    $echo &quot;$modename: only absolute run-paths are allowed&quot; 1&gt;&amp;2
-	    exit 1
-	    ;;
-	  esac
-	  if test &quot;$prev&quot; = rpath; then
-	    case &quot;$rpath &quot; in
-	    *&quot; $arg &quot;*) ;;
-	    *) rpath=&quot;$rpath $arg&quot; ;;
-	    esac
-	  else
-	    case &quot;$xrpath &quot; in
-	    *&quot; $arg &quot;*) ;;
-	    *) xrpath=&quot;$xrpath $arg&quot; ;;
+  # Bail if the options were screwed
+  $exit_cmd $EXIT_FAILURE
+}
+
+
+
+
+## ----------- ##
+##    Main.    ##
+## ----------- ##
+
+# func_lalib_p file
+# True iff FILE is a libtool `.la' library or `.lo' object file.
+# This function is only a basic sanity check; it will hardly flush out
+# determined imposters.
+func_lalib_p ()
+{
+    test -f &quot;$1&quot; &amp;&amp;
+      $SED -e 4q &quot;$1&quot; 2&gt;/dev/null \
+        | $GREP &quot;^# Generated by .*$PACKAGE&quot; &gt; /dev/null 2&gt;&amp;1
+}
+
+# func_lalib_unsafe_p file
+# True iff FILE is a libtool `.la' library or `.lo' object file.
+# This function implements the same check as func_lalib_p without
+# resorting to external programs.  To this end, it redirects stdin and
+# closes it afterwards, without saving the original file descriptor.
+# As a safety measure, use it only where a negative result would be
+# fatal anyway.  Works if `file' does not exist.
+func_lalib_unsafe_p ()
+{
+    lalib_p=no
+    if test -f &quot;$1&quot; &amp;&amp; test -r &quot;$1&quot; &amp;&amp; exec 5&lt;&amp;0 &lt;&quot;$1&quot;; then
+	for lalib_p_l in 1 2 3 4
+	do
+	    read lalib_p_line
+	    case &quot;$lalib_p_line&quot; in
+		\#\ Generated\ by\ *$PACKAGE* ) lalib_p=yes; break;;
 	    esac
-	  fi
-	  prev=
-	  continue
-	  ;;
-	xcompiler)
-	  compiler_flags=&quot;$compiler_flags $qarg&quot;
-	  prev=
-	  compile_command=&quot;$compile_command $qarg&quot;
-	  finalize_command=&quot;$finalize_command $qarg&quot;
-	  continue
-	  ;;
-	xlinker)
-	  linker_flags=&quot;$linker_flags $qarg&quot;
-	  compiler_flags=&quot;$compiler_flags $wl$qarg&quot;
-	  prev=
-	  compile_command=&quot;$compile_command $wl$qarg&quot;
-	  finalize_command=&quot;$finalize_command $wl$qarg&quot;
-	  continue
-	  ;;
-	*)
-	  eval &quot;$prev=\&quot;\$arg\&quot;&quot;
-	  prev=
-	  continue
-	  ;;
-	esac
-      fi # test -n $prev
+	done
+	exec 0&lt;&amp;5 5&lt;&amp;-
+    fi
+    test &quot;$lalib_p&quot; = yes
+}
 
-      prevarg=&quot;$arg&quot;
+# func_ltwrapper_script_p file
+# True iff FILE is a libtool wrapper script
+# This function is only a basic sanity check; it will hardly flush out
+# determined imposters.
+func_ltwrapper_script_p ()
+{
+    func_lalib_p &quot;$1&quot;
+}
 
-      case $arg in
-      -all-static)
-	if test -n &quot;$link_static_flag&quot;; then
-	  compile_command=&quot;$compile_command $link_static_flag&quot;
-	  finalize_command=&quot;$finalize_command $link_static_flag&quot;
-	fi
-	continue
-	;;
+# func_ltwrapper_executable_p file
+# True iff FILE is a libtool wrapper executable
+# This function is only a basic sanity check; it will hardly flush out
+# determined imposters.
+func_ltwrapper_executable_p ()
+{
+    func_ltwrapper_exec_suffix=
+    case $1 in
+    *.exe) ;;
+    *) func_ltwrapper_exec_suffix=.exe ;;
+    esac
+    $GREP &quot;$magic_exe&quot; &quot;$1$func_ltwrapper_exec_suffix&quot; &gt;/dev/null 2&gt;&amp;1
+}
 
-      -allow-undefined)
-	# FIXME: remove this flag sometime in the future.
-	$echo &quot;$modename: \`-allow-undefined' is deprecated because it is the default&quot; 1&gt;&amp;2
-	continue
-	;;
+# func_ltwrapper_scriptname file
+# Assumes file is an ltwrapper_executable
+# uses $file to determine the appropriate filename for a
+# temporary ltwrapper_script.
+func_ltwrapper_scriptname ()
+{
+    func_dirname_and_basename &quot;$1&quot; &quot;&quot; &quot;.&quot;
+    func_stripname '' '.exe' &quot;$func_basename_result&quot;
+    func_ltwrapper_scriptname_result=&quot;$func_dirname_result/$objdir/${func_stripname_result}_ltshwrapper&quot;
+}
 
-      -avoid-version)
-	avoid_version=yes
-	continue
-	;;
+# func_ltwrapper_p file
+# True iff FILE is a libtool wrapper script or wrapper executable
+# This function is only a basic sanity check; it will hardly flush out
+# determined imposters.
+func_ltwrapper_p ()
+{
+    func_ltwrapper_script_p &quot;$1&quot; || func_ltwrapper_executable_p &quot;$1&quot;
+}
 
-      -dlopen)
-	prev=dlfiles
-	continue
-	;;
 
-      -dlpreopen)
-	prev=dlprefiles
-	continue
-	;;
+# func_execute_cmds commands fail_cmd
+# Execute tilde-delimited COMMANDS.
+# If FAIL_CMD is given, eval that upon failure.
+# FAIL_CMD may read-access the current command in variable CMD!
+func_execute_cmds ()
+{
+    $opt_debug
+    save_ifs=$IFS; IFS='~'
+    for cmd in $1; do
+      IFS=$save_ifs
+      eval cmd=\&quot;$cmd\&quot;
+      func_show_eval &quot;$cmd&quot; &quot;${2-:}&quot;
+    done
+    IFS=$save_ifs
+}
 
-      -export-dynamic)
-	export_dynamic=yes
-	continue
-	;;
 
-      -export-symbols | -export-symbols-regex)
-	if test -n &quot;$export_symbols&quot; || test -n &quot;$export_symbols_regex&quot;; then
-	  $echo &quot;$modename: more than one -exported-symbols argument is not allowed&quot;
-	  exit 1
-	fi
-	if test &quot;X$arg&quot; = &quot;X-export-symbols&quot;; then
-	  prev=expsyms
-	else
-	  prev=expsyms_regex
-	fi
-	continue
-	;;
+# func_source file
+# Source FILE, adding directory component if necessary.
+# Note that it is not necessary on cygwin/mingw to append a dot to
+# FILE even if both FILE and FILE.exe exist: automatic-append-.exe
+# behavior happens only for exec(3), not for open(2)!  Also, sourcing
+# `FILE.' does not work on cygwin managed mounts.
+func_source ()
+{
+    $opt_debug
+    case $1 in
+    */* | *\\*)	. &quot;$1&quot; ;;
+    *)		. &quot;./$1&quot; ;;
+    esac
+}
 
-      # The native IRIX linker understands -LANG:*, -LIST:* and -LNO:*
-      # so, if we see these flags be careful not to treat them like -L
-      -L[A-Z][A-Z]*:*)
-	case $with_gcc/$host in
-	no/*-*-irix*)
-	  compile_command=&quot;$compile_command $arg&quot;
-	  finalize_command=&quot;$finalize_command $arg&quot;
-	  ;;
-	esac
-	continue
-	;;
 
-      -L*)
-	dir=`$echo &quot;X$arg&quot; | $Xsed -e 's/^-L//'`
-	# We need an absolute path.
-	case $dir in
-	[\\/]* | [A-Za-z]:[\\/]*) ;;
-	*)
-	  absdir=`cd &quot;$dir&quot; &amp;&amp; pwd`
-	  if test -z &quot;$absdir&quot;; then
-	    $echo &quot;$modename: cannot determine absolute directory name of \`$dir'&quot; 1&gt;&amp;2
-	    exit 1
-	  fi
-	  dir=&quot;$absdir&quot;
-	  ;;
-	esac
-	case &quot;$deplibs &quot; in
-	*&quot; -L$dir &quot;*) ;;
-	*)
-	  deplibs=&quot;$deplibs -L$dir&quot;
-	  lib_search_path=&quot;$lib_search_path $dir&quot;
-	  ;;
-	esac
-	case $host in
-	*-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-os2*)
-	  case :$dllsearchpath: in
-	  *&quot;:$dir:&quot;*) ;;
-	  *) dllsearchpath=&quot;$dllsearchpath:$dir&quot;;;
-	  esac
-	  ;;
-	esac
-	continue
-	;;
+# func_resolve_sysroot PATH
+# Replace a leading = in PATH with a sysroot.  Store the result into
+# func_resolve_sysroot_result
+func_resolve_sysroot ()
+{
+  func_resolve_sysroot_result=$1
+  case $func_resolve_sysroot_result in
+  =*)
+    func_stripname '=' '' &quot;$func_resolve_sysroot_result&quot;
+    func_resolve_sysroot_result=$lt_sysroot$func_stripname_result
+    ;;
+  esac
+}
 
-      -l*)
-	if test &quot;X$arg&quot; = &quot;X-lc&quot; || test &quot;X$arg&quot; = &quot;X-lm&quot;; then
-	  case $host in
-	  *-*-cygwin* | *-*-pw32* | *-*-beos*)
-	    # These systems don't actually have a C or math library (as such)
-	    continue
-	    ;;
-	  *-*-mingw* | *-*-os2*)
-	    # These systems don't actually have a C library (as such)
-	    test &quot;X$arg&quot; = &quot;X-lc&quot; &amp;&amp; continue
-	    ;;
-	  *-*-openbsd*)
-	    # Do not include libc due to us having libc/libc_r.
-	    test &quot;X$arg&quot; = &quot;X-lc&quot; &amp;&amp; continue
-	    ;;
-	  esac
-	 elif test &quot;X$arg&quot; = &quot;X-lc_r&quot;; then
-	  case $host in
-	  *-*-openbsd*)
-	    # Do not include libc_r directly, use -pthread flag.
-	    continue
-	    ;;
-	  esac
+# func_replace_sysroot PATH
+# If PATH begins with the sysroot, replace it with = and
+# store the result into func_replace_sysroot_result.
+func_replace_sysroot ()
+{
+  case &quot;$lt_sysroot:$1&quot; in
+  ?*:&quot;$lt_sysroot&quot;*)
+    func_stripname &quot;$lt_sysroot&quot; '' &quot;$1&quot;
+    func_replace_sysroot_result=&quot;=$func_stripname_result&quot;
+    ;;
+  *)
+    # Including no sysroot.
+    func_replace_sysroot_result=$1
+    ;;
+  esac
+}
+
+# func_infer_tag arg
+# Infer tagged configuration to use if any are available and
+# if one wasn't chosen via the &quot;--tag&quot; command line option.
+# Only attempt this if the compiler in the base compile
+# command doesn't match the default compiler.
+# arg is usually of the form 'gcc ...'
+func_infer_tag ()
+{
+    $opt_debug
+    if test -n &quot;$available_tags&quot; &amp;&amp; test -z &quot;$tagname&quot;; then
+      CC_quoted=
+      for arg in $CC; do
+	func_append_quoted CC_quoted &quot;$arg&quot;
+      done
+      CC_expanded=`func_echo_all $CC`
+      CC_quoted_expanded=`func_echo_all $CC_quoted`
+      case $@ in
+      # Blanks in the command may have been stripped by the calling shell,
+      # but not from the CC environment variable when configure was run.
+      &quot; $CC &quot;* | &quot;$CC &quot;* | &quot; $CC_expanded &quot;* | &quot;$CC_expanded &quot;* | \
+      &quot; $CC_quoted&quot;* | &quot;$CC_quoted &quot;* | &quot; $CC_quoted_expanded &quot;* | &quot;$CC_quoted_expanded &quot;*) ;;
+      # Blanks at the start of $base_compile will cause this to fail
+      # if we don't check for them as well.
+      *)
+	for z in $available_tags; do
+	  if $GREP &quot;^# ### BEGIN LIBTOOL TAG CONFIG: $z$&quot; &lt; &quot;$progpath&quot; &gt; /dev/null; then
+	    # Evaluate the configuration.
+	    eval &quot;`${SED} -n -e '/^# ### BEGIN LIBTOOL TAG CONFIG: '$z'$/,/^# ### END LIBTOOL TAG CONFIG: '$z'$/p' &lt; $progpath`&quot;
+	    CC_quoted=
+	    for arg in $CC; do
+	      # Double-quote args containing other shell metacharacters.
+	      func_append_quoted CC_quoted &quot;$arg&quot;
+	    done
+	    CC_expanded=`func_echo_all $CC`
+	    CC_quoted_expanded=`func_echo_all $CC_quoted`
+	    case &quot;$@ &quot; in
+	    &quot; $CC &quot;* | &quot;$CC &quot;* | &quot; $CC_expanded &quot;* | &quot;$CC_expanded &quot;* | \
+	    &quot; $CC_quoted&quot;* | &quot;$CC_quoted &quot;* | &quot; $CC_quoted_expanded &quot;* | &quot;$CC_quoted_expanded &quot;*)
+	      # The compiler in the base compile command matches
+	      # the one in the tagged configuration.
+	      # Assume this is the tagged configuration we want.
+	      tagname=$z
+	      break
+	      ;;
+	    esac
+	  fi
+	done
+	# If $tagname still isn't set, then no tagged configuration
+	# was found and let the user know that the &quot;--tag&quot; command
+	# line option must be used.
+	if test -z &quot;$tagname&quot;; then
+	  func_echo &quot;unable to infer tagged configuration&quot;
+	  func_fatal_error &quot;specify a tag with \`--tag'&quot;
+#	else
+#	  func_verbose &quot;using $tagname tagged configuration&quot;
 	fi
-	deplibs=&quot;$deplibs $arg&quot;
-	continue
 	;;
+      esac
+    fi
+}
 
-      -module)
-	module=yes
-	continue
-	;;
 
-      -no-fast-install)
-	fast_install=no
-	continue
-	;;
 
-      -no-install)
-	case $host in
-	*-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-os2*)
-	  # The PATH hackery in wrapper scripts is required on Windows
-	  # in order for the loader to find any dlls it needs.
-	  $echo &quot;$modename: warning: \`-no-install' is ignored for $host&quot; 1&gt;&amp;2
-	  $echo &quot;$modename: warning: assuming \`-no-fast-install' instead&quot; 1&gt;&amp;2
-	  fast_install=no
-	  ;;
-	*) no_install=yes ;;
-	esac
-	continue
-	;;
+# func_write_libtool_object output_name pic_name nonpic_name
+# Create a libtool object file (analogous to a &quot;.la&quot; file),
+# but don't create it if we're doing a dry run.
+func_write_libtool_object ()
+{
+    write_libobj=${1}
+    if test &quot;$build_libtool_libs&quot; = yes; then
+      write_lobj=\'${2}\'
+    else
+      write_lobj=none
+    fi
 
-      -no-undefined)
-	allow_undefined=no
-	continue
-	;;
+    if test &quot;$build_old_libs&quot; = yes; then
+      write_oldobj=\'${3}\'
+    else
+      write_oldobj=none
+    fi
 
-      -o) prev=output ;;
+    $opt_dry_run || {
+      cat &gt;${write_libobj}T &lt;&lt;EOF
+# $write_libobj - a libtool object file
+# Generated by $PROGRAM (GNU $PACKAGE$TIMESTAMP) $VERSION
+#
+# Please DO NOT delete this file!
+# It is necessary for linking the library.
 
-      -release)
-	prev=release
-	continue
-	;;
+# Name of the PIC object.
+pic_object=$write_lobj
 
-      -rpath)
-	prev=rpath
-	continue
-	;;
+# Name of the non-PIC object
+non_pic_object=$write_oldobj
 
-      -R)
-	prev=xrpath
-	continue
-	;;
+EOF
+      $MV &quot;${write_libobj}T&quot; &quot;${write_libobj}&quot;
+    }
+}
 
-      -R*)
-	dir=`$echo &quot;X$arg&quot; | $Xsed -e 's/^-R//'`
-	# We need an absolute path.
-	case $dir in
-	[\\/]* | [A-Za-z]:[\\/]*) ;;
-	*)
-	  $echo &quot;$modename: only absolute run-paths are allowed&quot; 1&gt;&amp;2
-	  exit 1
-	  ;;
-	esac
-	case &quot;$xrpath &quot; in
-	*&quot; $dir &quot;*) ;;
-	*) xrpath=&quot;$xrpath $dir&quot; ;;
-	esac
-	continue
-	;;
 
-      -static)
-	# The effects of -static are defined in a previous loop.
-	# We used to do the same as -all-static on platforms that
-	# didn't have a PIC flag, but the assumption that the effects
-	# would be equivalent was wrong.  It would break on at least
-	# Digital Unix and AIX.
-	continue
-	;;
+##################################################
+# FILE NAME AND PATH CONVERSION HELPER FUNCTIONS #
+##################################################
 
-      -thread-safe)
-	thread_safe=yes
-	continue
-	;;
+# func_convert_core_file_wine_to_w32 ARG
+# Helper function used by file name conversion functions when $build is *nix,
+# and $host is mingw, cygwin, or some other w32 environment. Relies on a
+# correctly configured wine environment available, with the winepath program
+# in $build's $PATH.
+#
+# ARG is the $build file name to be converted to w32 format.
+# Result is available in $func_convert_core_file_wine_to_w32_result, and will
+# be empty on error (or when ARG is empty)
+func_convert_core_file_wine_to_w32 ()
+{
+  $opt_debug
+  func_convert_core_file_wine_to_w32_result=&quot;$1&quot;
+  if test -n &quot;$1&quot;; then
+    # Unfortunately, winepath does not exit with a non-zero error code, so we
+    # are forced to check the contents of stdout. On the other hand, if the
+    # command is not found, the shell will set an exit code of 127 and print
+    # *an error message* to stdout. So we must check for both error code of
+    # zero AND non-empty stdout, which explains the odd construction:
+    func_convert_core_file_wine_to_w32_tmp=`winepath -w &quot;$1&quot; 2&gt;/dev/null`
+    if test &quot;$?&quot; -eq 0 &amp;&amp; test -n &quot;${func_convert_core_file_wine_to_w32_tmp}&quot;; then
+      func_convert_core_file_wine_to_w32_result=`$ECHO &quot;$func_convert_core_file_wine_to_w32_tmp&quot; |
+        $SED -e &quot;$lt_sed_naive_backslashify&quot;`
+    else
+      func_convert_core_file_wine_to_w32_result=
+    fi
+  fi
+}
+# end: func_convert_core_file_wine_to_w32
 
-      -version-info)
-	prev=vinfo
-	continue
-	;;
 
-      -Wc,*)
-	args=`$echo &quot;X$arg&quot; | $Xsed -e &quot;$sed_quote_subst&quot; -e 's/^-Wc,//'`
-	arg=
-	save_ifs=&quot;$IFS&quot;; IFS=','
-	for flag in $args; do
-	  IFS=&quot;$save_ifs&quot;
-	  case $flag in
-	    *[\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;&quot;)
-	    flag=&quot;\&quot;$flag\&quot;&quot;
-	    ;;
-	  esac
-	  arg=&quot;$arg $wl$flag&quot;
-	  compiler_flags=&quot;$compiler_flags $flag&quot;
-	done
-	IFS=&quot;$save_ifs&quot;
-	arg=`$echo &quot;X$arg&quot; | $Xsed -e &quot;s/^ //&quot;`
-	;;
+# func_convert_core_path_wine_to_w32 ARG
+# Helper function used by path conversion functions when $build is *nix, and
+# $host is mingw, cygwin, or some other w32 environment. Relies on a correctly
+# configured wine environment available, with the winepath program in $build's
+# $PATH. Assumes ARG has no leading or trailing path separator characters.
+#
+# ARG is path to be converted from $build format to win32.
+# Result is available in $func_convert_core_path_wine_to_w32_result.
+# Unconvertible file (directory) names in ARG are skipped; if no directory names
+# are convertible, then the result may be empty.
+func_convert_core_path_wine_to_w32 ()
+{
+  $opt_debug
+  # unfortunately, winepath doesn't convert paths, only file names
+  func_convert_core_path_wine_to_w32_result=&quot;&quot;
+  if test -n &quot;$1&quot;; then
+    oldIFS=$IFS
+    IFS=:
+    for func_convert_core_path_wine_to_w32_f in $1; do
+      IFS=$oldIFS
+      func_convert_core_file_wine_to_w32 &quot;$func_convert_core_path_wine_to_w32_f&quot;
+      if test -n &quot;$func_convert_core_file_wine_to_w32_result&quot; ; then
+        if test -z &quot;$func_convert_core_path_wine_to_w32_result&quot;; then
+          func_convert_core_path_wine_to_w32_result=&quot;$func_convert_core_file_wine_to_w32_result&quot;
+        else
+          func_append func_convert_core_path_wine_to_w32_result &quot;;$func_convert_core_file_wine_to_w32_result&quot;
+        fi
+      fi
+    done
+    IFS=$oldIFS
+  fi
+}
+# end: func_convert_core_path_wine_to_w32
+
+
+# func_cygpath ARGS...
+# Wrapper around calling the cygpath program via LT_CYGPATH. This is used when
+# when (1) $build is *nix and Cygwin is hosted via a wine environment; or (2)
+# $build is MSYS and $host is Cygwin, or (3) $build is Cygwin. In case (1) or
+# (2), returns the Cygwin file name or path in func_cygpath_result (input
+# file name or path is assumed to be in w32 format, as previously converted
+# from $build's *nix or MSYS format). In case (3), returns the w32 file name
+# or path in func_cygpath_result (input file name or path is assumed to be in
+# Cygwin format). Returns an empty string on error.
+#
+# ARGS are passed to cygpath, with the last one being the file name or path to
+# be converted.
+#
+# Specify the absolute *nix (or w32) name to cygpath in the LT_CYGPATH
+# environment variable; do not put it in $PATH.
+func_cygpath ()
+{
+  $opt_debug
+  if test -n &quot;$LT_CYGPATH&quot; &amp;&amp; test -f &quot;$LT_CYGPATH&quot;; then
+    func_cygpath_result=`$LT_CYGPATH &quot;$@&quot; 2&gt;/dev/null`
+    if test &quot;$?&quot; -ne 0; then
+      # on failure, ensure result is empty
+      func_cygpath_result=
+    fi
+  else
+    func_cygpath_result=
+    func_error &quot;LT_CYGPATH is empty or specifies non-existent file: \`$LT_CYGPATH'&quot;
+  fi
+}
+#end: func_cygpath
+
+
+# func_convert_core_msys_to_w32 ARG
+# Convert file name or path ARG from MSYS format to w32 format.  Return
+# result in func_convert_core_msys_to_w32_result.
+func_convert_core_msys_to_w32 ()
+{
+  $opt_debug
+  # awkward: cmd appends spaces to result
+  func_convert_core_msys_to_w32_result=`( cmd //c echo &quot;$1&quot; ) 2&gt;/dev/null |
+    $SED -e 's/[ ]*$//' -e &quot;$lt_sed_naive_backslashify&quot;`
+}
+#end: func_convert_core_msys_to_w32
+
+
+# func_convert_file_check ARG1 ARG2
+# Verify that ARG1 (a file name in $build format) was converted to $host
+# format in ARG2. Otherwise, emit an error message, but continue (resetting
+# func_to_host_file_result to ARG1).
+func_convert_file_check ()
+{
+  $opt_debug
+  if test -z &quot;$2&quot; &amp;&amp; test -n &quot;$1&quot; ; then
+    func_error &quot;Could not determine host file name corresponding to&quot;
+    func_error &quot;  \`$1'&quot;
+    func_error &quot;Continuing, but uninstalled executables may not work.&quot;
+    # Fallback:
+    func_to_host_file_result=&quot;$1&quot;
+  fi
+}
+# end func_convert_file_check
+
+
+# func_convert_path_check FROM_PATHSEP TO_PATHSEP FROM_PATH TO_PATH
+# Verify that FROM_PATH (a path in $build format) was converted to $host
+# format in TO_PATH. Otherwise, emit an error message, but continue, resetting
+# func_to_host_file_result to a simplistic fallback value (see below).
+func_convert_path_check ()
+{
+  $opt_debug
+  if test -z &quot;$4&quot; &amp;&amp; test -n &quot;$3&quot;; then
+    func_error &quot;Could not determine the host path corresponding to&quot;
+    func_error &quot;  \`$3'&quot;
+    func_error &quot;Continuing, but uninstalled executables may not work.&quot;
+    # Fallback.  This is a deliberately simplistic &quot;conversion&quot; and
+    # should not be &quot;improved&quot;.  See libtool.info.
+    if test &quot;x$1&quot; != &quot;x$2&quot;; then
+      lt_replace_pathsep_chars=&quot;s|$1|$2|g&quot;
+      func_to_host_path_result=`echo &quot;$3&quot; |
+        $SED -e &quot;$lt_replace_pathsep_chars&quot;`
+    else
+      func_to_host_path_result=&quot;$3&quot;
+    fi
+  fi
+}
+# end func_convert_path_check
 
-      -Wl,*)
-	args=`$echo &quot;X$arg&quot; | $Xsed -e &quot;$sed_quote_subst&quot; -e 's/^-Wl,//'`
-	arg=
-	save_ifs=&quot;$IFS&quot;; IFS=','
-	for flag in $args; do
-	  IFS=&quot;$save_ifs&quot;
-	  case $flag in
-	    *[\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;&quot;)
-	    flag=&quot;\&quot;$flag\&quot;&quot;
-	    ;;
-	  esac
-	  arg=&quot;$arg $wl$flag&quot;
-	  compiler_flags=&quot;$compiler_flags $wl$flag&quot;
-	  linker_flags=&quot;$linker_flags $flag&quot;
-	done
-	IFS=&quot;$save_ifs&quot;
-	arg=`$echo &quot;X$arg&quot; | $Xsed -e &quot;s/^ //&quot;`
-	;;
 
-      -Xcompiler)
-	prev=xcompiler
-	continue
+# func_convert_path_front_back_pathsep FRONTPAT BACKPAT REPL ORIG
+# Modifies func_to_host_path_result by prepending REPL if ORIG matches FRONTPAT
+# and appending REPL if ORIG matches BACKPAT.
+func_convert_path_front_back_pathsep ()
+{
+  $opt_debug
+  case $4 in
+  $1 ) func_to_host_path_result=&quot;$3$func_to_host_path_result&quot;
+    ;;
+  esac
+  case $4 in
+  $2 ) func_append func_to_host_path_result &quot;$3&quot;
+    ;;
+  esac
+}
+# end func_convert_path_front_back_pathsep
+
+
+##################################################
+# $build to $host FILE NAME CONVERSION FUNCTIONS #
+##################################################
+# invoked via `$to_host_file_cmd ARG'
+#
+# In each case, ARG is the path to be converted from $build to $host format.
+# Result will be available in $func_to_host_file_result.
+
+
+# func_to_host_file ARG
+# Converts the file name ARG from $build format to $host format. Return result
+# in func_to_host_file_result.
+func_to_host_file ()
+{
+  $opt_debug
+  $to_host_file_cmd &quot;$1&quot;
+}
+# end func_to_host_file
+
+
+# func_to_tool_file ARG LAZY
+# converts the file name ARG from $build format to toolchain format. Return
+# result in func_to_tool_file_result.  If the conversion in use is listed
+# in (the comma separated) LAZY, no conversion takes place.
+func_to_tool_file ()
+{
+  $opt_debug
+  case ,$2, in
+    *,&quot;$to_tool_file_cmd&quot;,*)
+      func_to_tool_file_result=$1
+      ;;
+    *)
+      $to_tool_file_cmd &quot;$1&quot;
+      func_to_tool_file_result=$func_to_host_file_result
+      ;;
+  esac
+}
+# end func_to_tool_file
+
+
+# func_convert_file_noop ARG
+# Copy ARG to func_to_host_file_result.
+func_convert_file_noop ()
+{
+  func_to_host_file_result=&quot;$1&quot;
+}
+# end func_convert_file_noop
+
+
+# func_convert_file_msys_to_w32 ARG
+# Convert file name ARG from (mingw) MSYS to (mingw) w32 format; automatic
+# conversion to w32 is not available inside the cwrapper.  Returns result in
+# func_to_host_file_result.
+func_convert_file_msys_to_w32 ()
+{
+  $opt_debug
+  func_to_host_file_result=&quot;$1&quot;
+  if test -n &quot;$1&quot;; then
+    func_convert_core_msys_to_w32 &quot;$1&quot;
+    func_to_host_file_result=&quot;$func_convert_core_msys_to_w32_result&quot;
+  fi
+  func_convert_file_check &quot;$1&quot; &quot;$func_to_host_file_result&quot;
+}
+# end func_convert_file_msys_to_w32
+
+
+# func_convert_file_cygwin_to_w32 ARG
+# Convert file name ARG from Cygwin to w32 format.  Returns result in
+# func_to_host_file_result.
+func_convert_file_cygwin_to_w32 ()
+{
+  $opt_debug
+  func_to_host_file_result=&quot;$1&quot;
+  if test -n &quot;$1&quot;; then
+    # because $build is cygwin, we call &quot;the&quot; cygpath in $PATH; no need to use
+    # LT_CYGPATH in this case.
+    func_to_host_file_result=`cygpath -m &quot;$1&quot;`
+  fi
+  func_convert_file_check &quot;$1&quot; &quot;$func_to_host_file_result&quot;
+}
+# end func_convert_file_cygwin_to_w32
+
+
+# func_convert_file_nix_to_w32 ARG
+# Convert file name ARG from *nix to w32 format.  Requires a wine environment
+# and a working winepath. Returns result in func_to_host_file_result.
+func_convert_file_nix_to_w32 ()
+{
+  $opt_debug
+  func_to_host_file_result=&quot;$1&quot;
+  if test -n &quot;$1&quot;; then
+    func_convert_core_file_wine_to_w32 &quot;$1&quot;
+    func_to_host_file_result=&quot;$func_convert_core_file_wine_to_w32_result&quot;
+  fi
+  func_convert_file_check &quot;$1&quot; &quot;$func_to_host_file_result&quot;
+}
+# end func_convert_file_nix_to_w32
+
+
+# func_convert_file_msys_to_cygwin ARG
+# Convert file name ARG from MSYS to Cygwin format.  Requires LT_CYGPATH set.
+# Returns result in func_to_host_file_result.
+func_convert_file_msys_to_cygwin ()
+{
+  $opt_debug
+  func_to_host_file_result=&quot;$1&quot;
+  if test -n &quot;$1&quot;; then
+    func_convert_core_msys_to_w32 &quot;$1&quot;
+    func_cygpath -u &quot;$func_convert_core_msys_to_w32_result&quot;
+    func_to_host_file_result=&quot;$func_cygpath_result&quot;
+  fi
+  func_convert_file_check &quot;$1&quot; &quot;$func_to_host_file_result&quot;
+}
+# end func_convert_file_msys_to_cygwin
+
+
+# func_convert_file_nix_to_cygwin ARG
+# Convert file name ARG from *nix to Cygwin format.  Requires Cygwin installed
+# in a wine environment, working winepath, and LT_CYGPATH set.  Returns result
+# in func_to_host_file_result.
+func_convert_file_nix_to_cygwin ()
+{
+  $opt_debug
+  func_to_host_file_result=&quot;$1&quot;
+  if test -n &quot;$1&quot;; then
+    # convert from *nix to w32, then use cygpath to convert from w32 to cygwin.
+    func_convert_core_file_wine_to_w32 &quot;$1&quot;
+    func_cygpath -u &quot;$func_convert_core_file_wine_to_w32_result&quot;
+    func_to_host_file_result=&quot;$func_cygpath_result&quot;
+  fi
+  func_convert_file_check &quot;$1&quot; &quot;$func_to_host_file_result&quot;
+}
+# end func_convert_file_nix_to_cygwin
+
+
+#############################################
+# $build to $host PATH CONVERSION FUNCTIONS #
+#############################################
+# invoked via `$to_host_path_cmd ARG'
+#
+# In each case, ARG is the path to be converted from $build to $host format.
+# The result will be available in $func_to_host_path_result.
+#
+# Path separators are also converted from $build format to $host format.  If
+# ARG begins or ends with a path separator character, it is preserved (but
+# converted to $host format) on output.
+#
+# All path conversion functions are named using the following convention:
+#   file name conversion function    : func_convert_file_X_to_Y ()
+#   path conversion function         : func_convert_path_X_to_Y ()
+# where, for any given $build/$host combination the 'X_to_Y' value is the
+# same.  If conversion functions are added for new $build/$host combinations,
+# the two new functions must follow this pattern, or func_init_to_host_path_cmd
+# will break.
+
+
+# func_init_to_host_path_cmd
+# Ensures that function &quot;pointer&quot; variable $to_host_path_cmd is set to the
+# appropriate value, based on the value of $to_host_file_cmd.
+to_host_path_cmd=
+func_init_to_host_path_cmd ()
+{
+  $opt_debug
+  if test -z &quot;$to_host_path_cmd&quot;; then
+    func_stripname 'func_convert_file_' '' &quot;$to_host_file_cmd&quot;
+    to_host_path_cmd=&quot;func_convert_path_${func_stripname_result}&quot;
+  fi
+}
+
+
+# func_to_host_path ARG
+# Converts the path ARG from $build format to $host format. Return result
+# in func_to_host_path_result.
+func_to_host_path ()
+{
+  $opt_debug
+  func_init_to_host_path_cmd
+  $to_host_path_cmd &quot;$1&quot;
+}
+# end func_to_host_path
+
+
+# func_convert_path_noop ARG
+# Copy ARG to func_to_host_path_result.
+func_convert_path_noop ()
+{
+  func_to_host_path_result=&quot;$1&quot;
+}
+# end func_convert_path_noop
+
+
+# func_convert_path_msys_to_w32 ARG
+# Convert path ARG from (mingw) MSYS to (mingw) w32 format; automatic
+# conversion to w32 is not available inside the cwrapper.  Returns result in
+# func_to_host_path_result.
+func_convert_path_msys_to_w32 ()
+{
+  $opt_debug
+  func_to_host_path_result=&quot;$1&quot;
+  if test -n &quot;$1&quot;; then
+    # Remove leading and trailing path separator characters from ARG.  MSYS
+    # behavior is inconsistent here; cygpath turns them into '.;' and ';.';
+    # and winepath ignores them completely.
+    func_stripname : : &quot;$1&quot;
+    func_to_host_path_tmp1=$func_stripname_result
+    func_convert_core_msys_to_w32 &quot;$func_to_host_path_tmp1&quot;
+    func_to_host_path_result=&quot;$func_convert_core_msys_to_w32_result&quot;
+    func_convert_path_check : &quot;;&quot; \
+      &quot;$func_to_host_path_tmp1&quot; &quot;$func_to_host_path_result&quot;
+    func_convert_path_front_back_pathsep &quot;:*&quot; &quot;*:&quot; &quot;;&quot; &quot;$1&quot;
+  fi
+}
+# end func_convert_path_msys_to_w32
+
+
+# func_convert_path_cygwin_to_w32 ARG
+# Convert path ARG from Cygwin to w32 format.  Returns result in
+# func_to_host_file_result.
+func_convert_path_cygwin_to_w32 ()
+{
+  $opt_debug
+  func_to_host_path_result=&quot;$1&quot;
+  if test -n &quot;$1&quot;; then
+    # See func_convert_path_msys_to_w32:
+    func_stripname : : &quot;$1&quot;
+    func_to_host_path_tmp1=$func_stripname_result
+    func_to_host_path_result=`cygpath -m -p &quot;$func_to_host_path_tmp1&quot;`
+    func_convert_path_check : &quot;;&quot; \
+      &quot;$func_to_host_path_tmp1&quot; &quot;$func_to_host_path_result&quot;
+    func_convert_path_front_back_pathsep &quot;:*&quot; &quot;*:&quot; &quot;;&quot; &quot;$1&quot;
+  fi
+}
+# end func_convert_path_cygwin_to_w32
+
+
+# func_convert_path_nix_to_w32 ARG
+# Convert path ARG from *nix to w32 format.  Requires a wine environment and
+# a working winepath.  Returns result in func_to_host_file_result.
+func_convert_path_nix_to_w32 ()
+{
+  $opt_debug
+  func_to_host_path_result=&quot;$1&quot;
+  if test -n &quot;$1&quot;; then
+    # See func_convert_path_msys_to_w32:
+    func_stripname : : &quot;$1&quot;
+    func_to_host_path_tmp1=$func_stripname_result
+    func_convert_core_path_wine_to_w32 &quot;$func_to_host_path_tmp1&quot;
+    func_to_host_path_result=&quot;$func_convert_core_path_wine_to_w32_result&quot;
+    func_convert_path_check : &quot;;&quot; \
+      &quot;$func_to_host_path_tmp1&quot; &quot;$func_to_host_path_result&quot;
+    func_convert_path_front_back_pathsep &quot;:*&quot; &quot;*:&quot; &quot;;&quot; &quot;$1&quot;
+  fi
+}
+# end func_convert_path_nix_to_w32
+
+
+# func_convert_path_msys_to_cygwin ARG
+# Convert path ARG from MSYS to Cygwin format.  Requires LT_CYGPATH set.
+# Returns result in func_to_host_file_result.
+func_convert_path_msys_to_cygwin ()
+{
+  $opt_debug
+  func_to_host_path_result=&quot;$1&quot;
+  if test -n &quot;$1&quot;; then
+    # See func_convert_path_msys_to_w32:
+    func_stripname : : &quot;$1&quot;
+    func_to_host_path_tmp1=$func_stripname_result
+    func_convert_core_msys_to_w32 &quot;$func_to_host_path_tmp1&quot;
+    func_cygpath -u -p &quot;$func_convert_core_msys_to_w32_result&quot;
+    func_to_host_path_result=&quot;$func_cygpath_result&quot;
+    func_convert_path_check : : \
+      &quot;$func_to_host_path_tmp1&quot; &quot;$func_to_host_path_result&quot;
+    func_convert_path_front_back_pathsep &quot;:*&quot; &quot;*:&quot; : &quot;$1&quot;
+  fi
+}
+# end func_convert_path_msys_to_cygwin
+
+
+# func_convert_path_nix_to_cygwin ARG
+# Convert path ARG from *nix to Cygwin format.  Requires Cygwin installed in a
+# a wine environment, working winepath, and LT_CYGPATH set.  Returns result in
+# func_to_host_file_result.
+func_convert_path_nix_to_cygwin ()
+{
+  $opt_debug
+  func_to_host_path_result=&quot;$1&quot;
+  if test -n &quot;$1&quot;; then
+    # Remove leading and trailing path separator characters from
+    # ARG. msys behavior is inconsistent here, cygpath turns them
+    # into '.;' and ';.', and winepath ignores them completely.
+    func_stripname : : &quot;$1&quot;
+    func_to_host_path_tmp1=$func_stripname_result
+    func_convert_core_path_wine_to_w32 &quot;$func_to_host_path_tmp1&quot;
+    func_cygpath -u -p &quot;$func_convert_core_path_wine_to_w32_result&quot;
+    func_to_host_path_result=&quot;$func_cygpath_result&quot;
+    func_convert_path_check : : \
+      &quot;$func_to_host_path_tmp1&quot; &quot;$func_to_host_path_result&quot;
+    func_convert_path_front_back_pathsep &quot;:*&quot; &quot;*:&quot; : &quot;$1&quot;
+  fi
+}
+# end func_convert_path_nix_to_cygwin
+
+
+# func_mode_compile arg...
+func_mode_compile ()
+{
+    $opt_debug
+    # Get the compilation command and the source file.
+    base_compile=
+    srcfile=&quot;$nonopt&quot;  #  always keep a non-empty value in &quot;srcfile&quot;
+    suppress_opt=yes
+    suppress_output=
+    arg_mode=normal
+    libobj=
+    later=
+    pie_flag=
+
+    for arg
+    do
+      case $arg_mode in
+      arg  )
+	# do not &quot;continue&quot;.  Instead, add this to base_compile
+	lastarg=&quot;$arg&quot;
+	arg_mode=normal
 	;;
 
-      -Xlinker)
-	prev=xlinker
+      target )
+	libobj=&quot;$arg&quot;
+	arg_mode=normal
 	continue
 	;;
 
-      # Some other compiler flag.
-      -* | +*)
-	# Unknown arguments in both finalize_command and compile_command need
-	# to be aesthetically quoted because they are evaled later.
-	arg=`$echo &quot;X$arg&quot; | $Xsed -e &quot;$sed_quote_subst&quot;`
+      normal )
+	# Accept any command-line options.
 	case $arg in
-	*[\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;&quot;)
-	  arg=&quot;\&quot;$arg\&quot;&quot;
+	-o)
+	  test -n &quot;$libobj&quot; &amp;&amp; \
+	    func_fatal_error &quot;you cannot specify \`-o' more than once&quot;
+	  arg_mode=target
+	  continue
 	  ;;
-	esac
-	;;
 
-      *.lo | *.$objext)
-	# A library or standard object.
-	if test &quot;$prev&quot; = dlfiles; then
-	  # This file was specified with -dlopen.
-	  if test &quot;$build_libtool_libs&quot; = yes &amp;&amp; test &quot;$dlopen_support&quot; = yes; then
-	    dlfiles=&quot;$dlfiles $arg&quot;
-	    prev=
-	    continue
-	  else
-	    # If libtool objects are unsupported, then we need to preload.
-	    prev=dlprefiles
-	  fi
-	fi
+	-pie | -fpie | -fPIE)
+          func_append pie_flag &quot; $arg&quot;
+	  continue
+	  ;;
 
-	if test &quot;$prev&quot; = dlprefiles; then
-	  # Preload the old-style object.
-	  dlprefiles=&quot;$dlprefiles &quot;`$echo &quot;X$arg&quot; | $Xsed -e &quot;$lo2o&quot;`
-	  prev=
-	else
-	  case $arg in
-	  *.lo) libobjs=&quot;$libobjs $arg&quot; ;;
-	  *) objs=&quot;$objs $arg&quot; ;;
-	  esac
-	fi
+	-shared | -static | -prefer-pic | -prefer-non-pic)
+	  func_append later &quot; $arg&quot;
+	  continue
+	  ;;
+
+	-no-suppress)
+	  suppress_opt=no
+	  continue
+	  ;;
+
+	-Xcompiler)
+	  arg_mode=arg  #  the next one goes into the &quot;base_compile&quot; arg list
+	  continue      #  The current &quot;srcfile&quot; will either be retained or
+	  ;;            #  replaced later.  I would guess that would be a bug.
+
+	-Wc,*)
+	  func_stripname '-Wc,' '' &quot;$arg&quot;
+	  args=$func_stripname_result
+	  lastarg=
+	  save_ifs=&quot;$IFS&quot;; IFS=','
+	  for arg in $args; do
+	    IFS=&quot;$save_ifs&quot;
+	    func_append_quoted lastarg &quot;$arg&quot;
+	  done
+	  IFS=&quot;$save_ifs&quot;
+	  func_stripname ' ' '' &quot;$lastarg&quot;
+	  lastarg=$func_stripname_result
+
+	  # Add the arguments to base_compile.
+	  func_append base_compile &quot; $lastarg&quot;
+	  continue
+	  ;;
+
+	*)
+	  # Accept the current argument as the source file.
+	  # The previous &quot;srcfile&quot; becomes the current argument.
+	  #
+	  lastarg=&quot;$srcfile&quot;
+	  srcfile=&quot;$arg&quot;
+	  ;;
+	esac  #  case $arg
 	;;
+      esac    #  case $arg_mode
 
-      *.$libext)
-	# An archive.
-	deplibs=&quot;$deplibs $arg&quot;
-	old_deplibs=&quot;$old_deplibs $arg&quot;
+      # Aesthetically quote the previous argument.
+      func_append_quoted base_compile &quot;$lastarg&quot;
+    done # for arg
+
+    case $arg_mode in
+    arg)
+      func_fatal_error &quot;you must specify an argument for -Xcompile&quot;
+      ;;
+    target)
+      func_fatal_error &quot;you must specify a target with \`-o'&quot;
+      ;;
+    *)
+      # Get the name of the library object.
+      test -z &quot;$libobj&quot; &amp;&amp; {
+	func_basename &quot;$srcfile&quot;
+	libobj=&quot;$func_basename_result&quot;
+      }
+      ;;
+    esac
+
+    # Recognize several different file suffixes.
+    # If the user specifies -o file.o, it is replaced with file.lo
+    case $libobj in
+    *.[cCFSifmso] | \
+    *.ada | *.adb | *.ads | *.asm | \
+    *.c++ | *.cc | *.ii | *.class | *.cpp | *.cxx | \
+    *.[fF][09]? | *.for | *.java | *.obj | *.sx | *.cu | *.cup)
+      func_xform &quot;$libobj&quot;
+      libobj=$func_xform_result
+      ;;
+    esac
+
+    case $libobj in
+    *.lo) func_lo2o &quot;$libobj&quot;; obj=$func_lo2o_result ;;
+    *)
+      func_fatal_error &quot;cannot determine name of library object from \`$libobj'&quot;
+      ;;
+    esac
+
+    func_infer_tag $base_compile
+
+    for arg in $later; do
+      case $arg in
+      -shared)
+	test &quot;$build_libtool_libs&quot; != yes &amp;&amp; \
+	  func_fatal_configuration &quot;can not build a shared library&quot;
+	build_old_libs=no
 	continue
 	;;
 
-      *.la)
-	# A libtool-controlled library.
+      -static)
+	build_libtool_libs=no
+	build_old_libs=yes
+	continue
+	;;
 
-	if test &quot;$prev&quot; = dlfiles; then
-	  # This library was specified with -dlopen.
-	  dlfiles=&quot;$dlfiles $arg&quot;
-	  prev=
-	elif test &quot;$prev&quot; = dlprefiles; then
-	  # The library was specified with -dlpreopen.
-	  dlprefiles=&quot;$dlprefiles $arg&quot;
-	  prev=
-	else
-	  deplibs=&quot;$deplibs $arg&quot;
-	fi
+      -prefer-pic)
+	pic_mode=yes
 	continue
 	;;
 
-      # Some other compiler argument.
-      *)
-	# Unknown arguments in both finalize_command and compile_command need
-	# to be aesthetically quoted because they are evaled later.
-	arg=`$echo &quot;X$arg&quot; | $Xsed -e &quot;$sed_quote_subst&quot;`
-	case $arg in
-	*[\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;&quot;)
-	  arg=&quot;\&quot;$arg\&quot;&quot;
-	  ;;
-	esac
+      -prefer-non-pic)
+	pic_mode=no
+	continue
 	;;
-      esac # arg
+      esac
+    done
 
-      # Now actually substitute the argument into the commands.
-      if test -n &quot;$arg&quot;; then
-	compile_command=&quot;$compile_command $arg&quot;
-	finalize_command=&quot;$finalize_command $arg&quot;
-      fi
-    done # argument parsing loop
+    func_quote_for_eval &quot;$libobj&quot;
+    test &quot;X$libobj&quot; != &quot;X$func_quote_for_eval_result&quot; \
+      &amp;&amp; $ECHO &quot;X$libobj&quot; | $GREP '[]~#^*{};&lt;&gt;?&quot;'&quot;'&quot;'	 &amp;()|`$[]' \
+      &amp;&amp; func_warning &quot;libobj name \`$libobj' may not contain shell special characters.&quot;
+    func_dirname_and_basename &quot;$obj&quot; &quot;/&quot; &quot;&quot;
+    objname=&quot;$func_basename_result&quot;
+    xdir=&quot;$func_dirname_result&quot;
+    lobj=${xdir}$objdir/$objname
 
-    if test -n &quot;$prev&quot;; then
-      $echo &quot;$modename: the \`$prevarg' option requires an argument&quot; 1&gt;&amp;2
-      $echo &quot;$help&quot; 1&gt;&amp;2
-      exit 1
-    fi
+    test -z &quot;$base_compile&quot; &amp;&amp; \
+      func_fatal_help &quot;you must specify a compilation command&quot;
 
-    if test &quot;$export_dynamic&quot; = yes &amp;&amp; test -n &quot;$export_dynamic_flag_spec&quot;; then
-      eval arg=\&quot;$export_dynamic_flag_spec\&quot;
-      compile_command=&quot;$compile_command $arg&quot;
-      finalize_command=&quot;$finalize_command $arg&quot;
+    # Delete any leftover library objects.
+    if test &quot;$build_old_libs&quot; = yes; then
+      removelist=&quot;$obj $lobj $libobj ${libobj}T&quot;
+    else
+      removelist=&quot;$lobj $libobj ${libobj}T&quot;
     fi
 
-    # calculate the name of the file, without its directory
-    outputname=`$echo &quot;X$output&quot; | $Xsed -e 's%^.*/%%'`
-    libobjs_save=&quot;$libobjs&quot;
-
-    if test -n &quot;$shlibpath_var&quot;; then
-      # get the directories listed in $shlibpath_var
-      eval shlib_search_path=\`\$echo \&quot;X\${$shlibpath_var}\&quot; \| \$Xsed -e \'s/:/ /g\'\`
-    else
-      shlib_search_path=
+    # On Cygwin there's no &quot;real&quot; PIC flag so we must build both object types
+    case $host_os in
+    cygwin* | mingw* | pw32* | os2* | cegcc*)
+      pic_mode=default
+      ;;
+    esac
+    if test &quot;$pic_mode&quot; = no &amp;&amp; test &quot;$deplibs_check_method&quot; != pass_all; then
+      # non-PIC code in shared libraries is not supported
+      pic_mode=default
     fi
-    eval sys_lib_search_path=\&quot;$sys_lib_search_path_spec\&quot;
-    eval sys_lib_dlsearch_path=\&quot;$sys_lib_dlsearch_path_spec\&quot;
 
-    output_objdir=`$echo &quot;X$output&quot; | $Xsed -e 's%/[^/]*$%%'`
-    if test &quot;X$output_objdir&quot; = &quot;X$output&quot;; then
-      output_objdir=&quot;$objdir&quot;
+    # Calculate the filename of the output object if compiler does
+    # not support -o with -c
+    if test &quot;$compiler_c_o&quot; = no; then
+      output_obj=`$ECHO &quot;$srcfile&quot; | $SED 's%^.*/%%; s%\.[^.]*$%%'`.${objext}
+      lockfile=&quot;$output_obj.lock&quot;
     else
-      output_objdir=&quot;$output_objdir/$objdir&quot;
-    fi
-    # Create the object directory.
-    if test ! -d $output_objdir; then
-      $show &quot;$mkdir $output_objdir&quot;
-      $run $mkdir $output_objdir
-      status=$?
-      if test $status -ne 0 &amp;&amp; test ! -d $output_objdir; then
-	exit $status
-      fi
+      output_obj=
+      need_locks=no
+      lockfile=
     fi
 
-    # Determine the type of output
-    case $output in
-    &quot;&quot;)
-      $echo &quot;$modename: you must specify an output file&quot; 1&gt;&amp;2
-      $echo &quot;$help&quot; 1&gt;&amp;2
-      exit 1
-      ;;
-    *.$libext) linkmode=oldlib ;;
-    *.lo | *.$objext) linkmode=obj ;;
-    *.la) linkmode=lib ;;
-    *) linkmode=prog ;; # Anything else should be a program.
-    esac
-
-    specialdeplibs=
-    libs=
-    # Find all interdependent deplibs by searching for libraries
-    # that are linked more than once (e.g. -la -lb -la)
-    for deplib in $deplibs; do
-      case &quot;$libs &quot; in
-      *&quot; $deplib &quot;*) specialdeplibs=&quot;$specialdeplibs $deplib&quot; ;;
-      esac
-      libs=&quot;$libs $deplib&quot;
-    done
-    deplibs=
-    newdependency_libs=
-    newlib_search_path=
-    need_relink=no # whether we're linking any uninstalled libtool libraries
-    notinst_deplibs= # not-installed libtool libraries
-    notinst_path= # paths that contain not-installed libtool libraries
-    case $linkmode in
-    lib)
-	passes=&quot;conv link&quot;
-	for file in $dlfiles $dlprefiles; do
-	  case $file in
-	  *.la) ;;
-	  *)
-	    $echo &quot;$modename: libraries can \`-dlopen' only libtool libraries: $file&quot; 1&gt;&amp;2
-	    exit 1
-	    ;;
-	  esac
-	done
-	;;
-    prog)
-	compile_deplibs=
-	finalize_deplibs=
-	alldeplibs=no
-	newdlfiles=
-	newdlprefiles=
-	passes=&quot;conv scan dlopen dlpreopen link&quot;
-	;;
-    *)  passes=&quot;conv&quot;
-	;;
-    esac
-    for pass in $passes; do
-      if test $linkmode = prog; then
-	# Determine which files to process
-	case $pass in
-	dlopen)
-	  libs=&quot;$dlfiles&quot;
-	  save_deplibs=&quot;$deplibs&quot; # Collect dlpreopened libraries
-	  deplibs=
-	  ;;
-	dlpreopen) libs=&quot;$dlprefiles&quot; ;;
-	link) libs=&quot;$deplibs %DEPLIBS% $dependency_libs&quot; ;;
-	esac
-      fi
-      for deplib in $libs; do
-	lib=
-	found=no
-	case $deplib in
-	-l*)
-	  if test $linkmode = oldlib &amp;&amp; test $linkmode = obj; then
-	    $echo &quot;$modename: warning: \`-l' is ignored for archives/objects: $deplib&quot; 1&gt;&amp;2
-	    continue
-	  fi
-	  if test $pass = conv; then
-	    deplibs=&quot;$deplib $deplibs&quot;
-	    continue
-	  fi
-	  name=`$echo &quot;X$deplib&quot; | $Xsed -e 's/^-l//'`
-	  for searchdir in $newlib_search_path $lib_search_path $sys_lib_search_path $shlib_search_path; do
-	    # Search the libtool library
-	    lib=&quot;$searchdir/lib${name}.la&quot;
-	    if test -f &quot;$lib&quot;; then
-	      found=yes
-	      break
-	    fi
-	  done
-	  if test &quot;$found&quot; != yes; then
-	    # deplib doesn't seem to be a libtool library
-	    if test &quot;$linkmode,$pass&quot; = &quot;prog,link&quot;; then
-	      compile_deplibs=&quot;$deplib $compile_deplibs&quot;
-	      finalize_deplibs=&quot;$deplib $finalize_deplibs&quot;
-	    else
-	      deplibs=&quot;$deplib $deplibs&quot;
-	      test $linkmode = lib &amp;&amp; newdependency_libs=&quot;$deplib $newdependency_libs&quot;
-	    fi
-	    continue
-	  fi
-	  ;; # -l
-	-L*)
-	  case $linkmode in
-	  lib)
-	    deplibs=&quot;$deplib $deplibs&quot;
-	    test $pass = conv &amp;&amp; continue
-	    newdependency_libs=&quot;$deplib $newdependency_libs&quot;
-	    newlib_search_path=&quot;$newlib_search_path &quot;`$echo &quot;X$deplib&quot; | $Xsed -e 's/^-L//'`
-	    ;;
-	  prog)
-	    if test $pass = conv; then
-	      deplibs=&quot;$deplib $deplibs&quot;
-	      continue
-	    fi
-	    if test $pass = scan; then
-	      deplibs=&quot;$deplib $deplibs&quot;
-	      newlib_search_path=&quot;$newlib_search_path &quot;`$echo &quot;X$deplib&quot; | $Xsed -e 's/^-L//'`
-	    else
-	      compile_deplibs=&quot;$deplib $compile_deplibs&quot;
-	      finalize_deplibs=&quot;$deplib $finalize_deplibs&quot;
-	    fi
-	    ;;
-	  *)
-	    $echo &quot;$modename: warning: \`-L' is ignored for archives/objects: $deplib&quot; 1&gt;&amp;2
-	    ;;
-	  esac # linkmode
-	  continue
-	  ;; # -L
-	-R*)
-	  if test $pass = link; then
-	    dir=`$echo &quot;X$deplib&quot; | $Xsed -e 's/^-R//'`
-	    # Make sure the xrpath contains only unique directories.
-	    case &quot;$xrpath &quot; in
-	    *&quot; $dir &quot;*) ;;
-	    *) xrpath=&quot;$xrpath $dir&quot; ;;
-	    esac
-	  fi
-	  deplibs=&quot;$deplib $deplibs&quot;
-	  continue
-	  ;;
-	*.la) lib=&quot;$deplib&quot; ;;
-	*.$libext)
-	  if test $pass = conv; then
-	    deplibs=&quot;$deplib $deplibs&quot;
-	    continue
-	  fi
-	  case $linkmode in
-	  lib)
-	    if test &quot;$deplibs_check_method&quot; != pass_all; then
-	      echo
-	      echo &quot;*** Warning: This library needs some functionality provided by $deplib.&quot;
-	      echo &quot;*** I have the capability to make that library automatically link in when&quot;
-	      echo &quot;*** you link to this library.  But I can only do this if you have a&quot;
-	      echo &quot;*** shared version of the library, which you do not appear to have.&quot;
-	    else
-	      echo
-	      echo &quot;*** Warning: Linking the shared library $output against the&quot;
-	      echo &quot;*** static library $deplib is not portable!&quot;
-	      deplibs=&quot;$deplib $deplibs&quot;
-	    fi
-	    continue
-	    ;;
-	  prog)
-	    if test $pass != link; then
-	      deplibs=&quot;$deplib $deplibs&quot;
-	    else
-	      compile_deplibs=&quot;$deplib $compile_deplibs&quot;
-	      finalize_deplibs=&quot;$deplib $finalize_deplibs&quot;
-	    fi
-	    continue
-	    ;;
-	  esac # linkmode
-	  ;; # *.$libext
-	*.lo | *.$objext)
-	  if test $pass = dlpreopen || test &quot;$dlopen_support&quot; != yes || test &quot;$build_libtool_libs&quot; = no; then
-	    # If there is no dlopen support or we're linking statically,
-	    # we need to preload.
-	    newdlprefiles=&quot;$newdlprefiles $deplib&quot;
-	    compile_deplibs=&quot;$deplib $compile_deplibs&quot;
-	    finalize_deplibs=&quot;$deplib $finalize_deplibs&quot;
-	  else
-	    newdlfiles=&quot;$newdlfiles $deplib&quot;
-	  fi
-	  continue
-	  ;;
-	%DEPLIBS%)
-	  alldeplibs=yes
-	  continue
-	  ;;
-	esac # case $deplib
-	if test $found = yes || test -f &quot;$lib&quot;; then :
-	else
-	  $echo &quot;$modename: cannot find the library \`$lib'&quot; 1&gt;&amp;2
-	  exit 1
-	fi
+    # Lock this critical section if it is needed
+    # We use this script file to make the link, it avoids creating a new file
+    if test &quot;$need_locks&quot; = yes; then
+      until $opt_dry_run || ln &quot;$progpath&quot; &quot;$lockfile&quot; 2&gt;/dev/null; do
+	func_echo &quot;Waiting for $lockfile to be removed&quot;
+	sleep 2
+      done
+    elif test &quot;$need_locks&quot; = warn; then
+      if test -f &quot;$lockfile&quot;; then
+	$ECHO &quot;\
+*** ERROR, $lockfile exists and contains:
+`cat $lockfile 2&gt;/dev/null`
 
-	# Check to see that this really is a libtool archive.
-	if (sed -e '2q' $lib | egrep &quot;^# Generated by .*$PACKAGE&quot;) &gt;/dev/null 2&gt;&amp;1; then :
-	else
-	  $echo &quot;$modename: \`$lib' is not a valid libtool archive&quot; 1&gt;&amp;2
-	  exit 1
-	fi
+This indicates that another process is trying to use the same
+temporary object file, and libtool could not work around it because
+your compiler does not support \`-c' and \`-o' together.  If you
+repeat this compilation, it may succeed, by chance, but you had better
+avoid parallel builds (make -j) in this platform, or get a better
+compiler.&quot;
 
-	ladir=`$echo &quot;X$lib&quot; | $Xsed -e 's%/[^/]*$%%'`
-	test &quot;X$ladir&quot; = &quot;X$lib&quot; &amp;&amp; ladir=&quot;.&quot;
+	$opt_dry_run || $RM $removelist
+	exit $EXIT_FAILURE
+      fi
+      func_append removelist &quot; $output_obj&quot;
+      $ECHO &quot;$srcfile&quot; &gt; &quot;$lockfile&quot;
+    fi
 
-	dlname=
-	dlopen=
-	dlpreopen=
-	libdir=
-	library_names=
-	old_library=
-	# If the library was installed with an old release of libtool,
-	# it will not redefine variable installed.
-	installed=yes
+    $opt_dry_run || $RM $removelist
+    func_append removelist &quot; $lockfile&quot;
+    trap '$opt_dry_run || $RM $removelist; exit $EXIT_FAILURE' 1 2 15
 
-	# Read the .la file
-	case $lib in
-	*/* | *\\*) . $lib ;;
-	*) . ./$lib ;;
-	esac
+    func_to_tool_file &quot;$srcfile&quot; func_convert_file_msys_to_w32
+    srcfile=$func_to_tool_file_result
+    func_quote_for_eval &quot;$srcfile&quot;
+    qsrcfile=$func_quote_for_eval_result
 
-	if test &quot;$linkmode,$pass&quot; = &quot;lib,link&quot; ||
-	   test &quot;$linkmode,$pass&quot; = &quot;prog,scan&quot; ||
-	   { test $linkmode = oldlib &amp;&amp; test $linkmode = obj; }; then
-	   # Add dl[pre]opened files of deplib
-	  test -n &quot;$dlopen&quot; &amp;&amp; dlfiles=&quot;$dlfiles $dlopen&quot;
-	  test -n &quot;$dlpreopen&quot; &amp;&amp; dlprefiles=&quot;$dlprefiles $dlpreopen&quot;
-	fi
+    # Only build a PIC object if we are building libtool libraries.
+    if test &quot;$build_libtool_libs&quot; = yes; then
+      # Without this assignment, base_compile gets emptied.
+      fbsd_hideous_sh_bug=$base_compile
 
-	if test $pass = conv; then
-	  # Only check for convenience libraries
-	  deplibs=&quot;$lib $deplibs&quot;
-	  if test -z &quot;$libdir&quot;; then
-	    if test -z &quot;$old_library&quot;; then
-	      $echo &quot;$modename: cannot find name of link library for \`$lib'&quot; 1&gt;&amp;2
-	      exit 1
-	    fi
-	    # It is a libtool convenience library, so add in its objects.
-	    convenience=&quot;$convenience $ladir/$objdir/$old_library&quot;
-	    old_convenience=&quot;$old_convenience $ladir/$objdir/$old_library&quot;
-	    tmp_libs=
-	    for deplib in $dependency_libs; do
-	      deplibs=&quot;$deplib $deplibs&quot;
-	      case &quot;$tmp_libs &quot; in
-	      *&quot; $deplib &quot;*) specialdeplibs=&quot;$specialdeplibs $deplib&quot; ;;
-	      esac
-	      tmp_libs=&quot;$tmp_libs $deplib&quot;
-	    done
-	  elif test $linkmode != prog &amp;&amp; test $linkmode != lib; then
-	    $echo &quot;$modename: \`$lib' is not a convenience library&quot; 1&gt;&amp;2
-	    exit 1
-	  fi
-	  continue
-	fi # $pass = conv
+      if test &quot;$pic_mode&quot; != no; then
+	command=&quot;$base_compile $qsrcfile $pic_flag&quot;
+      else
+	# Don't build PIC code
+	command=&quot;$base_compile $qsrcfile&quot;
+      fi
 
-	# Get the name of the library we link against.
-	linklib=
-	for l in $old_library $library_names; do
-	  linklib=&quot;$l&quot;
-	done
-	if test -z &quot;$linklib&quot;; then
-	  $echo &quot;$modename: cannot find name of link library for \`$lib'&quot; 1&gt;&amp;2
-	  exit 1
-	fi
+      func_mkdir_p &quot;$xdir$objdir&quot;
 
-	# This library was specified with -dlopen.
-	if test $pass = dlopen; then
-	  if test -z &quot;$libdir&quot;; then
-	    $echo &quot;$modename: cannot -dlopen a convenience library: \`$lib'&quot; 1&gt;&amp;2
-	    exit 1
-	  fi
-	  if test -z &quot;$dlname&quot; || test &quot;$dlopen_support&quot; != yes || test &quot;$build_libtool_libs&quot; = no; then
-	    # If there is no dlname, no dlopen support or we're linking
-	    # statically, we need to preload.
-	    dlprefiles=&quot;$dlprefiles $lib&quot;
-	  else
-	    newdlfiles=&quot;$newdlfiles $lib&quot;
-	  fi
-	  continue
-	fi # $pass = dlopen
+      if test -z &quot;$output_obj&quot;; then
+	# Place PIC objects in $objdir
+	func_append command &quot; -o $lobj&quot;
+      fi
 
-	# We need an absolute path.
-	case $ladir in
-	[\\/]* | [A-Za-z]:[\\/]*) abs_ladir=&quot;$ladir&quot; ;;
-	*)
-	  abs_ladir=`cd &quot;$ladir&quot; &amp;&amp; pwd`
-	  if test -z &quot;$abs_ladir&quot;; then
-	    $echo &quot;$modename: warning: cannot determine absolute directory name of \`$ladir'&quot; 1&gt;&amp;2
-	    $echo &quot;$modename: passing it literally to the linker, although it might fail&quot; 1&gt;&amp;2
-	    abs_ladir=&quot;$ladir&quot;
-	  fi
-	  ;;
-	esac
-	laname=`$echo &quot;X$lib&quot; | $Xsed -e 's%^.*/%%'`
+      func_show_eval_locale &quot;$command&quot;	\
+          'test -n &quot;$output_obj&quot; &amp;&amp; $RM $removelist; exit $EXIT_FAILURE'
 
-	# Find the relevant object directory and library name.
-	if test &quot;X$installed&quot; = Xyes; then
-	  if test ! -f &quot;$libdir/$linklib&quot; &amp;&amp; test -f &quot;$abs_ladir/$linklib&quot;; then
-	    $echo &quot;$modename: warning: library \`$lib' was moved.&quot; 1&gt;&amp;2
-	    dir=&quot;$ladir&quot;
-	    absdir=&quot;$abs_ladir&quot;
-	    libdir=&quot;$abs_ladir&quot;
-	  else
-	    dir=&quot;$libdir&quot;
-	    absdir=&quot;$libdir&quot;
-	  fi
-	else
-	  dir=&quot;$ladir/$objdir&quot;
-	  absdir=&quot;$abs_ladir/$objdir&quot;
-	  # Remove this search path later
-	  notinst_path=&quot;$notinst_path $abs_ladir&quot;
-	fi # $installed = yes
-	name=`$echo &quot;X$laname&quot; | $Xsed -e 's/\.la$//' -e 's/^lib//'`
+      if test &quot;$need_locks&quot; = warn &amp;&amp;
+	 test &quot;X`cat $lockfile 2&gt;/dev/null`&quot; != &quot;X$srcfile&quot;; then
+	$ECHO &quot;\
+*** ERROR, $lockfile contains:
+`cat $lockfile 2&gt;/dev/null`
 
-	# This library was specified with -dlpreopen.
-	if test $pass = dlpreopen; then
-	  if test -z &quot;$libdir&quot;; then
-	    $echo &quot;$modename: cannot -dlpreopen a convenience library: \`$lib'&quot; 1&gt;&amp;2
-	    exit 1
-	  fi
-	  # Prefer using a static library (so that no silly _DYNAMIC symbols
-	  # are required to link).
-	  if test -n &quot;$old_library&quot;; then
-	    newdlprefiles=&quot;$newdlprefiles $dir/$old_library&quot;
-	  # Otherwise, use the dlname, so that lt_dlopen finds it.
-	  elif test -n &quot;$dlname&quot;; then
-	    newdlprefiles=&quot;$newdlprefiles $dir/$dlname&quot;
-	  else
-	    newdlprefiles=&quot;$newdlprefiles $dir/$linklib&quot;
-	  fi
-	fi # $pass = dlpreopen
+but it should contain:
+$srcfile
 
-	if test -z &quot;$libdir&quot;; then
-	  # Link the convenience library
-	  if test $linkmode = lib; then
-	    deplibs=&quot;$dir/$old_library $deplibs&quot;
-	  elif test &quot;$linkmode,$pass&quot; = &quot;prog,link&quot;; then
-	    compile_deplibs=&quot;$dir/$old_library $compile_deplibs&quot;
-	    finalize_deplibs=&quot;$dir/$old_library $finalize_deplibs&quot;
-	  else
-	    deplibs=&quot;$lib $deplibs&quot;
-	  fi
-	  continue
-	fi
+This indicates that another process is trying to use the same
+temporary object file, and libtool could not work around it because
+your compiler does not support \`-c' and \`-o' together.  If you
+repeat this compilation, it may succeed, by chance, but you had better
+avoid parallel builds (make -j) in this platform, or get a better
+compiler.&quot;
 
-	if test $linkmode = prog &amp;&amp; test $pass != link; then
-	  newlib_search_path=&quot;$newlib_search_path $ladir&quot;
-	  deplibs=&quot;$lib $deplibs&quot;
+	$opt_dry_run || $RM $removelist
+	exit $EXIT_FAILURE
+      fi
 
-	  linkalldeplibs=no
-	  if test &quot;$link_all_deplibs&quot; != no || test -z &quot;$library_names&quot; ||
-	     test &quot;$build_libtool_libs&quot; = no; then
-	    linkalldeplibs=yes
-	  fi
+      # Just move the object if needed, then go on to compile the next one
+      if test -n &quot;$output_obj&quot; &amp;&amp; test &quot;X$output_obj&quot; != &quot;X$lobj&quot;; then
+	func_show_eval '$MV &quot;$output_obj&quot; &quot;$lobj&quot;' \
+	  'error=$?; $opt_dry_run || $RM $removelist; exit $error'
+      fi
 
-	  tmp_libs=
-	  for deplib in $dependency_libs; do
-	    case $deplib in
-	    -L*) newlib_search_path=&quot;$newlib_search_path &quot;`$echo &quot;X$deplib&quot; | $Xsed -e 's/^-L//'`;; ### testsuite: skip nested quoting test
-	    esac
-	    # Need to link against all dependency_libs?
-	    if test $linkalldeplibs = yes; then
-	      deplibs=&quot;$deplib $deplibs&quot;
-	    else
-	      # Need to hardcode shared library paths
-	      # or/and link against static libraries
-	      newdependency_libs=&quot;$deplib $newdependency_libs&quot;
-	    fi
-	    case &quot;$tmp_libs &quot; in
-	    *&quot; $deplib &quot;*) specialdeplibs=&quot;$specialdeplibs $deplib&quot; ;;
-	    esac
-	    tmp_libs=&quot;$tmp_libs $deplib&quot;
-	  done # for deplib
-	  continue
-	fi # $linkmode = prog...
+      # Allow error messages only from the first compilation.
+      if test &quot;$suppress_opt&quot; = yes; then
+	suppress_output=' &gt;/dev/null 2&gt;&amp;1'
+      fi
+    fi
 
-	link_static=no # Whether the deplib will be linked statically
-	if test -n &quot;$library_names&quot; &amp;&amp;
-	   { test &quot;$prefer_static_libs&quot; = no || test -z &quot;$old_library&quot;; }; then
-	  # Link against this shared library
+    # Only build a position-dependent object if we build old libraries.
+    if test &quot;$build_old_libs&quot; = yes; then
+      if test &quot;$pic_mode&quot; != yes; then
+	# Don't build PIC code
+	command=&quot;$base_compile $qsrcfile$pie_flag&quot;
+      else
+	command=&quot;$base_compile $qsrcfile $pic_flag&quot;
+      fi
+      if test &quot;$compiler_c_o&quot; = yes; then
+	func_append command &quot; -o $obj&quot;
+      fi
 
-	  if test &quot;$linkmode,$pass&quot; = &quot;prog,link&quot; ||
-	   { test $linkmode = lib &amp;&amp; test $hardcode_into_libs = yes; }; then
-	    # Hardcode the library path.
-	    # Skip directories that are in the system default run-time
-	    # search path.
-	    case &quot; $sys_lib_dlsearch_path &quot; in
-	    *&quot; $absdir &quot;*) ;;
-	    *)
-	      case &quot;$compile_rpath &quot; in
-	      *&quot; $absdir &quot;*) ;;
-	      *) compile_rpath=&quot;$compile_rpath $absdir&quot;
-	      esac
-	      ;;
-	    esac
-	    case &quot; $sys_lib_dlsearch_path &quot; in
-	    *&quot; $libdir &quot;*) ;;
-	    *)
-	      case &quot;$finalize_rpath &quot; in
-	      *&quot; $libdir &quot;*) ;;
-	      *) finalize_rpath=&quot;$finalize_rpath $libdir&quot;
-	      esac
-	      ;;
-	    esac
-	    if test $linkmode = prog; then
-	      # We need to hardcode the library path
-	      if test -n &quot;$shlibpath_var&quot;; then
-		# Make sure the rpath contains only unique directories.
-		case &quot;$temp_rpath &quot; in
-		*&quot; $dir &quot;*) ;;
-		*&quot; $absdir &quot;*) ;;
-		*) temp_rpath=&quot;$temp_rpath $dir&quot; ;;
-		esac
-	      fi
-	    fi
-	  fi # $linkmode,$pass = prog,link...
+      # Suppress compiler output if we already did a PIC compilation.
+      func_append command &quot;$suppress_output&quot;
+      func_show_eval_locale &quot;$command&quot; \
+        '$opt_dry_run || $RM $removelist; exit $EXIT_FAILURE'
 
-	  if test &quot;$alldeplibs&quot; = yes &amp;&amp;
-	     { test &quot;$deplibs_check_method&quot; = pass_all ||
-	       { test &quot;$build_libtool_libs&quot; = yes &amp;&amp;
-		 test -n &quot;$library_names&quot;; }; }; then
-	    # We only need to search for static libraries
-	    continue
-	  fi
+      if test &quot;$need_locks&quot; = warn &amp;&amp;
+	 test &quot;X`cat $lockfile 2&gt;/dev/null`&quot; != &quot;X$srcfile&quot;; then
+	$ECHO &quot;\
+*** ERROR, $lockfile contains:
+`cat $lockfile 2&gt;/dev/null`
 
-	  if test &quot;$installed&quot; = no; then
-	    notinst_deplibs=&quot;$notinst_deplibs $lib&quot;
-	    need_relink=yes
-	  fi
+but it should contain:
+$srcfile
 
-	  if test -n &quot;$old_archive_from_expsyms_cmds&quot;; then
-	    # figure out the soname
-	    set dummy $library_names
-	    realname=&quot;$2&quot;
-	    shift; shift
-	    libname=`eval \\$echo \&quot;$libname_spec\&quot;`
-	    # use dlname if we got it. it's perfectly good, no?
-	    if test -n &quot;$dlname&quot;; then
-	      soname=&quot;$dlname&quot;
-	    elif test -n &quot;$soname_spec&quot;; then
-	      # bleh windows
-	      case $host in
-	      *cygwin*)
-		major=`expr $current - $age`
-		versuffix=&quot;-$major&quot;
-		;;
-	      esac
-	      eval soname=\&quot;$soname_spec\&quot;
-	    else
-	      soname=&quot;$realname&quot;
-	    fi
+This indicates that another process is trying to use the same
+temporary object file, and libtool could not work around it because
+your compiler does not support \`-c' and \`-o' together.  If you
+repeat this compilation, it may succeed, by chance, but you had better
+avoid parallel builds (make -j) in this platform, or get a better
+compiler.&quot;
 
-	    # Make a new name for the extract_expsyms_cmds to use
-	    soroot=&quot;$soname&quot;
-	    soname=`echo $soroot | sed -e 's/^.*\///'`
-	    newlib=&quot;libimp-`echo $soname | sed 's/^lib//;s/\.dll$//'`.a&quot;
+	$opt_dry_run || $RM $removelist
+	exit $EXIT_FAILURE
+      fi
 
-	    # If the library has no export list, then create one now
-	    if test -f &quot;$output_objdir/$soname-def&quot;; then :
-	    else
-	      $show &quot;extracting exported symbol list from \`$soname'&quot;
-	      save_ifs=&quot;$IFS&quot;; IFS='~'
-	      eval cmds=\&quot;$extract_expsyms_cmds\&quot;
-	      for cmd in $cmds; do
-		IFS=&quot;$save_ifs&quot;
-		$show &quot;$cmd&quot;
-		$run eval &quot;$cmd&quot; || exit $?
-	      done
-	      IFS=&quot;$save_ifs&quot;
-	    fi
+      # Just move the object if needed
+      if test -n &quot;$output_obj&quot; &amp;&amp; test &quot;X$output_obj&quot; != &quot;X$obj&quot;; then
+	func_show_eval '$MV &quot;$output_obj&quot; &quot;$obj&quot;' \
+	  'error=$?; $opt_dry_run || $RM $removelist; exit $error'
+      fi
+    fi
 
-	    # Create $newlib
-	    if test -f &quot;$output_objdir/$newlib&quot;; then :; else
-	      $show &quot;generating import library for \`$soname'&quot;
-	      save_ifs=&quot;$IFS&quot;; IFS='~'
-	      eval cmds=\&quot;$old_archive_from_expsyms_cmds\&quot;
-	      for cmd in $cmds; do
-		IFS=&quot;$save_ifs&quot;
-		$show &quot;$cmd&quot;
-		$run eval &quot;$cmd&quot; || exit $?
-	      done
-	      IFS=&quot;$save_ifs&quot;
-	    fi
-	    # make sure the library variables are pointing to the new library
-	    dir=$output_objdir
-	    linklib=$newlib
-	  fi # test -n $old_archive_from_expsyms_cmds
+    $opt_dry_run || {
+      func_write_libtool_object &quot;$libobj&quot; &quot;$objdir/$objname&quot; &quot;$objname&quot;
 
-	  if test $linkmode = prog || test &quot;$mode&quot; != relink; then
-	    add_shlibpath=
-	    add_dir=
-	    add=
-	    lib_linked=yes
-	    case $hardcode_action in
-	    immediate | unsupported)
-	      if test &quot;$hardcode_direct&quot; = no; then
-		add=&quot;$dir/$linklib&quot;
-	      elif test &quot;$hardcode_minus_L&quot; = no; then
-		case $host in
-		*-*-sunos*) add_shlibpath=&quot;$dir&quot; ;;
-		esac
-		add_dir=&quot;-L$dir&quot;
-		add=&quot;-l$name&quot;
-	      elif test &quot;$hardcode_shlibpath_var&quot; = no; then
-		add_shlibpath=&quot;$dir&quot;
-		add=&quot;-l$name&quot;
-	      else
-		lib_linked=no
-	      fi
-	      ;;
-	    relink)
-	      if test &quot;$hardcode_direct&quot; = yes; then
-		add=&quot;$dir/$linklib&quot;
-	      elif test &quot;$hardcode_minus_L&quot; = yes; then
-		add_dir=&quot;-L$dir&quot;
-		add=&quot;-l$name&quot;
-	      elif test &quot;$hardcode_shlibpath_var&quot; = yes; then
-		add_shlibpath=&quot;$dir&quot;
-		add=&quot;-l$name&quot;
-	      else
-		lib_linked=no
-	      fi
-	      ;;
-	    *) lib_linked=no ;;
-	    esac
+      # Unlock the critical section if it was locked
+      if test &quot;$need_locks&quot; != no; then
+	removelist=$lockfile
+        $RM &quot;$lockfile&quot;
+      fi
+    }
 
-	    if test &quot;$lib_linked&quot; != yes; then
-	      $echo &quot;$modename: configuration error: unsupported hardcode properties&quot;
-	      exit 1
-	    fi
+    exit $EXIT_SUCCESS
+}
 
-	    if test -n &quot;$add_shlibpath&quot;; then
-	      case :$compile_shlibpath: in
-	      *&quot;:$add_shlibpath:&quot;*) ;;
-	      *) compile_shlibpath=&quot;$compile_shlibpath$add_shlibpath:&quot; ;;
-	      esac
-	    fi
-	    if test $linkmode = prog; then
-	      test -n &quot;$add_dir&quot; &amp;&amp; compile_deplibs=&quot;$add_dir $compile_deplibs&quot;
-	      test -n &quot;$add&quot; &amp;&amp; compile_deplibs=&quot;$add $compile_deplibs&quot;
-	    else
-	      test -n &quot;$add_dir&quot; &amp;&amp; deplibs=&quot;$add_dir $deplibs&quot;
-	      test -n &quot;$add&quot; &amp;&amp; deplibs=&quot;$add $deplibs&quot;
-	      if test &quot;$hardcode_direct&quot; != yes &amp;&amp; \
-		 test &quot;$hardcode_minus_L&quot; != yes &amp;&amp; \
-		 test &quot;$hardcode_shlibpath_var&quot; = yes; then
-		case :$finalize_shlibpath: in
-		*&quot;:$libdir:&quot;*) ;;
-		*) finalize_shlibpath=&quot;$finalize_shlibpath$libdir:&quot; ;;
-		esac
-	      fi
-	    fi
-	  fi
+$opt_help || {
+  test &quot;$opt_mode&quot; = compile &amp;&amp; func_mode_compile ${1+&quot;$@&quot;}
+}
 
-	  if test $linkmode = prog || test &quot;$mode&quot; = relink; then
-	    add_shlibpath=
-	    add_dir=
-	    add=
-	    # Finalize command for both is simple: just hardcode it.
-	    if test &quot;$hardcode_direct&quot; = yes; then
-	      add=&quot;$libdir/$linklib&quot;
-	    elif test &quot;$hardcode_minus_L&quot; = yes; then
-	      add_dir=&quot;-L$libdir&quot;
-	      add=&quot;-l$name&quot;
-	    elif test &quot;$hardcode_shlibpath_var&quot; = yes; then
-	      case :$finalize_shlibpath: in
-	      *&quot;:$libdir:&quot;*) ;;
-	      *) finalize_shlibpath=&quot;$finalize_shlibpath$libdir:&quot; ;;
-	      esac
-	      add=&quot;-l$name&quot;
-	    else
-	      # We cannot seem to hardcode it, guess we'll fake it.
-	      add_dir=&quot;-L$libdir&quot;
-	      add=&quot;-l$name&quot;
-	    fi
+func_mode_help ()
+{
+    # We need to display help for each of the modes.
+    case $opt_mode in
+      &quot;&quot;)
+        # Generic help is extracted from the usage comments
+        # at the start of this file.
+        func_help
+        ;;
 
-	    if test $linkmode = prog; then
-	      test -n &quot;$add_dir&quot; &amp;&amp; finalize_deplibs=&quot;$add_dir $finalize_deplibs&quot;
-	      test -n &quot;$add&quot; &amp;&amp; finalize_deplibs=&quot;$add $finalize_deplibs&quot;
-	    else
-	      test -n &quot;$add_dir&quot; &amp;&amp; deplibs=&quot;$add_dir $deplibs&quot;
-	      test -n &quot;$add&quot; &amp;&amp; deplibs=&quot;$add $deplibs&quot;
-	    fi
-	  fi
-	elif test $linkmode = prog; then
-	  if test &quot;$alldeplibs&quot; = yes &amp;&amp;
-	     { test &quot;$deplibs_check_method&quot; = pass_all ||
-	       { test &quot;$build_libtool_libs&quot; = yes &amp;&amp;
-		 test -n &quot;$library_names&quot;; }; }; then
-	    # We only need to search for static libraries
-	    continue
-	  fi
+      clean)
+        $ECHO \
+&quot;Usage: $progname [OPTION]... --mode=clean RM [RM-OPTION]... FILE...
 
-	  # Try to link the static library
-	  # Here we assume that one of hardcode_direct or hardcode_minus_L
-	  # is not unsupported.  This is valid on all known static and
-	  # shared platforms.
-	  if test &quot;$hardcode_direct&quot; != unsupported; then
-	    test -n &quot;$old_library&quot; &amp;&amp; linklib=&quot;$old_library&quot;
-	    compile_deplibs=&quot;$dir/$linklib $compile_deplibs&quot;
-	    finalize_deplibs=&quot;$dir/$linklib $finalize_deplibs&quot;
-	  else
-	    compile_deplibs=&quot;-l$name -L$dir $compile_deplibs&quot;
-	    finalize_deplibs=&quot;-l$name -L$dir $finalize_deplibs&quot;
-	  fi
-	elif test &quot;$build_libtool_libs&quot; = yes; then
-	  # Not a shared library
-	  if test &quot;$deplibs_check_method&quot; != pass_all; then
-	    # We're trying link a shared library against a static one
-	    # but the system doesn't support it.
+Remove files from the build directory.
 
-	    # Just print a warning and add the library to dependency_libs so
-	    # that the program can be linked against the static library.
-	    echo
-	    echo &quot;*** Warning: This library needs some functionality provided by $lib.&quot;
-	    echo &quot;*** I have the capability to make that library automatically link in when&quot;
-	    echo &quot;*** you link to this library.  But I can only do this if you have a&quot;
-	    echo &quot;*** shared version of the library, which you do not appear to have.&quot;
-	    if test &quot;$module&quot; = yes; then
-	      echo &quot;*** Therefore, libtool will create a static module, that should work &quot;
-	      echo &quot;*** as long as the dlopening application is linked with the -dlopen flag.&quot;
-	      if test -z &quot;$global_symbol_pipe&quot;; then
-		echo
-		echo &quot;*** However, this would only work if libtool was able to extract symbol&quot;
-		echo &quot;*** lists from a program, using \`nm' or equivalent, but libtool could&quot;
-		echo &quot;*** not find such a program.  So, this module is probably useless.&quot;
-		echo &quot;*** \`nm' from GNU binutils and a full rebuild may help.&quot;
-	      fi
-	      if test &quot;$build_old_libs&quot; = no; then
-		build_libtool_libs=module
-		build_old_libs=yes
-	      else
-		build_libtool_libs=no
-	      fi
-	    fi
-	  else
-	    convenience=&quot;$convenience $dir/$old_library&quot;
-	    old_convenience=&quot;$old_convenience $dir/$old_library&quot;
-	    deplibs=&quot;$dir/$old_library $deplibs&quot;
-	    link_static=yes
-	  fi
-	fi # link shared/static library?
+RM is the name of the program to use to delete files associated with each FILE
+(typically \`/bin/rm').  RM-OPTIONS are options (such as \`-f') to be passed
+to RM.
 
-	if test $linkmode = lib; then
-	  if test -n &quot;$dependency_libs&quot; &amp;&amp;
-	     { test $hardcode_into_libs != yes || test $build_old_libs = yes ||
-	       test $link_static = yes; }; then
-	    # Extract -R from dependency_libs
-	    temp_deplibs=
-	    for libdir in $dependency_libs; do
-	      case $libdir in
-	      -R*) temp_xrpath=`$echo &quot;X$libdir&quot; | $Xsed -e 's/^-R//'`
-		   case &quot; $xrpath &quot; in
-		   *&quot; $temp_xrpath &quot;*) ;;
-		   *) xrpath=&quot;$xrpath $temp_xrpath&quot;;;
-		   esac;;
-	      *) temp_deplibs=&quot;$temp_deplibs $libdir&quot;;;
-	      esac
-	    done
-	    dependency_libs=&quot;$temp_deplibs&quot;
-	  fi
+If FILE is a libtool library, object or program, all the files associated
+with it are deleted. Otherwise, only FILE itself is deleted using RM.&quot;
+        ;;
 
-	  newlib_search_path=&quot;$newlib_search_path $absdir&quot;
-	  # Link against this library
-	  test &quot;$link_static&quot; = no &amp;&amp; newdependency_libs=&quot;$abs_ladir/$laname $newdependency_libs&quot;
-	  # ... and its dependency_libs
-	  tmp_libs=
-	  for deplib in $dependency_libs; do
-	    newdependency_libs=&quot;$deplib $newdependency_libs&quot;
-	    case &quot;$tmp_libs &quot; in
-	    *&quot; $deplib &quot;*) specialdeplibs=&quot;$specialdeplibs $deplib&quot; ;;
-	    esac
-	    tmp_libs=&quot;$tmp_libs $deplib&quot;
-	  done
+      compile)
+      $ECHO \
+&quot;Usage: $progname [OPTION]... --mode=compile COMPILE-COMMAND... SOURCEFILE
 
-	  if test $link_all_deplibs != no; then
-	    # Add the search paths of all dependency libraries
-	    for deplib in $dependency_libs; do
-	      case $deplib in
-	      -L*) path=&quot;$deplib&quot; ;;
-	      *.la)
-		dir=`$echo &quot;X$deplib&quot; | $Xsed -e 's%/[^/]*$%%'`
-		test &quot;X$dir&quot; = &quot;X$deplib&quot; &amp;&amp; dir=&quot;.&quot;
-		# We need an absolute path.
-		case $dir in
-		[\\/]* | [A-Za-z]:[\\/]*) absdir=&quot;$dir&quot; ;;
-		*)
-		  absdir=`cd &quot;$dir&quot; &amp;&amp; pwd`
-		  if test -z &quot;$absdir&quot;; then
-		    $echo &quot;$modename: warning: cannot determine absolute directory name of \`$dir'&quot; 1&gt;&amp;2
-		    absdir=&quot;$dir&quot;
-		  fi
-		  ;;
-		esac
-		if grep &quot;^installed=no&quot; $deplib &gt; /dev/null; then
-		  path=&quot;-L$absdir/$objdir&quot;
-		else
-		  eval libdir=`sed -n -e 's/^libdir=\(.*\)$/\1/p' $deplib`
-		  if test -z &quot;$libdir&quot;; then
-		    $echo &quot;$modename: \`$deplib' is not a valid libtool archive&quot; 1&gt;&amp;2
-		    exit 1
-		  fi
-		  if test &quot;$absdir&quot; != &quot;$libdir&quot;; then
-		    $echo &quot;$modename: warning: \`$deplib' seems to be moved&quot; 1&gt;&amp;2
-		  fi
-		  path=&quot;-L$absdir&quot;
-		fi
-		;;
-	      *) continue ;;
-	      esac
-	      case &quot; $deplibs &quot; in
-	      *&quot; $path &quot;*) ;;
-	      *) deplibs=&quot;$deplibs $path&quot; ;;
-	      esac
-	    done
-	  fi # link_all_deplibs != no
-	fi # linkmode = lib
-      done # for deplib in $libs
-      if test $pass = dlpreopen; then
-	# Link the dlpreopened libraries before other libraries
-	for deplib in $save_deplibs; do
-	  deplibs=&quot;$deplib $deplibs&quot;
-	done
-      fi
-      if test $pass != dlopen; then
-	test $pass != scan &amp;&amp; dependency_libs=&quot;$newdependency_libs&quot;
-	if test $pass != conv; then
-	  # Make sure lib_search_path contains only unique directories.
-	  lib_search_path=
-	  for dir in $newlib_search_path; do
-	    case &quot;$lib_search_path &quot; in
-	    *&quot; $dir &quot;*) ;;
-	    *) lib_search_path=&quot;$lib_search_path $dir&quot; ;;
-	    esac
-	  done
-	  newlib_search_path=
-	fi
+Compile a source file into a libtool library object.
 
-	if test &quot;$linkmode,$pass&quot; != &quot;prog,link&quot;; then
-	  vars=&quot;deplibs&quot;
-	else
-	  vars=&quot;compile_deplibs finalize_deplibs&quot;
-	fi
-	for var in $vars dependency_libs; do
-	  # Add libraries to $var in reverse order
-	  eval tmp_libs=\&quot;\$$var\&quot;
-	  new_libs=
-	  for deplib in $tmp_libs; do
-	    case $deplib in
-	    -L*) new_libs=&quot;$deplib $new_libs&quot; ;;
-	    *)
-	      case &quot; $specialdeplibs &quot; in
-	      *&quot; $deplib &quot;*) new_libs=&quot;$deplib $new_libs&quot; ;;
-	      *)
-		case &quot; $new_libs &quot; in
-		*&quot; $deplib &quot;*) ;;
-		*) new_libs=&quot;$deplib $new_libs&quot; ;;
-		esac
-		;;
-	      esac
-	      ;;
-	    esac
-	  done
-	  tmp_libs=
-	  for deplib in $new_libs; do
-	    case $deplib in
-	    -L*)
-	      case &quot; $tmp_libs &quot; in
-	      *&quot; $deplib &quot;*) ;;
-	      *) tmp_libs=&quot;$tmp_libs $deplib&quot; ;;
-	      esac
-	      ;;
-	    *) tmp_libs=&quot;$tmp_libs $deplib&quot; ;;
-	    esac
-	  done
-	  eval $var=\&quot;$tmp_libs\&quot;
-	done # for var
-      fi
-      if test &quot;$pass&quot; = &quot;conv&quot; &amp;&amp;
-       { test &quot;$linkmode&quot; = &quot;lib&quot; || test &quot;$linkmode&quot; = &quot;prog&quot;; }; then
-	libs=&quot;$deplibs&quot; # reset libs
-	deplibs=
-      fi
-    done # for pass
-    if test $linkmode = prog; then
-      dlfiles=&quot;$newdlfiles&quot;
-      dlprefiles=&quot;$newdlprefiles&quot;
-    fi
+This mode accepts the following additional options:
 
-    case $linkmode in
-    oldlib)
-      if test -n &quot;$dlfiles$dlprefiles&quot; || test &quot;$dlself&quot; != no; then
-	$echo &quot;$modename: warning: \`-dlopen' is ignored for archives&quot; 1&gt;&amp;2
-      fi
+  -o OUTPUT-FILE    set the output file name to OUTPUT-FILE
+  -no-suppress      do not suppress compiler output for multiple passes
+  -prefer-pic       try to build PIC objects only
+  -prefer-non-pic   try to build non-PIC objects only
+  -shared           do not build a \`.o' file suitable for static linking
+  -static           only build a \`.o' file suitable for static linking
+  -Wc,FLAG          pass FLAG directly to the compiler
 
-      if test -n &quot;$rpath&quot;; then
-	$echo &quot;$modename: warning: \`-rpath' is ignored for archives&quot; 1&gt;&amp;2
-      fi
+COMPILE-COMMAND is a command to be used in creating a \`standard' object file
+from the given SOURCEFILE.
 
-      if test -n &quot;$xrpath&quot;; then
-	$echo &quot;$modename: warning: \`-R' is ignored for archives&quot; 1&gt;&amp;2
-      fi
+The output file name is determined by removing the directory component from
+SOURCEFILE, then substituting the C source code suffix \`.c' with the
+library object suffix, \`.lo'.&quot;
+        ;;
 
-      if test -n &quot;$vinfo&quot;; then
-	$echo &quot;$modename: warning: \`-version-info' is ignored for archives&quot; 1&gt;&amp;2
-      fi
+      execute)
+        $ECHO \
+&quot;Usage: $progname [OPTION]... --mode=execute COMMAND [ARGS]...
 
-      if test -n &quot;$release&quot;; then
-	$echo &quot;$modename: warning: \`-release' is ignored for archives&quot; 1&gt;&amp;2
-      fi
+Automatically set library path, then run a program.
 
-      if test -n &quot;$export_symbols&quot; || test -n &quot;$export_symbols_regex&quot;; then
-	$echo &quot;$modename: warning: \`-export-symbols' is ignored for archives&quot; 1&gt;&amp;2
-      fi
+This mode accepts the following additional options:
 
-      # Now set the variables for building old libraries.
-      build_libtool_libs=no
-      oldlibs=&quot;$output&quot;
-      objs=&quot;$objs$old_deplibs&quot;
-      ;;
+  -dlopen FILE      add the directory containing FILE to the library path
 
-    lib)
-      # Make sure we only generate libraries of the form `libNAME.la'.
-      case $outputname in
-      lib*)
-	name=`$echo &quot;X$outputname&quot; | $Xsed -e 's/\.la$//' -e 's/^lib//'`
-	eval libname=\&quot;$libname_spec\&quot;
-	;;
-      *)
-	if test &quot;$module&quot; = no; then
-	  $echo &quot;$modename: libtool library \`$output' must begin with \`lib'&quot; 1&gt;&amp;2
-	  $echo &quot;$help&quot; 1&gt;&amp;2
-	  exit 1
-	fi
-	if test &quot;$need_lib_prefix&quot; != no; then
-	  # Add the &quot;lib&quot; prefix for modules if required
-	  name=`$echo &quot;X$outputname&quot; | $Xsed -e 's/\.la$//'`
-	  eval libname=\&quot;$libname_spec\&quot;
-	else
-	  libname=`$echo &quot;X$outputname&quot; | $Xsed -e 's/\.la$//'`
-	fi
-	;;
-      esac
+This mode sets the library path environment variable according to \`-dlopen'
+flags.
 
-      if test -n &quot;$objs&quot;; then
-	if test &quot;$deplibs_check_method&quot; != pass_all; then
-	  $echo &quot;$modename: cannot build libtool library \`$output' from non-libtool objects on this host:$objs&quot; 2&gt;&amp;1
-	  exit 1
-	else
-	  echo
-	  echo &quot;*** Warning: Linking the shared library $output against the non-libtool&quot;
-	  echo &quot;*** objects $objs is not portable!&quot;
-	  libobjs=&quot;$libobjs $objs&quot;
-	fi
-      fi
+If any of the ARGS are libtool executable wrappers, then they are translated
+into their corresponding uninstalled binary, and any of their required library
+directories are added to the library path.
 
-      if test &quot;$dlself&quot; != no; then
-	$echo &quot;$modename: warning: \`-dlopen self' is ignored for libtool libraries&quot; 1&gt;&amp;2
-      fi
+Then, COMMAND is executed, with ARGS as arguments.&quot;
+        ;;
 
-      set dummy $rpath
-      if test $# -gt 2; then
-	$echo &quot;$modename: warning: ignoring multiple \`-rpath's for a libtool library&quot; 1&gt;&amp;2
-      fi
-      install_libdir=&quot;$2&quot;
+      finish)
+        $ECHO \
+&quot;Usage: $progname [OPTION]... --mode=finish [LIBDIR]...
 
-      oldlibs=
-      if test -z &quot;$rpath&quot;; then
-	if test &quot;$build_libtool_libs&quot; = yes; then
-	  # Building a libtool convenience library.
-	  libext=al
-	  oldlibs=&quot;$output_objdir/$libname.$libext $oldlibs&quot;
-	  build_libtool_libs=convenience
-	  build_old_libs=yes
-	fi
+Complete the installation of libtool libraries.
 
-	if test -n &quot;$vinfo&quot;; then
-	  $echo &quot;$modename: warning: \`-version-info' is ignored for convenience libraries&quot; 1&gt;&amp;2
-	fi
+Each LIBDIR is a directory that contains libtool libraries.
 
-	if test -n &quot;$release&quot;; then
-	  $echo &quot;$modename: warning: \`-release' is ignored for convenience libraries&quot; 1&gt;&amp;2
-	fi
-      else
+The commands that this mode executes may require superuser privileges.  Use
+the \`--dry-run' option if you just want to see what would be executed.&quot;
+        ;;
 
-	# Parse the version information argument.
-	save_ifs=&quot;$IFS&quot;; IFS=':'
-	set dummy $vinfo 0 0 0
-	IFS=&quot;$save_ifs&quot;
+      install)
+        $ECHO \
+&quot;Usage: $progname [OPTION]... --mode=install INSTALL-COMMAND...
 
-	if test -n &quot;$8&quot;; then
-	  $echo &quot;$modename: too many parameters to \`-version-info'&quot; 1&gt;&amp;2
-	  $echo &quot;$help&quot; 1&gt;&amp;2
-	  exit 1
-	fi
+Install executables or libraries.
 
-	current=&quot;$2&quot;
-	revision=&quot;$3&quot;
-	age=&quot;$4&quot;
+INSTALL-COMMAND is the installation command.  The first component should be
+either the \`install' or \`cp' program.
 
-	# Check that each of the things are valid numbers.
-	case $current in
-	0 | [1-9] | [1-9][0-9] | [1-9][0-9][0-9]) ;;
-	*)
-	  $echo &quot;$modename: CURRENT \`$current' is not a nonnegative integer&quot; 1&gt;&amp;2
-	  $echo &quot;$modename: \`$vinfo' is not valid version information&quot; 1&gt;&amp;2
-	  exit 1
-	  ;;
-	esac
+The following components of INSTALL-COMMAND are treated specially:
 
-	case $revision in
-	0 | [1-9] | [1-9][0-9] | [1-9][0-9][0-9]) ;;
-	*)
-	  $echo &quot;$modename: REVISION \`$revision' is not a nonnegative integer&quot; 1&gt;&amp;2
-	  $echo &quot;$modename: \`$vinfo' is not valid version information&quot; 1&gt;&amp;2
-	  exit 1
-	  ;;
-	esac
+  -inst-prefix-dir PREFIX-DIR  Use PREFIX-DIR as a staging area for installation
 
-	case $age in
-	0 | [1-9] | [1-9][0-9] | [1-9][0-9][0-9]) ;;
-	*)
-	  $echo &quot;$modename: AGE \`$age' is not a nonnegative integer&quot; 1&gt;&amp;2
-	  $echo &quot;$modename: \`$vinfo' is not valid version information&quot; 1&gt;&amp;2
-	  exit 1
-	  ;;
-	esac
+The rest of the components are interpreted as arguments to that command (only
+BSD-compatible install options are recognized).&quot;
+        ;;
 
-	if test $age -gt $current; then
-	  $echo &quot;$modename: AGE \`$age' is greater than the current interface number \`$current'&quot; 1&gt;&amp;2
-	  $echo &quot;$modename: \`$vinfo' is not valid version information&quot; 1&gt;&amp;2
-	  exit 1
-	fi
+      link)
+        $ECHO \
+&quot;Usage: $progname [OPTION]... --mode=link LINK-COMMAND...
 
-	# Calculate the version variables.
-	major=
-	versuffix=
-	verstring=
-	case $version_type in
-	none) ;;
+Link object files or libraries together to form another library, or to
+create an executable program.
 
-	darwin)
-	  # Like Linux, but with the current version available in
-	  # verstring for coding it into the library header
-	  major=.`expr $current - $age`
-	  versuffix=&quot;$major.$age.$revision&quot;
-	  # Darwin ld doesn't like 0 for these options...
-	  minor_current=`expr $current + 1`
-	  verstring=&quot;-compatibility_version $minor_current -current_version $minor_current.$revision&quot;
-	  ;;
+LINK-COMMAND is a command using the C compiler that you would use to create
+a program from several object files.
 
-	freebsd-aout)
-	  major=&quot;.$current&quot;
-	  versuffix=&quot;.$current.$revision&quot;;
-	  ;;
+The following components of LINK-COMMAND are treated specially:
 
-	freebsd-elf)
-	  major=&quot;.$current&quot;
-	  versuffix=&quot;.$current&quot;;
-	  ;;
+  -all-static       do not do any dynamic linking at all
+  -avoid-version    do not add a version suffix if possible
+  -bindir BINDIR    specify path to binaries directory (for systems where
+                    libraries must be found in the PATH setting at runtime)
+  -dlopen FILE      \`-dlpreopen' FILE if it cannot be dlopened at runtime
+  -dlpreopen FILE   link in FILE and add its symbols to lt_preloaded_symbols
+  -export-dynamic   allow symbols from OUTPUT-FILE to be resolved with dlsym(3)
+  -export-symbols SYMFILE
+                    try to export only the symbols listed in SYMFILE
+  -export-symbols-regex REGEX
+                    try to export only the symbols matching REGEX
+  -LLIBDIR          search LIBDIR for required installed libraries
+  -lNAME            OUTPUT-FILE requires the installed library libNAME
+  -module           build a library that can dlopened
+  -no-fast-install  disable the fast-install mode
+  -no-install       link a not-installable executable
+  -no-undefined     declare that a library does not refer to external symbols
+  -o OUTPUT-FILE    create OUTPUT-FILE from the specified objects
+  -objectlist FILE  Use a list of object files found in FILE to specify objects
+  -precious-files-regex REGEX
+                    don't remove output files matching REGEX
+  -release RELEASE  specify package release information
+  -rpath LIBDIR     the created library will eventually be installed in LIBDIR
+  -R[ ]LIBDIR       add LIBDIR to the runtime path of programs and libraries
+  -shared           only do dynamic linking of libtool libraries
+  -shrext SUFFIX    override the standard shared library file extension
+  -static           do not do any dynamic linking of uninstalled libtool libraries
+  -static-libtool-libs
+                    do not do any dynamic linking of libtool libraries
+  -version-info CURRENT[:REVISION[:AGE]]
+                    specify library version info [each variable defaults to 0]
+  -weak LIBNAME     declare that the target provides the LIBNAME interface
+  -Wc,FLAG
+  -Xcompiler FLAG   pass linker-specific FLAG directly to the compiler
+  -Wl,FLAG
+  -Xlinker FLAG     pass linker-specific FLAG directly to the linker
+  -XCClinker FLAG   pass link-specific FLAG to the compiler driver (CC)
 
-	irix)
-	  major=`expr $current - $age + 1`
-	  verstring=&quot;sgi$major.$revision&quot;
+All other options (arguments beginning with \`-') are ignored.
 
-	  # Add in all the interfaces that we are compatible with.
-	  loop=$revision
-	  while test $loop != 0; do
-	    iface=`expr $revision - $loop`
-	    loop=`expr $loop - 1`
-	    verstring=&quot;sgi$major.$iface:$verstring&quot;
-	  done
+Every other argument is treated as a filename.  Files ending in \`.la' are
+treated as uninstalled libtool libraries, other files are standard or library
+object files.
 
-	  # Before this point, $major must not contain `.'.
-	  major=.$major
-	  versuffix=&quot;$major.$revision&quot;
-	  ;;
+If the OUTPUT-FILE ends in \`.la', then a libtool library is created,
+only library objects (\`.lo' files) may be specified, and \`-rpath' is
+required, except when creating a convenience library.
 
-	linux)
-	  major=.`expr $current - $age`
-	  versuffix=&quot;$major.$age.$revision&quot;
-	  ;;
+If OUTPUT-FILE ends in \`.a' or \`.lib', then a standard library is created
+using \`ar' and \`ranlib', or on Windows using \`lib'.
 
-	osf)
-	  major=`expr $current - $age`
-	  versuffix=&quot;.$current.$age.$revision&quot;
-	  verstring=&quot;$current.$age.$revision&quot;
+If OUTPUT-FILE ends in \`.lo' or \`.${objext}', then a reloadable object file
+is created, otherwise an executable program is created.&quot;
+        ;;
 
-	  # Add in all the interfaces that we are compatible with.
-	  loop=$age
-	  while test $loop != 0; do
-	    iface=`expr $current - $loop`
-	    loop=`expr $loop - 1`
-	    verstring=&quot;$verstring:${iface}.0&quot;
-	  done
+      uninstall)
+        $ECHO \
+&quot;Usage: $progname [OPTION]... --mode=uninstall RM [RM-OPTION]... FILE...
 
-	  # Make executables depend on our current version.
-	  verstring=&quot;$verstring:${current}.0&quot;
-	  ;;
+Remove libraries from an installation directory.
 
-	sunos)
-	  major=&quot;.$current&quot;
-	  versuffix=&quot;.$current.$revision&quot;
-	  ;;
+RM is the name of the program to use to delete files associated with each FILE
+(typically \`/bin/rm').  RM-OPTIONS are options (such as \`-f') to be passed
+to RM.
 
-	windows)
-	  # Use '-' rather than '.', since we only want one
-	  # extension on DOS 8.3 filesystems.
-	  major=`expr $current - $age`
-	  versuffix=&quot;-$major&quot;
-	  ;;
+If FILE is a libtool library, all the files associated with it are deleted.
+Otherwise, only FILE itself is deleted using RM.&quot;
+        ;;
 
-	*)
-	  $echo &quot;$modename: unknown library version type \`$version_type'&quot; 1&gt;&amp;2
-	  echo &quot;Fatal configuration error.  See the $PACKAGE docs for more information.&quot; 1&gt;&amp;2
-	  exit 1
-	  ;;
-	esac
+      *)
+        func_fatal_help &quot;invalid operation mode \`$opt_mode'&quot;
+        ;;
+    esac
 
-	# Clear the version info if we defaulted, and they specified a release.
-	if test -z &quot;$vinfo&quot; &amp;&amp; test -n &quot;$release&quot;; then
-	  major=
-	  verstring=&quot;0.0&quot;
-	  case $version_type in
-	  darwin)
-	    # we can't check for &quot;0.0&quot; in archive_cmds due to quoting
-	    # problems, so we reset it completely
-	    verstring=&quot;&quot;
-	    ;;
-	  *)
-	    verstring=&quot;0.0&quot;
-	    ;;
-	  esac
-	  if test &quot;$need_version&quot; = no; then
-	    versuffix=
-	  else
-	    versuffix=&quot;.0.0&quot;
-	  fi
-	fi
+    echo
+    $ECHO &quot;Try \`$progname --help' for more information about other modes.&quot;
+}
 
-	# Remove version info from name if versioning should be avoided
-	if test &quot;$avoid_version&quot; = yes &amp;&amp; test &quot;$need_version&quot; = no; then
-	  major=
-	  versuffix=
-	  verstring=&quot;&quot;
+# Now that we've collected a possible --mode arg, show help if necessary
+if $opt_help; then
+  if test &quot;$opt_help&quot; = :; then
+    func_mode_help
+  else
+    {
+      func_help noexit
+      for opt_mode in compile link execute install finish uninstall clean; do
+	func_mode_help
+      done
+    } | sed -n '1p; 2,$s/^Usage:/  or: /p'
+    {
+      func_help noexit
+      for opt_mode in compile link execute install finish uninstall clean; do
+	echo
+	func_mode_help
+      done
+    } |
+    sed '1d
+      /^When reporting/,/^Report/{
+	H
+	d
+      }
+      $x
+      /information about other modes/d
+      /more detailed .*MODE/d
+      s/^Usage:.*--mode=\([^ ]*\) .*/Description of \1 mode:/'
+  fi
+  exit $?
+fi
+
+
+# func_mode_execute arg...
+func_mode_execute ()
+{
+    $opt_debug
+    # The first argument is the command name.
+    cmd=&quot;$nonopt&quot;
+    test -z &quot;$cmd&quot; &amp;&amp; \
+      func_fatal_help &quot;you must specify a COMMAND&quot;
+
+    # Handle -dlopen flags immediately.
+    for file in $opt_dlopen; do
+      test -f &quot;$file&quot; \
+	|| func_fatal_help &quot;\`$file' is not a file&quot;
+
+      dir=
+      case $file in
+      *.la)
+	func_resolve_sysroot &quot;$file&quot;
+	file=$func_resolve_sysroot_result
+
+	# Check to see that this really is a libtool archive.
+	func_lalib_unsafe_p &quot;$file&quot; \
+	  || func_fatal_help &quot;\`$lib' is not a valid libtool archive&quot;
+
+	# Read the libtool library.
+	dlname=
+	library_names=
+	func_source &quot;$file&quot;
+
+	# Skip this library if it cannot be dlopened.
+	if test -z &quot;$dlname&quot;; then
+	  # Warn if it was a shared library.
+	  test -n &quot;$library_names&quot; &amp;&amp; \
+	    func_warning &quot;\`$file' was not linked with \`-export-dynamic'&quot;
+	  continue
 	fi
 
-	# Check to see if the archive will have undefined symbols.
-	if test &quot;$allow_undefined&quot; = yes; then
-	  if test &quot;$allow_undefined_flag&quot; = unsupported; then
-	    $echo &quot;$modename: warning: undefined symbols not allowed in $host shared libraries&quot; 1&gt;&amp;2
-	    build_libtool_libs=no
-	    build_old_libs=yes
-	  fi
+	func_dirname &quot;$file&quot; &quot;&quot; &quot;.&quot;
+	dir=&quot;$func_dirname_result&quot;
+
+	if test -f &quot;$dir/$objdir/$dlname&quot;; then
+	  func_append dir &quot;/$objdir&quot;
 	else
-	  # Don't allow undefined symbols.
-	  allow_undefined_flag=&quot;$no_undefined_flag&quot;
+	  if test ! -f &quot;$dir/$dlname&quot;; then
+	    func_fatal_error &quot;cannot find \`$dlname' in \`$dir' or \`$dir/$objdir'&quot;
+	  fi
 	fi
-      fi
+	;;
+
+      *.lo)
+	# Just add the directory containing the .lo file.
+	func_dirname &quot;$file&quot; &quot;&quot; &quot;.&quot;
+	dir=&quot;$func_dirname_result&quot;
+	;;
+
+      *)
+	func_warning &quot;\`-dlopen' is ignored for non-libtool libraries and objects&quot;
+	continue
+	;;
+      esac
+
+      # Get the absolute pathname.
+      absdir=`cd &quot;$dir&quot; &amp;&amp; pwd`
+      test -n &quot;$absdir&quot; &amp;&amp; dir=&quot;$absdir&quot;
 
-      if test &quot;$mode&quot; != relink; then
-	# Remove our outputs.
-	$show &quot;${rm}r $output_objdir/$outputname $output_objdir/$libname.* $output_objdir/${libname}${release}.*&quot;
-	$run ${rm}r $output_objdir/$outputname $output_objdir/$libname.* $output_objdir/${libname}${release}.*
+      # Now add the directory to shlibpath_var.
+      if eval &quot;test -z \&quot;\$$shlibpath_var\&quot;&quot;; then
+	eval &quot;$shlibpath_var=\&quot;\$dir\&quot;&quot;
+      else
+	eval &quot;$shlibpath_var=\&quot;\$dir:\$$shlibpath_var\&quot;&quot;
       fi
+    done
 
-      # Now set the variables for building old libraries.
-      if test &quot;$build_old_libs&quot; = yes &amp;&amp; test &quot;$build_libtool_libs&quot; != convenience ; then
-	oldlibs=&quot;$oldlibs $output_objdir/$libname.$libext&quot;
+    # This variable tells wrapper scripts just to set shlibpath_var
+    # rather than running their programs.
+    libtool_execute_magic=&quot;$magic&quot;
 
-	# Transform .lo files to .o files.
-	oldobjs=&quot;$objs &quot;`$echo &quot;X$libobjs&quot; | $SP2NL | $Xsed -e '/\.'${libext}'$/d' -e &quot;$lo2o&quot; | $NL2SP`
+    # Check if any of the arguments is a wrapper script.
+    args=
+    for file
+    do
+      case $file in
+      -* | *.la | *.lo ) ;;
+      *)
+	# Do a test to see if this is really a libtool program.
+	if func_ltwrapper_script_p &quot;$file&quot;; then
+	  func_source &quot;$file&quot;
+	  # Transform arg to wrapped name.
+	  file=&quot;$progdir/$program&quot;
+	elif func_ltwrapper_executable_p &quot;$file&quot;; then
+	  func_ltwrapper_scriptname &quot;$file&quot;
+	  func_source &quot;$func_ltwrapper_scriptname_result&quot;
+	  # Transform arg to wrapped name.
+	  file=&quot;$progdir/$program&quot;
+	fi
+	;;
+      esac
+      # Quote arguments (to preserve shell metacharacters).
+      func_append_quoted args &quot;$file&quot;
+    done
+
+    if test &quot;X$opt_dry_run&quot; = Xfalse; then
+      if test -n &quot;$shlibpath_var&quot;; then
+	# Export the shlibpath_var.
+	eval &quot;export $shlibpath_var&quot;
       fi
 
-      # Eliminate all temporary directories.
-      for path in $notinst_path; do
-	lib_search_path=`echo &quot;$lib_search_path &quot; | sed -e 's% $path % %g'`
-	deplibs=`echo &quot;$deplibs &quot; | sed -e 's% -L$path % %g'`
-	dependency_libs=`echo &quot;$dependency_libs &quot; | sed -e 's% -L$path % %g'`
+      # Restore saved environment variables
+      for lt_var in LANG LANGUAGE LC_ALL LC_CTYPE LC_COLLATE LC_MESSAGES
+      do
+	eval &quot;if test \&quot;\${save_$lt_var+set}\&quot; = set; then
+                $lt_var=\$save_$lt_var; export $lt_var
+	      else
+		$lt_unset $lt_var
+	      fi&quot;
       done
 
-      if test -n &quot;$xrpath&quot;; then
-	# If the user specified any rpath flags, then add them.
-	temp_xrpath=
-	for libdir in $xrpath; do
-	  temp_xrpath=&quot;$temp_xrpath -R$libdir&quot;
-	  case &quot;$finalize_rpath &quot; in
-	  *&quot; $libdir &quot;*) ;;
-	  *) finalize_rpath=&quot;$finalize_rpath $libdir&quot; ;;
-	  esac
-	done
-	if test $hardcode_into_libs != yes || test $build_old_libs = yes; then
-	  dependency_libs=&quot;$temp_xrpath $dependency_libs&quot;
+      # Now prepare to actually exec the command.
+      exec_cmd=&quot;\$cmd$args&quot;
+    else
+      # Display what would be done.
+      if test -n &quot;$shlibpath_var&quot;; then
+	eval &quot;\$ECHO \&quot;\$shlibpath_var=\$$shlibpath_var\&quot;&quot;
+	echo &quot;export $shlibpath_var&quot;
+      fi
+      $ECHO &quot;$cmd$args&quot;
+      exit $EXIT_SUCCESS
+    fi
+}
+
+test &quot;$opt_mode&quot; = execute &amp;&amp; func_mode_execute ${1+&quot;$@&quot;}
+
+
+# func_mode_finish arg...
+func_mode_finish ()
+{
+    $opt_debug
+    libs=
+    libdirs=
+    admincmds=
+
+    for opt in &quot;$nonopt&quot; ${1+&quot;$@&quot;}
+    do
+      if test -d &quot;$opt&quot;; then
+	func_append libdirs &quot; $opt&quot;
+
+      elif test -f &quot;$opt&quot;; then
+	if func_lalib_unsafe_p &quot;$opt&quot;; then
+	  func_append libs &quot; $opt&quot;
+	else
+	  func_warning &quot;\`$opt' is not a valid libtool archive&quot;
 	fi
+
+      else
+	func_fatal_error &quot;invalid argument \`$opt'&quot;
       fi
+    done
 
-      # Make sure dlfiles contains only unique files that won't be dlpreopened
-      old_dlfiles=&quot;$dlfiles&quot;
-      dlfiles=
-      for lib in $old_dlfiles; do
-	case &quot; $dlprefiles $dlfiles &quot; in
-	*&quot; $lib &quot;*) ;;
-	*) dlfiles=&quot;$dlfiles $lib&quot; ;;
-	esac
+    if test -n &quot;$libs&quot;; then
+      if test -n &quot;$lt_sysroot&quot;; then
+        sysroot_regex=`$ECHO &quot;$lt_sysroot&quot; | $SED &quot;$sed_make_literal_regex&quot;`
+        sysroot_cmd=&quot;s/\([ ']\)$sysroot_regex/\1/g;&quot;
+      else
+        sysroot_cmd=
+      fi
+
+      # Remove sysroot references
+      if $opt_dry_run; then
+        for lib in $libs; do
+          echo &quot;removing references to $lt_sysroot and \`=' prefixes from $lib&quot;
+        done
+      else
+        tmpdir=`func_mktempdir`
+        for lib in $libs; do
+	  sed -e &quot;${sysroot_cmd} s/\([ ']-[LR]\)=/\1/g; s/\([ ']\)=/\1/g&quot; $lib \
+	    &gt; $tmpdir/tmp-la
+	  mv -f $tmpdir/tmp-la $lib
+	done
+        ${RM}r &quot;$tmpdir&quot;
+      fi
+    fi
+
+    if test -n &quot;$finish_cmds$finish_eval&quot; &amp;&amp; test -n &quot;$libdirs&quot;; then
+      for libdir in $libdirs; do
+	if test -n &quot;$finish_cmds&quot;; then
+	  # Do each command in the finish commands.
+	  func_execute_cmds &quot;$finish_cmds&quot; 'admincmds=&quot;$admincmds
+'&quot;$cmd&quot;'&quot;'
+	fi
+	if test -n &quot;$finish_eval&quot;; then
+	  # Do the single finish_eval.
+	  eval cmds=\&quot;$finish_eval\&quot;
+	  $opt_dry_run || eval &quot;$cmds&quot; || func_append admincmds &quot;
+       $cmds&quot;
+	fi
       done
+    fi
 
-      # Make sure dlprefiles contains only unique files
-      old_dlprefiles=&quot;$dlprefiles&quot;
-      dlprefiles=
-      for lib in $old_dlprefiles; do
-	case &quot;$dlprefiles &quot; in
-	*&quot; $lib &quot;*) ;;
-	*) dlprefiles=&quot;$dlprefiles $lib&quot; ;;
-	esac
+    # Exit here if they wanted silent mode.
+    $opt_silent &amp;&amp; exit $EXIT_SUCCESS
+
+    if test -n &quot;$finish_cmds$finish_eval&quot; &amp;&amp; test -n &quot;$libdirs&quot;; then
+      echo &quot;----------------------------------------------------------------------&quot;
+      echo &quot;Libraries have been installed in:&quot;
+      for libdir in $libdirs; do
+	$ECHO &quot;   $libdir&quot;
       done
+      echo
+      echo &quot;If you ever happen to want to link against installed libraries&quot;
+      echo &quot;in a given directory, LIBDIR, you must either use libtool, and&quot;
+      echo &quot;specify the full pathname of the library, or use the \`-LLIBDIR'&quot;
+      echo &quot;flag during linking and do at least one of the following:&quot;
+      if test -n &quot;$shlibpath_var&quot;; then
+	echo &quot;   - add LIBDIR to the \`$shlibpath_var' environment variable&quot;
+	echo &quot;     during execution&quot;
+      fi
+      if test -n &quot;$runpath_var&quot;; then
+	echo &quot;   - add LIBDIR to the \`$runpath_var' environment variable&quot;
+	echo &quot;     during linking&quot;
+      fi
+      if test -n &quot;$hardcode_libdir_flag_spec&quot;; then
+	libdir=LIBDIR
+	eval flag=\&quot;$hardcode_libdir_flag_spec\&quot;
 
-      if test &quot;$build_libtool_libs&quot; = yes; then
-	if test -n &quot;$rpath&quot;; then
-	  case $host in
-	  *-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-os2* | *-*-beos*)
-	    # these systems don't actually have a c library (as such)!
-	    ;;
-	  *-*-rhapsody* | *-*-darwin1.[012])
-	    # Rhapsody C library is in the System framework
-	    deplibs=&quot;$deplibs -framework System&quot;
-	    ;;
-	  *-*-netbsd*)
-	    # Don't link with libc until the a.out ld.so is fixed.
-	    ;;
-	  *-*-openbsd*)
-	    # Do not include libc due to us having libc/libc_r.
-	    ;;
-	  *)
-	    # Add libc to deplibs on all other systems if necessary.
-	    if test $build_libtool_need_lc = &quot;yes&quot;; then
-	      deplibs=&quot;$deplibs -lc&quot;
-	    fi
-	    ;;
-	  esac
-	fi
+	$ECHO &quot;   - use the \`$flag' linker flag&quot;
+      fi
+      if test -n &quot;$admincmds&quot;; then
+	$ECHO &quot;   - have your system administrator run these commands:$admincmds&quot;
+      fi
+      if test -f /etc/ld.so.conf; then
+	echo &quot;   - have your system administrator add LIBDIR to \`/etc/ld.so.conf'&quot;
+      fi
+      echo
 
-	# Transform deplibs into only deplibs that can be linked in shared.
-	name_save=$name
-	libname_save=$libname
-	release_save=$release
-	versuffix_save=$versuffix
-	major_save=$major
-	# I'm not sure if I'm treating the release correctly.  I think
-	# release should show up in the -l (ie -lgmp5) so we don't want to
-	# add it in twice.  Is that correct?
-	release=&quot;&quot;
-	versuffix=&quot;&quot;
-	major=&quot;&quot;
-	newdeplibs=
-	droppeddeps=no
-	case $deplibs_check_method in
-	pass_all)
-	  # Don't check for shared/static.  Everything works.
-	  # This might be a little naive.  We might want to check
-	  # whether the library exists or not.  But this is on
-	  # osf3 &amp; osf4 and I'm not really sure... Just
-	  # implementing what was already the behaviour.
-	  newdeplibs=$deplibs
+      echo &quot;See any operating system documentation about shared libraries for&quot;
+      case $host in
+	solaris2.[6789]|solaris2.1[0-9])
+	  echo &quot;more information, such as the ld(1), crle(1) and ld.so(8) manual&quot;
+	  echo &quot;pages.&quot;
 	  ;;
-	test_compile)
-	  # This code stresses the &quot;libraries are programs&quot; paradigm to its
-	  # limits. Maybe even breaks it.  We compile a program, linking it
-	  # against the deplibs as a proxy for the library.  Then we can check
-	  # whether they linked in statically or dynamically with ldd.
-	  $rm conftest.c
-	  cat &gt; conftest.c &lt;&lt;EOF
-	  int main() { return 0; }
-EOF
-	  $rm conftest
-	  $CC -o conftest conftest.c $deplibs
-	  if test $? -eq 0 ; then
-	    ldd_output=`ldd conftest`
-	    for i in $deplibs; do
-	      name=&quot;`expr $i : '-l\(.*\)'`&quot;
-	      # If $name is empty we are operating on a -L argument.
-	      if test -n &quot;$name&quot; &amp;&amp; test &quot;$name&quot; != &quot;0&quot;; then
-		libname=`eval \\$echo \&quot;$libname_spec\&quot;`
-		deplib_matches=`eval \\$echo \&quot;$library_names_spec\&quot;`
-		set dummy $deplib_matches
-		deplib_match=$2
-		if test `expr &quot;$ldd_output&quot; : &quot;.*$deplib_match&quot;` -ne 0 ; then
-		  newdeplibs=&quot;$newdeplibs $i&quot;
-		else
-		  droppeddeps=yes
-		  echo
-		  echo &quot;*** Warning: This library needs some functionality provided by $i.&quot;
-		  echo &quot;*** I have the capability to make that library automatically link in when&quot;
-		  echo &quot;*** you link to this library.  But I can only do this if you have a&quot;
-		  echo &quot;*** shared version of the library, which you do not appear to have.&quot;
-		fi
-	      else
-		newdeplibs=&quot;$newdeplibs $i&quot;
-	      fi
-	    done
-	  else
-	    # Error occured in the first compile.  Let's try to salvage the situation:
-	    # Compile a seperate program for each library.
-	    for i in $deplibs; do
-	      name=&quot;`expr $i : '-l\(.*\)'`&quot;
-	     # If $name is empty we are operating on a -L argument.
-	      if test -n &quot;$name&quot; &amp;&amp; test &quot;$name&quot; != &quot;0&quot;; then
-		$rm conftest
-		$CC -o conftest conftest.c $i
-		# Did it work?
-		if test $? -eq 0 ; then
-		  ldd_output=`ldd conftest`
-		  libname=`eval \\$echo \&quot;$libname_spec\&quot;`
-		  deplib_matches=`eval \\$echo \&quot;$library_names_spec\&quot;`
-		  set dummy $deplib_matches
-		  deplib_match=$2
-		  if test `expr &quot;$ldd_output&quot; : &quot;.*$deplib_match&quot;` -ne 0 ; then
-		    newdeplibs=&quot;$newdeplibs $i&quot;
-		  else
-		    droppeddeps=yes
-		    echo
-		    echo &quot;*** Warning: This library needs some functionality provided by $i.&quot;
-		    echo &quot;*** I have the capability to make that library automatically link in when&quot;
-		    echo &quot;*** you link to this library.  But I can only do this if you have a&quot;
-		    echo &quot;*** shared version of the library, which you do not appear to have.&quot;
-		  fi
-		else
-		  droppeddeps=yes
-		  echo
-		  echo &quot;*** Warning!  Library $i is needed by this library but I was not able to&quot;
-		  echo &quot;***  make it link in!  You will probably need to install it or some&quot;
-		  echo &quot;*** library that it depends on before this library will be fully&quot;
-		  echo &quot;*** functional.  Installing it before continuing would be even better.&quot;
-		fi
-	      else
-		newdeplibs=&quot;$newdeplibs $i&quot;
-	      fi
-	    done
-	  fi
-	  ;;
-	file_magic*)
-	  set dummy $deplibs_check_method
-	  file_magic_regex=`expr &quot;$deplibs_check_method&quot; : &quot;$2 \(.*\)&quot;`
-	  for a_deplib in $deplibs; do
-	    name=&quot;`expr $a_deplib : '-l\(.*\)'`&quot;
-	    # If $name is empty we are operating on a -L argument.
-	    if test -n &quot;$name&quot; &amp;&amp; test &quot;$name&quot; != &quot;0&quot;; then
-	      libname=`eval \\$echo \&quot;$libname_spec\&quot;`
-	      for i in $lib_search_path $sys_lib_search_path $shlib_search_path; do
-		    potential_libs=`ls $i/$libname[.-]* 2&gt;/dev/null`
-		    for potent_lib in $potential_libs; do
-		      # Follow soft links.
-		      if ls -lLd &quot;$potent_lib&quot; 2&gt;/dev/null \
-			 | grep &quot; -&gt; &quot; &gt;/dev/null; then
-			continue
-		      fi
-		      # The statement above tries to avoid entering an
-		      # endless loop below, in case of cyclic links.
-		      # We might still enter an endless loop, since a link
-		      # loop can be closed while we follow links,
-		      # but so what?
-		      potlib=&quot;$potent_lib&quot;
-		      while test -h &quot;$potlib&quot; 2&gt;/dev/null; do
-			potliblink=`ls -ld $potlib | sed 's/.* -&gt; //'`
-			case $potliblink in
-			[\\/]* | [A-Za-z]:[\\/]*) potlib=&quot;$potliblink&quot;;;
-			*) potlib=`$echo &quot;X$potlib&quot; | $Xsed -e 's,[^/]*$,,'`&quot;$potliblink&quot;;;
-			esac
-		      done
-		      if eval $file_magic_cmd \&quot;\$potlib\&quot; 2&gt;/dev/null \
-			 | sed 10q \
-			 | egrep &quot;$file_magic_regex&quot; &gt; /dev/null; then
-			newdeplibs=&quot;$newdeplibs $a_deplib&quot;
-			a_deplib=&quot;&quot;
-			break 2
-		      fi
-		    done
-	      done
-	      if test -n &quot;$a_deplib&quot; ; then
-		droppeddeps=yes
-		echo
-		echo &quot;*** Warning: This library needs some functionality provided by $a_deplib.&quot;
-		echo &quot;*** I have the capability to make that library automatically link in when&quot;
-		echo &quot;*** you link to this library.  But I can only do this if you have a&quot;
-		echo &quot;*** shared version of the library, which you do not appear to have.&quot;
-	      fi
-	    else
-	      # Add a -L argument.
-	      newdeplibs=&quot;$newdeplibs $a_deplib&quot;
-	    fi
-	  done # Gone through all deplibs.
-	  ;;
-	match_pattern*)
-	  set dummy $deplibs_check_method
-	  match_pattern_regex=`expr &quot;$deplibs_check_method&quot; : &quot;$2 \(.*\)&quot;`
-	  for a_deplib in $deplibs; do
-	    name=&quot;`expr $a_deplib : '-l\(.*\)'`&quot;
-	    # If $name is empty we are operating on a -L argument.
-	    if test -n &quot;$name&quot; &amp;&amp; test &quot;$name&quot; != &quot;0&quot;; then
-	      libname=`eval \\$echo \&quot;$libname_spec\&quot;`
-	      for i in $lib_search_path $sys_lib_search_path $shlib_search_path; do
-		potential_libs=`ls $i/$libname[.-]* 2&gt;/dev/null`
-		for potent_lib in $potential_libs; do
-		  if eval echo \&quot;$potent_lib\&quot; 2&gt;/dev/null \
-		      | sed 10q \
-		      | egrep &quot;$match_pattern_regex&quot; &gt; /dev/null; then
-		    newdeplibs=&quot;$newdeplibs $a_deplib&quot;
-		    a_deplib=&quot;&quot;
-		    break 2
-		  fi
-		done
-	      done
-	      if test -n &quot;$a_deplib&quot; ; then
-		droppeddeps=yes
-		echo
-		echo &quot;*** Warning: This library needs some functionality provided by $a_deplib.&quot;
-		echo &quot;*** I have the capability to make that library automatically link in when&quot;
-		echo &quot;*** you link to this library.  But I can only do this if you have a&quot;
-		echo &quot;*** shared version of the library, which you do not appear to have.&quot;
-	      fi
-	    else
-	      # Add a -L argument.
-	      newdeplibs=&quot;$newdeplibs $a_deplib&quot;
-	    fi
-	  done # Gone through all deplibs.
-	  ;;
-	none | unknown | *)
-	  newdeplibs=&quot;&quot;
-	  if $echo &quot;X $deplibs&quot; | $Xsed -e 's/ -lc$//' \
-	       -e 's/ -[LR][^ ]*//g' -e 's/[ 	]//g' |
-	     grep . &gt;/dev/null; then
-	    echo
-	    if test &quot;X$deplibs_check_method&quot; = &quot;Xnone&quot;; then
-	      echo &quot;*** Warning: inter-library dependencies are not supported in this platform.&quot;
-	    else
-	      echo &quot;*** Warning: inter-library dependencies are not known to be supported.&quot;
-	    fi
-	    echo &quot;*** All declared inter-library dependencies are being dropped.&quot;
-	    droppeddeps=yes
-	  fi
+	*)
+	  echo &quot;more information, such as the ld(1) and ld.so(8) manual pages.&quot;
 	  ;;
-	esac
-	versuffix=$versuffix_save
-	major=$major_save
-	release=$release_save
-	libname=$libname_save
-	name=$name_save
+      esac
+      echo &quot;----------------------------------------------------------------------&quot;
+    fi
+    exit $EXIT_SUCCESS
+}
 
-	case $host in
-	*-*-rhapsody* | *-*-darwin1.[012])
-	  # On Rhapsody replace the C library is the System framework
-	  newdeplibs=`$echo &quot;X $newdeplibs&quot; | $Xsed -e 's/ -lc / -framework System /'`
-	  ;;
-	esac
+test &quot;$opt_mode&quot; = finish &amp;&amp; func_mode_finish ${1+&quot;$@&quot;}
 
-	if test &quot;$droppeddeps&quot; = yes; then
-	  if test &quot;$module&quot; = yes; then
-	    echo
-	    echo &quot;*** Warning: libtool could not satisfy all declared inter-library&quot;
-	    echo &quot;*** dependencies of module $libname.  Therefore, libtool will create&quot;
-	    echo &quot;*** a static module, that should work as long as the dlopening&quot;
-	    echo &quot;*** application is linked with the -dlopen flag.&quot;
-	    if test -z &quot;$global_symbol_pipe&quot;; then
-	      echo
-	      echo &quot;*** However, this would only work if libtool was able to extract symbol&quot;
-	      echo &quot;*** lists from a program, using \`nm' or equivalent, but libtool could&quot;
-	      echo &quot;*** not find such a program.  So, this module is probably useless.&quot;
-	      echo &quot;*** \`nm' from GNU binutils and a full rebuild may help.&quot;
-	    fi
-	    if test &quot;$build_old_libs&quot; = no; then
-	      oldlibs=&quot;$output_objdir/$libname.$libext&quot;
-	      build_libtool_libs=module
-	      build_old_libs=yes
-	    else
-	      build_libtool_libs=no
-	    fi
-	  else
-	    echo &quot;*** The inter-library dependencies that have been dropped here will be&quot;
-	    echo &quot;*** automatically added whenever a program is linked with this library&quot;
-	    echo &quot;*** or is declared to -dlopen it.&quot;
 
-	    if test $allow_undefined = no; then
-	      echo
-	      echo &quot;*** Since this library must not contain undefined symbols,&quot;
-	      echo &quot;*** because either the platform does not support them or&quot;
-	      echo &quot;*** it was explicitly requested with -no-undefined,&quot;
-	      echo &quot;*** libtool will only create a static version of it.&quot;
-	      if test &quot;$build_old_libs&quot; = no; then
-		oldlibs=&quot;$output_objdir/$libname.$libext&quot;
-		build_libtool_libs=module
-		build_old_libs=yes
-	      else
-		build_libtool_libs=no
-	      fi
-	    fi
-	  fi
-	fi
-	# Done checking deplibs!
-	deplibs=$newdeplibs
-      fi
+# func_mode_install arg...
+func_mode_install ()
+{
+    $opt_debug
+    # There may be an optional sh(1) argument at the beginning of
+    # install_prog (especially on Windows NT).
+    if test &quot;$nonopt&quot; = &quot;$SHELL&quot; || test &quot;$nonopt&quot; = /bin/sh ||
+       # Allow the use of GNU shtool's install command.
+       case $nonopt in *shtool*) :;; *) false;; esac; then
+      # Aesthetically quote it.
+      func_quote_for_eval &quot;$nonopt&quot;
+      install_prog=&quot;$func_quote_for_eval_result &quot;
+      arg=$1
+      shift
+    else
+      install_prog=
+      arg=$nonopt
+    fi
 
-      # All the library-specific variables (install_libdir is set above).
-      library_names=
-      old_library=
-      dlname=
+    # The real first argument should be the name of the installation program.
+    # Aesthetically quote it.
+    func_quote_for_eval &quot;$arg&quot;
+    func_append install_prog &quot;$func_quote_for_eval_result&quot;
+    install_shared_prog=$install_prog
+    case &quot; $install_prog &quot; in
+      *[\\\ /]cp\ *) install_cp=: ;;
+      *) install_cp=false ;;
+    esac
 
-      # Test again, we may have decided not to build it any more
-      if test &quot;$build_libtool_libs&quot; = yes; then
-	if test $hardcode_into_libs = yes; then
-	  # Hardcode the library paths
-	  hardcode_libdirs=
-	  dep_rpath=
-	  rpath=&quot;$finalize_rpath&quot;
-	  test &quot;$mode&quot; != relink &amp;&amp; rpath=&quot;$compile_rpath$rpath&quot;
-	  for libdir in $rpath; do
-	    if test -n &quot;$hardcode_libdir_flag_spec&quot;; then
-	      if test -n &quot;$hardcode_libdir_separator&quot;; then
-		if test -z &quot;$hardcode_libdirs&quot;; then
-		  hardcode_libdirs=&quot;$libdir&quot;
-		else
-		  # Just accumulate the unique libdirs.
-		  case $hardcode_libdir_separator$hardcode_libdirs$hardcode_libdir_separator in
-		  *&quot;$hardcode_libdir_separator$libdir$hardcode_libdir_separator&quot;*)
-		    ;;
-		  *)
-		    hardcode_libdirs=&quot;$hardcode_libdirs$hardcode_libdir_separator$libdir&quot;
-		    ;;
-		  esac
-		fi
-	      else
-		eval flag=\&quot;$hardcode_libdir_flag_spec\&quot;
-		dep_rpath=&quot;$dep_rpath $flag&quot;
-	      fi
-	    elif test -n &quot;$runpath_var&quot;; then
-	      case &quot;$perm_rpath &quot; in
-	      *&quot; $libdir &quot;*) ;;
-	      *) perm_rpath=&quot;$perm_rpath $libdir&quot; ;;
-	      esac
-	    fi
-	  done
-	  # Substitute the hardcoded libdirs into the rpath.
-	  if test -n &quot;$hardcode_libdir_separator&quot; &amp;&amp;
-	     test -n &quot;$hardcode_libdirs&quot;; then
-	    libdir=&quot;$hardcode_libdirs&quot;
-	    eval dep_rpath=\&quot;$hardcode_libdir_flag_spec\&quot;
-	  fi
-	  if test -n &quot;$runpath_var&quot; &amp;&amp; test -n &quot;$perm_rpath&quot;; then
-	    # We should set the runpath_var.
-	    rpath=
-	    for dir in $perm_rpath; do
-	      rpath=&quot;$rpath$dir:&quot;
-	    done
-	    eval &quot;$runpath_var='$rpath\$$runpath_var'; export $runpath_var&quot;
-	  fi
-	  test -n &quot;$dep_rpath&quot; &amp;&amp; deplibs=&quot;$dep_rpath $deplibs&quot;
-	fi
+    # We need to accept at least all the BSD install flags.
+    dest=
+    files=
+    opts=
+    prev=
+    install_type=
+    isdir=no
+    stripme=
+    no_mode=:
+    for arg
+    do
+      arg2=
+      if test -n &quot;$dest&quot;; then
+	func_append files &quot; $dest&quot;
+	dest=$arg
+	continue
+      fi
 
-	shlibpath=&quot;$finalize_shlibpath&quot;
-	test &quot;$mode&quot; != relink &amp;&amp; shlibpath=&quot;$compile_shlibpath$shlibpath&quot;
-	if test -n &quot;$shlibpath&quot;; then
-	  eval &quot;$shlibpath_var='$shlibpath\$$shlibpath_var'; export $shlibpath_var&quot;
+      case $arg in
+      -d) isdir=yes ;;
+      -f)
+	if $install_cp; then :; else
+	  prev=$arg
 	fi
-
-	# Get the real and link names of the library.
-	eval library_names=\&quot;$library_names_spec\&quot;
-	set dummy $library_names
-	realname=&quot;$2&quot;
-	shift; shift
-
-	if test -n &quot;$soname_spec&quot;; then
-	  eval soname=\&quot;$soname_spec\&quot;
+	;;
+      -g | -m | -o)
+	prev=$arg
+	;;
+      -s)
+	stripme=&quot; -s&quot;
+	continue
+	;;
+      -*)
+	;;
+      *)
+	# If the previous option needed an argument, then skip it.
+	if test -n &quot;$prev&quot;; then
+	  if test &quot;x$prev&quot; = x-m &amp;&amp; test -n &quot;$install_override_mode&quot;; then
+	    arg2=$install_override_mode
+	    no_mode=false
+	  fi
+	  prev=
 	else
-	  soname=&quot;$realname&quot;
+	  dest=$arg
+	  continue
 	fi
-	test -z &quot;$dlname&quot; &amp;&amp; dlname=$soname
+	;;
+      esac
 
-	lib=&quot;$output_objdir/$realname&quot;
-	for link
-	do
-	  linknames=&quot;$linknames $link&quot;
-	done
+      # Aesthetically quote the argument.
+      func_quote_for_eval &quot;$arg&quot;
+      func_append install_prog &quot; $func_quote_for_eval_result&quot;
+      if test -n &quot;$arg2&quot;; then
+	func_quote_for_eval &quot;$arg2&quot;
+      fi
+      func_append install_shared_prog &quot; $func_quote_for_eval_result&quot;
+    done
 
-	# Ensure that we have .o objects for linkers which dislike .lo
-	# (e.g. aix) in case we are running --disable-static
-	for obj in $libobjs; do
-	  xdir=`$echo &quot;X$obj&quot; | $Xsed -e 's%/[^/]*$%%'`
-	  if test &quot;X$xdir&quot; = &quot;X$obj&quot;; then
-	    xdir=&quot;.&quot;
-	  else
-	    xdir=&quot;$xdir&quot;
-	  fi
-	  baseobj=`$echo &quot;X$obj&quot; | $Xsed -e 's%^.*/%%'`
-	  oldobj=`$echo &quot;X$baseobj&quot; | $Xsed -e &quot;$lo2o&quot;`
-	  if test ! -f $xdir/$oldobj; then
-	    $show &quot;(cd $xdir &amp;&amp; ${LN_S} $baseobj $oldobj)&quot;
-	    $run eval '(cd $xdir &amp;&amp; ${LN_S} $baseobj $oldobj)' || exit $?
-	  fi
-	done
+    test -z &quot;$install_prog&quot; &amp;&amp; \
+      func_fatal_help &quot;you must specify an install program&quot;
 
-	# Use standard objects if they are pic
-	test -z &quot;$pic_flag&quot; &amp;&amp; libobjs=`$echo &quot;X$libobjs&quot; | $SP2NL | $Xsed -e &quot;$lo2o&quot; | $NL2SP`
+    test -n &quot;$prev&quot; &amp;&amp; \
+      func_fatal_help &quot;the \`$prev' option requires an argument&quot;
 
-	# Prepare the list of exported symbols
-	if test -z &quot;$export_symbols&quot;; then
-	  if test &quot;$always_export_symbols&quot; = yes || test -n &quot;$export_symbols_regex&quot;; then
-	    $show &quot;generating symbol list for \`$libname.la'&quot;
-	    export_symbols=&quot;$output_objdir/$libname.exp&quot;
-	    $run $rm $export_symbols
-	    eval cmds=\&quot;$export_symbols_cmds\&quot;
-	    save_ifs=&quot;$IFS&quot;; IFS='~'
-	    for cmd in $cmds; do
-	      IFS=&quot;$save_ifs&quot;
-	      $show &quot;$cmd&quot;
-	      $run eval &quot;$cmd&quot; || exit $?
-	    done
-	    IFS=&quot;$save_ifs&quot;
-	    if test -n &quot;$export_symbols_regex&quot;; then
-	      $show &quot;egrep -e \&quot;$export_symbols_regex\&quot; \&quot;$export_symbols\&quot; &gt; \&quot;${export_symbols}T\&quot;&quot;
-	      $run eval 'egrep -e &quot;$export_symbols_regex&quot; &quot;$export_symbols&quot; &gt; &quot;${export_symbols}T&quot;'
-	      $show &quot;$mv \&quot;${export_symbols}T\&quot; \&quot;$export_symbols\&quot;&quot;
-	      $run eval '$mv &quot;${export_symbols}T&quot; &quot;$export_symbols&quot;'
-	    fi
-	  fi
-	fi
+    if test -n &quot;$install_override_mode&quot; &amp;&amp; $no_mode; then
+      if $install_cp; then :; else
+	func_quote_for_eval &quot;$install_override_mode&quot;
+	func_append install_shared_prog &quot; -m $func_quote_for_eval_result&quot;
+      fi
+    fi
 
-	if test -n &quot;$export_symbols&quot; &amp;&amp; test -n &quot;$include_expsyms&quot;; then
-	  $run eval '$echo &quot;X$include_expsyms&quot; | $SP2NL &gt;&gt; &quot;$export_symbols&quot;'
-	fi
+    if test -z &quot;$files&quot;; then
+      if test -z &quot;$dest&quot;; then
+	func_fatal_help &quot;no file or destination specified&quot;
+      else
+	func_fatal_help &quot;you must specify a destination&quot;
+      fi
+    fi
 
-	if test -n &quot;$convenience&quot;; then
-	  if test -n &quot;$whole_archive_flag_spec&quot;; then
-	    eval libobjs=\&quot;\$libobjs $whole_archive_flag_spec\&quot;
-	  else
-	    gentop=&quot;$output_objdir/${outputname}x&quot;
-	    $show &quot;${rm}r $gentop&quot;
-	    $run ${rm}r &quot;$gentop&quot;
-	    $show &quot;mkdir $gentop&quot;
-	    $run mkdir &quot;$gentop&quot;
-	    status=$?
-	    if test $status -ne 0 &amp;&amp; test ! -d &quot;$gentop&quot;; then
-	      exit $status
-	    fi
-	    generated=&quot;$generated $gentop&quot;
+    # Strip any trailing slash from the destination.
+    func_stripname '' '/' &quot;$dest&quot;
+    dest=$func_stripname_result
 
-	    for xlib in $convenience; do
-	      # Extract the objects.
-	      case $xlib in
-	      [\\/]* | [A-Za-z]:[\\/]*) xabs=&quot;$xlib&quot; ;;
-	      *) xabs=`pwd`&quot;/$xlib&quot; ;;
-	      esac
-	      xlib=`$echo &quot;X$xlib&quot; | $Xsed -e 's%^.*/%%'`
-	      xdir=&quot;$gentop/$xlib&quot;
-
-	      $show &quot;${rm}r $xdir&quot;
-	      $run ${rm}r &quot;$xdir&quot;
-	      $show &quot;mkdir $xdir&quot;
-	      $run mkdir &quot;$xdir&quot;
-	      status=$?
-	      if test $status -ne 0 &amp;&amp; test ! -d &quot;$xdir&quot;; then
-		exit $status
-	      fi
-	      $show &quot;(cd $xdir &amp;&amp; $AR x $xabs)&quot;
-	      $run eval &quot;(cd \$xdir &amp;&amp; $AR x \$xabs)&quot; || exit $?
+    # Check to see that the destination is a directory.
+    test -d &quot;$dest&quot; &amp;&amp; isdir=yes
+    if test &quot;$isdir&quot; = yes; then
+      destdir=&quot;$dest&quot;
+      destname=
+    else
+      func_dirname_and_basename &quot;$dest&quot; &quot;&quot; &quot;.&quot;
+      destdir=&quot;$func_dirname_result&quot;
+      destname=&quot;$func_basename_result&quot;
 
-	      libobjs=&quot;$libobjs &quot;`find $xdir -name \*.o -print -o -name \*.lo -print | $NL2SP`
-	    done
-	  fi
-	fi
+      # Not a directory, so check to see that there is only one file specified.
+      set dummy $files; shift
+      test &quot;$#&quot; -gt 1 &amp;&amp; \
+	func_fatal_help &quot;\`$dest' is not a directory&quot;
+    fi
+    case $destdir in
+    [\\/]* | [A-Za-z]:[\\/]*) ;;
+    *)
+      for file in $files; do
+	case $file in
+	*.lo) ;;
+	*)
+	  func_fatal_help &quot;\`$destdir' must be an absolute directory name&quot;
+	  ;;
+	esac
+      done
+      ;;
+    esac
 
-	if test &quot;$thread_safe&quot; = yes &amp;&amp; test -n &quot;$thread_safe_flag_spec&quot;; then
-	  eval flag=\&quot;$thread_safe_flag_spec\&quot;
-	  linker_flags=&quot;$linker_flags $flag&quot;
-	fi
+    # This variable tells wrapper scripts just to set variables rather
+    # than running their programs.
+    libtool_install_magic=&quot;$magic&quot;
 
-	# Make a backup of the uninstalled library when relinking
-	if test &quot;$mode&quot; = relink; then
-	  $run eval '(cd $output_objdir &amp;&amp; $rm ${realname}U &amp;&amp; $mv $realname ${realname}U)' || exit $?
-	fi
+    staticlibs=
+    future_libdirs=
+    current_libdirs=
+    for file in $files; do
 
-	# Do each of the archive commands.
-	if test -n &quot;$export_symbols&quot; &amp;&amp; test -n &quot;$archive_expsym_cmds&quot;; then
-	  eval cmds=\&quot;$archive_expsym_cmds\&quot;
+      # Do each installation.
+      case $file in
+      *.$libext)
+	# Do the static libraries later.
+	func_append staticlibs &quot; $file&quot;
+	;;
+
+      *.la)
+	func_resolve_sysroot &quot;$file&quot;
+	file=$func_resolve_sysroot_result
+
+	# Check to see that this really is a libtool archive.
+	func_lalib_unsafe_p &quot;$file&quot; \
+	  || func_fatal_help &quot;\`$file' is not a valid libtool archive&quot;
+
+	library_names=
+	old_library=
+	relink_command=
+	func_source &quot;$file&quot;
+
+	# Add the libdir to current_libdirs if it is the destination.
+	if test &quot;X$destdir&quot; = &quot;X$libdir&quot;; then
+	  case &quot;$current_libdirs &quot; in
+	  *&quot; $libdir &quot;*) ;;
+	  *) func_append current_libdirs &quot; $libdir&quot; ;;
+	  esac
 	else
-	  eval cmds=\&quot;$archive_cmds\&quot;
+	  # Note the libdir as a future libdir.
+	  case &quot;$future_libdirs &quot; in
+	  *&quot; $libdir &quot;*) ;;
+	  *) func_append future_libdirs &quot; $libdir&quot; ;;
+	  esac
 	fi
-	save_ifs=&quot;$IFS&quot;; IFS='~'
-	for cmd in $cmds; do
-	  IFS=&quot;$save_ifs&quot;
-	  $show &quot;$cmd&quot;
-	  $run eval &quot;$cmd&quot; || exit $?
-	done
-	IFS=&quot;$save_ifs&quot;
 
-	# Restore the uninstalled library and exit
-	if test &quot;$mode&quot; = relink; then
-	  $run eval '(cd $output_objdir &amp;&amp; $rm ${realname}T &amp;&amp; $mv $realname ${realname}T &amp;&amp; $mv &quot;$realname&quot;U $realname)' || exit $?
-	  exit 0
-	fi
+	func_dirname &quot;$file&quot; &quot;/&quot; &quot;&quot;
+	dir=&quot;$func_dirname_result&quot;
+	func_append dir &quot;$objdir&quot;
 
-	# Create links to the real library.
-	for linkname in $linknames; do
-	  if test &quot;$realname&quot; != &quot;$linkname&quot;; then
-	    $show &quot;(cd $output_objdir &amp;&amp; $rm $linkname &amp;&amp; $LN_S $realname $linkname)&quot;
-	    $run eval '(cd $output_objdir &amp;&amp; $rm $linkname &amp;&amp; $LN_S $realname $linkname)' || exit $?
+	if test -n &quot;$relink_command&quot;; then
+	  # Determine the prefix the user has applied to our future dir.
+	  inst_prefix_dir=`$ECHO &quot;$destdir&quot; | $SED -e &quot;s%$libdir\$%%&quot;`
+
+	  # Don't allow the user to place us outside of our expected
+	  # location b/c this prevents finding dependent libraries that
+	  # are installed to the same prefix.
+	  # At present, this check doesn't affect windows .dll's that
+	  # are installed into $libdir/../bin (currently, that works fine)
+	  # but it's something to keep an eye on.
+	  test &quot;$inst_prefix_dir&quot; = &quot;$destdir&quot; &amp;&amp; \
+	    func_fatal_error &quot;error: cannot install \`$file' to a directory not ending in $libdir&quot;
+
+	  if test -n &quot;$inst_prefix_dir&quot;; then
+	    # Stick the inst_prefix_dir data into the link command.
+	    relink_command=`$ECHO &quot;$relink_command&quot; | $SED &quot;s%@inst_prefix_dir@%-inst-prefix-dir $inst_prefix_dir%&quot;`
+	  else
+	    relink_command=`$ECHO &quot;$relink_command&quot; | $SED &quot;s%@inst_prefix_dir@%%&quot;`
 	  fi
-	done
 
-	# If -module or -export-dynamic was specified, set the dlname.
-	if test &quot;$module&quot; = yes || test &quot;$export_dynamic&quot; = yes; then
-	  # On all known operating systems, these are identical.
-	  dlname=&quot;$soname&quot;
+	  func_warning &quot;relinking \`$file'&quot;
+	  func_show_eval &quot;$relink_command&quot; \
+	    'func_fatal_error &quot;error: relink \`$file'\'' with the above command before installing it&quot;'
 	fi
-      fi
-      ;;
 
-    obj)
-      if test -n &quot;$deplibs&quot;; then
-	$echo &quot;$modename: warning: \`-l' and \`-L' are ignored for objects&quot; 1&gt;&amp;2
-      fi
+	# See the names of the shared library.
+	set dummy $library_names; shift
+	if test -n &quot;$1&quot;; then
+	  realname=&quot;$1&quot;
+	  shift
 
-      if test -n &quot;$dlfiles$dlprefiles&quot; || test &quot;$dlself&quot; != no; then
-	$echo &quot;$modename: warning: \`-dlopen' is ignored for objects&quot; 1&gt;&amp;2
-      fi
+	  srcname=&quot;$realname&quot;
+	  test -n &quot;$relink_command&quot; &amp;&amp; srcname=&quot;$realname&quot;T
 
-      if test -n &quot;$rpath&quot;; then
-	$echo &quot;$modename: warning: \`-rpath' is ignored for objects&quot; 1&gt;&amp;2
-      fi
+	  # Install the shared library and build the symlinks.
+	  func_show_eval &quot;$install_shared_prog $dir/$srcname $destdir/$realname&quot; \
+	      'exit $?'
+	  tstripme=&quot;$stripme&quot;
+	  case $host_os in
+	  cygwin* | mingw* | pw32* | cegcc*)
+	    case $realname in
+	    *.dll.a)
+	      tstripme=&quot;&quot;
+	      ;;
+	    esac
+	    ;;
+	  esac
+	  if test -n &quot;$tstripme&quot; &amp;&amp; test -n &quot;$striplib&quot;; then
+	    func_show_eval &quot;$striplib $destdir/$realname&quot; 'exit $?'
+	  fi
 
-      if test -n &quot;$xrpath&quot;; then
-	$echo &quot;$modename: warning: \`-R' is ignored for objects&quot; 1&gt;&amp;2
-      fi
+	  if test &quot;$#&quot; -gt 0; then
+	    # Delete the old symlinks, and create new ones.
+	    # Try `ln -sf' first, because the `ln' binary might depend on
+	    # the symlink we replace!  Solaris /bin/ln does not understand -f,
+	    # so we also need to try rm &amp;&amp; ln -s.
+	    for linkname
+	    do
+	      test &quot;$linkname&quot; != &quot;$realname&quot; \
+		&amp;&amp; func_show_eval &quot;(cd $destdir &amp;&amp; { $LN_S -f $realname $linkname || { $RM $linkname &amp;&amp; $LN_S $realname $linkname; }; })&quot;
+	    done
+	  fi
 
-      if test -n &quot;$vinfo&quot;; then
-	$echo &quot;$modename: warning: \`-version-info' is ignored for objects&quot; 1&gt;&amp;2
-      fi
+	  # Do each command in the postinstall commands.
+	  lib=&quot;$destdir/$realname&quot;
+	  func_execute_cmds &quot;$postinstall_cmds&quot; 'exit $?'
+	fi
 
-      if test -n &quot;$release&quot;; then
-	$echo &quot;$modename: warning: \`-release' is ignored for objects&quot; 1&gt;&amp;2
-      fi
+	# Install the pseudo-library for information purposes.
+	func_basename &quot;$file&quot;
+	name=&quot;$func_basename_result&quot;
+	instname=&quot;$dir/$name&quot;i
+	func_show_eval &quot;$install_prog $instname $destdir/$name&quot; 'exit $?'
 
-      case $output in
-      *.lo)
-	if test -n &quot;$objs$old_deplibs&quot;; then
-	  $echo &quot;$modename: cannot build library object \`$output' from non-libtool objects&quot; 1&gt;&amp;2
-	  exit 1
-	fi
-	libobj=&quot;$output&quot;
-	obj=`$echo &quot;X$output&quot; | $Xsed -e &quot;$lo2o&quot;`
-	;;
-      *)
-	libobj=
-	obj=&quot;$output&quot;
+	# Maybe install the static library, too.
+	test -n &quot;$old_library&quot; &amp;&amp; func_append staticlibs &quot; $dir/$old_library&quot;
 	;;
-      esac
 
-      # Delete the old objects.
-      $run $rm $obj $libobj
-
-      # Objects from convenience libraries.  This assumes
-      # single-version convenience libraries.  Whenever we create
-      # different ones for PIC/non-PIC, this we'll have to duplicate
-      # the extraction.
-      reload_conv_objs=
-      gentop=
-      # reload_cmds runs $LD directly, so let us get rid of
-      # -Wl from whole_archive_flag_spec
-      wl=
+      *.lo)
+	# Install (i.e. copy) a libtool object.
 
-      if test -n &quot;$convenience&quot;; then
-	if test -n &quot;$whole_archive_flag_spec&quot;; then
-	  eval reload_conv_objs=\&quot;\$reload_objs $whole_archive_flag_spec\&quot;
+	# Figure out destination file name, if it wasn't already specified.
+	if test -n &quot;$destname&quot;; then
+	  destfile=&quot;$destdir/$destname&quot;
 	else
-	  gentop=&quot;$output_objdir/${obj}x&quot;
-	  $show &quot;${rm}r $gentop&quot;
-	  $run ${rm}r &quot;$gentop&quot;
-	  $show &quot;mkdir $gentop&quot;
-	  $run mkdir &quot;$gentop&quot;
-	  status=$?
-	  if test $status -ne 0 &amp;&amp; test ! -d &quot;$gentop&quot;; then
-	    exit $status
-	  fi
-	  generated=&quot;$generated $gentop&quot;
-
-	  for xlib in $convenience; do
-	    # Extract the objects.
-	    case $xlib in
-	    [\\/]* | [A-Za-z]:[\\/]*) xabs=&quot;$xlib&quot; ;;
-	    *) xabs=`pwd`&quot;/$xlib&quot; ;;
-	    esac
-	    xlib=`$echo &quot;X$xlib&quot; | $Xsed -e 's%^.*/%%'`
-	    xdir=&quot;$gentop/$xlib&quot;
-
-	    $show &quot;${rm}r $xdir&quot;
-	    $run ${rm}r &quot;$xdir&quot;
-	    $show &quot;mkdir $xdir&quot;
-	    $run mkdir &quot;$xdir&quot;
-	    status=$?
-	    if test $status -ne 0 &amp;&amp; test ! -d &quot;$xdir&quot;; then
-	      exit $status
-	    fi
-	    $show &quot;(cd $xdir &amp;&amp; $AR x $xabs)&quot;
-	    $run eval &quot;(cd \$xdir &amp;&amp; $AR x \$xabs)&quot; || exit $?
-
-	    reload_conv_objs=&quot;$reload_objs &quot;`find $xdir -name \*.o -print -o -name \*.lo -print | $NL2SP`
-	  done
+	  func_basename &quot;$file&quot;
+	  destfile=&quot;$func_basename_result&quot;
+	  destfile=&quot;$destdir/$destfile&quot;
 	fi
-      fi
-
-      # Create the old-style object.
-      reload_objs=&quot;$objs$old_deplibs &quot;`$echo &quot;X$libobjs&quot; | $SP2NL | $Xsed -e '/\.'${libext}$'/d' -e '/\.lib$/d' -e &quot;$lo2o&quot; | $NL2SP`&quot; $reload_conv_objs&quot; ### testsuite: skip nested quoting test
 
-      output=&quot;$obj&quot;
-      eval cmds=\&quot;$reload_cmds\&quot;
-      save_ifs=&quot;$IFS&quot;; IFS='~'
-      for cmd in $cmds; do
-	IFS=&quot;$save_ifs&quot;
-	$show &quot;$cmd&quot;
-	$run eval &quot;$cmd&quot; || exit $?
-      done
-      IFS=&quot;$save_ifs&quot;
-
-      # Exit if we aren't doing a library object file.
-      if test -z &quot;$libobj&quot;; then
-	if test -n &quot;$gentop&quot;; then
-	  $show &quot;${rm}r $gentop&quot;
-	  $run ${rm}r $gentop
-	fi
+	# Deduce the name of the destination old-style object file.
+	case $destfile in
+	*.lo)
+	  func_lo2o &quot;$destfile&quot;
+	  staticdest=$func_lo2o_result
+	  ;;
+	*.$objext)
+	  staticdest=&quot;$destfile&quot;
+	  destfile=
+	  ;;
+	*)
+	  func_fatal_help &quot;cannot copy a libtool object to \`$destfile'&quot;
+	  ;;
+	esac
 
-	exit 0
-      fi
+	# Install the libtool object if requested.
+	test -n &quot;$destfile&quot; &amp;&amp; \
+	  func_show_eval &quot;$install_prog $file $destfile&quot; 'exit $?'
 
-      if test &quot;$build_libtool_libs&quot; != yes; then
-	if test -n &quot;$gentop&quot;; then
-	  $show &quot;${rm}r $gentop&quot;
-	  $run ${rm}r $gentop
+	# Install the old object if enabled.
+	if test &quot;$build_old_libs&quot; = yes; then
+	  # Deduce the name of the old-style object file.
+	  func_lo2o &quot;$file&quot;
+	  staticobj=$func_lo2o_result
+	  func_show_eval &quot;$install_prog \$staticobj \$staticdest&quot; 'exit $?'
 	fi
+	exit $EXIT_SUCCESS
+	;;
 
-	# Create an invalid libtool object if no PIC, so that we don't
-	# accidentally link it into a program.
-	$show &quot;echo timestamp &gt; $libobj&quot;
-	$run eval &quot;echo timestamp &gt; $libobj&quot; || exit $?
-	exit 0
-      fi
-
-      if test -n &quot;$pic_flag&quot; || test &quot;$pic_mode&quot; != default; then
-	# Only do commands if we really have different PIC objects.
-	reload_objs=&quot;$libobjs $reload_conv_objs&quot;
-	output=&quot;$libobj&quot;
-	eval cmds=\&quot;$reload_cmds\&quot;
-	save_ifs=&quot;$IFS&quot;; IFS='~'
-	for cmd in $cmds; do
-	  IFS=&quot;$save_ifs&quot;
-	  $show &quot;$cmd&quot;
-	  $run eval &quot;$cmd&quot; || exit $?
-	done
-	IFS=&quot;$save_ifs&quot;
-      else
-	# Just create a symlink.
-	$show $rm $libobj
-	$run $rm $libobj
-	xdir=`$echo &quot;X$libobj&quot; | $Xsed -e 's%/[^/]*$%%'`
-	if test &quot;X$xdir&quot; = &quot;X$libobj&quot;; then
-	  xdir=&quot;.&quot;
+      *)
+	# Figure out destination file name, if it wasn't already specified.
+	if test -n &quot;$destname&quot;; then
+	  destfile=&quot;$destdir/$destname&quot;
 	else
-	  xdir=&quot;$xdir&quot;
+	  func_basename &quot;$file&quot;
+	  destfile=&quot;$func_basename_result&quot;
+	  destfile=&quot;$destdir/$destfile&quot;
 	fi
-	baseobj=`$echo &quot;X$libobj&quot; | $Xsed -e 's%^.*/%%'`
-	oldobj=`$echo &quot;X$baseobj&quot; | $Xsed -e &quot;$lo2o&quot;`
-	$show &quot;(cd $xdir &amp;&amp; $LN_S $oldobj $baseobj)&quot;
-	$run eval '(cd $xdir &amp;&amp; $LN_S $oldobj $baseobj)' || exit $?
-      fi
-
-      if test -n &quot;$gentop&quot;; then
-	$show &quot;${rm}r $gentop&quot;
-	$run ${rm}r $gentop
-      fi
-
-      exit 0
-      ;;
-
-    prog)
-      case $host in
-	*cygwin*) output=`echo $output | sed -e 's,.exe$,,;s,$,.exe,'` ;;
-      esac
-      if test -n &quot;$vinfo&quot;; then
-	$echo &quot;$modename: warning: \`-version-info' is ignored for programs&quot; 1&gt;&amp;2
-      fi
 
-      if test -n &quot;$release&quot;; then
-	$echo &quot;$modename: warning: \`-release' is ignored for programs&quot; 1&gt;&amp;2
-      fi
+	# If the file is missing, and there is a .exe on the end, strip it
+	# because it is most likely a libtool script we actually want to
+	# install
+	stripped_ext=&quot;&quot;
+	case $file in
+	  *.exe)
+	    if test ! -f &quot;$file&quot;; then
+	      func_stripname '' '.exe' &quot;$file&quot;
+	      file=$func_stripname_result
+	      stripped_ext=&quot;.exe&quot;
+	    fi
+	    ;;
+	esac
 
-      if test &quot;$preload&quot; = yes; then
-	if test &quot;$dlopen_support&quot; = unknown &amp;&amp; test &quot;$dlopen_self&quot; = unknown &amp;&amp;
-	   test &quot;$dlopen_self_static&quot; = unknown; then
-	  $echo &quot;$modename: warning: \`AC_LIBTOOL_DLOPEN' not used. Assuming no dlopen support.&quot;
-	fi
-      fi
+	# Do a test to see if this is really a libtool program.
+	case $host in
+	*cygwin* | *mingw*)
+	    if func_ltwrapper_executable_p &quot;$file&quot;; then
+	      func_ltwrapper_scriptname &quot;$file&quot;
+	      wrapper=$func_ltwrapper_scriptname_result
+	    else
+	      func_stripname '' '.exe' &quot;$file&quot;
+	      wrapper=$func_stripname_result
+	    fi
+	    ;;
+	*)
+	    wrapper=$file
+	    ;;
+	esac
+	if func_ltwrapper_script_p &quot;$wrapper&quot;; then
+	  notinst_deplibs=
+	  relink_command=
 
-      case $host in
-      *-*-rhapsody* | *-*-darwin1.[012])
-	# On Rhapsody replace the C library is the System framework
-	compile_deplibs=`$echo &quot;X $compile_deplibs&quot; | $Xsed -e 's/ -lc / -framework System /'`
-	finalize_deplibs=`$echo &quot;X $finalize_deplibs&quot; | $Xsed -e 's/ -lc / -framework System /'`
-	;;
-      esac
+	  func_source &quot;$wrapper&quot;
 
-      compile_command=&quot;$compile_command $compile_deplibs&quot;
-      finalize_command=&quot;$finalize_command $finalize_deplibs&quot;
+	  # Check the variables that should have been set.
+	  test -z &quot;$generated_by_libtool_version&quot; &amp;&amp; \
+	    func_fatal_error &quot;invalid libtool wrapper script \`$wrapper'&quot;
 
-      if test -n &quot;$rpath$xrpath&quot;; then
-	# If the user specified any rpath flags, then add them.
-	for libdir in $rpath $xrpath; do
-	  # This is the magic to use -rpath.
-	  case &quot;$finalize_rpath &quot; in
-	  *&quot; $libdir &quot;*) ;;
-	  *) finalize_rpath=&quot;$finalize_rpath $libdir&quot; ;;
-	  esac
-	done
-      fi
-
-      # Now hardcode the library paths
-      rpath=
-      hardcode_libdirs=
-      for libdir in $compile_rpath $finalize_rpath; do
-	if test -n &quot;$hardcode_libdir_flag_spec&quot;; then
-	  if test -n &quot;$hardcode_libdir_separator&quot;; then
-	    if test -z &quot;$hardcode_libdirs&quot;; then
-	      hardcode_libdirs=&quot;$libdir&quot;
-	    else
-	      # Just accumulate the unique libdirs.
-	      case $hardcode_libdir_separator$hardcode_libdirs$hardcode_libdir_separator in
-	      *&quot;$hardcode_libdir_separator$libdir$hardcode_libdir_separator&quot;*)
-		;;
-	      *)
-		hardcode_libdirs=&quot;$hardcode_libdirs$hardcode_libdir_separator$libdir&quot;
-		;;
-	      esac
+	  finalize=yes
+	  for lib in $notinst_deplibs; do
+	    # Check to see that each library is installed.
+	    libdir=
+	    if test -f &quot;$lib&quot;; then
+	      func_source &quot;$lib&quot;
+	    fi
+	    libfile=&quot;$libdir/&quot;`$ECHO &quot;$lib&quot; | $SED 's%^.*/%%g'` ### testsuite: skip nested quoting test
+	    if test -n &quot;$libdir&quot; &amp;&amp; test ! -f &quot;$libfile&quot;; then
+	      func_warning &quot;\`$lib' has not been installed in \`$libdir'&quot;
+	      finalize=no
 	    fi
+	  done
+
+	  relink_command=
+	  func_source &quot;$wrapper&quot;
+
+	  outputname=
+	  if test &quot;$fast_install&quot; = no &amp;&amp; test -n &quot;$relink_command&quot;; then
+	    $opt_dry_run || {
+	      if test &quot;$finalize&quot; = yes; then
+	        tmpdir=`func_mktempdir`
+		func_basename &quot;$file$stripped_ext&quot;
+		file=&quot;$func_basename_result&quot;
+	        outputname=&quot;$tmpdir/$file&quot;
+	        # Replace the output file specification.
+	        relink_command=`$ECHO &quot;$relink_command&quot; | $SED 's%@OUTPUT@%'&quot;$outputname&quot;'%g'`
+
+	        $opt_silent || {
+	          func_quote_for_expand &quot;$relink_command&quot;
+		  eval &quot;func_echo $func_quote_for_expand_result&quot;
+	        }
+	        if eval &quot;$relink_command&quot;; then :
+	          else
+		  func_error &quot;error: relink \`$file' with the above command before installing it&quot;
+		  $opt_dry_run || ${RM}r &quot;$tmpdir&quot;
+		  continue
+	        fi
+	        file=&quot;$outputname&quot;
+	      else
+	        func_warning &quot;cannot relink \`$file'&quot;
+	      fi
+	    }
 	  else
-	    eval flag=\&quot;$hardcode_libdir_flag_spec\&quot;
-	    rpath=&quot;$rpath $flag&quot;
+	    # Install the binary that we compiled earlier.
+	    file=`$ECHO &quot;$file$stripped_ext&quot; | $SED &quot;s%\([^/]*\)$%$objdir/\1%&quot;`
 	  fi
-	elif test -n &quot;$runpath_var&quot;; then
-	  case &quot;$perm_rpath &quot; in
-	  *&quot; $libdir &quot;*) ;;
-	  *) perm_rpath=&quot;$perm_rpath $libdir&quot; ;;
-	  esac
 	fi
-	case $host in
-	*-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-os2*)
-	  case :$dllsearchpath: in
-	  *&quot;:$libdir:&quot;*) ;;
-	  *) dllsearchpath=&quot;$dllsearchpath:$libdir&quot;;;
+
+	# remove .exe since cygwin /usr/bin/install will append another
+	# one anyway
+	case $install_prog,$host in
+	*/usr/bin/install*,*cygwin*)
+	  case $file:$destfile in
+	  *.exe:*.exe)
+	    # this is ok
+	    ;;
+	  *.exe:*)
+	    destfile=$destfile.exe
+	    ;;
+	  *:*.exe)
+	    func_stripname '' '.exe' &quot;$destfile&quot;
+	    destfile=$func_stripname_result
+	    ;;
 	  esac
 	  ;;
 	esac
-      done
-      # Substitute the hardcoded libdirs into the rpath.
-      if test -n &quot;$hardcode_libdir_separator&quot; &amp;&amp;
-	 test -n &quot;$hardcode_libdirs&quot;; then
-	libdir=&quot;$hardcode_libdirs&quot;
-	eval rpath=\&quot; $hardcode_libdir_flag_spec\&quot;
-      fi
-      compile_rpath=&quot;$rpath&quot;
-
-      rpath=
-      hardcode_libdirs=
-      for libdir in $finalize_rpath; do
-	if test -n &quot;$hardcode_libdir_flag_spec&quot;; then
-	  if test -n &quot;$hardcode_libdir_separator&quot;; then
-	    if test -z &quot;$hardcode_libdirs&quot;; then
-	      hardcode_libdirs=&quot;$libdir&quot;
-	    else
-	      # Just accumulate the unique libdirs.
-	      case $hardcode_libdir_separator$hardcode_libdirs$hardcode_libdir_separator in
-	      *&quot;$hardcode_libdir_separator$libdir$hardcode_libdir_separator&quot;*)
-		;;
-	      *)
-		hardcode_libdirs=&quot;$hardcode_libdirs$hardcode_libdir_separator$libdir&quot;
-		;;
-	      esac
-	    fi
-	  else
-	    eval flag=\&quot;$hardcode_libdir_flag_spec\&quot;
-	    rpath=&quot;$rpath $flag&quot;
-	  fi
-	elif test -n &quot;$runpath_var&quot;; then
-	  case &quot;$finalize_perm_rpath &quot; in
-	  *&quot; $libdir &quot;*) ;;
-	  *) finalize_perm_rpath=&quot;$finalize_perm_rpath $libdir&quot; ;;
-	  esac
+	func_show_eval &quot;$install_prog\$stripme \$file \$destfile&quot; 'exit $?'
+	$opt_dry_run || if test -n &quot;$outputname&quot;; then
+	  ${RM}r &quot;$tmpdir&quot;
 	fi
-      done
-      # Substitute the hardcoded libdirs into the rpath.
-      if test -n &quot;$hardcode_libdir_separator&quot; &amp;&amp;
-	 test -n &quot;$hardcode_libdirs&quot;; then
-	libdir=&quot;$hardcode_libdirs&quot;
-	eval rpath=\&quot; $hardcode_libdir_flag_spec\&quot;
-      fi
-      finalize_rpath=&quot;$rpath&quot;
+	;;
+      esac
+    done
 
-      if test -n &quot;$libobjs&quot; &amp;&amp; test &quot;$build_old_libs&quot; = yes; then
-	# Transform all the library objects into standard objects.
-	compile_command=`$echo &quot;X$compile_command&quot; | $SP2NL | $Xsed -e &quot;$lo2o&quot; | $NL2SP`
-	finalize_command=`$echo &quot;X$finalize_command&quot; | $SP2NL | $Xsed -e &quot;$lo2o&quot; | $NL2SP`
+    for file in $staticlibs; do
+      func_basename &quot;$file&quot;
+      name=&quot;$func_basename_result&quot;
+
+      # Set up the ranlib parameters.
+      oldlib=&quot;$destdir/$name&quot;
+
+      func_show_eval &quot;$install_prog \$file \$oldlib&quot; 'exit $?'
+
+      if test -n &quot;$stripme&quot; &amp;&amp; test -n &quot;$old_striplib&quot;; then
+	func_show_eval &quot;$old_striplib $oldlib&quot; 'exit $?'
       fi
 
-      dlsyms=
-      if test -n &quot;$dlfiles$dlprefiles&quot; || test &quot;$dlself&quot; != no; then
-	if test -n &quot;$NM&quot; &amp;&amp; test -n &quot;$global_symbol_pipe&quot;; then
-	  dlsyms=&quot;${outputname}S.c&quot;
-	else
-	  $echo &quot;$modename: not configured to extract global symbols from dlpreopened files&quot; 1&gt;&amp;2
-	fi
+      # Do each command in the postinstall commands.
+      func_execute_cmds &quot;$old_postinstall_cmds&quot; 'exit $?'
+    done
+
+    test -n &quot;$future_libdirs&quot; &amp;&amp; \
+      func_warning &quot;remember to run \`$progname --finish$future_libdirs'&quot;
+
+    if test -n &quot;$current_libdirs&quot;; then
+      # Maybe just do a dry run.
+      $opt_dry_run &amp;&amp; current_libdirs=&quot; -n$current_libdirs&quot;
+      exec_cmd='$SHELL $progpath $preserve_args --finish$current_libdirs'
+    else
+      exit $EXIT_SUCCESS
+    fi
+}
+
+test &quot;$opt_mode&quot; = install &amp;&amp; func_mode_install ${1+&quot;$@&quot;}
+
+
+# func_generate_dlsyms outputname originator pic_p
+# Extract symbols from dlprefiles and create ${outputname}S.o with
+# a dlpreopen symbol table.
+func_generate_dlsyms ()
+{
+    $opt_debug
+    my_outputname=&quot;$1&quot;
+    my_originator=&quot;$2&quot;
+    my_pic_p=&quot;${3-no}&quot;
+    my_prefix=`$ECHO &quot;$my_originator&quot; | sed 's%[^a-zA-Z0-9]%_%g'`
+    my_dlsyms=
+
+    if test -n &quot;$dlfiles$dlprefiles&quot; || test &quot;$dlself&quot; != no; then
+      if test -n &quot;$NM&quot; &amp;&amp; test -n &quot;$global_symbol_pipe&quot;; then
+	my_dlsyms=&quot;${my_outputname}S.c&quot;
+      else
+	func_error &quot;not configured to extract global symbols from dlpreopened files&quot;
       fi
+    fi
 
-      if test -n &quot;$dlsyms&quot;; then
-	case $dlsyms in
-	&quot;&quot;) ;;
-	*.c)
-	  # Discover the nlist of each of the dlfiles.
-	  nlist=&quot;$output_objdir/${outputname}.nm&quot;
+    if test -n &quot;$my_dlsyms&quot;; then
+      case $my_dlsyms in
+      &quot;&quot;) ;;
+      *.c)
+	# Discover the nlist of each of the dlfiles.
+	nlist=&quot;$output_objdir/${my_outputname}.nm&quot;
 
-	  $show &quot;$rm $nlist ${nlist}S ${nlist}T&quot;
-	  $run $rm &quot;$nlist&quot; &quot;${nlist}S&quot; &quot;${nlist}T&quot;
+	func_show_eval &quot;$RM $nlist ${nlist}S ${nlist}T&quot;
 
-	  # Parse the name list into a source file.
-	  $show &quot;creating $output_objdir/$dlsyms&quot;
+	# Parse the name list into a source file.
+	func_verbose &quot;creating $output_objdir/$my_dlsyms&quot;
 
-	  test -z &quot;$run&quot; &amp;&amp; $echo &gt; &quot;$output_objdir/$dlsyms&quot; &quot;\
-/* $dlsyms - symbol resolution table for \`$outputname' dlsym emulation. */
-/* Generated by $PROGRAM - GNU $PACKAGE $VERSION$TIMESTAMP */
+	$opt_dry_run || $ECHO &gt; &quot;$output_objdir/$my_dlsyms&quot; &quot;\
+/* $my_dlsyms - symbol resolution table for \`$my_outputname' dlsym emulation. */
+/* Generated by $PROGRAM (GNU $PACKAGE$TIMESTAMP) $VERSION */
 
 #ifdef __cplusplus
 extern \&quot;C\&quot; {
 #endif
 
-/* Prevent the only kind of declaration conflicts we can make. */
-#define lt_preloaded_symbols some_other_symbol
+#if defined(__GNUC__) &amp;&amp; (((__GNUC__ == 4) &amp;&amp; (__GNUC_MINOR__ &gt;= 4)) || (__GNUC__ &gt; 4))
+#pragma GCC diagnostic ignored \&quot;-Wstrict-prototypes\&quot;
+#endif
+
+/* Keep this code in sync between libtool.m4, ltmain, lt_system.h, and tests.  */
+#if defined(_WIN32) || defined(__CYGWIN__) || defined(_WIN32_WCE)
+/* DATA imports from DLLs on WIN32 con't be const, because runtime
+   relocations are performed -- see ld's documentation on pseudo-relocs.  */
+# define LT_DLSYM_CONST
+#elif defined(__osf__)
+/* This system does not cope well with relocations in const data.  */
+# define LT_DLSYM_CONST
+#else
+# define LT_DLSYM_CONST const
+#endif
 
 /* External symbol declarations for the compiler. */\
 &quot;
 
-	  if test &quot;$dlself&quot; = yes; then
-	    $show &quot;generating symbol list for \`$output'&quot;
-
-	    test -z &quot;$run&quot; &amp;&amp; $echo ': @PROGRAM@ ' &gt; &quot;$nlist&quot;
-
-	    # Add our own program objects to the symbol list.
-	    progfiles=`$echo &quot;X$objs$old_deplibs&quot; | $SP2NL | $Xsed -e &quot;$lo2o&quot; | $NL2SP`
-	    for arg in $progfiles; do
-	      $show &quot;extracting global C symbols from \`$arg'&quot;
-	      $run eval &quot;$NM $arg | $global_symbol_pipe &gt;&gt; '$nlist'&quot;
-	    done
+	if test &quot;$dlself&quot; = yes; then
+	  func_verbose &quot;generating symbol list for \`$output'&quot;
 
-	    if test -n &quot;$exclude_expsyms&quot;; then
-	      $run eval 'egrep -v &quot; ($exclude_expsyms)$&quot; &quot;$nlist&quot; &gt; &quot;$nlist&quot;T'
-	      $run eval '$mv &quot;$nlist&quot;T &quot;$nlist&quot;'
-	    fi
+	  $opt_dry_run || echo ': @PROGRAM@ ' &gt; &quot;$nlist&quot;
 
-	    if test -n &quot;$export_symbols_regex&quot;; then
-	      $run eval 'egrep -e &quot;$export_symbols_regex&quot; &quot;$nlist&quot; &gt; &quot;$nlist&quot;T'
-	      $run eval '$mv &quot;$nlist&quot;T &quot;$nlist&quot;'
-	    fi
+	  # Add our own program objects to the symbol list.
+	  progfiles=`$ECHO &quot;$objs$old_deplibs&quot; | $SP2NL | $SED &quot;$lo2o&quot; | $NL2SP`
+	  for progfile in $progfiles; do
+	    func_to_tool_file &quot;$progfile&quot; func_convert_file_msys_to_w32
+	    func_verbose &quot;extracting global C symbols from \`$func_to_tool_file_result'&quot;
+	    $opt_dry_run || eval &quot;$NM $func_to_tool_file_result | $global_symbol_pipe &gt;&gt; '$nlist'&quot;
+	  done
 
-	    # Prepare the list of exported symbols
-	    if test -z &quot;$export_symbols&quot;; then
-	      export_symbols=&quot;$output_objdir/$output.exp&quot;
-	      $run $rm $export_symbols
-	      $run eval &quot;sed -n -e '/^: @PROGRAM@$/d' -e 's/^.* \(.*\)$/\1/p' &quot;'&lt; &quot;$nlist&quot; &gt; &quot;$export_symbols&quot;'
-	    else
-	      $run eval &quot;sed -e 's/\([][.*^$]\)/\\\1/g' -e 's/^/ /' -e 's/$/$/'&quot;' &lt; &quot;$export_symbols&quot; &gt; &quot;$output_objdir/$output.exp&quot;'
-	      $run eval 'grep -f &quot;$output_objdir/$output.exp&quot; &lt; &quot;$nlist&quot; &gt; &quot;$nlist&quot;T'
-	      $run eval 'mv &quot;$nlist&quot;T &quot;$nlist&quot;'
-	    fi
+	  if test -n &quot;$exclude_expsyms&quot;; then
+	    $opt_dry_run || {
+	      eval '$EGREP -v &quot; ($exclude_expsyms)$&quot; &quot;$nlist&quot; &gt; &quot;$nlist&quot;T'
+	      eval '$MV &quot;$nlist&quot;T &quot;$nlist&quot;'
+	    }
 	  fi
 
-	  for arg in $dlprefiles; do
-	    $show &quot;extracting global C symbols from \`$arg'&quot;
-	    name=`echo &quot;$arg&quot; | sed -e 's%^.*/%%'`
-	    $run eval 'echo &quot;: $name &quot; &gt;&gt; &quot;$nlist&quot;'
-	    $run eval &quot;$NM $arg | $global_symbol_pipe &gt;&gt; '$nlist'&quot;
-	  done
+	  if test -n &quot;$export_symbols_regex&quot;; then
+	    $opt_dry_run || {
+	      eval '$EGREP -e &quot;$export_symbols_regex&quot; &quot;$nlist&quot; &gt; &quot;$nlist&quot;T'
+	      eval '$MV &quot;$nlist&quot;T &quot;$nlist&quot;'
+	    }
+	  fi
 
-	  if test -z &quot;$run&quot;; then
-	    # Make sure we have at least an empty file.
-	    test -f &quot;$nlist&quot; || : &gt; &quot;$nlist&quot;
+	  # Prepare the list of exported symbols
+	  if test -z &quot;$export_symbols&quot;; then
+	    export_symbols=&quot;$output_objdir/$outputname.exp&quot;
+	    $opt_dry_run || {
+	      $RM $export_symbols
+	      eval &quot;${SED} -n -e '/^: @PROGRAM@ $/d' -e 's/^.* \(.*\)$/\1/p' &quot;'&lt; &quot;$nlist&quot; &gt; &quot;$export_symbols&quot;'
+	      case $host in
+	      *cygwin* | *mingw* | *cegcc* )
+                eval &quot;echo EXPORTS &quot;'&gt; &quot;$output_objdir/$outputname.def&quot;'
+                eval 'cat &quot;$export_symbols&quot; &gt;&gt; &quot;$output_objdir/$outputname.def&quot;'
+	        ;;
+	      esac
+	    }
+	  else
+	    $opt_dry_run || {
+	      eval &quot;${SED} -e 's/\([].[*^$]\)/\\\\\1/g' -e 's/^/ /' -e 's/$/$/'&quot;' &lt; &quot;$export_symbols&quot; &gt; &quot;$output_objdir/$outputname.exp&quot;'
+	      eval '$GREP -f &quot;$output_objdir/$outputname.exp&quot; &lt; &quot;$nlist&quot; &gt; &quot;$nlist&quot;T'
+	      eval '$MV &quot;$nlist&quot;T &quot;$nlist&quot;'
+	      case $host in
+	        *cygwin* | *mingw* | *cegcc* )
+	          eval &quot;echo EXPORTS &quot;'&gt; &quot;$output_objdir/$outputname.def&quot;'
+	          eval 'cat &quot;$nlist&quot; &gt;&gt; &quot;$output_objdir/$outputname.def&quot;'
+	          ;;
+	      esac
+	    }
+	  fi
+	fi
 
-	    if test -n &quot;$exclude_expsyms&quot;; then
-	      egrep -v &quot; ($exclude_expsyms)$&quot; &quot;$nlist&quot; &gt; &quot;$nlist&quot;T
-	      $mv &quot;$nlist&quot;T &quot;$nlist&quot;
-	    fi
+	for dlprefile in $dlprefiles; do
+	  func_verbose &quot;extracting global C symbols from \`$dlprefile'&quot;
+	  func_basename &quot;$dlprefile&quot;
+	  name=&quot;$func_basename_result&quot;
+          case $host in
+	    *cygwin* | *mingw* | *cegcc* )
+	      # if an import library, we need to obtain dlname
+	      if func_win32_import_lib_p &quot;$dlprefile&quot;; then
+	        func_tr_sh &quot;$dlprefile&quot;
+	        eval &quot;curr_lafile=\$libfile_$func_tr_sh_result&quot;
+	        dlprefile_dlbasename=&quot;&quot;
+	        if test -n &quot;$curr_lafile&quot; &amp;&amp; func_lalib_p &quot;$curr_lafile&quot;; then
+	          # Use subshell, to avoid clobbering current variable values
+	          dlprefile_dlname=`source &quot;$curr_lafile&quot; &amp;&amp; echo &quot;$dlname&quot;`
+	          if test -n &quot;$dlprefile_dlname&quot; ; then
+	            func_basename &quot;$dlprefile_dlname&quot;
+	            dlprefile_dlbasename=&quot;$func_basename_result&quot;
+	          else
+	            # no lafile. user explicitly requested -dlpreopen &lt;import library&gt;.
+	            $sharedlib_from_linklib_cmd &quot;$dlprefile&quot;
+	            dlprefile_dlbasename=$sharedlib_from_linklib_result
+	          fi
+	        fi
+	        $opt_dry_run || {
+	          if test -n &quot;$dlprefile_dlbasename&quot; ; then
+	            eval '$ECHO &quot;: $dlprefile_dlbasename&quot; &gt;&gt; &quot;$nlist&quot;'
+	          else
+	            func_warning &quot;Could not compute DLL name from $name&quot;
+	            eval '$ECHO &quot;: $name &quot; &gt;&gt; &quot;$nlist&quot;'
+	          fi
+	          func_to_tool_file &quot;$dlprefile&quot; func_convert_file_msys_to_w32
+	          eval &quot;$NM \&quot;$func_to_tool_file_result\&quot; 2&gt;/dev/null | $global_symbol_pipe |
+	            $SED -e '/I __imp/d' -e 's/I __nm_/D /;s/_nm__//' &gt;&gt; '$nlist'&quot;
+	        }
+	      else # not an import lib
+	        $opt_dry_run || {
+	          eval '$ECHO &quot;: $name &quot; &gt;&gt; &quot;$nlist&quot;'
+	          func_to_tool_file &quot;$dlprefile&quot; func_convert_file_msys_to_w32
+	          eval &quot;$NM \&quot;$func_to_tool_file_result\&quot; 2&gt;/dev/null | $global_symbol_pipe &gt;&gt; '$nlist'&quot;
+	        }
+	      fi
+	    ;;
+	    *)
+	      $opt_dry_run || {
+	        eval '$ECHO &quot;: $name &quot; &gt;&gt; &quot;$nlist&quot;'
+	        func_to_tool_file &quot;$dlprefile&quot; func_convert_file_msys_to_w32
+	        eval &quot;$NM \&quot;$func_to_tool_file_result\&quot; 2&gt;/dev/null | $global_symbol_pipe &gt;&gt; '$nlist'&quot;
+	      }
+	    ;;
+          esac
+	done
 
-	    # Try sorting and uniquifying the output.
-	    if grep -v &quot;^: &quot; &lt; &quot;$nlist&quot; | sort +2 | uniq &gt; &quot;$nlist&quot;S; then
-	      :
-	    else
-	      grep -v &quot;^: &quot; &lt; &quot;$nlist&quot; &gt; &quot;$nlist&quot;S
-	    fi
+	$opt_dry_run || {
+	  # Make sure we have at least an empty file.
+	  test -f &quot;$nlist&quot; || : &gt; &quot;$nlist&quot;
 
-	    if test -f &quot;$nlist&quot;S; then
-	      eval &quot;$global_symbol_to_cdecl&quot;' &lt; &quot;$nlist&quot;S &gt;&gt; &quot;$output_objdir/$dlsyms&quot;'
-	    else
-	      echo '/* NONE */' &gt;&gt; &quot;$output_objdir/$dlsyms&quot;
-	    fi
+	  if test -n &quot;$exclude_expsyms&quot;; then
+	    $EGREP -v &quot; ($exclude_expsyms)$&quot; &quot;$nlist&quot; &gt; &quot;$nlist&quot;T
+	    $MV &quot;$nlist&quot;T &quot;$nlist&quot;
+	  fi
 
-	    $echo &gt;&gt; &quot;$output_objdir/$dlsyms&quot; &quot;\
+	  # Try sorting and uniquifying the output.
+	  if $GREP -v &quot;^: &quot; &lt; &quot;$nlist&quot; |
+	      if sort -k 3 &lt;/dev/null &gt;/dev/null 2&gt;&amp;1; then
+		sort -k 3
+	      else
+		sort +2
+	      fi |
+	      uniq &gt; &quot;$nlist&quot;S; then
+	    :
+	  else
+	    $GREP -v &quot;^: &quot; &lt; &quot;$nlist&quot; &gt; &quot;$nlist&quot;S
+	  fi
 
-#undef lt_preloaded_symbols
+	  if test -f &quot;$nlist&quot;S; then
+	    eval &quot;$global_symbol_to_cdecl&quot;' &lt; &quot;$nlist&quot;S &gt;&gt; &quot;$output_objdir/$my_dlsyms&quot;'
+	  else
+	    echo '/* NONE */' &gt;&gt; &quot;$output_objdir/$my_dlsyms&quot;
+	  fi
 
-#if defined (__STDC__) &amp;&amp; __STDC__
-# define lt_ptr void *
-#else
-# define lt_ptr char *
-# define const
-#endif
+	  echo &gt;&gt; &quot;$output_objdir/$my_dlsyms&quot; &quot;\
 
-/* The mapping between symbol names and symbols. */
-const struct {
+/* The mapping between symbol names and symbols.  */
+typedef struct {
   const char *name;
-  lt_ptr address;
-}
-lt_preloaded_symbols[] =
+  void *address;
+} lt_dlsymlist;
+extern LT_DLSYM_CONST lt_dlsymlist
+lt_${my_prefix}_LTX_preloaded_symbols[];
+LT_DLSYM_CONST lt_dlsymlist
+lt_${my_prefix}_LTX_preloaded_symbols[] =
 {\
-&quot;
-
-	    eval &quot;$global_symbol_to_c_name_address&quot; &lt; &quot;$nlist&quot; &gt;&gt; &quot;$output_objdir/$dlsyms&quot;
+  { \&quot;$my_originator\&quot;, (void *) 0 },&quot;
 
-	    $echo &gt;&gt; &quot;$output_objdir/$dlsyms&quot; &quot;\
-  {0, (lt_ptr) 0}
+	  case $need_lib_prefix in
+	  no)
+	    eval &quot;$global_symbol_to_c_name_address&quot; &lt; &quot;$nlist&quot; &gt;&gt; &quot;$output_objdir/$my_dlsyms&quot;
+	    ;;
+	  *)
+	    eval &quot;$global_symbol_to_c_name_address_lib_prefix&quot; &lt; &quot;$nlist&quot; &gt;&gt; &quot;$output_objdir/$my_dlsyms&quot;
+	    ;;
+	  esac
+	  echo &gt;&gt; &quot;$output_objdir/$my_dlsyms&quot; &quot;\
+  {0, (void *) 0}
 };
 
 /* This works around a problem in FreeBSD linker */
 #ifdef FREEBSD_WORKAROUND
 static const void *lt_preloaded_setup() {
-  return lt_preloaded_symbols;
+  return lt_${my_prefix}_LTX_preloaded_symbols;
 }
 #endif
 
@@ -3355,9 +3458,12 @@ static const void *lt_preloaded_setup() {
 }
 #endif\
 &quot;
-	  fi
+	} # !$opt_dry_run
 
-	  pic_flag_for_symtable=
+	pic_flag_for_symtable=
+	case &quot;$compile_command &quot; in
+	*&quot; -static &quot;*) ;;
+	*)
 	  case $host in
 	  # compiling the symbol table file with pic_flag works around
 	  # a FreeBSD bug that causes programs to crash when -lm is
@@ -3365,1267 +3471,5965 @@ static const void *lt_preloaded_setup() {
 	  # pic_flag when linking with -static.  The problem exists in
 	  # FreeBSD 2.2.6 and is fixed in FreeBSD 3.1.
 	  *-*-freebsd2*|*-*-freebsd3.0*|*-*-freebsdelf3.0*)
-	    case &quot;$compile_command &quot; in
-	    *&quot; -static &quot;*) ;;
-	    *) pic_flag_for_symtable=&quot; $pic_flag -DPIC -DFREEBSD_WORKAROUND&quot;;;
-	    esac;;
+	    pic_flag_for_symtable=&quot; $pic_flag -DFREEBSD_WORKAROUND&quot; ;;
 	  *-*-hpux*)
-	    case &quot;$compile_command &quot; in
-	    *&quot; -static &quot;*) ;;
-	    *) pic_flag_for_symtable=&quot; $pic_flag -DPIC&quot;;;
-	    esac
+	    pic_flag_for_symtable=&quot; $pic_flag&quot;  ;;
+	  *)
+	    if test &quot;X$my_pic_p&quot; != Xno; then
+	      pic_flag_for_symtable=&quot; $pic_flag&quot;
+	    fi
+	    ;;
+	  esac
+	  ;;
+	esac
+	symtab_cflags=
+	for arg in $LTCFLAGS; do
+	  case $arg in
+	  -pie | -fpie | -fPIE) ;;
+	  *) func_append symtab_cflags &quot; $arg&quot; ;;
 	  esac
+	done
 
-	  # Now compile the dynamic symbol file.
-	  $show &quot;(cd $output_objdir &amp;&amp; $CC -c$no_builtin_flag$pic_flag_for_symtable \&quot;$dlsyms\&quot;)&quot;
-	  $run eval '(cd $output_objdir &amp;&amp; $CC -c$no_builtin_flag$pic_flag_for_symtable &quot;$dlsyms&quot;)' || exit $?
+	# Now compile the dynamic symbol file.
+	func_show_eval '(cd $output_objdir &amp;&amp; $LTCC$symtab_cflags -c$no_builtin_flag$pic_flag_for_symtable &quot;$my_dlsyms&quot;)' 'exit $?'
 
-	  # Clean up the generated files.
-	  $show &quot;$rm $output_objdir/$dlsyms $nlist ${nlist}S ${nlist}T&quot;
-	  $run $rm &quot;$output_objdir/$dlsyms&quot; &quot;$nlist&quot; &quot;${nlist}S&quot; &quot;${nlist}T&quot;
+	# Clean up the generated files.
+	func_show_eval '$RM &quot;$output_objdir/$my_dlsyms&quot; &quot;$nlist&quot; &quot;${nlist}S&quot; &quot;${nlist}T&quot;'
 
-	  # Transform the symbol file into the correct name.
-	  compile_command=`$echo &quot;X$compile_command&quot; | $Xsed -e &quot;s%@SYMFILE@%$output_objdir/${outputname}S.${objext}%&quot;`
-	  finalize_command=`$echo &quot;X$finalize_command&quot; | $Xsed -e &quot;s%@SYMFILE@%$output_objdir/${outputname}S.${objext}%&quot;`
+	# Transform the symbol file into the correct name.
+	symfileobj=&quot;$output_objdir/${my_outputname}S.$objext&quot;
+	case $host in
+	*cygwin* | *mingw* | *cegcc* )
+	  if test -f &quot;$output_objdir/$my_outputname.def&quot;; then
+	    compile_command=`$ECHO &quot;$compile_command&quot; | $SED &quot;s%@SYMFILE@%$output_objdir/$my_outputname.def $symfileobj%&quot;`
+	    finalize_command=`$ECHO &quot;$finalize_command&quot; | $SED &quot;s%@SYMFILE@%$output_objdir/$my_outputname.def $symfileobj%&quot;`
+	  else
+	    compile_command=`$ECHO &quot;$compile_command&quot; | $SED &quot;s%@SYMFILE@%$symfileobj%&quot;`
+	    finalize_command=`$ECHO &quot;$finalize_command&quot; | $SED &quot;s%@SYMFILE@%$symfileobj%&quot;`
+	  fi
 	  ;;
 	*)
-	  $echo &quot;$modename: unknown suffix for \`$dlsyms'&quot; 1&gt;&amp;2
-	  exit 1
+	  compile_command=`$ECHO &quot;$compile_command&quot; | $SED &quot;s%@SYMFILE@%$symfileobj%&quot;`
+	  finalize_command=`$ECHO &quot;$finalize_command&quot; | $SED &quot;s%@SYMFILE@%$symfileobj%&quot;`
 	  ;;
 	esac
-      else
-	# We keep going just in case the user didn't refer to
-	# lt_preloaded_symbols.  The linker will fail if global_symbol_pipe
-	# really was required.
+	;;
+      *)
+	func_fatal_error &quot;unknown suffix for \`$my_dlsyms'&quot;
+	;;
+      esac
+    else
+      # We keep going just in case the user didn't refer to
+      # lt_preloaded_symbols.  The linker will fail if global_symbol_pipe
+      # really was required.
 
-	# Nullify the symbol file.
-	compile_command=`$echo &quot;X$compile_command&quot; | $Xsed -e &quot;s% @SYMFILE@%%&quot;`
-	finalize_command=`$echo &quot;X$finalize_command&quot; | $Xsed -e &quot;s% @SYMFILE@%%&quot;`
-      fi
+      # Nullify the symbol file.
+      compile_command=`$ECHO &quot;$compile_command&quot; | $SED &quot;s% @SYMFILE@%%&quot;`
+      finalize_command=`$ECHO &quot;$finalize_command&quot; | $SED &quot;s% @SYMFILE@%%&quot;`
+    fi
+}
 
-      if test $need_relink = no || test &quot;$build_libtool_libs&quot; != yes; then
-	# Replace the output file specification.
-	compile_command=`$echo &quot;X$compile_command&quot; | $Xsed -e 's%@OUTPUT@%'&quot;$output&quot;'%g'`
-	link_command=&quot;$compile_command$compile_rpath&quot;
+# func_win32_libid arg
+# return the library type of file 'arg'
+#
+# Need a lot of goo to handle *both* DLLs and import libs
+# Has to be a shell function in order to 'eat' the argument
+# that is supplied when $file_magic_command is called.
+# Despite the name, also deal with 64 bit binaries.
+func_win32_libid ()
+{
+  $opt_debug
+  win32_libid_type=&quot;unknown&quot;
+  win32_fileres=`file -L $1 2&gt;/dev/null`
+  case $win32_fileres in
+  *ar\ archive\ import\ library*) # definitely import
+    win32_libid_type=&quot;x86 archive import&quot;
+    ;;
+  *ar\ archive*) # could be an import, or static
+    # Keep the egrep pattern in sync with the one in _LT_CHECK_MAGIC_METHOD.
+    if eval $OBJDUMP -f $1 | $SED -e '10q' 2&gt;/dev/null |
+       $EGREP 'file format (pei*-i386(.*architecture: i386)?|pe-arm-wince|pe-x86-64)' &gt;/dev/null; then
+      func_to_tool_file &quot;$1&quot; func_convert_file_msys_to_w32
+      win32_nmres=`eval $NM -f posix -A \&quot;$func_to_tool_file_result\&quot; |
+	$SED -n -e '
+	    1,100{
+		/ I /{
+		    s,.*,import,
+		    p
+		    q
+		}
+	    }'`
+      case $win32_nmres in
+      import*)  win32_libid_type=&quot;x86 archive import&quot;;;
+      *)        win32_libid_type=&quot;x86 archive static&quot;;;
+      esac
+    fi
+    ;;
+  *DLL*)
+    win32_libid_type=&quot;x86 DLL&quot;
+    ;;
+  *executable*) # but shell scripts are &quot;executable&quot; too...
+    case $win32_fileres in
+    *MS\ Windows\ PE\ Intel*)
+      win32_libid_type=&quot;x86 DLL&quot;
+      ;;
+    esac
+    ;;
+  esac
+  $ECHO &quot;$win32_libid_type&quot;
+}
 
-	# We have no uninstalled library dependencies, so finalize right now.
-	$show &quot;$link_command&quot;
-	$run eval &quot;$link_command&quot;
-	status=$?
+# func_cygming_dll_for_implib ARG
+#
+# Platform-specific function to extract the
+# name of the DLL associated with the specified
+# import library ARG.
+# Invoked by eval'ing the libtool variable
+#    $sharedlib_from_linklib_cmd
+# Result is available in the variable
+#    $sharedlib_from_linklib_result
+func_cygming_dll_for_implib ()
+{
+  $opt_debug
+  sharedlib_from_linklib_result=`$DLLTOOL --identify-strict --identify &quot;$1&quot;`
+}
 
-	# Delete the generated files.
-	if test -n &quot;$dlsyms&quot;; then
-	  $show &quot;$rm $output_objdir/${outputname}S.${objext}&quot;
-	  $run $rm &quot;$output_objdir/${outputname}S.${objext}&quot;
-	fi
+# func_cygming_dll_for_implib_fallback_core SECTION_NAME LIBNAMEs
+#
+# The is the core of a fallback implementation of a
+# platform-specific function to extract the name of the
+# DLL associated with the specified import library LIBNAME.
+#
+# SECTION_NAME is either .idata$6 or .idata$7, depending
+# on the platform and compiler that created the implib.
+#
+# Echos the name of the DLL associated with the
+# specified import library.
+func_cygming_dll_for_implib_fallback_core ()
+{
+  $opt_debug
+  match_literal=`$ECHO &quot;$1&quot; | $SED &quot;$sed_make_literal_regex&quot;`
+  $OBJDUMP -s --section &quot;$1&quot; &quot;$2&quot; 2&gt;/dev/null |
+    $SED '/^Contents of section '&quot;$match_literal&quot;':/{
+      # Place marker at beginning of archive member dllname section
+      s/.*/====MARK====/
+      p
+      d
+    }
+    # These lines can sometimes be longer than 43 characters, but
+    # are always uninteresting
+    /:[	 ]*file format pe[i]\{,1\}-/d
+    /^In archive [^:]*:/d
+    # Ensure marker is printed
+    /^====MARK====/p
+    # Remove all lines with less than 43 characters
+    /^.\{43\}/!d
+    # From remaining lines, remove first 43 characters
+    s/^.\{43\}//' |
+    $SED -n '
+      # Join marker and all lines until next marker into a single line
+      /^====MARK====/ b para
+      H
+      $ b para
+      b
+      :para
+      x
+      s/\n//g
+      # Remove the marker
+      s/^====MARK====//
+      # Remove trailing dots and whitespace
+      s/[\. \t]*$//
+      # Print
+      /./p' |
+    # we now have a list, one entry per line, of the stringified
+    # contents of the appropriate section of all members of the
+    # archive which possess that section. Heuristic: eliminate
+    # all those which have a first or second character that is
+    # a '.' (that is, objdump's representation of an unprintable
+    # character.) This should work for all archives with less than
+    # 0x302f exports -- but will fail for DLLs whose name actually
+    # begins with a literal '.' or a single character followed by
+    # a '.'.
+    #
+    # Of those that remain, print the first one.
+    $SED -e '/^\./d;/^.\./d;q'
+}
 
-	exit $status
-      fi
+# func_cygming_gnu_implib_p ARG
+# This predicate returns with zero status (TRUE) if
+# ARG is a GNU/binutils-style import library. Returns
+# with nonzero status (FALSE) otherwise.
+func_cygming_gnu_implib_p ()
+{
+  $opt_debug
+  func_to_tool_file &quot;$1&quot; func_convert_file_msys_to_w32
+  func_cygming_gnu_implib_tmp=`$NM &quot;$func_to_tool_file_result&quot; | eval &quot;$global_symbol_pipe&quot; | $EGREP ' (_head_[A-Za-z0-9_]+_[ad]l*|[A-Za-z0-9_]+_[ad]l*_iname)$'`
+  test -n &quot;$func_cygming_gnu_implib_tmp&quot;
+}
 
-      if test -n &quot;$shlibpath_var&quot;; then
-	# We should set the shlibpath_var
-	rpath=
-	for dir in $temp_rpath; do
-	  case $dir in
-	  [\\/]* | [A-Za-z]:[\\/]*)
-	    # Absolute path.
-	    rpath=&quot;$rpath$dir:&quot;
-	    ;;
-	  *)
-	    # Relative path: add a thisdir entry.
-	    rpath=&quot;$rpath\$thisdir/$dir:&quot;
-	    ;;
-	  esac
-	done
-	temp_rpath=&quot;$rpath&quot;
-      fi
+# func_cygming_ms_implib_p ARG
+# This predicate returns with zero status (TRUE) if
+# ARG is an MS-style import library. Returns
+# with nonzero status (FALSE) otherwise.
+func_cygming_ms_implib_p ()
+{
+  $opt_debug
+  func_to_tool_file &quot;$1&quot; func_convert_file_msys_to_w32
+  func_cygming_ms_implib_tmp=`$NM &quot;$func_to_tool_file_result&quot; | eval &quot;$global_symbol_pipe&quot; | $GREP '_NULL_IMPORT_DESCRIPTOR'`
+  test -n &quot;$func_cygming_ms_implib_tmp&quot;
+}
 
-      if test -n &quot;$compile_shlibpath$finalize_shlibpath&quot;; then
-	compile_command=&quot;$shlibpath_var=\&quot;$compile_shlibpath$finalize_shlibpath\$$shlibpath_var\&quot; $compile_command&quot;
-      fi
-      if test -n &quot;$finalize_shlibpath&quot;; then
-	finalize_command=&quot;$shlibpath_var=\&quot;$finalize_shlibpath\$$shlibpath_var\&quot; $finalize_command&quot;
-      fi
+# func_cygming_dll_for_implib_fallback ARG
+# Platform-specific function to extract the
+# name of the DLL associated with the specified
+# import library ARG.
+#
+# This fallback implementation is for use when $DLLTOOL
+# does not support the --identify-strict option.
+# Invoked by eval'ing the libtool variable
+#    $sharedlib_from_linklib_cmd
+# Result is available in the variable
+#    $sharedlib_from_linklib_result
+func_cygming_dll_for_implib_fallback ()
+{
+  $opt_debug
+  if func_cygming_gnu_implib_p &quot;$1&quot; ; then
+    # binutils import library
+    sharedlib_from_linklib_result=`func_cygming_dll_for_implib_fallback_core '.idata$7' &quot;$1&quot;`
+  elif func_cygming_ms_implib_p &quot;$1&quot; ; then
+    # ms-generated import library
+    sharedlib_from_linklib_result=`func_cygming_dll_for_implib_fallback_core '.idata$6' &quot;$1&quot;`
+  else
+    # unknown
+    sharedlib_from_linklib_result=&quot;&quot;
+  fi
+}
 
-      compile_var=
-      finalize_var=
-      if test -n &quot;$runpath_var&quot;; then
-	if test -n &quot;$perm_rpath&quot;; then
-	  # We should set the runpath_var.
-	  rpath=
-	  for dir in $perm_rpath; do
-	    rpath=&quot;$rpath$dir:&quot;
-	  done
-	  compile_var=&quot;$runpath_var=\&quot;$rpath\$$runpath_var\&quot; &quot;
-	fi
-	if test -n &quot;$finalize_perm_rpath&quot;; then
-	  # We should set the runpath_var.
-	  rpath=
-	  for dir in $finalize_perm_rpath; do
-	    rpath=&quot;$rpath$dir:&quot;
-	  done
-	  finalize_var=&quot;$runpath_var=\&quot;$rpath\$$runpath_var\&quot; &quot;
-	fi
+
+# func_extract_an_archive dir oldlib
+func_extract_an_archive ()
+{
+    $opt_debug
+    f_ex_an_ar_dir=&quot;$1&quot;; shift
+    f_ex_an_ar_oldlib=&quot;$1&quot;
+    if test &quot;$lock_old_archive_extraction&quot; = yes; then
+      lockfile=$f_ex_an_ar_oldlib.lock
+      until $opt_dry_run || ln &quot;$progpath&quot; &quot;$lockfile&quot; 2&gt;/dev/null; do
+	func_echo &quot;Waiting for $lockfile to be removed&quot;
+	sleep 2
+      done
+    fi
+    func_show_eval &quot;(cd \$f_ex_an_ar_dir &amp;&amp; $AR x \&quot;\$f_ex_an_ar_oldlib\&quot;)&quot; \
+		   'stat=$?; rm -f &quot;$lockfile&quot;; exit $stat'
+    if test &quot;$lock_old_archive_extraction&quot; = yes; then
+      $opt_dry_run || rm -f &quot;$lockfile&quot;
+    fi
+    if ($AR t &quot;$f_ex_an_ar_oldlib&quot; | sort | sort -uc &gt;/dev/null 2&gt;&amp;1); then
+     :
+    else
+      func_fatal_error &quot;object name conflicts in archive: $f_ex_an_ar_dir/$f_ex_an_ar_oldlib&quot;
+    fi
+}
+
+
+# func_extract_archives gentop oldlib ...
+func_extract_archives ()
+{
+    $opt_debug
+    my_gentop=&quot;$1&quot;; shift
+    my_oldlibs=${1+&quot;$@&quot;}
+    my_oldobjs=&quot;&quot;
+    my_xlib=&quot;&quot;
+    my_xabs=&quot;&quot;
+    my_xdir=&quot;&quot;
+
+    for my_xlib in $my_oldlibs; do
+      # Extract the objects.
+      case $my_xlib in
+	[\\/]* | [A-Za-z]:[\\/]*) my_xabs=&quot;$my_xlib&quot; ;;
+	*) my_xabs=`pwd`&quot;/$my_xlib&quot; ;;
+      esac
+      func_basename &quot;$my_xlib&quot;
+      my_xlib=&quot;$func_basename_result&quot;
+      my_xlib_u=$my_xlib
+      while :; do
+        case &quot; $extracted_archives &quot; in
+	*&quot; $my_xlib_u &quot;*)
+	  func_arith $extracted_serial + 1
+	  extracted_serial=$func_arith_result
+	  my_xlib_u=lt$extracted_serial-$my_xlib ;;
+	*) break ;;
+	esac
+      done
+      extracted_archives=&quot;$extracted_archives $my_xlib_u&quot;
+      my_xdir=&quot;$my_gentop/$my_xlib_u&quot;
+
+      func_mkdir_p &quot;$my_xdir&quot;
+
+      case $host in
+      *-darwin*)
+	func_verbose &quot;Extracting $my_xabs&quot;
+	# Do not bother doing anything if just a dry run
+	$opt_dry_run || {
+	  darwin_orig_dir=`pwd`
+	  cd $my_xdir || exit $?
+	  darwin_archive=$my_xabs
+	  darwin_curdir=`pwd`
+	  darwin_base_archive=`basename &quot;$darwin_archive&quot;`
+	  darwin_arches=`$LIPO -info &quot;$darwin_archive&quot; 2&gt;/dev/null | $GREP Architectures 2&gt;/dev/null || true`
+	  if test -n &quot;$darwin_arches&quot;; then
+	    darwin_arches=`$ECHO &quot;$darwin_arches&quot; | $SED -e 's/.*<A HREF="are://">are://</A>'`
+	    darwin_arch=
+	    func_verbose &quot;$darwin_base_archive has multiple architectures $darwin_arches&quot;
+	    for darwin_arch in  $darwin_arches ; do
+	      func_mkdir_p &quot;unfat-$$/${darwin_base_archive}-${darwin_arch}&quot;
+	      $LIPO -thin $darwin_arch -output &quot;unfat-$$/${darwin_base_archive}-${darwin_arch}/${darwin_base_archive}&quot; &quot;${darwin_archive}&quot;
+	      cd &quot;unfat-$$/${darwin_base_archive}-${darwin_arch}&quot;
+	      func_extract_an_archive &quot;`pwd`&quot; &quot;${darwin_base_archive}&quot;
+	      cd &quot;$darwin_curdir&quot;
+	      $RM &quot;unfat-$$/${darwin_base_archive}-${darwin_arch}/${darwin_base_archive}&quot;
+	    done # $darwin_arches
+            ## Okay now we've a bunch of thin objects, gotta fatten them up :)
+	    darwin_filelist=`find unfat-$$ -type f -name \*.o -print -o -name \*.lo -print | $SED -e &quot;$basename&quot; | sort -u`
+	    darwin_file=
+	    darwin_files=
+	    for darwin_file in $darwin_filelist; do
+	      darwin_files=`find unfat-$$ -name $darwin_file -print | sort | $NL2SP`
+	      $LIPO -create -output &quot;$darwin_file&quot; $darwin_files
+	    done # $darwin_filelist
+	    $RM -rf unfat-$$
+	    cd &quot;$darwin_orig_dir&quot;
+	  else
+	    cd $darwin_orig_dir
+	    func_extract_an_archive &quot;$my_xdir&quot; &quot;$my_xabs&quot;
+	  fi # $darwin_arches
+	} # !$opt_dry_run
+	;;
+      *)
+        func_extract_an_archive &quot;$my_xdir&quot; &quot;$my_xabs&quot;
+	;;
+      esac
+      my_oldobjs=&quot;$my_oldobjs &quot;`find $my_xdir -name \*.$objext -print -o -name \*.lo -print | sort | $NL2SP`
+    done
+
+    func_extract_archives_result=&quot;$my_oldobjs&quot;
+}
+
+
+# func_emit_wrapper [arg=no]
+#
+# Emit a libtool wrapper script on stdout.
+# Don't directly open a file because we may want to
+# incorporate the script contents within a cygwin/mingw
+# wrapper executable.  Must ONLY be called from within
+# func_mode_link because it depends on a number of variables
+# set therein.
+#
+# ARG is the value that the WRAPPER_SCRIPT_BELONGS_IN_OBJDIR
+# variable will take.  If 'yes', then the emitted script
+# will assume that the directory in which it is stored is
+# the $objdir directory.  This is a cygwin/mingw-specific
+# behavior.
+func_emit_wrapper ()
+{
+	func_emit_wrapper_arg1=${1-no}
+
+	$ECHO &quot;\
+#! $SHELL
+
+# $output - temporary wrapper script for $objdir/$outputname
+# Generated by $PROGRAM (GNU $PACKAGE$TIMESTAMP) $VERSION
+#
+# The $output program cannot be directly executed until all the libtool
+# libraries that it depends on are installed.
+#
+# This wrapper script should never be moved out of the build directory.
+# If it is, it will not operate correctly.
+
+# Sed substitution that helps us do robust quoting.  It backslashifies
+# metacharacters that are still active within double-quoted strings.
+sed_quote_subst='$sed_quote_subst'
+
+# Be Bourne compatible
+if test -n \&quot;\${ZSH_VERSION+set}\&quot; &amp;&amp; (emulate sh) &gt;/dev/null 2&gt;&amp;1; then
+  emulate sh
+  NULLCMD=:
+  # Zsh 3.x and 4.x performs word splitting on \${1+\&quot;\$@\&quot;}, which
+  # is contrary to our usage.  Disable this feature.
+  alias -g '\${1+\&quot;\$@\&quot;}'='\&quot;\$@\&quot;'
+  setopt NO_GLOB_SUBST
+else
+  case \`(set -o) 2&gt;/dev/null\` in *posix*) set -o posix;; esac
+fi
+BIN_SH=xpg4; export BIN_SH # for Tru64
+DUALCASE=1; export DUALCASE # for MKS sh
+
+# The HP-UX ksh and POSIX shell print the target directory to stdout
+# if CDPATH is set.
+(unset CDPATH) &gt;/dev/null 2&gt;&amp;1 &amp;&amp; unset CDPATH
+
+relink_command=\&quot;$relink_command\&quot;
+
+# This environment variable determines our operation mode.
+if test \&quot;\$libtool_install_magic\&quot; = \&quot;$magic\&quot;; then
+  # install mode needs the following variables:
+  generated_by_libtool_version='$macro_version'
+  notinst_deplibs='$notinst_deplibs'
+else
+  # When we are sourced in execute mode, \$file and \$ECHO are already set.
+  if test \&quot;\$libtool_execute_magic\&quot; != \&quot;$magic\&quot;; then
+    file=\&quot;\$0\&quot;&quot;
+
+    qECHO=`$ECHO &quot;$ECHO&quot; | $SED &quot;$sed_quote_subst&quot;`
+    $ECHO &quot;\
+
+# A function that is used when there is no print builtin or printf.
+func_fallback_echo ()
+{
+  eval 'cat &lt;&lt;_LTECHO_EOF
+\$1
+_LTECHO_EOF'
+}
+    ECHO=\&quot;$qECHO\&quot;
+  fi
+
+# Very basic option parsing. These options are (a) specific to
+# the libtool wrapper, (b) are identical between the wrapper
+# /script/ and the wrapper /executable/ which is used only on
+# windows platforms, and (c) all begin with the string &quot;--lt-&quot;
+# (application programs are unlikely to have options which match
+# this pattern).
+#
+# There are only two supported options: --lt-debug and
+# --lt-dump-script. There is, deliberately, no --lt-help.
+#
+# The first argument to this parsing function should be the
+# script's $0 value, followed by &quot;$@&quot;.
+lt_option_debug=
+func_parse_lt_options ()
+{
+  lt_script_arg0=\$0
+  shift
+  for lt_opt
+  do
+    case \&quot;\$lt_opt\&quot; in
+    --lt-debug) lt_option_debug=1 ;;
+    --lt-dump-script)
+        lt_dump_D=\`\$ECHO \&quot;X\$lt_script_arg0\&quot; | $SED -e 's/^X//' -e 's%/[^/]*$%%'\`
+        test \&quot;X\$lt_dump_D\&quot; = \&quot;X\$lt_script_arg0\&quot; &amp;&amp; lt_dump_D=.
+        lt_dump_F=\`\$ECHO \&quot;X\$lt_script_arg0\&quot; | $SED -e 's/^X//' -e 's%^.*/%%'\`
+        cat \&quot;\$lt_dump_D/\$lt_dump_F\&quot;
+        exit 0
+      ;;
+    --lt-*)
+        \$ECHO \&quot;Unrecognized --lt- option: '\$lt_opt'\&quot; 1&gt;&amp;2
+        exit 1
+      ;;
+    esac
+  done
+
+  # Print the debug banner immediately:
+  if test -n \&quot;\$lt_option_debug\&quot;; then
+    echo \&quot;${outputname}:${output}:\${LINENO}: libtool wrapper (GNU $PACKAGE$TIMESTAMP) $VERSION\&quot; 1&gt;&amp;2
+  fi
+}
+
+# Used when --lt-debug. Prints its arguments to stdout
+# (redirection is the responsibility of the caller)
+func_lt_dump_args ()
+{
+  lt_dump_args_N=1;
+  for lt_arg
+  do
+    \$ECHO \&quot;${outputname}:${output}:\${LINENO}: newargv[\$lt_dump_args_N]: \$lt_arg\&quot;
+    lt_dump_args_N=\`expr \$lt_dump_args_N + 1\`
+  done
+}
+
+# Core function for launching the target application
+func_exec_program_core ()
+{
+&quot;
+  case $host in
+  # Backslashes separate directories on plain windows
+  *-*-mingw | *-*-os2* | *-cegcc*)
+    $ECHO &quot;\
+      if test -n \&quot;\$lt_option_debug\&quot;; then
+        \$ECHO \&quot;${outputname}:${output}:\${LINENO}: newargv[0]: \$progdir\\\\\$program\&quot; 1&gt;&amp;2
+        func_lt_dump_args \${1+\&quot;\$@\&quot;} 1&gt;&amp;2
       fi
+      exec \&quot;\$progdir\\\\\$program\&quot; \${1+\&quot;\$@\&quot;}
+&quot;
+    ;;
 
-      if test &quot;$no_install&quot; = yes; then
-	# We don't need to create a wrapper script.
-	link_command=&quot;$compile_var$compile_command$compile_rpath&quot;
-	# Replace the output file specification.
-	link_command=`$echo &quot;X$link_command&quot; | $Xsed -e 's%@OUTPUT@%'&quot;$output&quot;'%g'`
-	# Delete the old output file.
-	$run $rm $output
-	# Link the executable and exit
-	$show &quot;$link_command&quot;
-	$run eval &quot;$link_command&quot; || exit $?
-	exit 0
+  *)
+    $ECHO &quot;\
+      if test -n \&quot;\$lt_option_debug\&quot;; then
+        \$ECHO \&quot;${outputname}:${output}:\${LINENO}: newargv[0]: \$progdir/\$program\&quot; 1&gt;&amp;2
+        func_lt_dump_args \${1+\&quot;\$@\&quot;} 1&gt;&amp;2
       fi
+      exec \&quot;\$progdir/\$program\&quot; \${1+\&quot;\$@\&quot;}
+&quot;
+    ;;
+  esac
+  $ECHO &quot;\
+      \$ECHO \&quot;\$0: cannot exec \$program \$*\&quot; 1&gt;&amp;2
+      exit 1
+}
 
-      if test &quot;$hardcode_action&quot; = relink; then
-	# Fast installation is not supported
-	link_command=&quot;$compile_var$compile_command$compile_rpath&quot;
-	relink_command=&quot;$finalize_var$finalize_command$finalize_rpath&quot;
+# A function to encapsulate launching the target application
+# Strips options in the --lt-* namespace from \$@ and
+# launches target application with the remaining arguments.
+func_exec_program ()
+{
+  for lt_wr_arg
+  do
+    case \$lt_wr_arg in
+    --lt-*) ;;
+    *) set x \&quot;\$@\&quot; \&quot;\$lt_wr_arg\&quot;; shift;;
+    esac
+    shift
+  done
+  func_exec_program_core \${1+\&quot;\$@\&quot;}
+}
+
+  # Parse options
+  func_parse_lt_options \&quot;\$0\&quot; \${1+\&quot;\$@\&quot;}
+
+  # Find the directory that this script lives in.
+  thisdir=\`\$ECHO \&quot;\$file\&quot; | $SED 's%/[^/]*$%%'\`
+  test \&quot;x\$thisdir\&quot; = \&quot;x\$file\&quot; &amp;&amp; thisdir=.
+
+  # Follow symbolic links until we get to the real thisdir.
+  file=\`ls -ld \&quot;\$file\&quot; | $SED -n 's/.*-&gt; //p'\`
+  while test -n \&quot;\$file\&quot;; do
+    destdir=\`\$ECHO \&quot;\$file\&quot; | $SED 's%/[^/]*\$%%'\`
+
+    # If there was a directory component, then change thisdir.
+    if test \&quot;x\$destdir\&quot; != \&quot;x\$file\&quot;; then
+      case \&quot;\$destdir\&quot; in
+      [\\\\/]* | [A-Za-z]:[\\\\/]*) thisdir=\&quot;\$destdir\&quot; ;;
+      *) thisdir=\&quot;\$thisdir/\$destdir\&quot; ;;
+      esac
+    fi
+
+    file=\`\$ECHO \&quot;\$file\&quot; | $SED 's%^.*/%%'\`
+    file=\`ls -ld \&quot;\$thisdir/\$file\&quot; | $SED -n 's/.*-&gt; //p'\`
+  done
+
+  # Usually 'no', except on cygwin/mingw when embedded into
+  # the cwrapper.
+  WRAPPER_SCRIPT_BELONGS_IN_OBJDIR=$func_emit_wrapper_arg1
+  if test \&quot;\$WRAPPER_SCRIPT_BELONGS_IN_OBJDIR\&quot; = \&quot;yes\&quot;; then
+    # special case for '.'
+    if test \&quot;\$thisdir\&quot; = \&quot;.\&quot;; then
+      thisdir=\`pwd\`
+    fi
+    # remove .libs from thisdir
+    case \&quot;\$thisdir\&quot; in
+    *[\\\\/]$objdir ) thisdir=\`\$ECHO \&quot;\$thisdir\&quot; | $SED 's%[\\\\/][^\\\\/]*$%%'\` ;;
+    $objdir )   thisdir=. ;;
+    esac
+  fi
+
+  # Try to get the absolute directory name.
+  absdir=\`cd \&quot;\$thisdir\&quot; &amp;&amp; pwd\`
+  test -n \&quot;\$absdir\&quot; &amp;&amp; thisdir=\&quot;\$absdir\&quot;
+&quot;
+
+	if test &quot;$fast_install&quot; = yes; then
+	  $ECHO &quot;\
+  program=lt-'$outputname'$exeext
+  progdir=\&quot;\$thisdir/$objdir\&quot;
+
+  if test ! -f \&quot;\$progdir/\$program\&quot; ||
+     { file=\`ls -1dt \&quot;\$progdir/\$program\&quot; \&quot;\$progdir/../\$program\&quot; 2&gt;/dev/null | ${SED} 1q\`; \\
+       test \&quot;X\$file\&quot; != \&quot;X\$progdir/\$program\&quot;; }; then
+
+    file=\&quot;\$\$-\$program\&quot;
+
+    if test ! -d \&quot;\$progdir\&quot;; then
+      $MKDIR \&quot;\$progdir\&quot;
+    else
+      $RM \&quot;\$progdir/\$file\&quot;
+    fi&quot;
+
+	  $ECHO &quot;\
 
-	$echo &quot;$modename: warning: this platform does not like uninstalled shared libraries&quot; 1&gt;&amp;2
-	$echo &quot;$modename: \`$output' will be relinked during installation&quot; 1&gt;&amp;2
+    # relink executable if necessary
+    if test -n \&quot;\$relink_command\&quot;; then
+      if relink_command_output=\`eval \$relink_command 2&gt;&amp;1\`; then :
       else
-	if test &quot;$fast_install&quot; != no; then
-	  link_command=&quot;$finalize_var$compile_command$finalize_rpath&quot;
-	  if test &quot;$fast_install&quot; = yes; then
-	    relink_command=`$echo &quot;X$compile_var$compile_command$compile_rpath&quot; | $Xsed -e 's%@OUTPUT@%\$progdir/\$file%g'`
-	  else
-	    # fast_install is set to needless
-	    relink_command=
-	  fi
+	$ECHO \&quot;\$relink_command_output\&quot; &gt;&amp;2
+	$RM \&quot;\$progdir/\$file\&quot;
+	exit 1
+      fi
+    fi
+
+    $MV \&quot;\$progdir/\$file\&quot; \&quot;\$progdir/\$program\&quot; 2&gt;/dev/null ||
+    { $RM \&quot;\$progdir/\$program\&quot;;
+      $MV \&quot;\$progdir/\$file\&quot; \&quot;\$progdir/\$program\&quot;; }
+    $RM \&quot;\$progdir/\$file\&quot;
+  fi&quot;
 	else
-	  link_command=&quot;$compile_var$compile_command$compile_rpath&quot;
-	  relink_command=&quot;$finalize_var$finalize_command$finalize_rpath&quot;
+	  $ECHO &quot;\
+  program='$outputname'
+  progdir=\&quot;\$thisdir/$objdir\&quot;
+&quot;
 	fi
-      fi
 
-      # Replace the output file specification.
-      link_command=`$echo &quot;X$link_command&quot; | $Xsed -e 's%@OUTPUT@%'&quot;$output_objdir/$outputname&quot;'%g'`
+	$ECHO &quot;\
 
-      # Delete the old output files.
-      $run $rm $output $output_objdir/$outputname $output_objdir/lt-$outputname
+  if test -f \&quot;\$progdir/\$program\&quot;; then&quot;
 
-      $show &quot;$link_command&quot;
-      $run eval &quot;$link_command&quot; || exit $?
+	# fixup the dll searchpath if we need to.
+	#
+	# Fix the DLL searchpath if we need to.  Do this before prepending
+	# to shlibpath, because on Windows, both are PATH and uninstalled
+	# libraries must come first.
+	if test -n &quot;$dllsearchpath&quot;; then
+	  $ECHO &quot;\
+    # Add the dll search path components to the executable PATH
+    PATH=$dllsearchpath:\$PATH
+&quot;
+	fi
 
-      # Now create the wrapper script.
-      $show &quot;creating $output&quot;
+	# Export our shlibpath_var if we have one.
+	if test &quot;$shlibpath_overrides_runpath&quot; = yes &amp;&amp; test -n &quot;$shlibpath_var&quot; &amp;&amp; test -n &quot;$temp_rpath&quot;; then
+	  $ECHO &quot;\
+    # Add our own library path to $shlibpath_var
+    $shlibpath_var=\&quot;$temp_rpath\$$shlibpath_var\&quot;
 
-      # Quote the relink command for shipping.
-      if test -n &quot;$relink_command&quot;; then
-	# Preserve any variables that may affect compiler behavior
-	for var in $variables_saved_for_relink; do
-	  if eval test -z \&quot;\${$var+set}\&quot;; then
-	    relink_command=&quot;{ test -z \&quot;\${$var+set}\&quot; || unset $var || { $var=; export $var; }; }; $relink_command&quot;
-	  elif eval var_value=\$$var; test -z &quot;$var_value&quot;; then
-	    relink_command=&quot;$var=; export $var; $relink_command&quot;
+    # Some systems cannot cope with colon-terminated $shlibpath_var
+    # The second colon is a workaround for a bug in BeOS R4 sed
+    $shlibpath_var=\`\$ECHO \&quot;\$$shlibpath_var\&quot; | $SED 's/::*\$//'\`
+
+    export $shlibpath_var
+&quot;
+	fi
+
+	$ECHO &quot;\
+    if test \&quot;\$libtool_execute_magic\&quot; != \&quot;$magic\&quot;; then
+      # Run the actual program with our arguments.
+      func_exec_program \${1+\&quot;\$@\&quot;}
+    fi
+  else
+    # The program doesn't exist.
+    \$ECHO \&quot;\$0: error: \\\`\$progdir/\$program' does not exist\&quot; 1&gt;&amp;2
+    \$ECHO \&quot;This script is just a wrapper for \$program.\&quot; 1&gt;&amp;2
+    \$ECHO \&quot;See the $PACKAGE documentation for more information.\&quot; 1&gt;&amp;2
+    exit 1
+  fi
+fi\
+&quot;
+}
+
+
+# func_emit_cwrapperexe_src
+# emit the source code for a wrapper executable on stdout
+# Must ONLY be called from within func_mode_link because
+# it depends on a number of variable set therein.
+func_emit_cwrapperexe_src ()
+{
+	cat &lt;&lt;EOF
+
+/* $cwrappersource - temporary wrapper executable for $objdir/$outputname
+   Generated by $PROGRAM (GNU $PACKAGE$TIMESTAMP) $VERSION
+
+   The $output program cannot be directly executed until all the libtool
+   libraries that it depends on are installed.
+
+   This wrapper executable should never be moved out of the build directory.
+   If it is, it will not operate correctly.
+*/
+EOF
+	    cat &lt;&lt;&quot;EOF&quot;
+#ifdef _MSC_VER
+# define _CRT_SECURE_NO_DEPRECATE 1
+#endif
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#ifdef _MSC_VER
+# include &lt;direct.h&gt;
+# include &lt;process.h&gt;
+# include &lt;io.h&gt;
+#else
+# include &lt;unistd.h&gt;
+# include &lt;stdint.h&gt;
+# ifdef __CYGWIN__
+#  include &lt;io.h&gt;
+# endif
+#endif
+#include &lt;malloc.h&gt;
+#include &lt;stdarg.h&gt;
+#include &lt;assert.h&gt;
+#include &lt;string.h&gt;
+#include &lt;ctype.h&gt;
+#include &lt;errno.h&gt;
+#include &lt;fcntl.h&gt;
+#include &lt;sys/stat.h&gt;
+
+/* declarations of non-ANSI functions */
+#if defined(__MINGW32__)
+# ifdef __STRICT_ANSI__
+int _putenv (const char *);
+# endif
+#elif defined(__CYGWIN__)
+# ifdef __STRICT_ANSI__
+char *realpath (const char *, char *);
+int putenv (char *);
+int setenv (const char *, const char *, int);
+# endif
+/* #elif defined (other platforms) ... */
+#endif
+
+/* portability defines, excluding path handling macros */
+#if defined(_MSC_VER)
+# define setmode _setmode
+# define stat    _stat
+# define chmod   _chmod
+# define getcwd  _getcwd
+# define putenv  _putenv
+# define S_IXUSR _S_IEXEC
+# ifndef _INTPTR_T_DEFINED
+#  define _INTPTR_T_DEFINED
+#  define intptr_t int
+# endif
+#elif defined(__MINGW32__)
+# define setmode _setmode
+# define stat    _stat
+# define chmod   _chmod
+# define getcwd  _getcwd
+# define putenv  _putenv
+#elif defined(__CYGWIN__)
+# define HAVE_SETENV
+# define FOPEN_WB &quot;wb&quot;
+/* #elif defined (other platforms) ... */
+#endif
+
+#if defined(PATH_MAX)
+# define LT_PATHMAX PATH_MAX
+#elif defined(MAXPATHLEN)
+# define LT_PATHMAX MAXPATHLEN
+#else
+# define LT_PATHMAX 1024
+#endif
+
+#ifndef S_IXOTH
+# define S_IXOTH 0
+#endif
+#ifndef S_IXGRP
+# define S_IXGRP 0
+#endif
+
+/* path handling portability macros */
+#ifndef DIR_SEPARATOR
+# define DIR_SEPARATOR '/'
+# define PATH_SEPARATOR ':'
+#endif
+
+#if defined (_WIN32) || defined (__MSDOS__) || defined (__DJGPP__) || \
+  defined (__OS2__)
+# define HAVE_DOS_BASED_FILE_SYSTEM
+# define FOPEN_WB &quot;wb&quot;
+# ifndef DIR_SEPARATOR_2
+#  define DIR_SEPARATOR_2 '\\'
+# endif
+# ifndef PATH_SEPARATOR_2
+#  define PATH_SEPARATOR_2 ';'
+# endif
+#endif
+
+#ifndef DIR_SEPARATOR_2
+# define IS_DIR_SEPARATOR(ch) ((ch) == DIR_SEPARATOR)
+#else /* DIR_SEPARATOR_2 */
+# define IS_DIR_SEPARATOR(ch) \
+	(((ch) == DIR_SEPARATOR) || ((ch) == DIR_SEPARATOR_2))
+#endif /* DIR_SEPARATOR_2 */
+
+#ifndef PATH_SEPARATOR_2
+# define IS_PATH_SEPARATOR(ch) ((ch) == PATH_SEPARATOR)
+#else /* PATH_SEPARATOR_2 */
+# define IS_PATH_SEPARATOR(ch) ((ch) == PATH_SEPARATOR_2)
+#endif /* PATH_SEPARATOR_2 */
+
+#ifndef FOPEN_WB
+# define FOPEN_WB &quot;w&quot;
+#endif
+#ifndef _O_BINARY
+# define _O_BINARY 0
+#endif
+
+#define XMALLOC(type, num)      ((type *) xmalloc ((num) * sizeof(type)))
+#define XFREE(stale) do { \
+  if (stale) { free ((void *) stale); stale = 0; } \
+} while (0)
+
+#if defined(LT_DEBUGWRAPPER)
+static int lt_debug = 1;
+#else
+static int lt_debug = 0;
+#endif
+
+const char *program_name = &quot;libtool-wrapper&quot;; /* in case xstrdup fails */
+
+void *xmalloc (size_t num);
+char *xstrdup (const char *string);
+const char *base_name (const char *name);
+char *find_executable (const char *wrapper);
+char *chase_symlinks (const char *pathspec);
+int make_executable (const char *path);
+int check_executable (const char *path);
+char *strendzap (char *str, const char *pat);
+void lt_debugprintf (const char *file, int line, const char *fmt, ...);
+void lt_fatal (const char *file, int line, const char *message, ...);
+static const char *nonnull (const char *s);
+static const char *nonempty (const char *s);
+void lt_setenv (const char *name, const char *value);
+char *lt_extend_str (const char *orig_value, const char *add, int to_end);
+void lt_update_exe_path (const char *name, const char *value);
+void lt_update_lib_path (const char *name, const char *value);
+char **prepare_spawn (char **argv);
+void lt_dump_script (FILE *f);
+EOF
+
+	    cat &lt;&lt;EOF
+volatile const char * MAGIC_EXE = &quot;$magic_exe&quot;;
+const char * LIB_PATH_VARNAME = &quot;$shlibpath_var&quot;;
+EOF
+
+	    if test &quot;$shlibpath_overrides_runpath&quot; = yes &amp;&amp; test -n &quot;$shlibpath_var&quot; &amp;&amp; test -n &quot;$temp_rpath&quot;; then
+              func_to_host_path &quot;$temp_rpath&quot;
+	      cat &lt;&lt;EOF
+const char * LIB_PATH_VALUE   = &quot;$func_to_host_path_result&quot;;
+EOF
+	    else
+	      cat &lt;&lt;&quot;EOF&quot;
+const char * LIB_PATH_VALUE   = &quot;&quot;;
+EOF
+	    fi
+
+	    if test -n &quot;$dllsearchpath&quot;; then
+              func_to_host_path &quot;$dllsearchpath:&quot;
+	      cat &lt;&lt;EOF
+const char * EXE_PATH_VARNAME = &quot;PATH&quot;;
+const char * EXE_PATH_VALUE   = &quot;$func_to_host_path_result&quot;;
+EOF
+	    else
+	      cat &lt;&lt;&quot;EOF&quot;
+const char * EXE_PATH_VARNAME = &quot;&quot;;
+const char * EXE_PATH_VALUE   = &quot;&quot;;
+EOF
+	    fi
+
+	    if test &quot;$fast_install&quot; = yes; then
+	      cat &lt;&lt;EOF
+const char * TARGET_PROGRAM_NAME = &quot;lt-$outputname&quot;; /* hopefully, no .exe */
+EOF
+	    else
+	      cat &lt;&lt;EOF
+const char * TARGET_PROGRAM_NAME = &quot;$outputname&quot;; /* hopefully, no .exe */
+EOF
+	    fi
+
+
+	    cat &lt;&lt;&quot;EOF&quot;
+
+#define LTWRAPPER_OPTION_PREFIX         &quot;--lt-&quot;
+
+static const char *ltwrapper_option_prefix = LTWRAPPER_OPTION_PREFIX;
+static const char *dumpscript_opt       = LTWRAPPER_OPTION_PREFIX &quot;dump-script&quot;;
+static const char *debug_opt            = LTWRAPPER_OPTION_PREFIX &quot;debug&quot;;
+
+int
+main (int argc, char *argv[])
+{
+  char **newargz;
+  int  newargc;
+  char *tmp_pathspec;
+  char *actual_cwrapper_path;
+  char *actual_cwrapper_name;
+  char *target_name;
+  char *lt_argv_zero;
+  intptr_t rval = 127;
+
+  int i;
+
+  program_name = (char *) xstrdup (base_name (argv[0]));
+  newargz = XMALLOC (char *, argc + 1);
+
+  /* very simple arg parsing; don't want to rely on getopt
+   * also, copy all non cwrapper options to newargz, except
+   * argz[0], which is handled differently
+   */
+  newargc=0;
+  for (i = 1; i &lt; argc; i++)
+    {
+      if (strcmp (argv[i], dumpscript_opt) == 0)
+	{
+EOF
+	    case &quot;$host&quot; in
+	      *mingw* | *cygwin* )
+		# make stdout use &quot;unix&quot; line endings
+		echo &quot;          setmode(1,_O_BINARY);&quot;
+		;;
+	      esac
+
+	    cat &lt;&lt;&quot;EOF&quot;
+	  lt_dump_script (stdout);
+	  return 0;
+	}
+      if (strcmp (argv[i], debug_opt) == 0)
+	{
+          lt_debug = 1;
+          continue;
+	}
+      if (strcmp (argv[i], ltwrapper_option_prefix) == 0)
+        {
+          /* however, if there is an option in the LTWRAPPER_OPTION_PREFIX
+             namespace, but it is not one of the ones we know about and
+             have already dealt with, above (inluding dump-script), then
+             report an error. Otherwise, targets might begin to believe
+             they are allowed to use options in the LTWRAPPER_OPTION_PREFIX
+             namespace. The first time any user complains about this, we'll
+             need to make LTWRAPPER_OPTION_PREFIX a configure-time option
+             or a configure.ac-settable value.
+           */
+          lt_fatal (__FILE__, __LINE__,
+		    &quot;unrecognized %s option: '%s'&quot;,
+                    ltwrapper_option_prefix, argv[i]);
+        }
+      /* otherwise ... */
+      newargz[++newargc] = xstrdup (argv[i]);
+    }
+  newargz[++newargc] = NULL;
+
+EOF
+	    cat &lt;&lt;EOF
+  /* The GNU banner must be the first non-error debug message */
+  lt_debugprintf (__FILE__, __LINE__, &quot;libtool wrapper (GNU $PACKAGE$TIMESTAMP) $VERSION\n&quot;);
+EOF
+	    cat &lt;&lt;&quot;EOF&quot;
+  lt_debugprintf (__FILE__, __LINE__, &quot;(main) argv[0]: %s\n&quot;, argv[0]);
+  lt_debugprintf (__FILE__, __LINE__, &quot;(main) program_name: %s\n&quot;, program_name);
+
+  tmp_pathspec = find_executable (argv[0]);
+  if (tmp_pathspec == NULL)
+    lt_fatal (__FILE__, __LINE__, &quot;couldn't find %s&quot;, argv[0]);
+  lt_debugprintf (__FILE__, __LINE__,
+                  &quot;(main) found exe (before symlink chase) at: %s\n&quot;,
+		  tmp_pathspec);
+
+  actual_cwrapper_path = chase_symlinks (tmp_pathspec);
+  lt_debugprintf (__FILE__, __LINE__,
+                  &quot;(main) found exe (after symlink chase) at: %s\n&quot;,
+		  actual_cwrapper_path);
+  XFREE (tmp_pathspec);
+
+  actual_cwrapper_name = xstrdup (base_name (actual_cwrapper_path));
+  strendzap (actual_cwrapper_path, actual_cwrapper_name);
+
+  /* wrapper name transforms */
+  strendzap (actual_cwrapper_name, &quot;.exe&quot;);
+  tmp_pathspec = lt_extend_str (actual_cwrapper_name, &quot;.exe&quot;, 1);
+  XFREE (actual_cwrapper_name);
+  actual_cwrapper_name = tmp_pathspec;
+  tmp_pathspec = 0;
+
+  /* target_name transforms -- use actual target program name; might have lt- prefix */
+  target_name = xstrdup (base_name (TARGET_PROGRAM_NAME));
+  strendzap (target_name, &quot;.exe&quot;);
+  tmp_pathspec = lt_extend_str (target_name, &quot;.exe&quot;, 1);
+  XFREE (target_name);
+  target_name = tmp_pathspec;
+  tmp_pathspec = 0;
+
+  lt_debugprintf (__FILE__, __LINE__,
+		  &quot;(main) libtool target name: %s\n&quot;,
+		  target_name);
+EOF
+
+	    cat &lt;&lt;EOF
+  newargz[0] =
+    XMALLOC (char, (strlen (actual_cwrapper_path) +
+		    strlen (&quot;$objdir&quot;) + 1 + strlen (actual_cwrapper_name) + 1));
+  strcpy (newargz[0], actual_cwrapper_path);
+  strcat (newargz[0], &quot;$objdir&quot;);
+  strcat (newargz[0], &quot;/&quot;);
+EOF
+
+	    cat &lt;&lt;&quot;EOF&quot;
+  /* stop here, and copy so we don't have to do this twice */
+  tmp_pathspec = xstrdup (newargz[0]);
+
+  /* do NOT want the lt- prefix here, so use actual_cwrapper_name */
+  strcat (newargz[0], actual_cwrapper_name);
+
+  /* DO want the lt- prefix here if it exists, so use target_name */
+  lt_argv_zero = lt_extend_str (tmp_pathspec, target_name, 1);
+  XFREE (tmp_pathspec);
+  tmp_pathspec = NULL;
+EOF
+
+	    case $host_os in
+	      mingw*)
+	    cat &lt;&lt;&quot;EOF&quot;
+  {
+    char* p;
+    while ((p = strchr (newargz[0], '\\')) != NULL)
+      {
+	*p = '/';
+      }
+    while ((p = strchr (lt_argv_zero, '\\')) != NULL)
+      {
+	*p = '/';
+      }
+  }
+EOF
+	    ;;
+	    esac
+
+	    cat &lt;&lt;&quot;EOF&quot;
+  XFREE (target_name);
+  XFREE (actual_cwrapper_path);
+  XFREE (actual_cwrapper_name);
+
+  lt_setenv (&quot;BIN_SH&quot;, &quot;xpg4&quot;); /* for Tru64 */
+  lt_setenv (&quot;DUALCASE&quot;, &quot;1&quot;);  /* for MSK sh */
+  /* Update the DLL searchpath.  EXE_PATH_VALUE ($dllsearchpath) must
+     be prepended before (that is, appear after) LIB_PATH_VALUE ($temp_rpath)
+     because on Windows, both *_VARNAMEs are PATH but uninstalled
+     libraries must come first. */
+  lt_update_exe_path (EXE_PATH_VARNAME, EXE_PATH_VALUE);
+  lt_update_lib_path (LIB_PATH_VARNAME, LIB_PATH_VALUE);
+
+  lt_debugprintf (__FILE__, __LINE__, &quot;(main) lt_argv_zero: %s\n&quot;,
+		  nonnull (lt_argv_zero));
+  for (i = 0; i &lt; newargc; i++)
+    {
+      lt_debugprintf (__FILE__, __LINE__, &quot;(main) newargz[%d]: %s\n&quot;,
+		      i, nonnull (newargz[i]));
+    }
+
+EOF
+
+	    case $host_os in
+	      mingw*)
+		cat &lt;&lt;&quot;EOF&quot;
+  /* execv doesn't actually work on mingw as expected on unix */
+  newargz = prepare_spawn (newargz);
+  rval = _spawnv (_P_WAIT, lt_argv_zero, (const char * const *) newargz);
+  if (rval == -1)
+    {
+      /* failed to start process */
+      lt_debugprintf (__FILE__, __LINE__,
+		      &quot;(main) failed to launch target \&quot;%s\&quot;: %s\n&quot;,
+		      lt_argv_zero, nonnull (strerror (errno)));
+      return 127;
+    }
+  return rval;
+EOF
+		;;
+	      *)
+		cat &lt;&lt;&quot;EOF&quot;
+  execv (lt_argv_zero, newargz);
+  return rval; /* =127, but avoids unused variable warning */
+EOF
+		;;
+	    esac
+
+	    cat &lt;&lt;&quot;EOF&quot;
+}
+
+void *
+xmalloc (size_t num)
+{
+  void *p = (void *) malloc (num);
+  if (!p)
+    lt_fatal (__FILE__, __LINE__, &quot;memory exhausted&quot;);
+
+  return p;
+}
+
+char *
+xstrdup (const char *string)
+{
+  return string ? strcpy ((char *) xmalloc (strlen (string) + 1),
+			  string) : NULL;
+}
+
+const char *
+base_name (const char *name)
+{
+  const char *base;
+
+#if defined (HAVE_DOS_BASED_FILE_SYSTEM)
+  /* Skip over the disk name in MSDOS pathnames. */
+  if (isalpha ((unsigned char) name[0]) &amp;&amp; name[1] == ':')
+    name += 2;
+#endif
+
+  for (base = name; *name; name++)
+    if (IS_DIR_SEPARATOR (*name))
+      base = name + 1;
+  return base;
+}
+
+int
+check_executable (const char *path)
+{
+  struct stat st;
+
+  lt_debugprintf (__FILE__, __LINE__, &quot;(check_executable): %s\n&quot;,
+                  nonempty (path));
+  if ((!path) || (!*path))
+    return 0;
+
+  if ((stat (path, &amp;st) &gt;= 0)
+      &amp;&amp; (st.st_mode &amp; (S_IXUSR | S_IXGRP | S_IXOTH)))
+    return 1;
+  else
+    return 0;
+}
+
+int
+make_executable (const char *path)
+{
+  int rval = 0;
+  struct stat st;
+
+  lt_debugprintf (__FILE__, __LINE__, &quot;(make_executable): %s\n&quot;,
+                  nonempty (path));
+  if ((!path) || (!*path))
+    return 0;
+
+  if (stat (path, &amp;st) &gt;= 0)
+    {
+      rval = chmod (path, st.st_mode | S_IXOTH | S_IXGRP | S_IXUSR);
+    }
+  return rval;
+}
+
+/* Searches for the full path of the wrapper.  Returns
+   newly allocated full path name if found, NULL otherwise
+   Does not chase symlinks, even on platforms that support them.
+*/
+char *
+find_executable (const char *wrapper)
+{
+  int has_slash = 0;
+  const char *p;
+  const char *p_next;
+  /* static buffer for getcwd */
+  char tmp[LT_PATHMAX + 1];
+  int tmp_len;
+  char *concat_name;
+
+  lt_debugprintf (__FILE__, __LINE__, &quot;(find_executable): %s\n&quot;,
+                  nonempty (wrapper));
+
+  if ((wrapper == NULL) || (*wrapper == '\0'))
+    return NULL;
+
+  /* Absolute path? */
+#if defined (HAVE_DOS_BASED_FILE_SYSTEM)
+  if (isalpha ((unsigned char) wrapper[0]) &amp;&amp; wrapper[1] == ':')
+    {
+      concat_name = xstrdup (wrapper);
+      if (check_executable (concat_name))
+	return concat_name;
+      XFREE (concat_name);
+    }
+  else
+    {
+#endif
+      if (IS_DIR_SEPARATOR (wrapper[0]))
+	{
+	  concat_name = xstrdup (wrapper);
+	  if (check_executable (concat_name))
+	    return concat_name;
+	  XFREE (concat_name);
+	}
+#if defined (HAVE_DOS_BASED_FILE_SYSTEM)
+    }
+#endif
+
+  for (p = wrapper; *p; p++)
+    if (*p == '/')
+      {
+	has_slash = 1;
+	break;
+      }
+  if (!has_slash)
+    {
+      /* no slashes; search PATH */
+      const char *path = getenv (&quot;PATH&quot;);
+      if (path != NULL)
+	{
+	  for (p = path; *p; p = p_next)
+	    {
+	      const char *q;
+	      size_t p_len;
+	      for (q = p; *q; q++)
+		if (IS_PATH_SEPARATOR (*q))
+		  break;
+	      p_len = q - p;
+	      p_next = (*q == '\0' ? q : q + 1);
+	      if (p_len == 0)
+		{
+		  /* empty path: current directory */
+		  if (getcwd (tmp, LT_PATHMAX) == NULL)
+		    lt_fatal (__FILE__, __LINE__, &quot;getcwd failed: %s&quot;,
+                              nonnull (strerror (errno)));
+		  tmp_len = strlen (tmp);
+		  concat_name =
+		    XMALLOC (char, tmp_len + 1 + strlen (wrapper) + 1);
+		  memcpy (concat_name, tmp, tmp_len);
+		  concat_name[tmp_len] = '/';
+		  strcpy (concat_name + tmp_len + 1, wrapper);
+		}
+	      else
+		{
+		  concat_name =
+		    XMALLOC (char, p_len + 1 + strlen (wrapper) + 1);
+		  memcpy (concat_name, p, p_len);
+		  concat_name[p_len] = '/';
+		  strcpy (concat_name + p_len + 1, wrapper);
+		}
+	      if (check_executable (concat_name))
+		return concat_name;
+	      XFREE (concat_name);
+	    }
+	}
+      /* not found in PATH; assume curdir */
+    }
+  /* Relative path | not found in path: prepend cwd */
+  if (getcwd (tmp, LT_PATHMAX) == NULL)
+    lt_fatal (__FILE__, __LINE__, &quot;getcwd failed: %s&quot;,
+              nonnull (strerror (errno)));
+  tmp_len = strlen (tmp);
+  concat_name = XMALLOC (char, tmp_len + 1 + strlen (wrapper) + 1);
+  memcpy (concat_name, tmp, tmp_len);
+  concat_name[tmp_len] = '/';
+  strcpy (concat_name + tmp_len + 1, wrapper);
+
+  if (check_executable (concat_name))
+    return concat_name;
+  XFREE (concat_name);
+  return NULL;
+}
+
+char *
+chase_symlinks (const char *pathspec)
+{
+#ifndef S_ISLNK
+  return xstrdup (pathspec);
+#else
+  char buf[LT_PATHMAX];
+  struct stat s;
+  char *tmp_pathspec = xstrdup (pathspec);
+  char *p;
+  int has_symlinks = 0;
+  while (strlen (tmp_pathspec) &amp;&amp; !has_symlinks)
+    {
+      lt_debugprintf (__FILE__, __LINE__,
+		      &quot;checking path component for symlinks: %s\n&quot;,
+		      tmp_pathspec);
+      if (lstat (tmp_pathspec, &amp;s) == 0)
+	{
+	  if (S_ISLNK (s.st_mode) != 0)
+	    {
+	      has_symlinks = 1;
+	      break;
+	    }
+
+	  /* search backwards for last DIR_SEPARATOR */
+	  p = tmp_pathspec + strlen (tmp_pathspec) - 1;
+	  while ((p &gt; tmp_pathspec) &amp;&amp; (!IS_DIR_SEPARATOR (*p)))
+	    p--;
+	  if ((p == tmp_pathspec) &amp;&amp; (!IS_DIR_SEPARATOR (*p)))
+	    {
+	      /* no more DIR_SEPARATORS left */
+	      break;
+	    }
+	  *p = '\0';
+	}
+      else
+	{
+	  lt_fatal (__FILE__, __LINE__,
+		    &quot;error accessing file \&quot;%s\&quot;: %s&quot;,
+		    tmp_pathspec, nonnull (strerror (errno)));
+	}
+    }
+  XFREE (tmp_pathspec);
+
+  if (!has_symlinks)
+    {
+      return xstrdup (pathspec);
+    }
+
+  tmp_pathspec = realpath (pathspec, buf);
+  if (tmp_pathspec == 0)
+    {
+      lt_fatal (__FILE__, __LINE__,
+		&quot;could not follow symlinks for %s&quot;, pathspec);
+    }
+  return xstrdup (tmp_pathspec);
+#endif
+}
+
+char *
+strendzap (char *str, const char *pat)
+{
+  size_t len, patlen;
+
+  assert (str != NULL);
+  assert (pat != NULL);
+
+  len = strlen (str);
+  patlen = strlen (pat);
+
+  if (patlen &lt;= len)
+    {
+      str += len - patlen;
+      if (strcmp (str, pat) == 0)
+	*str = '\0';
+    }
+  return str;
+}
+
+void
+lt_debugprintf (const char *file, int line, const char *fmt, ...)
+{
+  va_list args;
+  if (lt_debug)
+    {
+      (void) fprintf (stderr, &quot;%s:%s:%d: &quot;, program_name, file, line);
+      va_start (args, fmt);
+      (void) vfprintf (stderr, fmt, args);
+      va_end (args);
+    }
+}
+
+static void
+lt_error_core (int exit_status, const char *file,
+	       int line, const char *mode,
+	       const char *message, va_list ap)
+{
+  fprintf (stderr, &quot;%s:%s:%d: %s: &quot;, program_name, file, line, mode);
+  vfprintf (stderr, message, ap);
+  fprintf (stderr, &quot;.\n&quot;);
+
+  if (exit_status &gt;= 0)
+    exit (exit_status);
+}
+
+void
+lt_fatal (const char *file, int line, const char *message, ...)
+{
+  va_list ap;
+  va_start (ap, message);
+  lt_error_core (EXIT_FAILURE, file, line, &quot;FATAL&quot;, message, ap);
+  va_end (ap);
+}
+
+static const char *
+nonnull (const char *s)
+{
+  return s ? s : &quot;(null)&quot;;
+}
+
+static const char *
+nonempty (const char *s)
+{
+  return (s &amp;&amp; !*s) ? &quot;(empty)&quot; : nonnull (s);
+}
+
+void
+lt_setenv (const char *name, const char *value)
+{
+  lt_debugprintf (__FILE__, __LINE__,
+		  &quot;(lt_setenv) setting '%s' to '%s'\n&quot;,
+                  nonnull (name), nonnull (value));
+  {
+#ifdef HAVE_SETENV
+    /* always make a copy, for consistency with !HAVE_SETENV */
+    char *str = xstrdup (value);
+    setenv (name, str, 1);
+#else
+    int len = strlen (name) + 1 + strlen (value) + 1;
+    char *str = XMALLOC (char, len);
+    sprintf (str, &quot;%s=%s&quot;, name, value);
+    if (putenv (str) != EXIT_SUCCESS)
+      {
+        XFREE (str);
+      }
+#endif
+  }
+}
+
+char *
+lt_extend_str (const char *orig_value, const char *add, int to_end)
+{
+  char *new_value;
+  if (orig_value &amp;&amp; *orig_value)
+    {
+      int orig_value_len = strlen (orig_value);
+      int add_len = strlen (add);
+      new_value = XMALLOC (char, add_len + orig_value_len + 1);
+      if (to_end)
+        {
+          strcpy (new_value, orig_value);
+          strcpy (new_value + orig_value_len, add);
+        }
+      else
+        {
+          strcpy (new_value, add);
+          strcpy (new_value + add_len, orig_value);
+        }
+    }
+  else
+    {
+      new_value = xstrdup (add);
+    }
+  return new_value;
+}
+
+void
+lt_update_exe_path (const char *name, const char *value)
+{
+  lt_debugprintf (__FILE__, __LINE__,
+		  &quot;(lt_update_exe_path) modifying '%s' by prepending '%s'\n&quot;,
+                  nonnull (name), nonnull (value));
+
+  if (name &amp;&amp; *name &amp;&amp; value &amp;&amp; *value)
+    {
+      char *new_value = lt_extend_str (getenv (name), value, 0);
+      /* some systems can't cope with a ':'-terminated path #' */
+      int len = strlen (new_value);
+      while (((len = strlen (new_value)) &gt; 0) &amp;&amp; IS_PATH_SEPARATOR (new_value[len-1]))
+        {
+          new_value[len-1] = '\0';
+        }
+      lt_setenv (name, new_value);
+      XFREE (new_value);
+    }
+}
+
+void
+lt_update_lib_path (const char *name, const char *value)
+{
+  lt_debugprintf (__FILE__, __LINE__,
+		  &quot;(lt_update_lib_path) modifying '%s' by prepending '%s'\n&quot;,
+                  nonnull (name), nonnull (value));
+
+  if (name &amp;&amp; *name &amp;&amp; value &amp;&amp; *value)
+    {
+      char *new_value = lt_extend_str (getenv (name), value, 0);
+      lt_setenv (name, new_value);
+      XFREE (new_value);
+    }
+}
+
+EOF
+	    case $host_os in
+	      mingw*)
+		cat &lt;&lt;&quot;EOF&quot;
+
+/* Prepares an argument vector before calling spawn().
+   Note that spawn() does not by itself call the command interpreter
+     (getenv (&quot;COMSPEC&quot;) != NULL ? getenv (&quot;COMSPEC&quot;) :
+      ({ OSVERSIONINFO v; v.dwOSVersionInfoSize = sizeof(OSVERSIONINFO);
+         GetVersionEx(&amp;v);
+         v.dwPlatformId == VER_PLATFORM_WIN32_NT;
+      }) ? &quot;cmd.exe&quot; : &quot;command.com&quot;).
+   Instead it simply concatenates the arguments, separated by ' ', and calls
+   CreateProcess().  We must quote the arguments since Win32 CreateProcess()
+   interprets characters like ' ', '\t', '\\', '&quot;' (but not '&lt;' and '&gt;') in a
+   special way:
+   - Space and tab are interpreted as delimiters. They are not treated as
+     delimiters if they are surrounded by double quotes: &quot;...&quot;.
+   - Unescaped double quotes are removed from the input. Their only effect is
+     that within double quotes, space and tab are treated like normal
+     characters.
+   - Backslashes not followed by double quotes are not special.
+   - But 2*n+1 backslashes followed by a double quote become
+     n backslashes followed by a double quote (n &gt;= 0):
+       \&quot; -&gt; &quot;
+       \\\&quot; -&gt; \&quot;
+       \\\\\&quot; -&gt; \\&quot;
+ */
+#define SHELL_SPECIAL_CHARS &quot;\&quot;\\ \001\002\003\004\005\006\007\010\011\012\013\014\015\016\017\020\021\022\023\024\025\026\027\030\031\032\033\034\035\036\037&quot;
+#define SHELL_SPACE_CHARS &quot; \001\002\003\004\005\006\007\010\011\012\013\014\015\016\017\020\021\022\023\024\025\026\027\030\031\032\033\034\035\036\037&quot;
+char **
+prepare_spawn (char **argv)
+{
+  size_t argc;
+  char **new_argv;
+  size_t i;
+
+  /* Count number of arguments.  */
+  for (argc = 0; argv[argc] != NULL; argc++)
+    ;
+
+  /* Allocate new argument vector.  */
+  new_argv = XMALLOC (char *, argc + 1);
+
+  /* Put quoted arguments into the new argument vector.  */
+  for (i = 0; i &lt; argc; i++)
+    {
+      const char *string = argv[i];
+
+      if (string[0] == '\0')
+	new_argv[i] = xstrdup (&quot;\&quot;\&quot;&quot;);
+      else if (strpbrk (string, SHELL_SPECIAL_CHARS) != NULL)
+	{
+	  int quote_around = (strpbrk (string, SHELL_SPACE_CHARS) != NULL);
+	  size_t length;
+	  unsigned int backslashes;
+	  const char *s;
+	  char *quoted_string;
+	  char *p;
+
+	  length = 0;
+	  backslashes = 0;
+	  if (quote_around)
+	    length++;
+	  for (s = string; *s != '\0'; s++)
+	    {
+	      char c = *s;
+	      if (c == '&quot;')
+		length += backslashes + 1;
+	      length++;
+	      if (c == '\\')
+		backslashes++;
+	      else
+		backslashes = 0;
+	    }
+	  if (quote_around)
+	    length += backslashes + 1;
+
+	  quoted_string = XMALLOC (char, length + 1);
+
+	  p = quoted_string;
+	  backslashes = 0;
+	  if (quote_around)
+	    *p++ = '&quot;';
+	  for (s = string; *s != '\0'; s++)
+	    {
+	      char c = *s;
+	      if (c == '&quot;')
+		{
+		  unsigned int j;
+		  for (j = backslashes + 1; j &gt; 0; j--)
+		    *p++ = '\\';
+		}
+	      *p++ = c;
+	      if (c == '\\')
+		backslashes++;
+	      else
+		backslashes = 0;
+	    }
+	  if (quote_around)
+	    {
+	      unsigned int j;
+	      for (j = backslashes; j &gt; 0; j--)
+		*p++ = '\\';
+	      *p++ = '&quot;';
+	    }
+	  *p = '\0';
+
+	  new_argv[i] = quoted_string;
+	}
+      else
+	new_argv[i] = (char *) string;
+    }
+  new_argv[argc] = NULL;
+
+  return new_argv;
+}
+EOF
+		;;
+	    esac
+
+            cat &lt;&lt;&quot;EOF&quot;
+void lt_dump_script (FILE* f)
+{
+EOF
+	    func_emit_wrapper yes |
+              $SED -e 's/\([\\&quot;]\)/\\\1/g' \
+	           -e 's/^/  fputs (&quot;/' -e 's/$/\\n&quot;, f);/'
+
+            cat &lt;&lt;&quot;EOF&quot;
+}
+EOF
+}
+# end: func_emit_cwrapperexe_src
+
+# func_win32_import_lib_p ARG
+# True if ARG is an import lib, as indicated by $file_magic_cmd
+func_win32_import_lib_p ()
+{
+    $opt_debug
+    case `eval $file_magic_cmd \&quot;\$1\&quot; 2&gt;/dev/null | $SED -e 10q` in
+    *import*) : ;;
+    *) false ;;
+    esac
+}
+
+# func_mode_link arg...
+func_mode_link ()
+{
+    $opt_debug
+    case $host in
+    *-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-os2* | *-cegcc*)
+      # It is impossible to link a dll without this setting, and
+      # we shouldn't force the makefile maintainer to figure out
+      # which system we are compiling for in order to pass an extra
+      # flag for every libtool invocation.
+      # allow_undefined=no
+
+      # FIXME: Unfortunately, there are problems with the above when trying
+      # to make a dll which has undefined symbols, in which case not
+      # even a static library is built.  For now, we need to specify
+      # -no-undefined on the libtool link line when we can be certain
+      # that all symbols are satisfied, otherwise we get a static library.
+      allow_undefined=yes
+      ;;
+    *)
+      allow_undefined=yes
+      ;;
+    esac
+    libtool_args=$nonopt
+    base_compile=&quot;$nonopt $@&quot;
+    compile_command=$nonopt
+    finalize_command=$nonopt
+
+    compile_rpath=
+    finalize_rpath=
+    compile_shlibpath=
+    finalize_shlibpath=
+    convenience=
+    old_convenience=
+    deplibs=
+    old_deplibs=
+    compiler_flags=
+    linker_flags=
+    dllsearchpath=
+    lib_search_path=`pwd`
+    inst_prefix_dir=
+    new_inherited_linker_flags=
+
+    avoid_version=no
+    bindir=
+    dlfiles=
+    dlprefiles=
+    dlself=no
+    export_dynamic=no
+    export_symbols=
+    export_symbols_regex=
+    generated=
+    libobjs=
+    ltlibs=
+    module=no
+    no_install=no
+    objs=
+    non_pic_objects=
+    precious_files_regex=
+    prefer_static_libs=no
+    preload=no
+    prev=
+    prevarg=
+    release=
+    rpath=
+    xrpath=
+    perm_rpath=
+    temp_rpath=
+    thread_safe=no
+    vinfo=
+    vinfo_number=no
+    weak_libs=
+    single_module=&quot;${wl}-single_module&quot;
+    func_infer_tag $base_compile
+
+    # We need to know -static, to get the right output filenames.
+    for arg
+    do
+      case $arg in
+      -shared)
+	test &quot;$build_libtool_libs&quot; != yes &amp;&amp; \
+	  func_fatal_configuration &quot;can not build a shared library&quot;
+	build_old_libs=no
+	break
+	;;
+      -all-static | -static | -static-libtool-libs)
+	case $arg in
+	-all-static)
+	  if test &quot;$build_libtool_libs&quot; = yes &amp;&amp; test -z &quot;$link_static_flag&quot;; then
+	    func_warning &quot;complete static linking is impossible in this configuration&quot;
+	  fi
+	  if test -n &quot;$link_static_flag&quot;; then
+	    dlopen_self=$dlopen_self_static
+	  fi
+	  prefer_static_libs=yes
+	  ;;
+	-static)
+	  if test -z &quot;$pic_flag&quot; &amp;&amp; test -n &quot;$link_static_flag&quot;; then
+	    dlopen_self=$dlopen_self_static
+	  fi
+	  prefer_static_libs=built
+	  ;;
+	-static-libtool-libs)
+	  if test -z &quot;$pic_flag&quot; &amp;&amp; test -n &quot;$link_static_flag&quot;; then
+	    dlopen_self=$dlopen_self_static
+	  fi
+	  prefer_static_libs=yes
+	  ;;
+	esac
+	build_libtool_libs=no
+	build_old_libs=yes
+	break
+	;;
+      esac
+    done
+
+    # See if our shared archives depend on static archives.
+    test -n &quot;$old_archive_from_new_cmds&quot; &amp;&amp; build_old_libs=yes
+
+    # Go through the arguments, transforming them on the way.
+    while test &quot;$#&quot; -gt 0; do
+      arg=&quot;$1&quot;
+      shift
+      func_quote_for_eval &quot;$arg&quot;
+      qarg=$func_quote_for_eval_unquoted_result
+      func_append libtool_args &quot; $func_quote_for_eval_result&quot;
+
+      # If the previous option needs an argument, assign it.
+      if test -n &quot;$prev&quot;; then
+	case $prev in
+	output)
+	  func_append compile_command &quot; @OUTPUT@&quot;
+	  func_append finalize_command &quot; @OUTPUT@&quot;
+	  ;;
+	esac
+
+	case $prev in
+	bindir)
+	  bindir=&quot;$arg&quot;
+	  prev=
+	  continue
+	  ;;
+	dlfiles|dlprefiles)
+	  if test &quot;$preload&quot; = no; then
+	    # Add the symbol object into the linking commands.
+	    func_append compile_command &quot; @SYMFILE@&quot;
+	    func_append finalize_command &quot; @SYMFILE@&quot;
+	    preload=yes
+	  fi
+	  case $arg in
+	  *.la | *.lo) ;;  # We handle these cases below.
+	  force)
+	    if test &quot;$dlself&quot; = no; then
+	      dlself=needless
+	      export_dynamic=yes
+	    fi
+	    prev=
+	    continue
+	    ;;
+	  self)
+	    if test &quot;$prev&quot; = dlprefiles; then
+	      dlself=yes
+	    elif test &quot;$prev&quot; = dlfiles &amp;&amp; test &quot;$dlopen_self&quot; != yes; then
+	      dlself=yes
+	    else
+	      dlself=needless
+	      export_dynamic=yes
+	    fi
+	    prev=
+	    continue
+	    ;;
+	  *)
+	    if test &quot;$prev&quot; = dlfiles; then
+	      func_append dlfiles &quot; $arg&quot;
+	    else
+	      func_append dlprefiles &quot; $arg&quot;
+	    fi
+	    prev=
+	    continue
+	    ;;
+	  esac
+	  ;;
+	expsyms)
+	  export_symbols=&quot;$arg&quot;
+	  test -f &quot;$arg&quot; \
+	    || func_fatal_error &quot;symbol file \`$arg' does not exist&quot;
+	  prev=
+	  continue
+	  ;;
+	expsyms_regex)
+	  export_symbols_regex=&quot;$arg&quot;
+	  prev=
+	  continue
+	  ;;
+	framework)
+	  case $host in
+	    *-*-darwin*)
+	      case &quot;$deplibs &quot; in
+		*&quot; $qarg.ltframework &quot;*) ;;
+		*) func_append deplibs &quot; $qarg.ltframework&quot; # this is fixed later
+		   ;;
+	      esac
+	      ;;
+	  esac
+	  prev=
+	  continue
+	  ;;
+	inst_prefix)
+	  inst_prefix_dir=&quot;$arg&quot;
+	  prev=
+	  continue
+	  ;;
+	objectlist)
+	  if test -f &quot;$arg&quot;; then
+	    save_arg=$arg
+	    moreargs=
+	    for fil in `cat &quot;$save_arg&quot;`
+	    do
+#	      func_append moreargs &quot; $fil&quot;
+	      arg=$fil
+	      # A libtool-controlled object.
+
+	      # Check to see that this really is a libtool object.
+	      if func_lalib_unsafe_p &quot;$arg&quot;; then
+		pic_object=
+		non_pic_object=
+
+		# Read the .lo file
+		func_source &quot;$arg&quot;
+
+		if test -z &quot;$pic_object&quot; ||
+		   test -z &quot;$non_pic_object&quot; ||
+		   test &quot;$pic_object&quot; = none &amp;&amp;
+		   test &quot;$non_pic_object&quot; = none; then
+		  func_fatal_error &quot;cannot find name of object for \`$arg'&quot;
+		fi
+
+		# Extract subdirectory from the argument.
+		func_dirname &quot;$arg&quot; &quot;/&quot; &quot;&quot;
+		xdir=&quot;$func_dirname_result&quot;
+
+		if test &quot;$pic_object&quot; != none; then
+		  # Prepend the subdirectory the object is found in.
+		  pic_object=&quot;$xdir$pic_object&quot;
+
+		  if test &quot;$prev&quot; = dlfiles; then
+		    if test &quot;$build_libtool_libs&quot; = yes &amp;&amp; test &quot;$dlopen_support&quot; = yes; then
+		      func_append dlfiles &quot; $pic_object&quot;
+		      prev=
+		      continue
+		    else
+		      # If libtool objects are unsupported, then we need to preload.
+		      prev=dlprefiles
+		    fi
+		  fi
+
+		  # CHECK ME:  I think I busted this.  -Ossama
+		  if test &quot;$prev&quot; = dlprefiles; then
+		    # Preload the old-style object.
+		    func_append dlprefiles &quot; $pic_object&quot;
+		    prev=
+		  fi
+
+		  # A PIC object.
+		  func_append libobjs &quot; $pic_object&quot;
+		  arg=&quot;$pic_object&quot;
+		fi
+
+		# Non-PIC object.
+		if test &quot;$non_pic_object&quot; != none; then
+		  # Prepend the subdirectory the object is found in.
+		  non_pic_object=&quot;$xdir$non_pic_object&quot;
+
+		  # A standard non-PIC object
+		  func_append non_pic_objects &quot; $non_pic_object&quot;
+		  if test -z &quot;$pic_object&quot; || test &quot;$pic_object&quot; = none ; then
+		    arg=&quot;$non_pic_object&quot;
+		  fi
+		else
+		  # If the PIC object exists, use it instead.
+		  # $xdir was prepended to $pic_object above.
+		  non_pic_object=&quot;$pic_object&quot;
+		  func_append non_pic_objects &quot; $non_pic_object&quot;
+		fi
+	      else
+		# Only an error if not doing a dry-run.
+		if $opt_dry_run; then
+		  # Extract subdirectory from the argument.
+		  func_dirname &quot;$arg&quot; &quot;/&quot; &quot;&quot;
+		  xdir=&quot;$func_dirname_result&quot;
+
+		  func_lo2o &quot;$arg&quot;
+		  pic_object=$xdir$objdir/$func_lo2o_result
+		  non_pic_object=$xdir$func_lo2o_result
+		  func_append libobjs &quot; $pic_object&quot;
+		  func_append non_pic_objects &quot; $non_pic_object&quot;
+	        else
+		  func_fatal_error &quot;\`$arg' is not a valid libtool object&quot;
+		fi
+	      fi
+	    done
+	  else
+	    func_fatal_error &quot;link input file \`$arg' does not exist&quot;
+	  fi
+	  arg=$save_arg
+	  prev=
+	  continue
+	  ;;
+	precious_regex)
+	  precious_files_regex=&quot;$arg&quot;
+	  prev=
+	  continue
+	  ;;
+	release)
+	  release=&quot;-$arg&quot;
+	  prev=
+	  continue
+	  ;;
+	rpath | xrpath)
+	  # We need an absolute path.
+	  case $arg in
+	  [\\/]* | [A-Za-z]:[\\/]*) ;;
+	  *)
+	    func_fatal_error &quot;only absolute run-paths are allowed&quot;
+	    ;;
+	  esac
+	  if test &quot;$prev&quot; = rpath; then
+	    case &quot;$rpath &quot; in
+	    *&quot; $arg &quot;*) ;;
+	    *) func_append rpath &quot; $arg&quot; ;;
+	    esac
+	  else
+	    case &quot;$xrpath &quot; in
+	    *&quot; $arg &quot;*) ;;
+	    *) func_append xrpath &quot; $arg&quot; ;;
+	    esac
+	  fi
+	  prev=
+	  continue
+	  ;;
+	shrext)
+	  shrext_cmds=&quot;$arg&quot;
+	  prev=
+	  continue
+	  ;;
+	weak)
+	  func_append weak_libs &quot; $arg&quot;
+	  prev=
+	  continue
+	  ;;
+	xcclinker)
+	  func_append linker_flags &quot; $qarg&quot;
+	  func_append compiler_flags &quot; $qarg&quot;
+	  prev=
+	  func_append compile_command &quot; $qarg&quot;
+	  func_append finalize_command &quot; $qarg&quot;
+	  continue
+	  ;;
+	xcompiler)
+	  func_append compiler_flags &quot; $qarg&quot;
+	  prev=
+	  func_append compile_command &quot; $qarg&quot;
+	  func_append finalize_command &quot; $qarg&quot;
+	  continue
+	  ;;
+	xlinker)
+	  func_append linker_flags &quot; $qarg&quot;
+	  func_append compiler_flags &quot; $wl$qarg&quot;
+	  prev=
+	  func_append compile_command &quot; $wl$qarg&quot;
+	  func_append finalize_command &quot; $wl$qarg&quot;
+	  continue
+	  ;;
+	*)
+	  eval &quot;$prev=\&quot;\$arg\&quot;&quot;
+	  prev=
+	  continue
+	  ;;
+	esac
+      fi # test -n &quot;$prev&quot;
+
+      prevarg=&quot;$arg&quot;
+
+      case $arg in
+      -all-static)
+	if test -n &quot;$link_static_flag&quot;; then
+	  # See comment for -static flag below, for more details.
+	  func_append compile_command &quot; $link_static_flag&quot;
+	  func_append finalize_command &quot; $link_static_flag&quot;
+	fi
+	continue
+	;;
+
+      -allow-undefined)
+	# FIXME: remove this flag sometime in the future.
+	func_fatal_error &quot;\`-allow-undefined' must not be used because it is the default&quot;
+	;;
+
+      -avoid-version)
+	avoid_version=yes
+	continue
+	;;
+
+      -bindir)
+	prev=bindir
+	continue
+	;;
+
+      -dlopen)
+	prev=dlfiles
+	continue
+	;;
+
+      -dlpreopen)
+	prev=dlprefiles
+	continue
+	;;
+
+      -export-dynamic)
+	export_dynamic=yes
+	continue
+	;;
+
+      -export-symbols | -export-symbols-regex)
+	if test -n &quot;$export_symbols&quot; || test -n &quot;$export_symbols_regex&quot;; then
+	  func_fatal_error &quot;more than one -exported-symbols argument is not allowed&quot;
+	fi
+	if test &quot;X$arg&quot; = &quot;X-export-symbols&quot;; then
+	  prev=expsyms
+	else
+	  prev=expsyms_regex
+	fi
+	continue
+	;;
+
+      -framework)
+	prev=framework
+	continue
+	;;
+
+      -inst-prefix-dir)
+	prev=inst_prefix
+	continue
+	;;
+
+      # The native IRIX linker understands -LANG:*, -LIST:* and -LNO:*
+      # so, if we see these flags be careful not to treat them like -L
+      -L[A-Z][A-Z]*:*)
+	case $with_gcc/$host in
+	no/*-*-irix* | /*-*-irix*)
+	  func_append compile_command &quot; $arg&quot;
+	  func_append finalize_command &quot; $arg&quot;
+	  ;;
+	esac
+	continue
+	;;
+
+      -L*)
+	func_stripname &quot;-L&quot; '' &quot;$arg&quot;
+	if test -z &quot;$func_stripname_result&quot;; then
+	  if test &quot;$#&quot; -gt 0; then
+	    func_fatal_error &quot;require no space between \`-L' and \`$1'&quot;
+	  else
+	    func_fatal_error &quot;need path for \`-L' option&quot;
+	  fi
+	fi
+	func_resolve_sysroot &quot;$func_stripname_result&quot;
+	dir=$func_resolve_sysroot_result
+	# We need an absolute path.
+	case $dir in
+	[\\/]* | [A-Za-z]:[\\/]*) ;;
+	*)
+	  absdir=`cd &quot;$dir&quot; &amp;&amp; pwd`
+	  test -z &quot;$absdir&quot; &amp;&amp; \
+	    func_fatal_error &quot;cannot determine absolute directory name of \`$dir'&quot;
+	  dir=&quot;$absdir&quot;
+	  ;;
+	esac
+	case &quot;$deplibs &quot; in
+	*&quot; -L$dir &quot;* | *&quot; $arg &quot;*)
+	  # Will only happen for absolute or sysroot arguments
+	  ;;
+	*)
+	  # Preserve sysroot, but never include relative directories
+	  case $dir in
+	    [\\/]* | [A-Za-z]:[\\/]* | =*) func_append deplibs &quot; $arg&quot; ;;
+	    *) func_append deplibs &quot; -L$dir&quot; ;;
+	  esac
+	  func_append lib_search_path &quot; $dir&quot;
+	  ;;
+	esac
+	case $host in
+	*-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-os2* | *-cegcc*)
+	  testbindir=`$ECHO &quot;$dir&quot; | $SED 's*/lib$*/bin*'`
+	  case :$dllsearchpath: in
+	  *&quot;:$dir:&quot;*) ;;
+	  ::) dllsearchpath=$dir;;
+	  *) func_append dllsearchpath &quot;:$dir&quot;;;
+	  esac
+	  case :$dllsearchpath: in
+	  *&quot;:$testbindir:&quot;*) ;;
+	  ::) dllsearchpath=$testbindir;;
+	  *) func_append dllsearchpath &quot;:$testbindir&quot;;;
+	  esac
+	  ;;
+	esac
+	continue
+	;;
+
+      -l*)
+	if test &quot;X$arg&quot; = &quot;X-lc&quot; || test &quot;X$arg&quot; = &quot;X-lm&quot;; then
+	  case $host in
+	  *-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-beos* | *-cegcc* | *-*-haiku*)
+	    # These systems don't actually have a C or math library (as such)
+	    continue
+	    ;;
+	  *-*-os2*)
+	    # These systems don't actually have a C library (as such)
+	    test &quot;X$arg&quot; = &quot;X-lc&quot; &amp;&amp; continue
+	    ;;
+	  *-*-openbsd* | *-*-freebsd* | *-*-dragonfly*)
+	    # Do not include libc due to us having libc/libc_r.
+	    test &quot;X$arg&quot; = &quot;X-lc&quot; &amp;&amp; continue
+	    ;;
+	  *-*-rhapsody* | *-*-darwin1.[012])
+	    # Rhapsody C and math libraries are in the System framework
+	    func_append deplibs &quot; System.ltframework&quot;
+	    continue
+	    ;;
+	  *-*-sco3.2v5* | *-*-sco5v6*)
+	    # Causes problems with __ctype
+	    test &quot;X$arg&quot; = &quot;X-lc&quot; &amp;&amp; continue
+	    ;;
+	  *-*-sysv4.2uw2* | *-*-sysv5* | *-*-unixware* | *-*-OpenUNIX*)
+	    # Compiler inserts libc in the correct place for threads to work
+	    test &quot;X$arg&quot; = &quot;X-lc&quot; &amp;&amp; continue
+	    ;;
+	  esac
+	elif test &quot;X$arg&quot; = &quot;X-lc_r&quot;; then
+	 case $host in
+	 *-*-openbsd* | *-*-freebsd* | *-*-dragonfly*)
+	   # Do not include libc_r directly, use -pthread flag.
+	   continue
+	   ;;
+	 esac
+	fi
+	func_append deplibs &quot; $arg&quot;
+	continue
+	;;
+
+      -module)
+	module=yes
+	continue
+	;;
+
+      # Tru64 UNIX uses -model [arg] to determine the layout of C++
+      # classes, name mangling, and exception handling.
+      # Darwin uses the -arch flag to determine output architecture.
+      -model|-arch|-isysroot|--sysroot)
+	func_append compiler_flags &quot; $arg&quot;
+	func_append compile_command &quot; $arg&quot;
+	func_append finalize_command &quot; $arg&quot;
+	prev=xcompiler
+	continue
+	;;
+
+      -mt|-mthreads|-kthread|-Kthread|-pthread|-pthreads|--thread-safe|-threads)
+	func_append compiler_flags &quot; $arg&quot;
+	func_append compile_command &quot; $arg&quot;
+	func_append finalize_command &quot; $arg&quot;
+	case &quot;$new_inherited_linker_flags &quot; in
+	    *&quot; $arg &quot;*) ;;
+	    * ) func_append new_inherited_linker_flags &quot; $arg&quot; ;;
+	esac
+	continue
+	;;
+
+      -multi_module)
+	single_module=&quot;${wl}-multi_module&quot;
+	continue
+	;;
+
+      -no-fast-install)
+	fast_install=no
+	continue
+	;;
+
+      -no-install)
+	case $host in
+	*-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-os2* | *-*-darwin* | *-cegcc*)
+	  # The PATH hackery in wrapper scripts is required on Windows
+	  # and Darwin in order for the loader to find any dlls it needs.
+	  func_warning &quot;\`-no-install' is ignored for $host&quot;
+	  func_warning &quot;assuming \`-no-fast-install' instead&quot;
+	  fast_install=no
+	  ;;
+	*) no_install=yes ;;
+	esac
+	continue
+	;;
+
+      -no-undefined)
+	allow_undefined=no
+	continue
+	;;
+
+      -objectlist)
+	prev=objectlist
+	continue
+	;;
+
+      -o) prev=output ;;
+
+      -precious-files-regex)
+	prev=precious_regex
+	continue
+	;;
+
+      -release)
+	prev=release
+	continue
+	;;
+
+      -rpath)
+	prev=rpath
+	continue
+	;;
+
+      -R)
+	prev=xrpath
+	continue
+	;;
+
+      -R*)
+	func_stripname '-R' '' &quot;$arg&quot;
+	dir=$func_stripname_result
+	# We need an absolute path.
+	case $dir in
+	[\\/]* | [A-Za-z]:[\\/]*) ;;
+	=*)
+	  func_stripname '=' '' &quot;$dir&quot;
+	  dir=$lt_sysroot$func_stripname_result
+	  ;;
+	*)
+	  func_fatal_error &quot;only absolute run-paths are allowed&quot;
+	  ;;
+	esac
+	case &quot;$xrpath &quot; in
+	*&quot; $dir &quot;*) ;;
+	*) func_append xrpath &quot; $dir&quot; ;;
+	esac
+	continue
+	;;
+
+      -shared)
+	# The effects of -shared are defined in a previous loop.
+	continue
+	;;
+
+      -shrext)
+	prev=shrext
+	continue
+	;;
+
+      -static | -static-libtool-libs)
+	# The effects of -static are defined in a previous loop.
+	# We used to do the same as -all-static on platforms that
+	# didn't have a PIC flag, but the assumption that the effects
+	# would be equivalent was wrong.  It would break on at least
+	# Digital Unix and AIX.
+	continue
+	;;
+
+      -thread-safe)
+	thread_safe=yes
+	continue
+	;;
+
+      -version-info)
+	prev=vinfo
+	continue
+	;;
+
+      -version-number)
+	prev=vinfo
+	vinfo_number=yes
+	continue
+	;;
+
+      -weak)
+        prev=weak
+	continue
+	;;
+
+      -Wc,*)
+	func_stripname '-Wc,' '' &quot;$arg&quot;
+	args=$func_stripname_result
+	arg=
+	save_ifs=&quot;$IFS&quot;; IFS=','
+	for flag in $args; do
+	  IFS=&quot;$save_ifs&quot;
+          func_quote_for_eval &quot;$flag&quot;
+	  func_append arg &quot; $func_quote_for_eval_result&quot;
+	  func_append compiler_flags &quot; $func_quote_for_eval_result&quot;
+	done
+	IFS=&quot;$save_ifs&quot;
+	func_stripname ' ' '' &quot;$arg&quot;
+	arg=$func_stripname_result
+	;;
+
+      -Wl,*)
+	func_stripname '-Wl,' '' &quot;$arg&quot;
+	args=$func_stripname_result
+	arg=
+	save_ifs=&quot;$IFS&quot;; IFS=','
+	for flag in $args; do
+	  IFS=&quot;$save_ifs&quot;
+          func_quote_for_eval &quot;$flag&quot;
+	  func_append arg &quot; $wl$func_quote_for_eval_result&quot;
+	  func_append compiler_flags &quot; $wl$func_quote_for_eval_result&quot;
+	  func_append linker_flags &quot; $func_quote_for_eval_result&quot;
+	done
+	IFS=&quot;$save_ifs&quot;
+	func_stripname ' ' '' &quot;$arg&quot;
+	arg=$func_stripname_result
+	;;
+
+      -Xcompiler)
+	prev=xcompiler
+	continue
+	;;
+
+      -Xlinker)
+	prev=xlinker
+	continue
+	;;
+
+      -XCClinker)
+	prev=xcclinker
+	continue
+	;;
+
+      # -msg_* for osf cc
+      -msg_*)
+	func_quote_for_eval &quot;$arg&quot;
+	arg=&quot;$func_quote_for_eval_result&quot;
+	;;
+
+      # Flags to be passed through unchanged, with rationale:
+      # -64, -mips[0-9]      enable 64-bit mode for the SGI compiler
+      # -r[0-9][0-9]*        specify processor for the SGI compiler
+      # -xarch=*, -xtarget=* enable 64-bit mode for the Sun compiler
+      # +DA*, +DD*           enable 64-bit mode for the HP compiler
+      # -q*                  compiler args for the IBM compiler
+      # -m*, -t[45]*, -txscale* architecture-specific flags for GCC
+      # -F/path              path to uninstalled frameworks, gcc on darwin
+      # -p, -pg, --coverage, -fprofile-*  profiling flags for GCC
+      # @file                GCC response files
+      # -tp=*                Portland pgcc target processor selection
+      # --sysroot=*          for sysroot support
+      # -O*, -flto*, -fwhopr*, -fuse-linker-plugin GCC link-time optimization
+      -64|-mips[0-9]|-r[0-9][0-9]*|-xarch=*|-xtarget=*|+DA*|+DD*|-q*|-m*| \
+      -t[45]*|-txscale*|-p|-pg|--coverage|-fprofile-*|-F*|@*|-tp=*|--sysroot=*| \
+      -O*|-flto*|-fwhopr*|-fuse-linker-plugin)
+        func_quote_for_eval &quot;$arg&quot;
+	arg=&quot;$func_quote_for_eval_result&quot;
+        func_append compile_command &quot; $arg&quot;
+        func_append finalize_command &quot; $arg&quot;
+        func_append compiler_flags &quot; $arg&quot;
+        continue
+        ;;
+
+      # Some other compiler flag.
+      -* | +*)
+        func_quote_for_eval &quot;$arg&quot;
+	arg=&quot;$func_quote_for_eval_result&quot;
+	;;
+
+      *.$objext)
+	# A standard object.
+	func_append objs &quot; $arg&quot;
+	;;
+
+      *.lo)
+	# A libtool-controlled object.
+
+	# Check to see that this really is a libtool object.
+	if func_lalib_unsafe_p &quot;$arg&quot;; then
+	  pic_object=
+	  non_pic_object=
+
+	  # Read the .lo file
+	  func_source &quot;$arg&quot;
+
+	  if test -z &quot;$pic_object&quot; ||
+	     test -z &quot;$non_pic_object&quot; ||
+	     test &quot;$pic_object&quot; = none &amp;&amp;
+	     test &quot;$non_pic_object&quot; = none; then
+	    func_fatal_error &quot;cannot find name of object for \`$arg'&quot;
+	  fi
+
+	  # Extract subdirectory from the argument.
+	  func_dirname &quot;$arg&quot; &quot;/&quot; &quot;&quot;
+	  xdir=&quot;$func_dirname_result&quot;
+
+	  if test &quot;$pic_object&quot; != none; then
+	    # Prepend the subdirectory the object is found in.
+	    pic_object=&quot;$xdir$pic_object&quot;
+
+	    if test &quot;$prev&quot; = dlfiles; then
+	      if test &quot;$build_libtool_libs&quot; = yes &amp;&amp; test &quot;$dlopen_support&quot; = yes; then
+		func_append dlfiles &quot; $pic_object&quot;
+		prev=
+		continue
+	      else
+		# If libtool objects are unsupported, then we need to preload.
+		prev=dlprefiles
+	      fi
+	    fi
+
+	    # CHECK ME:  I think I busted this.  -Ossama
+	    if test &quot;$prev&quot; = dlprefiles; then
+	      # Preload the old-style object.
+	      func_append dlprefiles &quot; $pic_object&quot;
+	      prev=
+	    fi
+
+	    # A PIC object.
+	    func_append libobjs &quot; $pic_object&quot;
+	    arg=&quot;$pic_object&quot;
+	  fi
+
+	  # Non-PIC object.
+	  if test &quot;$non_pic_object&quot; != none; then
+	    # Prepend the subdirectory the object is found in.
+	    non_pic_object=&quot;$xdir$non_pic_object&quot;
+
+	    # A standard non-PIC object
+	    func_append non_pic_objects &quot; $non_pic_object&quot;
+	    if test -z &quot;$pic_object&quot; || test &quot;$pic_object&quot; = none ; then
+	      arg=&quot;$non_pic_object&quot;
+	    fi
+	  else
+	    # If the PIC object exists, use it instead.
+	    # $xdir was prepended to $pic_object above.
+	    non_pic_object=&quot;$pic_object&quot;
+	    func_append non_pic_objects &quot; $non_pic_object&quot;
+	  fi
+	else
+	  # Only an error if not doing a dry-run.
+	  if $opt_dry_run; then
+	    # Extract subdirectory from the argument.
+	    func_dirname &quot;$arg&quot; &quot;/&quot; &quot;&quot;
+	    xdir=&quot;$func_dirname_result&quot;
+
+	    func_lo2o &quot;$arg&quot;
+	    pic_object=$xdir$objdir/$func_lo2o_result
+	    non_pic_object=$xdir$func_lo2o_result
+	    func_append libobjs &quot; $pic_object&quot;
+	    func_append non_pic_objects &quot; $non_pic_object&quot;
+	  else
+	    func_fatal_error &quot;\`$arg' is not a valid libtool object&quot;
+	  fi
+	fi
+	;;
+
+      *.$libext)
+	# An archive.
+	func_append deplibs &quot; $arg&quot;
+	func_append old_deplibs &quot; $arg&quot;
+	continue
+	;;
+
+      *.la)
+	# A libtool-controlled library.
+
+	func_resolve_sysroot &quot;$arg&quot;
+	if test &quot;$prev&quot; = dlfiles; then
+	  # This library was specified with -dlopen.
+	  func_append dlfiles &quot; $func_resolve_sysroot_result&quot;
+	  prev=
+	elif test &quot;$prev&quot; = dlprefiles; then
+	  # The library was specified with -dlpreopen.
+	  func_append dlprefiles &quot; $func_resolve_sysroot_result&quot;
+	  prev=
+	else
+	  func_append deplibs &quot; $func_resolve_sysroot_result&quot;
+	fi
+	continue
+	;;
+
+      # Some other compiler argument.
+      *)
+	# Unknown arguments in both finalize_command and compile_command need
+	# to be aesthetically quoted because they are evaled later.
+	func_quote_for_eval &quot;$arg&quot;
+	arg=&quot;$func_quote_for_eval_result&quot;
+	;;
+      esac # arg
+
+      # Now actually substitute the argument into the commands.
+      if test -n &quot;$arg&quot;; then
+	func_append compile_command &quot; $arg&quot;
+	func_append finalize_command &quot; $arg&quot;
+      fi
+    done # argument parsing loop
+
+    test -n &quot;$prev&quot; &amp;&amp; \
+      func_fatal_help &quot;the \`$prevarg' option requires an argument&quot;
+
+    if test &quot;$export_dynamic&quot; = yes &amp;&amp; test -n &quot;$export_dynamic_flag_spec&quot;; then
+      eval arg=\&quot;$export_dynamic_flag_spec\&quot;
+      func_append compile_command &quot; $arg&quot;
+      func_append finalize_command &quot; $arg&quot;
+    fi
+
+    oldlibs=
+    # calculate the name of the file, without its directory
+    func_basename &quot;$output&quot;
+    outputname=&quot;$func_basename_result&quot;
+    libobjs_save=&quot;$libobjs&quot;
+
+    if test -n &quot;$shlibpath_var&quot;; then
+      # get the directories listed in $shlibpath_var
+      eval shlib_search_path=\`\$ECHO \&quot;\${$shlibpath_var}\&quot; \| \$SED \'s/:/ /g\'\`
+    else
+      shlib_search_path=
+    fi
+    eval sys_lib_search_path=\&quot;$sys_lib_search_path_spec\&quot;
+    eval sys_lib_dlsearch_path=\&quot;$sys_lib_dlsearch_path_spec\&quot;
+
+    func_dirname &quot;$output&quot; &quot;/&quot; &quot;&quot;
+    output_objdir=&quot;$func_dirname_result$objdir&quot;
+    func_to_tool_file &quot;$output_objdir/&quot;
+    tool_output_objdir=$func_to_tool_file_result
+    # Create the object directory.
+    func_mkdir_p &quot;$output_objdir&quot;
+
+    # Determine the type of output
+    case $output in
+    &quot;&quot;)
+      func_fatal_help &quot;you must specify an output file&quot;
+      ;;
+    *.$libext) linkmode=oldlib ;;
+    *.lo | *.$objext) linkmode=obj ;;
+    *.la) linkmode=lib ;;
+    *) linkmode=prog ;; # Anything else should be a program.
+    esac
+
+    specialdeplibs=
+
+    libs=
+    # Find all interdependent deplibs by searching for libraries
+    # that are linked more than once (e.g. -la -lb -la)
+    for deplib in $deplibs; do
+      if $opt_preserve_dup_deps ; then
+	case &quot;$libs &quot; in
+	*&quot; $deplib &quot;*) func_append specialdeplibs &quot; $deplib&quot; ;;
+	esac
+      fi
+      func_append libs &quot; $deplib&quot;
+    done
+
+    if test &quot;$linkmode&quot; = lib; then
+      libs=&quot;$predeps $libs $compiler_lib_search_path $postdeps&quot;
+
+      # Compute libraries that are listed more than once in $predeps
+      # $postdeps and mark them as special (i.e., whose duplicates are
+      # not to be eliminated).
+      pre_post_deps=
+      if $opt_duplicate_compiler_generated_deps; then
+	for pre_post_dep in $predeps $postdeps; do
+	  case &quot;$pre_post_deps &quot; in
+	  *&quot; $pre_post_dep &quot;*) func_append specialdeplibs &quot; $pre_post_deps&quot; ;;
+	  esac
+	  func_append pre_post_deps &quot; $pre_post_dep&quot;
+	done
+      fi
+      pre_post_deps=
+    fi
+
+    deplibs=
+    newdependency_libs=
+    newlib_search_path=
+    need_relink=no # whether we're linking any uninstalled libtool libraries
+    notinst_deplibs= # not-installed libtool libraries
+    notinst_path= # paths that contain not-installed libtool libraries
+
+    case $linkmode in
+    lib)
+	passes=&quot;conv dlpreopen link&quot;
+	for file in $dlfiles $dlprefiles; do
+	  case $file in
+	  *.la) ;;
+	  *)
+	    func_fatal_help &quot;libraries can \`-dlopen' only libtool libraries: $file&quot;
+	    ;;
+	  esac
+	done
+	;;
+    prog)
+	compile_deplibs=
+	finalize_deplibs=
+	alldeplibs=no
+	newdlfiles=
+	newdlprefiles=
+	passes=&quot;conv scan dlopen dlpreopen link&quot;
+	;;
+    *)  passes=&quot;conv&quot;
+	;;
+    esac
+
+    for pass in $passes; do
+      # The preopen pass in lib mode reverses $deplibs; put it back here
+      # so that -L comes before libs that need it for instance...
+      if test &quot;$linkmode,$pass&quot; = &quot;lib,link&quot;; then
+	## FIXME: Find the place where the list is rebuilt in the wrong
+	##        order, and fix it there properly
+        tmp_deplibs=
+	for deplib in $deplibs; do
+	  tmp_deplibs=&quot;$deplib $tmp_deplibs&quot;
+	done
+	deplibs=&quot;$tmp_deplibs&quot;
+      fi
+
+      if test &quot;$linkmode,$pass&quot; = &quot;lib,link&quot; ||
+	 test &quot;$linkmode,$pass&quot; = &quot;prog,scan&quot;; then
+	libs=&quot;$deplibs&quot;
+	deplibs=
+      fi
+      if test &quot;$linkmode&quot; = prog; then
+	case $pass in
+	dlopen) libs=&quot;$dlfiles&quot; ;;
+	dlpreopen) libs=&quot;$dlprefiles&quot; ;;
+	link)
+	  libs=&quot;$deplibs %DEPLIBS%&quot;
+	  test &quot;X$link_all_deplibs&quot; != Xno &amp;&amp; libs=&quot;$libs $dependency_libs&quot;
+	  ;;
+	esac
+      fi
+      if test &quot;$linkmode,$pass&quot; = &quot;lib,dlpreopen&quot;; then
+	# Collect and forward deplibs of preopened libtool libs
+	for lib in $dlprefiles; do
+	  # Ignore non-libtool-libs
+	  dependency_libs=
+	  func_resolve_sysroot &quot;$lib&quot;
+	  case $lib in
+	  *.la)	func_source &quot;$func_resolve_sysroot_result&quot; ;;
+	  esac
+
+	  # Collect preopened libtool deplibs, except any this library
+	  # has declared as weak libs
+	  for deplib in $dependency_libs; do
+	    func_basename &quot;$deplib&quot;
+            deplib_base=$func_basename_result
+	    case &quot; $weak_libs &quot; in
+	    *&quot; $deplib_base &quot;*) ;;
+	    *) func_append deplibs &quot; $deplib&quot; ;;
+	    esac
+	  done
+	done
+	libs=&quot;$dlprefiles&quot;
+      fi
+      if test &quot;$pass&quot; = dlopen; then
+	# Collect dlpreopened libraries
+	save_deplibs=&quot;$deplibs&quot;
+	deplibs=
+      fi
+
+      for deplib in $libs; do
+	lib=
+	found=no
+	case $deplib in
+	-mt|-mthreads|-kthread|-Kthread|-pthread|-pthreads|--thread-safe|-threads)
+	  if test &quot;$linkmode,$pass&quot; = &quot;prog,link&quot;; then
+	    compile_deplibs=&quot;$deplib $compile_deplibs&quot;
+	    finalize_deplibs=&quot;$deplib $finalize_deplibs&quot;
+	  else
+	    func_append compiler_flags &quot; $deplib&quot;
+	    if test &quot;$linkmode&quot; = lib ; then
+		case &quot;$new_inherited_linker_flags &quot; in
+		    *&quot; $deplib &quot;*) ;;
+		    * ) func_append new_inherited_linker_flags &quot; $deplib&quot; ;;
+		esac
+	    fi
+	  fi
+	  continue
+	  ;;
+	-l*)
+	  if test &quot;$linkmode&quot; != lib &amp;&amp; test &quot;$linkmode&quot; != prog; then
+	    func_warning &quot;\`-l' is ignored for archives/objects&quot;
+	    continue
+	  fi
+	  func_stripname '-l' '' &quot;$deplib&quot;
+	  name=$func_stripname_result
+	  if test &quot;$linkmode&quot; = lib; then
+	    searchdirs=&quot;$newlib_search_path $lib_search_path $compiler_lib_search_dirs $sys_lib_search_path $shlib_search_path&quot;
+	  else
+	    searchdirs=&quot;$newlib_search_path $lib_search_path $sys_lib_search_path $shlib_search_path&quot;
+	  fi
+	  for searchdir in $searchdirs; do
+	    for search_ext in .la $std_shrext .so .a; do
+	      # Search the libtool library
+	      lib=&quot;$searchdir/lib${name}${search_ext}&quot;
+	      if test -f &quot;$lib&quot;; then
+		if test &quot;$search_ext&quot; = &quot;.la&quot;; then
+		  found=yes
+		else
+		  found=no
+		fi
+		break 2
+	      fi
+	    done
+	  done
+	  if test &quot;$found&quot; != yes; then
+	    # deplib doesn't seem to be a libtool library
+	    if test &quot;$linkmode,$pass&quot; = &quot;prog,link&quot;; then
+	      compile_deplibs=&quot;$deplib $compile_deplibs&quot;
+	      finalize_deplibs=&quot;$deplib $finalize_deplibs&quot;
+	    else
+	      deplibs=&quot;$deplib $deplibs&quot;
+	      test &quot;$linkmode&quot; = lib &amp;&amp; newdependency_libs=&quot;$deplib $newdependency_libs&quot;
+	    fi
+	    continue
+	  else # deplib is a libtool library
+	    # If $allow_libtool_libs_with_static_runtimes &amp;&amp; $deplib is a stdlib,
+	    # We need to do some special things here, and not later.
+	    if test &quot;X$allow_libtool_libs_with_static_runtimes&quot; = &quot;Xyes&quot; ; then
+	      case &quot; $predeps $postdeps &quot; in
+	      *&quot; $deplib &quot;*)
+		if func_lalib_p &quot;$lib&quot;; then
+		  library_names=
+		  old_library=
+		  func_source &quot;$lib&quot;
+		  for l in $old_library $library_names; do
+		    ll=&quot;$l&quot;
+		  done
+		  if test &quot;X$ll&quot; = &quot;X$old_library&quot; ; then # only static version available
+		    found=no
+		    func_dirname &quot;$lib&quot; &quot;&quot; &quot;.&quot;
+		    ladir=&quot;$func_dirname_result&quot;
+		    lib=$ladir/$old_library
+		    if test &quot;$linkmode,$pass&quot; = &quot;prog,link&quot;; then
+		      compile_deplibs=&quot;$deplib $compile_deplibs&quot;
+		      finalize_deplibs=&quot;$deplib $finalize_deplibs&quot;
+		    else
+		      deplibs=&quot;$deplib $deplibs&quot;
+		      test &quot;$linkmode&quot; = lib &amp;&amp; newdependency_libs=&quot;$deplib $newdependency_libs&quot;
+		    fi
+		    continue
+		  fi
+		fi
+		;;
+	      *) ;;
+	      esac
+	    fi
+	  fi
+	  ;; # -l
+	*.ltframework)
+	  if test &quot;$linkmode,$pass&quot; = &quot;prog,link&quot;; then
+	    compile_deplibs=&quot;$deplib $compile_deplibs&quot;
+	    finalize_deplibs=&quot;$deplib $finalize_deplibs&quot;
+	  else
+	    deplibs=&quot;$deplib $deplibs&quot;
+	    if test &quot;$linkmode&quot; = lib ; then
+		case &quot;$new_inherited_linker_flags &quot; in
+		    *&quot; $deplib &quot;*) ;;
+		    * ) func_append new_inherited_linker_flags &quot; $deplib&quot; ;;
+		esac
+	    fi
+	  fi
+	  continue
+	  ;;
+	-L*)
+	  case $linkmode in
+	  lib)
+	    deplibs=&quot;$deplib $deplibs&quot;
+	    test &quot;$pass&quot; = conv &amp;&amp; continue
+	    newdependency_libs=&quot;$deplib $newdependency_libs&quot;
+	    func_stripname '-L' '' &quot;$deplib&quot;
+	    func_resolve_sysroot &quot;$func_stripname_result&quot;
+	    func_append newlib_search_path &quot; $func_resolve_sysroot_result&quot;
+	    ;;
+	  prog)
+	    if test &quot;$pass&quot; = conv; then
+	      deplibs=&quot;$deplib $deplibs&quot;
+	      continue
+	    fi
+	    if test &quot;$pass&quot; = scan; then
+	      deplibs=&quot;$deplib $deplibs&quot;
+	    else
+	      compile_deplibs=&quot;$deplib $compile_deplibs&quot;
+	      finalize_deplibs=&quot;$deplib $finalize_deplibs&quot;
+	    fi
+	    func_stripname '-L' '' &quot;$deplib&quot;
+	    func_resolve_sysroot &quot;$func_stripname_result&quot;
+	    func_append newlib_search_path &quot; $func_resolve_sysroot_result&quot;
+	    ;;
+	  *)
+	    func_warning &quot;\`-L' is ignored for archives/objects&quot;
+	    ;;
+	  esac # linkmode
+	  continue
+	  ;; # -L
+	-R*)
+	  if test &quot;$pass&quot; = link; then
+	    func_stripname '-R' '' &quot;$deplib&quot;
+	    func_resolve_sysroot &quot;$func_stripname_result&quot;
+	    dir=$func_resolve_sysroot_result
+	    # Make sure the xrpath contains only unique directories.
+	    case &quot;$xrpath &quot; in
+	    *&quot; $dir &quot;*) ;;
+	    *) func_append xrpath &quot; $dir&quot; ;;
+	    esac
+	  fi
+	  deplibs=&quot;$deplib $deplibs&quot;
+	  continue
+	  ;;
+	*.la)
+	  func_resolve_sysroot &quot;$deplib&quot;
+	  lib=$func_resolve_sysroot_result
+	  ;;
+	*.$libext)
+	  if test &quot;$pass&quot; = conv; then
+	    deplibs=&quot;$deplib $deplibs&quot;
+	    continue
+	  fi
+	  case $linkmode in
+	  lib)
+	    # Linking convenience modules into shared libraries is allowed,
+	    # but linking other static libraries is non-portable.
+	    case &quot; $dlpreconveniencelibs &quot; in
+	    *&quot; $deplib &quot;*) ;;
+	    *)
+	      valid_a_lib=no
+	      case $deplibs_check_method in
+		match_pattern*)
+		  set dummy $deplibs_check_method; shift
+		  match_pattern_regex=`expr &quot;$deplibs_check_method&quot; : &quot;$1 \(.*\)&quot;`
+		  if eval &quot;\$ECHO \&quot;$deplib\&quot;&quot; 2&gt;/dev/null | $SED 10q \
+		    | $EGREP &quot;$match_pattern_regex&quot; &gt; /dev/null; then
+		    valid_a_lib=yes
+		  fi
+		;;
+		pass_all)
+		  valid_a_lib=yes
+		;;
+	      esac
+	      if test &quot;$valid_a_lib&quot; != yes; then
+		echo
+		$ECHO &quot;*** Warning: Trying to link with static lib archive $deplib.&quot;
+		echo &quot;*** I have the capability to make that library automatically link in when&quot;
+		echo &quot;*** you link to this library.  But I can only do this if you have a&quot;
+		echo &quot;*** shared version of the library, which you do not appear to have&quot;
+		echo &quot;*** because the file extensions .$libext of this argument makes me believe&quot;
+		echo &quot;*** that it is just a static archive that I should not use here.&quot;
+	      else
+		echo
+		$ECHO &quot;*** Warning: Linking the shared library $output against the&quot;
+		$ECHO &quot;*** static library $deplib is not portable!&quot;
+		deplibs=&quot;$deplib $deplibs&quot;
+	      fi
+	      ;;
+	    esac
+	    continue
+	    ;;
+	  prog)
+	    if test &quot;$pass&quot; != link; then
+	      deplibs=&quot;$deplib $deplibs&quot;
+	    else
+	      compile_deplibs=&quot;$deplib $compile_deplibs&quot;
+	      finalize_deplibs=&quot;$deplib $finalize_deplibs&quot;
+	    fi
+	    continue
+	    ;;
+	  esac # linkmode
+	  ;; # *.$libext
+	*.lo | *.$objext)
+	  if test &quot;$pass&quot; = conv; then
+	    deplibs=&quot;$deplib $deplibs&quot;
+	  elif test &quot;$linkmode&quot; = prog; then
+	    if test &quot;$pass&quot; = dlpreopen || test &quot;$dlopen_support&quot; != yes || test &quot;$build_libtool_libs&quot; = no; then
+	      # If there is no dlopen support or we're linking statically,
+	      # we need to preload.
+	      func_append newdlprefiles &quot; $deplib&quot;
+	      compile_deplibs=&quot;$deplib $compile_deplibs&quot;
+	      finalize_deplibs=&quot;$deplib $finalize_deplibs&quot;
+	    else
+	      func_append newdlfiles &quot; $deplib&quot;
+	    fi
+	  fi
+	  continue
+	  ;;
+	%DEPLIBS%)
+	  alldeplibs=yes
+	  continue
+	  ;;
+	esac # case $deplib
+
+	if test &quot;$found&quot; = yes || test -f &quot;$lib&quot;; then :
+	else
+	  func_fatal_error &quot;cannot find the library \`$lib' or unhandled argument \`$deplib'&quot;
+	fi
+
+	# Check to see that this really is a libtool archive.
+	func_lalib_unsafe_p &quot;$lib&quot; \
+	  || func_fatal_error &quot;\`$lib' is not a valid libtool archive&quot;
+
+	func_dirname &quot;$lib&quot; &quot;&quot; &quot;.&quot;
+	ladir=&quot;$func_dirname_result&quot;
+
+	dlname=
+	dlopen=
+	dlpreopen=
+	libdir=
+	library_names=
+	old_library=
+	inherited_linker_flags=
+	# If the library was installed with an old release of libtool,
+	# it will not redefine variables installed, or shouldnotlink
+	installed=yes
+	shouldnotlink=no
+	avoidtemprpath=
+
+
+	# Read the .la file
+	func_source &quot;$lib&quot;
+
+	# Convert &quot;-framework foo&quot; to &quot;foo.ltframework&quot;
+	if test -n &quot;$inherited_linker_flags&quot;; then
+	  tmp_inherited_linker_flags=`$ECHO &quot;$inherited_linker_flags&quot; | $SED 's/-framework \([^ $]*\)/\1.ltframework/g'`
+	  for tmp_inherited_linker_flag in $tmp_inherited_linker_flags; do
+	    case &quot; $new_inherited_linker_flags &quot; in
+	      *&quot; $tmp_inherited_linker_flag &quot;*) ;;
+	      *) func_append new_inherited_linker_flags &quot; $tmp_inherited_linker_flag&quot;;;
+	    esac
+	  done
+	fi
+	dependency_libs=`$ECHO &quot; $dependency_libs&quot; | $SED 's% \([^ $]*\).ltframework% -framework \1%g'`
+	if test &quot;$linkmode,$pass&quot; = &quot;lib,link&quot; ||
+	   test &quot;$linkmode,$pass&quot; = &quot;prog,scan&quot; ||
+	   { test &quot;$linkmode&quot; != prog &amp;&amp; test &quot;$linkmode&quot; != lib; }; then
+	  test -n &quot;$dlopen&quot; &amp;&amp; func_append dlfiles &quot; $dlopen&quot;
+	  test -n &quot;$dlpreopen&quot; &amp;&amp; func_append dlprefiles &quot; $dlpreopen&quot;
+	fi
+
+	if test &quot;$pass&quot; = conv; then
+	  # Only check for convenience libraries
+	  deplibs=&quot;$lib $deplibs&quot;
+	  if test -z &quot;$libdir&quot;; then
+	    if test -z &quot;$old_library&quot;; then
+	      func_fatal_error &quot;cannot find name of link library for \`$lib'&quot;
+	    fi
+	    # It is a libtool convenience library, so add in its objects.
+	    func_append convenience &quot; $ladir/$objdir/$old_library&quot;
+	    func_append old_convenience &quot; $ladir/$objdir/$old_library&quot;
+	    tmp_libs=
+	    for deplib in $dependency_libs; do
+	      deplibs=&quot;$deplib $deplibs&quot;
+	      if $opt_preserve_dup_deps ; then
+		case &quot;$tmp_libs &quot; in
+		*&quot; $deplib &quot;*) func_append specialdeplibs &quot; $deplib&quot; ;;
+		esac
+	      fi
+	      func_append tmp_libs &quot; $deplib&quot;
+	    done
+	  elif test &quot;$linkmode&quot; != prog &amp;&amp; test &quot;$linkmode&quot; != lib; then
+	    func_fatal_error &quot;\`$lib' is not a convenience library&quot;
+	  fi
+	  continue
+	fi # $pass = conv
+
+
+	# Get the name of the library we link against.
+	linklib=
+	if test -n &quot;$old_library&quot; &amp;&amp;
+	   { test &quot;$prefer_static_libs&quot; = yes ||
+	     test &quot;$prefer_static_libs,$installed&quot; = &quot;built,no&quot;; }; then
+	  linklib=$old_library
+	else
+	  for l in $old_library $library_names; do
+	    linklib=&quot;$l&quot;
+	  done
+	fi
+	if test -z &quot;$linklib&quot;; then
+	  func_fatal_error &quot;cannot find name of link library for \`$lib'&quot;
+	fi
+
+	# This library was specified with -dlopen.
+	if test &quot;$pass&quot; = dlopen; then
+	  if test -z &quot;$libdir&quot;; then
+	    func_fatal_error &quot;cannot -dlopen a convenience library: \`$lib'&quot;
+	  fi
+	  if test -z &quot;$dlname&quot; ||
+	     test &quot;$dlopen_support&quot; != yes ||
+	     test &quot;$build_libtool_libs&quot; = no; then
+	    # If there is no dlname, no dlopen support or we're linking
+	    # statically, we need to preload.  We also need to preload any
+	    # dependent libraries so libltdl's deplib preloader doesn't
+	    # bomb out in the load deplibs phase.
+	    func_append dlprefiles &quot; $lib $dependency_libs&quot;
+	  else
+	    func_append newdlfiles &quot; $lib&quot;
+	  fi
+	  continue
+	fi # $pass = dlopen
+
+	# We need an absolute path.
+	case $ladir in
+	[\\/]* | [A-Za-z]:[\\/]*) abs_ladir=&quot;$ladir&quot; ;;
+	*)
+	  abs_ladir=`cd &quot;$ladir&quot; &amp;&amp; pwd`
+	  if test -z &quot;$abs_ladir&quot;; then
+	    func_warning &quot;cannot determine absolute directory name of \`$ladir'&quot;
+	    func_warning &quot;passing it literally to the linker, although it might fail&quot;
+	    abs_ladir=&quot;$ladir&quot;
+	  fi
+	  ;;
+	esac
+	func_basename &quot;$lib&quot;
+	laname=&quot;$func_basename_result&quot;
+
+	# Find the relevant object directory and library name.
+	if test &quot;X$installed&quot; = Xyes; then
+	  if test ! -f &quot;$lt_sysroot$libdir/$linklib&quot; &amp;&amp; test -f &quot;$abs_ladir/$linklib&quot;; then
+	    func_warning &quot;library \`$lib' was moved.&quot;
+	    dir=&quot;$ladir&quot;
+	    absdir=&quot;$abs_ladir&quot;
+	    libdir=&quot;$abs_ladir&quot;
+	  else
+	    dir=&quot;$lt_sysroot$libdir&quot;
+	    absdir=&quot;$lt_sysroot$libdir&quot;
+	  fi
+	  test &quot;X$hardcode_automatic&quot; = Xyes &amp;&amp; avoidtemprpath=yes
+	else
+	  if test ! -f &quot;$ladir/$objdir/$linklib&quot; &amp;&amp; test -f &quot;$abs_ladir/$linklib&quot;; then
+	    dir=&quot;$ladir&quot;
+	    absdir=&quot;$abs_ladir&quot;
+	    # Remove this search path later
+	    func_append notinst_path &quot; $abs_ladir&quot;
+	  else
+	    dir=&quot;$ladir/$objdir&quot;
+	    absdir=&quot;$abs_ladir/$objdir&quot;
+	    # Remove this search path later
+	    func_append notinst_path &quot; $abs_ladir&quot;
+	  fi
+	fi # $installed = yes
+	func_stripname 'lib' '.la' &quot;$laname&quot;
+	name=$func_stripname_result
+
+	# This library was specified with -dlpreopen.
+	if test &quot;$pass&quot; = dlpreopen; then
+	  if test -z &quot;$libdir&quot; &amp;&amp; test &quot;$linkmode&quot; = prog; then
+	    func_fatal_error &quot;only libraries may -dlpreopen a convenience library: \`$lib'&quot;
+	  fi
+	  case &quot;$host&quot; in
+	    # special handling for platforms with PE-DLLs.
+	    *cygwin* | *mingw* | *cegcc* )
+	      # Linker will automatically link against shared library if both
+	      # static and shared are present.  Therefore, ensure we extract
+	      # symbols from the import library if a shared library is present
+	      # (otherwise, the dlopen module name will be incorrect).  We do
+	      # this by putting the import library name into $newdlprefiles.
+	      # We recover the dlopen module name by 'saving' the la file
+	      # name in a special purpose variable, and (later) extracting the
+	      # dlname from the la file.
+	      if test -n &quot;$dlname&quot;; then
+	        func_tr_sh &quot;$dir/$linklib&quot;
+	        eval &quot;libfile_$func_tr_sh_result=\$abs_ladir/\$laname&quot;
+	        func_append newdlprefiles &quot; $dir/$linklib&quot;
+	      else
+	        func_append newdlprefiles &quot; $dir/$old_library&quot;
+	        # Keep a list of preopened convenience libraries to check
+	        # that they are being used correctly in the link pass.
+	        test -z &quot;$libdir&quot; &amp;&amp; \
+	          func_append dlpreconveniencelibs &quot; $dir/$old_library&quot;
+	      fi
+	    ;;
+	    * )
+	      # Prefer using a static library (so that no silly _DYNAMIC symbols
+	      # are required to link).
+	      if test -n &quot;$old_library&quot;; then
+	        func_append newdlprefiles &quot; $dir/$old_library&quot;
+	        # Keep a list of preopened convenience libraries to check
+	        # that they are being used correctly in the link pass.
+	        test -z &quot;$libdir&quot; &amp;&amp; \
+	          func_append dlpreconveniencelibs &quot; $dir/$old_library&quot;
+	      # Otherwise, use the dlname, so that lt_dlopen finds it.
+	      elif test -n &quot;$dlname&quot;; then
+	        func_append newdlprefiles &quot; $dir/$dlname&quot;
+	      else
+	        func_append newdlprefiles &quot; $dir/$linklib&quot;
+	      fi
+	    ;;
+	  esac
+	fi # $pass = dlpreopen
+
+	if test -z &quot;$libdir&quot;; then
+	  # Link the convenience library
+	  if test &quot;$linkmode&quot; = lib; then
+	    deplibs=&quot;$dir/$old_library $deplibs&quot;
+	  elif test &quot;$linkmode,$pass&quot; = &quot;prog,link&quot;; then
+	    compile_deplibs=&quot;$dir/$old_library $compile_deplibs&quot;
+	    finalize_deplibs=&quot;$dir/$old_library $finalize_deplibs&quot;
+	  else
+	    deplibs=&quot;$lib $deplibs&quot; # used for prog,scan pass
+	  fi
+	  continue
+	fi
+
+
+	if test &quot;$linkmode&quot; = prog &amp;&amp; test &quot;$pass&quot; != link; then
+	  func_append newlib_search_path &quot; $ladir&quot;
+	  deplibs=&quot;$lib $deplibs&quot;
+
+	  linkalldeplibs=no
+	  if test &quot;$link_all_deplibs&quot; != no || test -z &quot;$library_names&quot; ||
+	     test &quot;$build_libtool_libs&quot; = no; then
+	    linkalldeplibs=yes
+	  fi
+
+	  tmp_libs=
+	  for deplib in $dependency_libs; do
+	    case $deplib in
+	    -L*) func_stripname '-L' '' &quot;$deplib&quot;
+	         func_resolve_sysroot &quot;$func_stripname_result&quot;
+	         func_append newlib_search_path &quot; $func_resolve_sysroot_result&quot;
+		 ;;
+	    esac
+	    # Need to link against all dependency_libs?
+	    if test &quot;$linkalldeplibs&quot; = yes; then
+	      deplibs=&quot;$deplib $deplibs&quot;
+	    else
+	      # Need to hardcode shared library paths
+	      # or/and link against static libraries
+	      newdependency_libs=&quot;$deplib $newdependency_libs&quot;
+	    fi
+	    if $opt_preserve_dup_deps ; then
+	      case &quot;$tmp_libs &quot; in
+	      *&quot; $deplib &quot;*) func_append specialdeplibs &quot; $deplib&quot; ;;
+	      esac
+	    fi
+	    func_append tmp_libs &quot; $deplib&quot;
+	  done # for deplib
+	  continue
+	fi # $linkmode = prog...
+
+	if test &quot;$linkmode,$pass&quot; = &quot;prog,link&quot;; then
+	  if test -n &quot;$library_names&quot; &amp;&amp;
+	     { { test &quot;$prefer_static_libs&quot; = no ||
+	         test &quot;$prefer_static_libs,$installed&quot; = &quot;built,yes&quot;; } ||
+	       test -z &quot;$old_library&quot;; }; then
+	    # We need to hardcode the library path
+	    if test -n &quot;$shlibpath_var&quot; &amp;&amp; test -z &quot;$avoidtemprpath&quot; ; then
+	      # Make sure the rpath contains only unique directories.
+	      case &quot;$temp_rpath:&quot; in
+	      *&quot;$absdir:&quot;*) ;;
+	      *) func_append temp_rpath &quot;$absdir:&quot; ;;
+	      esac
+	    fi
+
+	    # Hardcode the library path.
+	    # Skip directories that are in the system default run-time
+	    # search path.
+	    case &quot; $sys_lib_dlsearch_path &quot; in
+	    *&quot; $absdir &quot;*) ;;
+	    *)
+	      case &quot;$compile_rpath &quot; in
+	      *&quot; $absdir &quot;*) ;;
+	      *) func_append compile_rpath &quot; $absdir&quot; ;;
+	      esac
+	      ;;
+	    esac
+	    case &quot; $sys_lib_dlsearch_path &quot; in
+	    *&quot; $libdir &quot;*) ;;
+	    *)
+	      case &quot;$finalize_rpath &quot; in
+	      *&quot; $libdir &quot;*) ;;
+	      *) func_append finalize_rpath &quot; $libdir&quot; ;;
+	      esac
+	      ;;
+	    esac
+	  fi # $linkmode,$pass = prog,link...
+
+	  if test &quot;$alldeplibs&quot; = yes &amp;&amp;
+	     { test &quot;$deplibs_check_method&quot; = pass_all ||
+	       { test &quot;$build_libtool_libs&quot; = yes &amp;&amp;
+		 test -n &quot;$library_names&quot;; }; }; then
+	    # We only need to search for static libraries
+	    continue
+	  fi
+	fi
+
+	link_static=no # Whether the deplib will be linked statically
+	use_static_libs=$prefer_static_libs
+	if test &quot;$use_static_libs&quot; = built &amp;&amp; test &quot;$installed&quot; = yes; then
+	  use_static_libs=no
+	fi
+	if test -n &quot;$library_names&quot; &amp;&amp;
+	   { test &quot;$use_static_libs&quot; = no || test -z &quot;$old_library&quot;; }; then
+	  case $host in
+	  *cygwin* | *mingw* | *cegcc*)
+	      # No point in relinking DLLs because paths are not encoded
+	      func_append notinst_deplibs &quot; $lib&quot;
+	      need_relink=no
+	    ;;
+	  *)
+	    if test &quot;$installed&quot; = no; then
+	      func_append notinst_deplibs &quot; $lib&quot;
+	      need_relink=yes
+	    fi
+	    ;;
+	  esac
+	  # This is a shared library
+
+	  # Warn about portability, can't link against -module's on some
+	  # systems (darwin).  Don't bleat about dlopened modules though!
+	  dlopenmodule=&quot;&quot;
+	  for dlpremoduletest in $dlprefiles; do
+	    if test &quot;X$dlpremoduletest&quot; = &quot;X$lib&quot;; then
+	      dlopenmodule=&quot;$dlpremoduletest&quot;
+	      break
+	    fi
+	  done
+	  if test -z &quot;$dlopenmodule&quot; &amp;&amp; test &quot;$shouldnotlink&quot; = yes &amp;&amp; test &quot;$pass&quot; = link; then
+	    echo
+	    if test &quot;$linkmode&quot; = prog; then
+	      $ECHO &quot;*** Warning: Linking the executable $output against the loadable module&quot;
+	    else
+	      $ECHO &quot;*** Warning: Linking the shared library $output against the loadable module&quot;
+	    fi
+	    $ECHO &quot;*** $linklib is not portable!&quot;
+	  fi
+	  if test &quot;$linkmode&quot; = lib &amp;&amp;
+	     test &quot;$hardcode_into_libs&quot; = yes; then
+	    # Hardcode the library path.
+	    # Skip directories that are in the system default run-time
+	    # search path.
+	    case &quot; $sys_lib_dlsearch_path &quot; in
+	    *&quot; $absdir &quot;*) ;;
+	    *)
+	      case &quot;$compile_rpath &quot; in
+	      *&quot; $absdir &quot;*) ;;
+	      *) func_append compile_rpath &quot; $absdir&quot; ;;
+	      esac
+	      ;;
+	    esac
+	    case &quot; $sys_lib_dlsearch_path &quot; in
+	    *&quot; $libdir &quot;*) ;;
+	    *)
+	      case &quot;$finalize_rpath &quot; in
+	      *&quot; $libdir &quot;*) ;;
+	      *) func_append finalize_rpath &quot; $libdir&quot; ;;
+	      esac
+	      ;;
+	    esac
+	  fi
+
+	  if test -n &quot;$old_archive_from_expsyms_cmds&quot;; then
+	    # figure out the soname
+	    set dummy $library_names
+	    shift
+	    realname=&quot;$1&quot;
+	    shift
+	    libname=`eval &quot;\\$ECHO \&quot;$libname_spec\&quot;&quot;`
+	    # use dlname if we got it. it's perfectly good, no?
+	    if test -n &quot;$dlname&quot;; then
+	      soname=&quot;$dlname&quot;
+	    elif test -n &quot;$soname_spec&quot;; then
+	      # bleh windows
+	      case $host in
+	      *cygwin* | mingw* | *cegcc*)
+	        func_arith $current - $age
+		major=$func_arith_result
+		versuffix=&quot;-$major&quot;
+		;;
+	      esac
+	      eval soname=\&quot;$soname_spec\&quot;
+	    else
+	      soname=&quot;$realname&quot;
+	    fi
+
+	    # Make a new name for the extract_expsyms_cmds to use
+	    soroot=&quot;$soname&quot;
+	    func_basename &quot;$soroot&quot;
+	    soname=&quot;$func_basename_result&quot;
+	    func_stripname 'lib' '.dll' &quot;$soname&quot;
+	    newlib=libimp-$func_stripname_result.a
+
+	    # If the library has no export list, then create one now
+	    if test -f &quot;$output_objdir/$soname-def&quot;; then :
+	    else
+	      func_verbose &quot;extracting exported symbol list from \`$soname'&quot;
+	      func_execute_cmds &quot;$extract_expsyms_cmds&quot; 'exit $?'
+	    fi
+
+	    # Create $newlib
+	    if test -f &quot;$output_objdir/$newlib&quot;; then :; else
+	      func_verbose &quot;generating import library for \`$soname'&quot;
+	      func_execute_cmds &quot;$old_archive_from_expsyms_cmds&quot; 'exit $?'
+	    fi
+	    # make sure the library variables are pointing to the new library
+	    dir=$output_objdir
+	    linklib=$newlib
+	  fi # test -n &quot;$old_archive_from_expsyms_cmds&quot;
+
+	  if test &quot;$linkmode&quot; = prog || test &quot;$opt_mode&quot; != relink; then
+	    add_shlibpath=
+	    add_dir=
+	    add=
+	    lib_linked=yes
+	    case $hardcode_action in
+	    immediate | unsupported)
+	      if test &quot;$hardcode_direct&quot; = no; then
+		add=&quot;$dir/$linklib&quot;
+		case $host in
+		  *-*-sco3.2v5.0.[024]*) add_dir=&quot;-L$dir&quot; ;;
+		  *-*-sysv4*uw2*) add_dir=&quot;-L$dir&quot; ;;
+		  *-*-sysv5OpenUNIX* | *-*-sysv5UnixWare7.[01].[10]* | \
+		    *-*-unixware7*) add_dir=&quot;-L$dir&quot; ;;
+		  *-*-darwin* )
+		    # if the lib is a (non-dlopened) module then we can not
+		    # link against it, someone is ignoring the earlier warnings
+		    if /usr/bin/file -L $add 2&gt; /dev/null |
+			 $GREP &quot;: [^:]* bundle&quot; &gt;/dev/null ; then
+		      if test &quot;X$dlopenmodule&quot; != &quot;X$lib&quot;; then
+			$ECHO &quot;*** Warning: lib $linklib is a module, not a shared library&quot;
+			if test -z &quot;$old_library&quot; ; then
+			  echo
+			  echo &quot;*** And there doesn't seem to be a static archive available&quot;
+			  echo &quot;*** The link will probably fail, sorry&quot;
+			else
+			  add=&quot;$dir/$old_library&quot;
+			fi
+		      elif test -n &quot;$old_library&quot;; then
+			add=&quot;$dir/$old_library&quot;
+		      fi
+		    fi
+		esac
+	      elif test &quot;$hardcode_minus_L&quot; = no; then
+		case $host in
+		*-*-sunos*) add_shlibpath=&quot;$dir&quot; ;;
+		esac
+		add_dir=&quot;-L$dir&quot;
+		add=&quot;-l$name&quot;
+	      elif test &quot;$hardcode_shlibpath_var&quot; = no; then
+		add_shlibpath=&quot;$dir&quot;
+		add=&quot;-l$name&quot;
+	      else
+		lib_linked=no
+	      fi
+	      ;;
+	    relink)
+	      if test &quot;$hardcode_direct&quot; = yes &amp;&amp;
+	         test &quot;$hardcode_direct_absolute&quot; = no; then
+		add=&quot;$dir/$linklib&quot;
+	      elif test &quot;$hardcode_minus_L&quot; = yes; then
+		add_dir=&quot;-L$dir&quot;
+		# Try looking first in the location we're being installed to.
+		if test -n &quot;$inst_prefix_dir&quot;; then
+		  case $libdir in
+		    [\\/]*)
+		      func_append add_dir &quot; -L$inst_prefix_dir$libdir&quot;
+		      ;;
+		  esac
+		fi
+		add=&quot;-l$name&quot;
+	      elif test &quot;$hardcode_shlibpath_var&quot; = yes; then
+		add_shlibpath=&quot;$dir&quot;
+		add=&quot;-l$name&quot;
+	      else
+		lib_linked=no
+	      fi
+	      ;;
+	    *) lib_linked=no ;;
+	    esac
+
+	    if test &quot;$lib_linked&quot; != yes; then
+	      func_fatal_configuration &quot;unsupported hardcode properties&quot;
+	    fi
+
+	    if test -n &quot;$add_shlibpath&quot;; then
+	      case :$compile_shlibpath: in
+	      *&quot;:$add_shlibpath:&quot;*) ;;
+	      *) func_append compile_shlibpath &quot;$add_shlibpath:&quot; ;;
+	      esac
+	    fi
+	    if test &quot;$linkmode&quot; = prog; then
+	      test -n &quot;$add_dir&quot; &amp;&amp; compile_deplibs=&quot;$add_dir $compile_deplibs&quot;
+	      test -n &quot;$add&quot; &amp;&amp; compile_deplibs=&quot;$add $compile_deplibs&quot;
+	    else
+	      test -n &quot;$add_dir&quot; &amp;&amp; deplibs=&quot;$add_dir $deplibs&quot;
+	      test -n &quot;$add&quot; &amp;&amp; deplibs=&quot;$add $deplibs&quot;
+	      if test &quot;$hardcode_direct&quot; != yes &amp;&amp;
+		 test &quot;$hardcode_minus_L&quot; != yes &amp;&amp;
+		 test &quot;$hardcode_shlibpath_var&quot; = yes; then
+		case :$finalize_shlibpath: in
+		*&quot;:$libdir:&quot;*) ;;
+		*) func_append finalize_shlibpath &quot;$libdir:&quot; ;;
+		esac
+	      fi
+	    fi
+	  fi
+
+	  if test &quot;$linkmode&quot; = prog || test &quot;$opt_mode&quot; = relink; then
+	    add_shlibpath=
+	    add_dir=
+	    add=
+	    # Finalize command for both is simple: just hardcode it.
+	    if test &quot;$hardcode_direct&quot; = yes &amp;&amp;
+	       test &quot;$hardcode_direct_absolute&quot; = no; then
+	      add=&quot;$libdir/$linklib&quot;
+	    elif test &quot;$hardcode_minus_L&quot; = yes; then
+	      add_dir=&quot;-L$libdir&quot;
+	      add=&quot;-l$name&quot;
+	    elif test &quot;$hardcode_shlibpath_var&quot; = yes; then
+	      case :$finalize_shlibpath: in
+	      *&quot;:$libdir:&quot;*) ;;
+	      *) func_append finalize_shlibpath &quot;$libdir:&quot; ;;
+	      esac
+	      add=&quot;-l$name&quot;
+	    elif test &quot;$hardcode_automatic&quot; = yes; then
+	      if test -n &quot;$inst_prefix_dir&quot; &amp;&amp;
+		 test -f &quot;$inst_prefix_dir$libdir/$linklib&quot; ; then
+		add=&quot;$inst_prefix_dir$libdir/$linklib&quot;
+	      else
+		add=&quot;$libdir/$linklib&quot;
+	      fi
+	    else
+	      # We cannot seem to hardcode it, guess we'll fake it.
+	      add_dir=&quot;-L$libdir&quot;
+	      # Try looking first in the location we're being installed to.
+	      if test -n &quot;$inst_prefix_dir&quot;; then
+		case $libdir in
+		  [\\/]*)
+		    func_append add_dir &quot; -L$inst_prefix_dir$libdir&quot;
+		    ;;
+		esac
+	      fi
+	      add=&quot;-l$name&quot;
+	    fi
+
+	    if test &quot;$linkmode&quot; = prog; then
+	      test -n &quot;$add_dir&quot; &amp;&amp; finalize_deplibs=&quot;$add_dir $finalize_deplibs&quot;
+	      test -n &quot;$add&quot; &amp;&amp; finalize_deplibs=&quot;$add $finalize_deplibs&quot;
+	    else
+	      test -n &quot;$add_dir&quot; &amp;&amp; deplibs=&quot;$add_dir $deplibs&quot;
+	      test -n &quot;$add&quot; &amp;&amp; deplibs=&quot;$add $deplibs&quot;
+	    fi
+	  fi
+	elif test &quot;$linkmode&quot; = prog; then
+	  # Here we assume that one of hardcode_direct or hardcode_minus_L
+	  # is not unsupported.  This is valid on all known static and
+	  # shared platforms.
+	  if test &quot;$hardcode_direct&quot; != unsupported; then
+	    test -n &quot;$old_library&quot; &amp;&amp; linklib=&quot;$old_library&quot;
+	    compile_deplibs=&quot;$dir/$linklib $compile_deplibs&quot;
+	    finalize_deplibs=&quot;$dir/$linklib $finalize_deplibs&quot;
+	  else
+	    compile_deplibs=&quot;-l$name -L$dir $compile_deplibs&quot;
+	    finalize_deplibs=&quot;-l$name -L$dir $finalize_deplibs&quot;
+	  fi
+	elif test &quot;$build_libtool_libs&quot; = yes; then
+	  # Not a shared library
+	  if test &quot;$deplibs_check_method&quot; != pass_all; then
+	    # We're trying link a shared library against a static one
+	    # but the system doesn't support it.
+
+	    # Just print a warning and add the library to dependency_libs so
+	    # that the program can be linked against the static library.
+	    echo
+	    $ECHO &quot;*** Warning: This system can not link to static lib archive $lib.&quot;
+	    echo &quot;*** I have the capability to make that library automatically link in when&quot;
+	    echo &quot;*** you link to this library.  But I can only do this if you have a&quot;
+	    echo &quot;*** shared version of the library, which you do not appear to have.&quot;
+	    if test &quot;$module&quot; = yes; then
+	      echo &quot;*** But as you try to build a module library, libtool will still create &quot;
+	      echo &quot;*** a static module, that should work as long as the dlopening application&quot;
+	      echo &quot;*** is linked with the -dlopen flag to resolve symbols at runtime.&quot;
+	      if test -z &quot;$global_symbol_pipe&quot;; then
+		echo
+		echo &quot;*** However, this would only work if libtool was able to extract symbol&quot;
+		echo &quot;*** lists from a program, using \`nm' or equivalent, but libtool could&quot;
+		echo &quot;*** not find such a program.  So, this module is probably useless.&quot;
+		echo &quot;*** \`nm' from GNU binutils and a full rebuild may help.&quot;
+	      fi
+	      if test &quot;$build_old_libs&quot; = no; then
+		build_libtool_libs=module
+		build_old_libs=yes
+	      else
+		build_libtool_libs=no
+	      fi
+	    fi
+	  else
+	    deplibs=&quot;$dir/$old_library $deplibs&quot;
+	    link_static=yes
+	  fi
+	fi # link shared/static library?
+
+	if test &quot;$linkmode&quot; = lib; then
+	  if test -n &quot;$dependency_libs&quot; &amp;&amp;
+	     { test &quot;$hardcode_into_libs&quot; != yes ||
+	       test &quot;$build_old_libs&quot; = yes ||
+	       test &quot;$link_static&quot; = yes; }; then
+	    # Extract -R from dependency_libs
+	    temp_deplibs=
+	    for libdir in $dependency_libs; do
+	      case $libdir in
+	      -R*) func_stripname '-R' '' &quot;$libdir&quot;
+	           temp_xrpath=$func_stripname_result
+		   case &quot; $xrpath &quot; in
+		   *&quot; $temp_xrpath &quot;*) ;;
+		   *) func_append xrpath &quot; $temp_xrpath&quot;;;
+		   esac;;
+	      *) func_append temp_deplibs &quot; $libdir&quot;;;
+	      esac
+	    done
+	    dependency_libs=&quot;$temp_deplibs&quot;
+	  fi
+
+	  func_append newlib_search_path &quot; $absdir&quot;
+	  # Link against this library
+	  test &quot;$link_static&quot; = no &amp;&amp; newdependency_libs=&quot;$abs_ladir/$laname $newdependency_libs&quot;
+	  # ... and its dependency_libs
+	  tmp_libs=
+	  for deplib in $dependency_libs; do
+	    newdependency_libs=&quot;$deplib $newdependency_libs&quot;
+	    case $deplib in
+              -L*) func_stripname '-L' '' &quot;$deplib&quot;
+                   func_resolve_sysroot &quot;$func_stripname_result&quot;;;
+              *) func_resolve_sysroot &quot;$deplib&quot; ;;
+            esac
+	    if $opt_preserve_dup_deps ; then
+	      case &quot;$tmp_libs &quot; in
+	      *&quot; $func_resolve_sysroot_result &quot;*)
+                func_append specialdeplibs &quot; $func_resolve_sysroot_result&quot; ;;
+	      esac
+	    fi
+	    func_append tmp_libs &quot; $func_resolve_sysroot_result&quot;
+	  done
+
+	  if test &quot;$link_all_deplibs&quot; != no; then
+	    # Add the search paths of all dependency libraries
+	    for deplib in $dependency_libs; do
+	      path=
+	      case $deplib in
+	      -L*) path=&quot;$deplib&quot; ;;
+	      *.la)
+	        func_resolve_sysroot &quot;$deplib&quot;
+	        deplib=$func_resolve_sysroot_result
+	        func_dirname &quot;$deplib&quot; &quot;&quot; &quot;.&quot;
+		dir=$func_dirname_result
+		# We need an absolute path.
+		case $dir in
+		[\\/]* | [A-Za-z]:[\\/]*) absdir=&quot;$dir&quot; ;;
+		*)
+		  absdir=`cd &quot;$dir&quot; &amp;&amp; pwd`
+		  if test -z &quot;$absdir&quot;; then
+		    func_warning &quot;cannot determine absolute directory name of \`$dir'&quot;
+		    absdir=&quot;$dir&quot;
+		  fi
+		  ;;
+		esac
+		if $GREP &quot;^installed=no&quot; $deplib &gt; /dev/null; then
+		case $host in
+		*-*-darwin*)
+		  depdepl=
+		  eval deplibrary_names=`${SED} -n -e 's/^library_names=\(.*\)$/\1/p' $deplib`
+		  if test -n &quot;$deplibrary_names&quot; ; then
+		    for tmp in $deplibrary_names ; do
+		      depdepl=$tmp
+		    done
+		    if test -f &quot;$absdir/$objdir/$depdepl&quot; ; then
+		      depdepl=&quot;$absdir/$objdir/$depdepl&quot;
+		      darwin_install_name=`${OTOOL} -L $depdepl | awk '{if (NR == 2) {print $1;exit}}'`
+                      if test -z &quot;$darwin_install_name&quot;; then
+                          darwin_install_name=`${OTOOL64} -L $depdepl  | awk '{if (NR == 2) {print $1;exit}}'`
+                      fi
+		      func_append compiler_flags &quot; ${wl}-dylib_file ${wl}${darwin_install_name}:${depdepl}&quot;
+		      func_append linker_flags &quot; -dylib_file ${darwin_install_name}:${depdepl}&quot;
+		      path=
+		    fi
+		  fi
+		  ;;
+		*)
+		  path=&quot;-L$absdir/$objdir&quot;
+		  ;;
+		esac
+		else
+		  eval libdir=`${SED} -n -e 's/^libdir=\(.*\)$/\1/p' $deplib`
+		  test -z &quot;$libdir&quot; &amp;&amp; \
+		    func_fatal_error &quot;\`$deplib' is not a valid libtool archive&quot;
+		  test &quot;$absdir&quot; != &quot;$libdir&quot; &amp;&amp; \
+		    func_warning &quot;\`$deplib' seems to be moved&quot;
+
+		  path=&quot;-L$absdir&quot;
+		fi
+		;;
+	      esac
+	      case &quot; $deplibs &quot; in
+	      *&quot; $path &quot;*) ;;
+	      *) deplibs=&quot;$path $deplibs&quot; ;;
+	      esac
+	    done
+	  fi # link_all_deplibs != no
+	fi # linkmode = lib
+      done # for deplib in $libs
+      if test &quot;$pass&quot; = link; then
+	if test &quot;$linkmode&quot; = &quot;prog&quot;; then
+	  compile_deplibs=&quot;$new_inherited_linker_flags $compile_deplibs&quot;
+	  finalize_deplibs=&quot;$new_inherited_linker_flags $finalize_deplibs&quot;
+	else
+	  compiler_flags=&quot;$compiler_flags &quot;`$ECHO &quot; $new_inherited_linker_flags&quot; | $SED 's% \([^ $]*\).ltframework% -framework \1%g'`
+	fi
+      fi
+      dependency_libs=&quot;$newdependency_libs&quot;
+      if test &quot;$pass&quot; = dlpreopen; then
+	# Link the dlpreopened libraries before other libraries
+	for deplib in $save_deplibs; do
+	  deplibs=&quot;$deplib $deplibs&quot;
+	done
+      fi
+      if test &quot;$pass&quot; != dlopen; then
+	if test &quot;$pass&quot; != conv; then
+	  # Make sure lib_search_path contains only unique directories.
+	  lib_search_path=
+	  for dir in $newlib_search_path; do
+	    case &quot;$lib_search_path &quot; in
+	    *&quot; $dir &quot;*) ;;
+	    *) func_append lib_search_path &quot; $dir&quot; ;;
+	    esac
+	  done
+	  newlib_search_path=
+	fi
+
+	if test &quot;$linkmode,$pass&quot; != &quot;prog,link&quot;; then
+	  vars=&quot;deplibs&quot;
+	else
+	  vars=&quot;compile_deplibs finalize_deplibs&quot;
+	fi
+	for var in $vars dependency_libs; do
+	  # Add libraries to $var in reverse order
+	  eval tmp_libs=\&quot;\$$var\&quot;
+	  new_libs=
+	  for deplib in $tmp_libs; do
+	    # FIXME: Pedantically, this is the right thing to do, so
+	    #        that some nasty dependency loop isn't accidentally
+	    #        broken:
+	    #new_libs=&quot;$deplib $new_libs&quot;
+	    # Pragmatically, this seems to cause very few problems in
+	    # practice:
+	    case $deplib in
+	    -L*) new_libs=&quot;$deplib $new_libs&quot; ;;
+	    -R*) ;;
+	    *)
+	      # And here is the reason: when a library appears more
+	      # than once as an explicit dependence of a library, or
+	      # is implicitly linked in more than once by the
+	      # compiler, it is considered special, and multiple
+	      # occurrences thereof are not removed.  Compare this
+	      # with having the same library being listed as a
+	      # dependency of multiple other libraries: in this case,
+	      # we know (pedantically, we assume) the library does not
+	      # need to be listed more than once, so we keep only the
+	      # last copy.  This is not always right, but it is rare
+	      # enough that we require users that really mean to play
+	      # such unportable linking tricks to link the library
+	      # using -Wl,-lname, so that libtool does not consider it
+	      # for duplicate removal.
+	      case &quot; $specialdeplibs &quot; in
+	      *&quot; $deplib &quot;*) new_libs=&quot;$deplib $new_libs&quot; ;;
+	      *)
+		case &quot; $new_libs &quot; in
+		*&quot; $deplib &quot;*) ;;
+		*) new_libs=&quot;$deplib $new_libs&quot; ;;
+		esac
+		;;
+	      esac
+	      ;;
+	    esac
+	  done
+	  tmp_libs=
+	  for deplib in $new_libs; do
+	    case $deplib in
+	    -L*)
+	      case &quot; $tmp_libs &quot; in
+	      *&quot; $deplib &quot;*) ;;
+	      *) func_append tmp_libs &quot; $deplib&quot; ;;
+	      esac
+	      ;;
+	    *) func_append tmp_libs &quot; $deplib&quot; ;;
+	    esac
+	  done
+	  eval $var=\&quot;$tmp_libs\&quot;
+	done # for var
+      fi
+      # Last step: remove runtime libs from dependency_libs
+      # (they stay in deplibs)
+      tmp_libs=
+      for i in $dependency_libs ; do
+	case &quot; $predeps $postdeps $compiler_lib_search_path &quot; in
+	*&quot; $i &quot;*)
+	  i=&quot;&quot;
+	  ;;
+	esac
+	if test -n &quot;$i&quot; ; then
+	  func_append tmp_libs &quot; $i&quot;
+	fi
+      done
+      dependency_libs=$tmp_libs
+    done # for pass
+    if test &quot;$linkmode&quot; = prog; then
+      dlfiles=&quot;$newdlfiles&quot;
+    fi
+    if test &quot;$linkmode&quot; = prog || test &quot;$linkmode&quot; = lib; then
+      dlprefiles=&quot;$newdlprefiles&quot;
+    fi
+
+    case $linkmode in
+    oldlib)
+      if test -n &quot;$dlfiles$dlprefiles&quot; || test &quot;$dlself&quot; != no; then
+	func_warning &quot;\`-dlopen' is ignored for archives&quot;
+      fi
+
+      case &quot; $deplibs&quot; in
+      *\ -l* | *\ -L*)
+	func_warning &quot;\`-l' and \`-L' are ignored for archives&quot; ;;
+      esac
+
+      test -n &quot;$rpath&quot; &amp;&amp; \
+	func_warning &quot;\`-rpath' is ignored for archives&quot;
+
+      test -n &quot;$xrpath&quot; &amp;&amp; \
+	func_warning &quot;\`-R' is ignored for archives&quot;
+
+      test -n &quot;$vinfo&quot; &amp;&amp; \
+	func_warning &quot;\`-version-info/-version-number' is ignored for archives&quot;
+
+      test -n &quot;$release&quot; &amp;&amp; \
+	func_warning &quot;\`-release' is ignored for archives&quot;
+
+      test -n &quot;$export_symbols$export_symbols_regex&quot; &amp;&amp; \
+	func_warning &quot;\`-export-symbols' is ignored for archives&quot;
+
+      # Now set the variables for building old libraries.
+      build_libtool_libs=no
+      oldlibs=&quot;$output&quot;
+      func_append objs &quot;$old_deplibs&quot;
+      ;;
+
+    lib)
+      # Make sure we only generate libraries of the form `libNAME.la'.
+      case $outputname in
+      lib*)
+	func_stripname 'lib' '.la' &quot;$outputname&quot;
+	name=$func_stripname_result
+	eval shared_ext=\&quot;$shrext_cmds\&quot;
+	eval libname=\&quot;$libname_spec\&quot;
+	;;
+      *)
+	test &quot;$module&quot; = no &amp;&amp; \
+	  func_fatal_help &quot;libtool library \`$output' must begin with \`lib'&quot;
+
+	if test &quot;$need_lib_prefix&quot; != no; then
+	  # Add the &quot;lib&quot; prefix for modules if required
+	  func_stripname '' '.la' &quot;$outputname&quot;
+	  name=$func_stripname_result
+	  eval shared_ext=\&quot;$shrext_cmds\&quot;
+	  eval libname=\&quot;$libname_spec\&quot;
+	else
+	  func_stripname '' '.la' &quot;$outputname&quot;
+	  libname=$func_stripname_result
+	fi
+	;;
+      esac
+
+      if test -n &quot;$objs&quot;; then
+	if test &quot;$deplibs_check_method&quot; != pass_all; then
+	  func_fatal_error &quot;cannot build libtool library \`$output' from non-libtool objects on this host:$objs&quot;
+	else
+	  echo
+	  $ECHO &quot;*** Warning: Linking the shared library $output against the non-libtool&quot;
+	  $ECHO &quot;*** objects $objs is not portable!&quot;
+	  func_append libobjs &quot; $objs&quot;
+	fi
+      fi
+
+      test &quot;$dlself&quot; != no &amp;&amp; \
+	func_warning &quot;\`-dlopen self' is ignored for libtool libraries&quot;
+
+      set dummy $rpath
+      shift
+      test &quot;$#&quot; -gt 1 &amp;&amp; \
+	func_warning &quot;ignoring multiple \`-rpath's for a libtool library&quot;
+
+      install_libdir=&quot;$1&quot;
+
+      oldlibs=
+      if test -z &quot;$rpath&quot;; then
+	if test &quot;$build_libtool_libs&quot; = yes; then
+	  # Building a libtool convenience library.
+	  # Some compilers have problems with a `.al' extension so
+	  # convenience libraries should have the same extension an
+	  # archive normally would.
+	  oldlibs=&quot;$output_objdir/$libname.$libext $oldlibs&quot;
+	  build_libtool_libs=convenience
+	  build_old_libs=yes
+	fi
+
+	test -n &quot;$vinfo&quot; &amp;&amp; \
+	  func_warning &quot;\`-version-info/-version-number' is ignored for convenience libraries&quot;
+
+	test -n &quot;$release&quot; &amp;&amp; \
+	  func_warning &quot;\`-release' is ignored for convenience libraries&quot;
+      else
+
+	# Parse the version information argument.
+	save_ifs=&quot;$IFS&quot;; IFS=':'
+	set dummy $vinfo 0 0 0
+	shift
+	IFS=&quot;$save_ifs&quot;
+
+	test -n &quot;$7&quot; &amp;&amp; \
+	  func_fatal_help &quot;too many parameters to \`-version-info'&quot;
+
+	# convert absolute version numbers to libtool ages
+	# this retains compatibility with .la files and attempts
+	# to make the code below a bit more comprehensible
+
+	case $vinfo_number in
+	yes)
+	  number_major=&quot;$1&quot;
+	  number_minor=&quot;$2&quot;
+	  number_revision=&quot;$3&quot;
+	  #
+	  # There are really only two kinds -- those that
+	  # use the current revision as the major version
+	  # and those that subtract age and use age as
+	  # a minor version.  But, then there is irix
+	  # which has an extra 1 added just for fun
+	  #
+	  case $version_type in
+	  darwin|linux|osf|windows|none)
+	    func_arith $number_major + $number_minor
+	    current=$func_arith_result
+	    age=&quot;$number_minor&quot;
+	    revision=&quot;$number_revision&quot;
+	    ;;
+	  freebsd-aout|freebsd-elf|qnx|sunos)
+	    current=&quot;$number_major&quot;
+	    revision=&quot;$number_minor&quot;
+	    age=&quot;0&quot;
+	    ;;
+	  irix|nonstopux)
+	    func_arith $number_major + $number_minor
+	    current=$func_arith_result
+	    age=&quot;$number_minor&quot;
+	    revision=&quot;$number_minor&quot;
+	    lt_irix_increment=no
+	    ;;
+	  *)
+	    func_fatal_configuration &quot;$modename: unknown library version type \`$version_type'&quot;
+	    ;;
+	  esac
+	  ;;
+	no)
+	  current=&quot;$1&quot;
+	  revision=&quot;$2&quot;
+	  age=&quot;$3&quot;
+	  ;;
+	esac
+
+	# Check that each of the things are valid numbers.
+	case $current in
+	0|[1-9]|[1-9][0-9]|[1-9][0-9][0-9]|[1-9][0-9][0-9][0-9]|[1-9][0-9][0-9][0-9][0-9]) ;;
+	*)
+	  func_error &quot;CURRENT \`$current' must be a nonnegative integer&quot;
+	  func_fatal_error &quot;\`$vinfo' is not valid version information&quot;
+	  ;;
+	esac
+
+	case $revision in
+	0|[1-9]|[1-9][0-9]|[1-9][0-9][0-9]|[1-9][0-9][0-9][0-9]|[1-9][0-9][0-9][0-9][0-9]) ;;
+	*)
+	  func_error &quot;REVISION \`$revision' must be a nonnegative integer&quot;
+	  func_fatal_error &quot;\`$vinfo' is not valid version information&quot;
+	  ;;
+	esac
+
+	case $age in
+	0|[1-9]|[1-9][0-9]|[1-9][0-9][0-9]|[1-9][0-9][0-9][0-9]|[1-9][0-9][0-9][0-9][0-9]) ;;
+	*)
+	  func_error &quot;AGE \`$age' must be a nonnegative integer&quot;
+	  func_fatal_error &quot;\`$vinfo' is not valid version information&quot;
+	  ;;
+	esac
+
+	if test &quot;$age&quot; -gt &quot;$current&quot;; then
+	  func_error &quot;AGE \`$age' is greater than the current interface number \`$current'&quot;
+	  func_fatal_error &quot;\`$vinfo' is not valid version information&quot;
+	fi
+
+	# Calculate the version variables.
+	major=
+	versuffix=
+	verstring=
+	case $version_type in
+	none) ;;
+
+	darwin)
+	  # Like Linux, but with the current version available in
+	  # verstring for coding it into the library header
+	  func_arith $current - $age
+	  major=.$func_arith_result
+	  versuffix=&quot;$major.$age.$revision&quot;
+	  # Darwin ld doesn't like 0 for these options...
+	  func_arith $current + 1
+	  minor_current=$func_arith_result
+	  xlcverstring=&quot;${wl}-compatibility_version ${wl}$minor_current ${wl}-current_version ${wl}$minor_current.$revision&quot;
+	  verstring=&quot;-compatibility_version $minor_current -current_version $minor_current.$revision&quot;
+	  ;;
+
+	freebsd-aout)
+	  major=&quot;.$current&quot;
+	  versuffix=&quot;.$current.$revision&quot;;
+	  ;;
+
+	freebsd-elf)
+	  major=&quot;.$current&quot;
+	  versuffix=&quot;.$current&quot;
+	  ;;
+
+	irix | nonstopux)
+	  if test &quot;X$lt_irix_increment&quot; = &quot;Xno&quot;; then
+	    func_arith $current - $age
+	  else
+	    func_arith $current - $age + 1
+	  fi
+	  major=$func_arith_result
+
+	  case $version_type in
+	    nonstopux) verstring_prefix=nonstopux ;;
+	    *)         verstring_prefix=sgi ;;
+	  esac
+	  verstring=&quot;$verstring_prefix$major.$revision&quot;
+
+	  # Add in all the interfaces that we are compatible with.
+	  loop=$revision
+	  while test &quot;$loop&quot; -ne 0; do
+	    func_arith $revision - $loop
+	    iface=$func_arith_result
+	    func_arith $loop - 1
+	    loop=$func_arith_result
+	    verstring=&quot;$verstring_prefix$major.$iface:$verstring&quot;
+	  done
+
+	  # Before this point, $major must not contain `.'.
+	  major=.$major
+	  versuffix=&quot;$major.$revision&quot;
+	  ;;
+
+	linux)
+	  func_arith $current - $age
+	  major=.$func_arith_result
+	  versuffix=&quot;$major.$age.$revision&quot;
+	  ;;
+
+	osf)
+	  func_arith $current - $age
+	  major=.$func_arith_result
+	  versuffix=&quot;.$current.$age.$revision&quot;
+	  verstring=&quot;$current.$age.$revision&quot;
+
+	  # Add in all the interfaces that we are compatible with.
+	  loop=$age
+	  while test &quot;$loop&quot; -ne 0; do
+	    func_arith $current - $loop
+	    iface=$func_arith_result
+	    func_arith $loop - 1
+	    loop=$func_arith_result
+	    verstring=&quot;$verstring:${iface}.0&quot;
+	  done
+
+	  # Make executables depend on our current version.
+	  func_append verstring &quot;:${current}.0&quot;
+	  ;;
+
+	qnx)
+	  major=&quot;.$current&quot;
+	  versuffix=&quot;.$current&quot;
+	  ;;
+
+	sunos)
+	  major=&quot;.$current&quot;
+	  versuffix=&quot;.$current.$revision&quot;
+	  ;;
+
+	windows)
+	  # Use '-' rather than '.', since we only want one
+	  # extension on DOS 8.3 filesystems.
+	  func_arith $current - $age
+	  major=$func_arith_result
+	  versuffix=&quot;-$major&quot;
+	  ;;
+
+	*)
+	  func_fatal_configuration &quot;unknown library version type \`$version_type'&quot;
+	  ;;
+	esac
+
+	# Clear the version info if we defaulted, and they specified a release.
+	if test -z &quot;$vinfo&quot; &amp;&amp; test -n &quot;$release&quot;; then
+	  major=
+	  case $version_type in
+	  darwin)
+	    # we can't check for &quot;0.0&quot; in archive_cmds due to quoting
+	    # problems, so we reset it completely
+	    verstring=
+	    ;;
+	  *)
+	    verstring=&quot;0.0&quot;
+	    ;;
+	  esac
+	  if test &quot;$need_version&quot; = no; then
+	    versuffix=
+	  else
+	    versuffix=&quot;.0.0&quot;
+	  fi
+	fi
+
+	# Remove version info from name if versioning should be avoided
+	if test &quot;$avoid_version&quot; = yes &amp;&amp; test &quot;$need_version&quot; = no; then
+	  major=
+	  versuffix=
+	  verstring=&quot;&quot;
+	fi
+
+	# Check to see if the archive will have undefined symbols.
+	if test &quot;$allow_undefined&quot; = yes; then
+	  if test &quot;$allow_undefined_flag&quot; = unsupported; then
+	    func_warning &quot;undefined symbols not allowed in $host shared libraries&quot;
+	    build_libtool_libs=no
+	    build_old_libs=yes
+	  fi
+	else
+	  # Don't allow undefined symbols.
+	  allow_undefined_flag=&quot;$no_undefined_flag&quot;
+	fi
+
+      fi
+
+      func_generate_dlsyms &quot;$libname&quot; &quot;$libname&quot; &quot;yes&quot;
+      func_append libobjs &quot; $symfileobj&quot;
+      test &quot;X$libobjs&quot; = &quot;X &quot; &amp;&amp; libobjs=
+
+      if test &quot;$opt_mode&quot; != relink; then
+	# Remove our outputs, but don't remove object files since they
+	# may have been created when compiling PIC objects.
+	removelist=
+	tempremovelist=`$ECHO &quot;$output_objdir/*&quot;`
+	for p in $tempremovelist; do
+	  case $p in
+	    *.$objext | *.gcno)
+	       ;;
+	    $output_objdir/$outputname | $output_objdir/$libname.* | $output_objdir/${libname}${release}.*)
+	       if test &quot;X$precious_files_regex&quot; != &quot;X&quot;; then
+		 if $ECHO &quot;$p&quot; | $EGREP -e &quot;$precious_files_regex&quot; &gt;/dev/null 2&gt;&amp;1
+		 then
+		   continue
+		 fi
+	       fi
+	       func_append removelist &quot; $p&quot;
+	       ;;
+	    *) ;;
+	  esac
+	done
+	test -n &quot;$removelist&quot; &amp;&amp; \
+	  func_show_eval &quot;${RM}r \$removelist&quot;
+      fi
+
+      # Now set the variables for building old libraries.
+      if test &quot;$build_old_libs&quot; = yes &amp;&amp; test &quot;$build_libtool_libs&quot; != convenience ; then
+	func_append oldlibs &quot; $output_objdir/$libname.$libext&quot;
+
+	# Transform .lo files to .o files.
+	oldobjs=&quot;$objs &quot;`$ECHO &quot;$libobjs&quot; | $SP2NL | $SED &quot;/\.${libext}$/d; $lo2o&quot; | $NL2SP`
+      fi
+
+      # Eliminate all temporary directories.
+      #for path in $notinst_path; do
+      #	lib_search_path=`$ECHO &quot;$lib_search_path &quot; | $SED &quot;s% $path % %g&quot;`
+      #	deplibs=`$ECHO &quot;$deplibs &quot; | $SED &quot;s% -L$path % %g&quot;`
+      #	dependency_libs=`$ECHO &quot;$dependency_libs &quot; | $SED &quot;s% -L$path % %g&quot;`
+      #done
+
+      if test -n &quot;$xrpath&quot;; then
+	# If the user specified any rpath flags, then add them.
+	temp_xrpath=
+	for libdir in $xrpath; do
+	  func_replace_sysroot &quot;$libdir&quot;
+	  func_append temp_xrpath &quot; -R$func_replace_sysroot_result&quot;
+	  case &quot;$finalize_rpath &quot; in
+	  *&quot; $libdir &quot;*) ;;
+	  *) func_append finalize_rpath &quot; $libdir&quot; ;;
+	  esac
+	done
+	if test &quot;$hardcode_into_libs&quot; != yes || test &quot;$build_old_libs&quot; = yes; then
+	  dependency_libs=&quot;$temp_xrpath $dependency_libs&quot;
+	fi
+      fi
+
+      # Make sure dlfiles contains only unique files that won't be dlpreopened
+      old_dlfiles=&quot;$dlfiles&quot;
+      dlfiles=
+      for lib in $old_dlfiles; do
+	case &quot; $dlprefiles $dlfiles &quot; in
+	*&quot; $lib &quot;*) ;;
+	*) func_append dlfiles &quot; $lib&quot; ;;
+	esac
+      done
+
+      # Make sure dlprefiles contains only unique files
+      old_dlprefiles=&quot;$dlprefiles&quot;
+      dlprefiles=
+      for lib in $old_dlprefiles; do
+	case &quot;$dlprefiles &quot; in
+	*&quot; $lib &quot;*) ;;
+	*) func_append dlprefiles &quot; $lib&quot; ;;
+	esac
+      done
+
+      if test &quot;$build_libtool_libs&quot; = yes; then
+	if test -n &quot;$rpath&quot;; then
+	  case $host in
+	  *-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-os2* | *-*-beos* | *-cegcc* | *-*-haiku*)
+	    # these systems don't actually have a c library (as such)!
+	    ;;
+	  *-*-rhapsody* | *-*-darwin1.[012])
+	    # Rhapsody C library is in the System framework
+	    func_append deplibs &quot; System.ltframework&quot;
+	    ;;
+	  *-*-netbsd*)
+	    # Don't link with libc until the a.out ld.so is fixed.
+	    ;;
+	  *-*-openbsd* | *-*-freebsd* | *-*-dragonfly*)
+	    # Do not include libc due to us having libc/libc_r.
+	    ;;
+	  *-*-sco3.2v5* | *-*-sco5v6*)
+	    # Causes problems with __ctype
+	    ;;
+	  *-*-sysv4.2uw2* | *-*-sysv5* | *-*-unixware* | *-*-OpenUNIX*)
+	    # Compiler inserts libc in the correct place for threads to work
+	    ;;
+	  *)
+	    # Add libc to deplibs on all other systems if necessary.
+	    if test &quot;$build_libtool_need_lc&quot; = &quot;yes&quot;; then
+	      func_append deplibs &quot; -lc&quot;
+	    fi
+	    ;;
+	  esac
+	fi
+
+	# Transform deplibs into only deplibs that can be linked in shared.
+	name_save=$name
+	libname_save=$libname
+	release_save=$release
+	versuffix_save=$versuffix
+	major_save=$major
+	# I'm not sure if I'm treating the release correctly.  I think
+	# release should show up in the -l (ie -lgmp5) so we don't want to
+	# add it in twice.  Is that correct?
+	release=&quot;&quot;
+	versuffix=&quot;&quot;
+	major=&quot;&quot;
+	newdeplibs=
+	droppeddeps=no
+	case $deplibs_check_method in
+	pass_all)
+	  # Don't check for shared/static.  Everything works.
+	  # This might be a little naive.  We might want to check
+	  # whether the library exists or not.  But this is on
+	  # osf3 &amp; osf4 and I'm not really sure... Just
+	  # implementing what was already the behavior.
+	  newdeplibs=$deplibs
+	  ;;
+	test_compile)
+	  # This code stresses the &quot;libraries are programs&quot; paradigm to its
+	  # limits. Maybe even breaks it.  We compile a program, linking it
+	  # against the deplibs as a proxy for the library.  Then we can check
+	  # whether they linked in statically or dynamically with ldd.
+	  $opt_dry_run || $RM conftest.c
+	  cat &gt; conftest.c &lt;&lt;EOF
+	  int main() { return 0; }
+EOF
+	  $opt_dry_run || $RM conftest
+	  if $LTCC $LTCFLAGS -o conftest conftest.c $deplibs; then
+	    ldd_output=`ldd conftest`
+	    for i in $deplibs; do
+	      case $i in
+	      -l*)
+		func_stripname -l '' &quot;$i&quot;
+		name=$func_stripname_result
+		if test &quot;X$allow_libtool_libs_with_static_runtimes&quot; = &quot;Xyes&quot; ; then
+		  case &quot; $predeps $postdeps &quot; in
+		  *&quot; $i &quot;*)
+		    func_append newdeplibs &quot; $i&quot;
+		    i=&quot;&quot;
+		    ;;
+		  esac
+		fi
+		if test -n &quot;$i&quot; ; then
+		  libname=`eval &quot;\\$ECHO \&quot;$libname_spec\&quot;&quot;`
+		  deplib_matches=`eval &quot;\\$ECHO \&quot;$library_names_spec\&quot;&quot;`
+		  set dummy $deplib_matches; shift
+		  deplib_match=$1
+		  if test `expr &quot;$ldd_output&quot; : &quot;.*$deplib_match&quot;` -ne 0 ; then
+		    func_append newdeplibs &quot; $i&quot;
+		  else
+		    droppeddeps=yes
+		    echo
+		    $ECHO &quot;*** Warning: dynamic linker does not accept needed library $i.&quot;
+		    echo &quot;*** I have the capability to make that library automatically link in when&quot;
+		    echo &quot;*** you link to this library.  But I can only do this if you have a&quot;
+		    echo &quot;*** shared version of the library, which I believe you do not have&quot;
+		    echo &quot;*** because a test_compile did reveal that the linker did not use it for&quot;
+		    echo &quot;*** its dynamic dependency list that programs get resolved with at runtime.&quot;
+		  fi
+		fi
+		;;
+	      *)
+		func_append newdeplibs &quot; $i&quot;
+		;;
+	      esac
+	    done
+	  else
+	    # Error occurred in the first compile.  Let's try to salvage
+	    # the situation: Compile a separate program for each library.
+	    for i in $deplibs; do
+	      case $i in
+	      -l*)
+		func_stripname -l '' &quot;$i&quot;
+		name=$func_stripname_result
+		$opt_dry_run || $RM conftest
+		if $LTCC $LTCFLAGS -o conftest conftest.c $i; then
+		  ldd_output=`ldd conftest`
+		  if test &quot;X$allow_libtool_libs_with_static_runtimes&quot; = &quot;Xyes&quot; ; then
+		    case &quot; $predeps $postdeps &quot; in
+		    *&quot; $i &quot;*)
+		      func_append newdeplibs &quot; $i&quot;
+		      i=&quot;&quot;
+		      ;;
+		    esac
+		  fi
+		  if test -n &quot;$i&quot; ; then
+		    libname=`eval &quot;\\$ECHO \&quot;$libname_spec\&quot;&quot;`
+		    deplib_matches=`eval &quot;\\$ECHO \&quot;$library_names_spec\&quot;&quot;`
+		    set dummy $deplib_matches; shift
+		    deplib_match=$1
+		    if test `expr &quot;$ldd_output&quot; : &quot;.*$deplib_match&quot;` -ne 0 ; then
+		      func_append newdeplibs &quot; $i&quot;
+		    else
+		      droppeddeps=yes
+		      echo
+		      $ECHO &quot;*** Warning: dynamic linker does not accept needed library $i.&quot;
+		      echo &quot;*** I have the capability to make that library automatically link in when&quot;
+		      echo &quot;*** you link to this library.  But I can only do this if you have a&quot;
+		      echo &quot;*** shared version of the library, which you do not appear to have&quot;
+		      echo &quot;*** because a test_compile did reveal that the linker did not use this one&quot;
+		      echo &quot;*** as a dynamic dependency that programs can get resolved with at runtime.&quot;
+		    fi
+		  fi
+		else
+		  droppeddeps=yes
+		  echo
+		  $ECHO &quot;*** Warning!  Library $i is needed by this library but I was not able to&quot;
+		  echo &quot;*** make it link in!  You will probably need to install it or some&quot;
+		  echo &quot;*** library that it depends on before this library will be fully&quot;
+		  echo &quot;*** functional.  Installing it before continuing would be even better.&quot;
+		fi
+		;;
+	      *)
+		func_append newdeplibs &quot; $i&quot;
+		;;
+	      esac
+	    done
+	  fi
+	  ;;
+	file_magic*)
+	  set dummy $deplibs_check_method; shift
+	  file_magic_regex=`expr &quot;$deplibs_check_method&quot; : &quot;$1 \(.*\)&quot;`
+	  for a_deplib in $deplibs; do
+	    case $a_deplib in
+	    -l*)
+	      func_stripname -l '' &quot;$a_deplib&quot;
+	      name=$func_stripname_result
+	      if test &quot;X$allow_libtool_libs_with_static_runtimes&quot; = &quot;Xyes&quot; ; then
+		case &quot; $predeps $postdeps &quot; in
+		*&quot; $a_deplib &quot;*)
+		  func_append newdeplibs &quot; $a_deplib&quot;
+		  a_deplib=&quot;&quot;
+		  ;;
+		esac
+	      fi
+	      if test -n &quot;$a_deplib&quot; ; then
+		libname=`eval &quot;\\$ECHO \&quot;$libname_spec\&quot;&quot;`
+		if test -n &quot;$file_magic_glob&quot;; then
+		  libnameglob=`func_echo_all &quot;$libname&quot; | $SED -e $file_magic_glob`
+		else
+		  libnameglob=$libname
+		fi
+		test &quot;$want_nocaseglob&quot; = yes &amp;&amp; nocaseglob=`shopt -p nocaseglob`
+		for i in $lib_search_path $sys_lib_search_path $shlib_search_path; do
+		  if test &quot;$want_nocaseglob&quot; = yes; then
+		    shopt -s nocaseglob
+		    potential_libs=`ls $i/$libnameglob[.-]* 2&gt;/dev/null`
+		    $nocaseglob
+		  else
+		    potential_libs=`ls $i/$libnameglob[.-]* 2&gt;/dev/null`
+		  fi
+		  for potent_lib in $potential_libs; do
+		      # Follow soft links.
+		      if ls -lLd &quot;$potent_lib&quot; 2&gt;/dev/null |
+			 $GREP &quot; -&gt; &quot; &gt;/dev/null; then
+			continue
+		      fi
+		      # The statement above tries to avoid entering an
+		      # endless loop below, in case of cyclic links.
+		      # We might still enter an endless loop, since a link
+		      # loop can be closed while we follow links,
+		      # but so what?
+		      potlib=&quot;$potent_lib&quot;
+		      while test -h &quot;$potlib&quot; 2&gt;/dev/null; do
+			potliblink=`ls -ld $potlib | ${SED} 's/.* -&gt; //'`
+			case $potliblink in
+			[\\/]* | [A-Za-z]:[\\/]*) potlib=&quot;$potliblink&quot;;;
+			*) potlib=`$ECHO &quot;$potlib&quot; | $SED 's,[^/]*$,,'`&quot;$potliblink&quot;;;
+			esac
+		      done
+		      if eval $file_magic_cmd \&quot;\$potlib\&quot; 2&gt;/dev/null |
+			 $SED -e 10q |
+			 $EGREP &quot;$file_magic_regex&quot; &gt; /dev/null; then
+			func_append newdeplibs &quot; $a_deplib&quot;
+			a_deplib=&quot;&quot;
+			break 2
+		      fi
+		  done
+		done
+	      fi
+	      if test -n &quot;$a_deplib&quot; ; then
+		droppeddeps=yes
+		echo
+		$ECHO &quot;*** Warning: linker path does not have real file for library $a_deplib.&quot;
+		echo &quot;*** I have the capability to make that library automatically link in when&quot;
+		echo &quot;*** you link to this library.  But I can only do this if you have a&quot;
+		echo &quot;*** shared version of the library, which you do not appear to have&quot;
+		echo &quot;*** because I did check the linker path looking for a file starting&quot;
+		if test -z &quot;$potlib&quot; ; then
+		  $ECHO &quot;*** with $libname but no candidates were found. (...for file magic test)&quot;
+		else
+		  $ECHO &quot;*** with $libname and none of the candidates passed a file format test&quot;
+		  $ECHO &quot;*** using a file magic. Last file checked: $potlib&quot;
+		fi
+	      fi
+	      ;;
+	    *)
+	      # Add a -L argument.
+	      func_append newdeplibs &quot; $a_deplib&quot;
+	      ;;
+	    esac
+	  done # Gone through all deplibs.
+	  ;;
+	match_pattern*)
+	  set dummy $deplibs_check_method; shift
+	  match_pattern_regex=`expr &quot;$deplibs_check_method&quot; : &quot;$1 \(.*\)&quot;`
+	  for a_deplib in $deplibs; do
+	    case $a_deplib in
+	    -l*)
+	      func_stripname -l '' &quot;$a_deplib&quot;
+	      name=$func_stripname_result
+	      if test &quot;X$allow_libtool_libs_with_static_runtimes&quot; = &quot;Xyes&quot; ; then
+		case &quot; $predeps $postdeps &quot; in
+		*&quot; $a_deplib &quot;*)
+		  func_append newdeplibs &quot; $a_deplib&quot;
+		  a_deplib=&quot;&quot;
+		  ;;
+		esac
+	      fi
+	      if test -n &quot;$a_deplib&quot; ; then
+		libname=`eval &quot;\\$ECHO \&quot;$libname_spec\&quot;&quot;`
+		for i in $lib_search_path $sys_lib_search_path $shlib_search_path; do
+		  potential_libs=`ls $i/$libname[.-]* 2&gt;/dev/null`
+		  for potent_lib in $potential_libs; do
+		    potlib=&quot;$potent_lib&quot; # see symlink-check above in file_magic test
+		    if eval &quot;\$ECHO \&quot;$potent_lib\&quot;&quot; 2&gt;/dev/null | $SED 10q | \
+		       $EGREP &quot;$match_pattern_regex&quot; &gt; /dev/null; then
+		      func_append newdeplibs &quot; $a_deplib&quot;
+		      a_deplib=&quot;&quot;
+		      break 2
+		    fi
+		  done
+		done
+	      fi
+	      if test -n &quot;$a_deplib&quot; ; then
+		droppeddeps=yes
+		echo
+		$ECHO &quot;*** Warning: linker path does not have real file for library $a_deplib.&quot;
+		echo &quot;*** I have the capability to make that library automatically link in when&quot;
+		echo &quot;*** you link to this library.  But I can only do this if you have a&quot;
+		echo &quot;*** shared version of the library, which you do not appear to have&quot;
+		echo &quot;*** because I did check the linker path looking for a file starting&quot;
+		if test -z &quot;$potlib&quot; ; then
+		  $ECHO &quot;*** with $libname but no candidates were found. (...for regex pattern test)&quot;
+		else
+		  $ECHO &quot;*** with $libname and none of the candidates passed a file format test&quot;
+		  $ECHO &quot;*** using a regex pattern. Last file checked: $potlib&quot;
+		fi
+	      fi
+	      ;;
+	    *)
+	      # Add a -L argument.
+	      func_append newdeplibs &quot; $a_deplib&quot;
+	      ;;
+	    esac
+	  done # Gone through all deplibs.
+	  ;;
+	none | unknown | *)
+	  newdeplibs=&quot;&quot;
+	  tmp_deplibs=`$ECHO &quot; $deplibs&quot; | $SED 's/ -lc$//; s/ -[LR][^ ]*//g'`
+	  if test &quot;X$allow_libtool_libs_with_static_runtimes&quot; = &quot;Xyes&quot; ; then
+	    for i in $predeps $postdeps ; do
+	      # can't use Xsed below, because $i might contain '/'
+	      tmp_deplibs=`$ECHO &quot; $tmp_deplibs&quot; | $SED &quot;s,$i,,&quot;`
+	    done
+	  fi
+	  case $tmp_deplibs in
+	  *[!\	\ ]*)
+	    echo
+	    if test &quot;X$deplibs_check_method&quot; = &quot;Xnone&quot;; then
+	      echo &quot;*** Warning: inter-library dependencies are not supported in this platform.&quot;
+	    else
+	      echo &quot;*** Warning: inter-library dependencies are not known to be supported.&quot;
+	    fi
+	    echo &quot;*** All declared inter-library dependencies are being dropped.&quot;
+	    droppeddeps=yes
+	    ;;
+	  esac
+	  ;;
+	esac
+	versuffix=$versuffix_save
+	major=$major_save
+	release=$release_save
+	libname=$libname_save
+	name=$name_save
+
+	case $host in
+	*-*-rhapsody* | *-*-darwin1.[012])
+	  # On Rhapsody replace the C library with the System framework
+	  newdeplibs=`$ECHO &quot; $newdeplibs&quot; | $SED 's/ -lc / System.ltframework /'`
+	  ;;
+	esac
+
+	if test &quot;$droppeddeps&quot; = yes; then
+	  if test &quot;$module&quot; = yes; then
+	    echo
+	    echo &quot;*** Warning: libtool could not satisfy all declared inter-library&quot;
+	    $ECHO &quot;*** dependencies of module $libname.  Therefore, libtool will create&quot;
+	    echo &quot;*** a static module, that should work as long as the dlopening&quot;
+	    echo &quot;*** application is linked with the -dlopen flag.&quot;
+	    if test -z &quot;$global_symbol_pipe&quot;; then
+	      echo
+	      echo &quot;*** However, this would only work if libtool was able to extract symbol&quot;
+	      echo &quot;*** lists from a program, using \`nm' or equivalent, but libtool could&quot;
+	      echo &quot;*** not find such a program.  So, this module is probably useless.&quot;
+	      echo &quot;*** \`nm' from GNU binutils and a full rebuild may help.&quot;
+	    fi
+	    if test &quot;$build_old_libs&quot; = no; then
+	      oldlibs=&quot;$output_objdir/$libname.$libext&quot;
+	      build_libtool_libs=module
+	      build_old_libs=yes
+	    else
+	      build_libtool_libs=no
+	    fi
 	  else
-	    var_value=`$echo &quot;X$var_value&quot; | $Xsed -e &quot;$sed_quote_subst&quot;`
-	    relink_command=&quot;$var=\&quot;$var_value\&quot;; export $var; $relink_command&quot;
-	  fi
-	done
-	relink_command=&quot;cd `pwd`; $relink_command&quot;
-	relink_command=`$echo &quot;X$relink_command&quot; | $Xsed -e &quot;$sed_quote_subst&quot;`
-      fi
+	    echo &quot;*** The inter-library dependencies that have been dropped here will be&quot;
+	    echo &quot;*** automatically added whenever a program is linked with this library&quot;
+	    echo &quot;*** or is declared to -dlopen it.&quot;
 
-      # Quote $echo for shipping.
-      if test &quot;X$echo&quot; = &quot;X$SHELL $0 --fallback-echo&quot;; then
-	case $0 in
-	[\\/]* | [A-Za-z]:[\\/]*) qecho=&quot;$SHELL $0 --fallback-echo&quot;;;
-	*) qecho=&quot;$SHELL `pwd`/$0 --fallback-echo&quot;;;
-	esac
-	qecho=`$echo &quot;X$qecho&quot; | $Xsed -e &quot;$sed_quote_subst&quot;`
-      else
-	qecho=`$echo &quot;X$echo&quot; | $Xsed -e &quot;$sed_quote_subst&quot;`
+	    if test &quot;$allow_undefined&quot; = no; then
+	      echo
+	      echo &quot;*** Since this library must not contain undefined symbols,&quot;
+	      echo &quot;*** because either the platform does not support them or&quot;
+	      echo &quot;*** it was explicitly requested with -no-undefined,&quot;
+	      echo &quot;*** libtool will only create a static version of it.&quot;
+	      if test &quot;$build_old_libs&quot; = no; then
+		oldlibs=&quot;$output_objdir/$libname.$libext&quot;
+		build_libtool_libs=module
+		build_old_libs=yes
+	      else
+		build_libtool_libs=no
+	      fi
+	    fi
+	  fi
+	fi
+	# Done checking deplibs!
+	deplibs=$newdeplibs
       fi
+      # Time to change all our &quot;foo.ltframework&quot; stuff back to &quot;-framework foo&quot;
+      case $host in
+	*-*-darwin*)
+	  newdeplibs=`$ECHO &quot; $newdeplibs&quot; | $SED 's% \([^ $]*\).ltframework% -framework \1%g'`
+	  new_inherited_linker_flags=`$ECHO &quot; $new_inherited_linker_flags&quot; | $SED 's% \([^ $]*\).ltframework% -framework \1%g'`
+	  deplibs=`$ECHO &quot; $deplibs&quot; | $SED 's% \([^ $]*\).ltframework% -framework \1%g'`
+	  ;;
+      esac
 
-      # Only actually do things if our run command is non-null.
-      if test -z &quot;$run&quot;; then
-	# win32 will think the script is a binary if it has
-	# a .exe suffix, so we strip it off here.
-	case $output in
-	  *.exe) output=`echo $output|sed 's,.exe$,,'` ;;
+      # move library search paths that coincide with paths to not yet
+      # installed libraries to the beginning of the library search list
+      new_libs=
+      for path in $notinst_path; do
+	case &quot; $new_libs &quot; in
+	*&quot; -L$path/$objdir &quot;*) ;;
+	*)
+	  case &quot; $deplibs &quot; in
+	  *&quot; -L$path/$objdir &quot;*)
+	    func_append new_libs &quot; -L$path/$objdir&quot; ;;
+	  esac
+	  ;;
 	esac
-	# test for cygwin because mv fails w/o .exe extensions
-	case $host in
-	  *cygwin*) exeext=.exe ;;
-	  *) exeext= ;;
+      done
+      for deplib in $deplibs; do
+	case $deplib in
+	-L*)
+	  case &quot; $new_libs &quot; in
+	  *&quot; $deplib &quot;*) ;;
+	  *) func_append new_libs &quot; $deplib&quot; ;;
+	  esac
+	  ;;
+	*) func_append new_libs &quot; $deplib&quot; ;;
 	esac
-	$rm $output
-	trap &quot;$rm $output; exit 1&quot; 1 2 15
-
-	$echo &gt; $output &quot;\
-#! $SHELL
-
-# $output - temporary wrapper script for $objdir/$outputname
-# Generated by $PROGRAM - GNU $PACKAGE $VERSION$TIMESTAMP
-#
-# The $output program cannot be directly executed until all the libtool
-# libraries that it depends on are installed.
-#
-# This wrapper script should never be moved out of the build directory.
-# If it is, it will not operate correctly.
-
-# Sed substitution that helps us do robust quoting.  It backslashifies
-# metacharacters that are still active within double-quoted strings.
-Xsed='sed -e 1s/^X//'
-sed_quote_subst='$sed_quote_subst'
-
-# The HP-UX ksh and POSIX shell print the target directory to stdout
-# if CDPATH is set.
-if test \&quot;\${CDPATH+set}\&quot; = set; then CDPATH=:; export CDPATH; fi
-
-relink_command=\&quot;$relink_command\&quot;
-
-# This environment variable determines our operation mode.
-if test \&quot;\$libtool_install_magic\&quot; = \&quot;$magic\&quot;; then
-  # install mode needs the following variable:
-  notinst_deplibs='$notinst_deplibs'
-else
-  # When we are sourced in execute mode, \$file and \$echo are already set.
-  if test \&quot;\$libtool_execute_magic\&quot; != \&quot;$magic\&quot;; then
-    echo=\&quot;$qecho\&quot;
-    file=\&quot;\$0\&quot;
-    # Make sure echo works.
-    if test \&quot;X\$1\&quot; = X--no-reexec; then
-      # Discard the --no-reexec flag, and continue.
-      shift
-    elif test \&quot;X\`(\$echo '\t') 2&gt;/dev/null\`\&quot; = 'X\t'; then
-      # Yippee, \$echo works!
-      :
-    else
-      # Restart under the correct shell, and then maybe \$echo will work.
-      exec $SHELL \&quot;\$0\&quot; --no-reexec \${1+\&quot;\$@\&quot;}
-    fi
-  fi\
-&quot;
-	$echo &gt;&gt; $output &quot;\
-
-  # Find the directory that this script lives in.
-  thisdir=\`\$echo \&quot;X\$file\&quot; | \$Xsed -e 's%/[^/]*$%%'\`
-  test \&quot;x\$thisdir\&quot; = \&quot;x\$file\&quot; &amp;&amp; thisdir=.
-
-  # Follow symbolic links until we get to the real thisdir.
-  file=\`ls -ld \&quot;\$file\&quot; | sed -n 's/.*-&gt; //p'\`
-  while test -n \&quot;\$file\&quot;; do
-    destdir=\`\$echo \&quot;X\$file\&quot; | \$Xsed -e 's%/[^/]*\$%%'\`
-
-    # If there was a directory component, then change thisdir.
-    if test \&quot;x\$destdir\&quot; != \&quot;x\$file\&quot;; then
-      case \&quot;\$destdir\&quot; in
-      [\\\\/]* | [A-Za-z]:[\\\\/]*) thisdir=\&quot;\$destdir\&quot; ;;
-      *) thisdir=\&quot;\$thisdir/\$destdir\&quot; ;;
-      esac
-    fi
-
-    file=\`\$echo \&quot;X\$file\&quot; | \$Xsed -e 's%^.*/%%'\`
-    file=\`ls -ld \&quot;\$thisdir/\$file\&quot; | sed -n 's/.*-&gt; //p'\`
-  done
-
-  # Try to get the absolute directory name.
-  absdir=\`cd \&quot;\$thisdir\&quot; &amp;&amp; pwd\`
-  test -n \&quot;\$absdir\&quot; &amp;&amp; thisdir=\&quot;\$absdir\&quot;
-&quot;
-
-	if test &quot;$fast_install&quot; = yes; then
-	  echo &gt;&gt; $output &quot;\
-  program=lt-'$outputname'$exeext
-  progdir=\&quot;\$thisdir/$objdir\&quot;
-
-  if test ! -f \&quot;\$progdir/\$program\&quot; || \\
-     { file=\`ls -1dt \&quot;\$progdir/\$program\&quot; \&quot;\$progdir/../\$program\&quot; 2&gt;/dev/null | sed 1q\`; \\
-       test \&quot;X\$file\&quot; != \&quot;X\$progdir/\$program\&quot;; }; then
-
-    file=\&quot;\$\$-\$program\&quot;
-
-    if test ! -d \&quot;\$progdir\&quot;; then
-      $mkdir \&quot;\$progdir\&quot;
-    else
-      $rm \&quot;\$progdir/\$file\&quot;
-    fi&quot;
-
-	  echo &gt;&gt; $output &quot;\
+      done
+      deplibs=&quot;$new_libs&quot;
 
-    # relink executable if necessary
-    if test -n \&quot;\$relink_command\&quot;; then
-      if relink_command_output=\`eval \$relink_command 2&gt;&amp;1\`; then :
-      else
-	$echo \&quot;\$relink_command_output\&quot; &gt;&amp;2
-	$rm \&quot;\$progdir/\$file\&quot;
-	exit 1
-      fi
-    fi
+      # All the library-specific variables (install_libdir is set above).
+      library_names=
+      old_library=
+      dlname=
 
-    $mv \&quot;\$progdir/\$file\&quot; \&quot;\$progdir/\$program\&quot; 2&gt;/dev/null ||
-    { $rm \&quot;\$progdir/\$program\&quot;;
-      $mv \&quot;\$progdir/\$file\&quot; \&quot;\$progdir/\$program\&quot;; }
-    $rm \&quot;\$progdir/\$file\&quot;
-  fi&quot;
-	else
-	  echo &gt;&gt; $output &quot;\
-  program='$outputname'
-  progdir=\&quot;\$thisdir/$objdir\&quot;
-&quot;
+      # Test again, we may have decided not to build it any more
+      if test &quot;$build_libtool_libs&quot; = yes; then
+	if test &quot;$hardcode_into_libs&quot; = yes; then
+	  # Hardcode the library paths
+	  hardcode_libdirs=
+	  dep_rpath=
+	  rpath=&quot;$finalize_rpath&quot;
+	  test &quot;$opt_mode&quot; != relink &amp;&amp; rpath=&quot;$compile_rpath$rpath&quot;
+	  for libdir in $rpath; do
+	    if test -n &quot;$hardcode_libdir_flag_spec&quot;; then
+	      if test -n &quot;$hardcode_libdir_separator&quot;; then
+		func_replace_sysroot &quot;$libdir&quot;
+		libdir=$func_replace_sysroot_result
+		if test -z &quot;$hardcode_libdirs&quot;; then
+		  hardcode_libdirs=&quot;$libdir&quot;
+		else
+		  # Just accumulate the unique libdirs.
+		  case $hardcode_libdir_separator$hardcode_libdirs$hardcode_libdir_separator in
+		  *&quot;$hardcode_libdir_separator$libdir$hardcode_libdir_separator&quot;*)
+		    ;;
+		  *)
+		    func_append hardcode_libdirs &quot;$hardcode_libdir_separator$libdir&quot;
+		    ;;
+		  esac
+		fi
+	      else
+		eval flag=\&quot;$hardcode_libdir_flag_spec\&quot;
+		func_append dep_rpath &quot; $flag&quot;
+	      fi
+	    elif test -n &quot;$runpath_var&quot;; then
+	      case &quot;$perm_rpath &quot; in
+	      *&quot; $libdir &quot;*) ;;
+	      *) func_apped perm_rpath &quot; $libdir&quot; ;;
+	      esac
+	    fi
+	  done
+	  # Substitute the hardcoded libdirs into the rpath.
+	  if test -n &quot;$hardcode_libdir_separator&quot; &amp;&amp;
+	     test -n &quot;$hardcode_libdirs&quot;; then
+	    libdir=&quot;$hardcode_libdirs&quot;
+	    if test -n &quot;$hardcode_libdir_flag_spec_ld&quot;; then
+	      eval dep_rpath=\&quot;$hardcode_libdir_flag_spec_ld\&quot;
+	    else
+	      eval dep_rpath=\&quot;$hardcode_libdir_flag_spec\&quot;
+	    fi
+	  fi
+	  if test -n &quot;$runpath_var&quot; &amp;&amp; test -n &quot;$perm_rpath&quot;; then
+	    # We should set the runpath_var.
+	    rpath=
+	    for dir in $perm_rpath; do
+	      func_append rpath &quot;$dir:&quot;
+	    done
+	    eval &quot;$runpath_var='$rpath\$$runpath_var'; export $runpath_var&quot;
+	  fi
+	  test -n &quot;$dep_rpath&quot; &amp;&amp; deplibs=&quot;$dep_rpath $deplibs&quot;
 	fi
 
-	echo &gt;&gt; $output &quot;\
-
-  if test -f \&quot;\$progdir/\$program\&quot;; then&quot;
-
-	# Export our shlibpath_var if we have one.
-	if test &quot;$shlibpath_overrides_runpath&quot; = yes &amp;&amp; test -n &quot;$shlibpath_var&quot; &amp;&amp; test -n &quot;$temp_rpath&quot;; then
-	  $echo &gt;&gt; $output &quot;\
-    # Add our own library path to $shlibpath_var
-    $shlibpath_var=\&quot;$temp_rpath\$$shlibpath_var\&quot;
+	shlibpath=&quot;$finalize_shlibpath&quot;
+	test &quot;$opt_mode&quot; != relink &amp;&amp; shlibpath=&quot;$compile_shlibpath$shlibpath&quot;
+	if test -n &quot;$shlibpath&quot;; then
+	  eval &quot;$shlibpath_var='$shlibpath\$$shlibpath_var'; export $shlibpath_var&quot;
+	fi
 
-    # Some systems cannot cope with colon-terminated $shlibpath_var
-    # The second colon is a workaround for a bug in BeOS R4 sed
-    $shlibpath_var=\`\$echo \&quot;X\$$shlibpath_var\&quot; | \$Xsed -e 's/::*\$//'\`
+	# Get the real and link names of the library.
+	eval shared_ext=\&quot;$shrext_cmds\&quot;
+	eval library_names=\&quot;$library_names_spec\&quot;
+	set dummy $library_names
+	shift
+	realname=&quot;$1&quot;
+	shift
 
-    export $shlibpath_var
-&quot;
+	if test -n &quot;$soname_spec&quot;; then
+	  eval soname=\&quot;$soname_spec\&quot;
+	else
+	  soname=&quot;$realname&quot;
 	fi
-
-	# fixup the dll searchpath if we need to.
-	if test -n &quot;$dllsearchpath&quot;; then
-	  $echo &gt;&gt; $output &quot;\
-    # Add the dll search path components to the executable PATH
-    PATH=$dllsearchpath:\$PATH
-&quot;
+	if test -z &quot;$dlname&quot;; then
+	  dlname=$soname
 	fi
 
-	$echo &gt;&gt; $output &quot;\
-    if test \&quot;\$libtool_execute_magic\&quot; != \&quot;$magic\&quot;; then
-      # Run the actual program with our arguments.
-&quot;
-	case $host in
-	# win32 systems need to use the prog path for dll
-	# lookup to work
-	*-*-cygwin* | *-*-pw32*)
-	  $echo &gt;&gt; $output &quot;\
-      exec \$progdir/\$program \${1+\&quot;\$@\&quot;}
-&quot;
-	  ;;
+	lib=&quot;$output_objdir/$realname&quot;
+	linknames=
+	for link
+	do
+	  func_append linknames &quot; $link&quot;
+	done
 
-	# Backslashes separate directories on plain windows
-	*-*-mingw | *-*-os2*)
-	  $echo &gt;&gt; $output &quot;\
-      exec \$progdir\\\\\$program \${1+\&quot;\$@\&quot;}
-&quot;
-	  ;;
+	# Use standard objects if they are pic
+	test -z &quot;$pic_flag&quot; &amp;&amp; libobjs=`$ECHO &quot;$libobjs&quot; | $SP2NL | $SED &quot;$lo2o&quot; | $NL2SP`
+	test &quot;X$libobjs&quot; = &quot;X &quot; &amp;&amp; libobjs=
 
-	*)
-	  $echo &gt;&gt; $output &quot;\
-      # Export the path to the program.
-      PATH=\&quot;\$progdir:\$PATH\&quot;
-      export PATH
+	delfiles=
+	if test -n &quot;$export_symbols&quot; &amp;&amp; test -n &quot;$include_expsyms&quot;; then
+	  $opt_dry_run || cp &quot;$export_symbols&quot; &quot;$output_objdir/$libname.uexp&quot;
+	  export_symbols=&quot;$output_objdir/$libname.uexp&quot;
+	  func_append delfiles &quot; $export_symbols&quot;
+	fi
 
-      exec \$program \${1+\&quot;\$@\&quot;}
-&quot;
+	orig_export_symbols=
+	case $host_os in
+	cygwin* | mingw* | cegcc*)
+	  if test -n &quot;$export_symbols&quot; &amp;&amp; test -z &quot;$export_symbols_regex&quot;; then
+	    # exporting using user supplied symfile
+	    if test &quot;x`$SED 1q $export_symbols`&quot; != xEXPORTS; then
+	      # and it's NOT already a .def file. Must figure out
+	      # which of the given symbols are data symbols and tag
+	      # them as such. So, trigger use of export_symbols_cmds.
+	      # export_symbols gets reassigned inside the &quot;prepare
+	      # the list of exported symbols&quot; if statement, so the
+	      # include_expsyms logic still works.
+	      orig_export_symbols=&quot;$export_symbols&quot;
+	      export_symbols=
+	      always_export_symbols=yes
+	    fi
+	  fi
 	  ;;
 	esac
-	$echo &gt;&gt; $output &quot;\
-      \$echo \&quot;\$0: cannot exec \$program \${1+\&quot;\$@\&quot;}\&quot;
-      exit 1
-    fi
-  else
-    # The program doesn't exist.
-    \$echo \&quot;\$0: error: \$progdir/\$program does not exist\&quot; 1&gt;&amp;2
-    \$echo \&quot;This script is just a wrapper for \$program.\&quot; 1&gt;&amp;2
-    echo \&quot;See the $PACKAGE documentation for more information.\&quot; 1&gt;&amp;2
-    exit 1
-  fi
-fi\
-&quot;
-	chmod +x $output
-      fi
-      exit 0
-      ;;
-    esac
 
-    # See if we need to build an old-fashioned archive.
-    for oldlib in $oldlibs; do
+	# Prepare the list of exported symbols
+	if test -z &quot;$export_symbols&quot;; then
+	  if test &quot;$always_export_symbols&quot; = yes || test -n &quot;$export_symbols_regex&quot;; then
+	    func_verbose &quot;generating symbol list for \`$libname.la'&quot;
+	    export_symbols=&quot;$output_objdir/$libname.exp&quot;
+	    $opt_dry_run || $RM $export_symbols
+	    cmds=$export_symbols_cmds
+	    save_ifs=&quot;$IFS&quot;; IFS='~'
+	    for cmd1 in $cmds; do
+	      IFS=&quot;$save_ifs&quot;
+	      # Take the normal branch if the nm_file_list_spec branch
+	      # doesn't work or if tool conversion is not needed.
+	      case $nm_file_list_spec~$to_tool_file_cmd in
+		*~func_convert_file_noop | *~func_convert_file_msys_to_w32 | ~*)
+		  try_normal_branch=yes
+		  eval cmd=\&quot;$cmd1\&quot;
+		  func_len &quot; $cmd&quot;
+		  len=$func_len_result
+		  ;;
+		*)
+		  try_normal_branch=no
+		  ;;
+	      esac
+	      if test &quot;$try_normal_branch&quot; = yes \
+		 &amp;&amp; { test &quot;$len&quot; -lt &quot;$max_cmd_len&quot; \
+		      || test &quot;$max_cmd_len&quot; -le -1; }
+	      then
+		func_show_eval &quot;$cmd&quot; 'exit $?'
+		skipped_export=false
+	      elif test -n &quot;$nm_file_list_spec&quot;; then
+		func_basename &quot;$output&quot;
+		output_la=$func_basename_result
+		save_libobjs=$libobjs
+		save_output=$output
+		output=${output_objdir}/${output_la}.nm
+		func_to_tool_file &quot;$output&quot;
+		libobjs=$nm_file_list_spec$func_to_tool_file_result
+		func_append delfiles &quot; $output&quot;
+		func_verbose &quot;creating $NM input file list: $output&quot;
+		for obj in $save_libobjs; do
+		  func_to_tool_file &quot;$obj&quot;
+		  $ECHO &quot;$func_to_tool_file_result&quot;
+		done &gt; &quot;$output&quot;
+		eval cmd=\&quot;$cmd1\&quot;
+		func_show_eval &quot;$cmd&quot; 'exit $?'
+		output=$save_output
+		libobjs=$save_libobjs
+		skipped_export=false
+	      else
+		# The command line is too long to execute in one step.
+		func_verbose &quot;using reloadable object file for export list...&quot;
+		skipped_export=:
+		# Break out early, otherwise skipped_export may be
+		# set to false by a later but shorter cmd.
+		break
+	      fi
+	    done
+	    IFS=&quot;$save_ifs&quot;
+	    if test -n &quot;$export_symbols_regex&quot; &amp;&amp; test &quot;X$skipped_export&quot; != &quot;X:&quot;; then
+	      func_show_eval '$EGREP -e &quot;$export_symbols_regex&quot; &quot;$export_symbols&quot; &gt; &quot;${export_symbols}T&quot;'
+	      func_show_eval '$MV &quot;${export_symbols}T&quot; &quot;$export_symbols&quot;'
+	    fi
+	  fi
+	fi
 
-      if test &quot;$build_libtool_libs&quot; = convenience; then
-	oldobjs=&quot;$libobjs_save&quot;
-	addlibs=&quot;$convenience&quot;
-	build_libtool_libs=no
-      else
-	if test &quot;$build_libtool_libs&quot; = module; then
-	  oldobjs=&quot;$libobjs_save&quot;
-	  build_libtool_libs=no
-	else
-	  oldobjs=&quot;$objs$old_deplibs &quot;`$echo &quot;X$libobjs_save&quot; | $SP2NL | $Xsed -e '/\.'${libext}'$/d' -e '/\.lib$/d' -e &quot;$lo2o&quot; | $NL2SP`
+	if test -n &quot;$export_symbols&quot; &amp;&amp; test -n &quot;$include_expsyms&quot;; then
+	  tmp_export_symbols=&quot;$export_symbols&quot;
+	  test -n &quot;$orig_export_symbols&quot; &amp;&amp; tmp_export_symbols=&quot;$orig_export_symbols&quot;
+	  $opt_dry_run || eval '$ECHO &quot;$include_expsyms&quot; | $SP2NL &gt;&gt; &quot;$tmp_export_symbols&quot;'
 	fi
-	addlibs=&quot;$old_convenience&quot;
-      fi
 
-      if test -n &quot;$addlibs&quot;; then
-	gentop=&quot;$output_objdir/${outputname}x&quot;
-	$show &quot;${rm}r $gentop&quot;
-	$run ${rm}r &quot;$gentop&quot;
-	$show &quot;mkdir $gentop&quot;
-	$run mkdir &quot;$gentop&quot;
-	status=$?
-	if test $status -ne 0 &amp;&amp; test ! -d &quot;$gentop&quot;; then
-	  exit $status
+	if test &quot;X$skipped_export&quot; != &quot;X:&quot; &amp;&amp; test -n &quot;$orig_export_symbols&quot;; then
+	  # The given exports_symbols file has to be filtered, so filter it.
+	  func_verbose &quot;filter symbol list for \`$libname.la' to tag DATA exports&quot;
+	  # FIXME: $output_objdir/$libname.filter potentially contains lots of
+	  # 's' commands which not all seds can handle. GNU sed should be fine
+	  # though. Also, the filter scales superlinearly with the number of
+	  # global variables. join(1) would be nice here, but unfortunately
+	  # isn't a blessed tool.
+	  $opt_dry_run || $SED -e '/[ ,]DATA/!d;s,\(.*\)\([ \,].*\),s|^\1$|\1\2|,' &lt; $export_symbols &gt; $output_objdir/$libname.filter
+	  func_append delfiles &quot; $export_symbols $output_objdir/$libname.filter&quot;
+	  export_symbols=$output_objdir/$libname.def
+	  $opt_dry_run || $SED -f $output_objdir/$libname.filter &lt; $orig_export_symbols &gt; $export_symbols
 	fi
-	generated=&quot;$generated $gentop&quot;
-
-	# Add in members from convenience archives.
-	for xlib in $addlibs; do
-	  # Extract the objects.
-	  case $xlib in
-	  [\\/]* | [A-Za-z]:[\\/]*) xabs=&quot;$xlib&quot; ;;
-	  *) xabs=`pwd`&quot;/$xlib&quot; ;;
-	  esac
-	  xlib=`$echo &quot;X$xlib&quot; | $Xsed -e 's%^.*/%%'`
-	  xdir=&quot;$gentop/$xlib&quot;
-
-	  $show &quot;${rm}r $xdir&quot;
-	  $run ${rm}r &quot;$xdir&quot;
-	  $show &quot;mkdir $xdir&quot;
-	  $run mkdir &quot;$xdir&quot;
-	  status=$?
-	  if test $status -ne 0 &amp;&amp; test ! -d &quot;$xdir&quot;; then
-	    exit $status
-	  fi
-	  $show &quot;(cd $xdir &amp;&amp; $AR x $xabs)&quot;
-	  $run eval &quot;(cd \$xdir &amp;&amp; $AR x \$xabs)&quot; || exit $?
 
-	  oldobjs=&quot;$oldobjs &quot;`find $xdir -name \*.${objext} -print -o -name \*.lo -print | $NL2SP`
+	tmp_deplibs=
+	for test_deplib in $deplibs; do
+	  case &quot; $convenience &quot; in
+	  *&quot; $test_deplib &quot;*) ;;
+	  *)
+	    func_append tmp_deplibs &quot; $test_deplib&quot;
+	    ;;
+	  esac
 	done
-      fi
+	deplibs=&quot;$tmp_deplibs&quot;
 
-      # Do each command in the archive commands.
-      if test -n &quot;$old_archive_from_new_cmds&quot; &amp;&amp; test &quot;$build_libtool_libs&quot; = yes; then
-	eval cmds=\&quot;$old_archive_from_new_cmds\&quot;
-      else
-	# Ensure that we have .o objects in place in case we decided
-	# not to build a shared library, and have fallen back to building
-	# static libs even though --disable-static was passed!
-	for oldobj in $oldobjs; do
-	  if test ! -f $oldobj; then
-	    xdir=`$echo &quot;X$oldobj&quot; | $Xsed -e 's%/[^/]*$%%'`
-	    if test &quot;X$xdir&quot; = &quot;X$oldobj&quot;; then
-	      xdir=&quot;.&quot;
-	    else
-	      xdir=&quot;$xdir&quot;
-	    fi
-	    baseobj=`$echo &quot;X$oldobj&quot; | $Xsed -e 's%^.*/%%'`
-	    obj=`$echo &quot;X$baseobj&quot; | $Xsed -e &quot;$o2lo&quot;`
-	    $show &quot;(cd $xdir &amp;&amp; ${LN_S} $obj $baseobj)&quot;
-	    $run eval '(cd $xdir &amp;&amp; ${LN_S} $obj $baseobj)' || exit $?
+	if test -n &quot;$convenience&quot;; then
+	  if test -n &quot;$whole_archive_flag_spec&quot; &amp;&amp;
+	    test &quot;$compiler_needs_object&quot; = yes &amp;&amp;
+	    test -z &quot;$libobjs&quot;; then
+	    # extract the archives, so we have objects to list.
+	    # TODO: could optimize this to just extract one archive.
+	    whole_archive_flag_spec=
 	  fi
-	done
+	  if test -n &quot;$whole_archive_flag_spec&quot;; then
+	    save_libobjs=$libobjs
+	    eval libobjs=\&quot;\$libobjs $whole_archive_flag_spec\&quot;
+	    test &quot;X$libobjs&quot; = &quot;X &quot; &amp;&amp; libobjs=
+	  else
+	    gentop=&quot;$output_objdir/${outputname}x&quot;
+	    func_append generated &quot; $gentop&quot;
 
-	eval cmds=\&quot;$old_archive_cmds\&quot;
-      fi
-      save_ifs=&quot;$IFS&quot;; IFS='~'
-      for cmd in $cmds; do
-	IFS=&quot;$save_ifs&quot;
-	$show &quot;$cmd&quot;
-	$run eval &quot;$cmd&quot; || exit $?
-      done
-      IFS=&quot;$save_ifs&quot;
-    done
+	    func_extract_archives $gentop $convenience
+	    func_append libobjs &quot; $func_extract_archives_result&quot;
+	    test &quot;X$libobjs&quot; = &quot;X &quot; &amp;&amp; libobjs=
+	  fi
+	fi
 
-    if test -n &quot;$generated&quot;; then
-      $show &quot;${rm}r$generated&quot;
-      $run ${rm}r$generated
-    fi
+	if test &quot;$thread_safe&quot; = yes &amp;&amp; test -n &quot;$thread_safe_flag_spec&quot;; then
+	  eval flag=\&quot;$thread_safe_flag_spec\&quot;
+	  func_append linker_flags &quot; $flag&quot;
+	fi
 
-    # Now create the libtool archive.
-    case $output in
-    *.la)
-      old_library=
-      test &quot;$build_old_libs&quot; = yes &amp;&amp; old_library=&quot;$libname.$libext&quot;
-      $show &quot;creating $output&quot;
+	# Make a backup of the uninstalled library when relinking
+	if test &quot;$opt_mode&quot; = relink; then
+	  $opt_dry_run || eval '(cd $output_objdir &amp;&amp; $RM ${realname}U &amp;&amp; $MV $realname ${realname}U)' || exit $?
+	fi
 
-      # Preserve any variables that may affect compiler behavior
-      for var in $variables_saved_for_relink; do
-	if eval test -z \&quot;\${$var+set}\&quot;; then
-	  relink_command=&quot;{ test -z \&quot;\${$var+set}\&quot; || unset $var || { $var=; export $var; }; }; $relink_command&quot;
-	elif eval var_value=\$$var; test -z &quot;$var_value&quot;; then
-	  relink_command=&quot;$var=; export $var; $relink_command&quot;
+	# Do each of the archive commands.
+	if test &quot;$module&quot; = yes &amp;&amp; test -n &quot;$module_cmds&quot; ; then
+	  if test -n &quot;$export_symbols&quot; &amp;&amp; test -n &quot;$module_expsym_cmds&quot;; then
+	    eval test_cmds=\&quot;$module_expsym_cmds\&quot;
+	    cmds=$module_expsym_cmds
+	  else
+	    eval test_cmds=\&quot;$module_cmds\&quot;
+	    cmds=$module_cmds
+	  fi
 	else
-	  var_value=`$echo &quot;X$var_value&quot; | $Xsed -e &quot;$sed_quote_subst&quot;`
-	  relink_command=&quot;$var=\&quot;$var_value\&quot;; export $var; $relink_command&quot;
+	  if test -n &quot;$export_symbols&quot; &amp;&amp; test -n &quot;$archive_expsym_cmds&quot;; then
+	    eval test_cmds=\&quot;$archive_expsym_cmds\&quot;
+	    cmds=$archive_expsym_cmds
+	  else
+	    eval test_cmds=\&quot;$archive_cmds\&quot;
+	    cmds=$archive_cmds
+	  fi
 	fi
-      done
-      # Quote the link command for shipping.
-      relink_command=&quot;cd `pwd`; $SHELL $0 --mode=relink $libtool_args&quot;
-      relink_command=`$echo &quot;X$relink_command&quot; | $Xsed -e &quot;$sed_quote_subst&quot;`
 
-      # Only create the output if not a dry run.
-      if test -z &quot;$run&quot;; then
-	for installed in no yes; do
-	  if test &quot;$installed&quot; = yes; then
-	    if test -z &quot;$install_libdir&quot;; then
-	      break
+	if test &quot;X$skipped_export&quot; != &quot;X:&quot; &amp;&amp;
+	   func_len &quot; $test_cmds&quot; &amp;&amp;
+	   len=$func_len_result &amp;&amp;
+	   test &quot;$len&quot; -lt &quot;$max_cmd_len&quot; || test &quot;$max_cmd_len&quot; -le -1; then
+	  :
+	else
+	  # The command line is too long to link in one step, link piecewise
+	  # or, if using GNU ld and skipped_export is not :, use a linker
+	  # script.
+
+	  # Save the value of $output and $libobjs because we want to
+	  # use them later.  If we have whole_archive_flag_spec, we
+	  # want to use save_libobjs as it was before
+	  # whole_archive_flag_spec was expanded, because we can't
+	  # assume the linker understands whole_archive_flag_spec.
+	  # This may have to be revisited, in case too many
+	  # convenience libraries get linked in and end up exceeding
+	  # the spec.
+	  if test -z &quot;$convenience&quot; || test -z &quot;$whole_archive_flag_spec&quot;; then
+	    save_libobjs=$libobjs
+	  fi
+	  save_output=$output
+	  func_basename &quot;$output&quot;
+	  output_la=$func_basename_result
+
+	  # Clear the reloadable object creation command queue and
+	  # initialize k to one.
+	  test_cmds=
+	  concat_cmds=
+	  objlist=
+	  last_robj=
+	  k=1
+
+	  if test -n &quot;$save_libobjs&quot; &amp;&amp; test &quot;X$skipped_export&quot; != &quot;X:&quot; &amp;&amp; test &quot;$with_gnu_ld&quot; = yes; then
+	    output=${output_objdir}/${output_la}.lnkscript
+	    func_verbose &quot;creating GNU ld script: $output&quot;
+	    echo 'INPUT (' &gt; $output
+	    for obj in $save_libobjs
+	    do
+	      func_to_tool_file &quot;$obj&quot;
+	      $ECHO &quot;$func_to_tool_file_result&quot; &gt;&gt; $output
+	    done
+	    echo ')' &gt;&gt; $output
+	    func_append delfiles &quot; $output&quot;
+	    func_to_tool_file &quot;$output&quot;
+	    output=$func_to_tool_file_result
+	  elif test -n &quot;$save_libobjs&quot; &amp;&amp; test &quot;X$skipped_export&quot; != &quot;X:&quot; &amp;&amp; test &quot;X$file_list_spec&quot; != X; then
+	    output=${output_objdir}/${output_la}.lnk
+	    func_verbose &quot;creating linker input file list: $output&quot;
+	    : &gt; $output
+	    set x $save_libobjs
+	    shift
+	    firstobj=
+	    if test &quot;$compiler_needs_object&quot; = yes; then
+	      firstobj=&quot;$1 &quot;
+	      shift
 	    fi
-	    output=&quot;$output_objdir/$outputname&quot;i
-	    # Replace all uninstalled libtool libraries with the installed ones
-	    newdependency_libs=
-	    for deplib in $dependency_libs; do
-	      case $deplib in
-	      *.la)
-		name=`$echo &quot;X$deplib&quot; | $Xsed -e 's%^.*/%%'`
-		eval libdir=`sed -n -e 's/^libdir=\(.*\)$/\1/p' $deplib`
-		if test -z &quot;$libdir&quot;; then
-		  $echo &quot;$modename: \`$deplib' is not a valid libtool archive&quot; 1&gt;&amp;2
-		  exit 1
-		fi
-		newdependency_libs=&quot;$newdependency_libs $libdir/$name&quot;
-		;;
-	      *) newdependency_libs=&quot;$newdependency_libs $deplib&quot; ;;
-	      esac
+	    for obj
+	    do
+	      func_to_tool_file &quot;$obj&quot;
+	      $ECHO &quot;$func_to_tool_file_result&quot; &gt;&gt; $output
 	    done
-	    dependency_libs=&quot;$newdependency_libs&quot;
-	    newdlfiles=
-	    for lib in $dlfiles; do
-	      name=`$echo &quot;X$lib&quot; | $Xsed -e 's%^.*/%%'`
-	      eval libdir=`sed -n -e 's/^libdir=\(.*\)$/\1/p' $lib`
-	      if test -z &quot;$libdir&quot;; then
-		$echo &quot;$modename: \`$lib' is not a valid libtool archive&quot; 1&gt;&amp;2
-		exit 1
+	    func_append delfiles &quot; $output&quot;
+	    func_to_tool_file &quot;$output&quot;
+	    output=$firstobj\&quot;$file_list_spec$func_to_tool_file_result\&quot;
+	  else
+	    if test -n &quot;$save_libobjs&quot;; then
+	      func_verbose &quot;creating reloadable object files...&quot;
+	      output=$output_objdir/$output_la-${k}.$objext
+	      eval test_cmds=\&quot;$reload_cmds\&quot;
+	      func_len &quot; $test_cmds&quot;
+	      len0=$func_len_result
+	      len=$len0
+
+	      # Loop over the list of objects to be linked.
+	      for obj in $save_libobjs
+	      do
+		func_len &quot; $obj&quot;
+		func_arith $len + $func_len_result
+		len=$func_arith_result
+		if test &quot;X$objlist&quot; = X ||
+		   test &quot;$len&quot; -lt &quot;$max_cmd_len&quot;; then
+		  func_append objlist &quot; $obj&quot;
+		else
+		  # The command $test_cmds is almost too long, add a
+		  # command to the queue.
+		  if test &quot;$k&quot; -eq 1 ; then
+		    # The first file doesn't have a previous command to add.
+		    reload_objs=$objlist
+		    eval concat_cmds=\&quot;$reload_cmds\&quot;
+		  else
+		    # All subsequent reloadable object files will link in
+		    # the last one created.
+		    reload_objs=&quot;$objlist $last_robj&quot;
+		    eval concat_cmds=\&quot;\$concat_cmds~$reload_cmds~\$RM $last_robj\&quot;
+		  fi
+		  last_robj=$output_objdir/$output_la-${k}.$objext
+		  func_arith $k + 1
+		  k=$func_arith_result
+		  output=$output_objdir/$output_la-${k}.$objext
+		  objlist=&quot; $obj&quot;
+		  func_len &quot; $last_robj&quot;
+		  func_arith $len0 + $func_len_result
+		  len=$func_arith_result
+		fi
+	      done
+	      # Handle the remaining objects by creating one last
+	      # reloadable object file.  All subsequent reloadable object
+	      # files will link in the last one created.
+	      test -z &quot;$concat_cmds&quot; || concat_cmds=$concat_cmds~
+	      reload_objs=&quot;$objlist $last_robj&quot;
+	      eval concat_cmds=\&quot;\${concat_cmds}$reload_cmds\&quot;
+	      if test -n &quot;$last_robj&quot;; then
+	        eval concat_cmds=\&quot;\${concat_cmds}~\$RM $last_robj\&quot;
 	      fi
-	      newdlfiles=&quot;$newdlfiles $libdir/$name&quot;
-	    done
-	    dlfiles=&quot;$newdlfiles&quot;
-	    newdlprefiles=
-	    for lib in $dlprefiles; do
-	      name=`$echo &quot;X$lib&quot; | $Xsed -e 's%^.*/%%'`
-	      eval libdir=`sed -n -e 's/^libdir=\(.*\)$/\1/p' $lib`
-	      if test -z &quot;$libdir&quot;; then
-		$echo &quot;$modename: \`$lib' is not a valid libtool archive&quot; 1&gt;&amp;2
-		exit 1
+	      func_append delfiles &quot; $output&quot;
+
+	    else
+	      output=
+	    fi
+
+	    if ${skipped_export-false}; then
+	      func_verbose &quot;generating symbol list for \`$libname.la'&quot;
+	      export_symbols=&quot;$output_objdir/$libname.exp&quot;
+	      $opt_dry_run || $RM $export_symbols
+	      libobjs=$output
+	      # Append the command to create the export file.
+	      test -z &quot;$concat_cmds&quot; || concat_cmds=$concat_cmds~
+	      eval concat_cmds=\&quot;\$concat_cmds$export_symbols_cmds\&quot;
+	      if test -n &quot;$last_robj&quot;; then
+		eval concat_cmds=\&quot;\$concat_cmds~\$RM $last_robj\&quot;
 	      fi
-	      newdlprefiles=&quot;$newdlprefiles $libdir/$name&quot;
+	    fi
+
+	    test -n &quot;$save_libobjs&quot; &amp;&amp;
+	      func_verbose &quot;creating a temporary reloadable object file: $output&quot;
+
+	    # Loop through the commands generated above and execute them.
+	    save_ifs=&quot;$IFS&quot;; IFS='~'
+	    for cmd in $concat_cmds; do
+	      IFS=&quot;$save_ifs&quot;
+	      $opt_silent || {
+		  func_quote_for_expand &quot;$cmd&quot;
+		  eval &quot;func_echo $func_quote_for_expand_result&quot;
+	      }
+	      $opt_dry_run || eval &quot;$cmd&quot; || {
+		lt_exit=$?
+
+		# Restore the uninstalled library and exit
+		if test &quot;$opt_mode&quot; = relink; then
+		  ( cd &quot;$output_objdir&quot; &amp;&amp; \
+		    $RM &quot;${realname}T&quot; &amp;&amp; \
+		    $MV &quot;${realname}U&quot; &quot;$realname&quot; )
+		fi
+
+		exit $lt_exit
+	      }
 	    done
-	    dlprefiles=&quot;$newdlprefiles&quot;
+	    IFS=&quot;$save_ifs&quot;
+
+	    if test -n &quot;$export_symbols_regex&quot; &amp;&amp; ${skipped_export-false}; then
+	      func_show_eval '$EGREP -e &quot;$export_symbols_regex&quot; &quot;$export_symbols&quot; &gt; &quot;${export_symbols}T&quot;'
+	      func_show_eval '$MV &quot;${export_symbols}T&quot; &quot;$export_symbols&quot;'
+	    fi
 	  fi
-	  $rm $output
-	  # place dlname in correct position for cygwin
-	  tdlname=$dlname
-	  case $host,$output,$installed,$module,$dlname in
-	    *cygwin*,*lai,yes,no,*.dll) tdlname=../bin/$dlname ;;
-	  esac
-	  $echo &gt; $output &quot;\
-# $outputname - a libtool library file
-# Generated by $PROGRAM - GNU $PACKAGE $VERSION$TIMESTAMP
-#
-# Please DO NOT delete this file!
-# It is necessary for linking the library.
 
-# The name that we can dlopen(3).
-dlname='$tdlname'
+          if ${skipped_export-false}; then
+	    if test -n &quot;$export_symbols&quot; &amp;&amp; test -n &quot;$include_expsyms&quot;; then
+	      tmp_export_symbols=&quot;$export_symbols&quot;
+	      test -n &quot;$orig_export_symbols&quot; &amp;&amp; tmp_export_symbols=&quot;$orig_export_symbols&quot;
+	      $opt_dry_run || eval '$ECHO &quot;$include_expsyms&quot; | $SP2NL &gt;&gt; &quot;$tmp_export_symbols&quot;'
+	    fi
 
-# Names of this library.
-library_names='$library_names'
+	    if test -n &quot;$orig_export_symbols&quot;; then
+	      # The given exports_symbols file has to be filtered, so filter it.
+	      func_verbose &quot;filter symbol list for \`$libname.la' to tag DATA exports&quot;
+	      # FIXME: $output_objdir/$libname.filter potentially contains lots of
+	      # 's' commands which not all seds can handle. GNU sed should be fine
+	      # though. Also, the filter scales superlinearly with the number of
+	      # global variables. join(1) would be nice here, but unfortunately
+	      # isn't a blessed tool.
+	      $opt_dry_run || $SED -e '/[ ,]DATA/!d;s,\(.*\)\([ \,].*\),s|^\1$|\1\2|,' &lt; $export_symbols &gt; $output_objdir/$libname.filter
+	      func_append delfiles &quot; $export_symbols $output_objdir/$libname.filter&quot;
+	      export_symbols=$output_objdir/$libname.def
+	      $opt_dry_run || $SED -f $output_objdir/$libname.filter &lt; $orig_export_symbols &gt; $export_symbols
+	    fi
+	  fi
 
-# The name of the static archive.
-old_library='$old_library'
+	  libobjs=$output
+	  # Restore the value of output.
+	  output=$save_output
 
-# Libraries that this one depends upon.
-dependency_libs='$dependency_libs'
+	  if test -n &quot;$convenience&quot; &amp;&amp; test -n &quot;$whole_archive_flag_spec&quot;; then
+	    eval libobjs=\&quot;\$libobjs $whole_archive_flag_spec\&quot;
+	    test &quot;X$libobjs&quot; = &quot;X &quot; &amp;&amp; libobjs=
+	  fi
+	  # Expand the library linking commands again to reset the
+	  # value of $libobjs for piecewise linking.
 
-# Version information for $libname.
-current=$current
-age=$age
-revision=$revision
+	  # Do each of the archive commands.
+	  if test &quot;$module&quot; = yes &amp;&amp; test -n &quot;$module_cmds&quot; ; then
+	    if test -n &quot;$export_symbols&quot; &amp;&amp; test -n &quot;$module_expsym_cmds&quot;; then
+	      cmds=$module_expsym_cmds
+	    else
+	      cmds=$module_cmds
+	    fi
+	  else
+	    if test -n &quot;$export_symbols&quot; &amp;&amp; test -n &quot;$archive_expsym_cmds&quot;; then
+	      cmds=$archive_expsym_cmds
+	    else
+	      cmds=$archive_cmds
+	    fi
+	  fi
+	fi
 
-# Is this an already installed library?
-installed=$installed
+	if test -n &quot;$delfiles&quot;; then
+	  # Append the command to remove temporary files to $cmds.
+	  eval cmds=\&quot;\$cmds~\$RM $delfiles\&quot;
+	fi
 
-# Files to dlopen/dlpreopen
-dlopen='$dlfiles'
-dlpreopen='$dlprefiles'
+	# Add any objects from preloaded convenience libraries
+	if test -n &quot;$dlprefiles&quot;; then
+	  gentop=&quot;$output_objdir/${outputname}x&quot;
+	  func_append generated &quot; $gentop&quot;
 
-# Directory that this library needs to be installed in:
-libdir='$install_libdir'&quot;
-	  if test &quot;$installed&quot; = no &amp;&amp; test $need_relink = yes; then
-	    $echo &gt;&gt; $output &quot;\
-relink_command=\&quot;$relink_command\&quot;&quot;
+	  func_extract_archives $gentop $dlprefiles
+	  func_append libobjs &quot; $func_extract_archives_result&quot;
+	  test &quot;X$libobjs&quot; = &quot;X &quot; &amp;&amp; libobjs=
+	fi
+
+	save_ifs=&quot;$IFS&quot;; IFS='~'
+	for cmd in $cmds; do
+	  IFS=&quot;$save_ifs&quot;
+	  eval cmd=\&quot;$cmd\&quot;
+	  $opt_silent || {
+	    func_quote_for_expand &quot;$cmd&quot;
+	    eval &quot;func_echo $func_quote_for_expand_result&quot;
+	  }
+	  $opt_dry_run || eval &quot;$cmd&quot; || {
+	    lt_exit=$?
+
+	    # Restore the uninstalled library and exit
+	    if test &quot;$opt_mode&quot; = relink; then
+	      ( cd &quot;$output_objdir&quot; &amp;&amp; \
+	        $RM &quot;${realname}T&quot; &amp;&amp; \
+		$MV &quot;${realname}U&quot; &quot;$realname&quot; )
+	    fi
+
+	    exit $lt_exit
+	  }
+	done
+	IFS=&quot;$save_ifs&quot;
+
+	# Restore the uninstalled library and exit
+	if test &quot;$opt_mode&quot; = relink; then
+	  $opt_dry_run || eval '(cd $output_objdir &amp;&amp; $RM ${realname}T &amp;&amp; $MV $realname ${realname}T &amp;&amp; $MV ${realname}U $realname)' || exit $?
+
+	  if test -n &quot;$convenience&quot;; then
+	    if test -z &quot;$whole_archive_flag_spec&quot;; then
+	      func_show_eval '${RM}r &quot;$gentop&quot;'
+	    fi
+	  fi
+
+	  exit $EXIT_SUCCESS
+	fi
+
+	# Create links to the real library.
+	for linkname in $linknames; do
+	  if test &quot;$realname&quot; != &quot;$linkname&quot;; then
+	    func_show_eval '(cd &quot;$output_objdir&quot; &amp;&amp; $RM &quot;$linkname&quot; &amp;&amp; $LN_S &quot;$realname&quot; &quot;$linkname&quot;)' 'exit $?'
 	  fi
 	done
-      fi
 
-      # Do a symbolic link so that the libtool archive can be found in
-      # LD_LIBRARY_PATH before the program is installed.
-      $show &quot;(cd $output_objdir &amp;&amp; $rm $outputname &amp;&amp; $LN_S ../$outputname $outputname)&quot;
-      $run eval '(cd $output_objdir &amp;&amp; $rm $outputname &amp;&amp; $LN_S ../$outputname $outputname)' || exit $?
+	# If -module or -export-dynamic was specified, set the dlname.
+	if test &quot;$module&quot; = yes || test &quot;$export_dynamic&quot; = yes; then
+	  # On all known operating systems, these are identical.
+	  dlname=&quot;$soname&quot;
+	fi
+      fi
       ;;
-    esac
-    exit 0
-    ;;
 
-  # libtool install mode
-  install)
-    modename=&quot;$modename: install&quot;
+    obj)
+      if test -n &quot;$dlfiles$dlprefiles&quot; || test &quot;$dlself&quot; != no; then
+	func_warning &quot;\`-dlopen' is ignored for objects&quot;
+      fi
 
-    # There may be an optional sh(1) argument at the beginning of
-    # install_prog (especially on Windows NT).
-    if test &quot;$nonopt&quot; = &quot;$SHELL&quot; || test &quot;$nonopt&quot; = /bin/sh ||
-       # Allow the use of GNU shtool's install command.
-       $echo &quot;X$nonopt&quot; | $Xsed | grep shtool &gt; /dev/null; then
-      # Aesthetically quote it.
-      arg=`$echo &quot;X$nonopt&quot; | $Xsed -e &quot;$sed_quote_subst&quot;`
-      case $arg in
-      *[\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*)
-	arg=&quot;\&quot;$arg\&quot;&quot;
-	;;
+      case &quot; $deplibs&quot; in
+      *\ -l* | *\ -L*)
+	func_warning &quot;\`-l' and \`-L' are ignored for objects&quot; ;;
       esac
-      install_prog=&quot;$arg &quot;
-      arg=&quot;$1&quot;
-      shift
-    else
-      install_prog=
-      arg=&quot;$nonopt&quot;
-    fi
 
-    # The real first argument should be the name of the installation program.
-    # Aesthetically quote it.
-    arg=`$echo &quot;X$arg&quot; | $Xsed -e &quot;$sed_quote_subst&quot;`
-    case $arg in
-    *[\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*)
-      arg=&quot;\&quot;$arg\&quot;&quot;
-      ;;
-    esac
-    install_prog=&quot;$install_prog$arg&quot;
+      test -n &quot;$rpath&quot; &amp;&amp; \
+	func_warning &quot;\`-rpath' is ignored for objects&quot;
 
-    # We need to accept at least all the BSD install flags.
-    dest=
-    files=
-    opts=
-    prev=
-    install_type=
-    isdir=no
-    stripme=
-    for arg
-    do
-      if test -n &quot;$dest&quot;; then
-	files=&quot;$files $dest&quot;
-	dest=&quot;$arg&quot;
-	continue
-      fi
+      test -n &quot;$xrpath&quot; &amp;&amp; \
+	func_warning &quot;\`-R' is ignored for objects&quot;
 
-      case $arg in
-      -d) isdir=yes ;;
-      -f) prev=&quot;-f&quot; ;;
-      -g) prev=&quot;-g&quot; ;;
-      -m) prev=&quot;-m&quot; ;;
-      -o) prev=&quot;-o&quot; ;;
-      -s)
-	stripme=&quot; -s&quot;
-	continue
-	;;
-      -*) ;;
+      test -n &quot;$vinfo&quot; &amp;&amp; \
+	func_warning &quot;\`-version-info' is ignored for objects&quot;
+
+      test -n &quot;$release&quot; &amp;&amp; \
+	func_warning &quot;\`-release' is ignored for objects&quot;
+
+      case $output in
+      *.lo)
+	test -n &quot;$objs$old_deplibs&quot; &amp;&amp; \
+	  func_fatal_error &quot;cannot build library object \`$output' from non-libtool objects&quot;
 
+	libobj=$output
+	func_lo2o &quot;$libobj&quot;
+	obj=$func_lo2o_result
+	;;
       *)
-	# If the previous option needed an argument, then skip it.
-	if test -n &quot;$prev&quot;; then
-	  prev=
-	else
-	  dest=&quot;$arg&quot;
-	  continue
-	fi
+	libobj=
+	obj=&quot;$output&quot;
 	;;
       esac
 
-      # Aesthetically quote the argument.
-      arg=`$echo &quot;X$arg&quot; | $Xsed -e &quot;$sed_quote_subst&quot;`
-      case $arg in
-      *[\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*)
-	arg=&quot;\&quot;$arg\&quot;&quot;
-	;;
-      esac
-      install_prog=&quot;$install_prog $arg&quot;
-    done
+      # Delete the old objects.
+      $opt_dry_run || $RM $obj $libobj
 
-    if test -z &quot;$install_prog&quot;; then
-      $echo &quot;$modename: you must specify an install program&quot; 1&gt;&amp;2
-      $echo &quot;$help&quot; 1&gt;&amp;2
-      exit 1
-    fi
+      # Objects from convenience libraries.  This assumes
+      # single-version convenience libraries.  Whenever we create
+      # different ones for PIC/non-PIC, this we'll have to duplicate
+      # the extraction.
+      reload_conv_objs=
+      gentop=
+      # reload_cmds runs $LD directly, so let us get rid of
+      # -Wl from whole_archive_flag_spec and hope we can get by with
+      # turning comma into space..
+      wl=
 
-    if test -n &quot;$prev&quot;; then
-      $echo &quot;$modename: the \`$prev' option requires an argument&quot; 1&gt;&amp;2
-      $echo &quot;$help&quot; 1&gt;&amp;2
-      exit 1
-    fi
+      if test -n &quot;$convenience&quot;; then
+	if test -n &quot;$whole_archive_flag_spec&quot;; then
+	  eval tmp_whole_archive_flags=\&quot;$whole_archive_flag_spec\&quot;
+	  reload_conv_objs=$reload_objs\ `$ECHO &quot;$tmp_whole_archive_flags&quot; | $SED 's|,| |g'`
+	else
+	  gentop=&quot;$output_objdir/${obj}x&quot;
+	  func_append generated &quot; $gentop&quot;
 
-    if test -z &quot;$files&quot;; then
-      if test -z &quot;$dest&quot;; then
-	$echo &quot;$modename: no file or destination specified&quot; 1&gt;&amp;2
-      else
-	$echo &quot;$modename: you must specify a destination&quot; 1&gt;&amp;2
+	  func_extract_archives $gentop $convenience
+	  reload_conv_objs=&quot;$reload_objs $func_extract_archives_result&quot;
+	fi
+      fi
+
+      # If we're not building shared, we need to use non_pic_objs
+      test &quot;$build_libtool_libs&quot; != yes &amp;&amp; libobjs=&quot;$non_pic_objects&quot;
+
+      # Create the old-style object.
+      reload_objs=&quot;$objs$old_deplibs &quot;`$ECHO &quot;$libobjs&quot; | $SP2NL | $SED &quot;/\.${libext}$/d; /\.lib$/d; $lo2o&quot; | $NL2SP`&quot; $reload_conv_objs&quot; ### testsuite: skip nested quoting test
+
+      output=&quot;$obj&quot;
+      func_execute_cmds &quot;$reload_cmds&quot; 'exit $?'
+
+      # Exit if we aren't doing a library object file.
+      if test -z &quot;$libobj&quot;; then
+	if test -n &quot;$gentop&quot;; then
+	  func_show_eval '${RM}r &quot;$gentop&quot;'
+	fi
+
+	exit $EXIT_SUCCESS
       fi
-      $echo &quot;$help&quot; 1&gt;&amp;2
-      exit 1
-    fi
 
-    # Strip any trailing slash from the destination.
-    dest=`$echo &quot;X$dest&quot; | $Xsed -e 's%/$%%'`
+      if test &quot;$build_libtool_libs&quot; != yes; then
+	if test -n &quot;$gentop&quot;; then
+	  func_show_eval '${RM}r &quot;$gentop&quot;'
+	fi
 
-    # Check to see that the destination is a directory.
-    test -d &quot;$dest&quot; &amp;&amp; isdir=yes
-    if test &quot;$isdir&quot; = yes; then
-      destdir=&quot;$dest&quot;
-      destname=
-    else
-      destdir=`$echo &quot;X$dest&quot; | $Xsed -e 's%/[^/]*$%%'`
-      test &quot;X$destdir&quot; = &quot;X$dest&quot; &amp;&amp; destdir=.
-      destname=`$echo &quot;X$dest&quot; | $Xsed -e 's%^.*/%%'`
+	# Create an invalid libtool object if no PIC, so that we don't
+	# accidentally link it into a program.
+	# $show &quot;echo timestamp &gt; $libobj&quot;
+	# $opt_dry_run || eval &quot;echo timestamp &gt; $libobj&quot; || exit $?
+	exit $EXIT_SUCCESS
+      fi
 
-      # Not a directory, so check to see that there is only one file specified.
-      set dummy $files
-      if test $# -gt 2; then
-	$echo &quot;$modename: \`$dest' is not a directory&quot; 1&gt;&amp;2
-	$echo &quot;$help&quot; 1&gt;&amp;2
-	exit 1
+      if test -n &quot;$pic_flag&quot; || test &quot;$pic_mode&quot; != default; then
+	# Only do commands if we really have different PIC objects.
+	reload_objs=&quot;$libobjs $reload_conv_objs&quot;
+	output=&quot;$libobj&quot;
+	func_execute_cmds &quot;$reload_cmds&quot; 'exit $?'
       fi
-    fi
-    case $destdir in
-    [\\/]* | [A-Za-z]:[\\/]*) ;;
-    *)
-      for file in $files; do
-	case $file in
-	*.lo) ;;
-	*)
-	  $echo &quot;$modename: \`$destdir' must be an absolute directory name&quot; 1&gt;&amp;2
-	  $echo &quot;$help&quot; 1&gt;&amp;2
-	  exit 1
-	  ;;
-	esac
-      done
+
+      if test -n &quot;$gentop&quot;; then
+	func_show_eval '${RM}r &quot;$gentop&quot;'
+      fi
+
+      exit $EXIT_SUCCESS
       ;;
-    esac
 
-    # This variable tells wrapper scripts just to set variables rather
-    # than running their programs.
-    libtool_install_magic=&quot;$magic&quot;
+    prog)
+      case $host in
+	*cygwin*) func_stripname '' '.exe' &quot;$output&quot;
+	          output=$func_stripname_result.exe;;
+      esac
+      test -n &quot;$vinfo&quot; &amp;&amp; \
+	func_warning &quot;\`-version-info' is ignored for programs&quot;
 
-    staticlibs=
-    future_libdirs=
-    current_libdirs=
-    for file in $files; do
+      test -n &quot;$release&quot; &amp;&amp; \
+	func_warning &quot;\`-release' is ignored for programs&quot;
 
-      # Do each installation.
-      case $file in
-      *.$libext)
-	# Do the static libraries later.
-	staticlibs=&quot;$staticlibs $file&quot;
+      test &quot;$preload&quot; = yes \
+        &amp;&amp; test &quot;$dlopen_support&quot; = unknown \
+	&amp;&amp; test &quot;$dlopen_self&quot; = unknown \
+	&amp;&amp; test &quot;$dlopen_self_static&quot; = unknown &amp;&amp; \
+	  func_warning &quot;\`LT_INIT([dlopen])' not used. Assuming no dlopen support.&quot;
+
+      case $host in
+      *-*-rhapsody* | *-*-darwin1.[012])
+	# On Rhapsody replace the C library is the System framework
+	compile_deplibs=`$ECHO &quot; $compile_deplibs&quot; | $SED 's/ -lc / System.ltframework /'`
+	finalize_deplibs=`$ECHO &quot; $finalize_deplibs&quot; | $SED 's/ -lc / System.ltframework /'`
 	;;
+      esac
 
-      *.la)
-	# Check to see that this really is a libtool archive.
-	if (sed -e '2q' $file | egrep &quot;^# Generated by .*$PACKAGE&quot;) &gt;/dev/null 2&gt;&amp;1; then :
-	else
-	  $echo &quot;$modename: \`$file' is not a valid libtool archive&quot; 1&gt;&amp;2
-	  $echo &quot;$help&quot; 1&gt;&amp;2
-	  exit 1
+      case $host in
+      *-*-darwin*)
+	# Don't allow lazy linking, it breaks C++ global constructors
+	# But is supposedly fixed on 10.4 or later (yay!).
+	if test &quot;$tagname&quot; = CXX ; then
+	  case ${MACOSX_DEPLOYMENT_TARGET-10.0} in
+	    10.[0123])
+	      func_append compile_command &quot; ${wl}-bind_at_load&quot;
+	      func_append finalize_command &quot; ${wl}-bind_at_load&quot;
+	    ;;
+	  esac
 	fi
+	# Time to change all our &quot;foo.ltframework&quot; stuff back to &quot;-framework foo&quot;
+	compile_deplibs=`$ECHO &quot; $compile_deplibs&quot; | $SED 's% \([^ $]*\).ltframework% -framework \1%g'`
+	finalize_deplibs=`$ECHO &quot; $finalize_deplibs&quot; | $SED 's% \([^ $]*\).ltframework% -framework \1%g'`
+	;;
+      esac
 
-	library_names=
-	old_library=
-	relink_command=
-	# If there is no directory component, then add one.
-	case $file in
-	*/* | *\\*) . $file ;;
-	*) . ./$file ;;
+
+      # move library search paths that coincide with paths to not yet
+      # installed libraries to the beginning of the library search list
+      new_libs=
+      for path in $notinst_path; do
+	case &quot; $new_libs &quot; in
+	*&quot; -L$path/$objdir &quot;*) ;;
+	*)
+	  case &quot; $compile_deplibs &quot; in
+	  *&quot; -L$path/$objdir &quot;*)
+	    func_append new_libs &quot; -L$path/$objdir&quot; ;;
+	  esac
+	  ;;
+	esac
+      done
+      for deplib in $compile_deplibs; do
+	case $deplib in
+	-L*)
+	  case &quot; $new_libs &quot; in
+	  *&quot; $deplib &quot;*) ;;
+	  *) func_append new_libs &quot; $deplib&quot; ;;
+	  esac
+	  ;;
+	*) func_append new_libs &quot; $deplib&quot; ;;
 	esac
+      done
+      compile_deplibs=&quot;$new_libs&quot;
 
-	# Add the libdir to current_libdirs if it is the destination.
-	if test &quot;X$destdir&quot; = &quot;X$libdir&quot;; then
-	  case &quot;$current_libdirs &quot; in
+
+      func_append compile_command &quot; $compile_deplibs&quot;
+      func_append finalize_command &quot; $finalize_deplibs&quot;
+
+      if test -n &quot;$rpath$xrpath&quot;; then
+	# If the user specified any rpath flags, then add them.
+	for libdir in $rpath $xrpath; do
+	  # This is the magic to use -rpath.
+	  case &quot;$finalize_rpath &quot; in
 	  *&quot; $libdir &quot;*) ;;
-	  *) current_libdirs=&quot;$current_libdirs $libdir&quot; ;;
+	  *) func_append finalize_rpath &quot; $libdir&quot; ;;
 	  esac
-	else
-	  # Note the libdir as a future libdir.
-	  case &quot;$future_libdirs &quot; in
+	done
+      fi
+
+      # Now hardcode the library paths
+      rpath=
+      hardcode_libdirs=
+      for libdir in $compile_rpath $finalize_rpath; do
+	if test -n &quot;$hardcode_libdir_flag_spec&quot;; then
+	  if test -n &quot;$hardcode_libdir_separator&quot;; then
+	    if test -z &quot;$hardcode_libdirs&quot;; then
+	      hardcode_libdirs=&quot;$libdir&quot;
+	    else
+	      # Just accumulate the unique libdirs.
+	      case $hardcode_libdir_separator$hardcode_libdirs$hardcode_libdir_separator in
+	      *&quot;$hardcode_libdir_separator$libdir$hardcode_libdir_separator&quot;*)
+		;;
+	      *)
+		func_append hardcode_libdirs &quot;$hardcode_libdir_separator$libdir&quot;
+		;;
+	      esac
+	    fi
+	  else
+	    eval flag=\&quot;$hardcode_libdir_flag_spec\&quot;
+	    func_append rpath &quot; $flag&quot;
+	  fi
+	elif test -n &quot;$runpath_var&quot;; then
+	  case &quot;$perm_rpath &quot; in
 	  *&quot; $libdir &quot;*) ;;
-	  *) future_libdirs=&quot;$future_libdirs $libdir&quot; ;;
+	  *) func_append perm_rpath &quot; $libdir&quot; ;;
 	  esac
 	fi
+	case $host in
+	*-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-os2* | *-cegcc*)
+	  testbindir=`${ECHO} &quot;$libdir&quot; | ${SED} -e 's*/lib$*/bin*'`
+	  case :$dllsearchpath: in
+	  *&quot;:$libdir:&quot;*) ;;
+	  ::) dllsearchpath=$libdir;;
+	  *) func_append dllsearchpath &quot;:$libdir&quot;;;
+	  esac
+	  case :$dllsearchpath: in
+	  *&quot;:$testbindir:&quot;*) ;;
+	  ::) dllsearchpath=$testbindir;;
+	  *) func_append dllsearchpath &quot;:$testbindir&quot;;;
+	  esac
+	  ;;
+	esac
+      done
+      # Substitute the hardcoded libdirs into the rpath.
+      if test -n &quot;$hardcode_libdir_separator&quot; &amp;&amp;
+	 test -n &quot;$hardcode_libdirs&quot;; then
+	libdir=&quot;$hardcode_libdirs&quot;
+	eval rpath=\&quot; $hardcode_libdir_flag_spec\&quot;
+      fi
+      compile_rpath=&quot;$rpath&quot;
 
-	dir=`$echo &quot;X$file&quot; | $Xsed -e 's%/[^/]*$%%'`/
-	test &quot;X$dir&quot; = &quot;X$file/&quot; &amp;&amp; dir=
-	dir=&quot;$dir$objdir&quot;
-
-	if test -n &quot;$relink_command&quot;; then
-	  $echo &quot;$modename: warning: relinking \`$file'&quot; 1&gt;&amp;2
-	  $show &quot;$relink_command&quot;
-	  if $run eval &quot;$relink_command&quot;; then :
+      rpath=
+      hardcode_libdirs=
+      for libdir in $finalize_rpath; do
+	if test -n &quot;$hardcode_libdir_flag_spec&quot;; then
+	  if test -n &quot;$hardcode_libdir_separator&quot;; then
+	    if test -z &quot;$hardcode_libdirs&quot;; then
+	      hardcode_libdirs=&quot;$libdir&quot;
+	    else
+	      # Just accumulate the unique libdirs.
+	      case $hardcode_libdir_separator$hardcode_libdirs$hardcode_libdir_separator in
+	      *&quot;$hardcode_libdir_separator$libdir$hardcode_libdir_separator&quot;*)
+		;;
+	      *)
+		func_append hardcode_libdirs &quot;$hardcode_libdir_separator$libdir&quot;
+		;;
+	      esac
+	    fi
 	  else
-	    $echo &quot;$modename: error: relink \`$file' with the above command before installing it&quot; 1&gt;&amp;2
-	    continue
+	    eval flag=\&quot;$hardcode_libdir_flag_spec\&quot;
+	    func_append rpath &quot; $flag&quot;
 	  fi
+	elif test -n &quot;$runpath_var&quot;; then
+	  case &quot;$finalize_perm_rpath &quot; in
+	  *&quot; $libdir &quot;*) ;;
+	  *) func_append finalize_perm_rpath &quot; $libdir&quot; ;;
+	  esac
 	fi
+      done
+      # Substitute the hardcoded libdirs into the rpath.
+      if test -n &quot;$hardcode_libdir_separator&quot; &amp;&amp;
+	 test -n &quot;$hardcode_libdirs&quot;; then
+	libdir=&quot;$hardcode_libdirs&quot;
+	eval rpath=\&quot; $hardcode_libdir_flag_spec\&quot;
+      fi
+      finalize_rpath=&quot;$rpath&quot;
 
-	# See the names of the shared library.
-	set dummy $library_names
-	if test -n &quot;$2&quot;; then
-	  realname=&quot;$2&quot;
-	  shift
-	  shift
+      if test -n &quot;$libobjs&quot; &amp;&amp; test &quot;$build_old_libs&quot; = yes; then
+	# Transform all the library objects into standard objects.
+	compile_command=`$ECHO &quot;$compile_command&quot; | $SP2NL | $SED &quot;$lo2o&quot; | $NL2SP`
+	finalize_command=`$ECHO &quot;$finalize_command&quot; | $SP2NL | $SED &quot;$lo2o&quot; | $NL2SP`
+      fi
 
-	  srcname=&quot;$realname&quot;
-	  test -n &quot;$relink_command&quot; &amp;&amp; srcname=&quot;$realname&quot;T
+      func_generate_dlsyms &quot;$outputname&quot; &quot;@PROGRAM@&quot; &quot;no&quot;
 
-	  # Install the shared library and build the symlinks.
-	  $show &quot;$install_prog $dir/$srcname $destdir/$realname&quot;
-	  $run eval &quot;$install_prog $dir/$srcname $destdir/$realname&quot; || exit $?
-	  if test -n &quot;$stripme&quot; &amp;&amp; test -n &quot;$striplib&quot;; then
-	    $show &quot;$striplib $destdir/$realname&quot;
-	    $run eval &quot;$striplib $destdir/$realname&quot; || exit $?
-	  fi
+      # template prelinking step
+      if test -n &quot;$prelink_cmds&quot;; then
+	func_execute_cmds &quot;$prelink_cmds&quot; 'exit $?'
+      fi
 
-	  if test $# -gt 0; then
-	    # Delete the old symlinks, and create new ones.
-	    for linkname
-	    do
-	      if test &quot;$linkname&quot; != &quot;$realname&quot;; then
-		$show &quot;(cd $destdir &amp;&amp; $rm $linkname &amp;&amp; $LN_S $realname $linkname)&quot;
-		$run eval &quot;(cd $destdir &amp;&amp; $rm $linkname &amp;&amp; $LN_S $realname $linkname)&quot;
-	      fi
-	    done
-	  fi
+      wrappers_required=yes
+      case $host in
+      *cegcc* | *mingw32ce*)
+        # Disable wrappers for cegcc and mingw32ce hosts, we are cross compiling anyway.
+        wrappers_required=no
+        ;;
+      *cygwin* | *mingw* )
+        if test &quot;$build_libtool_libs&quot; != yes; then
+          wrappers_required=no
+        fi
+        ;;
+      *)
+        if test &quot;$need_relink&quot; = no || test &quot;$build_libtool_libs&quot; != yes; then
+          wrappers_required=no
+        fi
+        ;;
+      esac
+      if test &quot;$wrappers_required&quot; = no; then
+	# Replace the output file specification.
+	compile_command=`$ECHO &quot;$compile_command&quot; | $SED 's%@OUTPUT@%'&quot;$output&quot;'%g'`
+	link_command=&quot;$compile_command$compile_rpath&quot;
 
-	  # Do each command in the postinstall commands.
-	  lib=&quot;$destdir/$realname&quot;
-	  eval cmds=\&quot;$postinstall_cmds\&quot;
-	  save_ifs=&quot;$IFS&quot;; IFS='~'
-	  for cmd in $cmds; do
-	    IFS=&quot;$save_ifs&quot;
-	    $show &quot;$cmd&quot;
-	    $run eval &quot;$cmd&quot; || exit $?
-	  done
-	  IFS=&quot;$save_ifs&quot;
+	# We have no uninstalled library dependencies, so finalize right now.
+	exit_status=0
+	func_show_eval &quot;$link_command&quot; 'exit_status=$?'
+
+	if test -n &quot;$postlink_cmds&quot;; then
+	  func_to_tool_file &quot;$output&quot;
+	  postlink_cmds=`func_echo_all &quot;$postlink_cmds&quot; | $SED -e 's%@OUTPUT@%'&quot;$output&quot;'%g' -e 's%@TOOL_OUTPUT@%'&quot;$func_to_tool_file_result&quot;'%g'`
+	  func_execute_cmds &quot;$postlink_cmds&quot; 'exit $?'
 	fi
 
-	# Install the pseudo-library for information purposes.
-	name=`$echo &quot;X$file&quot; | $Xsed -e 's%^.*/%%'`
-	instname=&quot;$dir/$name&quot;i
-	$show &quot;$install_prog $instname $destdir/$name&quot;
-	$run eval &quot;$install_prog $instname $destdir/$name&quot; || exit $?
+	# Delete the generated files.
+	if test -f &quot;$output_objdir/${outputname}S.${objext}&quot;; then
+	  func_show_eval '$RM &quot;$output_objdir/${outputname}S.${objext}&quot;'
+	fi
 
-	# Maybe install the static library, too.
-	test -n &quot;$old_library&quot; &amp;&amp; staticlibs=&quot;$staticlibs $dir/$old_library&quot;
-	;;
+	exit $exit_status
+      fi
 
-      *.lo)
-	# Install (i.e. copy) a libtool object.
+      if test -n &quot;$compile_shlibpath$finalize_shlibpath&quot;; then
+	compile_command=&quot;$shlibpath_var=\&quot;$compile_shlibpath$finalize_shlibpath\$$shlibpath_var\&quot; $compile_command&quot;
+      fi
+      if test -n &quot;$finalize_shlibpath&quot;; then
+	finalize_command=&quot;$shlibpath_var=\&quot;$finalize_shlibpath\$$shlibpath_var\&quot; $finalize_command&quot;
+      fi
 
-	# Figure out destination file name, if it wasn't already specified.
-	if test -n &quot;$destname&quot;; then
-	  destfile=&quot;$destdir/$destname&quot;
-	else
-	  destfile=`$echo &quot;X$file&quot; | $Xsed -e 's%^.*/%%'`
-	  destfile=&quot;$destdir/$destfile&quot;
+      compile_var=
+      finalize_var=
+      if test -n &quot;$runpath_var&quot;; then
+	if test -n &quot;$perm_rpath&quot;; then
+	  # We should set the runpath_var.
+	  rpath=
+	  for dir in $perm_rpath; do
+	    func_append rpath &quot;$dir:&quot;
+	  done
+	  compile_var=&quot;$runpath_var=\&quot;$rpath\$$runpath_var\&quot; &quot;
+	fi
+	if test -n &quot;$finalize_perm_rpath&quot;; then
+	  # We should set the runpath_var.
+	  rpath=
+	  for dir in $finalize_perm_rpath; do
+	    func_append rpath &quot;$dir:&quot;
+	  done
+	  finalize_var=&quot;$runpath_var=\&quot;$rpath\$$runpath_var\&quot; &quot;
 	fi
+      fi
 
-	# Deduce the name of the destination old-style object file.
-	case $destfile in
-	*.lo)
-	  staticdest=`$echo &quot;X$destfile&quot; | $Xsed -e &quot;$lo2o&quot;`
-	  ;;
-	*.$objext)
-	  staticdest=&quot;$destfile&quot;
-	  destfile=
-	  ;;
-	*)
-	  $echo &quot;$modename: cannot copy a libtool object to \`$destfile'&quot; 1&gt;&amp;2
-	  $echo &quot;$help&quot; 1&gt;&amp;2
-	  exit 1
-	  ;;
-	esac
+      if test &quot;$no_install&quot; = yes; then
+	# We don't need to create a wrapper script.
+	link_command=&quot;$compile_var$compile_command$compile_rpath&quot;
+	# Replace the output file specification.
+	link_command=`$ECHO &quot;$link_command&quot; | $SED 's%@OUTPUT@%'&quot;$output&quot;'%g'`
+	# Delete the old output file.
+	$opt_dry_run || $RM $output
+	# Link the executable and exit
+	func_show_eval &quot;$link_command&quot; 'exit $?'
 
-	# Install the libtool object if requested.
-	if test -n &quot;$destfile&quot;; then
-	  $show &quot;$install_prog $file $destfile&quot;
-	  $run eval &quot;$install_prog $file $destfile&quot; || exit $?
+	if test -n &quot;$postlink_cmds&quot;; then
+	  func_to_tool_file &quot;$output&quot;
+	  postlink_cmds=`func_echo_all &quot;$postlink_cmds&quot; | $SED -e 's%@OUTPUT@%'&quot;$output&quot;'%g' -e 's%@TOOL_OUTPUT@%'&quot;$func_to_tool_file_result&quot;'%g'`
+	  func_execute_cmds &quot;$postlink_cmds&quot; 'exit $?'
 	fi
 
-	# Install the old object if enabled.
-	if test &quot;$build_old_libs&quot; = yes; then
-	  # Deduce the name of the old-style object file.
-	  staticobj=`$echo &quot;X$file&quot; | $Xsed -e &quot;$lo2o&quot;`
+	exit $EXIT_SUCCESS
+      fi
 
-	  $show &quot;$install_prog $staticobj $staticdest&quot;
-	  $run eval &quot;$install_prog \$staticobj \$staticdest&quot; || exit $?
-	fi
-	exit 0
-	;;
+      if test &quot;$hardcode_action&quot; = relink; then
+	# Fast installation is not supported
+	link_command=&quot;$compile_var$compile_command$compile_rpath&quot;
+	relink_command=&quot;$finalize_var$finalize_command$finalize_rpath&quot;
 
-      *)
-	# Figure out destination file name, if it wasn't already specified.
-	if test -n &quot;$destname&quot;; then
-	  destfile=&quot;$destdir/$destname&quot;
+	func_warning &quot;this platform does not like uninstalled shared libraries&quot;
+	func_warning &quot;\`$output' will be relinked during installation&quot;
+      else
+	if test &quot;$fast_install&quot; != no; then
+	  link_command=&quot;$finalize_var$compile_command$finalize_rpath&quot;
+	  if test &quot;$fast_install&quot; = yes; then
+	    relink_command=`$ECHO &quot;$compile_var$compile_command$compile_rpath&quot; | $SED 's%@OUTPUT@%\$progdir/\$file%g'`
+	  else
+	    # fast_install is set to needless
+	    relink_command=
+	  fi
 	else
-	  destfile=`$echo &quot;X$file&quot; | $Xsed -e 's%^.*/%%'`
-	  destfile=&quot;$destdir/$destfile&quot;
+	  link_command=&quot;$compile_var$compile_command$compile_rpath&quot;
+	  relink_command=&quot;$finalize_var$finalize_command$finalize_rpath&quot;
 	fi
+      fi
 
-	# Do a test to see if this is really a libtool program.
-	if (sed -e '4q' $file | egrep &quot;^# Generated by .*$PACKAGE&quot;) &gt;/dev/null 2&gt;&amp;1; then
-	  notinst_deplibs=
-	  relink_command=
+      # Replace the output file specification.
+      link_command=`$ECHO &quot;$link_command&quot; | $SED 's%@OUTPUT@%'&quot;$output_objdir/$outputname&quot;'%g'`
 
-	  # If there is no directory component, then add one.
-	  case $file in
-	  */* | *\\*) . $file ;;
-	  *) . ./$file ;;
-	  esac
+      # Delete the old output files.
+      $opt_dry_run || $RM $output $output_objdir/$outputname $output_objdir/lt-$outputname
 
-	  # Check the variables that should have been set.
-	  if test -z &quot;$notinst_deplibs&quot;; then
-	    $echo &quot;$modename: invalid libtool wrapper script \`$file'&quot; 1&gt;&amp;2
-	    exit 1
-	  fi
+      func_show_eval &quot;$link_command&quot; 'exit $?'
 
-	  finalize=yes
-	  for lib in $notinst_deplibs; do
-	    # Check to see that each library is installed.
-	    libdir=
-	    if test -f &quot;$lib&quot;; then
-	      # If there is no directory component, then add one.
-	      case $lib in
-	      */* | *\\*) . $lib ;;
-	      *) . ./$lib ;;
-	      esac
-	    fi
-	    libfile=&quot;$libdir/&quot;`$echo &quot;X$lib&quot; | $Xsed -e 's%^.*/%%g'` ### testsuite: skip nested quoting test
-	    if test -n &quot;$libdir&quot; &amp;&amp; test ! -f &quot;$libfile&quot;; then
-	      $echo &quot;$modename: warning: \`$lib' has not been installed in \`$libdir'&quot; 1&gt;&amp;2
-	      finalize=no
-	    fi
-	  done
+      if test -n &quot;$postlink_cmds&quot;; then
+	func_to_tool_file &quot;$output_objdir/$outputname&quot;
+	postlink_cmds=`func_echo_all &quot;$postlink_cmds&quot; | $SED -e 's%@OUTPUT@%'&quot;$output_objdir/$outputname&quot;'%g' -e 's%@TOOL_OUTPUT@%'&quot;$func_to_tool_file_result&quot;'%g'`
+	func_execute_cmds &quot;$postlink_cmds&quot; 'exit $?'
+      fi
 
-	  relink_command=
-	  # If there is no directory component, then add one.
-	  case $file in
-	  */* | *\\*) . $file ;;
-	  *) . ./$file ;;
-	  esac
+      # Now create the wrapper script.
+      func_verbose &quot;creating $output&quot;
 
-	  outputname=
-	  if test &quot;$fast_install&quot; = no &amp;&amp; test -n &quot;$relink_command&quot;; then
-	    if test &quot;$finalize&quot; = yes &amp;&amp; test -z &quot;$run&quot;; then
-	      tmpdir=&quot;/tmp&quot;
-	      test -n &quot;$TMPDIR&quot; &amp;&amp; tmpdir=&quot;$TMPDIR&quot;
-	      tmpdir=&quot;$tmpdir/libtool-$$&quot;
-	      if $mkdir -p &quot;$tmpdir&quot; &amp;&amp; chmod 700 &quot;$tmpdir&quot;; then :
-	      else
-		$echo &quot;$modename: error: cannot create temporary directory \`$tmpdir'&quot; 1&gt;&amp;2
-		continue
-	      fi
-	      file=`$echo &quot;X$file&quot; | $Xsed -e 's%^.*/%%'`
-	      outputname=&quot;$tmpdir/$file&quot;
-	      # Replace the output file specification.
-	      relink_command=`$echo &quot;X$relink_command&quot; | $Xsed -e 's%@OUTPUT@%'&quot;$outputname&quot;'%g'`
+      # Quote the relink command for shipping.
+      if test -n &quot;$relink_command&quot;; then
+	# Preserve any variables that may affect compiler behavior
+	for var in $variables_saved_for_relink; do
+	  if eval test -z \&quot;\${$var+set}\&quot;; then
+	    relink_command=&quot;{ test -z \&quot;\${$var+set}\&quot; || $lt_unset $var || { $var=; export $var; }; }; $relink_command&quot;
+	  elif eval var_value=\$$var; test -z &quot;$var_value&quot;; then
+	    relink_command=&quot;$var=; export $var; $relink_command&quot;
+	  else
+	    func_quote_for_eval &quot;$var_value&quot;
+	    relink_command=&quot;$var=$func_quote_for_eval_result; export $var; $relink_command&quot;
+	  fi
+	done
+	relink_command=&quot;(cd `pwd`; $relink_command)&quot;
+	relink_command=`$ECHO &quot;$relink_command&quot; | $SED &quot;$sed_quote_subst&quot;`
+      fi
 
-	      $show &quot;$relink_command&quot;
-	      if $run eval &quot;$relink_command&quot;; then :
+      # Only actually do things if not in dry run mode.
+      $opt_dry_run || {
+	# win32 will think the script is a binary if it has
+	# a .exe suffix, so we strip it off here.
+	case $output in
+	  *.exe) func_stripname '' '.exe' &quot;$output&quot;
+	         output=$func_stripname_result ;;
+	esac
+	# test for cygwin because mv fails w/o .exe extensions
+	case $host in
+	  *cygwin*)
+	    exeext=.exe
+	    func_stripname '' '.exe' &quot;$outputname&quot;
+	    outputname=$func_stripname_result ;;
+	  *) exeext= ;;
+	esac
+	case $host in
+	  *cygwin* | *mingw* )
+	    func_dirname_and_basename &quot;$output&quot; &quot;&quot; &quot;.&quot;
+	    output_name=$func_basename_result
+	    output_path=$func_dirname_result
+	    cwrappersource=&quot;$output_path/$objdir/lt-$output_name.c&quot;
+	    cwrapper=&quot;$output_path/$output_name.exe&quot;
+	    $RM $cwrappersource $cwrapper
+	    trap &quot;$RM $cwrappersource $cwrapper; exit $EXIT_FAILURE&quot; 1 2 15
+
+	    func_emit_cwrapperexe_src &gt; $cwrappersource
+
+	    # The wrapper executable is built using the $host compiler,
+	    # because it contains $host paths and files. If cross-
+	    # compiling, it, like the target executable, must be
+	    # executed on the $host or under an emulation environment.
+	    $opt_dry_run || {
+	      $LTCC $LTCFLAGS -o $cwrapper $cwrappersource
+	      $STRIP $cwrapper
+	    }
+
+	    # Now, create the wrapper script for func_source use:
+	    func_ltwrapper_scriptname $cwrapper
+	    $RM $func_ltwrapper_scriptname_result
+	    trap &quot;$RM $func_ltwrapper_scriptname_result; exit $EXIT_FAILURE&quot; 1 2 15
+	    $opt_dry_run || {
+	      # note: this script will not be executed, so do not chmod.
+	      if test &quot;x$build&quot; = &quot;x$host&quot; ; then
+		$cwrapper --lt-dump-script &gt; $func_ltwrapper_scriptname_result
 	      else
-		$echo &quot;$modename: error: relink \`$file' with the above command before installing it&quot; 1&gt;&amp;2
-		${rm}r &quot;$tmpdir&quot;
-		continue
+		func_emit_wrapper no &gt; $func_ltwrapper_scriptname_result
 	      fi
-	      file=&quot;$outputname&quot;
-	    else
-	      $echo &quot;$modename: warning: cannot relink \`$file'&quot; 1&gt;&amp;2
-	    fi
-	  else
-	    # Install the binary that we compiled earlier.
-	    file=`$echo &quot;X$file&quot; | $Xsed -e &quot;s%\([^/]*\)$%$objdir/\1%&quot;`
-	  fi
-	fi
+	    }
+	  ;;
+	  * )
+	    $RM $output
+	    trap &quot;$RM $output; exit $EXIT_FAILURE&quot; 1 2 15
 
-	# remove .exe since cygwin /usr/bin/install will append another
-	# one anyways
-	case $install_prog,$host in
-	/usr/bin/install*,*cygwin*)
-	  case $file:$destfile in
-	  *.exe:*.exe)
-	    # this is ok
-	    ;;
-	  *.exe:*)
-	    destfile=$destfile.exe
-	    ;;
-	  *:*.exe)
-	    destfile=`echo $destfile | sed -e 's,.exe$,,'`
-	    ;;
-	  esac
+	    func_emit_wrapper no &gt; $output
+	    chmod +x $output
 	  ;;
 	esac
-	$show &quot;$install_prog$stripme $file $destfile&quot;
-	$run eval &quot;$install_prog\$stripme \$file \$destfile&quot; || exit $?
-	test -n &quot;$outputname&quot; &amp;&amp; ${rm}r &quot;$tmpdir&quot;
-	;;
-      esac
-    done
-
-    for file in $staticlibs; do
-      name=`$echo &quot;X$file&quot; | $Xsed -e 's%^.*/%%'`
-
-      # Set up the ranlib parameters.
-      oldlib=&quot;$destdir/$name&quot;
+      }
+      exit $EXIT_SUCCESS
+      ;;
+    esac
 
-      $show &quot;$install_prog $file $oldlib&quot;
-      $run eval &quot;$install_prog \$file \$oldlib&quot; || exit $?
+    # See if we need to build an old-fashioned archive.
+    for oldlib in $oldlibs; do
 
-      if test -n &quot;$stripme&quot; &amp;&amp; test -n &quot;$striplib&quot;; then
-	$show &quot;$old_striplib $oldlib&quot;
-	$run eval &quot;$old_striplib $oldlib&quot; || exit $?
+      if test &quot;$build_libtool_libs&quot; = convenience; then
+	oldobjs=&quot;$libobjs_save $symfileobj&quot;
+	addlibs=&quot;$convenience&quot;
+	build_libtool_libs=no
+      else
+	if test &quot;$build_libtool_libs&quot; = module; then
+	  oldobjs=&quot;$libobjs_save&quot;
+	  build_libtool_libs=no
+	else
+	  oldobjs=&quot;$old_deplibs $non_pic_objects&quot;
+	  if test &quot;$preload&quot; = yes &amp;&amp; test -f &quot;$symfileobj&quot;; then
+	    func_append oldobjs &quot; $symfileobj&quot;
+	  fi
+	fi
+	addlibs=&quot;$old_convenience&quot;
       fi
 
-      # Do each command in the postinstall commands.
-      eval cmds=\&quot;$old_postinstall_cmds\&quot;
-      save_ifs=&quot;$IFS&quot;; IFS='~'
-      for cmd in $cmds; do
-	IFS=&quot;$save_ifs&quot;
-	$show &quot;$cmd&quot;
-	$run eval &quot;$cmd&quot; || exit $?
-      done
-      IFS=&quot;$save_ifs&quot;
-    done
+      if test -n &quot;$addlibs&quot;; then
+	gentop=&quot;$output_objdir/${outputname}x&quot;
+	func_append generated &quot; $gentop&quot;
 
-    if test -n &quot;$future_libdirs&quot;; then
-      $echo &quot;$modename: warning: remember to run \`$progname --finish$future_libdirs'&quot; 1&gt;&amp;2
-    fi
+	func_extract_archives $gentop $addlibs
+	func_append oldobjs &quot; $func_extract_archives_result&quot;
+      fi
 
-    if test -n &quot;$current_libdirs&quot;; then
-      # Maybe just do a dry run.
-      test -n &quot;$run&quot; &amp;&amp; current_libdirs=&quot; -n$current_libdirs&quot;
-      exec_cmd='$SHELL $0 --finish$current_libdirs'
-    else
-      exit 0
-    fi
-    ;;
+      # Do each command in the archive commands.
+      if test -n &quot;$old_archive_from_new_cmds&quot; &amp;&amp; test &quot;$build_libtool_libs&quot; = yes; then
+	cmds=$old_archive_from_new_cmds
+      else
 
-  # libtool finish mode
-  finish)
-    modename=&quot;$modename: finish&quot;
-    libdirs=&quot;$nonopt&quot;
-    admincmds=
+	# Add any objects from preloaded convenience libraries
+	if test -n &quot;$dlprefiles&quot;; then
+	  gentop=&quot;$output_objdir/${outputname}x&quot;
+	  func_append generated &quot; $gentop&quot;
 
-    if test -n &quot;$finish_cmds$finish_eval&quot; &amp;&amp; test -n &quot;$libdirs&quot;; then
-      for dir
-      do
-	libdirs=&quot;$libdirs $dir&quot;
-      done
+	  func_extract_archives $gentop $dlprefiles
+	  func_append oldobjs &quot; $func_extract_archives_result&quot;
+	fi
 
-      for libdir in $libdirs; do
-	if test -n &quot;$finish_cmds&quot;; then
-	  # Do each command in the finish commands.
-	  eval cmds=\&quot;$finish_cmds\&quot;
-	  save_ifs=&quot;$IFS&quot;; IFS='~'
-	  for cmd in $cmds; do
-	    IFS=&quot;$save_ifs&quot;
-	    $show &quot;$cmd&quot;
-	    $run eval &quot;$cmd&quot; || admincmds=&quot;$admincmds
-       $cmd&quot;
+	# POSIX demands no paths to be encoded in archives.  We have
+	# to avoid creating archives with duplicate basenames if we
+	# might have to extract them afterwards, e.g., when creating a
+	# static archive out of a convenience library, or when linking
+	# the entirety of a libtool archive into another (currently
+	# not supported by libtool).
+	if (for obj in $oldobjs
+	    do
+	      func_basename &quot;$obj&quot;
+	      $ECHO &quot;$func_basename_result&quot;
+	    done | sort | sort -uc &gt;/dev/null 2&gt;&amp;1); then
+	  :
+	else
+	  echo &quot;copying selected object files to avoid basename conflicts...&quot;
+	  gentop=&quot;$output_objdir/${outputname}x&quot;
+	  func_append generated &quot; $gentop&quot;
+	  func_mkdir_p &quot;$gentop&quot;
+	  save_oldobjs=$oldobjs
+	  oldobjs=
+	  counter=1
+	  for obj in $save_oldobjs
+	  do
+	    func_basename &quot;$obj&quot;
+	    objbase=&quot;$func_basename_result&quot;
+	    case &quot; $oldobjs &quot; in
+	    &quot; &quot;) oldobjs=$obj ;;
+	    *[\ /]&quot;$objbase &quot;*)
+	      while :; do
+		# Make sure we don't pick an alternate name that also
+		# overlaps.
+		newobj=lt$counter-$objbase
+		func_arith $counter + 1
+		counter=$func_arith_result
+		case &quot; $oldobjs &quot; in
+		*[\ /]&quot;$newobj &quot;*) ;;
+		*) if test ! -f &quot;$gentop/$newobj&quot;; then break; fi ;;
+		esac
+	      done
+	      func_show_eval &quot;ln $obj $gentop/$newobj || cp $obj $gentop/$newobj&quot;
+	      func_append oldobjs &quot; $gentop/$newobj&quot;
+	      ;;
+	    *) func_append oldobjs &quot; $obj&quot; ;;
+	    esac
 	  done
-	  IFS=&quot;$save_ifs&quot;
-	fi
-	if test -n &quot;$finish_eval&quot;; then
-	  # Do the single finish_eval.
-	  eval cmds=\&quot;$finish_eval\&quot;
-	  $run eval &quot;$cmds&quot; || admincmds=&quot;$admincmds
-       $cmds&quot;
 	fi
-      done
-    fi
-
-    # Exit here if they wanted silent mode.
-    test &quot;$show&quot; = &quot;:&quot; &amp;&amp; exit 0
+	eval cmds=\&quot;$old_archive_cmds\&quot;
 
-    echo &quot;----------------------------------------------------------------------&quot;
-    echo &quot;Libraries have been installed in:&quot;
-    for libdir in $libdirs; do
-      echo &quot;   $libdir&quot;
+	func_len &quot; $cmds&quot;
+	len=$func_len_result
+	if test &quot;$len&quot; -lt &quot;$max_cmd_len&quot; || test &quot;$max_cmd_len&quot; -le -1; then
+	  cmds=$old_archive_cmds
+	elif test -n &quot;$archiver_list_spec&quot;; then
+	  func_verbose &quot;using command file archive linking...&quot;
+	  for obj in $oldobjs
+	  do
+	    func_to_tool_file &quot;$obj&quot;
+	    $ECHO &quot;$func_to_tool_file_result&quot;
+	  done &gt; $output_objdir/$libname.libcmd
+	  func_to_tool_file &quot;$output_objdir/$libname.libcmd&quot;
+	  oldobjs=&quot; $archiver_list_spec$func_to_tool_file_result&quot;
+	  cmds=$old_archive_cmds
+	else
+	  # the command line is too long to link in one step, link in parts
+	  func_verbose &quot;using piecewise archive linking...&quot;
+	  save_RANLIB=$RANLIB
+	  RANLIB=:
+	  objlist=
+	  concat_cmds=
+	  save_oldobjs=$oldobjs
+	  oldobjs=
+	  # Is there a better way of finding the last object in the list?
+	  for obj in $save_oldobjs
+	  do
+	    last_oldobj=$obj
+	  done
+	  eval test_cmds=\&quot;$old_archive_cmds\&quot;
+	  func_len &quot; $test_cmds&quot;
+	  len0=$func_len_result
+	  len=$len0
+	  for obj in $save_oldobjs
+	  do
+	    func_len &quot; $obj&quot;
+	    func_arith $len + $func_len_result
+	    len=$func_arith_result
+	    func_append objlist &quot; $obj&quot;
+	    if test &quot;$len&quot; -lt &quot;$max_cmd_len&quot;; then
+	      :
+	    else
+	      # the above command should be used before it gets too long
+	      oldobjs=$objlist
+	      if test &quot;$obj&quot; = &quot;$last_oldobj&quot; ; then
+		RANLIB=$save_RANLIB
+	      fi
+	      test -z &quot;$concat_cmds&quot; || concat_cmds=$concat_cmds~
+	      eval concat_cmds=\&quot;\${concat_cmds}$old_archive_cmds\&quot;
+	      objlist=
+	      len=$len0
+	    fi
+	  done
+	  RANLIB=$save_RANLIB
+	  oldobjs=$objlist
+	  if test &quot;X$oldobjs&quot; = &quot;X&quot; ; then
+	    eval cmds=\&quot;\$concat_cmds\&quot;
+	  else
+	    eval cmds=\&quot;\$concat_cmds~\$old_archive_cmds\&quot;
+	  fi
+	fi
+      fi
+      func_execute_cmds &quot;$cmds&quot; 'exit $?'
     done
-    echo
-    echo &quot;If you ever happen to want to link against installed libraries&quot;
-    echo &quot;in a given directory, LIBDIR, you must either use libtool, and&quot;
-    echo &quot;specify the full pathname of the library, or use the \`-LLIBDIR'&quot;
-    echo &quot;flag during linking and do at least one of the following:&quot;
-    if test -n &quot;$shlibpath_var&quot;; then
-      echo &quot;   - add LIBDIR to the \`$shlibpath_var' environment variable&quot;
-      echo &quot;     during execution&quot;
-    fi
-    if test -n &quot;$runpath_var&quot;; then
-      echo &quot;   - add LIBDIR to the \`$runpath_var' environment variable&quot;
-      echo &quot;     during linking&quot;
-    fi
-    if test -n &quot;$hardcode_libdir_flag_spec&quot;; then
-      libdir=LIBDIR
-      eval flag=\&quot;$hardcode_libdir_flag_spec\&quot;
-
-      echo &quot;   - use the \`$flag' linker flag&quot;
-    fi
-    if test -n &quot;$admincmds&quot;; then
-      echo &quot;   - have your system administrator run these commands:$admincmds&quot;
-    fi
-    if test -f /etc/ld.so.conf; then
-      echo &quot;   - have your system administrator add LIBDIR to \`/etc/ld.so.conf'&quot;
-    fi
-    echo
-    echo &quot;See any operating system documentation about shared libraries for&quot;
-    echo &quot;more information, such as the ld(1) and ld.so(8) manual pages.&quot;
-    echo &quot;----------------------------------------------------------------------&quot;
-    exit 0
-    ;;
-
-  # libtool execute mode
-  execute)
-    modename=&quot;$modename: execute&quot;
 
-    # The first argument is the command name.
-    cmd=&quot;$nonopt&quot;
-    if test -z &quot;$cmd&quot;; then
-      $echo &quot;$modename: you must specify a COMMAND&quot; 1&gt;&amp;2
-      $echo &quot;$help&quot;
-      exit 1
-    fi
+    test -n &quot;$generated&quot; &amp;&amp; \
+      func_show_eval &quot;${RM}r$generated&quot;
 
-    # Handle -dlopen flags immediately.
-    for file in $execute_dlfiles; do
-      if test ! -f &quot;$file&quot;; then
-	$echo &quot;$modename: \`$file' is not a file&quot; 1&gt;&amp;2
-	$echo &quot;$help&quot; 1&gt;&amp;2
-	exit 1
-      fi
+    # Now create the libtool archive.
+    case $output in
+    *.la)
+      old_library=
+      test &quot;$build_old_libs&quot; = yes &amp;&amp; old_library=&quot;$libname.$libext&quot;
+      func_verbose &quot;creating $output&quot;
 
-      dir=
-      case $file in
-      *.la)
-	# Check to see that this really is a libtool archive.
-	if (sed -e '2q' $file | egrep &quot;^# Generated by .*$PACKAGE&quot;) &gt;/dev/null 2&gt;&amp;1; then :
+      # Preserve any variables that may affect compiler behavior
+      for var in $variables_saved_for_relink; do
+	if eval test -z \&quot;\${$var+set}\&quot;; then
+	  relink_command=&quot;{ test -z \&quot;\${$var+set}\&quot; || $lt_unset $var || { $var=; export $var; }; }; $relink_command&quot;
+	elif eval var_value=\$$var; test -z &quot;$var_value&quot;; then
+	  relink_command=&quot;$var=; export $var; $relink_command&quot;
 	else
-	  $echo &quot;$modename: \`$lib' is not a valid libtool archive&quot; 1&gt;&amp;2
-	  $echo &quot;$help&quot; 1&gt;&amp;2
-	  exit 1
+	  func_quote_for_eval &quot;$var_value&quot;
+	  relink_command=&quot;$var=$func_quote_for_eval_result; export $var; $relink_command&quot;
 	fi
+      done
+      # Quote the link command for shipping.
+      relink_command=&quot;(cd `pwd`; $SHELL $progpath $preserve_args --mode=relink $libtool_args @inst_prefix_dir@)&quot;
+      relink_command=`$ECHO &quot;$relink_command&quot; | $SED &quot;$sed_quote_subst&quot;`
+      if test &quot;$hardcode_automatic&quot; = yes ; then
+	relink_command=
+      fi
 
-	# Read the libtool library.
-	dlname=
-	library_names=
+      # Only create the output if not a dry run.
+      $opt_dry_run || {
+	for installed in no yes; do
+	  if test &quot;$installed&quot; = yes; then
+	    if test -z &quot;$install_libdir&quot;; then
+	      break
+	    fi
+	    output=&quot;$output_objdir/$outputname&quot;i
+	    # Replace all uninstalled libtool libraries with the installed ones
+	    newdependency_libs=
+	    for deplib in $dependency_libs; do
+	      case $deplib in
+	      *.la)
+		func_basename &quot;$deplib&quot;
+		name=&quot;$func_basename_result&quot;
+		eval libdir=`${SED} -n -e 's/^libdir=\(.*\)$/\1/p' $deplib`
+		test -z &quot;$libdir&quot; &amp;&amp; \
+		  func_fatal_error &quot;\`$deplib' is not a valid libtool archive&quot;
+		func_append newdependency_libs &quot; ${lt_sysroot:+=}$libdir/$name&quot;
+		;;
+	      -L*)
+		func_stripname -L '' &quot;$deplib&quot;
+		func_replace_sysroot &quot;$func_stripname_result&quot;
+		func_append newdependency_libs &quot; -L$func_replace_sysroot_result&quot;
+		;;
+	      -R*)
+		func_stripname -R '' &quot;$deplib&quot;
+		func_replace_sysroot &quot;$func_stripname_result&quot;
+		func_append newdependency_libs &quot; -R$func_replace_sysroot_result&quot;
+		;;
+	      *) func_append newdependency_libs &quot; $deplib&quot; ;;
+	      esac
+	    done
+	    dependency_libs=&quot;$newdependency_libs&quot;
+	    newdlfiles=
+
+	    for lib in $dlfiles; do
+	      case $lib in
+	      *.la)
+	        func_basename &quot;$lib&quot;
+		name=&quot;$func_basename_result&quot;
+		eval libdir=`${SED} -n -e 's/^libdir=\(.*\)$/\1/p' $lib`
+		test -z &quot;$libdir&quot; &amp;&amp; \
+		  func_fatal_error &quot;\`$lib' is not a valid libtool archive&quot;
+		func_append newdlfiles &quot; ${lt_sysroot:+=}$libdir/$name&quot;
+		;;
+	      *) func_append newdlfiles &quot; $lib&quot; ;;
+	      esac
+	    done
+	    dlfiles=&quot;$newdlfiles&quot;
+	    newdlprefiles=
+	    for lib in $dlprefiles; do
+	      case $lib in
+	      *.la)
+		# Only pass preopened files to the pseudo-archive (for
+		# eventual linking with the app. that links it) if we
+		# didn't already link the preopened objects directly into
+		# the library:
+		func_basename &quot;$lib&quot;
+		name=&quot;$func_basename_result&quot;
+		eval libdir=`${SED} -n -e 's/^libdir=\(.*\)$/\1/p' $lib`
+		test -z &quot;$libdir&quot; &amp;&amp; \
+		  func_fatal_error &quot;\`$lib' is not a valid libtool archive&quot;
+		func_append newdlprefiles &quot; ${lt_sysroot:+=}$libdir/$name&quot;
+		;;
+	      esac
+	    done
+	    dlprefiles=&quot;$newdlprefiles&quot;
+	  else
+	    newdlfiles=
+	    for lib in $dlfiles; do
+	      case $lib in
+		[\\/]* | [A-Za-z]:[\\/]*) abs=&quot;$lib&quot; ;;
+		*) abs=`pwd`&quot;/$lib&quot; ;;
+	      esac
+	      func_append newdlfiles &quot; $abs&quot;
+	    done
+	    dlfiles=&quot;$newdlfiles&quot;
+	    newdlprefiles=
+	    for lib in $dlprefiles; do
+	      case $lib in
+		[\\/]* | [A-Za-z]:[\\/]*) abs=&quot;$lib&quot; ;;
+		*) abs=`pwd`&quot;/$lib&quot; ;;
+	      esac
+	      func_append newdlprefiles &quot; $abs&quot;
+	    done
+	    dlprefiles=&quot;$newdlprefiles&quot;
+	  fi
+	  $RM $output
+	  # place dlname in correct position for cygwin
+	  # In fact, it would be nice if we could use this code for all target
+	  # systems that can't hard-code library paths into their executables
+	  # and that have no shared library path variable independent of PATH,
+	  # but it turns out we can't easily determine that from inspecting
+	  # libtool variables, so we have to hard-code the OSs to which it
+	  # applies here; at the moment, that means platforms that use the PE
+	  # object format with DLL files.  See the long comment at the top of
+	  # tests/bindir.at for full details.
+	  tdlname=$dlname
+	  case $host,$output,$installed,$module,$dlname in
+	    *cygwin*,*lai,yes,no,*.dll | *mingw*,*lai,yes,no,*.dll | *cegcc*,*lai,yes,no,*.dll)
+	      # If a -bindir argument was supplied, place the dll there.
+	      if test &quot;x$bindir&quot; != x ;
+	      then
+		func_relative_path &quot;$install_libdir&quot; &quot;$bindir&quot;
+		tdlname=$func_relative_path_result$dlname
+	      else
+		# Otherwise fall back on heuristic.
+		tdlname=../bin/$dlname
+	      fi
+	      ;;
+	  esac
+	  $ECHO &gt; $output &quot;\
+# $outputname - a libtool library file
+# Generated by $PROGRAM (GNU $PACKAGE$TIMESTAMP) $VERSION
+#
+# Please DO NOT delete this file!
+# It is necessary for linking the library.
 
-	# If there is no directory component, then add one.
-	case $file in
-	*/* | *\\*) . $file ;;
-	*) . ./$file ;;
-	esac
+# The name that we can dlopen(3).
+dlname='$tdlname'
 
-	# Skip this library if it cannot be dlopened.
-	if test -z &quot;$dlname&quot;; then
-	  # Warn if it was a shared library.
-	  test -n &quot;$library_names&quot; &amp;&amp; $echo &quot;$modename: warning: \`$file' was not linked with \`-export-dynamic'&quot;
-	  continue
-	fi
+# Names of this library.
+library_names='$library_names'
 
-	dir=`$echo &quot;X$file&quot; | $Xsed -e 's%/[^/]*$%%'`
-	test &quot;X$dir&quot; = &quot;X$file&quot; &amp;&amp; dir=.
+# The name of the static archive.
+old_library='$old_library'
 
-	if test -f &quot;$dir/$objdir/$dlname&quot;; then
-	  dir=&quot;$dir/$objdir&quot;
-	else
-	  $echo &quot;$modename: cannot find \`$dlname' in \`$dir' or \`$dir/$objdir'&quot; 1&gt;&amp;2
-	  exit 1
-	fi
-	;;
+# Linker flags that can not go in dependency_libs.
+inherited_linker_flags='$new_inherited_linker_flags'
 
-      *.lo)
-	# Just add the directory containing the .lo file.
-	dir=`$echo &quot;X$file&quot; | $Xsed -e 's%/[^/]*$%%'`
-	test &quot;X$dir&quot; = &quot;X$file&quot; &amp;&amp; dir=.
-	;;
+# Libraries that this one depends upon.
+dependency_libs='$dependency_libs'
 
-      *)
-	$echo &quot;$modename: warning \`-dlopen' is ignored for non-libtool libraries and objects&quot; 1&gt;&amp;2
-	continue
-	;;
-      esac
+# Names of additional weak libraries provided by this library
+weak_library_names='$weak_libs'
 
-      # Get the absolute pathname.
-      absdir=`cd &quot;$dir&quot; &amp;&amp; pwd`
-      test -n &quot;$absdir&quot; &amp;&amp; dir=&quot;$absdir&quot;
+# Version information for $libname.
+current=$current
+age=$age
+revision=$revision
 
-      # Now add the directory to shlibpath_var.
-      if eval &quot;test -z \&quot;\$$shlibpath_var\&quot;&quot;; then
-	eval &quot;$shlibpath_var=\&quot;\$dir\&quot;&quot;
-      else
-	eval &quot;$shlibpath_var=\&quot;\$dir:\$$shlibpath_var\&quot;&quot;
-      fi
-    done
+# Is this an already installed library?
+installed=$installed
 
-    # This variable tells wrapper scripts just to set shlibpath_var
-    # rather than running their programs.
-    libtool_execute_magic=&quot;$magic&quot;
+# Should we warn about portability when linking against -modules?
+shouldnotlink=$module
 
-    # Check if any of the arguments is a wrapper script.
-    args=
-    for file
-    do
-      case $file in
-      -*) ;;
-      *)
-	# Do a test to see if this is really a libtool program.
-	if (sed -e '4q' $file | egrep &quot;^# Generated by .*$PACKAGE&quot;) &gt;/dev/null 2&gt;&amp;1; then
-	  # If there is no directory component, then add one.
-	  case $file in
-	  */* | *\\*) . $file ;;
-	  *) . ./$file ;;
-	  esac
+# Files to dlopen/dlpreopen
+dlopen='$dlfiles'
+dlpreopen='$dlprefiles'
 
-	  # Transform arg to wrapped name.
-	  file=&quot;$progdir/$program&quot;
-	fi
-	;;
-      esac
-      # Quote arguments (to preserve shell metacharacters).
-      file=`$echo &quot;X$file&quot; | $Xsed -e &quot;$sed_quote_subst&quot;`
-      args=&quot;$args \&quot;$file\&quot;&quot;
-    done
+# Directory that this library needs to be installed in:
+libdir='$install_libdir'&quot;
+	  if test &quot;$installed&quot; = no &amp;&amp; test &quot;$need_relink&quot; = yes; then
+	    $ECHO &gt;&gt; $output &quot;\
+relink_command=\&quot;$relink_command\&quot;&quot;
+	  fi
+	done
+      }
 
-    if test -z &quot;$run&quot;; then
-      if test -n &quot;$shlibpath_var&quot;; then
-	# Export the shlibpath_var.
-	eval &quot;export $shlibpath_var&quot;
-      fi
+      # Do a symbolic link so that the libtool archive can be found in
+      # LD_LIBRARY_PATH before the program is installed.
+      func_show_eval '( cd &quot;$output_objdir&quot; &amp;&amp; $RM &quot;$outputname&quot; &amp;&amp; $LN_S &quot;../$outputname&quot; &quot;$outputname&quot; )' 'exit $?'
+      ;;
+    esac
+    exit $EXIT_SUCCESS
+}
 
-      # Restore saved enviroment variables
-      if test &quot;${save_LC_ALL+set}&quot; = set; then
-	LC_ALL=&quot;$save_LC_ALL&quot;; export LC_ALL
-      fi
-      if test &quot;${save_LANG+set}&quot; = set; then
-	LANG=&quot;$save_LANG&quot;; export LANG
-      fi
+{ test &quot;$opt_mode&quot; = link || test &quot;$opt_mode&quot; = relink; } &amp;&amp;
+    func_mode_link ${1+&quot;$@&quot;}
 
-      # Now prepare to actually exec the command.
-      exec_cmd='&quot;$cmd&quot;$args'
-    else
-      # Display what would be done.
-      if test -n &quot;$shlibpath_var&quot;; then
-	eval &quot;\$echo \&quot;\$shlibpath_var=\$$shlibpath_var\&quot;&quot;
-	$echo &quot;export $shlibpath_var&quot;
-      fi
-      $echo &quot;$cmd$args&quot;
-      exit 0
-    fi
-    ;;
 
-  # libtool clean and uninstall mode
-  clean | uninstall)
-    modename=&quot;$modename: $mode&quot;
-    rm=&quot;$nonopt&quot;
+# func_mode_uninstall arg...
+func_mode_uninstall ()
+{
+    $opt_debug
+    RM=&quot;$nonopt&quot;
     files=
     rmforce=
     exit_status=0
@@ -4637,43 +9441,41 @@ relink_command=\&quot;$relink_command\&quot;&quot;
     for arg
     do
       case $arg in
-      -f) rm=&quot;$rm $arg&quot;; rmforce=yes ;;
-      -*) rm=&quot;$rm $arg&quot; ;;
-      *) files=&quot;$files $arg&quot; ;;
+      -f) func_append RM &quot; $arg&quot;; rmforce=yes ;;
+      -*) func_append RM &quot; $arg&quot; ;;
+      *) func_append files &quot; $arg&quot; ;;
       esac
     done
 
-    if test -z &quot;$rm&quot;; then
-      $echo &quot;$modename: you must specify an RM program&quot; 1&gt;&amp;2
-      $echo &quot;$help&quot; 1&gt;&amp;2
-      exit 1
-    fi
+    test -z &quot;$RM&quot; &amp;&amp; \
+      func_fatal_help &quot;you must specify an RM program&quot;
 
     rmdirs=
 
     for file in $files; do
-      dir=`$echo &quot;X$file&quot; | $Xsed -e 's%/[^/]*$%%'`
-      if test &quot;X$dir&quot; = &quot;X$file&quot;; then
-	dir=.
-	objdir=&quot;$objdir&quot;
+      func_dirname &quot;$file&quot; &quot;&quot; &quot;.&quot;
+      dir=&quot;$func_dirname_result&quot;
+      if test &quot;X$dir&quot; = X.; then
+	odir=&quot;$objdir&quot;
       else
-	objdir=&quot;$dir/$objdir&quot;
+	odir=&quot;$dir/$objdir&quot;
       fi
-      name=`$echo &quot;X$file&quot; | $Xsed -e 's%^.*/%%'`
-      test $mode = uninstall &amp;&amp; objdir=&quot;$dir&quot;
+      func_basename &quot;$file&quot;
+      name=&quot;$func_basename_result&quot;
+      test &quot;$opt_mode&quot; = uninstall &amp;&amp; odir=&quot;$dir&quot;
 
-      # Remember objdir for removal later, being careful to avoid duplicates
-      if test $mode = clean; then
+      # Remember odir for removal later, being careful to avoid duplicates
+      if test &quot;$opt_mode&quot; = clean; then
 	case &quot; $rmdirs &quot; in
-	  *&quot; $objdir &quot;*) ;;
-	  *) rmdirs=&quot;$rmdirs $objdir&quot; ;;
+	  *&quot; $odir &quot;*) ;;
+	  *) func_append rmdirs &quot; $odir&quot; ;;
 	esac
       fi
 
       # Don't error if the file doesn't exist and rm -f was used.
-      if (test -L &quot;$file&quot;) &gt;/dev/null 2&gt;&amp;1 \
-	|| (test -h &quot;$file&quot;) &gt;/dev/null 2&gt;&amp;1 \
-	|| test -f &quot;$file&quot;; then
+      if { test -L &quot;$file&quot;; } &gt;/dev/null 2&gt;&amp;1 ||
+	 { test -h &quot;$file&quot;; } &gt;/dev/null 2&gt;&amp;1 ||
+	 test -f &quot;$file&quot;; then
 	:
       elif test -d &quot;$file&quot;; then
 	exit_status=1
@@ -4687,298 +9489,154 @@ relink_command=\&quot;$relink_command\&quot;&quot;
       case $name in
       *.la)
 	# Possibly a libtool archive, so verify it.
-	if (sed -e '2q' $file | egrep &quot;^# Generated by .*$PACKAGE&quot;) &gt;/dev/null 2&gt;&amp;1; then
-	  . $dir/$name
+	if func_lalib_p &quot;$file&quot;; then
+	  func_source $dir/$name
 
 	  # Delete the libtool libraries and symlinks.
 	  for n in $library_names; do
-	    rmfiles=&quot;$rmfiles $objdir/$n&quot;
+	    func_append rmfiles &quot; $odir/$n&quot;
 	  done
-	  test -n &quot;$old_library&quot; &amp;&amp; rmfiles=&quot;$rmfiles $objdir/$old_library&quot;
-	  test $mode = clean &amp;&amp; rmfiles=&quot;$rmfiles $objdir/$name $objdir/${name}i&quot;
+	  test -n &quot;$old_library&quot; &amp;&amp; func_append rmfiles &quot; $odir/$old_library&quot;
 
-	  if test $mode = uninstall; then
+	  case &quot;$opt_mode&quot; in
+	  clean)
+	    case &quot; $library_names &quot; in
+	    *&quot; $dlname &quot;*) ;;
+	    *) test -n &quot;$dlname&quot; &amp;&amp; func_append rmfiles &quot; $odir/$dlname&quot; ;;
+	    esac
+	    test -n &quot;$libdir&quot; &amp;&amp; func_append rmfiles &quot; $odir/$name $odir/${name}i&quot;
+	    ;;
+	  uninstall)
 	    if test -n &quot;$library_names&quot;; then
 	      # Do each command in the postuninstall commands.
-	      eval cmds=\&quot;$postuninstall_cmds\&quot;
-	      save_ifs=&quot;$IFS&quot;; IFS='~'
-	      for cmd in $cmds; do
-		IFS=&quot;$save_ifs&quot;
-		$show &quot;$cmd&quot;
-		$run eval &quot;$cmd&quot;
-		if test $? != 0 &amp;&amp; test &quot;$rmforce&quot; != yes; then
-		  exit_status=1
-		fi
-	      done
-	      IFS=&quot;$save_ifs&quot;
+	      func_execute_cmds &quot;$postuninstall_cmds&quot; 'test &quot;$rmforce&quot; = yes || exit_status=1'
 	    fi
 
 	    if test -n &quot;$old_library&quot;; then
 	      # Do each command in the old_postuninstall commands.
-	      eval cmds=\&quot;$old_postuninstall_cmds\&quot;
-	      save_ifs=&quot;$IFS&quot;; IFS='~'
-	      for cmd in $cmds; do
-		IFS=&quot;$save_ifs&quot;
-		$show &quot;$cmd&quot;
-		$run eval &quot;$cmd&quot;
-		if test $? != 0 &amp;&amp; test &quot;$rmforce&quot; != yes; then
-		  exit_status=1
-		fi
-	      done
-	      IFS=&quot;$save_ifs&quot;
+	      func_execute_cmds &quot;$old_postuninstall_cmds&quot; 'test &quot;$rmforce&quot; = yes || exit_status=1'
 	    fi
 	    # FIXME: should reinstall the best remaining shared library.
-	  fi
+	    ;;
+	  esac
 	fi
 	;;
 
       *.lo)
-	if test &quot;$build_old_libs&quot; = yes; then
-	  oldobj=`$echo &quot;X$name&quot; | $Xsed -e &quot;$lo2o&quot;`
-	  rmfiles=&quot;$rmfiles $dir/$oldobj&quot;
+	# Possibly a libtool object, so verify it.
+	if func_lalib_p &quot;$file&quot;; then
+
+	  # Read the .lo file
+	  func_source $dir/$name
+
+	  # Add PIC object to the list of files to remove.
+	  if test -n &quot;$pic_object&quot; &amp;&amp;
+	     test &quot;$pic_object&quot; != none; then
+	    func_append rmfiles &quot; $dir/$pic_object&quot;
+	  fi
+
+	  # Add non-PIC object to the list of files to remove.
+	  if test -n &quot;$non_pic_object&quot; &amp;&amp;
+	     test &quot;$non_pic_object&quot; != none; then
+	    func_append rmfiles &quot; $dir/$non_pic_object&quot;
+	  fi
 	fi
 	;;
 
       *)
-	# Do a test to see if this is a libtool program.
-	if test $mode = clean &amp;&amp;
-	   (sed -e '4q' $file | egrep &quot;^# Generated by .*$PACKAGE&quot;) &gt;/dev/null 2&gt;&amp;1; then
-	  relink_command=
-	  . $dir/$file
+	if test &quot;$opt_mode&quot; = clean ; then
+	  noexename=$name
+	  case $file in
+	  *.exe)
+	    func_stripname '' '.exe' &quot;$file&quot;
+	    file=$func_stripname_result
+	    func_stripname '' '.exe' &quot;$name&quot;
+	    noexename=$func_stripname_result
+	    # $file with .exe has already been added to rmfiles,
+	    # add $file without .exe
+	    func_append rmfiles &quot; $file&quot;
+	    ;;
+	  esac
+	  # Do a test to see if this is a libtool program.
+	  if func_ltwrapper_p &quot;$file&quot;; then
+	    if func_ltwrapper_executable_p &quot;$file&quot;; then
+	      func_ltwrapper_scriptname &quot;$file&quot;
+	      relink_command=
+	      func_source $func_ltwrapper_scriptname_result
+	      func_append rmfiles &quot; $func_ltwrapper_scriptname_result&quot;
+	    else
+	      relink_command=
+	      func_source $dir/$noexename
+	    fi
 
-	  rmfiles=&quot;$rmfiles $objdir/$name $objdir/${name}S.${objext}&quot;
-	  if test &quot;$fast_install&quot; = yes &amp;&amp; test -n &quot;$relink_command&quot;; then
-	    rmfiles=&quot;$rmfiles $objdir/lt-$name&quot;
+	    # note $name still contains .exe if it was in $file originally
+	    # as does the version of $file that was added into $rmfiles
+	    func_append rmfiles &quot; $odir/$name $odir/${name}S.${objext}&quot;
+	    if test &quot;$fast_install&quot; = yes &amp;&amp; test -n &quot;$relink_command&quot;; then
+	      func_append rmfiles &quot; $odir/lt-$name&quot;
+	    fi
+	    if test &quot;X$noexename&quot; != &quot;X$name&quot; ; then
+	      func_append rmfiles &quot; $odir/lt-${noexename}.c&quot;
+	    fi
 	  fi
 	fi
 	;;
       esac
-      $show &quot;$rm $rmfiles&quot;
-      $run $rm $rmfiles || exit_status=1
+      func_show_eval &quot;$RM $rmfiles&quot; 'exit_status=1'
     done
 
     # Try to remove the ${objdir}s in the directories where we deleted files
     for dir in $rmdirs; do
       if test -d &quot;$dir&quot;; then
-	$show &quot;rmdir $dir&quot;
-	$run rmdir $dir &gt;/dev/null 2&gt;&amp;1
+	func_show_eval &quot;rmdir $dir &gt;/dev/null 2&gt;&amp;1&quot;
       fi
     done
 
     exit $exit_status
-    ;;
+}
 
-  &quot;&quot;)
-    $echo &quot;$modename: you must specify a MODE&quot; 1&gt;&amp;2
-    $echo &quot;$generic_help&quot; 1&gt;&amp;2
-    exit 1
-    ;;
-  esac
+{ test &quot;$opt_mode&quot; = uninstall || test &quot;$opt_mode&quot; = clean; } &amp;&amp;
+    func_mode_uninstall ${1+&quot;$@&quot;}
 
-  if test -z &quot;$exec_cmd&quot;; then
-    $echo &quot;$modename: invalid operation mode \`$mode'&quot; 1&gt;&amp;2
-    $echo &quot;$generic_help&quot; 1&gt;&amp;2
-    exit 1
-  fi
-fi # test -z &quot;$show_help&quot;
+test -z &quot;$opt_mode&quot; &amp;&amp; {
+  help=&quot;$generic_help&quot;
+  func_fatal_help &quot;you must specify a MODE&quot;
+}
+
+test -z &quot;$exec_cmd&quot; &amp;&amp; \
+  func_fatal_help &quot;invalid operation mode \`$opt_mode'&quot;
 
 if test -n &quot;$exec_cmd&quot;; then
-  eval exec $exec_cmd
-  exit 1
+  eval exec &quot;$exec_cmd&quot;
+  exit $EXIT_FAILURE
 fi
 
-# We need to display help for each of the modes.
-case $mode in
-&quot;&quot;) $echo \
-&quot;Usage: $modename [OPTION]... [MODE-ARG]...
-
-Provide generalized library-building support services.
-
-    --config          show all configuration variables
-    --debug           enable verbose shell tracing
--n, --dry-run         display commands without modifying any files
-    --features        display basic configuration information and exit
-    --finish          same as \`--mode=finish'
-    --help            display this help message and exit
-    --mode=MODE       use operation mode MODE [default=inferred from MODE-ARGS]
-    --quiet           same as \`--silent'
-    --silent          don't print informational messages
-    --version         print version information
-
-MODE must be one of the following:
-
-      clean           remove files from the build directory
-      compile         compile a source file into a libtool object
-      execute         automatically set library path, then run a program
-      finish          complete the installation of libtool libraries
-      install         install libraries or executables
-      link            create a library or an executable
-      uninstall       remove libraries from an installed directory
-
-MODE-ARGS vary depending on the MODE.  Try \`$modename --help --mode=MODE' for
-a more detailed description of MODE.&quot;
-  exit 0
-  ;;
-
-clean)
-  $echo \
-&quot;Usage: $modename [OPTION]... --mode=clean RM [RM-OPTION]... FILE...
-
-Remove files from the build directory.
-
-RM is the name of the program to use to delete files associated with each FILE
-(typically \`/bin/rm').  RM-OPTIONS are options (such as \`-f') to be passed
-to RM.
-
-If FILE is a libtool library, object or program, all the files associated
-with it are deleted. Otherwise, only FILE itself is deleted using RM.&quot;
-  ;;
-
-compile)
-  $echo \
-&quot;Usage: $modename [OPTION]... --mode=compile COMPILE-COMMAND... SOURCEFILE
-
-Compile a source file into a libtool library object.
-
-This mode accepts the following additional options:
-
-  -o OUTPUT-FILE    set the output file name to OUTPUT-FILE
-  -prefer-pic       try to building PIC objects only
-  -prefer-non-pic   try to building non-PIC objects only
-  -static           always build a \`.o' file suitable for static linking
-
-COMPILE-COMMAND is a command to be used in creating a \`standard' object file
-from the given SOURCEFILE.
-
-The output file name is determined by removing the directory component from
-SOURCEFILE, then substituting the C source code suffix \`.c' with the
-library object suffix, \`.lo'.&quot;
-  ;;
-
-execute)
-  $echo \
-&quot;Usage: $modename [OPTION]... --mode=execute COMMAND [ARGS]...
-
-Automatically set library path, then run a program.
-
-This mode accepts the following additional options:
-
-  -dlopen FILE      add the directory containing FILE to the library path
-
-This mode sets the library path environment variable according to \`-dlopen'
-flags.
-
-If any of the ARGS are libtool executable wrappers, then they are translated
-into their corresponding uninstalled binary, and any of their required library
-directories are added to the library path.
-
-Then, COMMAND is executed, with ARGS as arguments.&quot;
-  ;;
-
-finish)
-  $echo \
-&quot;Usage: $modename [OPTION]... --mode=finish [LIBDIR]...
-
-Complete the installation of libtool libraries.
-
-Each LIBDIR is a directory that contains libtool libraries.
-
-The commands that this mode executes may require superuser privileges.  Use
-the \`--dry-run' option if you just want to see what would be executed.&quot;
-  ;;
-
-install)
-  $echo \
-&quot;Usage: $modename [OPTION]... --mode=install INSTALL-COMMAND...
-
-Install executables or libraries.
-
-INSTALL-COMMAND is the installation command.  The first component should be
-either the \`install' or \`cp' program.
-
-The rest of the components are interpreted as arguments to that command (only
-BSD-compatible install options are recognized).&quot;
-  ;;
-
-link)
-  $echo \
-&quot;Usage: $modename [OPTION]... --mode=link LINK-COMMAND...
-
-Link object files or libraries together to form another library, or to
-create an executable program.
-
-LINK-COMMAND is a command using the C compiler that you would use to create
-a program from several object files.
-
-The following components of LINK-COMMAND are treated specially:
-
-  -all-static       do not do any dynamic linking at all
-  -avoid-version    do not add a version suffix if possible
-  -dlopen FILE      \`-dlpreopen' FILE if it cannot be dlopened at runtime
-  -dlpreopen FILE   link in FILE and add its symbols to lt_preloaded_symbols
-  -export-dynamic   allow symbols from OUTPUT-FILE to be resolved with dlsym(3)
-  -export-symbols SYMFILE
-		    try to export only the symbols listed in SYMFILE
-  -export-symbols-regex REGEX
-		    try to export only the symbols matching REGEX
-  -LLIBDIR          search LIBDIR for required installed libraries
-  -lNAME            OUTPUT-FILE requires the installed library libNAME
-  -module           build a library that can dlopened
-  -no-fast-install  disable the fast-install mode
-  -no-install       link a not-installable executable
-  -no-undefined     declare that a library does not refer to external symbols
-  -o OUTPUT-FILE    create OUTPUT-FILE from the specified objects
-  -release RELEASE  specify package release information
-  -rpath LIBDIR     the created library will eventually be installed in LIBDIR
-  -R[ ]LIBDIR       add LIBDIR to the runtime path of programs and libraries
-  -static           do not do any dynamic linking of libtool libraries
-  -version-info CURRENT[:REVISION[:AGE]]
-		    specify library version info [each variable defaults to 0]
-
-All other options (arguments beginning with \`-') are ignored.
-
-Every other argument is treated as a filename.  Files ending in \`.la' are
-treated as uninstalled libtool libraries, other files are standard or library
-object files.
-
-If the OUTPUT-FILE ends in \`.la', then a libtool library is created,
-only library objects (\`.lo' files) may be specified, and \`-rpath' is
-required, except when creating a convenience library.
-
-If OUTPUT-FILE ends in \`.a' or \`.lib', then a standard library is created
-using \`ar' and \`ranlib', or on Windows using \`lib'.
-
-If OUTPUT-FILE ends in \`.lo' or \`.${objext}', then a reloadable object file
-is created, otherwise an executable program is created.&quot;
-  ;;
-
-uninstall)
-  $echo \
-&quot;Usage: $modename [OPTION]... --mode=uninstall RM [RM-OPTION]... FILE...
-
-Remove libraries from an installation directory.
-
-RM is the name of the program to use to delete files associated with each FILE
-(typically \`/bin/rm').  RM-OPTIONS are options (such as \`-f') to be passed
-to RM.
+exit $exit_status
 
-If FILE is a libtool library, all the files associated with it are deleted.
-Otherwise, only FILE itself is deleted using RM.&quot;
-  ;;
 
-*)
-  $echo &quot;$modename: invalid operation mode \`$mode'&quot; 1&gt;&amp;2
-  $echo &quot;$help&quot; 1&gt;&amp;2
-  exit 1
-  ;;
-esac
+# The TAGs below are defined such that we never get into a situation
+# in which we disable both kinds of libraries.  Given conflicting
+# choices, we go for a static library, that is the most portable,
+# since we can't tell whether shared libraries were disabled because
+# the user asked for that or because the platform doesn't support
+# them.  This is particularly important on AIX, because we don't
+# support having both static and shared libraries enabled at the same
+# time on that platform, so we default to a shared-only configuration.
+# If a disable-shared tag is given, we'll fallback to a static-only
+# configuration.  But we'll never go from static-only to shared-only.
 
-echo
-$echo &quot;Try \`$modename --help' for more information about other modes.&quot;
+# ### BEGIN LIBTOOL TAG CONFIG: disable-shared
+build_libtool_libs=no
+build_old_libs=yes
+# ### END LIBTOOL TAG CONFIG: disable-shared
 
-exit 0
+# ### BEGIN LIBTOOL TAG CONFIG: disable-static
+build_old_libs=`case $build_libtool_libs in yes) echo no;; *) echo yes;; esac`
+# ### END LIBTOOL TAG CONFIG: disable-static
 
 # Local Variables:
 # mode:shell-script
 # sh-indentation:2
 # End:
+# vi:sw=2
+
diff --git a/nx-X11/extras/fontconfig/config.guess b/nx-X11/extras/fontconfig/config.guess
index 9c292ea..c2246a4 100755
--- a/nx-X11/extras/fontconfig/config.guess
+++ b/nx-X11/extras/fontconfig/config.guess
@@ -1,9 +1,10 @@
 #! /bin/sh
 # Attempt to guess a canonical system name.
 #   Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999,
-#   2000, 2001, 2002, 2003, 2004, 2005 Free Software Foundation, Inc.
+#   2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010
+#   Free Software Foundation, Inc.
 
-timestamp='2005-03-24'
+timestamp='2009-12-30'
 
 # This file is free software; you can redistribute it and/or modify it
 # under the terms of the GNU General Public License as published by
@@ -17,23 +18,25 @@ timestamp='2005-03-24'
 #
 # You should have received a copy of the GNU General Public License
 # along with this program; if not, write to the Free Software
-# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+# Foundation, Inc., 51 Franklin Street - Fifth Floor, Boston, MA
+# 02110-1301, USA.
 #
 # As a special exception to the GNU General Public License, if you
 # distribute this file as part of a program that contains a
 # configuration script generated by Autoconf, you may include it under
 # the same distribution terms that you use for the rest of that program.
 
-# Originally written by Per Bothner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">per at bothner.com</A>&gt;.
-# Please send patches to &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">config-patches at gnu.org</A>&gt;.  Submit a context
-# diff and a properly formatted ChangeLog entry.
+
+# Originally written by Per Bothner.  Please send patches (context
+# diff format) to &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">config-patches at gnu.org</A>&gt; and include a ChangeLog
+# entry.
 #
 # This script attempts to guess a canonical system name similar to
 # config.sub.  If it succeeds, it prints the system name on stdout, and
 # exits with 0.  Otherwise, it exits with 1.
 #
-# The plan is that this can be called by configure scripts if you
-# don't specify an explicit build system type.
+# You can get the latest version of this script from:
+# <A HREF="http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.guess;hb=HEAD">http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.guess;hb=HEAD</A>
 
 me=`echo &quot;$0&quot; | sed -e 's,.*/,,'`
 
@@ -53,8 +56,9 @@ version=&quot;\
 GNU config.guess ($timestamp)
 
 Originally written by Per Bothner.
-Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005
-Free Software Foundation, Inc.
+Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000,
+2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010 Free
+Software Foundation, Inc.
 
 This is free software; see the source for copying conditions.  There is NO
 warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&quot;
@@ -66,11 +70,11 @@ Try \`$me --help' for more information.&quot;
 while test $# -gt 0 ; do
   case $1 in
     --time-stamp | --time* | -t )
-       echo &quot;$timestamp&quot; ; exit 0 ;;
+       echo &quot;$timestamp&quot; ; exit ;;
     --version | -v )
-       echo &quot;$version&quot; ; exit 0 ;;
+       echo &quot;$version&quot; ; exit ;;
     --help | --h* | -h )
-       echo &quot;$usage&quot;; exit 0 ;;
+       echo &quot;$usage&quot;; exit ;;
     -- )     # Stop option processing
        shift; break ;;
     - )	# Use stdin as input.
@@ -104,7 +108,7 @@ set_cc_for_build='
 trap &quot;exitcode=\$?; (rm -f \$tmpfiles 2&gt;/dev/null; rmdir \$tmp 2&gt;/dev/null) &amp;&amp; exit \$exitcode&quot; 0 ;
 trap &quot;rm -f \$tmpfiles 2&gt;/dev/null; rmdir \$tmp 2&gt;/dev/null; exit 1&quot; 1 2 13 15 ;
 : ${TMPDIR=/tmp} ;
- { tmp=`(umask 077 &amp;&amp; mktemp -d -q &quot;$TMPDIR/cgXXXXXX&quot;) 2&gt;/dev/null` &amp;&amp; test -n &quot;$tmp&quot; &amp;&amp; test -d &quot;$tmp&quot; ; } ||
+ { tmp=`(umask 077 &amp;&amp; mktemp -d &quot;$TMPDIR/cgXXXXXX&quot;) 2&gt;/dev/null` &amp;&amp; test -n &quot;$tmp&quot; &amp;&amp; test -d &quot;$tmp&quot; ; } ||
  { test -n &quot;$RANDOM&quot; &amp;&amp; tmp=$TMPDIR/cg$$-$RANDOM &amp;&amp; (umask 077 &amp;&amp; mkdir $tmp) ; } ||
  { tmp=$TMPDIR/cg-$$ &amp;&amp; (umask 077 &amp;&amp; mkdir $tmp) &amp;&amp; echo &quot;Warning: creating insecure temp directory&quot; &gt;&amp;2 ; } ||
  { echo &quot;$me: cannot create a temporary directory in $TMPDIR&quot; &gt;&amp;2 ; exit 1 ; } ;
@@ -123,7 +127,7 @@ case $CC_FOR_BUILD,$HOST_CC,$CC in
 	;;
  ,,*)   CC_FOR_BUILD=$CC ;;
  ,*,*)  CC_FOR_BUILD=$HOST_CC ;;
-esac ;'
+esac ; set_cc_for_build= ;'
 
 # This is needed to find uname on a Pyramid OSx when run in the BSD universe.
 # (<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">ghazi at noc.rutgers.edu</A> 1994-08-24)
@@ -158,6 +162,7 @@ case &quot;${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}&quot; in
 	    arm*) machine=arm-unknown ;;
 	    sh3el) machine=shl-unknown ;;
 	    sh3eb) machine=sh-unknown ;;
+	    sh5el) machine=sh5le-unknown ;;
 	    *) machine=${UNAME_MACHINE_ARCH}-unknown ;;
 	esac
 	# The Operating System including object format, if it has switched
@@ -166,7 +171,7 @@ case &quot;${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}&quot; in
 	    arm*|i386|m68k|ns32k|sh3*|sparc|vax)
 		eval $set_cc_for_build
 		if echo __ELF__ | $CC_FOR_BUILD -E - 2&gt;/dev/null \
-			| grep __ELF__ &gt;/dev/null
+			| grep -q __ELF__
 		then
 		    # Once all utilities can be ECOFF (netbsdecoff) or a.out (netbsdaout).
 		    # Return netbsd for either.  FIX?
@@ -196,55 +201,23 @@ case &quot;${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}&quot; in
 	# contains redundant information, the shorter form:
 	# CPU_TYPE-MANUFACTURER-OPERATING_SYSTEM is used.
 	echo &quot;${machine}-${os}${release}&quot;
-	exit 0 ;;
-    amd64:OpenBSD:*:*)
-	echo x86_64-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    amiga:OpenBSD:*:*)
-	echo m68k-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    cats:OpenBSD:*:*)
-	echo arm-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    hp300:OpenBSD:*:*)
-	echo m68k-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    luna88k:OpenBSD:*:*)
-    	echo m88k-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    mac68k:OpenBSD:*:*)
-	echo m68k-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    macppc:OpenBSD:*:*)
-	echo powerpc-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    mvme68k:OpenBSD:*:*)
-	echo m68k-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    mvme88k:OpenBSD:*:*)
-	echo m88k-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    mvmeppc:OpenBSD:*:*)
-	echo powerpc-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    sgi:OpenBSD:*:*)
-	echo mips64-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    sun3:OpenBSD:*:*)
-	echo m68k-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     *:OpenBSD:*:*)
-	echo ${UNAME_MACHINE}-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
+	UNAME_MACHINE_ARCH=`arch | sed 's/OpenBSD.//'`
+	echo ${UNAME_MACHINE_ARCH}-unknown-openbsd${UNAME_RELEASE}
+	exit ;;
     *:ekkoBSD:*:*)
 	echo ${UNAME_MACHINE}-unknown-ekkobsd${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
+    *:SolidBSD:*:*)
+	echo ${UNAME_MACHINE}-unknown-solidbsd${UNAME_RELEASE}
+	exit ;;
     macppc:MirBSD:*:*)
-	echo powerppc-unknown-mirbsd${UNAME_RELEASE}
-	exit 0 ;;
+	echo powerpc-unknown-mirbsd${UNAME_RELEASE}
+	exit ;;
     *:MirBSD:*:*)
 	echo ${UNAME_MACHINE}-unknown-mirbsd${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     alpha:OSF1:*:*)
 	case $UNAME_RELEASE in
 	*4.0)
@@ -297,40 +270,43 @@ case &quot;${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}&quot; in
 	# A Xn.n version is an unreleased experimental baselevel.
 	# 1.2 uses &quot;1.2&quot; for uname -r.
 	echo ${UNAME_MACHINE}-dec-osf`echo ${UNAME_RELEASE} | sed -e 's/^[PVTX]//' | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz'`
-	exit 0 ;;
+	exit ;;
     Alpha\ *:Windows_NT*:*)
 	# How do we know it's Interix rather than the generic POSIX subsystem?
 	# Should we change UNAME_MACHINE based on the output of uname instead
 	# of the specific Alpha model?
 	echo alpha-pc-interix
-	exit 0 ;;
+	exit ;;
     21064:Windows_NT:50:3)
 	echo alpha-dec-winnt3.5
-	exit 0 ;;
+	exit ;;
     Amiga*:UNIX_System_V:4.0:*)
 	echo m68k-unknown-sysv4
-	exit 0;;
+	exit ;;
     *:[Aa]miga[Oo][Ss]:*:*)
 	echo ${UNAME_MACHINE}-unknown-amigaos
-	exit 0 ;;
+	exit ;;
     *:[Mm]orph[Oo][Ss]:*:*)
 	echo ${UNAME_MACHINE}-unknown-morphos
-	exit 0 ;;
+	exit ;;
     *:OS/390:*:*)
 	echo i370-ibm-openedition
-	exit 0 ;;
+	exit ;;
     *:z/VM:*:*)
 	echo s390-ibm-zvmoe
-	exit 0 ;;
+	exit ;;
     *:OS400:*:*)
         echo powerpc-ibm-os400
-	exit 0 ;;
+	exit ;;
     arm:RISC*:1.[012]*:*|arm:riscix:1.[012]*:*)
 	echo arm-acorn-riscix${UNAME_RELEASE}
-	exit 0;;
+	exit ;;
+    arm:riscos:*:*|arm:RISCOS:*:*)
+	echo arm-unknown-riscos
+	exit ;;
     SR2?01:HI-UX/MPP:*:* | SR8000:HI-UX/MPP:*:*)
 	echo hppa1.1-hitachi-hiuxmpp
-	exit 0;;
+	exit ;;
     Pyramid*:OSx*:*:* | MIS*:OSx*:*:* | MIS*:SMP_DC-OSx*:*:*)
 	# <A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">akee at wpdis03.wpafb.af.mil</A> (Earle F. Ake) contributed MIS and NILE.
 	if test &quot;`(/bin/universe) 2&gt;/dev/null`&quot; = att ; then
@@ -338,32 +314,51 @@ case &quot;${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}&quot; in
 	else
 		echo pyramid-pyramid-bsd
 	fi
-	exit 0 ;;
+	exit ;;
     NILE*:*:*:dcosx)
 	echo pyramid-pyramid-svr4
-	exit 0 ;;
+	exit ;;
     DRS?6000:unix:4.0:6*)
 	echo sparc-icl-nx6
-	exit 0 ;;
+	exit ;;
     DRS?6000:UNIX_SV:4.2*:7* | DRS?6000:isis:4.2*:7*)
 	case `/usr/bin/uname -p` in
-	    sparc) echo sparc-icl-nx7 &amp;&amp; exit 0 ;;
+	    sparc) echo sparc-icl-nx7; exit ;;
 	esac ;;
+    s390x:SunOS:*:*)
+	echo ${UNAME_MACHINE}-ibm-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
+	exit ;;
     sun4H:SunOS:5.*:*)
 	echo sparc-hal-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
-	exit 0 ;;
+	exit ;;
     sun4*:SunOS:5.*:* | tadpole*:SunOS:5.*:*)
 	echo sparc-sun-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
-	exit 0 ;;
-    i86pc:SunOS:5.*:*)
-	echo i386-pc-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
-	exit 0 ;;
+	exit ;;
+    i86pc:AuroraUX:5.*:* | i86xen:AuroraUX:5.*:*)
+	echo i386-pc-auroraux${UNAME_RELEASE}
+	exit ;;
+    i86pc:SunOS:5.*:* | i86xen:SunOS:5.*:*)
+	eval $set_cc_for_build
+	SUN_ARCH=&quot;i386&quot;
+	# If there is a compiler, see if it is configured for 64-bit objects.
+	# Note that the Sun cc does not turn __LP64__ into 1 like gcc does.
+	# This test works for both compilers.
+	if [ &quot;$CC_FOR_BUILD&quot; != 'no_compiler_found' ]; then
+	    if (echo '#ifdef __amd64'; echo IS_64BIT_ARCH; echo '#endif') | \
+		(CCOPTS= $CC_FOR_BUILD -E - 2&gt;/dev/null) | \
+		grep IS_64BIT_ARCH &gt;/dev/null
+	    then
+		SUN_ARCH=&quot;x86_64&quot;
+	    fi
+	fi
+	echo ${SUN_ARCH}-pc-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
+	exit ;;
     sun4*:SunOS:6*:*)
 	# According to config.sub, this is the proper way to canonicalize
 	# SunOS6.  Hard to guess exactly what SunOS6 will be like, but
 	# it's likely to be more like Solaris than SunOS4.
 	echo sparc-sun-solaris3`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
-	exit 0 ;;
+	exit ;;
     sun4*:SunOS:*:*)
 	case &quot;`/usr/bin/arch -k`&quot; in
 	    Series*|S4*)
@@ -372,10 +367,10 @@ case &quot;${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}&quot; in
 	esac
 	# Japanese Language versions have a version number like `4.1.3-JL'.
 	echo sparc-sun-sunos`echo ${UNAME_RELEASE}|sed -e 's/-/_/'`
-	exit 0 ;;
+	exit ;;
     sun3*:SunOS:*:*)
 	echo m68k-sun-sunos${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     sun*:*:4.2BSD:*)
 	UNAME_RELEASE=`(sed 1q /etc/motd | awk '{print substr($5,1,3)}') 2&gt;/dev/null`
 	test &quot;x${UNAME_RELEASE}&quot; = &quot;x&quot; &amp;&amp; UNAME_RELEASE=3
@@ -387,10 +382,10 @@ case &quot;${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}&quot; in
 		echo sparc-sun-sunos${UNAME_RELEASE}
 		;;
 	esac
-	exit 0 ;;
+	exit ;;
     aushp:SunOS:*:*)
 	echo sparc-auspex-sunos${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     # The situation for MiNT is a little confusing.  The machine name
     # can be virtually everything (everything which is not
     # &quot;atarist&quot; or &quot;atariste&quot; at least should have a processor
@@ -401,40 +396,40 @@ case &quot;${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}&quot; in
     # be no problem.
     atarist[e]:*MiNT:*:* | atarist[e]:*mint:*:* | atarist[e]:*TOS:*:*)
         echo m68k-atari-mint${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     atari*:*MiNT:*:* | atari*:*mint:*:* | atarist[e]:*TOS:*:*)
 	echo m68k-atari-mint${UNAME_RELEASE}
-        exit 0 ;;
+        exit ;;
     *falcon*:*MiNT:*:* | *falcon*:*mint:*:* | *falcon*:*TOS:*:*)
         echo m68k-atari-mint${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     milan*:*MiNT:*:* | milan*:*mint:*:* | *milan*:*TOS:*:*)
         echo m68k-milan-mint${UNAME_RELEASE}
-        exit 0 ;;
+        exit ;;
     hades*:*MiNT:*:* | hades*:*mint:*:* | *hades*:*TOS:*:*)
         echo m68k-hades-mint${UNAME_RELEASE}
-        exit 0 ;;
+        exit ;;
     *:*MiNT:*:* | *:*mint:*:* | *:*TOS:*:*)
         echo m68k-unknown-mint${UNAME_RELEASE}
-        exit 0 ;;
+        exit ;;
     m68k:machten:*:*)
 	echo m68k-apple-machten${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     powerpc:machten:*:*)
 	echo powerpc-apple-machten${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     RISC*:Mach:*:*)
 	echo mips-dec-mach_bsd4.3
-	exit 0 ;;
+	exit ;;
     RISC*:ULTRIX:*:*)
 	echo mips-dec-ultrix${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     VAX*:ULTRIX*:*:*)
 	echo vax-dec-ultrix${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     2020:CLIX:*:* | 2430:CLIX:*:*)
 	echo clipper-intergraph-clix${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     mips:*:*:UMIPS | mips:*:*:RISCos)
 	eval $set_cc_for_build
 	sed 's/^	//' &lt;&lt; EOF &gt;$dummy.c
@@ -458,32 +453,33 @@ case &quot;${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}&quot; in
 	  exit (-1);
 	}
 EOF
-	$CC_FOR_BUILD -o $dummy $dummy.c \
-	  &amp;&amp; $dummy `echo &quot;${UNAME_RELEASE}&quot; | sed -n 's/\([0-9]*\).*/\1/p'` \
-	  &amp;&amp; exit 0
+	$CC_FOR_BUILD -o $dummy $dummy.c &amp;&amp;
+	  dummyarg=`echo &quot;${UNAME_RELEASE}&quot; | sed -n 's/\([0-9]*\).*/\1/p'` &amp;&amp;
+	  SYSTEM_NAME=`$dummy $dummyarg` &amp;&amp;
+	    { echo &quot;$SYSTEM_NAME&quot;; exit; }
 	echo mips-mips-riscos${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     Motorola:PowerMAX_OS:*:*)
 	echo powerpc-motorola-powermax
-	exit 0 ;;
+	exit ;;
     Motorola:*:4.3:PL8-*)
 	echo powerpc-harris-powermax
-	exit 0 ;;
+	exit ;;
     Night_Hawk:*:*:PowerMAX_OS | Synergy:PowerMAX_OS:*:*)
 	echo powerpc-harris-powermax
-	exit 0 ;;
+	exit ;;
     Night_Hawk:Power_UNIX:*:*)
 	echo powerpc-harris-powerunix
-	exit 0 ;;
+	exit ;;
     m88k:CX/UX:7*:*)
 	echo m88k-harris-cxux7
-	exit 0 ;;
+	exit ;;
     m88k:*:4*:R4*)
 	echo m88k-motorola-sysv4
-	exit 0 ;;
+	exit ;;
     m88k:*:3*:R3*)
 	echo m88k-motorola-sysv3
-	exit 0 ;;
+	exit ;;
     AViiON:dgux:*:*)
         # DG/UX returns AViiON for all architectures
         UNAME_PROCESSOR=`/usr/bin/uname -p`
@@ -499,29 +495,29 @@ EOF
 	else
 	    echo i586-dg-dgux${UNAME_RELEASE}
 	fi
- 	exit 0 ;;
+ 	exit ;;
     M88*:DolphinOS:*:*)	# DolphinOS (SVR3)
 	echo m88k-dolphin-sysv3
-	exit 0 ;;
+	exit ;;
     M88*:*:R3*:*)
 	# Delta 88k system running SVR3
 	echo m88k-motorola-sysv3
-	exit 0 ;;
+	exit ;;
     XD88*:*:*:*) # Tektronix XD88 system running UTekV (SVR3)
 	echo m88k-tektronix-sysv3
-	exit 0 ;;
+	exit ;;
     Tek43[0-9][0-9]:UTek:*:*) # Tektronix 4300 system running UTek (BSD)
 	echo m68k-tektronix-bsd
-	exit 0 ;;
+	exit ;;
     *:IRIX*:*:*)
 	echo mips-sgi-irix`echo ${UNAME_RELEASE}|sed -e 's/-/_/g'`
-	exit 0 ;;
+	exit ;;
     ????????:AIX?:[12].1:2)   # AIX 2.2.1 or AIX 2.1.1 is RT/PC AIX.
-	echo romp-ibm-aix      # uname -m gives an 8 hex-code CPU id
-	exit 0 ;;              # Note that: echo &quot;'`uname -s`'&quot; gives 'AIX '
+	echo romp-ibm-aix     # uname -m gives an 8 hex-code CPU id
+	exit ;;               # Note that: echo &quot;'`uname -s`'&quot; gives 'AIX '
     i*86:AIX:*:*)
 	echo i386-ibm-aix
-	exit 0 ;;
+	exit ;;
     ia64:AIX:*:*)
 	if [ -x /usr/bin/oslevel ] ; then
 		IBM_REV=`/usr/bin/oslevel`
@@ -529,7 +525,7 @@ EOF
 		IBM_REV=${UNAME_VERSION}.${UNAME_RELEASE}
 	fi
 	echo ${UNAME_MACHINE}-ibm-aix${IBM_REV}
-	exit 0 ;;
+	exit ;;
     *:AIX:2:3)
 	if grep bos325 /usr/include/stdio.h &gt;/dev/null 2&gt;&amp;1; then
 		eval $set_cc_for_build
@@ -544,15 +540,19 @@ EOF
 			exit(0);
 			}
 EOF
-		$CC_FOR_BUILD -o $dummy $dummy.c &amp;&amp; $dummy &amp;&amp; exit 0
-		echo rs6000-ibm-aix3.2.5
+		if $CC_FOR_BUILD -o $dummy $dummy.c &amp;&amp; SYSTEM_NAME=`$dummy`
+		then
+			echo &quot;$SYSTEM_NAME&quot;
+		else
+			echo rs6000-ibm-aix3.2.5
+		fi
 	elif grep bos324 /usr/include/stdio.h &gt;/dev/null 2&gt;&amp;1; then
 		echo rs6000-ibm-aix3.2.4
 	else
 		echo rs6000-ibm-aix3.2
 	fi
-	exit 0 ;;
-    *:AIX:*:[45])
+	exit ;;
+    *:AIX:*:[456])
 	IBM_CPU_ID=`/usr/sbin/lsdev -C -c processor -S available | sed 1q | awk '{ print $1 }'`
 	if /usr/sbin/lsattr -El ${IBM_CPU_ID} | grep ' POWER' &gt;/dev/null 2&gt;&amp;1; then
 		IBM_ARCH=rs6000
@@ -565,28 +565,28 @@ EOF
 		IBM_REV=${UNAME_VERSION}.${UNAME_RELEASE}
 	fi
 	echo ${IBM_ARCH}-ibm-aix${IBM_REV}
-	exit 0 ;;
+	exit ;;
     *:AIX:*:*)
 	echo rs6000-ibm-aix
-	exit 0 ;;
+	exit ;;
     ibmrt:4.4BSD:*|romp-ibm:BSD:*)
 	echo romp-ibm-bsd4.4
-	exit 0 ;;
+	exit ;;
     ibmrt:*BSD:*|romp-ibm:BSD:*)            # covers RT/PC BSD and
 	echo romp-ibm-bsd${UNAME_RELEASE}   # 4.3 with uname added to
-	exit 0 ;;                           # report: romp-ibm BSD 4.3
+	exit ;;                             # report: romp-ibm BSD 4.3
     *:BOSX:*:*)
 	echo rs6000-bull-bosx
-	exit 0 ;;
+	exit ;;
     DPX/2?00:B.O.S.:*:*)
 	echo m68k-bull-sysv3
-	exit 0 ;;
+	exit ;;
     9000/[34]??:4.3bsd:1.*:*)
 	echo m68k-hp-bsd
-	exit 0 ;;
+	exit ;;
     hp300:4.4BSD:*:* | 9000/[34]??:4.3bsd:2.*:*)
 	echo m68k-hp-bsd4.4
-	exit 0 ;;
+	exit ;;
     9000/[34678]??:HP-UX:*:*)
 	HPUX_REV=`echo ${UNAME_RELEASE}|sed -e 's/[^.]*.[0B]*//'`
 	case &quot;${UNAME_MACHINE}&quot; in
@@ -648,9 +648,19 @@ EOF
 	esac
 	if [ ${HP_ARCH} = &quot;hppa2.0w&quot; ]
 	then
-	    # avoid double evaluation of $set_cc_for_build
-	    test -n &quot;$CC_FOR_BUILD&quot; || eval $set_cc_for_build
-	    if echo __LP64__ | (CCOPTS= $CC_FOR_BUILD -E -) | grep __LP64__ &gt;/dev/null
+	    eval $set_cc_for_build
+
+	    # hppa2.0w-hp-hpux* has a 64-bit kernel and a compiler generating
+	    # 32-bit code.  hppa64-hp-hpux* has the same kernel and a compiler
+	    # generating 64-bit code.  GNU and HP use different nomenclature:
+	    #
+	    # $ CC_FOR_BUILD=cc ./config.guess
+	    # =&gt; hppa2.0w-hp-hpux11.23
+	    # $ CC_FOR_BUILD=&quot;cc +DA2.0w&quot; ./config.guess
+	    # =&gt; hppa64-hp-hpux11.23
+
+	    if echo __LP64__ | (CCOPTS= $CC_FOR_BUILD -E - 2&gt;/dev/null) |
+		grep -q __LP64__
 	    then
 		HP_ARCH=&quot;hppa2.0w&quot;
 	    else
@@ -658,11 +668,11 @@ EOF
 	    fi
 	fi
 	echo ${HP_ARCH}-hp-hpux${HPUX_REV}
-	exit 0 ;;
+	exit ;;
     ia64:HP-UX:*:*)
 	HPUX_REV=`echo ${UNAME_RELEASE}|sed -e 's/[^.]*.[0B]*//'`
 	echo ia64-hp-hpux${HPUX_REV}
-	exit 0 ;;
+	exit ;;
     3050*:HI-UX:*:*)
 	eval $set_cc_for_build
 	sed 's/^	//' &lt;&lt; EOF &gt;$dummy.c
@@ -690,219 +700,248 @@ EOF
 	  exit (0);
 	}
 EOF
-	$CC_FOR_BUILD -o $dummy $dummy.c &amp;&amp; $dummy &amp;&amp; exit 0
+	$CC_FOR_BUILD -o $dummy $dummy.c &amp;&amp; SYSTEM_NAME=`$dummy` &amp;&amp;
+		{ echo &quot;$SYSTEM_NAME&quot;; exit; }
 	echo unknown-hitachi-hiuxwe2
-	exit 0 ;;
+	exit ;;
     9000/7??:4.3bsd:*:* | 9000/8?[79]:4.3bsd:*:* )
 	echo hppa1.1-hp-bsd
-	exit 0 ;;
+	exit ;;
     9000/8??:4.3bsd:*:*)
 	echo hppa1.0-hp-bsd
-	exit 0 ;;
+	exit ;;
     *9??*:MPE/iX:*:* | *3000*:MPE/iX:*:*)
 	echo hppa1.0-hp-mpeix
-	exit 0 ;;
+	exit ;;
     hp7??:OSF1:*:* | hp8?[79]:OSF1:*:* )
 	echo hppa1.1-hp-osf
-	exit 0 ;;
+	exit ;;
     hp8??:OSF1:*:*)
 	echo hppa1.0-hp-osf
-	exit 0 ;;
+	exit ;;
     i*86:OSF1:*:*)
 	if [ -x /usr/sbin/sysversion ] ; then
 	    echo ${UNAME_MACHINE}-unknown-osf1mk
 	else
 	    echo ${UNAME_MACHINE}-unknown-osf1
 	fi
-	exit 0 ;;
+	exit ;;
     parisc*:Lites*:*:*)
 	echo hppa1.1-hp-lites
-	exit 0 ;;
+	exit ;;
     C1*:ConvexOS:*:* | convex:ConvexOS:C1*:*)
 	echo c1-convex-bsd
-        exit 0 ;;
+        exit ;;
     C2*:ConvexOS:*:* | convex:ConvexOS:C2*:*)
 	if getsysinfo -f scalar_acc
 	then echo c32-convex-bsd
 	else echo c2-convex-bsd
 	fi
-        exit 0 ;;
+        exit ;;
     C34*:ConvexOS:*:* | convex:ConvexOS:C34*:*)
 	echo c34-convex-bsd
-        exit 0 ;;
+        exit ;;
     C38*:ConvexOS:*:* | convex:ConvexOS:C38*:*)
 	echo c38-convex-bsd
-        exit 0 ;;
+        exit ;;
     C4*:ConvexOS:*:* | convex:ConvexOS:C4*:*)
 	echo c4-convex-bsd
-        exit 0 ;;
+        exit ;;
     CRAY*Y-MP:*:*:*)
 	echo ymp-cray-unicos${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
-	exit 0 ;;
+	exit ;;
     CRAY*[A-Z]90:*:*:*)
 	echo ${UNAME_MACHINE}-cray-unicos${UNAME_RELEASE} \
 	| sed -e 's/CRAY.*\([A-Z]90\)/\1/' \
 	      -e y/ABCDEFGHIJKLMNOPQRSTUVWXYZ/abcdefghijklmnopqrstuvwxyz/ \
 	      -e 's/\.[^.]*$/.X/'
-	exit 0 ;;
+	exit ;;
     CRAY*TS:*:*:*)
 	echo t90-cray-unicos${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
-	exit 0 ;;
+	exit ;;
     CRAY*T3E:*:*:*)
 	echo alphaev5-cray-unicosmk${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
-	exit 0 ;;
+	exit ;;
     CRAY*SV1:*:*:*)
 	echo sv1-cray-unicos${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
-	exit 0 ;;
+	exit ;;
     *:UNICOS/mp:*:*)
 	echo craynv-cray-unicosmp${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
-	exit 0 ;;
+	exit ;;
     F30[01]:UNIX_System_V:*:* | F700:UNIX_System_V:*:*)
 	FUJITSU_PROC=`uname -m | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz'`
         FUJITSU_SYS=`uname -p | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/\///'`
         FUJITSU_REL=`echo ${UNAME_RELEASE} | sed -e 's/ /_/'`
         echo &quot;${FUJITSU_PROC}-fujitsu-${FUJITSU_SYS}${FUJITSU_REL}&quot;
-        exit 0 ;;
+        exit ;;
     5000:UNIX_System_V:4.*:*)
         FUJITSU_SYS=`uname -p | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/\///'`
         FUJITSU_REL=`echo ${UNAME_RELEASE} | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/ /_/'`
         echo &quot;sparc-fujitsu-${FUJITSU_SYS}${FUJITSU_REL}&quot;
-	exit 0 ;;
+	exit ;;
     i*86:BSD/386:*:* | i*86:BSD/OS:*:* | *:Ascend\ Embedded/OS:*:*)
 	echo ${UNAME_MACHINE}-pc-bsdi${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     sparc*:BSD/OS:*:*)
 	echo sparc-unknown-bsdi${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     *:BSD/OS:*:*)
 	echo ${UNAME_MACHINE}-unknown-bsdi${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     *:FreeBSD:*:*)
-	echo ${UNAME_MACHINE}-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'`
-	exit 0 ;;
+	case ${UNAME_MACHINE} in
+	    pc98)
+		echo i386-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'` ;;
+	    amd64)
+		echo x86_64-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'` ;;
+	    *)
+		echo ${UNAME_MACHINE}-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'` ;;
+	esac
+	exit ;;
     i*:CYGWIN*:*)
 	echo ${UNAME_MACHINE}-pc-cygwin
-	exit 0 ;;
-    i*:MINGW*:*)
+	exit ;;
+    *:MINGW*:*)
 	echo ${UNAME_MACHINE}-pc-mingw32
-	exit 0 ;;
+	exit ;;
+    i*:windows32*:*)
+    	# uname -m includes &quot;-pc&quot; on this system.
+    	echo ${UNAME_MACHINE}-mingw32
+	exit ;;
     i*:PW*:*)
 	echo ${UNAME_MACHINE}-pc-pw32
-	exit 0 ;;
-    x86:Interix*:[34]*)
-	echo i586-pc-interix${UNAME_RELEASE}|sed -e 's/\..*//'
-	exit 0 ;;
+	exit ;;
+    *:Interix*:*)
+    	case ${UNAME_MACHINE} in
+	    x86)
+		echo i586-pc-interix${UNAME_RELEASE}
+		exit ;;
+	    authenticamd | genuineintel | EM64T)
+		echo x86_64-unknown-interix${UNAME_RELEASE}
+		exit ;;
+	    IA64)
+		echo ia64-unknown-interix${UNAME_RELEASE}
+		exit ;;
+	esac ;;
     [345]86:Windows_95:* | [345]86:Windows_98:* | [345]86:Windows_NT:*)
 	echo i${UNAME_MACHINE}-pc-mks
-	exit 0 ;;
+	exit ;;
+    8664:Windows_NT:*)
+	echo x86_64-pc-mks
+	exit ;;
     i*:Windows_NT*:* | Pentium*:Windows_NT*:*)
 	# How do we know it's Interix rather than the generic POSIX subsystem?
 	# It also conflicts with pre-2.0 versions of AT&amp;T UWIN. Should we
 	# UNAME_MACHINE based on the output of uname instead of i386?
 	echo i586-pc-interix
-	exit 0 ;;
+	exit ;;
     i*:UWIN*:*)
 	echo ${UNAME_MACHINE}-pc-uwin
-	exit 0 ;;
-    amd64:CYGWIN*:*:*)
+	exit ;;
+    amd64:CYGWIN*:*:* | x86_64:CYGWIN*:*:*)
 	echo x86_64-unknown-cygwin
-	exit 0 ;;
+	exit ;;
     p*:CYGWIN*:*)
 	echo powerpcle-unknown-cygwin
-	exit 0 ;;
+	exit ;;
     prep*:SunOS:5.*:*)
 	echo powerpcle-unknown-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
-	exit 0 ;;
+	exit ;;
     *:GNU:*:*)
 	# the GNU system
 	echo `echo ${UNAME_MACHINE}|sed -e 's,[-/].*$,,'`-unknown-gnu`echo ${UNAME_RELEASE}|sed -e 's,/.*$,,'`
-	exit 0 ;;
+	exit ;;
     *:GNU/*:*:*)
 	# other systems with GNU libc and userland
 	echo ${UNAME_MACHINE}-unknown-`echo ${UNAME_SYSTEM} | sed 's,^[^/]*/,,' | tr '[A-Z]' '[a-z]'``echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'`-gnu
-	exit 0 ;;
+	exit ;;
     i*86:Minix:*:*)
 	echo ${UNAME_MACHINE}-pc-minix
-	exit 0 ;;
+	exit ;;
+    alpha:Linux:*:*)
+	case `sed -n '/^cpu model/s/^.*: \(.*\)/\1/p' &lt; /proc/cpuinfo` in
+	  EV5)   UNAME_MACHINE=alphaev5 ;;
+	  EV56)  UNAME_MACHINE=alphaev56 ;;
+	  PCA56) UNAME_MACHINE=alphapca56 ;;
+	  PCA57) UNAME_MACHINE=alphapca56 ;;
+	  EV6)   UNAME_MACHINE=alphaev6 ;;
+	  EV67)  UNAME_MACHINE=alphaev67 ;;
+	  EV68*) UNAME_MACHINE=alphaev68 ;;
+        esac
+	objdump --private-headers /bin/sh | grep -q ld.so.1
+	if test &quot;$?&quot; = 0 ; then LIBC=&quot;libc1&quot; ; else LIBC=&quot;&quot; ; fi
+	echo ${UNAME_MACHINE}-unknown-linux-gnu${LIBC}
+	exit ;;
     arm*:Linux:*:*)
+	eval $set_cc_for_build
+	if echo __ARM_EABI__ | $CC_FOR_BUILD -E - 2&gt;/dev/null \
+	    | grep -q __ARM_EABI__
+	then
+	    echo ${UNAME_MACHINE}-unknown-linux-gnu
+	else
+	    echo ${UNAME_MACHINE}-unknown-linux-gnueabi
+	fi
+	exit ;;
+    avr32*:Linux:*:*)
 	echo ${UNAME_MACHINE}-unknown-linux-gnu
-	exit 0 ;;
+	exit ;;
     cris:Linux:*:*)
 	echo cris-axis-linux-gnu
-	exit 0 ;;
+	exit ;;
     crisv32:Linux:*:*)
 	echo crisv32-axis-linux-gnu
-	exit 0 ;;
+	exit ;;
     frv:Linux:*:*)
     	echo frv-unknown-linux-gnu
-	exit 0 ;;
+	exit ;;
+    i*86:Linux:*:*)
+	LIBC=gnu
+	eval $set_cc_for_build
+	sed 's/^	//' &lt;&lt; EOF &gt;$dummy.c
+	#ifdef __dietlibc__
+	LIBC=dietlibc
+	#endif
+EOF
+	eval `$CC_FOR_BUILD -E $dummy.c 2&gt;/dev/null | grep '^LIBC'`
+	echo &quot;${UNAME_MACHINE}-pc-linux-${LIBC}&quot;
+	exit ;;
     ia64:Linux:*:*)
 	echo ${UNAME_MACHINE}-unknown-linux-gnu
-	exit 0 ;;
+	exit ;;
     m32r*:Linux:*:*)
 	echo ${UNAME_MACHINE}-unknown-linux-gnu
-	exit 0 ;;
+	exit ;;
     m68*:Linux:*:*)
 	echo ${UNAME_MACHINE}-unknown-linux-gnu
-	exit 0 ;;
-    mips:Linux:*:*)
-	eval $set_cc_for_build
-	sed 's/^	//' &lt;&lt; EOF &gt;$dummy.c
-	#undef CPU
-	#undef mips
-	#undef mipsel
-	#if defined(__MIPSEL__) || defined(__MIPSEL) || defined(_MIPSEL) || defined(MIPSEL)
-	CPU=mipsel
-	#else
-	#if defined(__MIPSEB__) || defined(__MIPSEB) || defined(_MIPSEB) || defined(MIPSEB)
-	CPU=mips
-	#else
-	CPU=
-	#endif
-	#endif
-EOF
-	eval `$CC_FOR_BUILD -E $dummy.c 2&gt;/dev/null | grep ^CPU=`
-	test x&quot;${CPU}&quot; != x &amp;&amp; echo &quot;${CPU}-unknown-linux-gnu&quot; &amp;&amp; exit 0
-	;;
-    mips64:Linux:*:*)
+	exit ;;
+    mips:Linux:*:* | mips64:Linux:*:*)
 	eval $set_cc_for_build
 	sed 's/^	//' &lt;&lt; EOF &gt;$dummy.c
 	#undef CPU
-	#undef mips64
-	#undef mips64el
+	#undef ${UNAME_MACHINE}
+	#undef ${UNAME_MACHINE}el
 	#if defined(__MIPSEL__) || defined(__MIPSEL) || defined(_MIPSEL) || defined(MIPSEL)
-	CPU=mips64el
+	CPU=${UNAME_MACHINE}el
 	#else
 	#if defined(__MIPSEB__) || defined(__MIPSEB) || defined(_MIPSEB) || defined(MIPSEB)
-	CPU=mips64
+	CPU=${UNAME_MACHINE}
 	#else
 	CPU=
 	#endif
 	#endif
 EOF
-	eval `$CC_FOR_BUILD -E $dummy.c 2&gt;/dev/null | grep ^CPU=`
-	test x&quot;${CPU}&quot; != x &amp;&amp; echo &quot;${CPU}-unknown-linux-gnu&quot; &amp;&amp; exit 0
+	eval `$CC_FOR_BUILD -E $dummy.c 2&gt;/dev/null | grep '^CPU'`
+	test x&quot;${CPU}&quot; != x &amp;&amp; { echo &quot;${CPU}-unknown-linux-gnu&quot;; exit; }
 	;;
-    ppc:Linux:*:*)
-	echo powerpc-unknown-linux-gnu
-	exit 0 ;;
-    ppc64:Linux:*:*)
-	echo powerpc64-unknown-linux-gnu
-	exit 0 ;;
-    alpha:Linux:*:*)
-	case `sed -n '/^cpu model/s/^.*: \(.*\)/\1/p' &lt; /proc/cpuinfo` in
-	  EV5)   UNAME_MACHINE=alphaev5 ;;
-	  EV56)  UNAME_MACHINE=alphaev56 ;;
-	  PCA56) UNAME_MACHINE=alphapca56 ;;
-	  PCA57) UNAME_MACHINE=alphapca56 ;;
-	  EV6)   UNAME_MACHINE=alphaev6 ;;
-	  EV67)  UNAME_MACHINE=alphaev67 ;;
-	  EV68*) UNAME_MACHINE=alphaev68 ;;
-        esac
-	objdump --private-headers /bin/sh | grep ld.so.1 &gt;/dev/null
-	if test &quot;$?&quot; = 0 ; then LIBC=&quot;libc1&quot; ; else LIBC=&quot;&quot; ; fi
-	echo ${UNAME_MACHINE}-unknown-linux-gnu${LIBC}
-	exit 0 ;;
+    or32:Linux:*:*)
+	echo or32-unknown-linux-gnu
+	exit ;;
+    padre:Linux:*:*)
+	echo sparc-unknown-linux-gnu
+	exit ;;
+    parisc64:Linux:*:* | hppa64:Linux:*:*)
+	echo hppa64-unknown-linux-gnu
+	exit ;;
     parisc:Linux:*:* | hppa:Linux:*:*)
 	# Look for CPU level
 	case `grep '^cpu[^a-z]*:' /proc/cpuinfo 2&gt;/dev/null | cut -d' ' -f2` in
@@ -910,87 +949,40 @@ EOF
 	  PA8*) echo hppa2.0-unknown-linux-gnu ;;
 	  *)    echo hppa-unknown-linux-gnu ;;
 	esac
-	exit 0 ;;
-    parisc64:Linux:*:* | hppa64:Linux:*:*)
-	echo hppa64-unknown-linux-gnu
-	exit 0 ;;
+	exit ;;
+    ppc64:Linux:*:*)
+	echo powerpc64-unknown-linux-gnu
+	exit ;;
+    ppc:Linux:*:*)
+	echo powerpc-unknown-linux-gnu
+	exit ;;
     s390:Linux:*:* | s390x:Linux:*:*)
 	echo ${UNAME_MACHINE}-ibm-linux
-	exit 0 ;;
+	exit ;;
     sh64*:Linux:*:*)
     	echo ${UNAME_MACHINE}-unknown-linux-gnu
-	exit 0 ;;
+	exit ;;
     sh*:Linux:*:*)
 	echo ${UNAME_MACHINE}-unknown-linux-gnu
-	exit 0 ;;
+	exit ;;
     sparc:Linux:*:* | sparc64:Linux:*:*)
 	echo ${UNAME_MACHINE}-unknown-linux-gnu
-	exit 0 ;;
+	exit ;;
+    vax:Linux:*:*)
+	echo ${UNAME_MACHINE}-dec-linux-gnu
+	exit ;;
     x86_64:Linux:*:*)
 	echo x86_64-unknown-linux-gnu
-	exit 0 ;;
-    i*86:Linux:*:*)
-	# The BFD linker knows what the default object file format is, so
-	# first see if it will tell us. cd to the root directory to prevent
-	# problems with other programs or directories called `ld' in the path.
-	# Set LC_ALL=C to ensure ld outputs messages in English.
-	ld_supported_targets=`cd /; LC_ALL=C ld --help 2&gt;&amp;1 \
-			 | sed -ne '/supported targets:/!d
-				    s/[ 	][ 	]*/ /g
-				    s/.*supported targets: *//
-				    s/ .*//
-				    p'`
-        case &quot;$ld_supported_targets&quot; in
-	  elf32-i386)
-		TENTATIVE=&quot;${UNAME_MACHINE}-pc-linux-gnu&quot;
-		;;
-	  a.out-i386-linux)
-		echo &quot;${UNAME_MACHINE}-pc-linux-gnuaout&quot;
-		exit 0 ;;
-	  coff-i386)
-		echo &quot;${UNAME_MACHINE}-pc-linux-gnucoff&quot;
-		exit 0 ;;
-	  &quot;&quot;)
-		# Either a pre-BFD a.out linker (linux-gnuoldld) or
-		# one that does not give us useful --help.
-		echo &quot;${UNAME_MACHINE}-pc-linux-gnuoldld&quot;
-		exit 0 ;;
-	esac
-	# Determine whether the default compiler is a.out or elf
-	eval $set_cc_for_build
-	sed 's/^	//' &lt;&lt; EOF &gt;$dummy.c
-	#include &lt;features.h&gt;
-	#ifdef __ELF__
-	# ifdef __GLIBC__
-	#  if __GLIBC__ &gt;= 2
-	LIBC=gnu
-	#  else
-	LIBC=gnulibc1
-	#  endif
-	# else
-	LIBC=gnulibc1
-	# endif
-	#else
-	#ifdef __INTEL_COMPILER
-	LIBC=gnu
-	#else
-	LIBC=gnuaout
-	#endif
-	#endif
-	#ifdef __dietlibc__
-	LIBC=dietlibc
-	#endif
-EOF
-	eval `$CC_FOR_BUILD -E $dummy.c 2&gt;/dev/null | grep ^LIBC=`
-	test x&quot;${LIBC}&quot; != x &amp;&amp; echo &quot;${UNAME_MACHINE}-pc-linux-${LIBC}&quot; &amp;&amp; exit 0
-	test x&quot;${TENTATIVE}&quot; != x &amp;&amp; echo &quot;${TENTATIVE}&quot; &amp;&amp; exit 0
-	;;
+	exit ;;
+    xtensa*:Linux:*:*)
+    	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	exit ;;
     i*86:DYNIX/ptx:4*:*)
 	# ptx 4.0 does uname -s correctly, with DYNIX/ptx in there.
 	# earlier versions are messed up and put the nodename in both
 	# sysname and nodename.
 	echo i386-sequent-sysv4
-	exit 0 ;;
+	exit ;;
     i*86:UNIX_SV:4.2MP:2.*)
         # Unixware is an offshoot of SVR4, but it has its own version
         # number series starting with 2...
@@ -998,27 +990,27 @@ EOF
 	# I just have to hope.  -- rms.
         # Use sysv4.2uw... so that sysv4* matches it.
 	echo ${UNAME_MACHINE}-pc-sysv4.2uw${UNAME_VERSION}
-	exit 0 ;;
+	exit ;;
     i*86:OS/2:*:*)
 	# If we were able to find `uname', then EMX Unix compatibility
 	# is probably installed.
 	echo ${UNAME_MACHINE}-pc-os2-emx
-	exit 0 ;;
+	exit ;;
     i*86:XTS-300:*:STOP)
 	echo ${UNAME_MACHINE}-unknown-stop
-	exit 0 ;;
+	exit ;;
     i*86:atheos:*:*)
 	echo ${UNAME_MACHINE}-unknown-atheos
-	exit 0 ;;
-	i*86:syllable:*:*)
+	exit ;;
+    i*86:syllable:*:*)
 	echo ${UNAME_MACHINE}-pc-syllable
-	exit 0 ;;
-    i*86:LynxOS:2.*:* | i*86:LynxOS:3.[01]*:* | i*86:LynxOS:4.0*:*)
+	exit ;;
+    i*86:LynxOS:2.*:* | i*86:LynxOS:3.[01]*:* | i*86:LynxOS:4.[02]*:*)
 	echo i386-unknown-lynxos${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     i*86:*DOS:*:*)
 	echo ${UNAME_MACHINE}-pc-msdosdjgpp
-	exit 0 ;;
+	exit ;;
     i*86:*:4.*:* | i*86:SYSTEM_V:4.*:*)
 	UNAME_REL=`echo ${UNAME_RELEASE} | sed 's/\/MP$//'`
 	if grep Novell /usr/include/link.h &gt;/dev/null 2&gt;/dev/null; then
@@ -1026,15 +1018,16 @@ EOF
 	else
 		echo ${UNAME_MACHINE}-pc-sysv${UNAME_REL}
 	fi
-	exit 0 ;;
-    i*86:*:5:[78]*)
+	exit ;;
+    i*86:*:5:[678]*)
+    	# UnixWare 7.x, OpenUNIX and OpenServer 6.
 	case `/bin/uname -X | grep &quot;^Machine&quot;` in
 	    *486*)	     UNAME_MACHINE=i486 ;;
 	    *Pentium)	     UNAME_MACHINE=i586 ;;
 	    *Pent*|*Celeron) UNAME_MACHINE=i686 ;;
 	esac
 	echo ${UNAME_MACHINE}-unknown-sysv${UNAME_RELEASE}${UNAME_SYSTEM}${UNAME_VERSION}
-	exit 0 ;;
+	exit ;;
     i*86:*:3.2:*)
 	if test -f /usr/options/cb.name; then
 		UNAME_REL=`sed -n 's/.*Version //p' &lt;/usr/options/cb.name`
@@ -1052,73 +1045,86 @@ EOF
 	else
 		echo ${UNAME_MACHINE}-pc-sysv32
 	fi
-	exit 0 ;;
+	exit ;;
     pc:*:*:*)
 	# Left here for compatibility:
         # uname -m prints for DJGPP always 'pc', but it prints nothing about
-        # the processor, so we play safe by assuming i386.
-	echo i386-pc-msdosdjgpp
-        exit 0 ;;
+        # the processor, so we play safe by assuming i586.
+	# Note: whatever this is, it MUST be the same as what config.sub
+	# prints for the &quot;djgpp&quot; host, or else GDB configury will decide that
+	# this is a cross-build.
+	echo i586-pc-msdosdjgpp
+        exit ;;
     Intel:Mach:3*:*)
 	echo i386-pc-mach3
-	exit 0 ;;
+	exit ;;
     paragon:*:*:*)
 	echo i860-intel-osf1
-	exit 0 ;;
+	exit ;;
     i860:*:4.*:*) # i860-SVR4
 	if grep Stardent /usr/include/sys/uadmin.h &gt;/dev/null 2&gt;&amp;1 ; then
 	  echo i860-stardent-sysv${UNAME_RELEASE} # Stardent Vistra i860-SVR4
 	else # Add other i860-SVR4 vendors below as they are discovered.
 	  echo i860-unknown-sysv${UNAME_RELEASE}  # Unknown i860-SVR4
 	fi
-	exit 0 ;;
+	exit ;;
     mini*:CTIX:SYS*5:*)
 	# &quot;miniframe&quot;
 	echo m68010-convergent-sysv
-	exit 0 ;;
+	exit ;;
     mc68k:UNIX:SYSTEM5:3.51m)
 	echo m68k-convergent-sysv
-	exit 0 ;;
+	exit ;;
     M680?0:D-NIX:5.3:*)
 	echo m68k-diab-dnix
-	exit 0 ;;
+	exit ;;
     M68*:*:R3V[5678]*:*)
-	test -r /sysV68 &amp;&amp; echo 'm68k-motorola-sysv' &amp;&amp; exit 0 ;;
+	test -r /sysV68 &amp;&amp; { echo 'm68k-motorola-sysv'; exit; } ;;
     3[345]??:*:4.0:3.0 | 3[34]??A:*:4.0:3.0 | 3[34]??,*:*:4.0:3.0 | 3[34]??/*:*:4.0:3.0 | 4400:*:4.0:3.0 | 4850:*:4.0:3.0 | SKA40:*:4.0:3.0 | SDS2:*:4.0:3.0 | SHG2:*:4.0:3.0 | S7501*:*:4.0:3.0)
 	OS_REL=''
 	test -r /etc/.relid \
 	&amp;&amp; OS_REL=.`sed -n 's/[^ ]* [^ ]* \([0-9][0-9]\).*/\1/p' &lt; /etc/.relid`
 	/bin/uname -p 2&gt;/dev/null | grep 86 &gt;/dev/null \
-	  &amp;&amp; echo i486-ncr-sysv4.3${OS_REL} &amp;&amp; exit 0
+	  &amp;&amp; { echo i486-ncr-sysv4.3${OS_REL}; exit; }
 	/bin/uname -p 2&gt;/dev/null | /bin/grep entium &gt;/dev/null \
-	  &amp;&amp; echo i586-ncr-sysv4.3${OS_REL} &amp;&amp; exit 0 ;;
+	  &amp;&amp; { echo i586-ncr-sysv4.3${OS_REL}; exit; } ;;
     3[34]??:*:4.0:* | 3[34]??,*:*:4.0:*)
         /bin/uname -p 2&gt;/dev/null | grep 86 &gt;/dev/null \
-          &amp;&amp; echo i486-ncr-sysv4 &amp;&amp; exit 0 ;;
+          &amp;&amp; { echo i486-ncr-sysv4; exit; } ;;
+    NCR*:*:4.2:* | MPRAS*:*:4.2:*)
+	OS_REL='.3'
+	test -r /etc/.relid \
+	    &amp;&amp; OS_REL=.`sed -n 's/[^ ]* [^ ]* \([0-9][0-9]\).*/\1/p' &lt; /etc/.relid`
+	/bin/uname -p 2&gt;/dev/null | grep 86 &gt;/dev/null \
+	    &amp;&amp; { echo i486-ncr-sysv4.3${OS_REL}; exit; }
+	/bin/uname -p 2&gt;/dev/null | /bin/grep entium &gt;/dev/null \
+	    &amp;&amp; { echo i586-ncr-sysv4.3${OS_REL}; exit; }
+	/bin/uname -p 2&gt;/dev/null | /bin/grep pteron &gt;/dev/null \
+	    &amp;&amp; { echo i586-ncr-sysv4.3${OS_REL}; exit; } ;;
     m68*:LynxOS:2.*:* | m68*:LynxOS:3.0*:*)
 	echo m68k-unknown-lynxos${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     mc68030:UNIX_System_V:4.*:*)
 	echo m68k-atari-sysv4
-	exit 0 ;;
+	exit ;;
     TSUNAMI:LynxOS:2.*:*)
 	echo sparc-unknown-lynxos${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     rs6000:LynxOS:2.*:*)
 	echo rs6000-unknown-lynxos${UNAME_RELEASE}
-	exit 0 ;;
-    PowerPC:LynxOS:2.*:* | PowerPC:LynxOS:3.[01]*:* | PowerPC:LynxOS:4.0*:*)
+	exit ;;
+    PowerPC:LynxOS:2.*:* | PowerPC:LynxOS:3.[01]*:* | PowerPC:LynxOS:4.[02]*:*)
 	echo powerpc-unknown-lynxos${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     SM[BE]S:UNIX_SV:*:*)
 	echo mips-dde-sysv${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     RM*:ReliantUNIX-*:*:*)
 	echo mips-sni-sysv4
-	exit 0 ;;
+	exit ;;
     RM*:SINIX-*:*:*)
 	echo mips-sni-sysv4
-	exit 0 ;;
+	exit ;;
     *:SINIX-*:*:*)
 	if uname -p 2&gt;/dev/null &gt;/dev/null ; then
 		UNAME_MACHINE=`(uname -p) 2&gt;/dev/null`
@@ -1126,69 +1132,94 @@ EOF
 	else
 		echo ns32k-sni-sysv
 	fi
-	exit 0 ;;
+	exit ;;
     PENTIUM:*:4.0*:*) # Unisys `ClearPath HMP IX 4000' SVR4/MP effort
                       # says &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">Richard.M.Bartel at ccMail.Census.GOV</A>&gt;
         echo i586-unisys-sysv4
-        exit 0 ;;
+        exit ;;
     *:UNIX_System_V:4*:FTX*)
 	# From Gerald Hewes &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">hewes at openmarket.com</A>&gt;.
 	# How about differentiating between stratus architectures? -djm
 	echo hppa1.1-stratus-sysv4
-	exit 0 ;;
+	exit ;;
     *:*:*:FTX*)
 	# From <A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">seanf at swdc.stratus.com.</A>
 	echo i860-stratus-sysv4
-	exit 0 ;;
+	exit ;;
+    i*86:VOS:*:*)
+	# From <A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">Paul.Green at stratus.com.</A>
+	echo ${UNAME_MACHINE}-stratus-vos
+	exit ;;
     *:VOS:*:*)
 	# From <A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">Paul.Green at stratus.com.</A>
 	echo hppa1.1-stratus-vos
-	exit 0 ;;
+	exit ;;
     mc68*:A/UX:*:*)
 	echo m68k-apple-aux${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     news*:NEWS-OS:6*:*)
 	echo mips-sony-newsos6
-	exit 0 ;;
+	exit ;;
     R[34]000:*System_V*:*:* | R4000:UNIX_SYSV:*:* | R*000:UNIX_SV:*:*)
 	if [ -d /usr/nec ]; then
 	        echo mips-nec-sysv${UNAME_RELEASE}
 	else
 	        echo mips-unknown-sysv${UNAME_RELEASE}
 	fi
-        exit 0 ;;
+        exit ;;
     BeBox:BeOS:*:*)	# BeOS running on hardware made by Be, PPC only.
 	echo powerpc-be-beos
-	exit 0 ;;
+	exit ;;
     BeMac:BeOS:*:*)	# BeOS running on Mac or Mac clone, PPC only.
 	echo powerpc-apple-beos
-	exit 0 ;;
+	exit ;;
     BePC:BeOS:*:*)	# BeOS running on Intel PC compatible.
 	echo i586-pc-beos
-	exit 0 ;;
+	exit ;;
+    BePC:Haiku:*:*)	# Haiku running on Intel PC compatible.
+	echo i586-pc-haiku
+	exit ;;
     SX-4:SUPER-UX:*:*)
 	echo sx4-nec-superux${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     SX-5:SUPER-UX:*:*)
 	echo sx5-nec-superux${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     SX-6:SUPER-UX:*:*)
 	echo sx6-nec-superux${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
+    SX-7:SUPER-UX:*:*)
+	echo sx7-nec-superux${UNAME_RELEASE}
+	exit ;;
+    SX-8:SUPER-UX:*:*)
+	echo sx8-nec-superux${UNAME_RELEASE}
+	exit ;;
+    SX-8R:SUPER-UX:*:*)
+	echo sx8r-nec-superux${UNAME_RELEASE}
+	exit ;;
     Power*:Rhapsody:*:*)
 	echo powerpc-apple-rhapsody${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     *:Rhapsody:*:*)
 	echo ${UNAME_MACHINE}-apple-rhapsody${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     *:Darwin:*:*)
 	UNAME_PROCESSOR=`uname -p` || UNAME_PROCESSOR=unknown
 	case $UNAME_PROCESSOR in
-	    *86) UNAME_PROCESSOR=i686 ;;
+	    i386)
+		eval $set_cc_for_build
+		if [ &quot;$CC_FOR_BUILD&quot; != 'no_compiler_found' ]; then
+		  if (echo '#ifdef __LP64__'; echo IS_64BIT_ARCH; echo '#endif') | \
+		      (CCOPTS= $CC_FOR_BUILD -E - 2&gt;/dev/null) | \
+		      grep IS_64BIT_ARCH &gt;/dev/null
+		  then
+		      UNAME_PROCESSOR=&quot;x86_64&quot;
+		  fi
+		fi ;;
 	    unknown) UNAME_PROCESSOR=powerpc ;;
 	esac
 	echo ${UNAME_PROCESSOR}-apple-darwin${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     *:procnto*:*:* | *:QNX:[0123456789]*:*)
 	UNAME_PROCESSOR=`uname -p`
 	if test &quot;$UNAME_PROCESSOR&quot; = &quot;x86&quot;; then
@@ -1196,25 +1227,25 @@ EOF
 		UNAME_MACHINE=pc
 	fi
 	echo ${UNAME_PROCESSOR}-${UNAME_MACHINE}-nto-qnx${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     *:QNX:*:4*)
 	echo i386-pc-qnx
-	exit 0 ;;
+	exit ;;
     NSE-?:NONSTOP_KERNEL:*:*)
 	echo nse-tandem-nsk${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     NSR-?:NONSTOP_KERNEL:*:*)
 	echo nsr-tandem-nsk${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     *:NonStop-UX:*:*)
 	echo mips-compaq-nonstopux
-	exit 0 ;;
+	exit ;;
     BS2000:POSIX*:*:*)
 	echo bs2000-siemens-sysv
-	exit 0 ;;
+	exit ;;
     DS/*:UNIX_System_V:*:*)
 	echo ${UNAME_MACHINE}-${UNAME_SYSTEM}-${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     *:Plan9:*:*)
 	# &quot;uname -m&quot; is not consistent, so use $cputype instead. 386
 	# is converted to i386 for consistency with other x86
@@ -1225,41 +1256,50 @@ EOF
 	    UNAME_MACHINE=&quot;$cputype&quot;
 	fi
 	echo ${UNAME_MACHINE}-unknown-plan9
-	exit 0 ;;
+	exit ;;
     *:TOPS-10:*:*)
 	echo pdp10-unknown-tops10
-	exit 0 ;;
+	exit ;;
     *:TENEX:*:*)
 	echo pdp10-unknown-tenex
-	exit 0 ;;
+	exit ;;
     KS10:TOPS-20:*:* | KL10:TOPS-20:*:* | TYPE4:TOPS-20:*:*)
 	echo pdp10-dec-tops20
-	exit 0 ;;
+	exit ;;
     XKL-1:TOPS-20:*:* | TYPE5:TOPS-20:*:*)
 	echo pdp10-xkl-tops20
-	exit 0 ;;
+	exit ;;
     *:TOPS-20:*:*)
 	echo pdp10-unknown-tops20
-	exit 0 ;;
+	exit ;;
     *:ITS:*:*)
 	echo pdp10-unknown-its
-	exit 0 ;;
+	exit ;;
     SEI:*:*:SEIUX)
         echo mips-sei-seiux${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     *:DragonFly:*:*)
 	echo ${UNAME_MACHINE}-unknown-dragonfly`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'`
-	exit 0 ;;
+	exit ;;
     *:*VMS:*:*)
     	UNAME_MACHINE=`(uname -p) 2&gt;/dev/null`
 	case &quot;${UNAME_MACHINE}&quot; in
-	    A*) echo alpha-dec-vms &amp;&amp; exit 0 ;;
-	    I*) echo ia64-dec-vms &amp;&amp; exit 0 ;;
-	    V*) echo vax-dec-vms &amp;&amp; exit 0 ;;
+	    A*) echo alpha-dec-vms ; exit ;;
+	    I*) echo ia64-dec-vms ; exit ;;
+	    V*) echo vax-dec-vms ; exit ;;
 	esac ;;
     *:XENIX:*:SysV)
 	echo i386-pc-xenix
-	exit 0 ;;
+	exit ;;
+    i*86:skyos:*:*)
+	echo ${UNAME_MACHINE}-pc-skyos`echo ${UNAME_RELEASE}` | sed -e 's/ .*$//'
+	exit ;;
+    i*86:rdos:*:*)
+	echo ${UNAME_MACHINE}-pc-rdos
+	exit ;;
+    i*86:AROS:*:*)
+	echo ${UNAME_MACHINE}-pc-aros
+	exit ;;
 esac
 
 #echo '(No uname command or uname output not recognized.)' 1&gt;&amp;2
@@ -1291,7 +1331,7 @@ main ()
 #endif
 
 #if defined (__arm) &amp;&amp; defined (__acorn) &amp;&amp; defined (__unix)
-  printf (&quot;arm-acorn-riscix&quot;); exit (0);
+  printf (&quot;arm-acorn-riscix\n&quot;); exit (0);
 #endif
 
 #if defined (hp300) &amp;&amp; !defined (hpux)
@@ -1380,11 +1420,12 @@ main ()
 }
 EOF
 
-$CC_FOR_BUILD -o $dummy $dummy.c 2&gt;/dev/null &amp;&amp; $dummy &amp;&amp; exit 0
+$CC_FOR_BUILD -o $dummy $dummy.c 2&gt;/dev/null &amp;&amp; SYSTEM_NAME=`$dummy` &amp;&amp;
+	{ echo &quot;$SYSTEM_NAME&quot;; exit; }
 
 # Apollos put the system type in the environment.
 
-test -d /usr/apollo &amp;&amp; { echo ${ISP}-apollo-${SYSTYPE}; exit 0; }
+test -d /usr/apollo &amp;&amp; { echo ${ISP}-apollo-${SYSTYPE}; exit; }
 
 # Convex versions that predate uname can use getsysinfo(1)
 
@@ -1393,22 +1434,22 @@ then
     case `getsysinfo -f cpu_type` in
     c1*)
 	echo c1-convex-bsd
-	exit 0 ;;
+	exit ;;
     c2*)
 	if getsysinfo -f scalar_acc
 	then echo c32-convex-bsd
 	else echo c2-convex-bsd
 	fi
-	exit 0 ;;
+	exit ;;
     c34*)
 	echo c34-convex-bsd
-	exit 0 ;;
+	exit ;;
     c38*)
 	echo c38-convex-bsd
-	exit 0 ;;
+	exit ;;
     c4*)
 	echo c4-convex-bsd
-	exit 0 ;;
+	exit ;;
     esac
 fi
 
@@ -1419,9 +1460,9 @@ This script, last modified $timestamp, has failed to recognize
 the operating system you are using. It is advised that you
 download the most up to date version of the config scripts from
 
-  <A HREF="http://savannah.gnu.org/cgi-bin/viewcvs/*checkout*/config/config/config.guess">http://savannah.gnu.org/cgi-bin/viewcvs/*checkout*/config/config/config.guess</A>
+  <A HREF="http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.guess;hb=HEAD">http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.guess;hb=HEAD</A>
 and
-  <A HREF="http://savannah.gnu.org/cgi-bin/viewcvs/*checkout*/config/config/config.sub">http://savannah.gnu.org/cgi-bin/viewcvs/*checkout*/config/config/config.sub</A>
+  <A HREF="http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.sub;hb=HEAD">http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.sub;hb=HEAD</A>
 
 If the version you run ($0) is already up to date, please
 send the following data and any information you think might be
diff --git a/nx-X11/extras/fontconfig/config.sub b/nx-X11/extras/fontconfig/config.sub
index d8fd2f8..c2d1257 100755
--- a/nx-X11/extras/fontconfig/config.sub
+++ b/nx-X11/extras/fontconfig/config.sub
@@ -1,9 +1,10 @@
 #! /bin/sh
 # Configuration validation subroutine script.
 #   Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999,
-#   2000, 2001, 2002, 2003, 2004, 2005 Free Software Foundation, Inc.
+#   2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010
+#   Free Software Foundation, Inc.
 
-timestamp='2005-02-10'
+timestamp='2010-01-22'
 
 # This file is (in principle) common to ALL GNU software.
 # The presence of a machine in this file suggests that SOME GNU software
@@ -21,22 +22,26 @@ timestamp='2005-02-10'
 #
 # You should have received a copy of the GNU General Public License
 # along with this program; if not, write to the Free Software
-# Foundation, Inc., 59 Temple Place - Suite 330,
-# Boston, MA 02111-1307, USA.
-
+# Foundation, Inc., 51 Franklin Street - Fifth Floor, Boston, MA
+# 02110-1301, USA.
+#
 # As a special exception to the GNU General Public License, if you
 # distribute this file as part of a program that contains a
 # configuration script generated by Autoconf, you may include it under
 # the same distribution terms that you use for the rest of that program.
 
+
 # Please send patches to &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">config-patches at gnu.org</A>&gt;.  Submit a context
-# diff and a properly formatted ChangeLog entry.
+# diff and a properly formatted GNU ChangeLog entry.
 #
 # Configuration subroutine to validate and canonicalize a configuration type.
 # Supply the specified configuration type as an argument.
 # If it is invalid, we print an error message on stderr and exit with code 1.
 # Otherwise, we print the canonical config type on stdout and succeed.
 
+# You can get the latest version of this script from:
+# <A HREF="http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.sub;hb=HEAD">http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.sub;hb=HEAD</A>
+
 # This file is supposed to be the same for all GNU packages
 # and recognize all the CPU types, system types and aliases
 # that are meaningful with *any* GNU software.
@@ -70,8 +75,9 @@ Report bugs and patches to &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">config-patches at gnu.org</A>&gt;.&quot;
 version=&quot;\
 GNU config.sub ($timestamp)
 
-Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005
-Free Software Foundation, Inc.
+Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000,
+2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010 Free
+Software Foundation, Inc.
 
 This is free software; see the source for copying conditions.  There is NO
 warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&quot;
@@ -83,11 +89,11 @@ Try \`$me --help' for more information.&quot;
 while test $# -gt 0 ; do
   case $1 in
     --time-stamp | --time* | -t )
-       echo &quot;$timestamp&quot; ; exit 0 ;;
+       echo &quot;$timestamp&quot; ; exit ;;
     --version | -v )
-       echo &quot;$version&quot; ; exit 0 ;;
+       echo &quot;$version&quot; ; exit ;;
     --help | --h* | -h )
-       echo &quot;$usage&quot;; exit 0 ;;
+       echo &quot;$usage&quot;; exit ;;
     -- )     # Stop option processing
        shift; break ;;
     - )	# Use stdin as input.
@@ -99,7 +105,7 @@ while test $# -gt 0 ; do
     *local*)
        # First pass through any local machine types.
        echo $1
-       exit 0;;
+       exit ;;
 
     * )
        break ;;
@@ -118,8 +124,10 @@ esac
 # Here we must recognize all the valid KERNEL-OS combinations.
 maybe_os=`echo $1 | sed 's/^\(.*\)-\([^-]*-[^-]*\)$/\2/'`
 case $maybe_os in
-  nto-qnx* | linux-gnu* | linux-dietlibc | linux-uclibc* | uclinux-uclibc* | uclinux-gnu* | \
-  kfreebsd*-gnu* | knetbsd*-gnu* | netbsd*-gnu* | storm-chaos* | os2-emx* | rtmk-nova*)
+  nto-qnx* | linux-gnu* | linux-dietlibc | linux-newlib* | linux-uclibc* | \
+  uclinux-uclibc* | uclinux-gnu* | kfreebsd*-gnu* | knetbsd*-gnu* | netbsd*-gnu* | \
+  kopensolaris*-gnu* | \
+  storm-chaos* | os2-emx* | rtmk-nova*)
     os=-$maybe_os
     basic_machine=`echo $1 | sed 's/^\(.*\)-\([^-]*-[^-]*\)$/\1/'`
     ;;
@@ -145,10 +153,13 @@ case $os in
 	-convergent* | -ncr* | -news | -32* | -3600* | -3100* | -hitachi* |\
 	-c[123]* | -convex* | -sun | -crds | -omron* | -dg | -ultra | -tti* | \
 	-harris | -dolphin | -highlevel | -gould | -cbm | -ns | -masscomp | \
-	-apple | -axis | -knuth | -cray)
+	-apple | -axis | -knuth | -cray | -microblaze)
 		os=
 		basic_machine=$1
 		;;
+        -bluegene*)
+	        os=-cnk
+		;;
 	-sim | -cisco | -oki | -wec | -winbond)
 		os=
 		basic_machine=$1
@@ -170,6 +181,10 @@ case $os in
 	-hiux*)
 		os=-hiuxwe2
 		;;
+	-sco6)
+		os=-sco5v6
+		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
+		;;
 	-sco5)
 		os=-sco3.2v5
 		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
@@ -186,6 +201,10 @@ case $os in
 		# Don't forget version if it is 3.2v4 or newer.
 		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
 		;;
+	-sco5v6*)
+		# Don't forget version if it is 3.2v4 or newer.
+		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
+		;;
 	-sco*)
 		os=-sco3.2v2
 		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
@@ -230,22 +249,28 @@ case $basic_machine in
 	| alpha | alphaev[4-8] | alphaev56 | alphaev6[78] | alphapca5[67] \
 	| alpha64 | alpha64ev[4-8] | alpha64ev56 | alpha64ev6[78] | alpha64pca5[67] \
 	| am33_2.0 \
-	| arc | arm | arm[bl]e | arme[lb] | armv[2345] | armv[345][lb] | avr \
+	| arc | arm | arm[bl]e | arme[lb] | armv[2345] | armv[345][lb] | avr | avr32 \
+	| bfin \
 	| c4x | clipper \
 	| d10v | d30v | dlx | dsp16xx \
-	| fr30 | frv \
+	| fido | fr30 | frv \
 	| h8300 | h8500 | hppa | hppa1.[01] | hppa2.0 | hppa2.0[nw] | hppa64 \
 	| i370 | i860 | i960 | ia64 \
 	| ip2k | iq2000 \
-	| m32r | m32rle | m68000 | m68k | m88k | maxq | mcore \
+	| lm32 \
+	| m32c | m32r | m32rle | m68000 | m68k | m88k \
+	| maxq | mb | microblaze | mcore | mep | metag \
 	| mips | mipsbe | mipseb | mipsel | mipsle \
 	| mips16 \
 	| mips64 | mips64el \
-	| mips64vr | mips64vrel \
+	| mips64octeon | mips64octeonel \
 	| mips64orion | mips64orionel \
+	| mips64r5900 | mips64r5900el \
+	| mips64vr | mips64vrel \
 	| mips64vr4100 | mips64vr4100el \
 	| mips64vr4300 | mips64vr4300el \
 	| mips64vr5000 | mips64vr5000el \
+	| mips64vr5900 | mips64vr5900el \
 	| mipsisa32 | mipsisa32el \
 	| mipsisa32r2 | mipsisa32r2el \
 	| mipsisa64 | mipsisa64el \
@@ -254,30 +279,40 @@ case $basic_machine in
 	| mipsisa64sr71k | mipsisa64sr71kel \
 	| mipstx39 | mipstx39el \
 	| mn10200 | mn10300 \
+	| moxie \
+	| mt \
 	| msp430 \
+	| nios | nios2 \
 	| ns16k | ns32k \
-	| openrisc | or32 \
+	| or32 \
 	| pdp10 | pdp11 | pj | pjl \
 	| powerpc | powerpc64 | powerpc64le | powerpcle | ppcbe \
 	| pyramid \
-	| sh | sh[1234] | sh[23]e | sh[34]eb | shbe | shle | sh[1234]le | sh3ele \
+	| rx \
+	| score \
+	| sh | sh[1234] | sh[24]a | sh[24]aeb | sh[23]e | sh[34]eb | sheb | shbe | shle | sh[1234]le | sh3ele \
 	| sh64 | sh64le \
-	| sparc | sparc64 | sparc86x | sparclet | sparclite | sparcv8 | sparcv9 | sparcv9b \
-	| strongarm \
+	| sparc | sparc64 | sparc64b | sparc64v | sparc86x | sparclet | sparclite \
+	| sparcv8 | sparcv9 | sparcv9b | sparcv9v \
+	| spu | strongarm \
 	| tahoe | thumb | tic4x | tic80 | tron \
+	| ubicom32 \
 	| v850 | v850e \
 	| we32k \
-	| x86 | xscale | xscalee[bl] | xstormy16 | xtensa \
-	| z8k)
+	| x86 | xc16x | xscale | xscalee[bl] | xstormy16 | xtensa \
+	| z8k | z80)
 		basic_machine=$basic_machine-unknown
 		;;
-	m6811 | m68hc11 | m6812 | m68hc12)
+	m6811 | m68hc11 | m6812 | m68hc12 | picochip)
 		# Motorola 68HC11/12.
 		basic_machine=$basic_machine-unknown
 		os=-none
 		;;
 	m88110 | m680[12346]0 | m683?2 | m68360 | m5200 | v70 | w65 | z8k)
 		;;
+	ms1)
+		basic_machine=mt-unknown
+		;;
 
 	# We use `pc' rather than `unknown'
 	# because (1) that's what they normally are, and
@@ -297,28 +332,32 @@ case $basic_machine in
 	| alpha64-* | alpha64ev[4-8]-* | alpha64ev56-* | alpha64ev6[78]-* \
 	| alphapca5[67]-* | alpha64pca5[67]-* | arc-* \
 	| arm-*  | armbe-* | armle-* | armeb-* | armv*-* \
-	| avr-* \
-	| bs2000-* \
+	| avr-* | avr32-* \
+	| bfin-* | bs2000-* \
 	| c[123]* | c30-* | [cjt]90-* | c4x-* | c54x-* | c55x-* | c6x-* \
 	| clipper-* | craynv-* | cydra-* \
 	| d10v-* | d30v-* | dlx-* \
 	| elxsi-* \
-	| f30[01]-* | f700-* | fr30-* | frv-* | fx80-* \
+	| f30[01]-* | f700-* | fido-* | fr30-* | frv-* | fx80-* \
 	| h8300-* | h8500-* \
 	| hppa-* | hppa1.[01]-* | hppa2.0-* | hppa2.0[nw]-* | hppa64-* \
 	| i*86-* | i860-* | i960-* | ia64-* \
 	| ip2k-* | iq2000-* \
-	| m32r-* | m32rle-* \
+	| lm32-* \
+	| m32c-* | m32r-* | m32rle-* \
 	| m68000-* | m680[012346]0-* | m68360-* | m683?2-* | m68k-* \
-	| m88110-* | m88k-* | maxq-* | mcore-* \
+	| m88110-* | m88k-* | maxq-* | mcore-* | metag-* | microblaze-* \
 	| mips-* | mipsbe-* | mipseb-* | mipsel-* | mipsle-* \
 	| mips16-* \
 	| mips64-* | mips64el-* \
-	| mips64vr-* | mips64vrel-* \
+	| mips64octeon-* | mips64octeonel-* \
 	| mips64orion-* | mips64orionel-* \
+	| mips64r5900-* | mips64r5900el-* \
+	| mips64vr-* | mips64vrel-* \
 	| mips64vr4100-* | mips64vr4100el-* \
 	| mips64vr4300-* | mips64vr4300el-* \
 	| mips64vr5000-* | mips64vr5000el-* \
+	| mips64vr5900-* | mips64vr5900el-* \
 	| mipsisa32-* | mipsisa32el-* \
 	| mipsisa32r2-* | mipsisa32r2el-* \
 	| mipsisa64-* | mipsisa64el-* \
@@ -327,26 +366,35 @@ case $basic_machine in
 	| mipsisa64sr71k-* | mipsisa64sr71kel-* \
 	| mipstx39-* | mipstx39el-* \
 	| mmix-* \
+	| mt-* \
 	| msp430-* \
+	| nios-* | nios2-* \
 	| none-* | np1-* | ns16k-* | ns32k-* \
 	| orion-* \
 	| pdp10-* | pdp11-* | pj-* | pjl-* | pn-* | power-* \
 	| powerpc-* | powerpc64-* | powerpc64le-* | powerpcle-* | ppcbe-* \
 	| pyramid-* \
-	| romp-* | rs6000-* \
-	| sh-* | sh[1234]-* | sh[23]e-* | sh[34]eb-* | shbe-* \
+	| romp-* | rs6000-* | rx-* \
+	| sh-* | sh[1234]-* | sh[24]a-* | sh[24]aeb-* | sh[23]e-* | sh[34]eb-* | sheb-* | shbe-* \
 	| shle-* | sh[1234]le-* | sh3ele-* | sh64-* | sh64le-* \
-	| sparc-* | sparc64-* | sparc86x-* | sparclet-* | sparclite-* \
-	| sparcv8-* | sparcv9-* | sparcv9b-* | strongarm-* | sv1-* | sx?-* \
+	| sparc-* | sparc64-* | sparc64b-* | sparc64v-* | sparc86x-* | sparclet-* \
+	| sparclite-* \
+	| sparcv8-* | sparcv9-* | sparcv9b-* | sparcv9v-* | strongarm-* | sv1-* | sx?-* \
 	| tahoe-* | thumb-* \
 	| tic30-* | tic4x-* | tic54x-* | tic55x-* | tic6x-* | tic80-* \
+	| tile-* | tilegx-* \
 	| tron-* \
+	| ubicom32-* \
 	| v850-* | v850e-* | vax-* \
 	| we32k-* \
-	| x86-* | x86_64-* | xps100-* | xscale-* | xscalee[bl]-* \
-	| xstormy16-* | xtensa-* \
+	| x86-* | x86_64-* | xc16x-* | xps100-* | xscale-* | xscalee[bl]-* \
+	| xstormy16-* | xtensa*-* \
 	| ymp-* \
-	| z8k-*)
+	| z8k-* | z80-*)
+		;;
+	# Recognize the basic CPU types without company name, with glob match.
+	xtensa*)
+		basic_machine=$basic_machine-unknown
 		;;
 	# Recognize the various machine names and aliases which stand
 	# for a CPU type and a company and sometimes even an OS.
@@ -410,6 +458,10 @@ case $basic_machine in
 		basic_machine=m68k-apollo
 		os=-bsd
 		;;
+	aros)
+		basic_machine=i386-pc
+		os=-aros
+		;;
 	aux)
 		basic_machine=m68k-apple
 		os=-aux
@@ -418,10 +470,26 @@ case $basic_machine in
 		basic_machine=ns32k-sequent
 		os=-dynix
 		;;
+	blackfin)
+		basic_machine=bfin-unknown
+		os=-linux
+		;;
+	blackfin-*)
+		basic_machine=bfin-`echo $basic_machine | sed 's/^[^-]*-//'`
+		os=-linux
+		;;
+	bluegene*)
+		basic_machine=powerpc-ibm
+		os=-cnk
+		;;
 	c90)
 		basic_machine=c90-cray
 		os=-unicos
 		;;
+        cegcc)
+		basic_machine=arm-unknown
+		os=-cegcc
+		;;
 	convex-c1)
 		basic_machine=c1-convex
 		os=-bsd
@@ -450,8 +518,8 @@ case $basic_machine in
 		basic_machine=craynv-cray
 		os=-unicosmp
 		;;
-	cr16c)
-		basic_machine=cr16c-unknown
+	cr16)
+		basic_machine=cr16-unknown
 		os=-elf
 		;;
 	crds | unos)
@@ -489,6 +557,10 @@ case $basic_machine in
 		basic_machine=m88k-motorola
 		os=-sysv3
 		;;
+	dicos)
+		basic_machine=i686-pc
+		os=-dicos
+		;;
 	djgpp)
 		basic_machine=i586-pc
 		os=-msdosdjgpp
@@ -643,6 +715,14 @@ case $basic_machine in
 		basic_machine=m68k-isi
 		os=-sysv
 		;;
+	m68knommu)
+		basic_machine=m68k-unknown
+		os=-linux
+		;;
+	m68knommu-*)
+		basic_machine=m68k-`echo $basic_machine | sed 's/^[^-]*-//'`
+		os=-linux
+		;;
 	m88k-omron*)
 		basic_machine=m88k-omron
 		;;
@@ -654,10 +734,17 @@ case $basic_machine in
 		basic_machine=ns32k-utek
 		os=-sysv
 		;;
+        microblaze)
+		basic_machine=microblaze-xilinx
+		;;
 	mingw32)
 		basic_machine=i386-pc
 		os=-mingw32
 		;;
+	mingw32ce)
+		basic_machine=arm-unknown
+		os=-mingw32ce
+		;;
 	miniframe)
 		basic_machine=m68000-convergent
 		;;
@@ -683,6 +770,9 @@ case $basic_machine in
 		basic_machine=i386-pc
 		os=-msdos
 		;;
+	ms1-*)
+		basic_machine=`echo $basic_machine | sed -e 's/ms1-/mt-/'`
+		;;
 	mvs)
 		basic_machine=i370-ibm
 		os=-mvs
@@ -758,9 +848,8 @@ case $basic_machine in
 		basic_machine=hppa1.1-oki
 		os=-proelf
 		;;
-	or32 | or32-*)
+	openrisc | openrisc-*)
 		basic_machine=or32-unknown
-		os=-coff
 		;;
 	os400)
 		basic_machine=powerpc-ibm
@@ -782,6 +871,14 @@ case $basic_machine in
 		basic_machine=i860-intel
 		os=-osf
 		;;
+	parisc)
+		basic_machine=hppa-unknown
+		os=-linux
+		;;
+	parisc-*)
+		basic_machine=hppa-`echo $basic_machine | sed 's/^[^-]*-//'`
+		os=-linux
+		;;
 	pbd)
 		basic_machine=sparc-tti
 		;;
@@ -791,6 +888,12 @@ case $basic_machine in
 	pc532 | pc532-*)
 		basic_machine=ns32k-pc532
 		;;
+	pc98)
+		basic_machine=i386-pc
+		;;
+	pc98-*)
+		basic_machine=i386-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
 	pentium | p5 | k5 | k6 | nexgen | viac3)
 		basic_machine=i586-pc
 		;;
@@ -847,6 +950,10 @@ case $basic_machine in
 		basic_machine=i586-unknown
 		os=-pw32
 		;;
+	rdos)
+		basic_machine=i386-pc
+		os=-rdos
+		;;
 	rom68k)
 		basic_machine=m68k-rom68k
 		os=-coff
@@ -873,6 +980,10 @@ case $basic_machine in
 	sb1el)
 		basic_machine=mipsisa64sb1el-unknown
 		;;
+	sde)
+		basic_machine=mipsisa32-sde
+		os=-elf
+		;;
 	sei)
 		basic_machine=mips-sei
 		os=-seiux
@@ -884,6 +995,9 @@ case $basic_machine in
 		basic_machine=sh-hitachi
 		os=-hms
 		;;
+	sh5el)
+		basic_machine=sh5le-unknown
+		;;
 	sh64)
 		basic_machine=sh64-unknown
 		;;
@@ -973,6 +1087,15 @@ case $basic_machine in
 		basic_machine=tic6x-unknown
 		os=-coff
 		;;
+        # This must be matched before tile*.
+        tilegx*)
+		basic_machine=tilegx-unknown
+		os=-linux-gnu
+		;;
+	tile*)
+		basic_machine=tile-unknown
+		os=-linux-gnu
+		;;
 	tx39)
 		basic_machine=mipstx39-unknown
 		;;
@@ -1048,6 +1171,10 @@ case $basic_machine in
 		basic_machine=z8k-unknown
 		os=-sim
 		;;
+	z80-*-coff)
+		basic_machine=z80-unknown
+		os=-sim
+		;;
 	none)
 		basic_machine=none-none
 		os=-none
@@ -1086,13 +1213,10 @@ case $basic_machine in
 	we32k)
 		basic_machine=we32k-att
 		;;
-	sh3 | sh4 | sh[34]eb | sh[1234]le | sh[23]ele)
+	sh[1234] | sh[24]a | sh[24]aeb | sh[34]eb | sh[1234]le | sh[23]ele)
 		basic_machine=sh-unknown
 		;;
-	sh64)
-		basic_machine=sh64-unknown
-		;;
-	sparc | sparcv8 | sparcv9 | sparcv9b)
+	sparc | sparcv8 | sparcv9 | sparcv9b | sparcv9v)
 		basic_machine=sparc-sun
 		;;
 	cydra)
@@ -1139,6 +1263,9 @@ case $os in
         # First match some system type aliases
         # that might get confused with valid system types.
 	# -solaris* is a basic system type, with this one exception.
+        -auroraux)
+	        os=-auroraux
+		;;
 	-solaris1 | -solaris1.*)
 		os=`echo $os | sed -e 's|solaris1|sunos4|'`
 		;;
@@ -1159,26 +1286,30 @@ case $os in
 	# Each alternative MUST END IN A *, to match a version number.
 	# -sysv* is not here because it comes later, after sysvr4.
 	-gnu* | -bsd* | -mach* | -minix* | -genix* | -ultrix* | -irix* \
-	      | -*vms* | -sco* | -esix* | -isc* | -aix* | -sunos | -sunos[34]*\
-	      | -hpux* | -unos* | -osf* | -luna* | -dgux* | -solaris* | -sym* \
+	      | -*vms* | -sco* | -esix* | -isc* | -aix* | -cnk* | -sunos | -sunos[34]*\
+	      | -hpux* | -unos* | -osf* | -luna* | -dgux* | -auroraux* | -solaris* \
+	      | -sym* | -kopensolaris* \
 	      | -amigaos* | -amigados* | -msdos* | -newsos* | -unicos* | -aof* \
-	      | -aos* \
+	      | -aos* | -aros* \
 	      | -nindy* | -vxsim* | -vxworks* | -ebmon* | -hms* | -mvs* \
 	      | -clix* | -riscos* | -uniplus* | -iris* | -rtu* | -xenix* \
-	      | -hiux* | -386bsd* | -knetbsd* | -mirbsd* | -netbsd* | -openbsd* \
+	      | -hiux* | -386bsd* | -knetbsd* | -mirbsd* | -netbsd* \
+	      | -openbsd* | -solidbsd* \
 	      | -ekkobsd* | -kfreebsd* | -freebsd* | -riscix* | -lynxos* \
 	      | -bosx* | -nextstep* | -cxux* | -aout* | -elf* | -oabi* \
 	      | -ptx* | -coff* | -ecoff* | -winnt* | -domain* | -vsta* \
 	      | -udi* | -eabi* | -lites* | -ieee* | -go32* | -aux* \
-	      | -chorusos* | -chorusrdb* \
+	      | -chorusos* | -chorusrdb* | -cegcc* \
 	      | -cygwin* | -pe* | -psos* | -moss* | -proelf* | -rtems* \
-	      | -mingw32* | -linux-gnu* | -linux-uclibc* | -uxpv* | -beos* | -mpeix* | -udk* \
+	      | -mingw32* | -linux-gnu* | -linux-newlib* | -linux-uclibc* \
+	      | -uxpv* | -beos* | -mpeix* | -udk* \
 	      | -interix* | -uwin* | -mks* | -rhapsody* | -darwin* | -opened* \
 	      | -openstep* | -oskit* | -conix* | -pw32* | -nonstopux* \
 	      | -storm-chaos* | -tops10* | -tenex* | -tops20* | -its* \
 	      | -os2* | -vos* | -palmos* | -uclinux* | -nucleus* \
 	      | -morphos* | -superux* | -rtmk* | -rtmk-nova* | -windiss* \
-	      | -powermax* | -dnix* | -nx6 | -nx7 | -sei* | -dragonfly*)
+	      | -powermax* | -dnix* | -nx6 | -nx7 | -sei* | -dragonfly* \
+	      | -skyos* | -haiku* | -rdos* | -toppers* | -drops* | -es*)
 	# Remember, each alternative MUST END IN *, to match a version number.
 		;;
 	-qnx*)
@@ -1196,7 +1327,7 @@ case $os in
 		os=`echo $os | sed -e 's|nto|nto-qnx|'`
 		;;
 	-sim | -es1800* | -hms* | -xray | -os68k* | -none* | -v88r* \
-	      | -windows* | -osx | -abug | -netware* | -os9* | -beos* \
+	      | -windows* | -osx | -abug | -netware* | -os9* | -beos* | -haiku* \
 	      | -macos* | -mpw* | -magic* | -mmixware* | -mon960* | -lnews*)
 		;;
 	-mac*)
@@ -1308,6 +1439,11 @@ case $os in
 	-zvmoe)
 		os=-zvmoe
 		;;
+	-dicos*)
+		os=-dicos
+		;;
+        -nacl*)
+	        ;;
 	-none)
 		;;
 	*)
@@ -1330,6 +1466,12 @@ else
 # system, and we'll never get to this point.
 
 case $basic_machine in
+        score-*)
+		os=-elf
+		;;
+        spu-*)
+		os=-elf
+		;;
 	*-acorn)
 		os=-riscix1.2
 		;;
@@ -1339,9 +1481,9 @@ case $basic_machine in
 	arm*-semi)
 		os=-aout
 		;;
-    c4x-* | tic4x-*)
-        os=-coff
-        ;;
+        c4x-* | tic4x-*)
+        	os=-coff
+		;;
 	# This must come before the *-dec entry.
 	pdp10-*)
 		os=-tops20
@@ -1367,6 +1509,9 @@ case $basic_machine in
 	m68*-cisco)
 		os=-aout
 		;;
+        mep-*)
+		os=-elf
+		;;
 	mips*-cisco)
 		os=-elf
 		;;
@@ -1385,6 +1530,9 @@ case $basic_machine in
 	*-be)
 		os=-beos
 		;;
+	*-haiku)
+		os=-haiku
+		;;
 	*-ibm)
 		os=-aix
 		;;
@@ -1493,7 +1641,7 @@ case $basic_machine in
 			-sunos*)
 				vendor=sun
 				;;
-			-aix*)
+			-cnk*|-aix*)
 				vendor=ibm
 				;;
 			-beos*)
@@ -1556,7 +1704,7 @@ case $basic_machine in
 esac
 
 echo $basic_machine$os
-exit 0
+exit
 
 # Local variables:
 # eval: (add-hook 'write-file-hooks 'time-stamp)
diff --git a/nx-X11/extras/fontconfig/fontconfig.pc.in b/nx-X11/extras/fontconfig/fontconfig.pc.in
index 8f599c1..a098ab5 100644
--- a/nx-X11/extras/fontconfig/fontconfig.pc.in
+++ b/nx-X11/extras/fontconfig/fontconfig.pc.in
@@ -6,5 +6,5 @@ includedir=@includedir@
 Name: Fontconfig
 Description: Font configuration and customization library
 Version: @VERSION@
-Libs: -L${libdir} -lfontconfig
+Libs: -L${libdir} -lNX_fontconfig
 Cflags: -I${includedir}
diff --git a/nx-X11/extras/freetype2/builds/unix/config.guess b/nx-X11/extras/freetype2/builds/unix/config.guess
index 51fab47..c2246a4 100644
--- a/nx-X11/extras/freetype2/builds/unix/config.guess
+++ b/nx-X11/extras/freetype2/builds/unix/config.guess
@@ -1,9 +1,10 @@
 #! /bin/sh
 # Attempt to guess a canonical system name.
 #   Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999,
-#   2000, 2001, 2002, 2003 Free Software Foundation, Inc.
+#   2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010
+#   Free Software Foundation, Inc.
 
-timestamp='2004-03-12'
+timestamp='2009-12-30'
 
 # This file is free software; you can redistribute it and/or modify it
 # under the terms of the GNU General Public License as published by
@@ -17,23 +18,25 @@ timestamp='2004-03-12'
 #
 # You should have received a copy of the GNU General Public License
 # along with this program; if not, write to the Free Software
-# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+# Foundation, Inc., 51 Franklin Street - Fifth Floor, Boston, MA
+# 02110-1301, USA.
 #
 # As a special exception to the GNU General Public License, if you
 # distribute this file as part of a program that contains a
 # configuration script generated by Autoconf, you may include it under
 # the same distribution terms that you use for the rest of that program.
 
-# Originally written by Per Bothner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">per at bothner.com</A>&gt;.
-# Please send patches to &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">config-patches at gnu.org</A>&gt;.  Submit a context
-# diff and a properly formatted ChangeLog entry.
+
+# Originally written by Per Bothner.  Please send patches (context
+# diff format) to &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">config-patches at gnu.org</A>&gt; and include a ChangeLog
+# entry.
 #
 # This script attempts to guess a canonical system name similar to
 # config.sub.  If it succeeds, it prints the system name on stdout, and
 # exits with 0.  Otherwise, it exits with 1.
 #
-# The plan is that this can be called by configure scripts if you
-# don't specify an explicit build system type.
+# You can get the latest version of this script from:
+# <A HREF="http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.guess;hb=HEAD">http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.guess;hb=HEAD</A>
 
 me=`echo &quot;$0&quot; | sed -e 's,.*/,,'`
 
@@ -53,8 +56,9 @@ version=&quot;\
 GNU config.guess ($timestamp)
 
 Originally written by Per Bothner.
-Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
-Free Software Foundation, Inc.
+Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000,
+2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010 Free
+Software Foundation, Inc.
 
 This is free software; see the source for copying conditions.  There is NO
 warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&quot;
@@ -66,11 +70,11 @@ Try \`$me --help' for more information.&quot;
 while test $# -gt 0 ; do
   case $1 in
     --time-stamp | --time* | -t )
-       echo &quot;$timestamp&quot; ; exit 0 ;;
+       echo &quot;$timestamp&quot; ; exit ;;
     --version | -v )
-       echo &quot;$version&quot; ; exit 0 ;;
+       echo &quot;$version&quot; ; exit ;;
     --help | --h* | -h )
-       echo &quot;$usage&quot;; exit 0 ;;
+       echo &quot;$usage&quot;; exit ;;
     -- )     # Stop option processing
        shift; break ;;
     - )	# Use stdin as input.
@@ -104,7 +108,7 @@ set_cc_for_build='
 trap &quot;exitcode=\$?; (rm -f \$tmpfiles 2&gt;/dev/null; rmdir \$tmp 2&gt;/dev/null) &amp;&amp; exit \$exitcode&quot; 0 ;
 trap &quot;rm -f \$tmpfiles 2&gt;/dev/null; rmdir \$tmp 2&gt;/dev/null; exit 1&quot; 1 2 13 15 ;
 : ${TMPDIR=/tmp} ;
- { tmp=`(umask 077 &amp;&amp; mktemp -d -q &quot;$TMPDIR/cgXXXXXX&quot;) 2&gt;/dev/null` &amp;&amp; test -n &quot;$tmp&quot; &amp;&amp; test -d &quot;$tmp&quot; ; } ||
+ { tmp=`(umask 077 &amp;&amp; mktemp -d &quot;$TMPDIR/cgXXXXXX&quot;) 2&gt;/dev/null` &amp;&amp; test -n &quot;$tmp&quot; &amp;&amp; test -d &quot;$tmp&quot; ; } ||
  { test -n &quot;$RANDOM&quot; &amp;&amp; tmp=$TMPDIR/cg$$-$RANDOM &amp;&amp; (umask 077 &amp;&amp; mkdir $tmp) ; } ||
  { tmp=$TMPDIR/cg-$$ &amp;&amp; (umask 077 &amp;&amp; mkdir $tmp) &amp;&amp; echo &quot;Warning: creating insecure temp directory&quot; &gt;&amp;2 ; } ||
  { echo &quot;$me: cannot create a temporary directory in $TMPDIR&quot; &gt;&amp;2 ; exit 1 ; } ;
@@ -123,7 +127,7 @@ case $CC_FOR_BUILD,$HOST_CC,$CC in
 	;;
  ,,*)   CC_FOR_BUILD=$CC ;;
  ,*,*)  CC_FOR_BUILD=$HOST_CC ;;
-esac ;'
+esac ; set_cc_for_build= ;'
 
 # This is needed to find uname on a Pyramid OSx when run in the BSD universe.
 # (<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">ghazi at noc.rutgers.edu</A> 1994-08-24)
@@ -158,6 +162,7 @@ case &quot;${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}&quot; in
 	    arm*) machine=arm-unknown ;;
 	    sh3el) machine=shl-unknown ;;
 	    sh3eb) machine=sh-unknown ;;
+	    sh5el) machine=sh5le-unknown ;;
 	    *) machine=${UNAME_MACHINE_ARCH}-unknown ;;
 	esac
 	# The Operating System including object format, if it has switched
@@ -166,7 +171,7 @@ case &quot;${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}&quot; in
 	    arm*|i386|m68k|ns32k|sh3*|sparc|vax)
 		eval $set_cc_for_build
 		if echo __ELF__ | $CC_FOR_BUILD -E - 2&gt;/dev/null \
-			| grep __ELF__ &gt;/dev/null
+			| grep -q __ELF__
 		then
 		    # Once all utilities can be ECOFF (netbsdecoff) or a.out (netbsdaout).
 		    # Return netbsd for either.  FIX?
@@ -196,64 +201,23 @@ case &quot;${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}&quot; in
 	# contains redundant information, the shorter form:
 	# CPU_TYPE-MANUFACTURER-OPERATING_SYSTEM is used.
 	echo &quot;${machine}-${os}${release}&quot;
-	exit 0 ;;
-    amd64:OpenBSD:*:*)
-	echo x86_64-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    amiga:OpenBSD:*:*)
-	echo m68k-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    arc:OpenBSD:*:*)
-	echo mipsel-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    cats:OpenBSD:*:*)
-	echo arm-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    hp300:OpenBSD:*:*)
-	echo m68k-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    mac68k:OpenBSD:*:*)
-	echo m68k-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    macppc:OpenBSD:*:*)
-	echo powerpc-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    mvme68k:OpenBSD:*:*)
-	echo m68k-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    mvme88k:OpenBSD:*:*)
-	echo m88k-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    mvmeppc:OpenBSD:*:*)
-	echo powerpc-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    pegasos:OpenBSD:*:*)
-	echo powerpc-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    pmax:OpenBSD:*:*)
-	echo mipsel-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    sgi:OpenBSD:*:*)
-	echo mipseb-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    sun3:OpenBSD:*:*)
-	echo m68k-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    wgrisc:OpenBSD:*:*)
-	echo mipsel-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     *:OpenBSD:*:*)
-	echo ${UNAME_MACHINE}-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
+	UNAME_MACHINE_ARCH=`arch | sed 's/OpenBSD.//'`
+	echo ${UNAME_MACHINE_ARCH}-unknown-openbsd${UNAME_RELEASE}
+	exit ;;
     *:ekkoBSD:*:*)
 	echo ${UNAME_MACHINE}-unknown-ekkobsd${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
+    *:SolidBSD:*:*)
+	echo ${UNAME_MACHINE}-unknown-solidbsd${UNAME_RELEASE}
+	exit ;;
     macppc:MirBSD:*:*)
-	echo powerppc-unknown-mirbsd${UNAME_RELEASE}
-	exit 0 ;;
+	echo powerpc-unknown-mirbsd${UNAME_RELEASE}
+	exit ;;
     *:MirBSD:*:*)
 	echo ${UNAME_MACHINE}-unknown-mirbsd${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     alpha:OSF1:*:*)
 	case $UNAME_RELEASE in
 	*4.0)
@@ -306,40 +270,43 @@ case &quot;${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}&quot; in
 	# A Xn.n version is an unreleased experimental baselevel.
 	# 1.2 uses &quot;1.2&quot; for uname -r.
 	echo ${UNAME_MACHINE}-dec-osf`echo ${UNAME_RELEASE} | sed -e 's/^[PVTX]//' | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz'`
-	exit 0 ;;
-    Alpha*:OpenVMS:*:*)
-	echo alpha-hp-vms
-	exit 0 ;;
+	exit ;;
     Alpha\ *:Windows_NT*:*)
 	# How do we know it's Interix rather than the generic POSIX subsystem?
 	# Should we change UNAME_MACHINE based on the output of uname instead
 	# of the specific Alpha model?
 	echo alpha-pc-interix
-	exit 0 ;;
+	exit ;;
     21064:Windows_NT:50:3)
 	echo alpha-dec-winnt3.5
-	exit 0 ;;
+	exit ;;
     Amiga*:UNIX_System_V:4.0:*)
 	echo m68k-unknown-sysv4
-	exit 0;;
+	exit ;;
     *:[Aa]miga[Oo][Ss]:*:*)
 	echo ${UNAME_MACHINE}-unknown-amigaos
-	exit 0 ;;
+	exit ;;
     *:[Mm]orph[Oo][Ss]:*:*)
 	echo ${UNAME_MACHINE}-unknown-morphos
-	exit 0 ;;
+	exit ;;
     *:OS/390:*:*)
 	echo i370-ibm-openedition
-	exit 0 ;;
+	exit ;;
+    *:z/VM:*:*)
+	echo s390-ibm-zvmoe
+	exit ;;
     *:OS400:*:*)
         echo powerpc-ibm-os400
-	exit 0 ;;
+	exit ;;
     arm:RISC*:1.[012]*:*|arm:riscix:1.[012]*:*)
 	echo arm-acorn-riscix${UNAME_RELEASE}
-	exit 0;;
+	exit ;;
+    arm:riscos:*:*|arm:RISCOS:*:*)
+	echo arm-unknown-riscos
+	exit ;;
     SR2?01:HI-UX/MPP:*:* | SR8000:HI-UX/MPP:*:*)
 	echo hppa1.1-hitachi-hiuxmpp
-	exit 0;;
+	exit ;;
     Pyramid*:OSx*:*:* | MIS*:OSx*:*:* | MIS*:SMP_DC-OSx*:*:*)
 	# <A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">akee at wpdis03.wpafb.af.mil</A> (Earle F. Ake) contributed MIS and NILE.
 	if test &quot;`(/bin/universe) 2&gt;/dev/null`&quot; = att ; then
@@ -347,32 +314,51 @@ case &quot;${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}&quot; in
 	else
 		echo pyramid-pyramid-bsd
 	fi
-	exit 0 ;;
+	exit ;;
     NILE*:*:*:dcosx)
 	echo pyramid-pyramid-svr4
-	exit 0 ;;
+	exit ;;
     DRS?6000:unix:4.0:6*)
 	echo sparc-icl-nx6
-	exit 0 ;;
-    DRS?6000:UNIX_SV:4.2*:7*)
+	exit ;;
+    DRS?6000:UNIX_SV:4.2*:7* | DRS?6000:isis:4.2*:7*)
 	case `/usr/bin/uname -p` in
-	    sparc) echo sparc-icl-nx7 &amp;&amp; exit 0 ;;
+	    sparc) echo sparc-icl-nx7; exit ;;
 	esac ;;
+    s390x:SunOS:*:*)
+	echo ${UNAME_MACHINE}-ibm-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
+	exit ;;
     sun4H:SunOS:5.*:*)
 	echo sparc-hal-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
-	exit 0 ;;
+	exit ;;
     sun4*:SunOS:5.*:* | tadpole*:SunOS:5.*:*)
 	echo sparc-sun-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
-	exit 0 ;;
-    i86pc:SunOS:5.*:*)
-	echo i386-pc-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
-	exit 0 ;;
+	exit ;;
+    i86pc:AuroraUX:5.*:* | i86xen:AuroraUX:5.*:*)
+	echo i386-pc-auroraux${UNAME_RELEASE}
+	exit ;;
+    i86pc:SunOS:5.*:* | i86xen:SunOS:5.*:*)
+	eval $set_cc_for_build
+	SUN_ARCH=&quot;i386&quot;
+	# If there is a compiler, see if it is configured for 64-bit objects.
+	# Note that the Sun cc does not turn __LP64__ into 1 like gcc does.
+	# This test works for both compilers.
+	if [ &quot;$CC_FOR_BUILD&quot; != 'no_compiler_found' ]; then
+	    if (echo '#ifdef __amd64'; echo IS_64BIT_ARCH; echo '#endif') | \
+		(CCOPTS= $CC_FOR_BUILD -E - 2&gt;/dev/null) | \
+		grep IS_64BIT_ARCH &gt;/dev/null
+	    then
+		SUN_ARCH=&quot;x86_64&quot;
+	    fi
+	fi
+	echo ${SUN_ARCH}-pc-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
+	exit ;;
     sun4*:SunOS:6*:*)
 	# According to config.sub, this is the proper way to canonicalize
 	# SunOS6.  Hard to guess exactly what SunOS6 will be like, but
 	# it's likely to be more like Solaris than SunOS4.
 	echo sparc-sun-solaris3`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
-	exit 0 ;;
+	exit ;;
     sun4*:SunOS:*:*)
 	case &quot;`/usr/bin/arch -k`&quot; in
 	    Series*|S4*)
@@ -381,10 +367,10 @@ case &quot;${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}&quot; in
 	esac
 	# Japanese Language versions have a version number like `4.1.3-JL'.
 	echo sparc-sun-sunos`echo ${UNAME_RELEASE}|sed -e 's/-/_/'`
-	exit 0 ;;
+	exit ;;
     sun3*:SunOS:*:*)
 	echo m68k-sun-sunos${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     sun*:*:4.2BSD:*)
 	UNAME_RELEASE=`(sed 1q /etc/motd | awk '{print substr($5,1,3)}') 2&gt;/dev/null`
 	test &quot;x${UNAME_RELEASE}&quot; = &quot;x&quot; &amp;&amp; UNAME_RELEASE=3
@@ -396,10 +382,10 @@ case &quot;${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}&quot; in
 		echo sparc-sun-sunos${UNAME_RELEASE}
 		;;
 	esac
-	exit 0 ;;
+	exit ;;
     aushp:SunOS:*:*)
 	echo sparc-auspex-sunos${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     # The situation for MiNT is a little confusing.  The machine name
     # can be virtually everything (everything which is not
     # &quot;atarist&quot; or &quot;atariste&quot; at least should have a processor
@@ -410,40 +396,40 @@ case &quot;${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}&quot; in
     # be no problem.
     atarist[e]:*MiNT:*:* | atarist[e]:*mint:*:* | atarist[e]:*TOS:*:*)
         echo m68k-atari-mint${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     atari*:*MiNT:*:* | atari*:*mint:*:* | atarist[e]:*TOS:*:*)
 	echo m68k-atari-mint${UNAME_RELEASE}
-        exit 0 ;;
+        exit ;;
     *falcon*:*MiNT:*:* | *falcon*:*mint:*:* | *falcon*:*TOS:*:*)
         echo m68k-atari-mint${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     milan*:*MiNT:*:* | milan*:*mint:*:* | *milan*:*TOS:*:*)
         echo m68k-milan-mint${UNAME_RELEASE}
-        exit 0 ;;
+        exit ;;
     hades*:*MiNT:*:* | hades*:*mint:*:* | *hades*:*TOS:*:*)
         echo m68k-hades-mint${UNAME_RELEASE}
-        exit 0 ;;
+        exit ;;
     *:*MiNT:*:* | *:*mint:*:* | *:*TOS:*:*)
         echo m68k-unknown-mint${UNAME_RELEASE}
-        exit 0 ;;
+        exit ;;
     m68k:machten:*:*)
 	echo m68k-apple-machten${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     powerpc:machten:*:*)
 	echo powerpc-apple-machten${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     RISC*:Mach:*:*)
 	echo mips-dec-mach_bsd4.3
-	exit 0 ;;
+	exit ;;
     RISC*:ULTRIX:*:*)
 	echo mips-dec-ultrix${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     VAX*:ULTRIX*:*:*)
 	echo vax-dec-ultrix${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     2020:CLIX:*:* | 2430:CLIX:*:*)
 	echo clipper-intergraph-clix${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     mips:*:*:UMIPS | mips:*:*:RISCos)
 	eval $set_cc_for_build
 	sed 's/^	//' &lt;&lt; EOF &gt;$dummy.c
@@ -467,32 +453,33 @@ case &quot;${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}&quot; in
 	  exit (-1);
 	}
 EOF
-	$CC_FOR_BUILD -o $dummy $dummy.c \
-	  &amp;&amp; $dummy `echo &quot;${UNAME_RELEASE}&quot; | sed -n 's/\([0-9]*\).*/\1/p'` \
-	  &amp;&amp; exit 0
+	$CC_FOR_BUILD -o $dummy $dummy.c &amp;&amp;
+	  dummyarg=`echo &quot;${UNAME_RELEASE}&quot; | sed -n 's/\([0-9]*\).*/\1/p'` &amp;&amp;
+	  SYSTEM_NAME=`$dummy $dummyarg` &amp;&amp;
+	    { echo &quot;$SYSTEM_NAME&quot;; exit; }
 	echo mips-mips-riscos${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     Motorola:PowerMAX_OS:*:*)
 	echo powerpc-motorola-powermax
-	exit 0 ;;
+	exit ;;
     Motorola:*:4.3:PL8-*)
 	echo powerpc-harris-powermax
-	exit 0 ;;
+	exit ;;
     Night_Hawk:*:*:PowerMAX_OS | Synergy:PowerMAX_OS:*:*)
 	echo powerpc-harris-powermax
-	exit 0 ;;
+	exit ;;
     Night_Hawk:Power_UNIX:*:*)
 	echo powerpc-harris-powerunix
-	exit 0 ;;
+	exit ;;
     m88k:CX/UX:7*:*)
 	echo m88k-harris-cxux7
-	exit 0 ;;
+	exit ;;
     m88k:*:4*:R4*)
 	echo m88k-motorola-sysv4
-	exit 0 ;;
+	exit ;;
     m88k:*:3*:R3*)
 	echo m88k-motorola-sysv3
-	exit 0 ;;
+	exit ;;
     AViiON:dgux:*:*)
         # DG/UX returns AViiON for all architectures
         UNAME_PROCESSOR=`/usr/bin/uname -p`
@@ -508,29 +495,29 @@ EOF
 	else
 	    echo i586-dg-dgux${UNAME_RELEASE}
 	fi
- 	exit 0 ;;
+ 	exit ;;
     M88*:DolphinOS:*:*)	# DolphinOS (SVR3)
 	echo m88k-dolphin-sysv3
-	exit 0 ;;
+	exit ;;
     M88*:*:R3*:*)
 	# Delta 88k system running SVR3
 	echo m88k-motorola-sysv3
-	exit 0 ;;
+	exit ;;
     XD88*:*:*:*) # Tektronix XD88 system running UTekV (SVR3)
 	echo m88k-tektronix-sysv3
-	exit 0 ;;
+	exit ;;
     Tek43[0-9][0-9]:UTek:*:*) # Tektronix 4300 system running UTek (BSD)
 	echo m68k-tektronix-bsd
-	exit 0 ;;
+	exit ;;
     *:IRIX*:*:*)
 	echo mips-sgi-irix`echo ${UNAME_RELEASE}|sed -e 's/-/_/g'`
-	exit 0 ;;
+	exit ;;
     ????????:AIX?:[12].1:2)   # AIX 2.2.1 or AIX 2.1.1 is RT/PC AIX.
-	echo romp-ibm-aix      # uname -m gives an 8 hex-code CPU id
-	exit 0 ;;              # Note that: echo &quot;'`uname -s`'&quot; gives 'AIX '
+	echo romp-ibm-aix     # uname -m gives an 8 hex-code CPU id
+	exit ;;               # Note that: echo &quot;'`uname -s`'&quot; gives 'AIX '
     i*86:AIX:*:*)
 	echo i386-ibm-aix
-	exit 0 ;;
+	exit ;;
     ia64:AIX:*:*)
 	if [ -x /usr/bin/oslevel ] ; then
 		IBM_REV=`/usr/bin/oslevel`
@@ -538,7 +525,7 @@ EOF
 		IBM_REV=${UNAME_VERSION}.${UNAME_RELEASE}
 	fi
 	echo ${UNAME_MACHINE}-ibm-aix${IBM_REV}
-	exit 0 ;;
+	exit ;;
     *:AIX:2:3)
 	if grep bos325 /usr/include/stdio.h &gt;/dev/null 2&gt;&amp;1; then
 		eval $set_cc_for_build
@@ -553,15 +540,19 @@ EOF
 			exit(0);
 			}
 EOF
-		$CC_FOR_BUILD -o $dummy $dummy.c &amp;&amp; $dummy &amp;&amp; exit 0
-		echo rs6000-ibm-aix3.2.5
+		if $CC_FOR_BUILD -o $dummy $dummy.c &amp;&amp; SYSTEM_NAME=`$dummy`
+		then
+			echo &quot;$SYSTEM_NAME&quot;
+		else
+			echo rs6000-ibm-aix3.2.5
+		fi
 	elif grep bos324 /usr/include/stdio.h &gt;/dev/null 2&gt;&amp;1; then
 		echo rs6000-ibm-aix3.2.4
 	else
 		echo rs6000-ibm-aix3.2
 	fi
-	exit 0 ;;
-    *:AIX:*:[45])
+	exit ;;
+    *:AIX:*:[456])
 	IBM_CPU_ID=`/usr/sbin/lsdev -C -c processor -S available | sed 1q | awk '{ print $1 }'`
 	if /usr/sbin/lsattr -El ${IBM_CPU_ID} | grep ' POWER' &gt;/dev/null 2&gt;&amp;1; then
 		IBM_ARCH=rs6000
@@ -574,28 +565,28 @@ EOF
 		IBM_REV=${UNAME_VERSION}.${UNAME_RELEASE}
 	fi
 	echo ${IBM_ARCH}-ibm-aix${IBM_REV}
-	exit 0 ;;
+	exit ;;
     *:AIX:*:*)
 	echo rs6000-ibm-aix
-	exit 0 ;;
+	exit ;;
     ibmrt:4.4BSD:*|romp-ibm:BSD:*)
 	echo romp-ibm-bsd4.4
-	exit 0 ;;
+	exit ;;
     ibmrt:*BSD:*|romp-ibm:BSD:*)            # covers RT/PC BSD and
 	echo romp-ibm-bsd${UNAME_RELEASE}   # 4.3 with uname added to
-	exit 0 ;;                           # report: romp-ibm BSD 4.3
+	exit ;;                             # report: romp-ibm BSD 4.3
     *:BOSX:*:*)
 	echo rs6000-bull-bosx
-	exit 0 ;;
+	exit ;;
     DPX/2?00:B.O.S.:*:*)
 	echo m68k-bull-sysv3
-	exit 0 ;;
+	exit ;;
     9000/[34]??:4.3bsd:1.*:*)
 	echo m68k-hp-bsd
-	exit 0 ;;
+	exit ;;
     hp300:4.4BSD:*:* | 9000/[34]??:4.3bsd:2.*:*)
 	echo m68k-hp-bsd4.4
-	exit 0 ;;
+	exit ;;
     9000/[34678]??:HP-UX:*:*)
 	HPUX_REV=`echo ${UNAME_RELEASE}|sed -e 's/[^.]*.[0B]*//'`
 	case &quot;${UNAME_MACHINE}&quot; in
@@ -657,9 +648,19 @@ EOF
 	esac
 	if [ ${HP_ARCH} = &quot;hppa2.0w&quot; ]
 	then
-	    # avoid double evaluation of $set_cc_for_build
-	    test -n &quot;$CC_FOR_BUILD&quot; || eval $set_cc_for_build
-	    if echo __LP64__ | (CCOPTS= $CC_FOR_BUILD -E -) | grep __LP64__ &gt;/dev/null
+	    eval $set_cc_for_build
+
+	    # hppa2.0w-hp-hpux* has a 64-bit kernel and a compiler generating
+	    # 32-bit code.  hppa64-hp-hpux* has the same kernel and a compiler
+	    # generating 64-bit code.  GNU and HP use different nomenclature:
+	    #
+	    # $ CC_FOR_BUILD=cc ./config.guess
+	    # =&gt; hppa2.0w-hp-hpux11.23
+	    # $ CC_FOR_BUILD=&quot;cc +DA2.0w&quot; ./config.guess
+	    # =&gt; hppa64-hp-hpux11.23
+
+	    if echo __LP64__ | (CCOPTS= $CC_FOR_BUILD -E - 2&gt;/dev/null) |
+		grep -q __LP64__
 	    then
 		HP_ARCH=&quot;hppa2.0w&quot;
 	    else
@@ -667,11 +668,11 @@ EOF
 	    fi
 	fi
 	echo ${HP_ARCH}-hp-hpux${HPUX_REV}
-	exit 0 ;;
+	exit ;;
     ia64:HP-UX:*:*)
 	HPUX_REV=`echo ${UNAME_RELEASE}|sed -e 's/[^.]*.[0B]*//'`
 	echo ia64-hp-hpux${HPUX_REV}
-	exit 0 ;;
+	exit ;;
     3050*:HI-UX:*:*)
 	eval $set_cc_for_build
 	sed 's/^	//' &lt;&lt; EOF &gt;$dummy.c
@@ -699,224 +700,248 @@ EOF
 	  exit (0);
 	}
 EOF
-	$CC_FOR_BUILD -o $dummy $dummy.c &amp;&amp; $dummy &amp;&amp; exit 0
+	$CC_FOR_BUILD -o $dummy $dummy.c &amp;&amp; SYSTEM_NAME=`$dummy` &amp;&amp;
+		{ echo &quot;$SYSTEM_NAME&quot;; exit; }
 	echo unknown-hitachi-hiuxwe2
-	exit 0 ;;
+	exit ;;
     9000/7??:4.3bsd:*:* | 9000/8?[79]:4.3bsd:*:* )
 	echo hppa1.1-hp-bsd
-	exit 0 ;;
+	exit ;;
     9000/8??:4.3bsd:*:*)
 	echo hppa1.0-hp-bsd
-	exit 0 ;;
+	exit ;;
     *9??*:MPE/iX:*:* | *3000*:MPE/iX:*:*)
 	echo hppa1.0-hp-mpeix
-	exit 0 ;;
+	exit ;;
     hp7??:OSF1:*:* | hp8?[79]:OSF1:*:* )
 	echo hppa1.1-hp-osf
-	exit 0 ;;
+	exit ;;
     hp8??:OSF1:*:*)
 	echo hppa1.0-hp-osf
-	exit 0 ;;
+	exit ;;
     i*86:OSF1:*:*)
 	if [ -x /usr/sbin/sysversion ] ; then
 	    echo ${UNAME_MACHINE}-unknown-osf1mk
 	else
 	    echo ${UNAME_MACHINE}-unknown-osf1
 	fi
-	exit 0 ;;
+	exit ;;
     parisc*:Lites*:*:*)
 	echo hppa1.1-hp-lites
-	exit 0 ;;
+	exit ;;
     C1*:ConvexOS:*:* | convex:ConvexOS:C1*:*)
 	echo c1-convex-bsd
-        exit 0 ;;
+        exit ;;
     C2*:ConvexOS:*:* | convex:ConvexOS:C2*:*)
 	if getsysinfo -f scalar_acc
 	then echo c32-convex-bsd
 	else echo c2-convex-bsd
 	fi
-        exit 0 ;;
+        exit ;;
     C34*:ConvexOS:*:* | convex:ConvexOS:C34*:*)
 	echo c34-convex-bsd
-        exit 0 ;;
+        exit ;;
     C38*:ConvexOS:*:* | convex:ConvexOS:C38*:*)
 	echo c38-convex-bsd
-        exit 0 ;;
+        exit ;;
     C4*:ConvexOS:*:* | convex:ConvexOS:C4*:*)
 	echo c4-convex-bsd
-        exit 0 ;;
+        exit ;;
     CRAY*Y-MP:*:*:*)
 	echo ymp-cray-unicos${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
-	exit 0 ;;
+	exit ;;
     CRAY*[A-Z]90:*:*:*)
 	echo ${UNAME_MACHINE}-cray-unicos${UNAME_RELEASE} \
 	| sed -e 's/CRAY.*\([A-Z]90\)/\1/' \
 	      -e y/ABCDEFGHIJKLMNOPQRSTUVWXYZ/abcdefghijklmnopqrstuvwxyz/ \
 	      -e 's/\.[^.]*$/.X/'
-	exit 0 ;;
+	exit ;;
     CRAY*TS:*:*:*)
 	echo t90-cray-unicos${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
-	exit 0 ;;
+	exit ;;
     CRAY*T3E:*:*:*)
 	echo alphaev5-cray-unicosmk${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
-	exit 0 ;;
+	exit ;;
     CRAY*SV1:*:*:*)
 	echo sv1-cray-unicos${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
-	exit 0 ;;
+	exit ;;
     *:UNICOS/mp:*:*)
-	echo nv1-cray-unicosmp${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
-	exit 0 ;;
+	echo craynv-cray-unicosmp${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
+	exit ;;
     F30[01]:UNIX_System_V:*:* | F700:UNIX_System_V:*:*)
 	FUJITSU_PROC=`uname -m | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz'`
         FUJITSU_SYS=`uname -p | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/\///'`
         FUJITSU_REL=`echo ${UNAME_RELEASE} | sed -e 's/ /_/'`
         echo &quot;${FUJITSU_PROC}-fujitsu-${FUJITSU_SYS}${FUJITSU_REL}&quot;
-        exit 0 ;;
+        exit ;;
     5000:UNIX_System_V:4.*:*)
         FUJITSU_SYS=`uname -p | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/\///'`
         FUJITSU_REL=`echo ${UNAME_RELEASE} | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/ /_/'`
         echo &quot;sparc-fujitsu-${FUJITSU_SYS}${FUJITSU_REL}&quot;
-	exit 0 ;;
+	exit ;;
     i*86:BSD/386:*:* | i*86:BSD/OS:*:* | *:Ascend\ Embedded/OS:*:*)
 	echo ${UNAME_MACHINE}-pc-bsdi${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     sparc*:BSD/OS:*:*)
 	echo sparc-unknown-bsdi${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     *:BSD/OS:*:*)
 	echo ${UNAME_MACHINE}-unknown-bsdi${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     *:FreeBSD:*:*)
-	# Determine whether the default compiler uses glibc.
-	eval $set_cc_for_build
-	sed 's/^	//' &lt;&lt; EOF &gt;$dummy.c
-	#include &lt;features.h&gt;
-	#if __GLIBC__ &gt;= 2
-	LIBC=gnu
-	#else
-	LIBC=
-	#endif
-EOF
-	eval `$CC_FOR_BUILD -E $dummy.c 2&gt;/dev/null | grep ^LIBC=`
-	# GNU/KFreeBSD systems have a &quot;k&quot; prefix to indicate we are using
-	# FreeBSD's kernel, but not the complete OS.
-	case ${LIBC} in gnu) kernel_only='k' ;; esac
-	echo ${UNAME_MACHINE}-unknown-${kernel_only}freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'`${LIBC:+-$LIBC}
-	exit 0 ;;
+	case ${UNAME_MACHINE} in
+	    pc98)
+		echo i386-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'` ;;
+	    amd64)
+		echo x86_64-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'` ;;
+	    *)
+		echo ${UNAME_MACHINE}-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'` ;;
+	esac
+	exit ;;
     i*:CYGWIN*:*)
 	echo ${UNAME_MACHINE}-pc-cygwin
-	exit 0 ;;
-    i*:MINGW*:*)
+	exit ;;
+    *:MINGW*:*)
 	echo ${UNAME_MACHINE}-pc-mingw32
-	exit 0 ;;
+	exit ;;
+    i*:windows32*:*)
+    	# uname -m includes &quot;-pc&quot; on this system.
+    	echo ${UNAME_MACHINE}-mingw32
+	exit ;;
     i*:PW*:*)
 	echo ${UNAME_MACHINE}-pc-pw32
-	exit 0 ;;
-    x86:Interix*:[34]*)
-	echo i586-pc-interix${UNAME_RELEASE}|sed -e 's/\..*//'
-	exit 0 ;;
+	exit ;;
+    *:Interix*:*)
+    	case ${UNAME_MACHINE} in
+	    x86)
+		echo i586-pc-interix${UNAME_RELEASE}
+		exit ;;
+	    authenticamd | genuineintel | EM64T)
+		echo x86_64-unknown-interix${UNAME_RELEASE}
+		exit ;;
+	    IA64)
+		echo ia64-unknown-interix${UNAME_RELEASE}
+		exit ;;
+	esac ;;
     [345]86:Windows_95:* | [345]86:Windows_98:* | [345]86:Windows_NT:*)
 	echo i${UNAME_MACHINE}-pc-mks
-	exit 0 ;;
+	exit ;;
+    8664:Windows_NT:*)
+	echo x86_64-pc-mks
+	exit ;;
     i*:Windows_NT*:* | Pentium*:Windows_NT*:*)
 	# How do we know it's Interix rather than the generic POSIX subsystem?
 	# It also conflicts with pre-2.0 versions of AT&amp;T UWIN. Should we
 	# UNAME_MACHINE based on the output of uname instead of i386?
 	echo i586-pc-interix
-	exit 0 ;;
+	exit ;;
     i*:UWIN*:*)
 	echo ${UNAME_MACHINE}-pc-uwin
-	exit 0 ;;
+	exit ;;
+    amd64:CYGWIN*:*:* | x86_64:CYGWIN*:*:*)
+	echo x86_64-unknown-cygwin
+	exit ;;
     p*:CYGWIN*:*)
 	echo powerpcle-unknown-cygwin
-	exit 0 ;;
+	exit ;;
     prep*:SunOS:5.*:*)
 	echo powerpcle-unknown-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
-	exit 0 ;;
+	exit ;;
     *:GNU:*:*)
 	# the GNU system
 	echo `echo ${UNAME_MACHINE}|sed -e 's,[-/].*$,,'`-unknown-gnu`echo ${UNAME_RELEASE}|sed -e 's,/.*$,,'`
-	exit 0 ;;
+	exit ;;
     *:GNU/*:*:*)
 	# other systems with GNU libc and userland
 	echo ${UNAME_MACHINE}-unknown-`echo ${UNAME_SYSTEM} | sed 's,^[^/]*/,,' | tr '[A-Z]' '[a-z]'``echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'`-gnu
-	exit 0 ;;
+	exit ;;
     i*86:Minix:*:*)
 	echo ${UNAME_MACHINE}-pc-minix
-	exit 0 ;;
+	exit ;;
+    alpha:Linux:*:*)
+	case `sed -n '/^cpu model/s/^.*: \(.*\)/\1/p' &lt; /proc/cpuinfo` in
+	  EV5)   UNAME_MACHINE=alphaev5 ;;
+	  EV56)  UNAME_MACHINE=alphaev56 ;;
+	  PCA56) UNAME_MACHINE=alphapca56 ;;
+	  PCA57) UNAME_MACHINE=alphapca56 ;;
+	  EV6)   UNAME_MACHINE=alphaev6 ;;
+	  EV67)  UNAME_MACHINE=alphaev67 ;;
+	  EV68*) UNAME_MACHINE=alphaev68 ;;
+        esac
+	objdump --private-headers /bin/sh | grep -q ld.so.1
+	if test &quot;$?&quot; = 0 ; then LIBC=&quot;libc1&quot; ; else LIBC=&quot;&quot; ; fi
+	echo ${UNAME_MACHINE}-unknown-linux-gnu${LIBC}
+	exit ;;
     arm*:Linux:*:*)
+	eval $set_cc_for_build
+	if echo __ARM_EABI__ | $CC_FOR_BUILD -E - 2&gt;/dev/null \
+	    | grep -q __ARM_EABI__
+	then
+	    echo ${UNAME_MACHINE}-unknown-linux-gnu
+	else
+	    echo ${UNAME_MACHINE}-unknown-linux-gnueabi
+	fi
+	exit ;;
+    avr32*:Linux:*:*)
 	echo ${UNAME_MACHINE}-unknown-linux-gnu
-	exit 0 ;;
+	exit ;;
     cris:Linux:*:*)
 	echo cris-axis-linux-gnu
-	exit 0 ;;
+	exit ;;
+    crisv32:Linux:*:*)
+	echo crisv32-axis-linux-gnu
+	exit ;;
+    frv:Linux:*:*)
+    	echo frv-unknown-linux-gnu
+	exit ;;
+    i*86:Linux:*:*)
+	LIBC=gnu
+	eval $set_cc_for_build
+	sed 's/^	//' &lt;&lt; EOF &gt;$dummy.c
+	#ifdef __dietlibc__
+	LIBC=dietlibc
+	#endif
+EOF
+	eval `$CC_FOR_BUILD -E $dummy.c 2&gt;/dev/null | grep '^LIBC'`
+	echo &quot;${UNAME_MACHINE}-pc-linux-${LIBC}&quot;
+	exit ;;
     ia64:Linux:*:*)
 	echo ${UNAME_MACHINE}-unknown-linux-gnu
-	exit 0 ;;
+	exit ;;
     m32r*:Linux:*:*)
 	echo ${UNAME_MACHINE}-unknown-linux-gnu
-	exit 0 ;;
+	exit ;;
     m68*:Linux:*:*)
 	echo ${UNAME_MACHINE}-unknown-linux-gnu
-	exit 0 ;;
-    mips:Linux:*:*)
-	eval $set_cc_for_build
-	sed 's/^	//' &lt;&lt; EOF &gt;$dummy.c
-	#undef CPU
-	#undef mips
-	#undef mipsel
-	#if defined(__MIPSEL__) || defined(__MIPSEL) || defined(_MIPSEL) || defined(MIPSEL)
-	CPU=mipsel
-	#else
-	#if defined(__MIPSEB__) || defined(__MIPSEB) || defined(_MIPSEB) || defined(MIPSEB)
-	CPU=mips
-	#else
-	CPU=
-	#endif
-	#endif
-EOF
-	eval `$CC_FOR_BUILD -E $dummy.c 2&gt;/dev/null | grep ^CPU=`
-	test x&quot;${CPU}&quot; != x &amp;&amp; echo &quot;${CPU}-unknown-linux-gnu&quot; &amp;&amp; exit 0
-	;;
-    mips64:Linux:*:*)
+	exit ;;
+    mips:Linux:*:* | mips64:Linux:*:*)
 	eval $set_cc_for_build
 	sed 's/^	//' &lt;&lt; EOF &gt;$dummy.c
 	#undef CPU
-	#undef mips64
-	#undef mips64el
+	#undef ${UNAME_MACHINE}
+	#undef ${UNAME_MACHINE}el
 	#if defined(__MIPSEL__) || defined(__MIPSEL) || defined(_MIPSEL) || defined(MIPSEL)
-	CPU=mips64el
+	CPU=${UNAME_MACHINE}el
 	#else
 	#if defined(__MIPSEB__) || defined(__MIPSEB) || defined(_MIPSEB) || defined(MIPSEB)
-	CPU=mips64
+	CPU=${UNAME_MACHINE}
 	#else
 	CPU=
 	#endif
 	#endif
 EOF
-	eval `$CC_FOR_BUILD -E $dummy.c 2&gt;/dev/null | grep ^CPU=`
-	test x&quot;${CPU}&quot; != x &amp;&amp; echo &quot;${CPU}-unknown-linux-gnu&quot; &amp;&amp; exit 0
+	eval `$CC_FOR_BUILD -E $dummy.c 2&gt;/dev/null | grep '^CPU'`
+	test x&quot;${CPU}&quot; != x &amp;&amp; { echo &quot;${CPU}-unknown-linux-gnu&quot;; exit; }
 	;;
-    ppc:Linux:*:*)
-	echo powerpc-unknown-linux-gnu
-	exit 0 ;;
-    ppc64:Linux:*:*)
-	echo powerpc64-unknown-linux-gnu
-	exit 0 ;;
-    alpha:Linux:*:*)
-	case `sed -n '/^cpu model/s/^.*: \(.*\)/\1/p' &lt; /proc/cpuinfo` in
-	  EV5)   UNAME_MACHINE=alphaev5 ;;
-	  EV56)  UNAME_MACHINE=alphaev56 ;;
-	  PCA56) UNAME_MACHINE=alphapca56 ;;
-	  PCA57) UNAME_MACHINE=alphapca56 ;;
-	  EV6)   UNAME_MACHINE=alphaev6 ;;
-	  EV67)  UNAME_MACHINE=alphaev67 ;;
-	  EV68*) UNAME_MACHINE=alphaev68 ;;
-        esac
-	objdump --private-headers /bin/sh | grep ld.so.1 &gt;/dev/null
-	if test &quot;$?&quot; = 0 ; then LIBC=&quot;libc1&quot; ; else LIBC=&quot;&quot; ; fi
-	echo ${UNAME_MACHINE}-unknown-linux-gnu${LIBC}
-	exit 0 ;;
+    or32:Linux:*:*)
+	echo or32-unknown-linux-gnu
+	exit ;;
+    padre:Linux:*:*)
+	echo sparc-unknown-linux-gnu
+	exit ;;
+    parisc64:Linux:*:* | hppa64:Linux:*:*)
+	echo hppa64-unknown-linux-gnu
+	exit ;;
     parisc:Linux:*:* | hppa:Linux:*:*)
 	# Look for CPU level
 	case `grep '^cpu[^a-z]*:' /proc/cpuinfo 2&gt;/dev/null | cut -d' ' -f2` in
@@ -924,87 +949,40 @@ EOF
 	  PA8*) echo hppa2.0-unknown-linux-gnu ;;
 	  *)    echo hppa-unknown-linux-gnu ;;
 	esac
-	exit 0 ;;
-    parisc64:Linux:*:* | hppa64:Linux:*:*)
-	echo hppa64-unknown-linux-gnu
-	exit 0 ;;
+	exit ;;
+    ppc64:Linux:*:*)
+	echo powerpc64-unknown-linux-gnu
+	exit ;;
+    ppc:Linux:*:*)
+	echo powerpc-unknown-linux-gnu
+	exit ;;
     s390:Linux:*:* | s390x:Linux:*:*)
 	echo ${UNAME_MACHINE}-ibm-linux
-	exit 0 ;;
+	exit ;;
     sh64*:Linux:*:*)
     	echo ${UNAME_MACHINE}-unknown-linux-gnu
-	exit 0 ;;
+	exit ;;
     sh*:Linux:*:*)
 	echo ${UNAME_MACHINE}-unknown-linux-gnu
-	exit 0 ;;
+	exit ;;
     sparc:Linux:*:* | sparc64:Linux:*:*)
 	echo ${UNAME_MACHINE}-unknown-linux-gnu
-	exit 0 ;;
+	exit ;;
+    vax:Linux:*:*)
+	echo ${UNAME_MACHINE}-dec-linux-gnu
+	exit ;;
     x86_64:Linux:*:*)
 	echo x86_64-unknown-linux-gnu
-	exit 0 ;;
-    i*86:Linux:*:*)
-	# The BFD linker knows what the default object file format is, so
-	# first see if it will tell us. cd to the root directory to prevent
-	# problems with other programs or directories called `ld' in the path.
-	# Set LC_ALL=C to ensure ld outputs messages in English.
-	ld_supported_targets=`cd /; LC_ALL=C ld --help 2&gt;&amp;1 \
-			 | sed -ne '/supported targets:/!d
-				    s/[ 	][ 	]*/ /g
-				    s/.*supported targets: *//
-				    s/ .*//
-				    p'`
-        case &quot;$ld_supported_targets&quot; in
-	  elf32-i386)
-		TENTATIVE=&quot;${UNAME_MACHINE}-pc-linux-gnu&quot;
-		;;
-	  a.out-i386-linux)
-		echo &quot;${UNAME_MACHINE}-pc-linux-gnuaout&quot;
-		exit 0 ;;
-	  coff-i386)
-		echo &quot;${UNAME_MACHINE}-pc-linux-gnucoff&quot;
-		exit 0 ;;
-	  &quot;&quot;)
-		# Either a pre-BFD a.out linker (linux-gnuoldld) or
-		# one that does not give us useful --help.
-		echo &quot;${UNAME_MACHINE}-pc-linux-gnuoldld&quot;
-		exit 0 ;;
-	esac
-	# Determine whether the default compiler is a.out or elf
-	eval $set_cc_for_build
-	sed 's/^	//' &lt;&lt; EOF &gt;$dummy.c
-	#include &lt;features.h&gt;
-	#ifdef __ELF__
-	# ifdef __GLIBC__
-	#  if __GLIBC__ &gt;= 2
-	LIBC=gnu
-	#  else
-	LIBC=gnulibc1
-	#  endif
-	# else
-	LIBC=gnulibc1
-	# endif
-	#else
-	#ifdef __INTEL_COMPILER
-	LIBC=gnu
-	#else
-	LIBC=gnuaout
-	#endif
-	#endif
-	#ifdef __dietlibc__
-	LIBC=dietlibc
-	#endif
-EOF
-	eval `$CC_FOR_BUILD -E $dummy.c 2&gt;/dev/null | grep ^LIBC=`
-	test x&quot;${LIBC}&quot; != x &amp;&amp; echo &quot;${UNAME_MACHINE}-pc-linux-${LIBC}&quot; &amp;&amp; exit 0
-	test x&quot;${TENTATIVE}&quot; != x &amp;&amp; echo &quot;${TENTATIVE}&quot; &amp;&amp; exit 0
-	;;
+	exit ;;
+    xtensa*:Linux:*:*)
+    	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	exit ;;
     i*86:DYNIX/ptx:4*:*)
 	# ptx 4.0 does uname -s correctly, with DYNIX/ptx in there.
 	# earlier versions are messed up and put the nodename in both
 	# sysname and nodename.
 	echo i386-sequent-sysv4
-	exit 0 ;;
+	exit ;;
     i*86:UNIX_SV:4.2MP:2.*)
         # Unixware is an offshoot of SVR4, but it has its own version
         # number series starting with 2...
@@ -1012,27 +990,27 @@ EOF
 	# I just have to hope.  -- rms.
         # Use sysv4.2uw... so that sysv4* matches it.
 	echo ${UNAME_MACHINE}-pc-sysv4.2uw${UNAME_VERSION}
-	exit 0 ;;
+	exit ;;
     i*86:OS/2:*:*)
 	# If we were able to find `uname', then EMX Unix compatibility
 	# is probably installed.
 	echo ${UNAME_MACHINE}-pc-os2-emx
-	exit 0 ;;
+	exit ;;
     i*86:XTS-300:*:STOP)
 	echo ${UNAME_MACHINE}-unknown-stop
-	exit 0 ;;
+	exit ;;
     i*86:atheos:*:*)
 	echo ${UNAME_MACHINE}-unknown-atheos
-	exit 0 ;;
-	i*86:syllable:*:*)
+	exit ;;
+    i*86:syllable:*:*)
 	echo ${UNAME_MACHINE}-pc-syllable
-	exit 0 ;;
-    i*86:LynxOS:2.*:* | i*86:LynxOS:3.[01]*:* | i*86:LynxOS:4.0*:*)
+	exit ;;
+    i*86:LynxOS:2.*:* | i*86:LynxOS:3.[01]*:* | i*86:LynxOS:4.[02]*:*)
 	echo i386-unknown-lynxos${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     i*86:*DOS:*:*)
 	echo ${UNAME_MACHINE}-pc-msdosdjgpp
-	exit 0 ;;
+	exit ;;
     i*86:*:4.*:* | i*86:SYSTEM_V:4.*:*)
 	UNAME_REL=`echo ${UNAME_RELEASE} | sed 's/\/MP$//'`
 	if grep Novell /usr/include/link.h &gt;/dev/null 2&gt;/dev/null; then
@@ -1040,15 +1018,16 @@ EOF
 	else
 		echo ${UNAME_MACHINE}-pc-sysv${UNAME_REL}
 	fi
-	exit 0 ;;
-    i*86:*:5:[78]*)
+	exit ;;
+    i*86:*:5:[678]*)
+    	# UnixWare 7.x, OpenUNIX and OpenServer 6.
 	case `/bin/uname -X | grep &quot;^Machine&quot;` in
 	    *486*)	     UNAME_MACHINE=i486 ;;
 	    *Pentium)	     UNAME_MACHINE=i586 ;;
 	    *Pent*|*Celeron) UNAME_MACHINE=i686 ;;
 	esac
 	echo ${UNAME_MACHINE}-unknown-sysv${UNAME_RELEASE}${UNAME_SYSTEM}${UNAME_VERSION}
-	exit 0 ;;
+	exit ;;
     i*86:*:3.2:*)
 	if test -f /usr/options/cb.name; then
 		UNAME_REL=`sed -n 's/.*Version //p' &lt;/usr/options/cb.name`
@@ -1066,73 +1045,86 @@ EOF
 	else
 		echo ${UNAME_MACHINE}-pc-sysv32
 	fi
-	exit 0 ;;
+	exit ;;
     pc:*:*:*)
 	# Left here for compatibility:
         # uname -m prints for DJGPP always 'pc', but it prints nothing about
-        # the processor, so we play safe by assuming i386.
-	echo i386-pc-msdosdjgpp
-        exit 0 ;;
+        # the processor, so we play safe by assuming i586.
+	# Note: whatever this is, it MUST be the same as what config.sub
+	# prints for the &quot;djgpp&quot; host, or else GDB configury will decide that
+	# this is a cross-build.
+	echo i586-pc-msdosdjgpp
+        exit ;;
     Intel:Mach:3*:*)
 	echo i386-pc-mach3
-	exit 0 ;;
+	exit ;;
     paragon:*:*:*)
 	echo i860-intel-osf1
-	exit 0 ;;
+	exit ;;
     i860:*:4.*:*) # i860-SVR4
 	if grep Stardent /usr/include/sys/uadmin.h &gt;/dev/null 2&gt;&amp;1 ; then
 	  echo i860-stardent-sysv${UNAME_RELEASE} # Stardent Vistra i860-SVR4
 	else # Add other i860-SVR4 vendors below as they are discovered.
 	  echo i860-unknown-sysv${UNAME_RELEASE}  # Unknown i860-SVR4
 	fi
-	exit 0 ;;
+	exit ;;
     mini*:CTIX:SYS*5:*)
 	# &quot;miniframe&quot;
 	echo m68010-convergent-sysv
-	exit 0 ;;
+	exit ;;
     mc68k:UNIX:SYSTEM5:3.51m)
 	echo m68k-convergent-sysv
-	exit 0 ;;
+	exit ;;
     M680?0:D-NIX:5.3:*)
 	echo m68k-diab-dnix
-	exit 0 ;;
-    M68*:*:R3V[567]*:*)
-	test -r /sysV68 &amp;&amp; echo 'm68k-motorola-sysv' &amp;&amp; exit 0 ;;
-    3[345]??:*:4.0:3.0 | 3[34]??A:*:4.0:3.0 | 3[34]??,*:*:4.0:3.0 | 3[34]??/*:*:4.0:3.0 | 4400:*:4.0:3.0 | 4850:*:4.0:3.0 | SKA40:*:4.0:3.0 | SDS2:*:4.0:3.0 | SHG2:*:4.0:3.0)
+	exit ;;
+    M68*:*:R3V[5678]*:*)
+	test -r /sysV68 &amp;&amp; { echo 'm68k-motorola-sysv'; exit; } ;;
+    3[345]??:*:4.0:3.0 | 3[34]??A:*:4.0:3.0 | 3[34]??,*:*:4.0:3.0 | 3[34]??/*:*:4.0:3.0 | 4400:*:4.0:3.0 | 4850:*:4.0:3.0 | SKA40:*:4.0:3.0 | SDS2:*:4.0:3.0 | SHG2:*:4.0:3.0 | S7501*:*:4.0:3.0)
 	OS_REL=''
 	test -r /etc/.relid \
 	&amp;&amp; OS_REL=.`sed -n 's/[^ ]* [^ ]* \([0-9][0-9]\).*/\1/p' &lt; /etc/.relid`
 	/bin/uname -p 2&gt;/dev/null | grep 86 &gt;/dev/null \
-	  &amp;&amp; echo i486-ncr-sysv4.3${OS_REL} &amp;&amp; exit 0
+	  &amp;&amp; { echo i486-ncr-sysv4.3${OS_REL}; exit; }
 	/bin/uname -p 2&gt;/dev/null | /bin/grep entium &gt;/dev/null \
-	  &amp;&amp; echo i586-ncr-sysv4.3${OS_REL} &amp;&amp; exit 0 ;;
+	  &amp;&amp; { echo i586-ncr-sysv4.3${OS_REL}; exit; } ;;
     3[34]??:*:4.0:* | 3[34]??,*:*:4.0:*)
         /bin/uname -p 2&gt;/dev/null | grep 86 &gt;/dev/null \
-          &amp;&amp; echo i486-ncr-sysv4 &amp;&amp; exit 0 ;;
+          &amp;&amp; { echo i486-ncr-sysv4; exit; } ;;
+    NCR*:*:4.2:* | MPRAS*:*:4.2:*)
+	OS_REL='.3'
+	test -r /etc/.relid \
+	    &amp;&amp; OS_REL=.`sed -n 's/[^ ]* [^ ]* \([0-9][0-9]\).*/\1/p' &lt; /etc/.relid`
+	/bin/uname -p 2&gt;/dev/null | grep 86 &gt;/dev/null \
+	    &amp;&amp; { echo i486-ncr-sysv4.3${OS_REL}; exit; }
+	/bin/uname -p 2&gt;/dev/null | /bin/grep entium &gt;/dev/null \
+	    &amp;&amp; { echo i586-ncr-sysv4.3${OS_REL}; exit; }
+	/bin/uname -p 2&gt;/dev/null | /bin/grep pteron &gt;/dev/null \
+	    &amp;&amp; { echo i586-ncr-sysv4.3${OS_REL}; exit; } ;;
     m68*:LynxOS:2.*:* | m68*:LynxOS:3.0*:*)
 	echo m68k-unknown-lynxos${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     mc68030:UNIX_System_V:4.*:*)
 	echo m68k-atari-sysv4
-	exit 0 ;;
+	exit ;;
     TSUNAMI:LynxOS:2.*:*)
 	echo sparc-unknown-lynxos${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     rs6000:LynxOS:2.*:*)
 	echo rs6000-unknown-lynxos${UNAME_RELEASE}
-	exit 0 ;;
-    PowerPC:LynxOS:2.*:* | PowerPC:LynxOS:3.[01]*:* | PowerPC:LynxOS:4.0*:*)
+	exit ;;
+    PowerPC:LynxOS:2.*:* | PowerPC:LynxOS:3.[01]*:* | PowerPC:LynxOS:4.[02]*:*)
 	echo powerpc-unknown-lynxos${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     SM[BE]S:UNIX_SV:*:*)
 	echo mips-dde-sysv${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     RM*:ReliantUNIX-*:*:*)
 	echo mips-sni-sysv4
-	exit 0 ;;
+	exit ;;
     RM*:SINIX-*:*:*)
 	echo mips-sni-sysv4
-	exit 0 ;;
+	exit ;;
     *:SINIX-*:*:*)
 	if uname -p 2&gt;/dev/null &gt;/dev/null ; then
 		UNAME_MACHINE=`(uname -p) 2&gt;/dev/null`
@@ -1140,68 +1132,94 @@ EOF
 	else
 		echo ns32k-sni-sysv
 	fi
-	exit 0 ;;
+	exit ;;
     PENTIUM:*:4.0*:*) # Unisys `ClearPath HMP IX 4000' SVR4/MP effort
                       # says &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">Richard.M.Bartel at ccMail.Census.GOV</A>&gt;
         echo i586-unisys-sysv4
-        exit 0 ;;
+        exit ;;
     *:UNIX_System_V:4*:FTX*)
 	# From Gerald Hewes &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">hewes at openmarket.com</A>&gt;.
 	# How about differentiating between stratus architectures? -djm
 	echo hppa1.1-stratus-sysv4
-	exit 0 ;;
+	exit ;;
     *:*:*:FTX*)
 	# From <A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">seanf at swdc.stratus.com.</A>
 	echo i860-stratus-sysv4
-	exit 0 ;;
+	exit ;;
+    i*86:VOS:*:*)
+	# From <A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">Paul.Green at stratus.com.</A>
+	echo ${UNAME_MACHINE}-stratus-vos
+	exit ;;
     *:VOS:*:*)
 	# From <A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">Paul.Green at stratus.com.</A>
 	echo hppa1.1-stratus-vos
-	exit 0 ;;
+	exit ;;
     mc68*:A/UX:*:*)
 	echo m68k-apple-aux${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     news*:NEWS-OS:6*:*)
 	echo mips-sony-newsos6
-	exit 0 ;;
+	exit ;;
     R[34]000:*System_V*:*:* | R4000:UNIX_SYSV:*:* | R*000:UNIX_SV:*:*)
 	if [ -d /usr/nec ]; then
 	        echo mips-nec-sysv${UNAME_RELEASE}
 	else
 	        echo mips-unknown-sysv${UNAME_RELEASE}
 	fi
-        exit 0 ;;
+        exit ;;
     BeBox:BeOS:*:*)	# BeOS running on hardware made by Be, PPC only.
 	echo powerpc-be-beos
-	exit 0 ;;
+	exit ;;
     BeMac:BeOS:*:*)	# BeOS running on Mac or Mac clone, PPC only.
 	echo powerpc-apple-beos
-	exit 0 ;;
+	exit ;;
     BePC:BeOS:*:*)	# BeOS running on Intel PC compatible.
 	echo i586-pc-beos
-	exit 0 ;;
+	exit ;;
+    BePC:Haiku:*:*)	# Haiku running on Intel PC compatible.
+	echo i586-pc-haiku
+	exit ;;
     SX-4:SUPER-UX:*:*)
 	echo sx4-nec-superux${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     SX-5:SUPER-UX:*:*)
 	echo sx5-nec-superux${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     SX-6:SUPER-UX:*:*)
 	echo sx6-nec-superux${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
+    SX-7:SUPER-UX:*:*)
+	echo sx7-nec-superux${UNAME_RELEASE}
+	exit ;;
+    SX-8:SUPER-UX:*:*)
+	echo sx8-nec-superux${UNAME_RELEASE}
+	exit ;;
+    SX-8R:SUPER-UX:*:*)
+	echo sx8r-nec-superux${UNAME_RELEASE}
+	exit ;;
     Power*:Rhapsody:*:*)
 	echo powerpc-apple-rhapsody${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     *:Rhapsody:*:*)
 	echo ${UNAME_MACHINE}-apple-rhapsody${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     *:Darwin:*:*)
-	case `uname -p` in
-	    *86) UNAME_PROCESSOR=i686 ;;
-	    powerpc) UNAME_PROCESSOR=powerpc ;;
+	UNAME_PROCESSOR=`uname -p` || UNAME_PROCESSOR=unknown
+	case $UNAME_PROCESSOR in
+	    i386)
+		eval $set_cc_for_build
+		if [ &quot;$CC_FOR_BUILD&quot; != 'no_compiler_found' ]; then
+		  if (echo '#ifdef __LP64__'; echo IS_64BIT_ARCH; echo '#endif') | \
+		      (CCOPTS= $CC_FOR_BUILD -E - 2&gt;/dev/null) | \
+		      grep IS_64BIT_ARCH &gt;/dev/null
+		  then
+		      UNAME_PROCESSOR=&quot;x86_64&quot;
+		  fi
+		fi ;;
+	    unknown) UNAME_PROCESSOR=powerpc ;;
 	esac
 	echo ${UNAME_PROCESSOR}-apple-darwin${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     *:procnto*:*:* | *:QNX:[0123456789]*:*)
 	UNAME_PROCESSOR=`uname -p`
 	if test &quot;$UNAME_PROCESSOR&quot; = &quot;x86&quot;; then
@@ -1209,22 +1227,25 @@ EOF
 		UNAME_MACHINE=pc
 	fi
 	echo ${UNAME_PROCESSOR}-${UNAME_MACHINE}-nto-qnx${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     *:QNX:*:4*)
 	echo i386-pc-qnx
-	exit 0 ;;
+	exit ;;
+    NSE-?:NONSTOP_KERNEL:*:*)
+	echo nse-tandem-nsk${UNAME_RELEASE}
+	exit ;;
     NSR-?:NONSTOP_KERNEL:*:*)
 	echo nsr-tandem-nsk${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     *:NonStop-UX:*:*)
 	echo mips-compaq-nonstopux
-	exit 0 ;;
+	exit ;;
     BS2000:POSIX*:*:*)
 	echo bs2000-siemens-sysv
-	exit 0 ;;
+	exit ;;
     DS/*:UNIX_System_V:*:*)
 	echo ${UNAME_MACHINE}-${UNAME_SYSTEM}-${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     *:Plan9:*:*)
 	# &quot;uname -m&quot; is not consistent, so use $cputype instead. 386
 	# is converted to i386 for consistency with other x86
@@ -1235,31 +1256,50 @@ EOF
 	    UNAME_MACHINE=&quot;$cputype&quot;
 	fi
 	echo ${UNAME_MACHINE}-unknown-plan9
-	exit 0 ;;
+	exit ;;
     *:TOPS-10:*:*)
 	echo pdp10-unknown-tops10
-	exit 0 ;;
+	exit ;;
     *:TENEX:*:*)
 	echo pdp10-unknown-tenex
-	exit 0 ;;
+	exit ;;
     KS10:TOPS-20:*:* | KL10:TOPS-20:*:* | TYPE4:TOPS-20:*:*)
 	echo pdp10-dec-tops20
-	exit 0 ;;
+	exit ;;
     XKL-1:TOPS-20:*:* | TYPE5:TOPS-20:*:*)
 	echo pdp10-xkl-tops20
-	exit 0 ;;
+	exit ;;
     *:TOPS-20:*:*)
 	echo pdp10-unknown-tops20
-	exit 0 ;;
+	exit ;;
     *:ITS:*:*)
 	echo pdp10-unknown-its
-	exit 0 ;;
+	exit ;;
     SEI:*:*:SEIUX)
         echo mips-sei-seiux${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     *:DragonFly:*:*)
 	echo ${UNAME_MACHINE}-unknown-dragonfly`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'`
-	exit 0 ;;
+	exit ;;
+    *:*VMS:*:*)
+    	UNAME_MACHINE=`(uname -p) 2&gt;/dev/null`
+	case &quot;${UNAME_MACHINE}&quot; in
+	    A*) echo alpha-dec-vms ; exit ;;
+	    I*) echo ia64-dec-vms ; exit ;;
+	    V*) echo vax-dec-vms ; exit ;;
+	esac ;;
+    *:XENIX:*:SysV)
+	echo i386-pc-xenix
+	exit ;;
+    i*86:skyos:*:*)
+	echo ${UNAME_MACHINE}-pc-skyos`echo ${UNAME_RELEASE}` | sed -e 's/ .*$//'
+	exit ;;
+    i*86:rdos:*:*)
+	echo ${UNAME_MACHINE}-pc-rdos
+	exit ;;
+    i*86:AROS:*:*)
+	echo ${UNAME_MACHINE}-pc-aros
+	exit ;;
 esac
 
 #echo '(No uname command or uname output not recognized.)' 1&gt;&amp;2
@@ -1291,7 +1331,7 @@ main ()
 #endif
 
 #if defined (__arm) &amp;&amp; defined (__acorn) &amp;&amp; defined (__unix)
-  printf (&quot;arm-acorn-riscix&quot;); exit (0);
+  printf (&quot;arm-acorn-riscix\n&quot;); exit (0);
 #endif
 
 #if defined (hp300) &amp;&amp; !defined (hpux)
@@ -1380,11 +1420,12 @@ main ()
 }
 EOF
 
-$CC_FOR_BUILD -o $dummy $dummy.c 2&gt;/dev/null &amp;&amp; $dummy &amp;&amp; exit 0
+$CC_FOR_BUILD -o $dummy $dummy.c 2&gt;/dev/null &amp;&amp; SYSTEM_NAME=`$dummy` &amp;&amp;
+	{ echo &quot;$SYSTEM_NAME&quot;; exit; }
 
 # Apollos put the system type in the environment.
 
-test -d /usr/apollo &amp;&amp; { echo ${ISP}-apollo-${SYSTYPE}; exit 0; }
+test -d /usr/apollo &amp;&amp; { echo ${ISP}-apollo-${SYSTYPE}; exit; }
 
 # Convex versions that predate uname can use getsysinfo(1)
 
@@ -1393,22 +1434,22 @@ then
     case `getsysinfo -f cpu_type` in
     c1*)
 	echo c1-convex-bsd
-	exit 0 ;;
+	exit ;;
     c2*)
 	if getsysinfo -f scalar_acc
 	then echo c32-convex-bsd
 	else echo c2-convex-bsd
 	fi
-	exit 0 ;;
+	exit ;;
     c34*)
 	echo c34-convex-bsd
-	exit 0 ;;
+	exit ;;
     c38*)
 	echo c38-convex-bsd
-	exit 0 ;;
+	exit ;;
     c4*)
 	echo c4-convex-bsd
-	exit 0 ;;
+	exit ;;
     esac
 fi
 
@@ -1419,7 +1460,9 @@ This script, last modified $timestamp, has failed to recognize
 the operating system you are using. It is advised that you
 download the most up to date version of the config scripts from
 
-    <A HREF="ftp://ftp.gnu.org/pub/gnu/config/">ftp://ftp.gnu.org/pub/gnu/config/</A>
+  <A HREF="http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.guess;hb=HEAD">http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.guess;hb=HEAD</A>
+and
+  <A HREF="http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.sub;hb=HEAD">http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.sub;hb=HEAD</A>
 
 If the version you run ($0) is already up to date, please
 send the following data and any information you think might be
diff --git a/nx-X11/extras/freetype2/builds/unix/config.sub b/nx-X11/extras/freetype2/builds/unix/config.sub
index ba33103..c2d1257 100644
--- a/nx-X11/extras/freetype2/builds/unix/config.sub
+++ b/nx-X11/extras/freetype2/builds/unix/config.sub
@@ -1,9 +1,10 @@
 #! /bin/sh
 # Configuration validation subroutine script.
 #   Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999,
-#   2000, 2001, 2002, 2003 Free Software Foundation, Inc.
+#   2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010
+#   Free Software Foundation, Inc.
 
-timestamp='2004-03-12'
+timestamp='2010-01-22'
 
 # This file is (in principle) common to ALL GNU software.
 # The presence of a machine in this file suggests that SOME GNU software
@@ -21,22 +22,26 @@ timestamp='2004-03-12'
 #
 # You should have received a copy of the GNU General Public License
 # along with this program; if not, write to the Free Software
-# Foundation, Inc., 59 Temple Place - Suite 330,
-# Boston, MA 02111-1307, USA.
-
+# Foundation, Inc., 51 Franklin Street - Fifth Floor, Boston, MA
+# 02110-1301, USA.
+#
 # As a special exception to the GNU General Public License, if you
 # distribute this file as part of a program that contains a
 # configuration script generated by Autoconf, you may include it under
 # the same distribution terms that you use for the rest of that program.
 
+
 # Please send patches to &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">config-patches at gnu.org</A>&gt;.  Submit a context
-# diff and a properly formatted ChangeLog entry.
+# diff and a properly formatted GNU ChangeLog entry.
 #
 # Configuration subroutine to validate and canonicalize a configuration type.
 # Supply the specified configuration type as an argument.
 # If it is invalid, we print an error message on stderr and exit with code 1.
 # Otherwise, we print the canonical config type on stdout and succeed.
 
+# You can get the latest version of this script from:
+# <A HREF="http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.sub;hb=HEAD">http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.sub;hb=HEAD</A>
+
 # This file is supposed to be the same for all GNU packages
 # and recognize all the CPU types, system types and aliases
 # that are meaningful with *any* GNU software.
@@ -70,8 +75,9 @@ Report bugs and patches to &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">config-patches at gnu.org</A>&gt;.&quot;
 version=&quot;\
 GNU config.sub ($timestamp)
 
-Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
-Free Software Foundation, Inc.
+Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000,
+2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010 Free
+Software Foundation, Inc.
 
 This is free software; see the source for copying conditions.  There is NO
 warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&quot;
@@ -83,11 +89,11 @@ Try \`$me --help' for more information.&quot;
 while test $# -gt 0 ; do
   case $1 in
     --time-stamp | --time* | -t )
-       echo &quot;$timestamp&quot; ; exit 0 ;;
+       echo &quot;$timestamp&quot; ; exit ;;
     --version | -v )
-       echo &quot;$version&quot; ; exit 0 ;;
+       echo &quot;$version&quot; ; exit ;;
     --help | --h* | -h )
-       echo &quot;$usage&quot;; exit 0 ;;
+       echo &quot;$usage&quot;; exit ;;
     -- )     # Stop option processing
        shift; break ;;
     - )	# Use stdin as input.
@@ -99,7 +105,7 @@ while test $# -gt 0 ; do
     *local*)
        # First pass through any local machine types.
        echo $1
-       exit 0;;
+       exit ;;
 
     * )
        break ;;
@@ -118,8 +124,10 @@ esac
 # Here we must recognize all the valid KERNEL-OS combinations.
 maybe_os=`echo $1 | sed 's/^\(.*\)-\([^-]*-[^-]*\)$/\2/'`
 case $maybe_os in
-  nto-qnx* | linux-gnu* | linux-dietlibc | linux-uclibc* | uclinux-uclibc* | uclinux-gnu* | \
-  kfreebsd*-gnu* | knetbsd*-gnu* | netbsd*-gnu* | storm-chaos* | os2-emx* | rtmk-nova*)
+  nto-qnx* | linux-gnu* | linux-dietlibc | linux-newlib* | linux-uclibc* | \
+  uclinux-uclibc* | uclinux-gnu* | kfreebsd*-gnu* | knetbsd*-gnu* | netbsd*-gnu* | \
+  kopensolaris*-gnu* | \
+  storm-chaos* | os2-emx* | rtmk-nova*)
     os=-$maybe_os
     basic_machine=`echo $1 | sed 's/^\(.*\)-\([^-]*-[^-]*\)$/\1/'`
     ;;
@@ -145,10 +153,13 @@ case $os in
 	-convergent* | -ncr* | -news | -32* | -3600* | -3100* | -hitachi* |\
 	-c[123]* | -convex* | -sun | -crds | -omron* | -dg | -ultra | -tti* | \
 	-harris | -dolphin | -highlevel | -gould | -cbm | -ns | -masscomp | \
-	-apple | -axis)
+	-apple | -axis | -knuth | -cray | -microblaze)
 		os=
 		basic_machine=$1
 		;;
+        -bluegene*)
+	        os=-cnk
+		;;
 	-sim | -cisco | -oki | -wec | -winbond)
 		os=
 		basic_machine=$1
@@ -170,6 +181,10 @@ case $os in
 	-hiux*)
 		os=-hiuxwe2
 		;;
+	-sco6)
+		os=-sco5v6
+		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
+		;;
 	-sco5)
 		os=-sco3.2v5
 		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
@@ -186,6 +201,10 @@ case $os in
 		# Don't forget version if it is 3.2v4 or newer.
 		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
 		;;
+	-sco5v6*)
+		# Don't forget version if it is 3.2v4 or newer.
+		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
+		;;
 	-sco*)
 		os=-sco3.2v2
 		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
@@ -230,22 +249,28 @@ case $basic_machine in
 	| alpha | alphaev[4-8] | alphaev56 | alphaev6[78] | alphapca5[67] \
 	| alpha64 | alpha64ev[4-8] | alpha64ev56 | alpha64ev6[78] | alpha64pca5[67] \
 	| am33_2.0 \
-	| arc | arm | arm[bl]e | arme[lb] | armv[2345] | armv[345][lb] | avr \
+	| arc | arm | arm[bl]e | arme[lb] | armv[2345] | armv[345][lb] | avr | avr32 \
+	| bfin \
 	| c4x | clipper \
 	| d10v | d30v | dlx | dsp16xx \
-	| fr30 | frv \
+	| fido | fr30 | frv \
 	| h8300 | h8500 | hppa | hppa1.[01] | hppa2.0 | hppa2.0[nw] | hppa64 \
 	| i370 | i860 | i960 | ia64 \
 	| ip2k | iq2000 \
-	| m32r | m32rle | m68000 | m68k | m88k | mcore \
+	| lm32 \
+	| m32c | m32r | m32rle | m68000 | m68k | m88k \
+	| maxq | mb | microblaze | mcore | mep | metag \
 	| mips | mipsbe | mipseb | mipsel | mipsle \
 	| mips16 \
 	| mips64 | mips64el \
-	| mips64vr | mips64vrel \
+	| mips64octeon | mips64octeonel \
 	| mips64orion | mips64orionel \
+	| mips64r5900 | mips64r5900el \
+	| mips64vr | mips64vrel \
 	| mips64vr4100 | mips64vr4100el \
 	| mips64vr4300 | mips64vr4300el \
 	| mips64vr5000 | mips64vr5000el \
+	| mips64vr5900 | mips64vr5900el \
 	| mipsisa32 | mipsisa32el \
 	| mipsisa32r2 | mipsisa32r2el \
 	| mipsisa64 | mipsisa64el \
@@ -254,30 +279,40 @@ case $basic_machine in
 	| mipsisa64sr71k | mipsisa64sr71kel \
 	| mipstx39 | mipstx39el \
 	| mn10200 | mn10300 \
+	| moxie \
+	| mt \
 	| msp430 \
+	| nios | nios2 \
 	| ns16k | ns32k \
-	| openrisc | or32 \
+	| or32 \
 	| pdp10 | pdp11 | pj | pjl \
 	| powerpc | powerpc64 | powerpc64le | powerpcle | ppcbe \
 	| pyramid \
-	| sh | sh[1234] | sh[23]e | sh[34]eb | shbe | shle | sh[1234]le | sh3ele \
+	| rx \
+	| score \
+	| sh | sh[1234] | sh[24]a | sh[24]aeb | sh[23]e | sh[34]eb | sheb | shbe | shle | sh[1234]le | sh3ele \
 	| sh64 | sh64le \
-	| sparc | sparc64 | sparc86x | sparclet | sparclite | sparcv8 | sparcv9 | sparcv9b \
-	| strongarm \
+	| sparc | sparc64 | sparc64b | sparc64v | sparc86x | sparclet | sparclite \
+	| sparcv8 | sparcv9 | sparcv9b | sparcv9v \
+	| spu | strongarm \
 	| tahoe | thumb | tic4x | tic80 | tron \
+	| ubicom32 \
 	| v850 | v850e \
 	| we32k \
-	| x86 | xscale | xstormy16 | xtensa \
-	| z8k)
+	| x86 | xc16x | xscale | xscalee[bl] | xstormy16 | xtensa \
+	| z8k | z80)
 		basic_machine=$basic_machine-unknown
 		;;
-	m6811 | m68hc11 | m6812 | m68hc12)
+	m6811 | m68hc11 | m6812 | m68hc12 | picochip)
 		# Motorola 68HC11/12.
 		basic_machine=$basic_machine-unknown
 		os=-none
 		;;
 	m88110 | m680[12346]0 | m683?2 | m68360 | m5200 | v70 | w65 | z8k)
 		;;
+	ms1)
+		basic_machine=mt-unknown
+		;;
 
 	# We use `pc' rather than `unknown'
 	# because (1) that's what they normally are, and
@@ -297,28 +332,32 @@ case $basic_machine in
 	| alpha64-* | alpha64ev[4-8]-* | alpha64ev56-* | alpha64ev6[78]-* \
 	| alphapca5[67]-* | alpha64pca5[67]-* | arc-* \
 	| arm-*  | armbe-* | armle-* | armeb-* | armv*-* \
-	| avr-* \
-	| bs2000-* \
+	| avr-* | avr32-* \
+	| bfin-* | bs2000-* \
 	| c[123]* | c30-* | [cjt]90-* | c4x-* | c54x-* | c55x-* | c6x-* \
-	| clipper-* | cydra-* \
+	| clipper-* | craynv-* | cydra-* \
 	| d10v-* | d30v-* | dlx-* \
 	| elxsi-* \
-	| f30[01]-* | f700-* | fr30-* | frv-* | fx80-* \
+	| f30[01]-* | f700-* | fido-* | fr30-* | frv-* | fx80-* \
 	| h8300-* | h8500-* \
 	| hppa-* | hppa1.[01]-* | hppa2.0-* | hppa2.0[nw]-* | hppa64-* \
 	| i*86-* | i860-* | i960-* | ia64-* \
 	| ip2k-* | iq2000-* \
-	| m32r-* | m32rle-* \
+	| lm32-* \
+	| m32c-* | m32r-* | m32rle-* \
 	| m68000-* | m680[012346]0-* | m68360-* | m683?2-* | m68k-* \
-	| m88110-* | m88k-* | mcore-* \
+	| m88110-* | m88k-* | maxq-* | mcore-* | metag-* | microblaze-* \
 	| mips-* | mipsbe-* | mipseb-* | mipsel-* | mipsle-* \
 	| mips16-* \
 	| mips64-* | mips64el-* \
-	| mips64vr-* | mips64vrel-* \
+	| mips64octeon-* | mips64octeonel-* \
 	| mips64orion-* | mips64orionel-* \
+	| mips64r5900-* | mips64r5900el-* \
+	| mips64vr-* | mips64vrel-* \
 	| mips64vr4100-* | mips64vr4100el-* \
 	| mips64vr4300-* | mips64vr4300el-* \
 	| mips64vr5000-* | mips64vr5000el-* \
+	| mips64vr5900-* | mips64vr5900el-* \
 	| mipsisa32-* | mipsisa32el-* \
 	| mipsisa32r2-* | mipsisa32r2el-* \
 	| mipsisa64-* | mipsisa64el-* \
@@ -326,26 +365,36 @@ case $basic_machine in
 	| mipsisa64sb1-* | mipsisa64sb1el-* \
 	| mipsisa64sr71k-* | mipsisa64sr71kel-* \
 	| mipstx39-* | mipstx39el-* \
+	| mmix-* \
+	| mt-* \
 	| msp430-* \
-	| none-* | np1-* | nv1-* | ns16k-* | ns32k-* \
+	| nios-* | nios2-* \
+	| none-* | np1-* | ns16k-* | ns32k-* \
 	| orion-* \
 	| pdp10-* | pdp11-* | pj-* | pjl-* | pn-* | power-* \
 	| powerpc-* | powerpc64-* | powerpc64le-* | powerpcle-* | ppcbe-* \
 	| pyramid-* \
-	| romp-* | rs6000-* \
-	| sh-* | sh[1234]-* | sh[23]e-* | sh[34]eb-* | shbe-* \
+	| romp-* | rs6000-* | rx-* \
+	| sh-* | sh[1234]-* | sh[24]a-* | sh[24]aeb-* | sh[23]e-* | sh[34]eb-* | sheb-* | shbe-* \
 	| shle-* | sh[1234]le-* | sh3ele-* | sh64-* | sh64le-* \
-	| sparc-* | sparc64-* | sparc86x-* | sparclet-* | sparclite-* \
-	| sparcv8-* | sparcv9-* | sparcv9b-* | strongarm-* | sv1-* | sx?-* \
+	| sparc-* | sparc64-* | sparc64b-* | sparc64v-* | sparc86x-* | sparclet-* \
+	| sparclite-* \
+	| sparcv8-* | sparcv9-* | sparcv9b-* | sparcv9v-* | strongarm-* | sv1-* | sx?-* \
 	| tahoe-* | thumb-* \
 	| tic30-* | tic4x-* | tic54x-* | tic55x-* | tic6x-* | tic80-* \
+	| tile-* | tilegx-* \
 	| tron-* \
+	| ubicom32-* \
 	| v850-* | v850e-* | vax-* \
 	| we32k-* \
-	| x86-* | x86_64-* | xps100-* | xscale-* | xstormy16-* \
-	| xtensa-* \
+	| x86-* | x86_64-* | xc16x-* | xps100-* | xscale-* | xscalee[bl]-* \
+	| xstormy16-* | xtensa*-* \
 	| ymp-* \
-	| z8k-*)
+	| z8k-* | z80-*)
+		;;
+	# Recognize the basic CPU types without company name, with glob match.
+	xtensa*)
+		basic_machine=$basic_machine-unknown
 		;;
 	# Recognize the various machine names and aliases which stand
 	# for a CPU type and a company and sometimes even an OS.
@@ -409,6 +458,10 @@ case $basic_machine in
 		basic_machine=m68k-apollo
 		os=-bsd
 		;;
+	aros)
+		basic_machine=i386-pc
+		os=-aros
+		;;
 	aux)
 		basic_machine=m68k-apple
 		os=-aux
@@ -417,10 +470,26 @@ case $basic_machine in
 		basic_machine=ns32k-sequent
 		os=-dynix
 		;;
+	blackfin)
+		basic_machine=bfin-unknown
+		os=-linux
+		;;
+	blackfin-*)
+		basic_machine=bfin-`echo $basic_machine | sed 's/^[^-]*-//'`
+		os=-linux
+		;;
+	bluegene*)
+		basic_machine=powerpc-ibm
+		os=-cnk
+		;;
 	c90)
 		basic_machine=c90-cray
 		os=-unicos
 		;;
+        cegcc)
+		basic_machine=arm-unknown
+		os=-cegcc
+		;;
 	convex-c1)
 		basic_machine=c1-convex
 		os=-bsd
@@ -445,13 +514,20 @@ case $basic_machine in
 		basic_machine=j90-cray
 		os=-unicos
 		;;
-	cr16c)
-		basic_machine=cr16c-unknown
+	craynv)
+		basic_machine=craynv-cray
+		os=-unicosmp
+		;;
+	cr16)
+		basic_machine=cr16-unknown
 		os=-elf
 		;;
 	crds | unos)
 		basic_machine=m68k-crds
 		;;
+	crisv32 | crisv32-* | etraxfs*)
+		basic_machine=crisv32-axis
+		;;
 	cris | cris-* | etrax*)
 		basic_machine=cris-axis
 		;;
@@ -481,6 +557,14 @@ case $basic_machine in
 		basic_machine=m88k-motorola
 		os=-sysv3
 		;;
+	dicos)
+		basic_machine=i686-pc
+		os=-dicos
+		;;
+	djgpp)
+		basic_machine=i586-pc
+		os=-msdosdjgpp
+		;;
 	dpx20 | dpx20-*)
 		basic_machine=rs6000-bull
 		os=-bosx
@@ -631,6 +715,14 @@ case $basic_machine in
 		basic_machine=m68k-isi
 		os=-sysv
 		;;
+	m68knommu)
+		basic_machine=m68k-unknown
+		os=-linux
+		;;
+	m68knommu-*)
+		basic_machine=m68k-`echo $basic_machine | sed 's/^[^-]*-//'`
+		os=-linux
+		;;
 	m88k-omron*)
 		basic_machine=m88k-omron
 		;;
@@ -642,10 +734,17 @@ case $basic_machine in
 		basic_machine=ns32k-utek
 		os=-sysv
 		;;
+        microblaze)
+		basic_machine=microblaze-xilinx
+		;;
 	mingw32)
 		basic_machine=i386-pc
 		os=-mingw32
 		;;
+	mingw32ce)
+		basic_machine=arm-unknown
+		os=-mingw32ce
+		;;
 	miniframe)
 		basic_machine=m68000-convergent
 		;;
@@ -659,10 +758,6 @@ case $basic_machine in
 	mips3*)
 		basic_machine=`echo $basic_machine | sed -e 's/mips3/mips64/'`-unknown
 		;;
-	mmix*)
-		basic_machine=mmix-knuth
-		os=-mmixware
-		;;
 	monitor)
 		basic_machine=m68k-rom68k
 		os=-coff
@@ -675,6 +770,9 @@ case $basic_machine in
 		basic_machine=i386-pc
 		os=-msdos
 		;;
+	ms1-*)
+		basic_machine=`echo $basic_machine | sed -e 's/ms1-/mt-/'`
+		;;
 	mvs)
 		basic_machine=i370-ibm
 		os=-mvs
@@ -743,10 +841,6 @@ case $basic_machine in
 	np1)
 		basic_machine=np1-gould
 		;;
-	nv1)
-		basic_machine=nv1-cray
-		os=-unicosmp
-		;;
 	nsr-tandem)
 		basic_machine=nsr-tandem
 		;;
@@ -754,9 +848,8 @@ case $basic_machine in
 		basic_machine=hppa1.1-oki
 		os=-proelf
 		;;
-	or32 | or32-*)
+	openrisc | openrisc-*)
 		basic_machine=or32-unknown
-		os=-coff
 		;;
 	os400)
 		basic_machine=powerpc-ibm
@@ -778,6 +871,14 @@ case $basic_machine in
 		basic_machine=i860-intel
 		os=-osf
 		;;
+	parisc)
+		basic_machine=hppa-unknown
+		os=-linux
+		;;
+	parisc-*)
+		basic_machine=hppa-`echo $basic_machine | sed 's/^[^-]*-//'`
+		os=-linux
+		;;
 	pbd)
 		basic_machine=sparc-tti
 		;;
@@ -787,6 +888,12 @@ case $basic_machine in
 	pc532 | pc532-*)
 		basic_machine=ns32k-pc532
 		;;
+	pc98)
+		basic_machine=i386-pc
+		;;
+	pc98-*)
+		basic_machine=i386-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
 	pentium | p5 | k5 | k6 | nexgen | viac3)
 		basic_machine=i586-pc
 		;;
@@ -843,6 +950,10 @@ case $basic_machine in
 		basic_machine=i586-unknown
 		os=-pw32
 		;;
+	rdos)
+		basic_machine=i386-pc
+		os=-rdos
+		;;
 	rom68k)
 		basic_machine=m68k-rom68k
 		os=-coff
@@ -869,6 +980,10 @@ case $basic_machine in
 	sb1el)
 		basic_machine=mipsisa64sb1el-unknown
 		;;
+	sde)
+		basic_machine=mipsisa32-sde
+		os=-elf
+		;;
 	sei)
 		basic_machine=mips-sei
 		os=-seiux
@@ -880,6 +995,9 @@ case $basic_machine in
 		basic_machine=sh-hitachi
 		os=-hms
 		;;
+	sh5el)
+		basic_machine=sh5le-unknown
+		;;
 	sh64)
 		basic_machine=sh64-unknown
 		;;
@@ -969,6 +1087,15 @@ case $basic_machine in
 		basic_machine=tic6x-unknown
 		os=-coff
 		;;
+        # This must be matched before tile*.
+        tilegx*)
+		basic_machine=tilegx-unknown
+		os=-linux-gnu
+		;;
+	tile*)
+		basic_machine=tile-unknown
+		os=-linux-gnu
+		;;
 	tx39)
 		basic_machine=mipstx39-unknown
 		;;
@@ -1029,6 +1156,10 @@ case $basic_machine in
 		basic_machine=hppa1.1-winbond
 		os=-proelf
 		;;
+	xbox)
+		basic_machine=i686-pc
+		os=-mingw32
+		;;
 	xps | xps100)
 		basic_machine=xps100-honeywell
 		;;
@@ -1040,6 +1171,10 @@ case $basic_machine in
 		basic_machine=z8k-unknown
 		os=-sim
 		;;
+	z80-*-coff)
+		basic_machine=z80-unknown
+		os=-sim
+		;;
 	none)
 		basic_machine=none-none
 		os=-none
@@ -1059,6 +1194,9 @@ case $basic_machine in
 	romp)
 		basic_machine=romp-ibm
 		;;
+	mmix)
+		basic_machine=mmix-knuth
+		;;
 	rs6000)
 		basic_machine=rs6000-ibm
 		;;
@@ -1075,13 +1213,10 @@ case $basic_machine in
 	we32k)
 		basic_machine=we32k-att
 		;;
-	sh3 | sh4 | sh[34]eb | sh[1234]le | sh[23]ele)
+	sh[1234] | sh[24]a | sh[24]aeb | sh[34]eb | sh[1234]le | sh[23]ele)
 		basic_machine=sh-unknown
 		;;
-	sh64)
-		basic_machine=sh64-unknown
-		;;
-	sparc | sparcv8 | sparcv9 | sparcv9b)
+	sparc | sparcv8 | sparcv9 | sparcv9b | sparcv9v)
 		basic_machine=sparc-sun
 		;;
 	cydra)
@@ -1128,6 +1263,9 @@ case $os in
         # First match some system type aliases
         # that might get confused with valid system types.
 	# -solaris* is a basic system type, with this one exception.
+        -auroraux)
+	        os=-auroraux
+		;;
 	-solaris1 | -solaris1.*)
 		os=`echo $os | sed -e 's|solaris1|sunos4|'`
 		;;
@@ -1148,26 +1286,30 @@ case $os in
 	# Each alternative MUST END IN A *, to match a version number.
 	# -sysv* is not here because it comes later, after sysvr4.
 	-gnu* | -bsd* | -mach* | -minix* | -genix* | -ultrix* | -irix* \
-	      | -*vms* | -sco* | -esix* | -isc* | -aix* | -sunos | -sunos[34]*\
-	      | -hpux* | -unos* | -osf* | -luna* | -dgux* | -solaris* | -sym* \
+	      | -*vms* | -sco* | -esix* | -isc* | -aix* | -cnk* | -sunos | -sunos[34]*\
+	      | -hpux* | -unos* | -osf* | -luna* | -dgux* | -auroraux* | -solaris* \
+	      | -sym* | -kopensolaris* \
 	      | -amigaos* | -amigados* | -msdos* | -newsos* | -unicos* | -aof* \
-	      | -aos* \
+	      | -aos* | -aros* \
 	      | -nindy* | -vxsim* | -vxworks* | -ebmon* | -hms* | -mvs* \
 	      | -clix* | -riscos* | -uniplus* | -iris* | -rtu* | -xenix* \
-	      | -hiux* | -386bsd* | -knetbsd* | -mirbsd* | -netbsd* | -openbsd* \
+	      | -hiux* | -386bsd* | -knetbsd* | -mirbsd* | -netbsd* \
+	      | -openbsd* | -solidbsd* \
 	      | -ekkobsd* | -kfreebsd* | -freebsd* | -riscix* | -lynxos* \
 	      | -bosx* | -nextstep* | -cxux* | -aout* | -elf* | -oabi* \
 	      | -ptx* | -coff* | -ecoff* | -winnt* | -domain* | -vsta* \
 	      | -udi* | -eabi* | -lites* | -ieee* | -go32* | -aux* \
-	      | -chorusos* | -chorusrdb* \
+	      | -chorusos* | -chorusrdb* | -cegcc* \
 	      | -cygwin* | -pe* | -psos* | -moss* | -proelf* | -rtems* \
-	      | -mingw32* | -linux-gnu* | -linux-uclibc* | -uxpv* | -beos* | -mpeix* | -udk* \
+	      | -mingw32* | -linux-gnu* | -linux-newlib* | -linux-uclibc* \
+	      | -uxpv* | -beos* | -mpeix* | -udk* \
 	      | -interix* | -uwin* | -mks* | -rhapsody* | -darwin* | -opened* \
 	      | -openstep* | -oskit* | -conix* | -pw32* | -nonstopux* \
 	      | -storm-chaos* | -tops10* | -tenex* | -tops20* | -its* \
 	      | -os2* | -vos* | -palmos* | -uclinux* | -nucleus* \
 	      | -morphos* | -superux* | -rtmk* | -rtmk-nova* | -windiss* \
-	      | -powermax* | -dnix* | -nx6 | -nx7 | -sei* | -dragonfly*)
+	      | -powermax* | -dnix* | -nx6 | -nx7 | -sei* | -dragonfly* \
+	      | -skyos* | -haiku* | -rdos* | -toppers* | -drops* | -es*)
 	# Remember, each alternative MUST END IN *, to match a version number.
 		;;
 	-qnx*)
@@ -1185,7 +1327,7 @@ case $os in
 		os=`echo $os | sed -e 's|nto|nto-qnx|'`
 		;;
 	-sim | -es1800* | -hms* | -xray | -os68k* | -none* | -v88r* \
-	      | -windows* | -osx | -abug | -netware* | -os9* | -beos* \
+	      | -windows* | -osx | -abug | -netware* | -os9* | -beos* | -haiku* \
 	      | -macos* | -mpw* | -magic* | -mmixware* | -mon960* | -lnews*)
 		;;
 	-mac*)
@@ -1294,6 +1436,14 @@ case $os in
 	-kaos*)
 		os=-kaos
 		;;
+	-zvmoe)
+		os=-zvmoe
+		;;
+	-dicos*)
+		os=-dicos
+		;;
+        -nacl*)
+	        ;;
 	-none)
 		;;
 	*)
@@ -1316,6 +1466,12 @@ else
 # system, and we'll never get to this point.
 
 case $basic_machine in
+        score-*)
+		os=-elf
+		;;
+        spu-*)
+		os=-elf
+		;;
 	*-acorn)
 		os=-riscix1.2
 		;;
@@ -1325,9 +1481,9 @@ case $basic_machine in
 	arm*-semi)
 		os=-aout
 		;;
-    c4x-* | tic4x-*)
-        os=-coff
-        ;;
+        c4x-* | tic4x-*)
+        	os=-coff
+		;;
 	# This must come before the *-dec entry.
 	pdp10-*)
 		os=-tops20
@@ -1353,6 +1509,9 @@ case $basic_machine in
 	m68*-cisco)
 		os=-aout
 		;;
+        mep-*)
+		os=-elf
+		;;
 	mips*-cisco)
 		os=-elf
 		;;
@@ -1371,9 +1530,15 @@ case $basic_machine in
 	*-be)
 		os=-beos
 		;;
+	*-haiku)
+		os=-haiku
+		;;
 	*-ibm)
 		os=-aix
 		;;
+    	*-knuth)
+		os=-mmixware
+		;;
 	*-wec)
 		os=-proelf
 		;;
@@ -1476,7 +1641,7 @@ case $basic_machine in
 			-sunos*)
 				vendor=sun
 				;;
-			-aix*)
+			-cnk*|-aix*)
 				vendor=ibm
 				;;
 			-beos*)
@@ -1539,7 +1704,7 @@ case $basic_machine in
 esac
 
 echo $basic_machine$os
-exit 0
+exit
 
 # Local variables:
 # eval: (add-hook 'write-file-hooks 'time-stamp)
diff --git a/nx-X11/extras/ogl-sample/main/gfx/lib/glu/Imakefile b/nx-X11/extras/ogl-sample/main/gfx/lib/glu/Imakefile
index c63186b..40f066f 100644
--- a/nx-X11/extras/ogl-sample/main/gfx/lib/glu/Imakefile
+++ b/nx-X11/extras/ogl-sample/main/gfx/lib/glu/Imakefile
@@ -36,7 +36,7 @@ XCOMM
 #define DoDebugLib DebugLibGlu
 #define DoProfileLib ProfileLibGlu
 #define IHaveSubdirs
-#define LibName GLU
+#define LibName NX_GLU
 #define PassCDebugFlags 'CDEBUGFLAGS=$(CDEBUGFLAGS)'
 #define SoRev SOGLUREV
 
diff --git a/nx-X11/extras/ttf2pt1/Makefile b/nx-X11/extras/ttf2pt1/Makefile
index 2616d46..0b9d77a 100644
--- a/nx-X11/extras/ttf2pt1/Makefile
+++ b/nx-X11/extras/ttf2pt1/Makefile
@@ -158,8 +158,8 @@ mans: $(MANS)
 
 clean:
 	rm -f t1asm ttf2pt1 *.o app/RPM/Makefile app/RPM/*.spec *.core core.* core
-	( cd other &amp;&amp; make clean; )
-	( cd app/netscape &amp;&amp; make clean; )
+	( cd other &amp;&amp; ${MAKE} clean; )
+	( cd app/netscape &amp;&amp; ${MAKE} clean; )
 
 veryclean: clean
 	rm -f $(DOCS) $(MANS)
diff --git a/nx-X11/lib/FS/Imakefile b/nx-X11/lib/FS/Imakefile
index a1c6163..9cc4f28 100644
--- a/nx-X11/lib/FS/Imakefile
+++ b/nx-X11/lib/FS/Imakefile
@@ -11,7 +11,7 @@ XCOMM $XFree86: xc/lib/FS/Imakefile,v 3.5 2001/01/17 19:41:28 dawes Exp $
 #define DoExtraLib SharedLibFS
 #define DoDebugLib DebugLibFS
 #define DoProfileLib ProfileLibFS
-#define LibName FS
+#define LibName NX_FS
 #define SoRev SOFSREV
 #define IncSubdir X11
 #define IncSubSubdir fonts
diff --git a/nx-X11/lib/GLw/Imakefile b/nx-X11/lib/GLw/Imakefile
index 3eb0503..f1988c9 100644
--- a/nx-X11/lib/GLw/Imakefile
+++ b/nx-X11/lib/GLw/Imakefile
@@ -46,7 +46,7 @@ XCOMM MOTIF_LDFLAGS  = -L/usr/local/lib
 #define DoProfileLib	ProfileLibGLw
 
 #define HasSharedData	NO
-#define LibName GLw
+#define LibName NX_GLw
 #define SoRev SOGLWREV
 #define IncSubdir GL
 
diff --git a/nx-X11/lib/ICE/Imakefile b/nx-X11/lib/ICE/Imakefile
index 0dce0c7..100e1bc 100644
--- a/nx-X11/lib/ICE/Imakefile
+++ b/nx-X11/lib/ICE/Imakefile
@@ -10,7 +10,7 @@ XCOMM $XFree86: xc/lib/ICE/Imakefile,v 3.5 2001/04/23 16:17:06 tsi Exp $
 #define DoExtraLib SharedLibICE
 #define DoDebugLib DebugLibICE
 #define DoProfileLib ProfileLibICE
-#define LibName ICE
+#define LibName NX_ICE
 #define SoRev SOICEREV
 #define IncSubdir X11
 #define IncSubSubdir ICE
diff --git a/nx-X11/lib/SM/Imakefile b/nx-X11/lib/SM/Imakefile
index d2687bb..b39c27b 100644
--- a/nx-X11/lib/SM/Imakefile
+++ b/nx-X11/lib/SM/Imakefile
@@ -10,7 +10,7 @@ XCOMM $XFree86: xc/lib/SM/Imakefile,v 1.3 2001/01/17 19:41:31 dawes Exp $
 #define DoExtraLib SharedLibSM
 #define DoDebugLib DebugLibSM
 #define DoProfileLib ProfileLibSM
-#define LibName SM
+#define LibName NX_SM
 #define SoRev SOSMREV
 #define IncSubdir X11
 #define IncSubSubdir SM
diff --git a/nx-X11/lib/X11/Imakefile b/nx-X11/lib/X11/Imakefile
index d8d0601..bf7943e 100644
--- a/nx-X11/lib/X11/Imakefile
+++ b/nx-X11/lib/X11/Imakefile
@@ -63,7 +63,6 @@ NX_XCOMPLIBDIR    = $(XTOP)/../nxcomp
 NX_XCOMPLIBLINK   = Xcomp
 NX_XCOMPLIBTARGET = $(NX_XCOMPLIBDIR)/$(NX_XCOMPLIBNAME)
 NX_REQUIREDLIBS   = -L$(NX_XCOMPLIBDIR) -l$(NX_XCOMPLIBLINK)
-NX_XCOMPDEPTARGET = $(BUILDLIBDIR)/$(NX_XCOMPLIBNAME)
 NX_XCOMPCONFIGTARGET = $(NX_XCOMPLIBDIR)/config.status
 
 NX_XCOMPEXTLIBDIR    = $(XTOP)/../nxcompext
@@ -83,7 +82,7 @@ NX_XCOMPEXTCONFIGTARGET = $(NX_XCOMPEXTLIBDIR)/config.status
 #define DoExtraLib SharedLibX11
 #define DoDebugLib DebugLibX11
 #define DoProfileLib ProfileLibX11
-#define LibName X11
+#define LibName NX_X11
 #define SoRev SOXLIBREV
 #define HugeLibrary YES
 #define IncSubdir X11
@@ -1147,51 +1146,43 @@ ks_tables.h: $(XINCLUDESRC)/keysymdef.h util/makekeys.c
 
 includes:: ks_tables.h
 
+CONFIGURE ?= ./configure
+
 #if NXLibraries
 
 $(NX_XCOMPCONFIGTARGET):
 	cd ../../../nxcomp &amp;&amp; \
-	./configure
+	${CONFIGURE}
 
 $(NX_XCOMPEXTCONFIGTARGET):
 	cd ../../../nxcompext &amp;&amp; \
-	./configure
+	${CONFIGURE}
 
 #ifdef SunArchitecture
 $(NX_XCOMPLIBTARGET): $(NX_XCOMPCONFIGTARGET)
-	cd $(NX_XCOMPLIBDIR) &amp;&amp; \
-	gmake
+	${MAKE} -C $(NX_XCOMPLIBDIR)
 
 $(NX_XCOMPEXTLIBTARGET): $(NX_XCOMPEXTCONFIGTARGET)
-	cd ../../../nxcompext &amp;&amp; \
-	gmake
+	${MAKE} -C ../../../nxcompext
 
 #else
 $(NX_XCOMPLIBTARGET): $(NX_XCOMPCONFIGTARGET)
-	cd $(NX_XCOMPLIBDIR) &amp;&amp; \
-	make
+	${MAKE} -C $(NX_XCOMPLIBDIR)
 
-$(NX_XCOMPEXTLIBTARGET): $(NX_XCOMPEXTCONFIGTARGET)
-	cd ../../../nxcompext &amp;&amp; \
-	make
+$(NX_XCOMPEXTLIBTARGET): $(NX_XCOMPEXTCONFIGTARGET) $(NX_XCOMPLIBTARGET) lib$(LIBNAME).so.$(SOXLIBREV)
+	${MAKE} -C ../../../nxcompext
 
 #endif
 
-depend:: $(NX_XCOMPLIBTARGET)
+depend::
 
-all:: $(NX_XCOMPLIBTARGET)
+lib$(LIBNAME).so.$(SOXLIBREV): $(NX_XCOMPLIBTARGET)
 
-$(NX_XCOMPDEPTARGET):
-	ln -s $(NX_XCOMPLIBDIR)/$(NX_XCOMPLIBNAME) $(BUILDLIBDIR)/$(NX_XCOMPLIBNAME)
-	ln -s $(NX_XCOMPLIBDIR)/$(NX_XCOMPLIBNAME).1 $(BUILDLIBDIR)/$(NX_XCOMPLIBNAME).1
+all:: $(NX_XCOMPLIBTARGET)
 
 depend:: $(NX_XCOMPLIBTARGET)
 
-all:: $(NX_XCOMPDEPTARGET) $(NX_XCOMPEXTLIBTARGET) 
-
-clean::
-	rm -f $(BUILDLIBDIR)/$(NX_XCOMPLIBNAME)
-	rm -f $(BUILDLIBDIR)/$(NX_XCOMPLIBNAME).1
+all:: $(NX_XCOMPEXTLIBTARGET) 
 
 #endif
 
diff --git a/nx-X11/lib/X11/Imakefile.NX.original b/nx-X11/lib/X11/Imakefile.NX.original
index d8d0601..20b024a 100644
--- a/nx-X11/lib/X11/Imakefile.NX.original
+++ b/nx-X11/lib/X11/Imakefile.NX.original
@@ -83,7 +83,7 @@ NX_XCOMPEXTCONFIGTARGET = $(NX_XCOMPEXTLIBDIR)/config.status
 #define DoExtraLib SharedLibX11
 #define DoDebugLib DebugLibX11
 #define DoProfileLib ProfileLibX11
-#define LibName X11
+#define LibName NX_X11
 #define SoRev SOXLIBREV
 #define HugeLibrary YES
 #define IncSubdir X11
@@ -1159,21 +1159,17 @@ $(NX_XCOMPEXTCONFIGTARGET):
 
 #ifdef SunArchitecture
 $(NX_XCOMPLIBTARGET): $(NX_XCOMPCONFIGTARGET)
-	cd $(NX_XCOMPLIBDIR) &amp;&amp; \
-	gmake
+	${MAKE} -C $(NX_XCOMPLIBDIR)
 
 $(NX_XCOMPEXTLIBTARGET): $(NX_XCOMPEXTCONFIGTARGET)
-	cd ../../../nxcompext &amp;&amp; \
-	gmake
+	${MAKE} -C ../../../nxcompext
 
 #else
 $(NX_XCOMPLIBTARGET): $(NX_XCOMPCONFIGTARGET)
-	cd $(NX_XCOMPLIBDIR) &amp;&amp; \
-	make
+	${MAKE} -C $(NX_XCOMPLIBDIR)
 
 $(NX_XCOMPEXTLIBTARGET): $(NX_XCOMPEXTCONFIGTARGET)
-	cd ../../../nxcompext &amp;&amp; \
-	make
+	${MAKE} -C ../../../nxcompext
 
 #endif
 
diff --git a/nx-X11/lib/X11/Imakefile.X.original b/nx-X11/lib/X11/Imakefile.X.original
index 1f2c9b2..1596dbd 100644
--- a/nx-X11/lib/X11/Imakefile.X.original
+++ b/nx-X11/lib/X11/Imakefile.X.original
@@ -28,7 +28,7 @@ BuildIncludes($(HEADERS),IncSubdir,..)
 #define DoExtraLib SharedLibX11
 #define DoDebugLib DebugLibX11
 #define DoProfileLib ProfileLibX11
-#define LibName X11
+#define LibName NX_X11
 #define SoRev SOXLIBREV
 #define HugeLibrary YES
 #define IncSubdir X11
diff --git a/nx-X11/lib/XRes/Imakefile b/nx-X11/lib/XRes/Imakefile
index 410f57f..fbc067a 100644
--- a/nx-X11/lib/XRes/Imakefile
+++ b/nx-X11/lib/XRes/Imakefile
@@ -4,7 +4,7 @@ XCOMM $XFree86: xc/lib/XRes/Imakefile,v 1.3 2003/10/13 21:19:28 herrb Exp $
 #define DoSharedLib SharedLibXRes
 #define DoDebugLib DebugLibXRes
 #define DoProfileLib ProfileLibXRes
-#define LibName XRes
+#define LibName NX_XRes
 #define SoRev SOXRESREV
 #define LibHeaders NO
 
diff --git a/nx-X11/lib/XTrap/Imakefile b/nx-X11/lib/XTrap/Imakefile
index 54bfdd6..07dd6c5 100644
--- a/nx-X11/lib/XTrap/Imakefile
+++ b/nx-X11/lib/XTrap/Imakefile
@@ -4,7 +4,7 @@ XCOMM $XFree86$
 #define DoSharedLib SharedLibXTrap
 #define DoDebugLib DebugLibXTrap
 #define DoProfileLib ProfileLibXTrap
-#define LibName XTrap
+#define LibName NX_XTrap
 #define SoRev SOXTRAPREV
 #define LibHeaders NO
 
diff --git a/nx-X11/lib/Xau/Imakefile b/nx-X11/lib/Xau/Imakefile
index 49cb7dc..331d29c 100644
--- a/nx-X11/lib/Xau/Imakefile
+++ b/nx-X11/lib/Xau/Imakefile
@@ -10,7 +10,7 @@ XCOMM $XFree86: xc/lib/Xau/Imakefile,v 3.5 1999/04/17 09:08:11 dawes Exp $
 #define DoExtraLib SharedLibXau
 #define DoDebugLib DebugLibXau
 #define DoProfileLib ProfileLibXau
-#define LibName Xau
+#define LibName NX_Xau
 #define SoRev SOXAUTHREV
 #define IncSubdir X11
 
diff --git a/nx-X11/lib/Xaw/Imakefile b/nx-X11/lib/Xaw/Imakefile
index 23842b7..1a2a6db 100644
--- a/nx-X11/lib/Xaw/Imakefile
+++ b/nx-X11/lib/Xaw/Imakefile
@@ -11,7 +11,7 @@ XCOMM $XFree86: xc/lib/Xaw/Imakefile,v 1.10 2001/01/17 19:42:27 dawes Exp $
 #define DoDebugLib DebugLibXaw 
 #define DoProfileLib ProfileLibXaw 
 #define HasSharedData YES
-#define LibName Xaw
+#define LibName NX_Xaw
 #define SoRev SOXAWREV
 #define IncSubdir X11
 #define IncSubSubdir Xaw
diff --git a/nx-X11/lib/Xaw6/Imakefile b/nx-X11/lib/Xaw6/Imakefile
index 58b54b2..4313bbc 100644
--- a/nx-X11/lib/Xaw6/Imakefile
+++ b/nx-X11/lib/Xaw6/Imakefile
@@ -5,7 +5,7 @@ XCOMM $XFree86: xc/lib/Xaw6/Imakefile,v 1.2 1999/06/06 14:05:55 dawes Exp $
 #define DoDebugLib DebugLibXaw6
 #define DoProfileLib ProfileLibXaw6
 #define HasSharedData YES
-#define LibName Xaw
+#define LibName NX_Xaw
 #define SoRev SOXAW6REV
 #define LibHeaders NO
 #define NoSoSymlink
diff --git a/nx-X11/lib/Xaw7/Imakefile b/nx-X11/lib/Xaw7/Imakefile
index d6dcc2e..d42a1c0 100644
--- a/nx-X11/lib/Xaw7/Imakefile
+++ b/nx-X11/lib/Xaw7/Imakefile
@@ -5,7 +5,7 @@ XCOMM $Xorg$
 #define DoDebugLib DebugLibXaw7
 #define DoProfileLib ProfileLibXaw7
 #define HasSharedData YES
-#define LibName Xaw
+#define LibName NX_Xaw
 #define SoRev SOXAW7REV
 
 #if BuildXaw
diff --git a/nx-X11/lib/Xcomposite/Imakefile b/nx-X11/lib/Xcomposite/Imakefile
index 053df3d..a3b9414 100644
--- a/nx-X11/lib/Xcomposite/Imakefile
+++ b/nx-X11/lib/Xcomposite/Imakefile
@@ -14,7 +14,7 @@ SOXCOMPOSITEREV=1.0.0
 #define DoDebugLib DebugLibXcomposite
 #define DoProfileLib ProfileLibXcomposite
 
-#define LibName Xcomposite
+#define LibName NX_Xcomposite
 #define SoRev SOXCOMPOSITEREV
 #define IncSubdir X11
 #define IncSubSubdir extensions
diff --git a/nx-X11/lib/Xcomposite/xcomposite.pc.in b/nx-X11/lib/Xcomposite/xcomposite.pc.in
index 770adf5..c319694 100644
--- a/nx-X11/lib/Xcomposite/xcomposite.pc.in
+++ b/nx-X11/lib/Xcomposite/xcomposite.pc.in
@@ -7,4 +7,4 @@ Name: Xcomposite
 Description: X Composite Library
 Version: @VERSION@
 Cflags: -I${includedir} @XCOMPOSITE_CFLAGS@ @X_CFLAGS@
-Libs: -L${libdir} -lXcomposite @XCOMPOSITE_LIBS@ @X_LIBS@
+Libs: -L${libdir} -lNX_Xcomposite @XCOMPOSITE_LIBS@ @X_LIBS@
diff --git a/nx-X11/lib/Xcursor/Imakefile b/nx-X11/lib/Xcursor/Imakefile
index 3e50841..53b41e8 100644
--- a/nx-X11/lib/Xcursor/Imakefile
+++ b/nx-X11/lib/Xcursor/Imakefile
@@ -15,7 +15,7 @@ SOXCURSORREV=1.0.2
 #define DoDebugLib DebugLibXcursor
 #define DoProfileLib ProfileLibXcursor
 
-#define LibName Xcursor
+#define LibName NX_Xcursor
 #define SoRev SOXCURSORREV
 #define IncSubdir X11
 #define IncSubSubdir Xcursor
diff --git a/nx-X11/lib/Xcursor/xcursor.pc.in b/nx-X11/lib/Xcursor/xcursor.pc.in
index c39fce7..87aba12 100644
--- a/nx-X11/lib/Xcursor/xcursor.pc.in
+++ b/nx-X11/lib/Xcursor/xcursor.pc.in
@@ -12,4 +12,4 @@ Description: X Cursor Library
 Version: @VERSION@
 Requires: xrender
 Cflags: -I${includedir} ${xrendercflags} ${xcflags}
-Libs: -L${libdir} -lXcursor ${xrenderlibs} ${xlibs}
+Libs: -L${libdir} -lNX_Xcursor ${xrenderlibs} ${xlibs}
diff --git a/nx-X11/lib/Xdamage/Imakefile b/nx-X11/lib/Xdamage/Imakefile
index 260dfeb..d0d767a 100644
--- a/nx-X11/lib/Xdamage/Imakefile
+++ b/nx-X11/lib/Xdamage/Imakefile
@@ -14,7 +14,7 @@ SOXDAMAGEREV=1.0.1
 #define DoDebugLib DebugLibXdamage
 #define DoProfileLib ProfileLibXdamage
 
-#define LibName Xdamage
+#define LibName NX_Xdamage
 #define SoRev SOXDAMAGEREV
 #define IncSubdir X11
 #define IncSubSubdir extensions
diff --git a/nx-X11/lib/Xdamage/xdamage.pc.in b/nx-X11/lib/Xdamage/xdamage.pc.in
index dbf77ac..d1c9f5d 100644
--- a/nx-X11/lib/Xdamage/xdamage.pc.in
+++ b/nx-X11/lib/Xdamage/xdamage.pc.in
@@ -7,4 +7,4 @@ Name: Xdamage
 Description: X Damage Library
 Version: @VERSION@
 Cflags: -I${includedir} @XDAMAGE_CFLAGS@ @X_CFLAGS@
-Libs: -L${libdir} -lXdamage @XDAMAGE_LIBS@ @X_LIBS@
+Libs: -L${libdir} -lNX_Xdamage @XDAMAGE_LIBS@ @X_LIBS@
diff --git a/nx-X11/lib/Xdmcp/Imakefile b/nx-X11/lib/Xdmcp/Imakefile
index 08b91cd..1fc7b6d 100644
--- a/nx-X11/lib/Xdmcp/Imakefile
+++ b/nx-X11/lib/Xdmcp/Imakefile
@@ -10,7 +10,7 @@ XCOMM $XFree86: xc/lib/Xdmcp/Imakefile,v 3.4 1999/04/17 09:08:12 dawes Exp $
 #define DoExtraLib SharedLibXdmcp
 #define DoDebugLib DebugLibXdmcp
 #define DoProfileLib ProfileLibXdmcp
-#define LibName Xdmcp
+#define LibName NX_Xdmcp
 #define SoRev SOXDMCPREV
 #define IncSubdir X11
 
diff --git a/nx-X11/lib/Xevie/Imakefile b/nx-X11/lib/Xevie/Imakefile
index 24e1f6e..0f4405d 100644
--- a/nx-X11/lib/Xevie/Imakefile
+++ b/nx-X11/lib/Xevie/Imakefile
@@ -14,7 +14,7 @@ SOXEVIEREV=1.0.0
 #define DoDebugLib DebugLibXevie
 #define DoProfileLib ProfileLibXevie
 
-#define LibName Xevie
+#define LibName NX_Xevie
 #define SoRev SOXEVIEREV
 #define IncSubdir X11
 #define IncSubSubdir extensions
diff --git a/nx-X11/lib/Xevie/xevie.pc.in b/nx-X11/lib/Xevie/xevie.pc.in
index 88e8b36..800e5d4 100644
--- a/nx-X11/lib/Xevie/xevie.pc.in
+++ b/nx-X11/lib/Xevie/xevie.pc.in
@@ -9,4 +9,4 @@ Name: Xevie
 Description: X Event Interceptor Library
 Version: @VERSION@
 Cflags: -I${includedir} ${xcflags}
-Libs: -L${libdir} -lXevie ${xlibs}
+Libs: -L${libdir} -lNX_Xevie ${xlibs}
diff --git a/nx-X11/lib/Xext/Imakefile b/nx-X11/lib/Xext/Imakefile
index b323dc7..c43361f 100644
--- a/nx-X11/lib/Xext/Imakefile
+++ b/nx-X11/lib/Xext/Imakefile
@@ -10,7 +10,7 @@ XCOMM $XFree86: xc/lib/Xext/Imakefile,v 1.12 2002/10/16 00:37:27 dawes Exp $
 #define DoExtraLib SharedLibXext
 #define DoDebugLib DebugLibXext
 #define DoProfileLib ProfileLibXext
-#define LibName Xext
+#define LibName NX_Xext
 #define SoRev SOXEXTREV
 #define LibHeaders NO
 
diff --git a/nx-X11/lib/Xfixes/Imakefile b/nx-X11/lib/Xfixes/Imakefile
index c053aa2..bbf88e1 100644
--- a/nx-X11/lib/Xfixes/Imakefile
+++ b/nx-X11/lib/Xfixes/Imakefile
@@ -14,7 +14,7 @@ SOXFIXESREV=3.0.0
 #define DoDebugLib DebugLibXfixes
 #define DoProfileLib ProfileLibXfixes
 
-#define LibName Xfixes
+#define LibName NX_Xfixes
 #define SoRev SOXFIXESREV
 #define IncSubdir X11
 #define IncSubSubdir extensions
diff --git a/nx-X11/lib/Xfixes/xfixes.pc.in b/nx-X11/lib/Xfixes/xfixes.pc.in
index 6180ea3..54e9ac7 100644
--- a/nx-X11/lib/Xfixes/xfixes.pc.in
+++ b/nx-X11/lib/Xfixes/xfixes.pc.in
@@ -7,4 +7,4 @@ Name: Xfixes
 Description: X Fixes Library
 Version: @VERSION@
 Cflags: -I${includedir} @X_CFLAGS@
-Libs: -L${libdir} -lXfixes @X_LIBS@
+Libs: -L${libdir} -lNX_Xfixes @X_LIBS@
diff --git a/nx-X11/lib/Xfontcache/Imakefile b/nx-X11/lib/Xfontcache/Imakefile
index dd0e578..7917a60 100644
--- a/nx-X11/lib/Xfontcache/Imakefile
+++ b/nx-X11/lib/Xfontcache/Imakefile
@@ -9,7 +9,7 @@ XCOMM $XFree86: xc/lib/Xfontcache/Imakefile,v 1.5 2003/10/13 21:49:21 herrb Exp
 #define DoExtraLib SharedLibXfontcache
 #define DoDebugLib DebugLibXfontcache
 #define DoProfileLib ProfileLibXfontcache
-#define LibName Xfontcache
+#define LibName NX_Xfontcache
 #define SoRev SOXFONTCACHEREV
 #define LibHeaders NO
 
diff --git a/nx-X11/lib/Xft/Imakefile b/nx-X11/lib/Xft/Imakefile
index 4b827be..4c94213 100644
--- a/nx-X11/lib/Xft/Imakefile
+++ b/nx-X11/lib/Xft/Imakefile
@@ -8,7 +8,7 @@ XCOMM $XdotOrg: xc/lib/Xft/Imakefile,v 1.5 2005/10/19 02:46:56 kem Exp $
 #define DoProfileLib ProfileLibXft
 
 #define HasSharedData YES
-#define LibName Xft
+#define LibName NX_Xft
 #define SoRev SOXFTREV
 #define IncSubdir X11
 #define IncSubSubdir Xft
diff --git a/nx-X11/lib/Xft/config.guess b/nx-X11/lib/Xft/config.guess
index cc726cd..c2246a4 100755
--- a/nx-X11/lib/Xft/config.guess
+++ b/nx-X11/lib/Xft/config.guess
@@ -1,9 +1,10 @@
 #! /bin/sh
 # Attempt to guess a canonical system name.
 #   Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999,
-#   2000, 2001, 2002, 2003 Free Software Foundation, Inc.
+#   2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010
+#   Free Software Foundation, Inc.
 
-timestamp='2003-02-22'
+timestamp='2009-12-30'
 
 # This file is free software; you can redistribute it and/or modify it
 # under the terms of the GNU General Public License as published by
@@ -17,23 +18,25 @@ timestamp='2003-02-22'
 #
 # You should have received a copy of the GNU General Public License
 # along with this program; if not, write to the Free Software
-# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+# Foundation, Inc., 51 Franklin Street - Fifth Floor, Boston, MA
+# 02110-1301, USA.
 #
 # As a special exception to the GNU General Public License, if you
 # distribute this file as part of a program that contains a
 # configuration script generated by Autoconf, you may include it under
 # the same distribution terms that you use for the rest of that program.
 
-# Originally written by Per Bothner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">per at bothner.com</A>&gt;.
-# Please send patches to &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">config-patches at gnu.org</A>&gt;.  Submit a context
-# diff and a properly formatted ChangeLog entry.
+
+# Originally written by Per Bothner.  Please send patches (context
+# diff format) to &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">config-patches at gnu.org</A>&gt; and include a ChangeLog
+# entry.
 #
 # This script attempts to guess a canonical system name similar to
 # config.sub.  If it succeeds, it prints the system name on stdout, and
 # exits with 0.  Otherwise, it exits with 1.
 #
-# The plan is that this can be called by configure scripts if you
-# don't specify an explicit build system type.
+# You can get the latest version of this script from:
+# <A HREF="http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.guess;hb=HEAD">http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.guess;hb=HEAD</A>
 
 me=`echo &quot;$0&quot; | sed -e 's,.*/,,'`
 
@@ -53,8 +56,9 @@ version=&quot;\
 GNU config.guess ($timestamp)
 
 Originally written by Per Bothner.
-Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
-Free Software Foundation, Inc.
+Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000,
+2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010 Free
+Software Foundation, Inc.
 
 This is free software; see the source for copying conditions.  There is NO
 warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&quot;
@@ -66,11 +70,11 @@ Try \`$me --help' for more information.&quot;
 while test $# -gt 0 ; do
   case $1 in
     --time-stamp | --time* | -t )
-       echo &quot;$timestamp&quot; ; exit 0 ;;
+       echo &quot;$timestamp&quot; ; exit ;;
     --version | -v )
-       echo &quot;$version&quot; ; exit 0 ;;
+       echo &quot;$version&quot; ; exit ;;
     --help | --h* | -h )
-       echo &quot;$usage&quot;; exit 0 ;;
+       echo &quot;$usage&quot;; exit ;;
     -- )     # Stop option processing
        shift; break ;;
     - )	# Use stdin as input.
@@ -104,8 +108,9 @@ set_cc_for_build='
 trap &quot;exitcode=\$?; (rm -f \$tmpfiles 2&gt;/dev/null; rmdir \$tmp 2&gt;/dev/null) &amp;&amp; exit \$exitcode&quot; 0 ;
 trap &quot;rm -f \$tmpfiles 2&gt;/dev/null; rmdir \$tmp 2&gt;/dev/null; exit 1&quot; 1 2 13 15 ;
 : ${TMPDIR=/tmp} ;
- { tmp=`(umask 077 &amp;&amp; mktemp -d -q &quot;$TMPDIR/cgXXXXXX&quot;) 2&gt;/dev/null` &amp;&amp; test -n &quot;$tmp&quot; &amp;&amp; test -d &quot;$tmp&quot; ; } ||
+ { tmp=`(umask 077 &amp;&amp; mktemp -d &quot;$TMPDIR/cgXXXXXX&quot;) 2&gt;/dev/null` &amp;&amp; test -n &quot;$tmp&quot; &amp;&amp; test -d &quot;$tmp&quot; ; } ||
  { test -n &quot;$RANDOM&quot; &amp;&amp; tmp=$TMPDIR/cg$$-$RANDOM &amp;&amp; (umask 077 &amp;&amp; mkdir $tmp) ; } ||
+ { tmp=$TMPDIR/cg-$$ &amp;&amp; (umask 077 &amp;&amp; mkdir $tmp) &amp;&amp; echo &quot;Warning: creating insecure temp directory&quot; &gt;&amp;2 ; } ||
  { echo &quot;$me: cannot create a temporary directory in $TMPDIR&quot; &gt;&amp;2 ; exit 1 ; } ;
 dummy=$tmp/dummy ;
 tmpfiles=&quot;$dummy.c $dummy.o $dummy.rel $dummy&quot; ;
@@ -122,7 +127,7 @@ case $CC_FOR_BUILD,$HOST_CC,$CC in
 	;;
  ,,*)   CC_FOR_BUILD=$CC ;;
  ,*,*)  CC_FOR_BUILD=$HOST_CC ;;
-esac ;'
+esac ; set_cc_for_build= ;'
 
 # This is needed to find uname on a Pyramid OSx when run in the BSD universe.
 # (<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">ghazi at noc.rutgers.edu</A> 1994-08-24)
@@ -157,6 +162,7 @@ case &quot;${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}&quot; in
 	    arm*) machine=arm-unknown ;;
 	    sh3el) machine=shl-unknown ;;
 	    sh3eb) machine=sh-unknown ;;
+	    sh5el) machine=sh5le-unknown ;;
 	    *) machine=${UNAME_MACHINE_ARCH}-unknown ;;
 	esac
 	# The Operating System including object format, if it has switched
@@ -165,7 +171,7 @@ case &quot;${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}&quot; in
 	    arm*|i386|m68k|ns32k|sh3*|sparc|vax)
 		eval $set_cc_for_build
 		if echo __ELF__ | $CC_FOR_BUILD -E - 2&gt;/dev/null \
-			| grep __ELF__ &gt;/dev/null
+			| grep -q __ELF__
 		then
 		    # Once all utilities can be ECOFF (netbsdecoff) or a.out (netbsdaout).
 		    # Return netbsd for either.  FIX?
@@ -195,50 +201,32 @@ case &quot;${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}&quot; in
 	# contains redundant information, the shorter form:
 	# CPU_TYPE-MANUFACTURER-OPERATING_SYSTEM is used.
 	echo &quot;${machine}-${os}${release}&quot;
-	exit 0 ;;
-    amiga:OpenBSD:*:*)
-	echo m68k-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    arc:OpenBSD:*:*)
-	echo mipsel-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    hp300:OpenBSD:*:*)
-	echo m68k-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    mac68k:OpenBSD:*:*)
-	echo m68k-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    macppc:OpenBSD:*:*)
-	echo powerpc-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    mvme68k:OpenBSD:*:*)
-	echo m68k-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    mvme88k:OpenBSD:*:*)
-	echo m88k-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    mvmeppc:OpenBSD:*:*)
-	echo powerpc-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    pmax:OpenBSD:*:*)
-	echo mipsel-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    sgi:OpenBSD:*:*)
-	echo mipseb-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    sun3:OpenBSD:*:*)
-	echo m68k-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
-    wgrisc:OpenBSD:*:*)
-	echo mipsel-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     *:OpenBSD:*:*)
-	echo ${UNAME_MACHINE}-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
+	UNAME_MACHINE_ARCH=`arch | sed 's/OpenBSD.//'`
+	echo ${UNAME_MACHINE_ARCH}-unknown-openbsd${UNAME_RELEASE}
+	exit ;;
+    *:ekkoBSD:*:*)
+	echo ${UNAME_MACHINE}-unknown-ekkobsd${UNAME_RELEASE}
+	exit ;;
+    *:SolidBSD:*:*)
+	echo ${UNAME_MACHINE}-unknown-solidbsd${UNAME_RELEASE}
+	exit ;;
+    macppc:MirBSD:*:*)
+	echo powerpc-unknown-mirbsd${UNAME_RELEASE}
+	exit ;;
+    *:MirBSD:*:*)
+	echo ${UNAME_MACHINE}-unknown-mirbsd${UNAME_RELEASE}
+	exit ;;
     alpha:OSF1:*:*)
-	if test $UNAME_RELEASE = &quot;V4.0&quot;; then
+	case $UNAME_RELEASE in
+	*4.0)
 		UNAME_RELEASE=`/usr/sbin/sizer -v | awk '{print $3}'`
-	fi
+		;;
+	*5.*)
+	        UNAME_RELEASE=`/usr/sbin/sizer -v | awk '{print $4}'`
+		;;
+	esac
 	# According to Compaq, /usr/sbin/psrinfo has been available on
 	# OSF/1 and Tru64 systems produced since 1995.  I hope that
 	# covers most systems running today.  This code pipes the CPU
@@ -276,39 +264,49 @@ case &quot;${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}&quot; in
 	    &quot;EV7.9 (21364A)&quot;)
 		UNAME_MACHINE=&quot;alphaev79&quot; ;;
 	esac
+	# A Pn.n version is a patched version.
 	# A Vn.n version is a released version.
 	# A Tn.n version is a released field test version.
 	# A Xn.n version is an unreleased experimental baselevel.
 	# 1.2 uses &quot;1.2&quot; for uname -r.
-	echo ${UNAME_MACHINE}-dec-osf`echo ${UNAME_RELEASE} | sed -e 's/^[VTX]//' | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz'`
-	exit 0 ;;
+	echo ${UNAME_MACHINE}-dec-osf`echo ${UNAME_RELEASE} | sed -e 's/^[PVTX]//' | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz'`
+	exit ;;
     Alpha\ *:Windows_NT*:*)
 	# How do we know it's Interix rather than the generic POSIX subsystem?
 	# Should we change UNAME_MACHINE based on the output of uname instead
 	# of the specific Alpha model?
 	echo alpha-pc-interix
-	exit 0 ;;
+	exit ;;
     21064:Windows_NT:50:3)
 	echo alpha-dec-winnt3.5
-	exit 0 ;;
+	exit ;;
     Amiga*:UNIX_System_V:4.0:*)
 	echo m68k-unknown-sysv4
-	exit 0;;
+	exit ;;
     *:[Aa]miga[Oo][Ss]:*:*)
 	echo ${UNAME_MACHINE}-unknown-amigaos
-	exit 0 ;;
+	exit ;;
     *:[Mm]orph[Oo][Ss]:*:*)
 	echo ${UNAME_MACHINE}-unknown-morphos
-	exit 0 ;;
+	exit ;;
     *:OS/390:*:*)
 	echo i370-ibm-openedition
-	exit 0 ;;
+	exit ;;
+    *:z/VM:*:*)
+	echo s390-ibm-zvmoe
+	exit ;;
+    *:OS400:*:*)
+        echo powerpc-ibm-os400
+	exit ;;
     arm:RISC*:1.[012]*:*|arm:riscix:1.[012]*:*)
 	echo arm-acorn-riscix${UNAME_RELEASE}
-	exit 0;;
+	exit ;;
+    arm:riscos:*:*|arm:RISCOS:*:*)
+	echo arm-unknown-riscos
+	exit ;;
     SR2?01:HI-UX/MPP:*:* | SR8000:HI-UX/MPP:*:*)
 	echo hppa1.1-hitachi-hiuxmpp
-	exit 0;;
+	exit ;;
     Pyramid*:OSx*:*:* | MIS*:OSx*:*:* | MIS*:SMP_DC-OSx*:*:*)
 	# <A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">akee at wpdis03.wpafb.af.mil</A> (Earle F. Ake) contributed MIS and NILE.
 	if test &quot;`(/bin/universe) 2&gt;/dev/null`&quot; = att ; then
@@ -316,29 +314,51 @@ case &quot;${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}&quot; in
 	else
 		echo pyramid-pyramid-bsd
 	fi
-	exit 0 ;;
+	exit ;;
     NILE*:*:*:dcosx)
 	echo pyramid-pyramid-svr4
-	exit 0 ;;
-    DRS?6000:UNIX_SV:4.2*:7*)
+	exit ;;
+    DRS?6000:unix:4.0:6*)
+	echo sparc-icl-nx6
+	exit ;;
+    DRS?6000:UNIX_SV:4.2*:7* | DRS?6000:isis:4.2*:7*)
 	case `/usr/bin/uname -p` in
-	    sparc) echo sparc-icl-nx7 &amp;&amp; exit 0 ;;
+	    sparc) echo sparc-icl-nx7; exit ;;
 	esac ;;
+    s390x:SunOS:*:*)
+	echo ${UNAME_MACHINE}-ibm-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
+	exit ;;
     sun4H:SunOS:5.*:*)
 	echo sparc-hal-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
-	exit 0 ;;
+	exit ;;
     sun4*:SunOS:5.*:* | tadpole*:SunOS:5.*:*)
 	echo sparc-sun-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
-	exit 0 ;;
-    i86pc:SunOS:5.*:*)
-	echo i386-pc-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
-	exit 0 ;;
+	exit ;;
+    i86pc:AuroraUX:5.*:* | i86xen:AuroraUX:5.*:*)
+	echo i386-pc-auroraux${UNAME_RELEASE}
+	exit ;;
+    i86pc:SunOS:5.*:* | i86xen:SunOS:5.*:*)
+	eval $set_cc_for_build
+	SUN_ARCH=&quot;i386&quot;
+	# If there is a compiler, see if it is configured for 64-bit objects.
+	# Note that the Sun cc does not turn __LP64__ into 1 like gcc does.
+	# This test works for both compilers.
+	if [ &quot;$CC_FOR_BUILD&quot; != 'no_compiler_found' ]; then
+	    if (echo '#ifdef __amd64'; echo IS_64BIT_ARCH; echo '#endif') | \
+		(CCOPTS= $CC_FOR_BUILD -E - 2&gt;/dev/null) | \
+		grep IS_64BIT_ARCH &gt;/dev/null
+	    then
+		SUN_ARCH=&quot;x86_64&quot;
+	    fi
+	fi
+	echo ${SUN_ARCH}-pc-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
+	exit ;;
     sun4*:SunOS:6*:*)
 	# According to config.sub, this is the proper way to canonicalize
 	# SunOS6.  Hard to guess exactly what SunOS6 will be like, but
 	# it's likely to be more like Solaris than SunOS4.
 	echo sparc-sun-solaris3`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
-	exit 0 ;;
+	exit ;;
     sun4*:SunOS:*:*)
 	case &quot;`/usr/bin/arch -k`&quot; in
 	    Series*|S4*)
@@ -347,10 +367,10 @@ case &quot;${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}&quot; in
 	esac
 	# Japanese Language versions have a version number like `4.1.3-JL'.
 	echo sparc-sun-sunos`echo ${UNAME_RELEASE}|sed -e 's/-/_/'`
-	exit 0 ;;
+	exit ;;
     sun3*:SunOS:*:*)
 	echo m68k-sun-sunos${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     sun*:*:4.2BSD:*)
 	UNAME_RELEASE=`(sed 1q /etc/motd | awk '{print substr($5,1,3)}') 2&gt;/dev/null`
 	test &quot;x${UNAME_RELEASE}&quot; = &quot;x&quot; &amp;&amp; UNAME_RELEASE=3
@@ -362,10 +382,10 @@ case &quot;${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}&quot; in
 		echo sparc-sun-sunos${UNAME_RELEASE}
 		;;
 	esac
-	exit 0 ;;
+	exit ;;
     aushp:SunOS:*:*)
 	echo sparc-auspex-sunos${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     # The situation for MiNT is a little confusing.  The machine name
     # can be virtually everything (everything which is not
     # &quot;atarist&quot; or &quot;atariste&quot; at least should have a processor
@@ -376,37 +396,40 @@ case &quot;${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}&quot; in
     # be no problem.
     atarist[e]:*MiNT:*:* | atarist[e]:*mint:*:* | atarist[e]:*TOS:*:*)
         echo m68k-atari-mint${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     atari*:*MiNT:*:* | atari*:*mint:*:* | atarist[e]:*TOS:*:*)
 	echo m68k-atari-mint${UNAME_RELEASE}
-        exit 0 ;;
+        exit ;;
     *falcon*:*MiNT:*:* | *falcon*:*mint:*:* | *falcon*:*TOS:*:*)
         echo m68k-atari-mint${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     milan*:*MiNT:*:* | milan*:*mint:*:* | *milan*:*TOS:*:*)
         echo m68k-milan-mint${UNAME_RELEASE}
-        exit 0 ;;
+        exit ;;
     hades*:*MiNT:*:* | hades*:*mint:*:* | *hades*:*TOS:*:*)
         echo m68k-hades-mint${UNAME_RELEASE}
-        exit 0 ;;
+        exit ;;
     *:*MiNT:*:* | *:*mint:*:* | *:*TOS:*:*)
         echo m68k-unknown-mint${UNAME_RELEASE}
-        exit 0 ;;
+        exit ;;
+    m68k:machten:*:*)
+	echo m68k-apple-machten${UNAME_RELEASE}
+	exit ;;
     powerpc:machten:*:*)
 	echo powerpc-apple-machten${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     RISC*:Mach:*:*)
 	echo mips-dec-mach_bsd4.3
-	exit 0 ;;
+	exit ;;
     RISC*:ULTRIX:*:*)
 	echo mips-dec-ultrix${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     VAX*:ULTRIX*:*:*)
 	echo vax-dec-ultrix${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     2020:CLIX:*:* | 2430:CLIX:*:*)
 	echo clipper-intergraph-clix${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     mips:*:*:UMIPS | mips:*:*:RISCos)
 	eval $set_cc_for_build
 	sed 's/^	//' &lt;&lt; EOF &gt;$dummy.c
@@ -430,32 +453,33 @@ case &quot;${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}&quot; in
 	  exit (-1);
 	}
 EOF
-	$CC_FOR_BUILD -o $dummy $dummy.c \
-	  &amp;&amp; $dummy `echo &quot;${UNAME_RELEASE}&quot; | sed -n 's/\([0-9]*\).*/\1/p'` \
-	  &amp;&amp; exit 0
+	$CC_FOR_BUILD -o $dummy $dummy.c &amp;&amp;
+	  dummyarg=`echo &quot;${UNAME_RELEASE}&quot; | sed -n 's/\([0-9]*\).*/\1/p'` &amp;&amp;
+	  SYSTEM_NAME=`$dummy $dummyarg` &amp;&amp;
+	    { echo &quot;$SYSTEM_NAME&quot;; exit; }
 	echo mips-mips-riscos${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     Motorola:PowerMAX_OS:*:*)
 	echo powerpc-motorola-powermax
-	exit 0 ;;
+	exit ;;
     Motorola:*:4.3:PL8-*)
 	echo powerpc-harris-powermax
-	exit 0 ;;
+	exit ;;
     Night_Hawk:*:*:PowerMAX_OS | Synergy:PowerMAX_OS:*:*)
 	echo powerpc-harris-powermax
-	exit 0 ;;
+	exit ;;
     Night_Hawk:Power_UNIX:*:*)
 	echo powerpc-harris-powerunix
-	exit 0 ;;
+	exit ;;
     m88k:CX/UX:7*:*)
 	echo m88k-harris-cxux7
-	exit 0 ;;
+	exit ;;
     m88k:*:4*:R4*)
 	echo m88k-motorola-sysv4
-	exit 0 ;;
+	exit ;;
     m88k:*:3*:R3*)
 	echo m88k-motorola-sysv3
-	exit 0 ;;
+	exit ;;
     AViiON:dgux:*:*)
         # DG/UX returns AViiON for all architectures
         UNAME_PROCESSOR=`/usr/bin/uname -p`
@@ -471,29 +495,29 @@ EOF
 	else
 	    echo i586-dg-dgux${UNAME_RELEASE}
 	fi
- 	exit 0 ;;
+ 	exit ;;
     M88*:DolphinOS:*:*)	# DolphinOS (SVR3)
 	echo m88k-dolphin-sysv3
-	exit 0 ;;
+	exit ;;
     M88*:*:R3*:*)
 	# Delta 88k system running SVR3
 	echo m88k-motorola-sysv3
-	exit 0 ;;
+	exit ;;
     XD88*:*:*:*) # Tektronix XD88 system running UTekV (SVR3)
 	echo m88k-tektronix-sysv3
-	exit 0 ;;
+	exit ;;
     Tek43[0-9][0-9]:UTek:*:*) # Tektronix 4300 system running UTek (BSD)
 	echo m68k-tektronix-bsd
-	exit 0 ;;
+	exit ;;
     *:IRIX*:*:*)
 	echo mips-sgi-irix`echo ${UNAME_RELEASE}|sed -e 's/-/_/g'`
-	exit 0 ;;
+	exit ;;
     ????????:AIX?:[12].1:2)   # AIX 2.2.1 or AIX 2.1.1 is RT/PC AIX.
-	echo romp-ibm-aix      # uname -m gives an 8 hex-code CPU id
-	exit 0 ;;              # Note that: echo &quot;'`uname -s`'&quot; gives 'AIX '
+	echo romp-ibm-aix     # uname -m gives an 8 hex-code CPU id
+	exit ;;               # Note that: echo &quot;'`uname -s`'&quot; gives 'AIX '
     i*86:AIX:*:*)
 	echo i386-ibm-aix
-	exit 0 ;;
+	exit ;;
     ia64:AIX:*:*)
 	if [ -x /usr/bin/oslevel ] ; then
 		IBM_REV=`/usr/bin/oslevel`
@@ -501,7 +525,7 @@ EOF
 		IBM_REV=${UNAME_VERSION}.${UNAME_RELEASE}
 	fi
 	echo ${UNAME_MACHINE}-ibm-aix${IBM_REV}
-	exit 0 ;;
+	exit ;;
     *:AIX:2:3)
 	if grep bos325 /usr/include/stdio.h &gt;/dev/null 2&gt;&amp;1; then
 		eval $set_cc_for_build
@@ -516,15 +540,19 @@ EOF
 			exit(0);
 			}
 EOF
-		$CC_FOR_BUILD -o $dummy $dummy.c &amp;&amp; $dummy &amp;&amp; exit 0
-		echo rs6000-ibm-aix3.2.5
+		if $CC_FOR_BUILD -o $dummy $dummy.c &amp;&amp; SYSTEM_NAME=`$dummy`
+		then
+			echo &quot;$SYSTEM_NAME&quot;
+		else
+			echo rs6000-ibm-aix3.2.5
+		fi
 	elif grep bos324 /usr/include/stdio.h &gt;/dev/null 2&gt;&amp;1; then
 		echo rs6000-ibm-aix3.2.4
 	else
 		echo rs6000-ibm-aix3.2
 	fi
-	exit 0 ;;
-    *:AIX:*:[45])
+	exit ;;
+    *:AIX:*:[456])
 	IBM_CPU_ID=`/usr/sbin/lsdev -C -c processor -S available | sed 1q | awk '{ print $1 }'`
 	if /usr/sbin/lsattr -El ${IBM_CPU_ID} | grep ' POWER' &gt;/dev/null 2&gt;&amp;1; then
 		IBM_ARCH=rs6000
@@ -537,28 +565,28 @@ EOF
 		IBM_REV=${UNAME_VERSION}.${UNAME_RELEASE}
 	fi
 	echo ${IBM_ARCH}-ibm-aix${IBM_REV}
-	exit 0 ;;
+	exit ;;
     *:AIX:*:*)
 	echo rs6000-ibm-aix
-	exit 0 ;;
+	exit ;;
     ibmrt:4.4BSD:*|romp-ibm:BSD:*)
 	echo romp-ibm-bsd4.4
-	exit 0 ;;
+	exit ;;
     ibmrt:*BSD:*|romp-ibm:BSD:*)            # covers RT/PC BSD and
 	echo romp-ibm-bsd${UNAME_RELEASE}   # 4.3 with uname added to
-	exit 0 ;;                           # report: romp-ibm BSD 4.3
+	exit ;;                             # report: romp-ibm BSD 4.3
     *:BOSX:*:*)
 	echo rs6000-bull-bosx
-	exit 0 ;;
+	exit ;;
     DPX/2?00:B.O.S.:*:*)
 	echo m68k-bull-sysv3
-	exit 0 ;;
+	exit ;;
     9000/[34]??:4.3bsd:1.*:*)
 	echo m68k-hp-bsd
-	exit 0 ;;
+	exit ;;
     hp300:4.4BSD:*:* | 9000/[34]??:4.3bsd:2.*:*)
 	echo m68k-hp-bsd4.4
-	exit 0 ;;
+	exit ;;
     9000/[34678]??:HP-UX:*:*)
 	HPUX_REV=`echo ${UNAME_RELEASE}|sed -e 's/[^.]*.[0B]*//'`
 	case &quot;${UNAME_MACHINE}&quot; in
@@ -620,9 +648,19 @@ EOF
 	esac
 	if [ ${HP_ARCH} = &quot;hppa2.0w&quot; ]
 	then
-	    # avoid double evaluation of $set_cc_for_build
-	    test -n &quot;$CC_FOR_BUILD&quot; || eval $set_cc_for_build
-	    if echo __LP64__ | (CCOPTS= $CC_FOR_BUILD -E -) | grep __LP64__ &gt;/dev/null
+	    eval $set_cc_for_build
+
+	    # hppa2.0w-hp-hpux* has a 64-bit kernel and a compiler generating
+	    # 32-bit code.  hppa64-hp-hpux* has the same kernel and a compiler
+	    # generating 64-bit code.  GNU and HP use different nomenclature:
+	    #
+	    # $ CC_FOR_BUILD=cc ./config.guess
+	    # =&gt; hppa2.0w-hp-hpux11.23
+	    # $ CC_FOR_BUILD=&quot;cc +DA2.0w&quot; ./config.guess
+	    # =&gt; hppa64-hp-hpux11.23
+
+	    if echo __LP64__ | (CCOPTS= $CC_FOR_BUILD -E - 2&gt;/dev/null) |
+		grep -q __LP64__
 	    then
 		HP_ARCH=&quot;hppa2.0w&quot;
 	    else
@@ -630,11 +668,11 @@ EOF
 	    fi
 	fi
 	echo ${HP_ARCH}-hp-hpux${HPUX_REV}
-	exit 0 ;;
+	exit ;;
     ia64:HP-UX:*:*)
 	HPUX_REV=`echo ${UNAME_RELEASE}|sed -e 's/[^.]*.[0B]*//'`
 	echo ia64-hp-hpux${HPUX_REV}
-	exit 0 ;;
+	exit ;;
     3050*:HI-UX:*:*)
 	eval $set_cc_for_build
 	sed 's/^	//' &lt;&lt; EOF &gt;$dummy.c
@@ -662,205 +700,248 @@ EOF
 	  exit (0);
 	}
 EOF
-	$CC_FOR_BUILD -o $dummy $dummy.c &amp;&amp; $dummy &amp;&amp; exit 0
+	$CC_FOR_BUILD -o $dummy $dummy.c &amp;&amp; SYSTEM_NAME=`$dummy` &amp;&amp;
+		{ echo &quot;$SYSTEM_NAME&quot;; exit; }
 	echo unknown-hitachi-hiuxwe2
-	exit 0 ;;
+	exit ;;
     9000/7??:4.3bsd:*:* | 9000/8?[79]:4.3bsd:*:* )
 	echo hppa1.1-hp-bsd
-	exit 0 ;;
+	exit ;;
     9000/8??:4.3bsd:*:*)
 	echo hppa1.0-hp-bsd
-	exit 0 ;;
+	exit ;;
     *9??*:MPE/iX:*:* | *3000*:MPE/iX:*:*)
 	echo hppa1.0-hp-mpeix
-	exit 0 ;;
+	exit ;;
     hp7??:OSF1:*:* | hp8?[79]:OSF1:*:* )
 	echo hppa1.1-hp-osf
-	exit 0 ;;
+	exit ;;
     hp8??:OSF1:*:*)
 	echo hppa1.0-hp-osf
-	exit 0 ;;
+	exit ;;
     i*86:OSF1:*:*)
 	if [ -x /usr/sbin/sysversion ] ; then
 	    echo ${UNAME_MACHINE}-unknown-osf1mk
 	else
 	    echo ${UNAME_MACHINE}-unknown-osf1
 	fi
-	exit 0 ;;
+	exit ;;
     parisc*:Lites*:*:*)
 	echo hppa1.1-hp-lites
-	exit 0 ;;
+	exit ;;
     C1*:ConvexOS:*:* | convex:ConvexOS:C1*:*)
 	echo c1-convex-bsd
-        exit 0 ;;
+        exit ;;
     C2*:ConvexOS:*:* | convex:ConvexOS:C2*:*)
 	if getsysinfo -f scalar_acc
 	then echo c32-convex-bsd
 	else echo c2-convex-bsd
 	fi
-        exit 0 ;;
+        exit ;;
     C34*:ConvexOS:*:* | convex:ConvexOS:C34*:*)
 	echo c34-convex-bsd
-        exit 0 ;;
+        exit ;;
     C38*:ConvexOS:*:* | convex:ConvexOS:C38*:*)
 	echo c38-convex-bsd
-        exit 0 ;;
+        exit ;;
     C4*:ConvexOS:*:* | convex:ConvexOS:C4*:*)
 	echo c4-convex-bsd
-        exit 0 ;;
+        exit ;;
     CRAY*Y-MP:*:*:*)
 	echo ymp-cray-unicos${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
-	exit 0 ;;
+	exit ;;
     CRAY*[A-Z]90:*:*:*)
 	echo ${UNAME_MACHINE}-cray-unicos${UNAME_RELEASE} \
 	| sed -e 's/CRAY.*\([A-Z]90\)/\1/' \
 	      -e y/ABCDEFGHIJKLMNOPQRSTUVWXYZ/abcdefghijklmnopqrstuvwxyz/ \
 	      -e 's/\.[^.]*$/.X/'
-	exit 0 ;;
+	exit ;;
     CRAY*TS:*:*:*)
 	echo t90-cray-unicos${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
-	exit 0 ;;
+	exit ;;
     CRAY*T3E:*:*:*)
 	echo alphaev5-cray-unicosmk${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
-	exit 0 ;;
+	exit ;;
     CRAY*SV1:*:*:*)
 	echo sv1-cray-unicos${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
-	exit 0 ;;
+	exit ;;
     *:UNICOS/mp:*:*)
-	echo nv1-cray-unicosmp${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/' 
-	exit 0 ;;
+	echo craynv-cray-unicosmp${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
+	exit ;;
     F30[01]:UNIX_System_V:*:* | F700:UNIX_System_V:*:*)
 	FUJITSU_PROC=`uname -m | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz'`
         FUJITSU_SYS=`uname -p | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/\///'`
         FUJITSU_REL=`echo ${UNAME_RELEASE} | sed -e 's/ /_/'`
         echo &quot;${FUJITSU_PROC}-fujitsu-${FUJITSU_SYS}${FUJITSU_REL}&quot;
-        exit 0 ;;
+        exit ;;
+    5000:UNIX_System_V:4.*:*)
+        FUJITSU_SYS=`uname -p | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/\///'`
+        FUJITSU_REL=`echo ${UNAME_RELEASE} | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/ /_/'`
+        echo &quot;sparc-fujitsu-${FUJITSU_SYS}${FUJITSU_REL}&quot;
+	exit ;;
     i*86:BSD/386:*:* | i*86:BSD/OS:*:* | *:Ascend\ Embedded/OS:*:*)
 	echo ${UNAME_MACHINE}-pc-bsdi${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     sparc*:BSD/OS:*:*)
 	echo sparc-unknown-bsdi${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     *:BSD/OS:*:*)
 	echo ${UNAME_MACHINE}-unknown-bsdi${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     *:FreeBSD:*:*)
-	# Determine whether the default compiler uses glibc.
-	eval $set_cc_for_build
-	sed 's/^	//' &lt;&lt; EOF &gt;$dummy.c
-	#include &lt;features.h&gt;
-	#if __GLIBC__ &gt;= 2
-	LIBC=gnu
-	#else
-	LIBC=
-	#endif
-EOF
-	eval `$CC_FOR_BUILD -E $dummy.c 2&gt;/dev/null | grep ^LIBC=`
-	echo ${UNAME_MACHINE}-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'`${LIBC:+-$LIBC}
-	exit 0 ;;
+	case ${UNAME_MACHINE} in
+	    pc98)
+		echo i386-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'` ;;
+	    amd64)
+		echo x86_64-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'` ;;
+	    *)
+		echo ${UNAME_MACHINE}-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'` ;;
+	esac
+	exit ;;
     i*:CYGWIN*:*)
 	echo ${UNAME_MACHINE}-pc-cygwin
-	exit 0 ;;
-    i*:MINGW*:*)
+	exit ;;
+    *:MINGW*:*)
 	echo ${UNAME_MACHINE}-pc-mingw32
-	exit 0 ;;
+	exit ;;
+    i*:windows32*:*)
+    	# uname -m includes &quot;-pc&quot; on this system.
+    	echo ${UNAME_MACHINE}-mingw32
+	exit ;;
     i*:PW*:*)
 	echo ${UNAME_MACHINE}-pc-pw32
-	exit 0 ;;
-    x86:Interix*:3*)
-	echo i586-pc-interix3
-	exit 0 ;;
+	exit ;;
+    *:Interix*:*)
+    	case ${UNAME_MACHINE} in
+	    x86)
+		echo i586-pc-interix${UNAME_RELEASE}
+		exit ;;
+	    authenticamd | genuineintel | EM64T)
+		echo x86_64-unknown-interix${UNAME_RELEASE}
+		exit ;;
+	    IA64)
+		echo ia64-unknown-interix${UNAME_RELEASE}
+		exit ;;
+	esac ;;
     [345]86:Windows_95:* | [345]86:Windows_98:* | [345]86:Windows_NT:*)
 	echo i${UNAME_MACHINE}-pc-mks
-	exit 0 ;;
+	exit ;;
+    8664:Windows_NT:*)
+	echo x86_64-pc-mks
+	exit ;;
     i*:Windows_NT*:* | Pentium*:Windows_NT*:*)
 	# How do we know it's Interix rather than the generic POSIX subsystem?
 	# It also conflicts with pre-2.0 versions of AT&amp;T UWIN. Should we
 	# UNAME_MACHINE based on the output of uname instead of i386?
 	echo i586-pc-interix
-	exit 0 ;;
+	exit ;;
     i*:UWIN*:*)
 	echo ${UNAME_MACHINE}-pc-uwin
-	exit 0 ;;
+	exit ;;
+    amd64:CYGWIN*:*:* | x86_64:CYGWIN*:*:*)
+	echo x86_64-unknown-cygwin
+	exit ;;
     p*:CYGWIN*:*)
 	echo powerpcle-unknown-cygwin
-	exit 0 ;;
+	exit ;;
     prep*:SunOS:5.*:*)
 	echo powerpcle-unknown-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
-	exit 0 ;;
+	exit ;;
     *:GNU:*:*)
+	# the GNU system
 	echo `echo ${UNAME_MACHINE}|sed -e 's,[-/].*$,,'`-unknown-gnu`echo ${UNAME_RELEASE}|sed -e 's,/.*$,,'`
-	exit 0 ;;
+	exit ;;
+    *:GNU/*:*:*)
+	# other systems with GNU libc and userland
+	echo ${UNAME_MACHINE}-unknown-`echo ${UNAME_SYSTEM} | sed 's,^[^/]*/,,' | tr '[A-Z]' '[a-z]'``echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'`-gnu
+	exit ;;
     i*86:Minix:*:*)
 	echo ${UNAME_MACHINE}-pc-minix
-	exit 0 ;;
+	exit ;;
+    alpha:Linux:*:*)
+	case `sed -n '/^cpu model/s/^.*: \(.*\)/\1/p' &lt; /proc/cpuinfo` in
+	  EV5)   UNAME_MACHINE=alphaev5 ;;
+	  EV56)  UNAME_MACHINE=alphaev56 ;;
+	  PCA56) UNAME_MACHINE=alphapca56 ;;
+	  PCA57) UNAME_MACHINE=alphapca56 ;;
+	  EV6)   UNAME_MACHINE=alphaev6 ;;
+	  EV67)  UNAME_MACHINE=alphaev67 ;;
+	  EV68*) UNAME_MACHINE=alphaev68 ;;
+        esac
+	objdump --private-headers /bin/sh | grep -q ld.so.1
+	if test &quot;$?&quot; = 0 ; then LIBC=&quot;libc1&quot; ; else LIBC=&quot;&quot; ; fi
+	echo ${UNAME_MACHINE}-unknown-linux-gnu${LIBC}
+	exit ;;
     arm*:Linux:*:*)
+	eval $set_cc_for_build
+	if echo __ARM_EABI__ | $CC_FOR_BUILD -E - 2&gt;/dev/null \
+	    | grep -q __ARM_EABI__
+	then
+	    echo ${UNAME_MACHINE}-unknown-linux-gnu
+	else
+	    echo ${UNAME_MACHINE}-unknown-linux-gnueabi
+	fi
+	exit ;;
+    avr32*:Linux:*:*)
 	echo ${UNAME_MACHINE}-unknown-linux-gnu
-	exit 0 ;;
-    ia64:Linux:*:*)
-	echo ${UNAME_MACHINE}-unknown-linux-gnu
-	exit 0 ;;
-    m68*:Linux:*:*)
-	echo ${UNAME_MACHINE}-unknown-linux-gnu
-	exit 0 ;;
-    mips:Linux:*:*)
+	exit ;;
+    cris:Linux:*:*)
+	echo cris-axis-linux-gnu
+	exit ;;
+    crisv32:Linux:*:*)
+	echo crisv32-axis-linux-gnu
+	exit ;;
+    frv:Linux:*:*)
+    	echo frv-unknown-linux-gnu
+	exit ;;
+    i*86:Linux:*:*)
+	LIBC=gnu
 	eval $set_cc_for_build
 	sed 's/^	//' &lt;&lt; EOF &gt;$dummy.c
-	#undef CPU
-	#undef mips
-	#undef mipsel
-	#if defined(__MIPSEL__) || defined(__MIPSEL) || defined(_MIPSEL) || defined(MIPSEL)
-	CPU=mipsel
-	#else
-	#if defined(__MIPSEB__) || defined(__MIPSEB) || defined(_MIPSEB) || defined(MIPSEB)
-	CPU=mips
-	#else
-	CPU=
-	#endif
+	#ifdef __dietlibc__
+	LIBC=dietlibc
 	#endif
 EOF
-	eval `$CC_FOR_BUILD -E $dummy.c 2&gt;/dev/null | grep ^CPU=`
-	test x&quot;${CPU}&quot; != x &amp;&amp; echo &quot;${CPU}-unknown-linux-gnu&quot; &amp;&amp; exit 0
-	;;
-    mips64:Linux:*:*)
+	eval `$CC_FOR_BUILD -E $dummy.c 2&gt;/dev/null | grep '^LIBC'`
+	echo &quot;${UNAME_MACHINE}-pc-linux-${LIBC}&quot;
+	exit ;;
+    ia64:Linux:*:*)
+	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	exit ;;
+    m32r*:Linux:*:*)
+	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	exit ;;
+    m68*:Linux:*:*)
+	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	exit ;;
+    mips:Linux:*:* | mips64:Linux:*:*)
 	eval $set_cc_for_build
 	sed 's/^	//' &lt;&lt; EOF &gt;$dummy.c
 	#undef CPU
-	#undef mips64
-	#undef mips64el
+	#undef ${UNAME_MACHINE}
+	#undef ${UNAME_MACHINE}el
 	#if defined(__MIPSEL__) || defined(__MIPSEL) || defined(_MIPSEL) || defined(MIPSEL)
-	CPU=mips64el
+	CPU=${UNAME_MACHINE}el
 	#else
 	#if defined(__MIPSEB__) || defined(__MIPSEB) || defined(_MIPSEB) || defined(MIPSEB)
-	CPU=mips64
+	CPU=${UNAME_MACHINE}
 	#else
 	CPU=
 	#endif
 	#endif
 EOF
-	eval `$CC_FOR_BUILD -E $dummy.c 2&gt;/dev/null | grep ^CPU=`
-	test x&quot;${CPU}&quot; != x &amp;&amp; echo &quot;${CPU}-unknown-linux-gnu&quot; &amp;&amp; exit 0
+	eval `$CC_FOR_BUILD -E $dummy.c 2&gt;/dev/null | grep '^CPU'`
+	test x&quot;${CPU}&quot; != x &amp;&amp; { echo &quot;${CPU}-unknown-linux-gnu&quot;; exit; }
 	;;
-    ppc:Linux:*:*)
-	echo powerpc-unknown-linux-gnu
-	exit 0 ;;
-    ppc64:Linux:*:*)
-	echo powerpc64-unknown-linux-gnu
-	exit 0 ;;
-    alpha:Linux:*:*)
-	case `sed -n '/^cpu model/s/^.*: \(.*\)/\1/p' &lt; /proc/cpuinfo` in
-	  EV5)   UNAME_MACHINE=alphaev5 ;;
-	  EV56)  UNAME_MACHINE=alphaev56 ;;
-	  PCA56) UNAME_MACHINE=alphapca56 ;;
-	  PCA57) UNAME_MACHINE=alphapca56 ;;
-	  EV6)   UNAME_MACHINE=alphaev6 ;;
-	  EV67)  UNAME_MACHINE=alphaev67 ;;
-	  EV68*) UNAME_MACHINE=alphaev68 ;;
-        esac
-	objdump --private-headers /bin/sh | grep ld.so.1 &gt;/dev/null
-	if test &quot;$?&quot; = 0 ; then LIBC=&quot;libc1&quot; ; else LIBC=&quot;&quot; ; fi
-	echo ${UNAME_MACHINE}-unknown-linux-gnu${LIBC}
-	exit 0 ;;
+    or32:Linux:*:*)
+	echo or32-unknown-linux-gnu
+	exit ;;
+    padre:Linux:*:*)
+	echo sparc-unknown-linux-gnu
+	exit ;;
+    parisc64:Linux:*:* | hppa64:Linux:*:*)
+	echo hppa64-unknown-linux-gnu
+	exit ;;
     parisc:Linux:*:* | hppa:Linux:*:*)
 	# Look for CPU level
 	case `grep '^cpu[^a-z]*:' /proc/cpuinfo 2&gt;/dev/null | cut -d' ' -f2` in
@@ -868,81 +949,40 @@ EOF
 	  PA8*) echo hppa2.0-unknown-linux-gnu ;;
 	  *)    echo hppa-unknown-linux-gnu ;;
 	esac
-	exit 0 ;;
-    parisc64:Linux:*:* | hppa64:Linux:*:*)
-	echo hppa64-unknown-linux-gnu
-	exit 0 ;;
+	exit ;;
+    ppc64:Linux:*:*)
+	echo powerpc64-unknown-linux-gnu
+	exit ;;
+    ppc:Linux:*:*)
+	echo powerpc-unknown-linux-gnu
+	exit ;;
     s390:Linux:*:* | s390x:Linux:*:*)
 	echo ${UNAME_MACHINE}-ibm-linux
-	exit 0 ;;
+	exit ;;
+    sh64*:Linux:*:*)
+    	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	exit ;;
     sh*:Linux:*:*)
 	echo ${UNAME_MACHINE}-unknown-linux-gnu
-	exit 0 ;;
+	exit ;;
     sparc:Linux:*:* | sparc64:Linux:*:*)
 	echo ${UNAME_MACHINE}-unknown-linux-gnu
-	exit 0 ;;
+	exit ;;
+    vax:Linux:*:*)
+	echo ${UNAME_MACHINE}-dec-linux-gnu
+	exit ;;
     x86_64:Linux:*:*)
 	echo x86_64-unknown-linux-gnu
-	exit 0 ;;
-    i*86:Linux:*:*)
-	# The BFD linker knows what the default object file format is, so
-	# first see if it will tell us. cd to the root directory to prevent
-	# problems with other programs or directories called `ld' in the path.
-	# Set LC_ALL=C to ensure ld outputs messages in English.
-	ld_supported_targets=`cd /; LC_ALL=C ld --help 2&gt;&amp;1 \
-			 | sed -ne '/supported targets:/!d
-				    s/[ 	][ 	]*/ /g
-				    s/.*supported targets: *//
-				    s/ .*//
-				    p'`
-        case &quot;$ld_supported_targets&quot; in
-	  elf32-i386)
-		TENTATIVE=&quot;${UNAME_MACHINE}-pc-linux-gnu&quot;
-		;;
-	  a.out-i386-linux)
-		echo &quot;${UNAME_MACHINE}-pc-linux-gnuaout&quot;
-		exit 0 ;;
-	  coff-i386)
-		echo &quot;${UNAME_MACHINE}-pc-linux-gnucoff&quot;
-		exit 0 ;;
-	  &quot;&quot;)
-		# Either a pre-BFD a.out linker (linux-gnuoldld) or
-		# one that does not give us useful --help.
-		echo &quot;${UNAME_MACHINE}-pc-linux-gnuoldld&quot;
-		exit 0 ;;
-	esac
-	# Determine whether the default compiler is a.out or elf
-	eval $set_cc_for_build
-	sed 's/^	//' &lt;&lt; EOF &gt;$dummy.c
-	#include &lt;features.h&gt;
-	#ifdef __ELF__
-	# ifdef __GLIBC__
-	#  if __GLIBC__ &gt;= 2
-	LIBC=gnu
-	#  else
-	LIBC=gnulibc1
-	#  endif
-	# else
-	LIBC=gnulibc1
-	# endif
-	#else
-	#ifdef __INTEL_COMPILER
-	LIBC=gnu
-	#else
-	LIBC=gnuaout
-	#endif
-	#endif
-EOF
-	eval `$CC_FOR_BUILD -E $dummy.c 2&gt;/dev/null | grep ^LIBC=`
-	test x&quot;${LIBC}&quot; != x &amp;&amp; echo &quot;${UNAME_MACHINE}-pc-linux-${LIBC}&quot; &amp;&amp; exit 0
-	test x&quot;${TENTATIVE}&quot; != x &amp;&amp; echo &quot;${TENTATIVE}&quot; &amp;&amp; exit 0
-	;;
+	exit ;;
+    xtensa*:Linux:*:*)
+    	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	exit ;;
     i*86:DYNIX/ptx:4*:*)
 	# ptx 4.0 does uname -s correctly, with DYNIX/ptx in there.
 	# earlier versions are messed up and put the nodename in both
 	# sysname and nodename.
 	echo i386-sequent-sysv4
-	exit 0 ;;
+	exit ;;
     i*86:UNIX_SV:4.2MP:2.*)
         # Unixware is an offshoot of SVR4, but it has its own version
         # number series starting with 2...
@@ -950,24 +990,27 @@ EOF
 	# I just have to hope.  -- rms.
         # Use sysv4.2uw... so that sysv4* matches it.
 	echo ${UNAME_MACHINE}-pc-sysv4.2uw${UNAME_VERSION}
-	exit 0 ;;
+	exit ;;
     i*86:OS/2:*:*)
 	# If we were able to find `uname', then EMX Unix compatibility
 	# is probably installed.
 	echo ${UNAME_MACHINE}-pc-os2-emx
-	exit 0 ;;
+	exit ;;
     i*86:XTS-300:*:STOP)
 	echo ${UNAME_MACHINE}-unknown-stop
-	exit 0 ;;
+	exit ;;
     i*86:atheos:*:*)
 	echo ${UNAME_MACHINE}-unknown-atheos
-	exit 0 ;;
-    i*86:LynxOS:2.*:* | i*86:LynxOS:3.[01]*:* | i*86:LynxOS:4.0*:*)
+	exit ;;
+    i*86:syllable:*:*)
+	echo ${UNAME_MACHINE}-pc-syllable
+	exit ;;
+    i*86:LynxOS:2.*:* | i*86:LynxOS:3.[01]*:* | i*86:LynxOS:4.[02]*:*)
 	echo i386-unknown-lynxos${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     i*86:*DOS:*:*)
 	echo ${UNAME_MACHINE}-pc-msdosdjgpp
-	exit 0 ;;
+	exit ;;
     i*86:*:4.*:* | i*86:SYSTEM_V:4.*:*)
 	UNAME_REL=`echo ${UNAME_RELEASE} | sed 's/\/MP$//'`
 	if grep Novell /usr/include/link.h &gt;/dev/null 2&gt;/dev/null; then
@@ -975,15 +1018,16 @@ EOF
 	else
 		echo ${UNAME_MACHINE}-pc-sysv${UNAME_REL}
 	fi
-	exit 0 ;;
-    i*86:*:5:[78]*)
+	exit ;;
+    i*86:*:5:[678]*)
+    	# UnixWare 7.x, OpenUNIX and OpenServer 6.
 	case `/bin/uname -X | grep &quot;^Machine&quot;` in
 	    *486*)	     UNAME_MACHINE=i486 ;;
 	    *Pentium)	     UNAME_MACHINE=i586 ;;
 	    *Pent*|*Celeron) UNAME_MACHINE=i686 ;;
 	esac
 	echo ${UNAME_MACHINE}-unknown-sysv${UNAME_RELEASE}${UNAME_SYSTEM}${UNAME_VERSION}
-	exit 0 ;;
+	exit ;;
     i*86:*:3.2:*)
 	if test -f /usr/options/cb.name; then
 		UNAME_REL=`sed -n 's/.*Version //p' &lt;/usr/options/cb.name`
@@ -1001,73 +1045,86 @@ EOF
 	else
 		echo ${UNAME_MACHINE}-pc-sysv32
 	fi
-	exit 0 ;;
+	exit ;;
     pc:*:*:*)
 	# Left here for compatibility:
         # uname -m prints for DJGPP always 'pc', but it prints nothing about
-        # the processor, so we play safe by assuming i386.
-	echo i386-pc-msdosdjgpp
-        exit 0 ;;
+        # the processor, so we play safe by assuming i586.
+	# Note: whatever this is, it MUST be the same as what config.sub
+	# prints for the &quot;djgpp&quot; host, or else GDB configury will decide that
+	# this is a cross-build.
+	echo i586-pc-msdosdjgpp
+        exit ;;
     Intel:Mach:3*:*)
 	echo i386-pc-mach3
-	exit 0 ;;
+	exit ;;
     paragon:*:*:*)
 	echo i860-intel-osf1
-	exit 0 ;;
+	exit ;;
     i860:*:4.*:*) # i860-SVR4
 	if grep Stardent /usr/include/sys/uadmin.h &gt;/dev/null 2&gt;&amp;1 ; then
 	  echo i860-stardent-sysv${UNAME_RELEASE} # Stardent Vistra i860-SVR4
 	else # Add other i860-SVR4 vendors below as they are discovered.
 	  echo i860-unknown-sysv${UNAME_RELEASE}  # Unknown i860-SVR4
 	fi
-	exit 0 ;;
+	exit ;;
     mini*:CTIX:SYS*5:*)
 	# &quot;miniframe&quot;
 	echo m68010-convergent-sysv
-	exit 0 ;;
+	exit ;;
     mc68k:UNIX:SYSTEM5:3.51m)
 	echo m68k-convergent-sysv
-	exit 0 ;;
+	exit ;;
     M680?0:D-NIX:5.3:*)
 	echo m68k-diab-dnix
-	exit 0 ;;
-    M68*:*:R3V[567]*:*)
-	test -r /sysV68 &amp;&amp; echo 'm68k-motorola-sysv' &amp;&amp; exit 0 ;;
-    3[34]??:*:4.0:3.0 | 3[34]??A:*:4.0:3.0 | 3[34]??,*:*:4.0:3.0 | 3[34]??/*:*:4.0:3.0 | 4400:*:4.0:3.0 | 4850:*:4.0:3.0 | SKA40:*:4.0:3.0 | SDS2:*:4.0:3.0)
+	exit ;;
+    M68*:*:R3V[5678]*:*)
+	test -r /sysV68 &amp;&amp; { echo 'm68k-motorola-sysv'; exit; } ;;
+    3[345]??:*:4.0:3.0 | 3[34]??A:*:4.0:3.0 | 3[34]??,*:*:4.0:3.0 | 3[34]??/*:*:4.0:3.0 | 4400:*:4.0:3.0 | 4850:*:4.0:3.0 | SKA40:*:4.0:3.0 | SDS2:*:4.0:3.0 | SHG2:*:4.0:3.0 | S7501*:*:4.0:3.0)
 	OS_REL=''
 	test -r /etc/.relid \
 	&amp;&amp; OS_REL=.`sed -n 's/[^ ]* [^ ]* \([0-9][0-9]\).*/\1/p' &lt; /etc/.relid`
 	/bin/uname -p 2&gt;/dev/null | grep 86 &gt;/dev/null \
-	  &amp;&amp; echo i486-ncr-sysv4.3${OS_REL} &amp;&amp; exit 0
+	  &amp;&amp; { echo i486-ncr-sysv4.3${OS_REL}; exit; }
 	/bin/uname -p 2&gt;/dev/null | /bin/grep entium &gt;/dev/null \
-	  &amp;&amp; echo i586-ncr-sysv4.3${OS_REL} &amp;&amp; exit 0 ;;
+	  &amp;&amp; { echo i586-ncr-sysv4.3${OS_REL}; exit; } ;;
     3[34]??:*:4.0:* | 3[34]??,*:*:4.0:*)
         /bin/uname -p 2&gt;/dev/null | grep 86 &gt;/dev/null \
-          &amp;&amp; echo i486-ncr-sysv4 &amp;&amp; exit 0 ;;
+          &amp;&amp; { echo i486-ncr-sysv4; exit; } ;;
+    NCR*:*:4.2:* | MPRAS*:*:4.2:*)
+	OS_REL='.3'
+	test -r /etc/.relid \
+	    &amp;&amp; OS_REL=.`sed -n 's/[^ ]* [^ ]* \([0-9][0-9]\).*/\1/p' &lt; /etc/.relid`
+	/bin/uname -p 2&gt;/dev/null | grep 86 &gt;/dev/null \
+	    &amp;&amp; { echo i486-ncr-sysv4.3${OS_REL}; exit; }
+	/bin/uname -p 2&gt;/dev/null | /bin/grep entium &gt;/dev/null \
+	    &amp;&amp; { echo i586-ncr-sysv4.3${OS_REL}; exit; }
+	/bin/uname -p 2&gt;/dev/null | /bin/grep pteron &gt;/dev/null \
+	    &amp;&amp; { echo i586-ncr-sysv4.3${OS_REL}; exit; } ;;
     m68*:LynxOS:2.*:* | m68*:LynxOS:3.0*:*)
 	echo m68k-unknown-lynxos${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     mc68030:UNIX_System_V:4.*:*)
 	echo m68k-atari-sysv4
-	exit 0 ;;
+	exit ;;
     TSUNAMI:LynxOS:2.*:*)
 	echo sparc-unknown-lynxos${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     rs6000:LynxOS:2.*:*)
 	echo rs6000-unknown-lynxos${UNAME_RELEASE}
-	exit 0 ;;
-    PowerPC:LynxOS:2.*:* | PowerPC:LynxOS:3.[01]*:* | PowerPC:LynxOS:4.0*:*)
+	exit ;;
+    PowerPC:LynxOS:2.*:* | PowerPC:LynxOS:3.[01]*:* | PowerPC:LynxOS:4.[02]*:*)
 	echo powerpc-unknown-lynxos${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     SM[BE]S:UNIX_SV:*:*)
 	echo mips-dde-sysv${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     RM*:ReliantUNIX-*:*:*)
 	echo mips-sni-sysv4
-	exit 0 ;;
+	exit ;;
     RM*:SINIX-*:*:*)
 	echo mips-sni-sysv4
-	exit 0 ;;
+	exit ;;
     *:SINIX-*:*:*)
 	if uname -p 2&gt;/dev/null &gt;/dev/null ; then
 		UNAME_MACHINE=`(uname -p) 2&gt;/dev/null`
@@ -1075,68 +1132,94 @@ EOF
 	else
 		echo ns32k-sni-sysv
 	fi
-	exit 0 ;;
+	exit ;;
     PENTIUM:*:4.0*:*) # Unisys `ClearPath HMP IX 4000' SVR4/MP effort
                       # says &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">Richard.M.Bartel at ccMail.Census.GOV</A>&gt;
         echo i586-unisys-sysv4
-        exit 0 ;;
+        exit ;;
     *:UNIX_System_V:4*:FTX*)
 	# From Gerald Hewes &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">hewes at openmarket.com</A>&gt;.
 	# How about differentiating between stratus architectures? -djm
 	echo hppa1.1-stratus-sysv4
-	exit 0 ;;
+	exit ;;
     *:*:*:FTX*)
 	# From <A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">seanf at swdc.stratus.com.</A>
 	echo i860-stratus-sysv4
-	exit 0 ;;
+	exit ;;
+    i*86:VOS:*:*)
+	# From <A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">Paul.Green at stratus.com.</A>
+	echo ${UNAME_MACHINE}-stratus-vos
+	exit ;;
     *:VOS:*:*)
 	# From <A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">Paul.Green at stratus.com.</A>
 	echo hppa1.1-stratus-vos
-	exit 0 ;;
+	exit ;;
     mc68*:A/UX:*:*)
 	echo m68k-apple-aux${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     news*:NEWS-OS:6*:*)
 	echo mips-sony-newsos6
-	exit 0 ;;
+	exit ;;
     R[34]000:*System_V*:*:* | R4000:UNIX_SYSV:*:* | R*000:UNIX_SV:*:*)
 	if [ -d /usr/nec ]; then
 	        echo mips-nec-sysv${UNAME_RELEASE}
 	else
 	        echo mips-unknown-sysv${UNAME_RELEASE}
 	fi
-        exit 0 ;;
+        exit ;;
     BeBox:BeOS:*:*)	# BeOS running on hardware made by Be, PPC only.
 	echo powerpc-be-beos
-	exit 0 ;;
+	exit ;;
     BeMac:BeOS:*:*)	# BeOS running on Mac or Mac clone, PPC only.
 	echo powerpc-apple-beos
-	exit 0 ;;
+	exit ;;
     BePC:BeOS:*:*)	# BeOS running on Intel PC compatible.
 	echo i586-pc-beos
-	exit 0 ;;
+	exit ;;
+    BePC:Haiku:*:*)	# Haiku running on Intel PC compatible.
+	echo i586-pc-haiku
+	exit ;;
     SX-4:SUPER-UX:*:*)
 	echo sx4-nec-superux${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     SX-5:SUPER-UX:*:*)
 	echo sx5-nec-superux${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     SX-6:SUPER-UX:*:*)
 	echo sx6-nec-superux${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
+    SX-7:SUPER-UX:*:*)
+	echo sx7-nec-superux${UNAME_RELEASE}
+	exit ;;
+    SX-8:SUPER-UX:*:*)
+	echo sx8-nec-superux${UNAME_RELEASE}
+	exit ;;
+    SX-8R:SUPER-UX:*:*)
+	echo sx8r-nec-superux${UNAME_RELEASE}
+	exit ;;
     Power*:Rhapsody:*:*)
 	echo powerpc-apple-rhapsody${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     *:Rhapsody:*:*)
 	echo ${UNAME_MACHINE}-apple-rhapsody${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     *:Darwin:*:*)
-	case `uname -p` in
-	    *86) UNAME_PROCESSOR=i686 ;;
-	    powerpc) UNAME_PROCESSOR=powerpc ;;
+	UNAME_PROCESSOR=`uname -p` || UNAME_PROCESSOR=unknown
+	case $UNAME_PROCESSOR in
+	    i386)
+		eval $set_cc_for_build
+		if [ &quot;$CC_FOR_BUILD&quot; != 'no_compiler_found' ]; then
+		  if (echo '#ifdef __LP64__'; echo IS_64BIT_ARCH; echo '#endif') | \
+		      (CCOPTS= $CC_FOR_BUILD -E - 2&gt;/dev/null) | \
+		      grep IS_64BIT_ARCH &gt;/dev/null
+		  then
+		      UNAME_PROCESSOR=&quot;x86_64&quot;
+		  fi
+		fi ;;
+	    unknown) UNAME_PROCESSOR=powerpc ;;
 	esac
 	echo ${UNAME_PROCESSOR}-apple-darwin${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     *:procnto*:*:* | *:QNX:[0123456789]*:*)
 	UNAME_PROCESSOR=`uname -p`
 	if test &quot;$UNAME_PROCESSOR&quot; = &quot;x86&quot;; then
@@ -1144,22 +1227,25 @@ EOF
 		UNAME_MACHINE=pc
 	fi
 	echo ${UNAME_PROCESSOR}-${UNAME_MACHINE}-nto-qnx${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     *:QNX:*:4*)
 	echo i386-pc-qnx
-	exit 0 ;;
-    NSR-[DGKLNPTVW]:NONSTOP_KERNEL:*:*)
+	exit ;;
+    NSE-?:NONSTOP_KERNEL:*:*)
+	echo nse-tandem-nsk${UNAME_RELEASE}
+	exit ;;
+    NSR-?:NONSTOP_KERNEL:*:*)
 	echo nsr-tandem-nsk${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     *:NonStop-UX:*:*)
 	echo mips-compaq-nonstopux
-	exit 0 ;;
+	exit ;;
     BS2000:POSIX*:*:*)
 	echo bs2000-siemens-sysv
-	exit 0 ;;
+	exit ;;
     DS/*:UNIX_System_V:*:*)
 	echo ${UNAME_MACHINE}-${UNAME_SYSTEM}-${UNAME_RELEASE}
-	exit 0 ;;
+	exit ;;
     *:Plan9:*:*)
 	# &quot;uname -m&quot; is not consistent, so use $cputype instead. 386
 	# is converted to i386 for consistency with other x86
@@ -1170,25 +1256,50 @@ EOF
 	    UNAME_MACHINE=&quot;$cputype&quot;
 	fi
 	echo ${UNAME_MACHINE}-unknown-plan9
-	exit 0 ;;
+	exit ;;
     *:TOPS-10:*:*)
 	echo pdp10-unknown-tops10
-	exit 0 ;;
+	exit ;;
     *:TENEX:*:*)
 	echo pdp10-unknown-tenex
-	exit 0 ;;
+	exit ;;
     KS10:TOPS-20:*:* | KL10:TOPS-20:*:* | TYPE4:TOPS-20:*:*)
 	echo pdp10-dec-tops20
-	exit 0 ;;
+	exit ;;
     XKL-1:TOPS-20:*:* | TYPE5:TOPS-20:*:*)
 	echo pdp10-xkl-tops20
-	exit 0 ;;
+	exit ;;
     *:TOPS-20:*:*)
 	echo pdp10-unknown-tops20
-	exit 0 ;;
+	exit ;;
     *:ITS:*:*)
 	echo pdp10-unknown-its
-	exit 0 ;;
+	exit ;;
+    SEI:*:*:SEIUX)
+        echo mips-sei-seiux${UNAME_RELEASE}
+	exit ;;
+    *:DragonFly:*:*)
+	echo ${UNAME_MACHINE}-unknown-dragonfly`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'`
+	exit ;;
+    *:*VMS:*:*)
+    	UNAME_MACHINE=`(uname -p) 2&gt;/dev/null`
+	case &quot;${UNAME_MACHINE}&quot; in
+	    A*) echo alpha-dec-vms ; exit ;;
+	    I*) echo ia64-dec-vms ; exit ;;
+	    V*) echo vax-dec-vms ; exit ;;
+	esac ;;
+    *:XENIX:*:SysV)
+	echo i386-pc-xenix
+	exit ;;
+    i*86:skyos:*:*)
+	echo ${UNAME_MACHINE}-pc-skyos`echo ${UNAME_RELEASE}` | sed -e 's/ .*$//'
+	exit ;;
+    i*86:rdos:*:*)
+	echo ${UNAME_MACHINE}-pc-rdos
+	exit ;;
+    i*86:AROS:*:*)
+	echo ${UNAME_MACHINE}-pc-aros
+	exit ;;
 esac
 
 #echo '(No uname command or uname output not recognized.)' 1&gt;&amp;2
@@ -1220,7 +1331,7 @@ main ()
 #endif
 
 #if defined (__arm) &amp;&amp; defined (__acorn) &amp;&amp; defined (__unix)
-  printf (&quot;arm-acorn-riscix&quot;); exit (0);
+  printf (&quot;arm-acorn-riscix\n&quot;); exit (0);
 #endif
 
 #if defined (hp300) &amp;&amp; !defined (hpux)
@@ -1309,11 +1420,12 @@ main ()
 }
 EOF
 
-$CC_FOR_BUILD -o $dummy $dummy.c 2&gt;/dev/null &amp;&amp; $dummy &amp;&amp; exit 0
+$CC_FOR_BUILD -o $dummy $dummy.c 2&gt;/dev/null &amp;&amp; SYSTEM_NAME=`$dummy` &amp;&amp;
+	{ echo &quot;$SYSTEM_NAME&quot;; exit; }
 
 # Apollos put the system type in the environment.
 
-test -d /usr/apollo &amp;&amp; { echo ${ISP}-apollo-${SYSTYPE}; exit 0; }
+test -d /usr/apollo &amp;&amp; { echo ${ISP}-apollo-${SYSTYPE}; exit; }
 
 # Convex versions that predate uname can use getsysinfo(1)
 
@@ -1322,22 +1434,22 @@ then
     case `getsysinfo -f cpu_type` in
     c1*)
 	echo c1-convex-bsd
-	exit 0 ;;
+	exit ;;
     c2*)
 	if getsysinfo -f scalar_acc
 	then echo c32-convex-bsd
 	else echo c2-convex-bsd
 	fi
-	exit 0 ;;
+	exit ;;
     c34*)
 	echo c34-convex-bsd
-	exit 0 ;;
+	exit ;;
     c38*)
 	echo c38-convex-bsd
-	exit 0 ;;
+	exit ;;
     c4*)
 	echo c4-convex-bsd
-	exit 0 ;;
+	exit ;;
     esac
 fi
 
@@ -1348,7 +1460,9 @@ This script, last modified $timestamp, has failed to recognize
 the operating system you are using. It is advised that you
 download the most up to date version of the config scripts from
 
-    <A HREF="ftp://ftp.gnu.org/pub/gnu/config/">ftp://ftp.gnu.org/pub/gnu/config/</A>
+  <A HREF="http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.guess;hb=HEAD">http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.guess;hb=HEAD</A>
+and
+  <A HREF="http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.sub;hb=HEAD">http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.sub;hb=HEAD</A>
 
 If the version you run ($0) is already up to date, please
 send the following data and any information you think might be
diff --git a/nx-X11/lib/Xft/config.sub b/nx-X11/lib/Xft/config.sub
index 9772e87..c2d1257 100755
--- a/nx-X11/lib/Xft/config.sub
+++ b/nx-X11/lib/Xft/config.sub
@@ -1,9 +1,10 @@
 #! /bin/sh
 # Configuration validation subroutine script.
 #   Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999,
-#   2000, 2001, 2002, 2003 Free Software Foundation, Inc.
+#   2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010
+#   Free Software Foundation, Inc.
 
-timestamp='2003-02-22'
+timestamp='2010-01-22'
 
 # This file is (in principle) common to ALL GNU software.
 # The presence of a machine in this file suggests that SOME GNU software
@@ -21,22 +22,26 @@ timestamp='2003-02-22'
 #
 # You should have received a copy of the GNU General Public License
 # along with this program; if not, write to the Free Software
-# Foundation, Inc., 59 Temple Place - Suite 330,
-# Boston, MA 02111-1307, USA.
-
+# Foundation, Inc., 51 Franklin Street - Fifth Floor, Boston, MA
+# 02110-1301, USA.
+#
 # As a special exception to the GNU General Public License, if you
 # distribute this file as part of a program that contains a
 # configuration script generated by Autoconf, you may include it under
 # the same distribution terms that you use for the rest of that program.
 
+
 # Please send patches to &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">config-patches at gnu.org</A>&gt;.  Submit a context
-# diff and a properly formatted ChangeLog entry.
+# diff and a properly formatted GNU ChangeLog entry.
 #
 # Configuration subroutine to validate and canonicalize a configuration type.
 # Supply the specified configuration type as an argument.
 # If it is invalid, we print an error message on stderr and exit with code 1.
 # Otherwise, we print the canonical config type on stdout and succeed.
 
+# You can get the latest version of this script from:
+# <A HREF="http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.sub;hb=HEAD">http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.sub;hb=HEAD</A>
+
 # This file is supposed to be the same for all GNU packages
 # and recognize all the CPU types, system types and aliases
 # that are meaningful with *any* GNU software.
@@ -70,8 +75,9 @@ Report bugs and patches to &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">config-patches at gnu.org</A>&gt;.&quot;
 version=&quot;\
 GNU config.sub ($timestamp)
 
-Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
-Free Software Foundation, Inc.
+Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000,
+2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010 Free
+Software Foundation, Inc.
 
 This is free software; see the source for copying conditions.  There is NO
 warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&quot;
@@ -83,11 +89,11 @@ Try \`$me --help' for more information.&quot;
 while test $# -gt 0 ; do
   case $1 in
     --time-stamp | --time* | -t )
-       echo &quot;$timestamp&quot; ; exit 0 ;;
+       echo &quot;$timestamp&quot; ; exit ;;
     --version | -v )
-       echo &quot;$version&quot; ; exit 0 ;;
+       echo &quot;$version&quot; ; exit ;;
     --help | --h* | -h )
-       echo &quot;$usage&quot;; exit 0 ;;
+       echo &quot;$usage&quot;; exit ;;
     -- )     # Stop option processing
        shift; break ;;
     - )	# Use stdin as input.
@@ -99,7 +105,7 @@ while test $# -gt 0 ; do
     *local*)
        # First pass through any local machine types.
        echo $1
-       exit 0;;
+       exit ;;
 
     * )
        break ;;
@@ -118,7 +124,10 @@ esac
 # Here we must recognize all the valid KERNEL-OS combinations.
 maybe_os=`echo $1 | sed 's/^\(.*\)-\([^-]*-[^-]*\)$/\2/'`
 case $maybe_os in
-  nto-qnx* | linux-gnu* | freebsd*-gnu* | netbsd*-gnu* | storm-chaos* | os2-emx* | rtmk-nova*)
+  nto-qnx* | linux-gnu* | linux-dietlibc | linux-newlib* | linux-uclibc* | \
+  uclinux-uclibc* | uclinux-gnu* | kfreebsd*-gnu* | knetbsd*-gnu* | netbsd*-gnu* | \
+  kopensolaris*-gnu* | \
+  storm-chaos* | os2-emx* | rtmk-nova*)
     os=-$maybe_os
     basic_machine=`echo $1 | sed 's/^\(.*\)-\([^-]*-[^-]*\)$/\1/'`
     ;;
@@ -144,10 +153,13 @@ case $os in
 	-convergent* | -ncr* | -news | -32* | -3600* | -3100* | -hitachi* |\
 	-c[123]* | -convex* | -sun | -crds | -omron* | -dg | -ultra | -tti* | \
 	-harris | -dolphin | -highlevel | -gould | -cbm | -ns | -masscomp | \
-	-apple | -axis)
+	-apple | -axis | -knuth | -cray | -microblaze)
 		os=
 		basic_machine=$1
 		;;
+        -bluegene*)
+	        os=-cnk
+		;;
 	-sim | -cisco | -oki | -wec | -winbond)
 		os=
 		basic_machine=$1
@@ -169,6 +181,10 @@ case $os in
 	-hiux*)
 		os=-hiuxwe2
 		;;
+	-sco6)
+		os=-sco5v6
+		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
+		;;
 	-sco5)
 		os=-sco3.2v5
 		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
@@ -185,6 +201,10 @@ case $os in
 		# Don't forget version if it is 3.2v4 or newer.
 		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
 		;;
+	-sco5v6*)
+		# Don't forget version if it is 3.2v4 or newer.
+		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
+		;;
 	-sco*)
 		os=-sco3.2v2
 		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
@@ -228,53 +248,71 @@ case $basic_machine in
 	| a29k \
 	| alpha | alphaev[4-8] | alphaev56 | alphaev6[78] | alphapca5[67] \
 	| alpha64 | alpha64ev[4-8] | alpha64ev56 | alpha64ev6[78] | alpha64pca5[67] \
-	| arc | arm | arm[bl]e | arme[lb] | armv[2345] | armv[345][lb] | avr \
-	| clipper \
+	| am33_2.0 \
+	| arc | arm | arm[bl]e | arme[lb] | armv[2345] | armv[345][lb] | avr | avr32 \
+	| bfin \
+	| c4x | clipper \
 	| d10v | d30v | dlx | dsp16xx \
-	| fr30 | frv \
+	| fido | fr30 | frv \
 	| h8300 | h8500 | hppa | hppa1.[01] | hppa2.0 | hppa2.0[nw] | hppa64 \
 	| i370 | i860 | i960 | ia64 \
-	| ip2k \
-	| m32r | m68000 | m68k | m88k | mcore \
+	| ip2k | iq2000 \
+	| lm32 \
+	| m32c | m32r | m32rle | m68000 | m68k | m88k \
+	| maxq | mb | microblaze | mcore | mep | metag \
 	| mips | mipsbe | mipseb | mipsel | mipsle \
 	| mips16 \
 	| mips64 | mips64el \
-	| mips64vr | mips64vrel \
+	| mips64octeon | mips64octeonel \
 	| mips64orion | mips64orionel \
+	| mips64r5900 | mips64r5900el \
+	| mips64vr | mips64vrel \
 	| mips64vr4100 | mips64vr4100el \
 	| mips64vr4300 | mips64vr4300el \
 	| mips64vr5000 | mips64vr5000el \
+	| mips64vr5900 | mips64vr5900el \
 	| mipsisa32 | mipsisa32el \
 	| mipsisa32r2 | mipsisa32r2el \
 	| mipsisa64 | mipsisa64el \
+	| mipsisa64r2 | mipsisa64r2el \
 	| mipsisa64sb1 | mipsisa64sb1el \
 	| mipsisa64sr71k | mipsisa64sr71kel \
 	| mipstx39 | mipstx39el \
 	| mn10200 | mn10300 \
+	| moxie \
+	| mt \
 	| msp430 \
+	| nios | nios2 \
 	| ns16k | ns32k \
-	| openrisc | or32 \
+	| or32 \
 	| pdp10 | pdp11 | pj | pjl \
 	| powerpc | powerpc64 | powerpc64le | powerpcle | ppcbe \
 	| pyramid \
-	| sh | sh[1234] | sh[23]e | sh[34]eb | shbe | shle | sh[1234]le | sh3ele \
+	| rx \
+	| score \
+	| sh | sh[1234] | sh[24]a | sh[24]aeb | sh[23]e | sh[34]eb | sheb | shbe | shle | sh[1234]le | sh3ele \
 	| sh64 | sh64le \
-	| sparc | sparc64 | sparc86x | sparclet | sparclite | sparcv9 | sparcv9b \
-	| strongarm \
-	| tahoe | thumb | tic80 | tron \
+	| sparc | sparc64 | sparc64b | sparc64v | sparc86x | sparclet | sparclite \
+	| sparcv8 | sparcv9 | sparcv9b | sparcv9v \
+	| spu | strongarm \
+	| tahoe | thumb | tic4x | tic80 | tron \
+	| ubicom32 \
 	| v850 | v850e \
 	| we32k \
-	| x86 | xscale | xstormy16 | xtensa \
-	| z8k)
+	| x86 | xc16x | xscale | xscalee[bl] | xstormy16 | xtensa \
+	| z8k | z80)
 		basic_machine=$basic_machine-unknown
 		;;
-	m6811 | m68hc11 | m6812 | m68hc12)
+	m6811 | m68hc11 | m6812 | m68hc12 | picochip)
 		# Motorola 68HC11/12.
 		basic_machine=$basic_machine-unknown
 		os=-none
 		;;
 	m88110 | m680[12346]0 | m683?2 | m68360 | m5200 | v70 | w65 | z8k)
 		;;
+	ms1)
+		basic_machine=mt-unknown
+		;;
 
 	# We use `pc' rather than `unknown'
 	# because (1) that's what they normally are, and
@@ -294,54 +332,69 @@ case $basic_machine in
 	| alpha64-* | alpha64ev[4-8]-* | alpha64ev56-* | alpha64ev6[78]-* \
 	| alphapca5[67]-* | alpha64pca5[67]-* | arc-* \
 	| arm-*  | armbe-* | armle-* | armeb-* | armv*-* \
-	| avr-* \
-	| bs2000-* \
+	| avr-* | avr32-* \
+	| bfin-* | bs2000-* \
 	| c[123]* | c30-* | [cjt]90-* | c4x-* | c54x-* | c55x-* | c6x-* \
-	| clipper-* | cydra-* \
+	| clipper-* | craynv-* | cydra-* \
 	| d10v-* | d30v-* | dlx-* \
 	| elxsi-* \
-	| f30[01]-* | f700-* | fr30-* | frv-* | fx80-* \
+	| f30[01]-* | f700-* | fido-* | fr30-* | frv-* | fx80-* \
 	| h8300-* | h8500-* \
 	| hppa-* | hppa1.[01]-* | hppa2.0-* | hppa2.0[nw]-* | hppa64-* \
 	| i*86-* | i860-* | i960-* | ia64-* \
-	| ip2k-* \
-	| m32r-* \
+	| ip2k-* | iq2000-* \
+	| lm32-* \
+	| m32c-* | m32r-* | m32rle-* \
 	| m68000-* | m680[012346]0-* | m68360-* | m683?2-* | m68k-* \
-	| m88110-* | m88k-* | mcore-* \
+	| m88110-* | m88k-* | maxq-* | mcore-* | metag-* | microblaze-* \
 	| mips-* | mipsbe-* | mipseb-* | mipsel-* | mipsle-* \
 	| mips16-* \
 	| mips64-* | mips64el-* \
-	| mips64vr-* | mips64vrel-* \
+	| mips64octeon-* | mips64octeonel-* \
 	| mips64orion-* | mips64orionel-* \
+	| mips64r5900-* | mips64r5900el-* \
+	| mips64vr-* | mips64vrel-* \
 	| mips64vr4100-* | mips64vr4100el-* \
 	| mips64vr4300-* | mips64vr4300el-* \
 	| mips64vr5000-* | mips64vr5000el-* \
+	| mips64vr5900-* | mips64vr5900el-* \
 	| mipsisa32-* | mipsisa32el-* \
 	| mipsisa32r2-* | mipsisa32r2el-* \
 	| mipsisa64-* | mipsisa64el-* \
+	| mipsisa64r2-* | mipsisa64r2el-* \
 	| mipsisa64sb1-* | mipsisa64sb1el-* \
 	| mipsisa64sr71k-* | mipsisa64sr71kel-* \
 	| mipstx39-* | mipstx39el-* \
+	| mmix-* \
+	| mt-* \
 	| msp430-* \
-	| none-* | np1-* | nv1-* | ns16k-* | ns32k-* \
+	| nios-* | nios2-* \
+	| none-* | np1-* | ns16k-* | ns32k-* \
 	| orion-* \
 	| pdp10-* | pdp11-* | pj-* | pjl-* | pn-* | power-* \
 	| powerpc-* | powerpc64-* | powerpc64le-* | powerpcle-* | ppcbe-* \
 	| pyramid-* \
-	| romp-* | rs6000-* \
-	| sh-* | sh[1234]-* | sh[23]e-* | sh[34]eb-* | shbe-* \
+	| romp-* | rs6000-* | rx-* \
+	| sh-* | sh[1234]-* | sh[24]a-* | sh[24]aeb-* | sh[23]e-* | sh[34]eb-* | sheb-* | shbe-* \
 	| shle-* | sh[1234]le-* | sh3ele-* | sh64-* | sh64le-* \
-	| sparc-* | sparc64-* | sparc86x-* | sparclet-* | sparclite-* \
-	| sparcv9-* | sparcv9b-* | strongarm-* | sv1-* | sx?-* \
+	| sparc-* | sparc64-* | sparc64b-* | sparc64v-* | sparc86x-* | sparclet-* \
+	| sparclite-* \
+	| sparcv8-* | sparcv9-* | sparcv9b-* | sparcv9v-* | strongarm-* | sv1-* | sx?-* \
 	| tahoe-* | thumb-* \
 	| tic30-* | tic4x-* | tic54x-* | tic55x-* | tic6x-* | tic80-* \
+	| tile-* | tilegx-* \
 	| tron-* \
+	| ubicom32-* \
 	| v850-* | v850e-* | vax-* \
 	| we32k-* \
-	| x86-* | x86_64-* | xps100-* | xscale-* | xstormy16-* \
-	| xtensa-* \
+	| x86-* | x86_64-* | xc16x-* | xps100-* | xscale-* | xscalee[bl]-* \
+	| xstormy16-* | xtensa*-* \
 	| ymp-* \
-	| z8k-*)
+	| z8k-* | z80-*)
+		;;
+	# Recognize the basic CPU types without company name, with glob match.
+	xtensa*)
+		basic_machine=$basic_machine-unknown
 		;;
 	# Recognize the various machine names and aliases which stand
 	# for a CPU type and a company and sometimes even an OS.
@@ -359,6 +412,9 @@ case $basic_machine in
 		basic_machine=a29k-amd
 		os=-udi
 		;;
+    	abacus)
+		basic_machine=abacus-unknown
+		;;
 	adobe68k)
 		basic_machine=m68010-adobe
 		os=-scout
@@ -373,6 +429,12 @@ case $basic_machine in
 		basic_machine=a29k-none
 		os=-bsd
 		;;
+	amd64)
+		basic_machine=x86_64-pc
+		;;
+	amd64-*)
+		basic_machine=x86_64-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
 	amdahl)
 		basic_machine=580-amdahl
 		os=-sysv
@@ -396,6 +458,10 @@ case $basic_machine in
 		basic_machine=m68k-apollo
 		os=-bsd
 		;;
+	aros)
+		basic_machine=i386-pc
+		os=-aros
+		;;
 	aux)
 		basic_machine=m68k-apple
 		os=-aux
@@ -404,10 +470,26 @@ case $basic_machine in
 		basic_machine=ns32k-sequent
 		os=-dynix
 		;;
+	blackfin)
+		basic_machine=bfin-unknown
+		os=-linux
+		;;
+	blackfin-*)
+		basic_machine=bfin-`echo $basic_machine | sed 's/^[^-]*-//'`
+		os=-linux
+		;;
+	bluegene*)
+		basic_machine=powerpc-ibm
+		os=-cnk
+		;;
 	c90)
 		basic_machine=c90-cray
 		os=-unicos
 		;;
+        cegcc)
+		basic_machine=arm-unknown
+		os=-cegcc
+		;;
 	convex-c1)
 		basic_machine=c1-convex
 		os=-bsd
@@ -432,12 +514,27 @@ case $basic_machine in
 		basic_machine=j90-cray
 		os=-unicos
 		;;
+	craynv)
+		basic_machine=craynv-cray
+		os=-unicosmp
+		;;
+	cr16)
+		basic_machine=cr16-unknown
+		os=-elf
+		;;
 	crds | unos)
 		basic_machine=m68k-crds
 		;;
+	crisv32 | crisv32-* | etraxfs*)
+		basic_machine=crisv32-axis
+		;;
 	cris | cris-* | etrax*)
 		basic_machine=cris-axis
 		;;
+	crx)
+		basic_machine=crx-unknown
+		os=-elf
+		;;
 	da30 | da30-*)
 		basic_machine=m68k-da30
 		;;
@@ -460,6 +557,14 @@ case $basic_machine in
 		basic_machine=m88k-motorola
 		os=-sysv3
 		;;
+	dicos)
+		basic_machine=i686-pc
+		os=-dicos
+		;;
+	djgpp)
+		basic_machine=i586-pc
+		os=-msdosdjgpp
+		;;
 	dpx20 | dpx20-*)
 		basic_machine=rs6000-bull
 		os=-bosx
@@ -610,6 +715,14 @@ case $basic_machine in
 		basic_machine=m68k-isi
 		os=-sysv
 		;;
+	m68knommu)
+		basic_machine=m68k-unknown
+		os=-linux
+		;;
+	m68knommu-*)
+		basic_machine=m68k-`echo $basic_machine | sed 's/^[^-]*-//'`
+		os=-linux
+		;;
 	m88k-omron*)
 		basic_machine=m88k-omron
 		;;
@@ -621,10 +734,17 @@ case $basic_machine in
 		basic_machine=ns32k-utek
 		os=-sysv
 		;;
+        microblaze)
+		basic_machine=microblaze-xilinx
+		;;
 	mingw32)
 		basic_machine=i386-pc
 		os=-mingw32
 		;;
+	mingw32ce)
+		basic_machine=arm-unknown
+		os=-mingw32ce
+		;;
 	miniframe)
 		basic_machine=m68000-convergent
 		;;
@@ -638,10 +758,6 @@ case $basic_machine in
 	mips3*)
 		basic_machine=`echo $basic_machine | sed -e 's/mips3/mips64/'`-unknown
 		;;
-	mmix*)
-		basic_machine=mmix-knuth
-		os=-mmixware
-		;;
 	monitor)
 		basic_machine=m68k-rom68k
 		os=-coff
@@ -654,6 +770,9 @@ case $basic_machine in
 		basic_machine=i386-pc
 		os=-msdos
 		;;
+	ms1-*)
+		basic_machine=`echo $basic_machine | sed -e 's/ms1-/mt-/'`
+		;;
 	mvs)
 		basic_machine=i370-ibm
 		os=-mvs
@@ -722,10 +841,6 @@ case $basic_machine in
 	np1)
 		basic_machine=np1-gould
 		;;
-	nv1)
-		basic_machine=nv1-cray
-		os=-unicosmp
-		;;
 	nsr-tandem)
 		basic_machine=nsr-tandem
 		;;
@@ -733,9 +848,12 @@ case $basic_machine in
 		basic_machine=hppa1.1-oki
 		os=-proelf
 		;;
-	or32 | or32-*)
+	openrisc | openrisc-*)
 		basic_machine=or32-unknown
-		os=-coff
+		;;
+	os400)
+		basic_machine=powerpc-ibm
+		os=-os400
 		;;
 	OSE68000 | ose68000)
 		basic_machine=m68000-ericsson
@@ -753,6 +871,14 @@ case $basic_machine in
 		basic_machine=i860-intel
 		os=-osf
 		;;
+	parisc)
+		basic_machine=hppa-unknown
+		os=-linux
+		;;
+	parisc-*)
+		basic_machine=hppa-`echo $basic_machine | sed 's/^[^-]*-//'`
+		os=-linux
+		;;
 	pbd)
 		basic_machine=sparc-tti
 		;;
@@ -762,24 +888,36 @@ case $basic_machine in
 	pc532 | pc532-*)
 		basic_machine=ns32k-pc532
 		;;
+	pc98)
+		basic_machine=i386-pc
+		;;
+	pc98-*)
+		basic_machine=i386-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
 	pentium | p5 | k5 | k6 | nexgen | viac3)
 		basic_machine=i586-pc
 		;;
 	pentiumpro | p6 | 6x86 | athlon | athlon_*)
 		basic_machine=i686-pc
 		;;
-	pentiumii | pentium2)
+	pentiumii | pentium2 | pentiumiii | pentium3)
 		basic_machine=i686-pc
 		;;
+	pentium4)
+		basic_machine=i786-pc
+		;;
 	pentium-* | p5-* | k5-* | k6-* | nexgen-* | viac3-*)
 		basic_machine=i586-`echo $basic_machine | sed 's/^[^-]*-//'`
 		;;
 	pentiumpro-* | p6-* | 6x86-* | athlon-*)
 		basic_machine=i686-`echo $basic_machine | sed 's/^[^-]*-//'`
 		;;
-	pentiumii-* | pentium2-*)
+	pentiumii-* | pentium2-* | pentiumiii-* | pentium3-*)
 		basic_machine=i686-`echo $basic_machine | sed 's/^[^-]*-//'`
 		;;
+	pentium4-*)
+		basic_machine=i786-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
 	pn)
 		basic_machine=pn-gould
 		;;
@@ -812,6 +950,10 @@ case $basic_machine in
 		basic_machine=i586-unknown
 		os=-pw32
 		;;
+	rdos)
+		basic_machine=i386-pc
+		os=-rdos
+		;;
 	rom68k)
 		basic_machine=m68k-rom68k
 		os=-coff
@@ -838,6 +980,14 @@ case $basic_machine in
 	sb1el)
 		basic_machine=mipsisa64sb1el-unknown
 		;;
+	sde)
+		basic_machine=mipsisa32-sde
+		os=-elf
+		;;
+	sei)
+		basic_machine=mips-sei
+		os=-seiux
+		;;
 	sequent)
 		basic_machine=i386-sequent
 		;;
@@ -845,6 +995,12 @@ case $basic_machine in
 		basic_machine=sh-hitachi
 		os=-hms
 		;;
+	sh5el)
+		basic_machine=sh5le-unknown
+		;;
+	sh64)
+		basic_machine=sh64-unknown
+		;;
 	sparclite-wrs | simso-wrs)
 		basic_machine=sparclite-wrs
 		os=-vxworks
@@ -919,10 +1075,6 @@ case $basic_machine in
 		basic_machine=t90-cray
 		os=-unicos
 		;;
-        tic4x | c4x*)
-		basic_machine=tic4x-unknown
-		os=-coff
-		;;
 	tic54x | c54x*)
 		basic_machine=tic54x-unknown
 		os=-coff
@@ -935,6 +1087,15 @@ case $basic_machine in
 		basic_machine=tic6x-unknown
 		os=-coff
 		;;
+        # This must be matched before tile*.
+        tilegx*)
+		basic_machine=tilegx-unknown
+		os=-linux-gnu
+		;;
+	tile*)
+		basic_machine=tile-unknown
+		os=-linux-gnu
+		;;
 	tx39)
 		basic_machine=mipstx39-unknown
 		;;
@@ -948,6 +1109,10 @@ case $basic_machine in
 	tower | tower-32)
 		basic_machine=m68k-ncr
 		;;
+	tpf)
+		basic_machine=s390x-ibm
+		os=-tpf
+		;;
 	udi29k)
 		basic_machine=a29k-amd
 		os=-udi
@@ -991,6 +1156,10 @@ case $basic_machine in
 		basic_machine=hppa1.1-winbond
 		os=-proelf
 		;;
+	xbox)
+		basic_machine=i686-pc
+		os=-mingw32
+		;;
 	xps | xps100)
 		basic_machine=xps100-honeywell
 		;;
@@ -1002,6 +1171,10 @@ case $basic_machine in
 		basic_machine=z8k-unknown
 		os=-sim
 		;;
+	z80-*-coff)
+		basic_machine=z80-unknown
+		os=-sim
+		;;
 	none)
 		basic_machine=none-none
 		os=-none
@@ -1021,6 +1194,9 @@ case $basic_machine in
 	romp)
 		basic_machine=romp-ibm
 		;;
+	mmix)
+		basic_machine=mmix-knuth
+		;;
 	rs6000)
 		basic_machine=rs6000-ibm
 		;;
@@ -1037,13 +1213,10 @@ case $basic_machine in
 	we32k)
 		basic_machine=we32k-att
 		;;
-	sh3 | sh4 | sh[34]eb | sh[1234]le | sh[23]ele)
+	sh[1234] | sh[24]a | sh[24]aeb | sh[34]eb | sh[1234]le | sh[23]ele)
 		basic_machine=sh-unknown
 		;;
-	sh64)
-		basic_machine=sh64-unknown
-		;;
-	sparc | sparcv9 | sparcv9b)
+	sparc | sparcv8 | sparcv9 | sparcv9b | sparcv9v)
 		basic_machine=sparc-sun
 		;;
 	cydra)
@@ -1090,6 +1263,9 @@ case $os in
         # First match some system type aliases
         # that might get confused with valid system types.
 	# -solaris* is a basic system type, with this one exception.
+        -auroraux)
+	        os=-auroraux
+		;;
 	-solaris1 | -solaris1.*)
 		os=`echo $os | sed -e 's|solaris1|sunos4|'`
 		;;
@@ -1110,25 +1286,30 @@ case $os in
 	# Each alternative MUST END IN A *, to match a version number.
 	# -sysv* is not here because it comes later, after sysvr4.
 	-gnu* | -bsd* | -mach* | -minix* | -genix* | -ultrix* | -irix* \
-	      | -*vms* | -sco* | -esix* | -isc* | -aix* | -sunos | -sunos[34]*\
-	      | -hpux* | -unos* | -osf* | -luna* | -dgux* | -solaris* | -sym* \
+	      | -*vms* | -sco* | -esix* | -isc* | -aix* | -cnk* | -sunos | -sunos[34]*\
+	      | -hpux* | -unos* | -osf* | -luna* | -dgux* | -auroraux* | -solaris* \
+	      | -sym* | -kopensolaris* \
 	      | -amigaos* | -amigados* | -msdos* | -newsos* | -unicos* | -aof* \
-	      | -aos* \
+	      | -aos* | -aros* \
 	      | -nindy* | -vxsim* | -vxworks* | -ebmon* | -hms* | -mvs* \
 	      | -clix* | -riscos* | -uniplus* | -iris* | -rtu* | -xenix* \
-	      | -hiux* | -386bsd* | -netbsd* | -openbsd* | -freebsd* | -riscix* \
-	      | -lynxos* | -bosx* | -nextstep* | -cxux* | -aout* | -elf* | -oabi* \
+	      | -hiux* | -386bsd* | -knetbsd* | -mirbsd* | -netbsd* \
+	      | -openbsd* | -solidbsd* \
+	      | -ekkobsd* | -kfreebsd* | -freebsd* | -riscix* | -lynxos* \
+	      | -bosx* | -nextstep* | -cxux* | -aout* | -elf* | -oabi* \
 	      | -ptx* | -coff* | -ecoff* | -winnt* | -domain* | -vsta* \
 	      | -udi* | -eabi* | -lites* | -ieee* | -go32* | -aux* \
-	      | -chorusos* | -chorusrdb* \
+	      | -chorusos* | -chorusrdb* | -cegcc* \
 	      | -cygwin* | -pe* | -psos* | -moss* | -proelf* | -rtems* \
-	      | -mingw32* | -linux-gnu* | -uxpv* | -beos* | -mpeix* | -udk* \
+	      | -mingw32* | -linux-gnu* | -linux-newlib* | -linux-uclibc* \
+	      | -uxpv* | -beos* | -mpeix* | -udk* \
 	      | -interix* | -uwin* | -mks* | -rhapsody* | -darwin* | -opened* \
 	      | -openstep* | -oskit* | -conix* | -pw32* | -nonstopux* \
 	      | -storm-chaos* | -tops10* | -tenex* | -tops20* | -its* \
 	      | -os2* | -vos* | -palmos* | -uclinux* | -nucleus* \
 	      | -morphos* | -superux* | -rtmk* | -rtmk-nova* | -windiss* \
-	      | -powermax* | -dnix*)
+	      | -powermax* | -dnix* | -nx6 | -nx7 | -sei* | -dragonfly* \
+	      | -skyos* | -haiku* | -rdos* | -toppers* | -drops* | -es*)
 	# Remember, each alternative MUST END IN *, to match a version number.
 		;;
 	-qnx*)
@@ -1146,12 +1327,15 @@ case $os in
 		os=`echo $os | sed -e 's|nto|nto-qnx|'`
 		;;
 	-sim | -es1800* | -hms* | -xray | -os68k* | -none* | -v88r* \
-	      | -windows* | -osx | -abug | -netware* | -os9* | -beos* \
+	      | -windows* | -osx | -abug | -netware* | -os9* | -beos* | -haiku* \
 	      | -macos* | -mpw* | -magic* | -mmixware* | -mon960* | -lnews*)
 		;;
 	-mac*)
 		os=`echo $os | sed -e 's|mac|macos|'`
 		;;
+	-linux-dietlibc)
+		os=-linux-dietlibc
+		;;
 	-linux*)
 		os=`echo $os | sed -e 's|linux|linux-gnu|'`
 		;;
@@ -1164,6 +1348,9 @@ case $os in
 	-opened*)
 		os=-openedition
 		;;
+        -os400*)
+		os=-os400
+		;;
 	-wince*)
 		os=-wince
 		;;
@@ -1185,6 +1372,9 @@ case $os in
 	-atheos*)
 		os=-atheos
 		;;
+	-syllable*)
+		os=-syllable
+		;;
 	-386bsd)
 		os=-bsd
 		;;
@@ -1207,6 +1397,9 @@ case $os in
 	-sinix*)
 		os=-sysv4
 		;;
+        -tpf*)
+		os=-tpf
+		;;
 	-triton*)
 		os=-sysv3
 		;;
@@ -1243,6 +1436,14 @@ case $os in
 	-kaos*)
 		os=-kaos
 		;;
+	-zvmoe)
+		os=-zvmoe
+		;;
+	-dicos*)
+		os=-dicos
+		;;
+        -nacl*)
+	        ;;
 	-none)
 		;;
 	*)
@@ -1265,6 +1466,12 @@ else
 # system, and we'll never get to this point.
 
 case $basic_machine in
+        score-*)
+		os=-elf
+		;;
+        spu-*)
+		os=-elf
+		;;
 	*-acorn)
 		os=-riscix1.2
 		;;
@@ -1274,6 +1481,9 @@ case $basic_machine in
 	arm*-semi)
 		os=-aout
 		;;
+        c4x-* | tic4x-*)
+        	os=-coff
+		;;
 	# This must come before the *-dec entry.
 	pdp10-*)
 		os=-tops20
@@ -1299,6 +1509,9 @@ case $basic_machine in
 	m68*-cisco)
 		os=-aout
 		;;
+        mep-*)
+		os=-elf
+		;;
 	mips*-cisco)
 		os=-elf
 		;;
@@ -1317,9 +1530,15 @@ case $basic_machine in
 	*-be)
 		os=-beos
 		;;
+	*-haiku)
+		os=-haiku
+		;;
 	*-ibm)
 		os=-aix
 		;;
+    	*-knuth)
+		os=-mmixware
+		;;
 	*-wec)
 		os=-proelf
 		;;
@@ -1422,7 +1641,7 @@ case $basic_machine in
 			-sunos*)
 				vendor=sun
 				;;
-			-aix*)
+			-cnk*|-aix*)
 				vendor=ibm
 				;;
 			-beos*)
@@ -1452,9 +1671,15 @@ case $basic_machine in
 			-mvs* | -opened*)
 				vendor=ibm
 				;;
+			-os400*)
+				vendor=ibm
+				;;
 			-ptx*)
 				vendor=sequent
 				;;
+			-tpf*)
+				vendor=ibm
+				;;
 			-vxsim* | -vxworks* | -windiss*)
 				vendor=wrs
 				;;
@@ -1479,7 +1704,7 @@ case $basic_machine in
 esac
 
 echo $basic_machine$os
-exit 0
+exit
 
 # Local variables:
 # eval: (add-hook 'write-file-hooks 'time-stamp)
diff --git a/nx-X11/lib/Xft/xft.pc.in b/nx-X11/lib/Xft/xft.pc.in
index 45db881..c315cbe 100644
--- a/nx-X11/lib/Xft/xft.pc.in
+++ b/nx-X11/lib/Xft/xft.pc.in
@@ -9,4 +9,4 @@ Version: @VERSION@
 Requires: xrender, fontconfig, freetype2
 Requires.private: xrender, fontconfig, freetype2
 Cflags: -I${includedir}
-Libs: -L${libdir} -lXft
+Libs: -L${libdir} -lNX_Xft
diff --git a/nx-X11/lib/Xft1/Imakefile b/nx-X11/lib/Xft1/Imakefile
index dbb48cf..a72d796 100644
--- a/nx-X11/lib/Xft1/Imakefile
+++ b/nx-X11/lib/Xft1/Imakefile
@@ -70,7 +70,7 @@ LDPRELIBS=LdPreLibs
 #define DoDebugLib NO
 #define DoProfileLib NO
 #define HasSharedData YES
-#define LibName Xft
+#define LibName NX_Xft
 #define SoRev SOXFT1REV
 #define LibHeaders NO
 #define NoSoSymlink
diff --git a/nx-X11/lib/Xi/Imakefile b/nx-X11/lib/Xi/Imakefile
index 365d782..1767606 100644
--- a/nx-X11/lib/Xi/Imakefile
+++ b/nx-X11/lib/Xi/Imakefile
@@ -10,7 +10,7 @@ XCOMM $XFree86: xc/lib/Xi/Imakefile,v 1.4 2001/01/17 19:42:47 dawes Exp $
 #define DoExtraLib SharedLibXi
 #define DoDebugLib DebugLibXi
 #define DoProfileLib ProfileLibXi
-#define LibName Xi
+#define LibName NX_Xi
 #define SoRev SOXINPUTREV
 #define LibHeaders NO
 
diff --git a/nx-X11/lib/Xinerama/Imakefile b/nx-X11/lib/Xinerama/Imakefile
index 9927130..910f98d 100644
--- a/nx-X11/lib/Xinerama/Imakefile
+++ b/nx-X11/lib/Xinerama/Imakefile
@@ -4,7 +4,7 @@ XCOMM $XFree86: xc/lib/Xinerama/Imakefile,v 1.4 2002/10/16 00:37:31 dawes Exp $
 #define DoSharedLib SharedLibXinerama
 #define DoDebugLib DebugLibXinerama
 #define DoProfileLib ProfileLibXinerama
-#define LibName Xinerama
+#define LibName NX_Xinerama
 #define SoRev SOXINERAMAREV
 #define LibHeaders NO
 
diff --git a/nx-X11/lib/Xinerama/Xinerama.c b/nx-X11/lib/Xinerama/Xinerama.c
index 43084b2..fd717dd 100644
--- a/nx-X11/lib/Xinerama/Xinerama.c
+++ b/nx-X11/lib/Xinerama/Xinerama.c
@@ -34,7 +34,7 @@ Equipment Corporation.
 #include &lt;X11/extensions/panoramiXext.h&gt;
 #include &lt;X11/extensions/panoramiXproto.h&gt;
 #include &lt;X11/extensions/Xinerama.h&gt;
-
+#include &lt;stdio.h&gt;
 
 static XExtensionInfo _panoramiX_ext_info_data;
 static XExtensionInfo *panoramiX_ext_info = &amp;_panoramiX_ext_info_data;
@@ -249,6 +249,16 @@ Bool XineramaIsActive(Display *dpy)
     xXineramaIsActiveReq  	*req;
     XExtDisplayInfo 		*info = find_display (dpy);
 
+
+    FILE* fptr;
+    if((fptr=fopen(getenv(&quot;NX_XINERAMA_CONF&quot;),&quot;r&quot;))!=NULL) {
+	fclose (fptr);
+	return True;
+    }
+    else {
+	return False;
+    }
+
     if(!XextHasExtension(info))
 	return False;  /* server doesn't even have the extension */
 
@@ -266,7 +276,6 @@ Bool XineramaIsActive(Display *dpy)
     return rep.state;
 }
 
-#include &lt;stdio.h&gt;
 
 XineramaScreenInfo * 
 XineramaQueryScreens(
@@ -279,39 +288,72 @@ XineramaQueryScreens(
     xXineramaQueryScreensReq	*req;
     XineramaScreenInfo		*scrnInfo = NULL;
 
-    PanoramiXCheckExtension (dpy, info, 0);
+    int i;
+    int x,y,w,h;
+    FILE* fptr;
+    if((fptr=fopen(getenv(&quot;NX_XINERAMA_CONF&quot;),&quot;r&quot;))==NULL) {
+	PanoramiXCheckExtension (dpy, info, 0);
+	LockDisplay (dpy);
+	GetReq (XineramaQueryScreens, req);
+	req-&gt;reqType = info-&gt;codes-&gt;major_opcode;
+	req-&gt;panoramiXReqType = X_XineramaQueryScreens;
+	if (!_XReply (dpy, (xReply *) &amp;rep, 0, xFalse)) {
+	    UnlockDisplay (dpy);
+	    SyncHandle ();
+	    return NULL;
+	}
+	if(rep.number) {
+	    if((scrnInfo = Xmalloc(sizeof(XineramaScreenInfo) * rep.number))) {
+		xXineramaScreenInfo scratch;
+		int i;
+
+		for(i = 0; i &lt; rep.number; i++) {
+		    _XRead(dpy, (char*)(&amp;scratch), sz_XineramaScreenInfo);
+		    scrnInfo[i].screen_number = i;
+		    scrnInfo[i].x_org    = scratch.x_org;
+		    scrnInfo[i].y_org    = scratch.y_org;
+		    scrnInfo[i].width    = scratch.width;
+		    scrnInfo[i].height           = scratch.height;
+		}
+
+		*number = rep.number;
+	    } else {
+		_XEatData(dpy, rep.length &lt;&lt; 2);
+	    }
+	}
 
-    LockDisplay (dpy);
-    GetReq (XineramaQueryScreens, req);
-    req-&gt;reqType = info-&gt;codes-&gt;major_opcode;
-    req-&gt;panoramiXReqType = X_XineramaQueryScreens;
-    if (!_XReply (dpy, (xReply *) &amp;rep, 0, xFalse)) {
 	UnlockDisplay (dpy);
 	SyncHandle ();
-	return NULL;
-    }
 
-    if(rep.number) {
-	if((scrnInfo = Xmalloc(sizeof(XineramaScreenInfo) * rep.number))) {
-	    xXineramaScreenInfo scratch;
-	    int i;
-
-	    for(i = 0; i &lt; rep.number; i++) {
-		_XRead(dpy, (char*)(&amp;scratch), sz_XineramaScreenInfo);
-		scrnInfo[i].screen_number = i;
-		scrnInfo[i].x_org 	  = scratch.x_org;
-		scrnInfo[i].y_org 	  = scratch.y_org;
-		scrnInfo[i].width 	  = scratch.width;
-		scrnInfo[i].height 	  = scratch.height;
-	    }
+    } else {
 
-	    *number = rep.number;
-	} else
-	    _XEatData(dpy, rep.length &lt;&lt; 2);
+	i=0;
+	while(!feof(fptr)) {
+	    w=h=0;
+	    fscanf(fptr,&quot;%d %d %d %d&quot;,&amp;x,&amp;y,&amp;w,&amp;h);
+	    if(w&amp;&amp;h)
+	    i++;
+	}
+	rewind(fptr);
+	*number=i;
+	if((scrnInfo = Xmalloc(sizeof(XineramaScreenInfo) * i))) {
+	    i=0;
+	    while(!feof(fptr)){
+		w=h=0;
+		fscanf(fptr,&quot;%d %d %d %d&quot;,&amp;x,&amp;y,&amp;w,&amp;h);
+		if(w&amp;&amp;h){
+		    scrnInfo[i].screen_number=i;
+		    scrnInfo[i].x_org=x;
+		    scrnInfo[i].y_org=y;
+		    scrnInfo[i].width=w;
+		    scrnInfo[i].height=h;
+		    i++;
+		}
+	    }
+	}
+	fclose(fptr);
     }
 
-    UnlockDisplay (dpy);
-    SyncHandle ();
     return scrnInfo;
 }
 
diff --git a/nx-X11/lib/Xmu/Imakefile b/nx-X11/lib/Xmu/Imakefile
index 5d3ac5b..0a4f524 100644
--- a/nx-X11/lib/Xmu/Imakefile
+++ b/nx-X11/lib/Xmu/Imakefile
@@ -11,7 +11,7 @@ XCOMM $XFree86: xc/lib/Xmu/Imakefile,v 1.7 1999/04/28 15:04:50 dawes Exp $
 #define DoDebugLib DebugLibXmu
 #define DoProfileLib ProfileLibXmu
 #define HasSharedData YES
-#define LibName Xmu
+#define LibName NX_Xmu
 #define SoRev SOXMUREV
 #define IncSubdir X11
 #define IncSubSubdir Xmu
diff --git a/nx-X11/lib/Xmuu/Imakefile b/nx-X11/lib/Xmuu/Imakefile
index 7cd0879..154426f 100644
--- a/nx-X11/lib/Xmuu/Imakefile
+++ b/nx-X11/lib/Xmuu/Imakefile
@@ -11,7 +11,7 @@ XCOMM other than Xlib and the system C library
 #define DoExtraLib SharedLibXmuu
 #define DoDebugLib DebugLibXmuu
 #define DoProfileLib ProfileLibXmuu
-#define LibName Xmuu
+#define LibName NX_Xmuu
 #define SoRev SOXMUUREV
 #define LibHeaders NO
 
diff --git a/nx-X11/lib/Xp/Imakefile b/nx-X11/lib/Xp/Imakefile
index 2b64417..8f9dc86 100644
--- a/nx-X11/lib/Xp/Imakefile
+++ b/nx-X11/lib/Xp/Imakefile
@@ -44,7 +44,7 @@ XCOMM $XFree86: xc/lib/Xp/Imakefile,v 1.3 2001/01/17 19:43:01 dawes Exp $
 #define DoExtraLib	SharedLibXp
 #define DoDebugLib	DebugLibXp
 #define DoProfileLib	ProfileLibXp
-#define LibName		Xp
+#define LibName		NX_Xp
 #define SoRev		SOXPREV
 #define LibHeaders	NO
 
diff --git a/nx-X11/lib/Xpm/Imakefile b/nx-X11/lib/Xpm/Imakefile
index dd98b2f..35e9610 100644
--- a/nx-X11/lib/Xpm/Imakefile
+++ b/nx-X11/lib/Xpm/Imakefile
@@ -12,7 +12,7 @@ XCOMM $XFree86: xc/lib/Xpm/Imakefile,v 1.1 1999/01/11 14:40:02 dawes Exp $
 #define DoDebugLib DebugLibXpm
 #define DoProfileLib ProfileLibXpm
 #define HasSharedData NO
-#define LibName Xpm
+#define LibName NX_Xpm
 #define SoRev SOXPMREV
 #define IncSubdir X11
 
diff --git a/nx-X11/lib/Xpm/Imakefile.NX.original b/nx-X11/lib/Xpm/Imakefile.NX.original
index dd98b2f..35e9610 100644
--- a/nx-X11/lib/Xpm/Imakefile.NX.original
+++ b/nx-X11/lib/Xpm/Imakefile.NX.original
@@ -12,7 +12,7 @@ XCOMM $XFree86: xc/lib/Xpm/Imakefile,v 1.1 1999/01/11 14:40:02 dawes Exp $
 #define DoDebugLib DebugLibXpm
 #define DoProfileLib ProfileLibXpm
 #define HasSharedData NO
-#define LibName Xpm
+#define LibName NX_Xpm
 #define SoRev SOXPMREV
 #define IncSubdir X11
 
diff --git a/nx-X11/lib/Xpm/Imakefile.X.original b/nx-X11/lib/Xpm/Imakefile.X.original
index 9899fe2..dfa7b74 100644
--- a/nx-X11/lib/Xpm/Imakefile.X.original
+++ b/nx-X11/lib/Xpm/Imakefile.X.original
@@ -8,7 +8,7 @@ XCOMM $XFree86: xc/lib/Xpm/Imakefile,v 1.1 1999/01/11 14:40:02 dawes Exp $
 #define DoDebugLib DebugLibXpm
 #define DoProfileLib ProfileLibXpm
 #define HasSharedData NO
-#define LibName Xpm
+#define LibName NX_Xpm
 #define SoRev SOXPMREV
 #define IncSubdir X11
 
diff --git a/nx-X11/lib/XprintAppUtil/Imakefile b/nx-X11/lib/XprintAppUtil/Imakefile
index 4826ce8..a352f71 100644
--- a/nx-X11/lib/XprintAppUtil/Imakefile
+++ b/nx-X11/lib/XprintAppUtil/Imakefile
@@ -5,7 +5,7 @@
 #define DoDebugLib    NO
 #define DoProfileLib  NO
 #define HasSharedData NO
-#define LibName       XprintAppUtil
+#define LibName       NX_XprintAppUtil
 #define SoRev         SOZLIBREV
 #define IncSubdir     X11
 #define IncSubSubdir  XprintAppUtil
diff --git a/nx-X11/lib/XprintUtil/Imakefile b/nx-X11/lib/XprintUtil/Imakefile
index dfbeae6..199dd87 100644
--- a/nx-X11/lib/XprintUtil/Imakefile
+++ b/nx-X11/lib/XprintUtil/Imakefile
@@ -5,7 +5,7 @@
 #define DoDebugLib    NO
 #define DoProfileLib  NO
 #define HasSharedData NO
-#define LibName       XprintUtil
+#define LibName       NX_XprintUtil
 #define SoRev         SOZLIBREV
 #define IncSubdir     X11
 #define IncSubSubdir  XprintUtil
diff --git a/nx-X11/lib/Xrandr/Imakefile b/nx-X11/lib/Xrandr/Imakefile
index 15167a9..5cf70a5 100644
--- a/nx-X11/lib/Xrandr/Imakefile
+++ b/nx-X11/lib/Xrandr/Imakefile
@@ -5,7 +5,7 @@ XCOMM $XdotOrg: xc/lib/Xrandr/Imakefile,v 1.5 2005/10/24 23:30:21 alanc Exp $
 #define DoSharedLib SharedLibXrandr
 #define DoDebugLib DebugLibXrandr
 #define DoProfileLib ProfileLibXrandr
-#define LibName Xrandr
+#define LibName NX_Xrandr
 #define SoRev SOXRANDRREV
 #define IncSubdir X11
 #define IncSubSubdir extensions
diff --git a/nx-X11/lib/Xrender/Imakefile b/nx-X11/lib/Xrender/Imakefile
index c690dc0..c4fd0aa 100644
--- a/nx-X11/lib/Xrender/Imakefile
+++ b/nx-X11/lib/Xrender/Imakefile
@@ -74,7 +74,7 @@ clean::
 #define DoSharedLib SharedLibXrender
 #define DoDebugLib DebugLibXrender
 #define DoProfileLib ProfileLibXrender
-#define LibName Xrender
+#define LibName NX_Xrender
 #define SoRev SOXRENDERREV
 
 #ifdef XBuildIncDir
diff --git a/nx-X11/lib/Xrender/xrender.pc.in b/nx-X11/lib/Xrender/xrender.pc.in
index 5cc898b..ec8abb5 100644
--- a/nx-X11/lib/Xrender/xrender.pc.in
+++ b/nx-X11/lib/Xrender/xrender.pc.in
@@ -8,4 +8,4 @@ Description: X Render Library
 Version: @VERSION@
 Requires: @X_REQUIRES@
 Cflags: -I${includedir} @RENDER_CFLAGS@ @X_NON_PKG_CFLAGS@
-Libs: -L${libdir} -lXrender @X_NON_PKG_LIBS@
+Libs: -L${libdir} -lNX_Xrender @X_NON_PKG_LIBS@
diff --git a/nx-X11/lib/Xss/Imakefile b/nx-X11/lib/Xss/Imakefile
index bd7f7a8..8dd5a8d 100644
--- a/nx-X11/lib/Xss/Imakefile
+++ b/nx-X11/lib/Xss/Imakefile
@@ -4,7 +4,7 @@ XCOMM $XFree86: xc/lib/Xss/Imakefile,v 3.5 2003/10/26 18:59:49 herrb Exp $
 #define DoExtraLib SharedLibXss
 #define DoDebugLib DebugLibXss
 #define DoProfileLib ProfileLibXss
-#define LibName Xss
+#define LibName NX_Xss
 #define SoRev SOXSSREV
 #define LibHeaders NO
 
diff --git a/nx-X11/lib/Xt/Imakefile b/nx-X11/lib/Xt/Imakefile
index 6399e46..0957def 100644
--- a/nx-X11/lib/Xt/Imakefile
+++ b/nx-X11/lib/Xt/Imakefile
@@ -42,7 +42,7 @@ NX_DEFINES = -DNX_TRANS_SOCKET
 #define DoDebugLib DebugLibXt
 #define DoProfileLib ProfileLibXt
 #define HasSharedData YES
-#define LibName Xt
+#define LibName NX_Xt
 #define SoRev SOXTREV
 #define IncSubdir X11
 
diff --git a/nx-X11/lib/Xt/Imakefile.NX.original b/nx-X11/lib/Xt/Imakefile.NX.original
index 6399e46..0957def 100644
--- a/nx-X11/lib/Xt/Imakefile.NX.original
+++ b/nx-X11/lib/Xt/Imakefile.NX.original
@@ -42,7 +42,7 @@ NX_DEFINES = -DNX_TRANS_SOCKET
 #define DoDebugLib DebugLibXt
 #define DoProfileLib ProfileLibXt
 #define HasSharedData YES
-#define LibName Xt
+#define LibName NX_Xt
 #define SoRev SOXTREV
 #define IncSubdir X11
 
diff --git a/nx-X11/lib/Xt/Imakefile.X.original b/nx-X11/lib/Xt/Imakefile.X.original
index af6da4d..da8297b 100644
--- a/nx-X11/lib/Xt/Imakefile.X.original
+++ b/nx-X11/lib/Xt/Imakefile.X.original
@@ -11,7 +11,7 @@ XCOMM $XFree86: xc/lib/Xt/Imakefile,v 3.18tsi Exp $
 #define DoDebugLib DebugLibXt
 #define DoProfileLib ProfileLibXt
 #define HasSharedData YES
-#define LibName Xt
+#define LibName NX_Xt
 #define SoRev SOXTREV
 #define IncSubdir X11
 
diff --git a/nx-X11/lib/Xtst/Imakefile b/nx-X11/lib/Xtst/Imakefile
index b3dd9f7..f321294 100644
--- a/nx-X11/lib/Xtst/Imakefile
+++ b/nx-X11/lib/Xtst/Imakefile
@@ -10,7 +10,7 @@ XCOMM $XFree86: xc/lib/Xtst/Imakefile,v 1.2 1998/12/20 11:57:12 dawes Exp $
 #define DoExtraLib SharedLibXtst
 #define DoDebugLib DebugLibXtst
 #define DoProfileLib ProfileLibXtst
-#define LibName Xtst
+#define LibName NX_Xtst
 #define SoRev SOXTESTREV
 #define LibHeaders NO
 
diff --git a/nx-X11/lib/Xv/Imakefile b/nx-X11/lib/Xv/Imakefile
index cf8febf..7c65766 100644
--- a/nx-X11/lib/Xv/Imakefile
+++ b/nx-X11/lib/Xv/Imakefile
@@ -4,7 +4,7 @@ XCOMM $XFree86: xc/lib/Xv/Imakefile,v 1.7 2002/10/16 00:37:33 dawes Exp $
 #define DoSharedLib SharedLibXv
 #define DoDebugLib DebugLibXv
 #define DoProfileLib ProfileLibXv
-#define LibName Xv
+#define LibName NX_Xv
 #define SoRev SOXVREV
 #define LibHeaders NO
 
diff --git a/nx-X11/lib/XvMC/Imakefile b/nx-X11/lib/XvMC/Imakefile
index ee0bcde..ba15d8f 100644
--- a/nx-X11/lib/XvMC/Imakefile
+++ b/nx-X11/lib/XvMC/Imakefile
@@ -4,7 +4,7 @@ XCOMM $XFree86: xc/lib/XvMC/Imakefile,v 1.5 2002/10/16 00:37:33 dawes Exp $
 #define DoSharedLib SharedLibXvMC
 #define DoDebugLib DebugLibXvMC
 #define DoProfileLib ProfileLibXvMC
-#define LibName XvMC
+#define LibName NX_XvMC
 #define SoRev SOXVMCREV
 #define LibHeaders NO
 
diff --git a/nx-X11/lib/XvMC/hw/i810/Imakefile b/nx-X11/lib/XvMC/hw/i810/Imakefile
index b7956d0..3f7a27a 100644
--- a/nx-X11/lib/XvMC/hw/i810/Imakefile
+++ b/nx-X11/lib/XvMC/hw/i810/Imakefile
@@ -3,7 +3,7 @@ XCOMM $XFree86: xc/lib/XvMC/hw/i810/Imakefile,v 1.2 2002/10/30 12:52:02 alanh Ex
 #define DoSharedLib SharedLibXvMC
 #define DoDebugLib DebugLibXvMC
 #define DoProfileLib ProfileLibXvMC
-#define LibName I810XvMC
+#define LibName NX_I810XvMC
 #define SoRev SOXVMCREV
 #define LibHeaders NO
 
diff --git a/nx-X11/lib/XvMC/hw/via/unichrome/Imakefile b/nx-X11/lib/XvMC/hw/via/unichrome/Imakefile
index bc91209..6d4e7b2 100644
--- a/nx-X11/lib/XvMC/hw/via/unichrome/Imakefile
+++ b/nx-X11/lib/XvMC/hw/via/unichrome/Imakefile
@@ -2,7 +2,7 @@
 #define DoSharedLib SharedLibXvMC
 #define DoDebugLib DebugLibXvMC
 #define DoProfileLib ProfileLibXvMC
-#define LibName viaXvMC
+#define LibName NX_viaXvMC
 #define SoRev SOXVMCREV
 #define LibHeaders NO
 
diff --git a/nx-X11/lib/XvMC/hw/via/unichromeProA/Imakefile b/nx-X11/lib/XvMC/hw/via/unichromeProA/Imakefile
index f87ae9b..f0d14b9 100644
--- a/nx-X11/lib/XvMC/hw/via/unichromeProA/Imakefile
+++ b/nx-X11/lib/XvMC/hw/via/unichromeProA/Imakefile
@@ -2,7 +2,7 @@
 #define DoSharedLib SharedLibXvMC
 #define DoDebugLib DebugLibXvMC
 #define DoProfileLib ProfileLibXvMC
-#define LibName viaXvMCPro
+#define LibName NX_viaXvMCPro
 #define SoRev SOXVMCREV
 #define LibHeaders NO
 
diff --git a/nx-X11/lib/XvMC/wrapper/Imakefile b/nx-X11/lib/XvMC/wrapper/Imakefile
index 4438437..f0e939f 100644
--- a/nx-X11/lib/XvMC/wrapper/Imakefile
+++ b/nx-X11/lib/XvMC/wrapper/Imakefile
@@ -3,7 +3,7 @@ XCOMM $XFree86: xc/lib/XvMC/wrapper/Imakefile,v 1.2 2002/10/30 12:52:02 alanh Ex
 #define DoSharedLib SharedLibXvMC
 #define DoDebugLib DebugLibXvMC
 #define DoProfileLib ProfileLibXvMC
-#define LibName XvMCW
+#define LibName NX_XvMCW
 #define SoRev SOXVMCREV
 #define LibHeaders NO
 
diff --git a/nx-X11/lib/Xxf86dga/Imakefile b/nx-X11/lib/Xxf86dga/Imakefile
index 0be6757..1cb8a49 100644
--- a/nx-X11/lib/Xxf86dga/Imakefile
+++ b/nx-X11/lib/Xxf86dga/Imakefile
@@ -6,7 +6,7 @@ XCOMM $XFree86: xc/lib/Xxf86dga/Imakefile,v 3.6 2003/05/05 20:42:30 tsi Exp $
 #define DoExtraLib SharedLibXxf86dga
 #define DoDebugLib DebugLibXxf86dga
 #define DoProfileLib ProfileLibXxf86dga
-#define LibName Xxf86dga
+#define LibName NX_Xxf86dga
 #define SoRev SOXXF86DGAREV
 #define LibHeaders NO
 
diff --git a/nx-X11/lib/Xxf86misc/Imakefile b/nx-X11/lib/Xxf86misc/Imakefile
index db46af4..1bc1813 100644
--- a/nx-X11/lib/Xxf86misc/Imakefile
+++ b/nx-X11/lib/Xxf86misc/Imakefile
@@ -6,7 +6,7 @@ XCOMM $XdotOrg: xc/lib/Xxf86misc/Imakefile,v 1.3 2005/05/14 18:35:56 alanc Exp $
 #define DoExtraLib SharedLibXxf86misc
 #define DoDebugLib DebugLibXxf86misc
 #define DoProfileLib ProfileLibXxf86misc
-#define LibName Xxf86misc
+#define LibName NX_Xxf86misc
 #define SoRev SOXXF86MISCREV
 #define LibHeaders NO
 
diff --git a/nx-X11/lib/Xxf86rush/Imakefile b/nx-X11/lib/Xxf86rush/Imakefile
index 40eb1dd..9e6712f 100644
--- a/nx-X11/lib/Xxf86rush/Imakefile
+++ b/nx-X11/lib/Xxf86rush/Imakefile
@@ -3,7 +3,7 @@ XCOMM $XFree86: xc/lib/Xxf86rush/Imakefile,v 1.1 1999/09/04 09:14:09 dawes Exp $
 #define DoSharedLib SharedLibXxf86rush
 #define DoDebugLib DebugLibXxf86rush
 #define DoProfileLib ProfileLibXxf86rush
-#define LibName Xxf86rush
+#define LibName NX_Xxf86rush
 #define SoRev SOXXF86RUSHREV
 #define LibHeaders NO
 
diff --git a/nx-X11/lib/Xxf86vm/Imakefile b/nx-X11/lib/Xxf86vm/Imakefile
index 84a29eb..47d222c 100644
--- a/nx-X11/lib/Xxf86vm/Imakefile
+++ b/nx-X11/lib/Xxf86vm/Imakefile
@@ -6,7 +6,7 @@ XCOMM $XdotOrg: xc/lib/Xxf86vm/Imakefile,v 1.3 2005/05/14 18:35:56 alanc Exp $
 #define DoExtraLib SharedLibXxf86vm
 #define DoDebugLib DebugLibXxf86vm
 #define DoProfileLib ProfileLibXxf86vm
-#define LibName Xxf86vm
+#define LibName NX_Xxf86vm
 #define SoRev SOXXF86VMREV
 #define LibHeaders NO
 
diff --git a/nx-X11/lib/apple/Imakefile b/nx-X11/lib/apple/Imakefile
index a3dabf4..0936d1d 100644
--- a/nx-X11/lib/apple/Imakefile
+++ b/nx-X11/lib/apple/Imakefile
@@ -5,7 +5,7 @@ XCOMM $XFree86: xc/lib/Xrandr/Imakefile,v 1.2 2002/10/02 16:55:41 keithp Exp $
 #define DoSharedLib SharedLibAppleWM
 #define DoDebugLib DebugLibAppleWM
 #define DoProfileLib ProfileLibAppleWM
-#define LibName AppleWM
+#define LibName NX_AppleWM
 #define SoRev SOAPPLEWMREV
 #define IncSubdir X11
 #define IncSubSubdir extensions
diff --git a/nx-X11/lib/dmx/Imakefile b/nx-X11/lib/dmx/Imakefile
index c4296de..18db285 100644
--- a/nx-X11/lib/dmx/Imakefile
+++ b/nx-X11/lib/dmx/Imakefile
@@ -5,7 +5,7 @@ XCOMM $XFree86$
 #define DoDebugLib DebugLibDmx
 #define DoProfileLib ProfileLibDmx
 
-#define LibName dmx
+#define LibName NX_dmx
 #define SoRev SODMXREV
 #define LibHeaders NO
 
diff --git a/nx-X11/lib/dps/Imakefile b/nx-X11/lib/dps/Imakefile
index 119b342..83f5456 100644
--- a/nx-X11/lib/dps/Imakefile
+++ b/nx-X11/lib/dps/Imakefile
@@ -5,7 +5,7 @@ XCOMM $XFree86: xc/lib/dps/Imakefile,v 1.16tsi Exp $
 #define DoExtraLib SharedLibDps
 #define DoDebugLib DebugLibDps
 #define DoProfileLib ProfileLibDps
-#define LibName dps
+#define LibName NX_dps
 #define SoRev SODPSREV
 #define IncSubdir DPS
 
diff --git a/nx-X11/lib/dpstk/Imakefile b/nx-X11/lib/dpstk/Imakefile
index 323e584..163534d 100644
--- a/nx-X11/lib/dpstk/Imakefile
+++ b/nx-X11/lib/dpstk/Imakefile
@@ -5,7 +5,7 @@ XCOMM $XFree86: xc/lib/dpstk/Imakefile,v 1.5 2000/05/23 19:32:52 dawes Exp $
 #define DoExtraLib SharedLibDpsTk
 #define DoDebugLib DebugLibDpsTk
 #define DoProfileLib ProfileLibDpsTk
-#define LibName dpstk
+#define LibName NX_dpstk
 #define SoRev SODPSTKREV
 #define LibHeaders NO
 
diff --git a/nx-X11/lib/expat/Imakefile b/nx-X11/lib/expat/Imakefile
index c7ff20b..cb2c6e1 100644
--- a/nx-X11/lib/expat/Imakefile
+++ b/nx-X11/lib/expat/Imakefile
@@ -6,7 +6,7 @@ XCOMM $XFree86: xc/lib/expat/Imakefile,v 1.8tsi Exp $
 #define DoDebugLib DebugLibExpat
 #define DoProfileLib ProfileLibExpat
 #define HasSharedData YES
-#define LibName expat
+#define LibName NX_expat
 #define SoRev SOEXPATREV
 #ifdef SharedLibtoolExpatRev
 #define SharedLibtoolRev SharedLibtoolExpatRev
@@ -19,7 +19,7 @@ EXPATTOP = $(TOP)/extras/expat
 EXPATSRC = $(EXPATTOP)/lib
 EXPATINC = $(EXPATTOP)/lib
 
-INCLUDES = -I$(EXPATINC) -I$(EXPATTOP) -I.
+INCLUDES = -I/usr/include/xmltok -I/usr/local/include/xmltok -I$(EXPATINC) -I$(EXPATTOP) -I. 
 
 /*
  * Endianness (for short's)
@@ -31,8 +31,8 @@ INCLUDES = -I$(EXPATINC) -I$(EXPATTOP) -I.
 DEFINES = -DXML_BYTE_ORDER=0 -DX_BYTE_ORDER=$(X_BYTE_ORDER)
 REQUIREDLIBS=$(LDPRELIBS)
 
-SRCS = xmlparse.c xmltok.c xmlrole.c
-OBJS = xmlparse.o xmltok.o xmlrole.o
+#SRCS = xmlparse.c xmltok.c xmlrole.c
+#OBJS = xmlparse.o xmltok.o xmlrole.o
 
 HEADERS = expat.h
 
@@ -45,9 +45,9 @@ SpecialCObjectRule(sharedlib,NullParameter,$(SHLIBDEF))
 
 DependTarget()
 
-LinkSourceFile(xmlparse.c,$(EXPATSRC))
-LinkSourceFile(xmltok.c,$(EXPATSRC))
-LinkSourceFile(xmlrole.c,$(EXPATSRC))
+#LinkSourceFile(xmlparse.c,$(EXPATSRC))
+#LinkSourceFile(xmltok.c,$(EXPATSRC))
+#LinkSourceFile(xmlrole.c,$(EXPATSRC))
 LinkSourceFile(expat.h,$(EXPATINC))
 
 
diff --git a/nx-X11/lib/font/Imakefile b/nx-X11/lib/font/Imakefile
index 02ddd8e..f47fe96 100644
--- a/nx-X11/lib/font/Imakefile
+++ b/nx-X11/lib/font/Imakefile
@@ -31,7 +31,7 @@ XCOMM $XFree86: xc/lib/font/Imakefile,v 3.37 2003/10/24 16:21:12 tsi Exp $
 STUBDIRS = stubs
 #endif
 
-LIBNAME = Xfont
+LIBNAME = NX_Xfont
 SOREV = $(SOFONTREV)
 
 #ifndef SeparateSharedCompile
diff --git a/nx-X11/lib/fontconfig/Imakefile b/nx-X11/lib/fontconfig/Imakefile
index 938bc3e..754cdc9 100644
--- a/nx-X11/lib/fontconfig/Imakefile
+++ b/nx-X11/lib/fontconfig/Imakefile
@@ -7,7 +7,7 @@ XCOMM $XFree86: xc/lib/fontconfig/Imakefile,v 1.17 2003/11/19 20:57:37 dawes Exp
 #define DoDebugLib DebugLibFontconfig
 #define DoProfileLib ProfileLibFontconfig
 #define HasSharedData YES
-#define LibName fontconfig
+#define LibName NX_fontconfig
 #define SoRev SOFONTCONFIGREV
 #define LibInstall InstallFontconfigLibrary
 #define LibHeaders InstallFontconfigLibrary
diff --git a/nx-X11/lib/fontenc/Imakefile b/nx-X11/lib/fontenc/Imakefile
index 2bdb056..9d77cc2 100644
--- a/nx-X11/lib/fontenc/Imakefile
+++ b/nx-X11/lib/fontenc/Imakefile
@@ -17,7 +17,7 @@ FONTENCDEFS = -DFONTENC_NO_LIBFONT \
 #define DoSharedLib SharedLibFontEnc
 #define DoDebugLib DebugLibFontEnc
 #define DoProfileLib ProfileLibFontEnc
-#define LibName fontenc
+#define LibName NX_fontenc
 #define SoRev SOFONTENCREV
 #define IncSubdir X11
 #define IncSubSubdir fonts
diff --git a/nx-X11/lib/freetype2/Imakefile b/nx-X11/lib/freetype2/Imakefile
index eed70ad..5484906 100644
--- a/nx-X11/lib/freetype2/Imakefile
+++ b/nx-X11/lib/freetype2/Imakefile
@@ -11,7 +11,7 @@ XCOMM $XFree86: xc/lib/freetype2/Imakefile,v 1.19 2003/11/21 02:33:22 dawes Exp
 #define DoDebugLib DebugLibFreetype2
 #define DoProfileLib ProfileLibFreetype2
 #define HasSharedData YES
-#define LibName freetype
+#define LibName NX_freetype
 #define SoRev SOFREETYPE2REV
 #ifdef SharedLibtoolFreetype2Rev
 #define SharedLibtoolRev SharedLibtoolFreetype2Rev
diff --git a/nx-X11/lib/oldX/Imakefile b/nx-X11/lib/oldX/Imakefile
index ae80d26..663d110 100644
--- a/nx-X11/lib/oldX/Imakefile
+++ b/nx-X11/lib/oldX/Imakefile
@@ -10,7 +10,7 @@ XCOMM $XFree86: xc/lib/oldX/Imakefile,v 1.2 1998/12/20 11:57:19 dawes Exp $
 #define DoExtraLib SharedOldX
 #define DoDebugLib DebugOldX
 #define DoProfileLib ProfileOldX
-#define LibName oldX
+#define LibName NX_oldX
 #define SoRev SOOLDXREV
 #define IncSubdir X11
 
diff --git a/nx-X11/lib/psres/Imakefile b/nx-X11/lib/psres/Imakefile
index 158cd11..e3ed6ac 100644
--- a/nx-X11/lib/psres/Imakefile
+++ b/nx-X11/lib/psres/Imakefile
@@ -5,7 +5,7 @@ XCOMM $XFree86: xc/lib/psres/Imakefile,v 1.3 2000/02/15 01:44:57 dawes Exp $
 #define DoExtraLib SharedLibPSRes
 #define DoDebugLib DebugLibPSRes
 #define DoProfileLib ProfileLibPSRes
-#define LibName psres
+#define LibName NX_psres
 #define SoRev SOPSRESREV
 #define LibHeaders NO
 
diff --git a/nx-X11/lib/regex/Imakefile b/nx-X11/lib/regex/Imakefile
index 434e8f6..bc0d8b6 100644
--- a/nx-X11/lib/regex/Imakefile
+++ b/nx-X11/lib/regex/Imakefile
@@ -6,7 +6,7 @@ XCOMM $XFree86$
 #define DoDebugLib	NO
 #define DoProfileLib	NO
 #define HasSharedData	NO
-#define LibName		regex
+#define LibName		NX_regex
 #define LibHeaders	NO
 #define LibInstall	NO
 #define LibInstallBuild	YES
diff --git a/nx-X11/lib/windows/Imakefile b/nx-X11/lib/windows/Imakefile
index 84e456b..d3c5677 100644
--- a/nx-X11/lib/windows/Imakefile
+++ b/nx-X11/lib/windows/Imakefile
@@ -2,7 +2,7 @@
 #define DoSharedLib SharedLibWindowsWM
 #define DoDebugLib DebugLibWindowsWM
 #define DoProfileLib ProfileLibWindowsWM
-#define LibName WindowsWM
+#define LibName NX_WindowsWM
 #define SoRev SOWINDOWSWMREV
 #define IncSubdir X11
 #define IncSubSubdir extensions
diff --git a/nx-X11/lib/xkbfile/Imakefile b/nx-X11/lib/xkbfile/Imakefile
index 7b751c9..d769381 100644
--- a/nx-X11/lib/xkbfile/Imakefile
+++ b/nx-X11/lib/xkbfile/Imakefile
@@ -11,7 +11,7 @@ XCOMM $XFree86: xc/lib/xkbfile/Imakefile,v 3.5 2003/10/15 21:23:38 herrb Exp $
 #define DoDebugLib	DebugLibxkbfile
 #define DoProfileLib	ProfileLibxkbfile
 #define HasSharedData	NO
-#define LibName		xkbfile
+#define LibName		NX_xkbfile
 #define SoRev		SOXKBFILEREV
 #define IncSubdir	X11
 #define	IncSubSubdir	extensions
diff --git a/nx-X11/lib/xkbui/Imakefile b/nx-X11/lib/xkbui/Imakefile
index f27bad6..a017d68 100644
--- a/nx-X11/lib/xkbui/Imakefile
+++ b/nx-X11/lib/xkbui/Imakefile
@@ -6,7 +6,7 @@ XCOMM $XFree86: xc/lib/xkbui/Imakefile,v 3.4 2003/10/15 21:23:38 herrb Exp $
 #define DoDebugLib DebugLibxkbui
 #define DoProfileLib ProfileLibxkbui
 #define HasSharedData NO
-#define LibName xkbui
+#define LibName NX_xkbui
 #define SoRev SOXKBUIREV
 #define	IncSubdir X11
 #define	IncSubSubdir extensions
diff --git a/nx-X11/lib/zlib/Imakefile b/nx-X11/lib/zlib/Imakefile
index d1293c9..6b48eda 100644
--- a/nx-X11/lib/zlib/Imakefile
+++ b/nx-X11/lib/zlib/Imakefile
@@ -12,7 +12,7 @@ XCOMM $XFree86: xc/lib/zlib/Imakefile,v 1.9tsi Exp $
 #define DoDebugLib    NO
 #define DoProfileLib  NO
 #define HasSharedData NO
-#define LibName       z
+#define LibName       NX_z
 #define SoRev         SOZLIBREV
 
  ZLIBDIR = $(TOP)/extras/zlib
diff --git a/nx-X11/programs/Xserver/Imakefile b/nx-X11/programs/Xserver/Imakefile
index 6bf7801..24e8850 100644
--- a/nx-X11/programs/Xserver/Imakefile
+++ b/nx-X11/programs/Xserver/Imakefile
@@ -313,7 +313,7 @@ XPFBLIBS = dix/LibraryTargetName(xpstubs)
        FONTBASE = $(FONTLIBSRC)/fontbase.o \
 		  $(FONTLIBSRC)/LibraryTargetName(fontbase)
 #if XserverStaticFontLib
-           FONT = $(FONTLIBSRC)/LibraryTargetName(Xfont) $(FREETYPE2LIB)
+           FONT = $(FONTLIBSRC)/LibraryTargetName(NX_Xfont) $(FREETYPE2LIB)
 #else
            FONT = $(LDPRELIB) $(XFONTLIB) $(FREETYPE2LIB)
 #endif
@@ -994,7 +994,7 @@ NXAGENTOBJS = hw/nxagent/miinitext.o     \
               dix/main.o
 #endif
 
-XPMLIB =  -lXpm
+XPMLIB =  -lNX_Xpm
 NXAGENT = hw/nxagent/LibraryTargetName(nxagent)
 NXAGENTLIBS = PreFbLibs $(NXAGENT) FbPostFbLibs $(NXAGENT) $(MI)
 NXAGENTSYSLIBS = $(FONTLIBS) $(LDPRELIBS) $(XLIB) $(SYSLIBS) $(XPMLIB)
@@ -1012,16 +1012,19 @@ $(NXAGENTOBJS) $(NXAGENTLIBS) $(NXAGENTSYSLIBS):: $(NXAGENTDIRS)
 
 #if defined(SunArchitecture)
 NXAGENTNXLIBS = -L ../../../nxcomp -L ../../../nxcompext -L ../../../nxcompshad \
-                -lXcomp -lXcompext -lXcompshad -lrt -L/usr/sfw/lib -lXrender -lXfixes \
-                -L../../../nx-X11/exports/lib -lXtst -lXdamage -lXrandr -lXcomposite
+                -lXcomp -lXcompext -lXcompshad -lrt -L/usr/sfw/lib -lNX_Xrender -lNX_Xfixes \
+                -L../../../nx-X11/exports/lib -lNX_Xtst -lNX_Xdamage -lNX_Xrandr -lNX_Xcomposite -lNX_Xdmcp \
+`pkg-config --libs libxml-2.0`
 #elif defined(cygwinArchitecture)
 NXAGENTNXLIBS = -L ../../../nxcomp -L ../../../nxcompext \
-                -lXcomp -lXcompext -lXrender -lX11 -lXext -lXcomposite -lXfixes \
-                -L ../../../nxcompshad -lXcompshad -L../../../nx-X11/exports/lib -lXtst
+                -lXcomp -lXcompext -lNX_Xrender -lX11 -lNX_Xext -lNX_Xcomposite -lNX_Xfixes \
+                -L ../../../nxcompshad -lXcompshad -L../../../nx-X11/exports/lib -lNX_Xtst -lNX_Xdmcp \
+`pkg-config --libs libxml-2.0`
 #else
 NXAGENTNXLIBS = -L ../../../nxcomp -L ../../../nxcompext -L ../../../nxcompshad \
-                -lXcomp -lXcompext -lXcompshad -lXrender -lX11 -lXext -lXfixes \
-                -L../../../nx-X11/exports/lib -lXtst -lXdamage -lXrandr -lXcomposite
+                -lXcomp -lXcompext -lXcompshad -lNX_Xrender -lNX_X11 -lNX_Xext -lNX_Xfixes \
+                -L../../../nx-X11/exports/lib -lNX_Xtst -lNX_Xdamage -lNX_Xrandr -lNX_Xcomposite -lNX_Xinerama -lNX_Xdmcp \
+`pkg-config --libs libxml-2.0`
 #endif
 
 #endif
@@ -1036,18 +1039,20 @@ NX_XSHADOWLIBDIR    = $(XTOP)/../nxcompshad
 NX_XSHADOWLIBTARGET = $(NX_XSHADOWLIBDIR)/$(NX_XSHADOWLIBNAME)
 NX_XSHADOWCONFIGTARGET = $(NX_XSHADOWLIBDIR)/config.status
 
+CONFIGURE ?= ./configure
+
 $(NX_XSHADOWCONFIGTARGET):
 	cd $(NX_XSHADOWLIBDIR) &amp;&amp; \
-	./configure
+	${CONFIGURE}
 
 #ifdef SunArchitecture
 $(NX_XSHADOWLIBTARGET): $(NX_XSHADOWCONFIGTARGET)
 	cd $(NX_XSHADOWLIBDIR) &amp;&amp; \
-	gmake
+	${MAKE}
 #else
 $(NX_XSHADOWLIBTARGET): $(NX_XSHADOWCONFIGTARGET)
 	cd $(NX_XSHADOWLIBDIR) &amp;&amp; \
-	make
+	rm -f *.o &amp;&amp; ${MAKE}
 #endif
 
 ServerTarget(nxagent,$(NX_XSHADOWLIBTARGET) $(NXAGENTDIRS),$(NXAGENTOBJS), \
@@ -1073,7 +1078,7 @@ nxagent_static_nolibs:  nxagent
 	else exit 0; fi
 	$(CCLINK) -o nxagent_static_nolibs -Wl,-Bstatic $(LDOPTIONS) $(NXAGENTOBJS) \
 	$(NXAGENTLIBS) $(LOADABLEEXTS) $(LIBCWRAPPER) $(LDLIBS) $(FONTLIBS) \
-	$(LDPRELIBS) $(SYSLIBS) -Wl,-Bdynamic -lXext -lX11 $(EXTRA_LOAD_FLAGS)
+	$(LDPRELIBS) $(SYSLIBS) -Wl,-Bdynamic -lNX_Xext -lNX_X11 $(EXTRA_LOAD_FLAGS)
 #endif /* NXAgentServer */
 
 #if defined(XnonServer) &amp;&amp; XnonServer
diff --git a/nx-X11/programs/Xserver/Xext/panoramiX.c b/nx-X11/programs/Xserver/Xext/panoramiX.c
index 33faedc..a1a5b9f 100644
--- a/nx-X11/programs/Xserver/Xext/panoramiX.c
+++ b/nx-X11/programs/Xserver/Xext/panoramiX.c
@@ -1045,16 +1045,7 @@ ProcXineramaIsActive(ClientPtr client)
     rep.type = X_Reply;
     rep.length = 0;
     rep.sequenceNumber = client-&gt;sequence;
-#if 1
-    {
-	/* The following hack fools clients into thinking that Xinerama
-	 * is disabled even though it is not. */
-	extern Bool PanoramiXExtensionDisabledHack;
-	rep.state = !noPanoramiXExtension &amp;&amp; !PanoramiXExtensionDisabledHack;
-    }
-#else
     rep.state = !noPanoramiXExtension;
-#endif
     if (client-&gt;swapped) {
 	register int n;
 	swaps (&amp;rep.sequenceNumber, n);
diff --git a/nx-X11/programs/Xserver/Xext/panoramiX.h b/nx-X11/programs/Xserver/Xext/panoramiX.h
index 5fa4ed3..4178b98 100644
--- a/nx-X11/programs/Xserver/Xext/panoramiX.h
+++ b/nx-X11/programs/Xserver/Xext/panoramiX.h
@@ -44,7 +44,7 @@ Equipment Corporation.
 #define _PANORAMIX_H_
 
 #include &lt;X11/extensions/panoramiXext.h&gt;
-#include &quot;gcstruct.h&quot;
+/*#include &quot;gcstruct.h&quot;*/
 
 
 typedef struct _PanoramiXData {
diff --git a/nx-X11/programs/Xserver/Xext/security.c b/nx-X11/programs/Xserver/Xext/security.c
index 2139425..fc3bb99 100644
--- a/nx-X11/programs/Xserver/Xext/security.c
+++ b/nx-X11/programs/Xserver/Xext/security.c
@@ -86,7 +86,7 @@ extern unsigned char LbxReqCode;
 
 #ifdef NXAGENT_SERVER
 
-#define NX_ALTERNATIVEPOLICYFILE &quot;/usr/lib/xserver/SecurityPolicy&quot;
+#define NX_ALTERNATIVEPOLICYFILE &quot;/usr/share/nx/SecurityPolicy&quot;
 
 #endif
 
diff --git a/nx-X11/programs/Xserver/hw/nxagent/Args.c b/nx-X11/programs/Xserver/hw/nxagent/Args.c
index ecf04e2..fad0b62 100644
--- a/nx-X11/programs/Xserver/hw/nxagent/Args.c
+++ b/nx-X11/programs/Xserver/hw/nxagent/Args.c
@@ -148,6 +148,8 @@ static int nxagentGetDialogName(void);
 
 char nxagentVerbose = 0;
 
+char *nxagentKeystrokeFile = NULL;
+
 int ddxProcessArgument(int argc, char *argv[], int i)
 {
   /*
@@ -672,6 +674,12 @@ int ddxProcessArgument(int argc, char *argv[], int i)
     return 1;
   }
 
+  if (!strcmp(argv[i], &quot;-norootlessexit&quot;)) {
+    nxagentChangeOption(NoRootlessExit, True);
+    return 1;
+  }
+
+
   if (!strcmp(argv[i], &quot;-noonce&quot;))
   {
       nxagentOnce = False;
@@ -1015,6 +1023,20 @@ int ddxProcessArgument(int argc, char *argv[], int i)
     return 1;
   }
 
+  if (!strcmp(argv[i], &quot;-keystrokefile&quot;))
+  {
+    if (i + 1 &lt; argc)
+    {
+      if (NULL != (nxagentKeystrokeFile = strdup(argv[i + 1])))
+      {
+        return 2;
+      } else {
+	FatalError(&quot;malloc failed&quot;);
+      }
+    }
+    return 0;
+  }
+
   return 0;
 }
 
@@ -1855,6 +1877,7 @@ void ddxUseMsg()
   ErrorF(&quot;The NX system adds the following arguments:\n&quot;);
   ErrorF(&quot;-forcenx               force use of NX protocol messages assuming communication through nxproxy\n&quot;);
   ErrorF(&quot;-timeout int           auto-disconnect timeout in seconds (minimum allowed: 60)\n&quot;);
+  ErrorF(&quot;-norootlessexit        don't exit if there are no clients in rootless mode\n&quot;);
 #ifdef RENDER
   ErrorF(&quot;-norender              disable the use of the render extension\n&quot;);
   ErrorF(&quot;-nocomposite           disable the use of the composite extension\n&quot;);
diff --git a/nx-X11/programs/Xserver/hw/nxagent/Args.h b/nx-X11/programs/Xserver/hw/nxagent/Args.h
index 8f4d05d..85734be 100644
--- a/nx-X11/programs/Xserver/hw/nxagent/Args.h
+++ b/nx-X11/programs/Xserver/hw/nxagent/Args.h
@@ -83,4 +83,6 @@ extern int nxagentUserDefinedFontPath;
 
 extern int nxagentRemoteMajor;
 
+extern char *nxagentKeystrokeFile;
+
 #endif /* __Args_H__ */
diff --git a/nx-X11/programs/Xserver/hw/nxagent/Clipboard.c b/nx-X11/programs/Xserver/hw/nxagent/Clipboard.c
index 2742e14..d4fa4a9 100644
--- a/nx-X11/programs/Xserver/hw/nxagent/Clipboard.c
+++ b/nx-X11/programs/Xserver/hw/nxagent/Clipboard.c
@@ -166,7 +166,9 @@ Bool nxagentValidServerTargets(Atom target)
 
   if (target == XA_STRING) return True;
   if (target == serverTEXT) return True;
-
+  /* by dimbor */
+  if (target == serverUTF8_STRING) return True;
+    
   return False;
 }
 
@@ -402,7 +404,12 @@ FIXME: Do we need this?
         lastServerProperty = X-&gt;xselectionrequest.property;
         lastServerRequestor = X-&gt;xselectionrequest.requestor;
         lastServerTarget = X-&gt;xselectionrequest.target;
-        lastServerTime = X-&gt;xselectionrequest.time;
+
+        /* by dimbor */
+        if (lastServerTarget != XA_STRING)
+	  lastServerTarget = serverUTF8_STRING;
+			  
+	lastServerTime = X-&gt;xselectionrequest.time;
 
         x.u.u.type = SelectionRequest;
         x.u.selectionRequest.time = GetTimeInMillis();
@@ -424,11 +431,12 @@ FIXME: Do we need this?
 
         x.u.selectionRequest.selection = CurrentSelections[i].selection;
 
-        /*
-         * x.u.selectionRequest.target = X-&gt;xselectionrequest.target;
-         */
-
-        x.u.selectionRequest.target = XA_STRING;
+        /* by dimbor (idea from zahvatov) */
+        if (X-&gt;xselectionrequest.target != XA_STRING)
+          x.u.selectionRequest.target = clientUTF8_STRING;
+        else
+          x.u.selectionRequest.target = XA_STRING;
+					    
         x.u.selectionRequest.property = clientCutProperty;
 
         (void) TryClientEvents(lastSelectionOwner[i].client, &amp;x, 1,
@@ -1218,10 +1226,11 @@ int nxagentConvertSelection(ClientPtr client, WindowPtr pWin, Atom selection,
     Atom xa_STRING[4];
     xEvent x;
 
+    /* --- Order changed by dimbor (prevent sending COMPOUND_TEXT to client --- */
     xa_STRING[0] = XA_STRING;
-    xa_STRING[1] = clientTEXT;
-    xa_STRING[2] = clientCOMPOUND_TEXT;
-    xa_STRING[3] = clientUTF8_STRING;
+    xa_STRING[1] = clientUTF8_STRING;
+    xa_STRING[2] = clientTEXT;
+    xa_STRING[3] = clientCOMPOUND_TEXT;
 
     ChangeWindowProperty(pWin,
                          property,
diff --git a/nx-X11/programs/Xserver/hw/nxagent/Display.c b/nx-X11/programs/Xserver/hw/nxagent/Display.c
index 9031c25..b01d66c 100644
--- a/nx-X11/programs/Xserver/hw/nxagent/Display.c
+++ b/nx-X11/programs/Xserver/hw/nxagent/Display.c
@@ -77,6 +77,7 @@ is&quot; without express or implied warranty.
 #include &quot;NXlib.h&quot;
 
 #include NXAGENT_ICON_NAME
+#include X2GOAGENT_ICON_NAME
 
 /*
  * Set here the required log level.
@@ -1429,22 +1430,10 @@ FIXME: Use of nxagentParentWindow is strongly deprecated.
   g = pV.green_mask;
   b = pV.blue_mask;
 
-  if (!pV.red_mask || !pV.green_mask || !pV.blue_mask)
-  {
-    nxagentLogoBlack = 0x000000;
-    nxagentLogoRed   = 0xff0000;
-    nxagentLogoWhite = 0xffffff;
-  }
-  else
-  {
-    for (or=0, off=0x800000; (r&amp;(off&gt;&gt;or)) == 0; or++);
-    for (og=0, off=0x800000; (g&amp;(off&gt;&gt;og)) == 0; og++);
-    for (ob=0, off=0x800000; (b&amp;(off&gt;&gt;ob)) == 0; ob++);
-
-    nxagentLogoRed   = nxagentLogoColor(0xff0000);
-    nxagentLogoBlack = nxagentLogoColor(0x000000);
-    nxagentLogoWhite = 0xffffff;
-  }
+  nxagentLogoBlack = 0x000000;
+  nxagentLogoRed   = 0xff0000;
+  nxagentLogoWhite = 0xffffff;
+  nxagentLogoGray  = 0x222222;
 
   #ifdef WATCH
 
@@ -1941,12 +1930,29 @@ Bool nxagentMakeIcon(Display *display, Pixmap *nxIcon, Pixmap *nxMask)
   Bool success = False;
   XlibPixmap IconPixmap;
   XlibPixmap IconShape;
+  char* agent_icon_name;
+  char* agentIconData;
+
+  /*
+   * selecting x2go icon when running as X2Go agent
+   */
+  if(nxagentX2go)
+  {
+    agent_icon_name=X2GOAGENT_ICON_NAME;
+    agentIconData=x2goagentIconData;
+  }
+  else
+  {
+    agent_icon_name=NXAGENT_ICON_NAME;
+    agentIconData=nxagentIconData;
+  }
 
-  snprintf(default_path, PATH_MAX-1, &quot;/usr/NX/share/images/%s&quot;, NXAGENT_ICON_NAME);
+
+  snprintf(default_path, PATH_MAX-1, &quot;/usr/NX/share/images/%s&quot;, agent_icon_name);
 
   if ((icon_fp = fopen(default_path, &quot;r&quot;)) == NULL)
   {
-    icon_fp = nxagentLookForIconFile(NXAGENT_ICON_NAME, &quot;r&quot;, icon_path);
+    icon_fp = nxagentLookForIconFile(agent_icon_name, &quot;r&quot;, icon_path);
 
     if (icon_fp != NULL)
     {
@@ -1985,7 +1991,7 @@ Bool nxagentMakeIcon(Display *display, Pixmap *nxIcon, Pixmap *nxMask)
   {
      status = XpmCreatePixmapFromData(display,
                                         DefaultRootWindow(display),
-                                        nxagentIconData,
+                                        agentIconData,
                                         &amp;IconPixmap,
                                         &amp;IconShape,
                                         NULL);
@@ -2678,22 +2684,10 @@ Bool nxagentReconnectDisplay(void *p0)
   g = pV.green_mask;
   b = pV.blue_mask;
 
-  if (!pV.red_mask || !pV.green_mask || !pV.blue_mask)
-  {
-    nxagentLogoBlack = 0x000000;
-    nxagentLogoRed   = 0xff0000;
-    nxagentLogoWhite = 0xffffff;
-  }
-  else
-  {
-    for (or=0, off=0x800000; (r&amp;(off&gt;&gt;or)) == 0; or++);
-    for (og=0, off=0x800000; (g&amp;(off&gt;&gt;og)) == 0; og++);
-    for (ob=0, off=0x800000; (b&amp;(off&gt;&gt;ob)) == 0; ob++);
-
-    nxagentLogoRed   = nxagentLogoColor(0xff0000);
-    nxagentLogoBlack = nxagentLogoColor(0x000000);
-    nxagentLogoWhite = 0xffffff;
-  }
+  nxagentLogoBlack = 0x000000;
+  nxagentLogoRed   = 0xff0000;
+  nxagentLogoWhite = 0xffffff;
+  nxagentLogoGray  = 0x222222;
 
   useXpmIcon = nxagentMakeIcon(nxagentDisplay, &amp;nxagentIconPixmap, &amp;nxagentIconShape);
 
diff --git a/nx-X11/programs/Xserver/hw/nxagent/Error.c b/nx-X11/programs/Xserver/hw/nxagent/Error.c
index 43bf859..31ff4cf 100644
--- a/nx-X11/programs/Xserver/hw/nxagent/Error.c
+++ b/nx-X11/programs/Xserver/hw/nxagent/Error.c
@@ -497,7 +497,7 @@ char *nxagentGetRootPath(void)
   return rootPath;
 }
 
-char *nxagentGetSessionPath()
+char *nxagentGetSessionPath(void)
 {
 
   char *rootPath;
diff --git a/nx-X11/programs/Xserver/hw/nxagent/Error.h b/nx-X11/programs/Xserver/hw/nxagent/Error.h
index e55fd71..51d6171 100644
--- a/nx-X11/programs/Xserver/hw/nxagent/Error.h
+++ b/nx-X11/programs/Xserver/hw/nxagent/Error.h
@@ -34,4 +34,6 @@ void nxagentStartRedirectToClientsLog(void);
 
 void nxagentEndRedirectToClientsLog(void);
 
+char *nxagentGetSessionPath(void);
+
 #endif /* __Error_H__ */
diff --git a/nx-X11/programs/Xserver/hw/nxagent/Handlers.c b/nx-X11/programs/Xserver/hw/nxagent/Handlers.c
index 332816f..1fc6bbf 100644
--- a/nx-X11/programs/Xserver/hw/nxagent/Handlers.c
+++ b/nx-X11/programs/Xserver/hw/nxagent/Handlers.c
@@ -219,7 +219,7 @@ void nxagentBlockHandler(pointer data, struct timeval **timeout, pointer mask)
 
   if (nxagentOption(Rootless) &amp;&amp;
           nxagentLastWindowDestroyed &amp;&amp; nxagentRootlessDialogPid == 0 &amp;&amp;
-              now &gt; nxagentLastWindowDestroyedTime + 30 * 1000)
+              now &gt; nxagentLastWindowDestroyedTime + 30 * 1000 &amp;&amp; !nxagentOption(NoRootlessExit))
   {
     #ifdef WARNING
     fprintf(stderr, &quot;nxagentBlockHandler: No application running. Closing the session.\n&quot;);
diff --git a/nx-X11/programs/Xserver/hw/nxagent/Icons.h b/nx-X11/programs/Xserver/hw/nxagent/Icons.h
index 0601584..98e8796 100644
--- a/nx-X11/programs/Xserver/hw/nxagent/Icons.h
+++ b/nx-X11/programs/Xserver/hw/nxagent/Icons.h
@@ -24,6 +24,8 @@
 
 #define NXAGENT_ICON_NAME  &quot;nxagent.xpm&quot;
 
+#define X2GOAGENT_ICON_NAME  &quot;x2go.xpm&quot;
+
 #define NXAGENT_PLACEHOLDER_NAME  &quot;nxmissing.xpm&quot;
 
 #endif /* __Icons_H__ */
diff --git a/nx-X11/programs/Xserver/hw/nxagent/Image.c b/nx-X11/programs/Xserver/hw/nxagent/Image.c
index e499b7a..1f0b735 100644
--- a/nx-X11/programs/Xserver/hw/nxagent/Image.c
+++ b/nx-X11/programs/Xserver/hw/nxagent/Image.c
@@ -644,6 +644,10 @@ FIXME: Should use these.
             pDrawable -&gt; depth != 1 &amp;&amp;
                 nxagentOption(DeferLevel) &gt;= 1)
     {
+    /* -- changed by dimbor (small &quot;bed-sheets&quot; never need be prevented - always put) --*/
+     if (dstHeight &gt; 16)
+     {
+    /* -------------------------------------------------------------------------------- */
       #ifdef TEST
       fprintf(stderr, &quot;nxagentPutImage: WARNING! Prevented operation on region [%d,%d,%d,%d] &quot;
                   &quot;for drawable at [%p] with drawable pixmap.\n&quot;, pRegion -&gt; extents.x1,
@@ -654,6 +658,9 @@ FIXME: Should use these.
       nxagentMarkCorruptedRegion(pDrawable, pRegion);
 
       goto nxagentPutImageEnd;
+    /* --- changed by dimbor ---*/
+     }
+    /* ------------------------- */
     }
 
     if (pDrawable -&gt; type == DRAWABLE_WINDOW &amp;&amp;
diff --git a/nx-X11/programs/Xserver/hw/nxagent/Imakefile b/nx-X11/programs/Xserver/hw/nxagent/Imakefile
index 9657958..d812c7f 100644
--- a/nx-X11/programs/Xserver/hw/nxagent/Imakefile
+++ b/nx-X11/programs/Xserver/hw/nxagent/Imakefile
@@ -142,7 +142,8 @@ INCLUDES = -I. -I../../../../../nxcomp -I../../../../../nxcompext -I../../../../
            -I../../miext/damage -I../../miext/cw \
 	   -I../../GL/glx -I../../GL/include -I../../../../lib/GL/include -I../../Xext \
            -I$(EXTINCSRC) -I$(XINCLUDESRC) \
-	   $(VFBINCLUDES) $(NXFONTINCLUDES) $(LIBXRANDRINCLUDES)
+	   $(VFBINCLUDES) $(NXFONTINCLUDES) $(LIBXRANDRINCLUDES) \
+           `pkg-config --cflags-only-I libxml-2.0`
 #ifdef SunArchitecture
 INCLUDES = -I. -I../../../../../nxcomp -I../../../../../nxcompext -I../../../../../nxcompshad \
            -I../../../../extras/Mesa/include \
@@ -152,7 +153,8 @@ INCLUDES = -I. -I../../../../../nxcomp -I../../../../../nxcompext -I../../../../
 	   -I../../GL/glx -I../../GL/include -I../../../../lib/GL/include -I../../Xext \
            -I../../miext/damage -I../../miext/cw \
            -I$(EXTINCSRC) -I$(XINCLUDESRC) \
-	   $(VFBINCLUDES) $(NXFONTINCLUDES) $(LIBXRANDRINCLUDES)
+	   $(VFBINCLUDES) $(NXFONTINCLUDES) $(LIBXRANDRINCLUDES) \
+           `pkg-config --cflags-only-I libxml-2.0`
 #else
 #ifdef cygwinArchitecture
 INCLUDES = -I. -I$(XBUILDINCDIR) -I$(FONTINCSRC) \
@@ -162,7 +164,8 @@ INCLUDES = -I. -I$(XBUILDINCDIR) -I$(FONTINCSRC) \
            -I../../../../../nxcomp -I../../../../../nxcompext -I../../../../../nxcompshad \
            -I../../../../extras/Mesa/include \
            -I$(EXTINCSRC) -I$(XINCLUDESRC) \
-	   $(VFBINCLUDES) $(NXFONTINCLUDES) $(LIBXRANDRINCLUDES)
+	   $(VFBINCLUDES) $(NXFONTINCLUDES) $(LIBXRANDRINCLUDES) \
+           `pkg-config --cflags-only-I libxml-2.0`
 #endif
 #endif
 
@@ -206,7 +209,7 @@ DEFINES = -g $(OS_DEFINES) $(EXT_DEFINES) $(UPG_DEFINES) \
           -UNX_DEBUG_INPUT \
 	  -DRANDR_10_INTERFACE \
 	  -DRANDR_12_INTERFACE \
-          -UPANORAMIX \
+          -DPANORAMIX \
           -UDEBUG_TREE
 
 all:: $(OBJS)
diff --git a/nx-X11/programs/Xserver/hw/nxagent/Init.c b/nx-X11/programs/Xserver/hw/nxagent/Init.c
index a50e8a5..a4c341a 100644
--- a/nx-X11/programs/Xserver/hw/nxagent/Init.c
+++ b/nx-X11/programs/Xserver/hw/nxagent/Init.c
@@ -177,6 +177,29 @@ int nxagentSaveUnder;
 
 int nxagentDoFullGeneration = 1;
 
+ /*
+ * 1 if agent running as X2goAgent
+ * 0 if NX Agent
+ */
+int nxagentX2go;
+
+/*
+ * Checking if agent is x2go agent
+ */
+
+void checkX2goAgent()
+{
+  extern const char *__progname;
+  if( strcasecmp(__progname,&quot;x2goagent&quot;) == 0)
+  {
+    fprintf(stderr, &quot;\nrunning as X2Go Agent\n&quot;);
+    nxagentX2go=1;
+  }
+  else
+    nxagentX2go=0;
+}
+
+
 /*
  * Called at X server's initialization.
  */
@@ -193,6 +216,11 @@ void InitOutput(ScreenInfo *screenInfo, int argc, char *argv[])
   #endif
 
   /*
+   * Check if we running as X2Go Agent
+   */
+  checkX2goAgent();
+
+  /*
    * Print our pid and version information.
    */
 
diff --git a/nx-X11/programs/Xserver/hw/nxagent/Init.h b/nx-X11/programs/Xserver/hw/nxagent/Init.h
index 2dc0f5c..b516c7b 100644
--- a/nx-X11/programs/Xserver/hw/nxagent/Init.h
+++ b/nx-X11/programs/Xserver/hw/nxagent/Init.h
@@ -37,6 +37,8 @@ extern int nxagentDoFullGeneration;
 extern int nxagentBackingStore;
 extern int nxagentSaveUnder;
 
+extern int  nxagentX2go;
+
 extern ServerGrabInfoRec nxagentGrabServerInfo;
 
 #endif /* __Init_H__ */
diff --git a/nx-X11/programs/Xserver/hw/nxagent/Keyboard.c b/nx-X11/programs/Xserver/hw/nxagent/Keyboard.c
index e3b58b6..dfafe1e 100644
--- a/nx-X11/programs/Xserver/hw/nxagent/Keyboard.c
+++ b/nx-X11/programs/Xserver/hw/nxagent/Keyboard.c
@@ -52,6 +52,7 @@ is&quot; without express or implied warranty.
 #include &quot;Keyboard.h&quot;
 #include &quot;Events.h&quot;
 #include &quot;Options.h&quot;
+#include &quot;Error.h&quot;
 
 #include &quot;NXlib.h&quot;
 
@@ -136,7 +137,7 @@ extern        Status        XkbGetControls(
 #define XKB_ALTERNATE_BASE_DIRECTORY   &quot;/usr/X11R6/lib/X11/xkb&quot;
 #endif
 #ifndef XKB_CONFIG_FILE
-#define XKB_CONFIG_FILE      &quot;X0-config.keyboard&quot;
+#define XKB_CONFIG_FILE      &quot;/etc/nxagent/nxagent.keyboard&quot;
 #endif
 #ifndef XKB_DFLT_RULES_FILE
 #define XKB_DFLT_RULES_FILE  &quot;xfree86&quot;
@@ -985,8 +986,7 @@ XkbError:
 
         XkbGetControls(nxagentDisplay, XkbAllControlsMask, xkb);
 
-        nxagentXkbConfigFilePathSize = strlen(XkbBaseDirectory) +
-                                           strlen(XKB_CONFIG_FILE) + 1;
+        nxagentXkbConfigFilePathSize = strlen(XKB_CONFIG_FILE);
 
         nxagentXkbConfigFilePath = malloc((nxagentXkbConfigFilePathSize + 1) * sizeof(char));
 
@@ -995,9 +995,7 @@ XkbError:
           FatalError(&quot;nxagentKeyboardProc: malloc failed.&quot;);
         }
 
-        strcpy(nxagentXkbConfigFilePath, XkbBaseDirectory);
-        strcat(nxagentXkbConfigFilePath, &quot;/&quot;);
-        strcat(nxagentXkbConfigFilePath, XKB_CONFIG_FILE);
+        strcpy(nxagentXkbConfigFilePath, XKB_CONFIG_FILE);
  
         #ifdef TEST
         fprintf(stderr, &quot;nxagentKeyboardProc: nxagentXkbConfigFilePath [%s].\n&quot;,
@@ -1793,6 +1791,42 @@ void nxagentKeycodeConversionSetup(void)
   }
   #endif
 
+  if (drulesLen != 0)
+  {
+    char *sessionpath = nxagentGetSessionPath();
+    if (sessionpath != NULL){
+      int keyboard_file_path_size = strlen(sessionpath) + strlen(&quot;/keyboard&quot;);
+      char *keyboard_file_path = malloc((keyboard_file_path_size + 1) * sizeof(char));
+      FILE *keyboard_file;
+      if ( keyboard_file_path == NULL)
+      {
+        FatalError(&quot;nxagentKeyboardProc: malloc failed.&quot;);
+      }
+      strcpy(keyboard_file_path, sessionpath);
+      strcat(keyboard_file_path, &quot;/keyboard&quot;);
+      if ((keyboard_file = fopen(keyboard_file_path, &quot;w&quot;)) != NULL) {
+        if ( drules != NULL )
+          fprintf(keyboard_file, &quot;rules=%s\n&quot;, drules);
+        if ( dmodel != NULL )
+          fprintf(keyboard_file, &quot;model=%s\n&quot;, dmodel);
+        if ( dlayout != NULL )
+          fprintf(keyboard_file, &quot;layout=%s\n&quot;, dlayout);
+        if ( dvariant != NULL )
+          fprintf(keyboard_file, &quot;variant=%s\n&quot;, dvariant);
+        if ( doptions != NULL )
+          fprintf(keyboard_file, &quot;options=%s\n&quot;, doptions);
+        fclose(keyboard_file);
+      }
+      free(keyboard_file_path);
+      fprintf(stderr, &quot;keyboard file created\n&quot;);
+    }
+    fprintf(stderr, &quot;SessionPath not defined\n&quot;);
+  }
+  else
+  {
+    fprintf(stderr, &quot;Failed to create the keyboard file\n&quot;);
+  }
+
   if (nxagentOption(ClientOs) == ClientOsLinux &amp;&amp;
             drules != NULL &amp;&amp; dmodel != NULL &amp;&amp;
                 (strcmp(drules, &quot;evdev&quot;) == 0 ||
diff --git a/nx-X11/programs/Xserver/hw/nxagent/Keystroke.c b/nx-X11/programs/Xserver/hw/nxagent/Keystroke.c
index 6c6e477..694781c 100644
--- a/nx-X11/programs/Xserver/hw/nxagent/Keystroke.c
+++ b/nx-X11/programs/Xserver/hw/nxagent/Keystroke.c
@@ -28,8 +28,15 @@
 #include &quot;Keystroke.h&quot;
 #include &quot;Drawable.h&quot;
 
+#include &lt;unistd.h&gt;
+
+#include &lt;libxml/parser.h&gt;
+#include &lt;libxml/tree.h&gt;
+
 extern Bool nxagentWMIsRunning;
 extern Bool nxagentIpaq;
+extern char *nxagentKeystrokeFile;
+Bool nxagentKeystrokeFileParsed = False;
 
 #ifdef NX_DEBUG_INPUT
 int nxagentDebugInputDevices = 0;
@@ -47,10 +54,369 @@ extern void nxagentDeactivateInputDevicesGrabs();
 #undef  DEBUG
 #undef  DUMP
 
+
+/* this table is used to parse actions given on the command line or in the
+ * config file, therefore indices have to match the enum in Keystroke.h */
+char * nxagentSpecialKeystrokeNames[] = {
+       &quot;end_marker&quot;,
+       &quot;close_session&quot;,
+       &quot;switch_all_screens&quot;,
+       &quot;minimize&quot;,
+       &quot;left&quot;,
+       &quot;up&quot;,
+       &quot;right&quot;,
+       &quot;down&quot;,
+       &quot;resize&quot;,
+       &quot;defer&quot;,
+       &quot;ignore&quot;,
+       &quot;force_synchronization&quot;,
+
+       &quot;debug_tree&quot;,
+       &quot;regions_on_screen&quot;,
+       &quot;test_input&quot;,
+       &quot;deactivate_input_devices_grab&quot;,
+
+       &quot;fullscreen&quot;,
+       &quot;viewport_move_left&quot;,
+       &quot;viewport_move_up&quot;,
+       &quot;viewport_move_right&quot;,
+       &quot;viewport_move_down&quot;,
+       NULL,
+};
+
+struct nxagentSpecialKeystrokeMap default_map[] = {
+  /* stroke, modifierMask, modifierAltMeta, keysym */
+  {KEYSTROKE_DEBUG_TREE, ControlMask, 1, XK_q},
+  {KEYSTROKE_DEBUG_TREE, ControlMask, 1, XK_Q},
+  {KEYSTROKE_CLOSE_SESSION, ControlMask, 1, XK_t},
+  {KEYSTROKE_CLOSE_SESSION, ControlMask, 1, XK_T},
+  {KEYSTROKE_SWITCH_ALL_SCREENS, ControlMask, 1, XK_f},
+  {KEYSTROKE_SWITCH_ALL_SCREENS, ControlMask, 1, XK_F},
+  {KEYSTROKE_MINIMIZE, ControlMask, 1, XK_m},
+  {KEYSTROKE_MINIMIZE, ControlMask, 1, XK_M},
+  {KEYSTROKE_LEFT, ControlMask, 1, XK_Left},
+  {KEYSTROKE_LEFT, ControlMask, 1, XK_KP_Left},
+  {KEYSTROKE_UP, ControlMask, 1, XK_Up},
+  {KEYSTROKE_UP, ControlMask, 1, XK_KP_Up},
+  {KEYSTROKE_RIGHT, ControlMask, 1, XK_Right},
+  {KEYSTROKE_RIGHT, ControlMask, 1, XK_KP_Right},
+  {KEYSTROKE_DOWN, ControlMask, 1, XK_Down},
+  {KEYSTROKE_DOWN, ControlMask, 1, XK_KP_Down},
+  {KEYSTROKE_RESIZE, ControlMask, 1, XK_r},
+  {KEYSTROKE_RESIZE, ControlMask, 1, XK_R},
+  {KEYSTROKE_DEFER, ControlMask, 1, XK_e},
+  {KEYSTROKE_DEFER, ControlMask, 1, XK_E},
+  {KEYSTROKE_IGNORE, ControlMask, 1, XK_BackSpace},
+  {KEYSTROKE_IGNORE, 0, 0, XK_Terminate_Server},
+  {KEYSTROKE_FORCE_SYNCHRONIZATION, ControlMask, 1, XK_j},
+  {KEYSTROKE_FORCE_SYNCHRONIZATION, ControlMask, 1, XK_J},
+  {KEYSTROKE_REGIONS_ON_SCREEN, ControlMask, 1, XK_a},
+  {KEYSTROKE_REGIONS_ON_SCREEN, ControlMask, 1, XK_A},
+  {KEYSTROKE_TEST_INPUT, ControlMask, 1, XK_x},
+  {KEYSTROKE_TEST_INPUT, ControlMask, 1, XK_X},
+  {KEYSTROKE_DEACTIVATE_INPUT_DEVICES_GRAB, ControlMask, 1, XK_y},
+  {KEYSTROKE_DEACTIVATE_INPUT_DEVICES_GRAB, ControlMask, 1, XK_Y},
+  {KEYSTROKE_FULLSCREEN, ControlMask | ShiftMask, 1, XK_f},
+  {KEYSTROKE_FULLSCREEN, ControlMask | ShiftMask, 1, XK_F},
+  {KEYSTROKE_VIEWPORT_MOVE_LEFT, ControlMask | ShiftMask, 1, XK_Left},
+  {KEYSTROKE_VIEWPORT_MOVE_LEFT, ControlMask | ShiftMask, 1, XK_KP_Left},
+  {KEYSTROKE_VIEWPORT_MOVE_UP, ControlMask | ShiftMask, 1, XK_Up},
+  {KEYSTROKE_VIEWPORT_MOVE_UP, ControlMask | ShiftMask, 1, XK_KP_Up},
+  {KEYSTROKE_VIEWPORT_MOVE_RIGHT, ControlMask | ShiftMask, 1, XK_Right},
+  {KEYSTROKE_VIEWPORT_MOVE_RIGHT, ControlMask | ShiftMask, 1, XK_KP_Right},
+  {KEYSTROKE_VIEWPORT_MOVE_DOWN, ControlMask | ShiftMask, 1, XK_Down},
+  {KEYSTROKE_VIEWPORT_MOVE_DOWN, ControlMask | ShiftMask, 1, XK_KP_Down},
+  {KEYSTROKE_END_MARKER, 0, 0, 0},
+};
+struct nxagentSpecialKeystrokeMap *map = default_map;
+
+static int modifier_matches(unsigned int mask, int compare_alt_meta, unsigned int state)
+{
+  /* nxagentAltMetaMask needs special handling
+   * it seems to me its an and-ed mask of all possible meta and alt keys
+   * somehow...
+   *
+   * otherwise this function would be just a simple bitop
+   */
+  int ret = 1;
+
+  if (compare_alt_meta) {
+    if (! (state &amp; nxagentAltMetaMask)) {
+      ret = 0;
+    }
+
+    mask &amp;= ~nxagentAltMetaMask;
+  }
+
+  /* all modifiers except meta/alt have to match exactly, extra bits are evil */
+  if ((mask &amp; state) != mask) {
+    ret = 0;
+  }
+
+  return ret;
+}
+
+static int read_binding_from_xmlnode(xmlNode *node, struct nxagentSpecialKeystrokeMap *ret)
+{
+  int successful = 0;
+  struct nxagentSpecialKeystrokeMap new = {0, 0, 0, 0};
+  xmlAttr *attr;
+
+  for (attr = node-&gt;properties; attr; attr = attr-&gt;next)
+  {
+    /* ignore attributes without data (which should never happen anyways) */
+    if (attr-&gt;children-&gt;content == NULL)
+    {
+      char *aname = (attr-&gt;name)?(attr-&gt;name):&quot;unknown&quot;;
+      fprintf(stderr, &quot;attribute %s with NULL value&quot;, aname);
+      continue;
+    }
+    if (strcmp((char *)attr-&gt;name, &quot;action&quot;) == 0)
+    {
+      int i;
+      for (i = 0; nxagentSpecialKeystrokeNames[i] != NULL; i++)
+      {
+        if (strcmp(nxagentSpecialKeystrokeNames[i],(char *)attr-&gt;children-&gt;content) == 0)
+        {
+          /* this relies on the values of enum nxagentSpecialKeystroke and the
+           * indices of nxagentSpecialKeystrokeNames being in sync */
+          new.stroke = i;
+          break;
+        }
+      }
+      continue;
+    }
+    else if (strcmp((char *)attr-&gt;name, &quot;key&quot;) == 0)
+    {
+      new.keysym = XStringToKeysym((char *)attr-&gt;children-&gt;content);
+      /* NoSymbol is usually 0, but could there be weird implementations? */
+      if (new.keysym == NoSymbol)
+      {
+        new.keysym = 0;
+      }
+      continue;
+    }
+
+    /* ignore attributes with value=&quot;0&quot; or &quot;false&quot;, everything else is interpreted as true */
+    if (strcmp((char *)attr-&gt;children-&gt;content, &quot;0&quot;) == 0 || strcmp((char *)attr-&gt;children-&gt;content, &quot;false&quot;) == 0)
+      continue;
+
+    if (strcmp((char *)attr-&gt;name, &quot;Mod1&quot;) == 0)
+    {
+      new.modifierMask |= Mod1Mask;
+    }
+    else if (strcmp((char *)attr-&gt;name, &quot;Mod2&quot;) == 0)
+    {
+      new.modifierMask |= Mod2Mask;
+    }
+    else if (strcmp((char *)attr-&gt;name, &quot;Mod3&quot;) == 0)
+    {
+      new.modifierMask |= Mod3Mask;
+    }
+    else if (strcmp((char *)attr-&gt;name, &quot;Mod4&quot;) == 0)
+    {
+      new.modifierMask |= Mod4Mask;
+    }
+    else if (strcmp((char *)attr-&gt;name, &quot;Control&quot;) == 0)
+    {
+      new.modifierMask |= ControlMask;
+    }
+    else if (strcmp((char *)attr-&gt;name, &quot;Shift&quot;) == 0)
+    {
+      new.modifierMask |= ShiftMask;
+    }
+    else if (strcmp((char *)attr-&gt;name, &quot;Lock&quot;) == 0)
+    {
+      new.modifierMask |= LockMask;
+    }
+    else if (strcmp((char *)attr-&gt;name, &quot;AltMeta&quot;) == 0)
+    {
+      new.modifierAltMeta = 1;
+    }
+  }
+
+  if (new.stroke != 0 &amp;&amp; new.keysym != 0)
+  {
+    /* keysym and stroke are required, everything else is optional */
+    successful = 1;
+    memcpy(ret, &amp;new, sizeof(struct nxagentSpecialKeystrokeMap));
+  }
+  return successful;
+}
+
+/*
+ * searches a keystroke xml file
+ *
+ * search order:
+ *  - '-keystrokefile' commandline parameter
+ *  - $NXAGENT_KEYSTROKEFILE environment variable
+ *  - $HOME/.nx/config/keystroke.cfg
+ *  - /etc/nx/keystroke.cfg
+ *  - hardcoded traditional NX default settings
+ */
+static void parse_keystroke_file(void)
+{
+  char *filename = NULL;
+
+  char *homefile = &quot;/.nx/config/keystroke.cfg&quot;;
+  char *etcfile = &quot;/etc/nx/keystroke.cfg&quot;;
+
+  if (nxagentKeystrokeFile != NULL &amp;&amp; access(nxagentKeystrokeFile, R_OK) == 0)
+  {
+    filename = strdup(nxagentKeystrokeFile);
+    if (filename == NULL)
+    {
+      fprintf(stderr, &quot;malloc failed&quot;);
+      exit(EXIT_FAILURE);
+    }
+  }
+  else if ((filename = getenv(&quot;NXAGENT_KEYSTROKEFILE&quot;)) != NULL &amp;&amp; access(filename, R_OK) == 0)
+  {
+    filename = strdup(filename);
+    if (filename == NULL)
+    {
+      fprintf(stderr, &quot;malloc failed&quot;);
+      exit(EXIT_FAILURE);
+    }
+  }
+  else
+  {
+    char *homedir = getenv(&quot;HOME&quot;);
+    filename = NULL;
+    if (homedir != NULL)
+    {
+      homedir = strdup(homedir);
+      if (homedir == NULL)
+      {
+        fprintf(stderr, &quot;malloc failed&quot;);
+exit(EXIT_FAILURE);
+      }
+      filename = calloc(1, strlen(homefile) + strlen(homedir) + 1);
+      if (filename == NULL)
+      {
+        fprintf(stderr, &quot;malloc failed&quot;);
+        exit(EXIT_FAILURE);
+      }
+      strcpy(filename, homedir);
+      strcpy(filename + strlen(homedir), homefile);
+      if (homedir)
+      {
+        free(homedir);
+      }
+    }
+
+    if (access(filename, R_OK) == 0)
+    {
+      /* empty */
+    }
+    else if (access(etcfile, R_OK == 0))
+    {
+      if (filename)
+        free(filename);
+      filename = strdup(etcfile);
+      if (filename == NULL)
+      {
+        fprintf(stderr, &quot;malloc failed&quot;);
+        exit(EXIT_FAILURE);
+      }
+    }
+    else
+    {
+      if (filename)
+free(filename);
+      filename = NULL;
+    }
+  }
+
+  /* now we know which file to read, if any */
+  if (filename)
+  {
+    xmlDoc *doc = NULL;
+    xmlNode *root = NULL;
+    LIBXML_TEST_VERSION
+    doc = xmlReadFile(filename, NULL, 0);
+    if (doc != NULL)
+    {
+      xmlNode *cur = NULL;
+      root = xmlDocGetRootElement(doc);
+
+      for (cur = root; cur; cur = cur-&gt;next)
+      {
+        if (cur-&gt;type == XML_ELEMENT_NODE &amp;&amp; strcmp((char *)cur-&gt;name, &quot;keystrokes&quot;) == 0)
+{
+          xmlNode *bindings = NULL;
+          int num = 0;
+          int idx = 0;
+
+          for (bindings = cur-&gt;children; bindings; bindings = bindings-&gt;next)
+          {
+            if (bindings-&gt;type == XML_ELEMENT_NODE &amp;&amp; strcmp((char *)bindings-&gt;name, &quot;keystroke&quot;) == 0)
+            {
+              num++;
+            }
+          }
+          map = calloc((num + 1), sizeof(struct nxagentSpecialKeystrokeMap));
+          if (map == NULL)
+          {
+            fprintf(stderr, &quot;malloc failed&quot;);
+            exit(EXIT_FAILURE);
+          }
+
+          for (bindings = cur-&gt;children; bindings; bindings = bindings-&gt;next)
+          {
+            if (bindings-&gt;type == XML_ELEMENT_NODE &amp;&amp; strcmp((char *)bindings-&gt;name, &quot;keystroke&quot;) == 0)
+            {
+              int res = 0;
+              res = read_binding_from_xmlnode(bindings, &amp;(map[idx]));
+              if (res)
+                idx++;
+            }
+          }
+
+          map[idx].stroke = KEYSTROKE_END_MARKER;
+        }
+      }
+
+      xmlFreeDoc(doc);
+      xmlCleanupParser();
+    }
+    else
+    {
+      #ifdef DEBUG
+      fprintf(&quot;XML parsing for %s failed\n&quot;, filename);
+      #endif
+    }
+    free(filename);
+  }
+}
+
+static enum nxagentSpecialKeystroke find_keystroke(XKeyEvent *X)
+{
+  KeySym keysym = XKeycodeToKeysym(nxagentDisplay, X-&gt;keycode, 0);
+  struct nxagentSpecialKeystrokeMap *cur = map;
+
+  if (! nxagentKeystrokeFileParsed)
+  {
+    parse_keystroke_file();
+    nxagentKeystrokeFileParsed = True;
+  }
+
+  enum nxagentSpecialKeystroke ret = KEYSTROKE_NOTHING;
+
+  while ((cur++)-&gt;stroke != KEYSTROKE_END_MARKER) {
+    if (cur-&gt;keysym == keysym &amp;&amp; modifier_matches(cur-&gt;modifierMask, cur-&gt;modifierAltMeta, X-&gt;state)) {
+      return cur-&gt;stroke;
+    }
+  }
+
+  return ret;
+}
+
 int nxagentCheckSpecialKeystroke(XKeyEvent *X, enum HandleEventResult *result)
 {
   KeySym sym;
   int index = 0;
+  enum nxagentSpecialKeystroke stroke = find_keystroke(X);
 
   *result = doNothing;
 
@@ -87,257 +453,128 @@ int nxagentCheckSpecialKeystroke(XKeyEvent *X, enum HandleEventResult *result)
     return 1;
   }
 
-  if ((X -&gt; state &amp; nxagentAltMetaMask) &amp;&amp;
-          ((X -&gt; state &amp; (ControlMask | ShiftMask)) == ControlMask))
-  {
-    switch (sym)
-    {
+  switch (stroke) {
+    case KEYSTROKE_DEBUG_TREE:
       #ifdef DEBUG_TREE
-
-      case XK_q:
-      case XK_Q:
-      {
-        *result = doDebugTree;
-
-        break;
-      }
-
-      #endif /* DEBUG_TREE */
-
-      case XK_t:
-      case XK_T:
-      {
-        *result = doCloseSession;
-
-        break;
-      }
-      case XK_f:
-      case XK_F:
-      {
-        if (nxagentOption(Rootless) == False)
-        {
-          *result = doSwitchAllScreens;
-        }
-
-        break;
-      }
-      case XK_m:
-      case XK_M:
-      {
-        if (nxagentOption(Rootless) == False)
-        {
-          *result = doMinimize;
-        }
-
-        break;
-      }
-      case XK_Left:
-      case XK_KP_Left:
-      {
-        if (nxagentOption(Rootless) == False &amp;&amp;
-                nxagentOption(DesktopResize) == False)
-        {
-          *result = doViewportLeft;
-        }
-
-        break;
-      }
-      case XK_Up:
-      case XK_KP_Up:
-      {
-        if (nxagentOption(Rootless) == False &amp;&amp;
-                nxagentOption(DesktopResize) == False)
-        {
-          *result = doViewportUp;
-        }
-
-        break;
+      *result = doDebugTree;
+      #endif
+      break;
+    case KEYSTROKE_CLOSE_SESSION:
+      *result = doCloseSession;
+      break;
+    case KEYSTROKE_SWITCH_ALL_SCREENS:
+      if (nxagentOption(Rootless) == False) {
+        *result = doSwitchAllScreens;
       }
-      case XK_Right:
-      case XK_KP_Right:
-      {
-        if (nxagentOption(Rootless) == False &amp;&amp;
-                nxagentOption(DesktopResize) == False)
-        {
-          *result = doViewportRight;
-        }
-
-        break;
+      break;
+    case KEYSTROKE_MINIMIZE:
+      if (nxagentOption(Rootless) == False) {
+        *result = doMinimize;
       }
-      case XK_Down:
-      case XK_KP_Down:
-      {
-        if (nxagentOption(Rootless) == 0 &amp;&amp;
-                nxagentOption(DesktopResize) == 0)
-        {
-          *result = doViewportDown;
-        }
-
-        break;
+      break;
+    case KEYSTROKE_LEFT:
+      if (nxagentOption(Rootless) == False &amp;&amp;
+          nxagentOption(DesktopResize) == False) {
+        *result = doViewportLeft;
       }
-      case XK_R:
-      case XK_r:
-      {
-        if (nxagentOption(Rootless) == 0)
-        {
-          *result = doSwitchResizeMode;
-        }
-
-        break;
+      break;
+    case KEYSTROKE_UP:
+      if (nxagentOption(Rootless) == False &amp;&amp;
+          nxagentOption(DesktopResize) == False) {
+        *result = doViewportUp;
       }
-      case XK_E:
-      case XK_e:
-      {
-        *result = doSwitchDeferMode;
-
-        break;
+      break;
+    case KEYSTROKE_RIGHT:
+      if (nxagentOption(Rootless) == False &amp;&amp;
+          nxagentOption(DesktopResize) == False) {
+        *result = doViewportRight;
       }
-      case XK_BackSpace:
-      case XK_Terminate_Server:
-      {
-        /*
-         * Discard Ctrl-Alt-BackSpace key.
-         */
-
-        return 1;
-
-        break;
+      break;
+    case KEYSTROKE_DOWN:
+      if (nxagentOption(Rootless) == False &amp;&amp;
+          nxagentOption(DesktopResize) == False) {
+        *result = doViewportDown;
       }
-
-      case XK_J:
-      case XK_j:
-      {
-        nxagentForceSynchronization = 1;
-
-        return 1;
+      break;
+    case KEYSTROKE_RESIZE:
+      if (nxagentOption(Rootless) == False) {
+        *result = doSwitchResizeMode;
       }
-
+      break;
+    case KEYSTROKE_DEFER:
+      *result = doSwitchDeferMode;
+      break;
+    case KEYSTROKE_IGNORE:
+      /* this is used e.g. to ignore C-A-Backspace aka XK_Terminate_Server */
+      return 1;
+      break;
+    case KEYSTROKE_FORCE_SYNCHRONIZATION:
+      nxagentForceSynchronization = 1;
+      break;
+    case KEYSTROKE_REGIONS_ON_SCREEN:
       #ifdef DUMP
-
-      case XK_A:
-      case XK_a:
-      {
-        /*
-         * Used to test the lazy encoding.
-         */
-
-        nxagentRegionsOnScreen();
-
-        return 1;
-      }
-
+      nxagentRegionsOnScreen();
       #endif
-
+      break;
+    case KEYSTROKE_TEST_INPUT:
+      /*
+       * Used to test the input devices state.
+       */
       #ifdef NX_DEBUG_INPUT
-
-      case XK_X:
-      case XK_x:
-      {
-        /*
-         * Used to test the input devices state.
-         */
-
-        if (X -&gt; type == KeyPress)
-        {
-          if (nxagentDebugInputDevices == 0)
-          {
-            fprintf(stderr, &quot;Info: Turning input devices debug ON.\n&quot;);
-    
-            nxagentDebugInputDevices = 1;
-          }
-          else
-          {
-            fprintf(stderr, &quot;Info: Turning input devices debug OFF.\n&quot;);
-    
-            nxagentDebugInputDevices = 0;
-    
-            nxagentLastInputDevicesDumpTime = 0;
-          }
+      if (X -&gt; type == KeyPress) {
+        if (nxagentDebugInputDevices == 0) {
+          fprintf(stderr, &quot;Info: Turning input devices debug ON.\n&quot;);
+          nxagentDebugInputDevices = 1;
+        } else {
+          fprintf(stderr, &quot;Info: Turning input devices debug OFF.\n&quot;);
+          nxagentDebugInputDevices = 0;
+          nxagentLastInputDevicesDumpTime = 0;
         }
-
-        return 1;
       }
-
-      case XK_Y:
-      case XK_y:
-      {
-        /*
-         * Used to deactivate input devices grab.
-         */
-
-        if (X -&gt; type == KeyPress)
-        {
-          nxagentDeactivateInputDevicesGrabs();
-        }
-
-        return 1;
+      return 1;
+      #endif
+      break;
+    case KEYSTROKE_DEACTIVATE_INPUT_DEVICES_GRAB:
+      #ifdef NX_DEBUG_INPUT
+      if (X-&gt;type == KeyPress) {
+        nxagentDeactivateInputDevicesGrab();
       }
-
+      return 1;
       #endif
-    }
-  }
-  else if ((X -&gt; state &amp; nxagentAltMetaMask) &amp;&amp;
-               ((X -&gt; state &amp; (ControlMask | ShiftMask)) == (ControlMask |
-                   ShiftMask)))
-  {
-    switch (sym)
-    {
-      case XK_f:
-      case XK_F:
-      {
-        if (nxagentOption(Rootless) == 0)
-        {
-          *result = doSwitchFullscreen;
-        }
-
-        break;
+      break;
+    case KEYSTROKE_FULLSCREEN:
+      if (nxagentOption(Rootless) == 0) {
+        *result = doSwitchFullscreen;
       }
-      case XK_Left:
-      case XK_KP_Left:
-      {
-        if (nxagentOption(Rootless) == 0 &amp;&amp;
-                nxagentOption(DesktopResize) == 0)
-        {
-          *result = doViewportMoveLeft;
-        }
-
-        break;
+      break;
+    case KEYSTROKE_VIEWPORT_MOVE_LEFT:
+      if (nxagentOption(Rootless) == 0 &amp;&amp;
+          nxagentOption(DesktopResize) == 0) {
+        *result = doViewportMoveLeft;
       }
-      case XK_Up:
-      case XK_KP_Up:
-      {
-        if (nxagentOption(Rootless) == 0 &amp;&amp;
-                nxagentOption(DesktopResize) == 0)
-        {
-          *result = doViewportMoveUp;
-        }
-
-        break;
+      break;
+    case KEYSTROKE_VIEWPORT_MOVE_UP:
+      if (nxagentOption(Rootless) == 0 &amp;&amp;
+          nxagentOption(DesktopResize) == 0) {
+        *result = doViewportMoveUp;
       }
-      case XK_Right:
-      case XK_KP_Right:
-      {
-        if (nxagentOption(Rootless) == 0 &amp;&amp;
-                nxagentOption(DesktopResize) == 0)
-        {
-          *result = doViewportMoveRight;
-        }
-
-        break;
+      break;
+    case KEYSTROKE_VIEWPORT_MOVE_RIGHT:
+      if (nxagentOption(Rootless) == 0 &amp;&amp;
+          nxagentOption(DesktopResize) == 0) {
+        *result = doViewportMoveRight;
       }
-      case XK_Down:
-      case XK_KP_Down:
-      {
-        if (nxagentOption(Rootless) == 0 &amp;&amp;
-                nxagentOption(DesktopResize) == 0)
-        {
-          *result = doViewportMoveDown;
-        }
-
-        break;
+      break;
+    case KEYSTROKE_VIEWPORT_MOVE_DOWN:
+      if (nxagentOption(Rootless) == 0 &amp;&amp;
+          nxagentOption(DesktopResize) == 0) {
+        *result = doViewportMoveDown;
       }
-    }
+      break;
+    case KEYSTROKE_NOTHING: /* do nothing. difference to KEYSTROKE_IGNORE is the return value */
+    case KEYSTROKE_END_MARKER: /* just to make gcc STFU */
+    case KEYSTROKE_MAX:
+      break;
   }
-
   return (*result == doNothing) ? 0 : 1;
 }
diff --git a/nx-X11/programs/Xserver/hw/nxagent/Keystroke.h b/nx-X11/programs/Xserver/hw/nxagent/Keystroke.h
index ef71a88..d9575c8 100644
--- a/nx-X11/programs/Xserver/hw/nxagent/Keystroke.h
+++ b/nx-X11/programs/Xserver/hw/nxagent/Keystroke.h
@@ -24,4 +24,51 @@ extern int nxagentCheckSpecialKeystroke(XKeyEvent*, enum HandleEventResult*);
 
 unsigned int nxagentAltMetaMask;
 
+/* keep this sorted, do not rely on any numerical value in this enum, and be aware
+ * that KEYSTROKE_MAX may be used in a malloc */
+
+/* also be aware that if changing any numerical values, you also need to change values
+ * Keystroke.c nxagentSpecialKeystrokeNames */
+enum nxagentSpecialKeystroke {
+       /* 0 is used as end marker */
+       KEYSTROKE_END_MARKER = 0,
+       KEYSTROKE_CLOSE_SESSION = 1,
+       KEYSTROKE_SWITCH_ALL_SCREENS = 2,
+       KEYSTROKE_MINIMIZE = 3,
+       KEYSTROKE_LEFT = 4,
+       KEYSTROKE_UP = 5,
+       KEYSTROKE_RIGHT = 6,
+       KEYSTROKE_DOWN = 7,
+       KEYSTROKE_RESIZE = 8,
+       KEYSTROKE_DEFER = 9,
+       KEYSTROKE_IGNORE = 10,
+       KEYSTROKE_FORCE_SYNCHRONIZATION = 11,
+
+       /* stuff used for debugging, probably not useful for most people */
+       KEYSTROKE_DEBUG_TREE = 12,
+       KEYSTROKE_REGIONS_ON_SCREEN = 13,
+       KEYSTROKE_TEST_INPUT = 14,
+       KEYSTROKE_DEACTIVATE_INPUT_DEVICES_GRAB = 15,
+
+       KEYSTROKE_FULLSCREEN = 16,
+       KEYSTROKE_VIEWPORT_MOVE_LEFT = 17,
+       KEYSTROKE_VIEWPORT_MOVE_UP = 18,
+       KEYSTROKE_VIEWPORT_MOVE_RIGHT = 19,
+       KEYSTROKE_VIEWPORT_MOVE_DOWN = 20,
+
+       KEYSTROKE_NOTHING = 21,
+
+       /* insert more here, increment KEYSTROKE_MAX accordingly.
+        * then update string translation below */
+
+       KEYSTROKE_MAX=22,
+};
+
+struct nxagentSpecialKeystrokeMap {
+       enum nxagentSpecialKeystroke stroke;
+       unsigned int modifierMask; /* everything except alt/meta */
+       int modifierAltMeta; /* modifier combination should include alt/meta */
+       KeySym keysym;
+};
+
 #endif /* __Keystroke_H__ */
diff --git a/nx-X11/programs/Xserver/hw/nxagent/NXdispatch.c b/nx-X11/programs/Xserver/hw/nxagent/NXdispatch.c
index 4f59b80..77e2bf4 100644
--- a/nx-X11/programs/Xserver/hw/nxagent/NXdispatch.c
+++ b/nx-X11/programs/Xserver/hw/nxagent/NXdispatch.c
@@ -1973,6 +1973,23 @@ ProcCreatePixmap(client)
 	client-&gt;errorValue = 0;
         return BadValue;
     }
+    if (stuff-&gt;width &gt; 32767 || stuff-&gt;height &gt; 32767)
+    {
+	/* It is allowed to try and allocate a pixmap which is larger than
+	 * 32767 in either dimension. However, all of the framebuffer code
+	 * is buggy and does not reliably draw to such big pixmaps, basically
+	 * because the Region data structure operates with signed shorts
+	 * for the rectangles in it.
+	 *
+	 * Furthermore, several places in the X server computes the
+	 * size in bytes of the pixmap and tries to store it in an
+	 * integer. This integer can overflow and cause the allocated size
+	 * to be much smaller.
+	 *
+	 * So, such big pixmaps are rejected here with a BadAlloc
+	 */
+	return BadAlloc;
+    }
     if (stuff-&gt;depth != 1)
     {
         pDepth = pDraw-&gt;pScreen-&gt;allowedDepths;
diff --git a/nx-X11/programs/Xserver/hw/nxagent/Options.c b/nx-X11/programs/Xserver/hw/nxagent/Options.c
index ca5be0b..7eac3d8 100644
--- a/nx-X11/programs/Xserver/hw/nxagent/Options.c
+++ b/nx-X11/programs/Xserver/hw/nxagent/Options.c
@@ -56,6 +56,7 @@ void nxagentInitOptions()
   nxagentOptions.Persistent = 1;
   nxagentOptions.Rootless   = UNDEFINED;
   nxagentOptions.Fullscreen = UNDEFINED;
+  nxagentOptions.NoRootlessExit = False;
 
   nxagentOptions.X           = 0;
   nxagentOptions.Y           = 0;
diff --git a/nx-X11/programs/Xserver/hw/nxagent/Options.h b/nx-X11/programs/Xserver/hw/nxagent/Options.h
index 40cb179..0e48699 100644
--- a/nx-X11/programs/Xserver/hw/nxagent/Options.h
+++ b/nx-X11/programs/Xserver/hw/nxagent/Options.h
@@ -381,6 +381,13 @@ typedef struct _AgentOptions
 
   int ImageRateLimit;
 
+ /*
+  * True if agent should not exit if there are no
+  * clients in rootless mode
+  */
+
+  int NoRootlessExit;
+
 } AgentOptionsRec;
 
 typedef AgentOptionsRec *AgentOptionsPtr;
diff --git a/nx-X11/programs/Xserver/hw/nxagent/Render.c b/nx-X11/programs/Xserver/hw/nxagent/Render.c
index 29bffaa..41a1ec0 100644
--- a/nx-X11/programs/Xserver/hw/nxagent/Render.c
+++ b/nx-X11/programs/Xserver/hw/nxagent/Render.c
@@ -2689,11 +2689,17 @@ void nxagentReconnectPicture(pointer p0, XID x1, void *p2)
     #endif
   }
 
-  if (!pForm)
-  {
-    *pBool = False;
-
-    return;
+  if (!pForm &amp;&amp; pPicture-&gt;pSourcePict)
+  {
+        /*possible we need to add support for other picture types, for example gradients...*/
+        switch(pPicture-&gt;pSourcePict-&gt;type)
+        {
+        case SourcePictTypeSolidFill:
+            nxagentPicturePriv(pPicture) -&gt; picture = XRenderCreateSolidFill(nxagentDisplay,
+                    (const XRenderColor*) &amp;pPicture-&gt;pSourcePict-&gt;solidFill.fullColor);
+            break;
+        }
+        return;
   }
 
   #ifdef TEST
diff --git a/nx-X11/programs/Xserver/hw/nxagent/Screen.c b/nx-X11/programs/Xserver/hw/nxagent/Screen.c
index 9957a7d..104d431 100644
--- a/nx-X11/programs/Xserver/hw/nxagent/Screen.c
+++ b/nx-X11/programs/Xserver/hw/nxagent/Screen.c
@@ -1759,6 +1759,42 @@ N/A
                   nxagentDefaultWindows[pScreen-&gt;myNum]);
       #endif
 
+      /*
+       * Setting WM_CLASS to &quot;X2GoAgent&quot; when running in X2Go Agent mode
+       * we need it to properly display all window parameters by some WMs
+       * (for example on Maemo)
+       */
+      if(nxagentX2go)
+      {
+        #ifdef TEST
+        fprintf(stderr, &quot;nxagentOpenScreen: Setting WM_CLASS and WM_NAME for window withid [%ld].\n&quot;,
+                nxagentDefaultWindows[pScreen-&gt;myNum]);
+        #endif
+        XClassHint hint;
+        hint.res_name=malloc(strlen(&quot;X2GoAgent&quot;)+1);
+        hint.res_class=malloc(strlen(&quot;X2GoAgent&quot;)+1);
+        strcpy(hint.res_name,&quot;X2GoAgent&quot;);
+        strcpy(hint.res_class,&quot;X2GoAgent&quot;);
+        XSetClassHint(nxagentDisplay,nxagentDefaultWindows[pScreen-&gt;myNum],&amp;hint);
+        free(hint.res_name);
+        free(hint.res_class);
+      } else {
+        #ifdef TEST
+        fprintf(stderr, &quot;nxagentOpenScreen: Setting WM_CLASS and WM_NAME for window withid [%ld].\n&quot;,
+                nxagentDefaultWindows[pScreen-&gt;myNum]);      
+        #endif
+      
+        XClassHint hint;
+        hint.res_name=malloc(strlen(&quot;NXAgent&quot;)+1);
+        hint.res_class=malloc(strlen(&quot;NXAgent&quot;)+1);
+        strcpy(hint.res_name,&quot;NXAgent&quot;);
+        strcpy(hint.res_class,&quot;NXAgent&quot;);
+        XSetClassHint(nxagentDisplay,nxagentDefaultWindows[pScreen-&gt;myNum],&amp;hint);
+        free(hint.res_name);
+        free(hint.res_class);
+      }
+
+
       if (nxagentOption(Fullscreen))
       {
         nxagentFullscreenWindow = nxagentDefaultWindows[pScreen-&gt;myNum];
diff --git a/nx-X11/programs/Xserver/hw/nxagent/Splash.c b/nx-X11/programs/Xserver/hw/nxagent/Splash.c
index 235c48c..abb0872 100644
--- a/nx-X11/programs/Xserver/hw/nxagent/Splash.c
+++ b/nx-X11/programs/Xserver/hw/nxagent/Splash.c
@@ -35,6 +35,7 @@
 #include &quot;Windows.h&quot;
 #include &quot;Atoms.h&quot;
 #include &quot;Trap.h&quot;
+#include &quot;Init.h&quot;
 
 /*
  * Set here the required log level.
@@ -53,6 +54,7 @@ int nxagentLogoDepth;
 int nxagentLogoWhite;
 int nxagentLogoRed;
 int nxagentLogoBlack;
+int nxagentLogoGray;
 
 void nxagentPaintLogo(Window win, GC gc, int scale, int width, int height);
 
@@ -166,6 +168,15 @@ void nxagentPaintLogo(Window win, GC gc, int scale, int width, int height)
   XPoint    m[12];
   int w, h, c, w2, h2;
 
+  /*
+   * Show only X2GO Logo when running as X2Go Agent
+   */
+   if(! nxagentX2go)
+   {
+     nxagentPixmapLogo = 0L;
+     return;
+   }
+
   #ifdef DEBUG
   fprintf(stderr, &quot;nxagenShowtLogo: Got called.\n&quot;);
   #endif
@@ -218,75 +229,146 @@ void nxagentPaintLogo(Window win, GC gc, int scale, int width, int height)
   XSetForeground(nxagentDisplay, gc, nxagentLogoRed);
   XSetBackground(nxagentDisplay, gc, nxagentLogoWhite);
 
-  rect[0].x = w2-10*c;               rect[0].y = h2-8*c;
-  rect[1].x = w2-10*c;               rect[1].y = h2+8*c;
-  rect[2].x = w2+10*c;               rect[2].y = h2+8*c;
-  rect[3].x = w2+10*c;               rect[3].y = h2-8*c;
+  /*
+   * Draw X2GO Logo
+   */
 
+  /*
+   * Begin 'X'.
+   */
+
+  XSetForeground(nxagentDisplay, gc, nxagentLogoGray);
+  XSetBackground(nxagentDisplay, gc, nxagentLogoWhite);
+  rect[0].x = w2-7*c;               rect[0].y = h2-5*c;
+  rect[1].x = w2-8*c;               rect[1].y = h2-5*c;
+  rect[2].x = w2-4*c;               rect[2].y = h2+3*c;
+  rect[3].x = w2-3*c;               rect[3].y = h2+3*c;
   XFillPolygon(nxagentDisplay, nxagentPixmapLogo, gc, rect, 4, Convex, CoordModeOrigin);
 
-  #ifdef NXAGENT_LOGO_DEBUG
-  fprintf(stderr, &quot;filled red rect\n&quot;);
-  #endif
+  rect[0].x = w2-4*c;               rect[0].y = h2-5*c;
+  rect[1].x = w2-3*c;               rect[1].y = h2-5*c;
+  rect[2].x = w2-7*c;               rect[2].y = h2+3*c;
+  rect[3].x = w2-8*c;               rect[3].y = h2+3*c;
+  XFillPolygon(nxagentDisplay, nxagentPixmapLogo, gc, rect, 4, Convex, CoordModeOrigin);
 
-  rect[0].x = w2-9*c;               rect[0].y = h2-7*c;
-  rect[1].x = w2-9*c;               rect[1].y = h2+7*c;
-  rect[2].x = w2+9*c;               rect[2].y = h2+7*c;
-  rect[3].x = w2+9*c;               rect[3].y = h2-7*c;
+  /*
+   * End 'X'.
+   */
 
-  XSetForeground(nxagentDisplay, gc, nxagentLogoWhite);
-  XSetBackground(nxagentDisplay, gc, nxagentLogoRed);
+  /*
+   * Start '2'.
+   */
+
+  rect[0].x = w2-2*c;               rect[0].y = h2-5*c;
+  rect[1].x = w2-1*c;               rect[1].y = h2-5*c;
+  rect[2].x = w2-1*c;               rect[2].y = h2-3*c;
+  rect[3].x = w2-2*c;               rect[3].y = h2-3*c;
+  XFillPolygon(nxagentDisplay, nxagentPixmapLogo, gc, rect, 4, Convex, CoordModeOrigin);
+
+  rect[0].x = w2-2*c;               rect[0].y = h2-5*c;
+  rect[1].x = w2+2*c;               rect[1].y = h2-5*c;
+  rect[2].x = w2+2*c;               rect[2].y = h2-4*c;
+  rect[3].x = w2-2*c;               rect[3].y = h2-4*c;
+  XFillPolygon(nxagentDisplay, nxagentPixmapLogo, gc, rect, 4, Convex, CoordModeOrigin);
 
+  rect[0].x = w2+1*c;               rect[0].y = h2-5*c;
+  rect[1].x = w2+2*c;               rect[1].y = h2-5*c;
+  rect[2].x = w2+2*c;               rect[2].y = h2-2*c;
+  rect[3].x = w2+1*c;               rect[3].y = h2-2*c;
   XFillPolygon(nxagentDisplay, nxagentPixmapLogo, gc, rect, 4, Convex, CoordModeOrigin);
 
+  rect[0].x = w2+2*c;               rect[0].y = h2-2*c;
+  rect[1].x = w2+1*c;               rect[1].y = h2-2*c;
+  rect[2].x = w2-2*c;               rect[2].y = h2+2*c;
+  rect[3].x = w2-1*c;               rect[3].y = h2+2*c;
+  XFillPolygon(nxagentDisplay, nxagentPixmapLogo, gc, rect, 4, Convex, CoordModeOrigin);
+
+
+  rect[0].x = w2-2*c;               rect[0].y = h2+2*c;
+  rect[1].x = w2+2*c;               rect[1].y = h2+2*c;
+  rect[2].x = w2+2*c;               rect[2].y = h2+3*c;
+  rect[3].x = w2-2*c;               rect[3].y = h2+3*c;
+  XFillPolygon(nxagentDisplay, nxagentPixmapLogo, gc, rect, 4, Convex, CoordModeOrigin);
   /*
-   * Begin 'M'.
+   * End '2'.
    */
 
-  m[0].x = w2-3*c;  m[0].y = h2-5*c;
-  m[1].x = w2+7*c;  m[1].y = h2-5*c;
-  m[2].x = w2+7*c;  m[2].y = h2+5*c;
-  m[3].x = w2+5*c;  m[3].y = h2+5*c;
-  m[4].x = w2+5*c;  m[4].y = h2-3*c;
-  m[5].x = w2+3*c;  m[5].y = h2-3*c;
-  m[6].x = w2+3*c;  m[6].y = h2+5*c;
-  m[7].x = w2+1*c;  m[7].y = h2+5*c;
-  m[8].x = w2+1*c;  m[8].y = h2-3*c;
-  m[9].x = w2-1*c;  m[9].y = h2-3*c;
-  m[10].x = w2-1*c; m[10].y = h2+5*c;
-  m[11].x = w2-3*c; m[11].y = h2+5*c;
+  /*
+   * Start 'G'.
+   */
 
-  XSetForeground(nxagentDisplay, gc, nxagentLogoRed);
-  XSetBackground(nxagentDisplay, gc, nxagentLogoWhite);
+  rect[0].x = w2+3*c;               rect[0].y = h2-5*c;
+  rect[1].x = w2+7*c;               rect[1].y = h2-5*c;
+  rect[2].x = w2+7*c;               rect[2].y = h2-4*c;
+  rect[3].x = w2+3*c;               rect[3].y = h2-4*c;
+  XFillPolygon(nxagentDisplay, nxagentPixmapLogo, gc, rect, 4, Convex, CoordModeOrigin);
 
-  XFillPolygon(nxagentDisplay, nxagentPixmapLogo, gc, m, 12, Nonconvex, CoordModeOrigin);
+  rect[0].x = w2+3*c;               rect[0].y = h2-5*c;
+  rect[1].x = w2+4*c;               rect[1].y = h2-5*c;
+  rect[2].x = w2+4*c;               rect[2].y = h2+3*c;
+  rect[3].x = w2+3*c;               rect[3].y = h2+3*c;
+  XFillPolygon(nxagentDisplay, nxagentPixmapLogo, gc, rect, 4, Convex, CoordModeOrigin);
 
+  rect[0].x = w2+3*c;               rect[0].y = h2+2*c;
+  rect[1].x = w2+7*c;               rect[1].y = h2+2*c;
+  rect[2].x = w2+7*c;               rect[2].y = h2+3*c;
+  rect[3].x = w2+3*c;               rect[3].y = h2+3*c;
+  XFillPolygon(nxagentDisplay, nxagentPixmapLogo, gc, rect, 4, Convex, CoordModeOrigin);
+
+  rect[0].x = w2+6*c;               rect[0].y = h2-5*c;
+  rect[1].x = w2+7*c;               rect[1].y = h2-5*c;
+  rect[2].x = w2+7*c;               rect[2].y = h2-3*c;
+  rect[3].x = w2+6*c;               rect[3].y = h2-3*c;
+  XFillPolygon(nxagentDisplay, nxagentPixmapLogo, gc, rect, 4, Convex, CoordModeOrigin);
+
+  rect[0].x = w2+6*c;               rect[0].y = h2-0*c;
+  rect[1].x = w2+7*c;               rect[1].y = h2-0*c;
+  rect[2].x = w2+7*c;               rect[2].y = h2+3*c;
+  rect[3].x = w2+6*c;               rect[3].y = h2+3*c;
+  XFillPolygon(nxagentDisplay, nxagentPixmapLogo, gc, rect, 4, Convex, CoordModeOrigin);
+
+  rect[0].x = w2+5*c;               rect[0].y = h2-1*c;
+  rect[1].x = w2+7*c;               rect[1].y = h2-1*c;
+  rect[2].x = w2+7*c;               rect[2].y = h2+0*c;
+  rect[3].x = w2+5*c;               rect[3].y = h2+0*c;
+  XFillPolygon(nxagentDisplay, nxagentPixmapLogo, gc, rect, 4, Convex, CoordModeOrigin);
   /*
-   * End 'M'.
+   * End 'G'.
    */
 
   /*
-   * Begin '!'.
+   * Start 'O'.
    */
 
-  rect[0].x = w2-7*c;               rect[0].y = h2-5*c;
-  rect[1].x = w2-5*c;               rect[1].y = h2-5*c;
-  rect[2].x = w2-5*c;               rect[2].y = h2+2*c;
-  rect[3].x = w2-7*c;               rect[3].y = h2+2*c;
+  rect[0].x = w2+8*c;               rect[0].y = h2-5*c;
+  rect[1].x = w2+12*c;              rect[1].y = h2-5*c;
+  rect[2].x = w2+12*c;              rect[2].y = h2-4*c;
+  rect[3].x = w2+8*c;               rect[3].y = h2-4*c;
+  XFillPolygon(nxagentDisplay, nxagentPixmapLogo, gc, rect, 4, Convex, CoordModeOrigin);
 
+  rect[0].x = w2+8*c;               rect[0].y = h2+3*c;
+  rect[1].x = w2+12*c;              rect[1].y = h2+3*c;
+  rect[2].x = w2+12*c;              rect[2].y = h2+2*c;
+  rect[3].x = w2+8*c;               rect[3].y = h2+2*c;
   XFillPolygon(nxagentDisplay, nxagentPixmapLogo, gc, rect, 4, Convex, CoordModeOrigin);
 
-  rect[0].x = w2-7*c;               rect[0].y = h2+3*c;
-  rect[1].x = w2-5*c;               rect[1].y = h2+3*c;
-  rect[2].x = w2-5*c;               rect[2].y = h2+5*c;
-  rect[3].x = w2-7*c;               rect[3].y = h2+5*c;
+  rect[0].x = w2+8*c;               rect[0].y = h2-5*c;
+  rect[1].x = w2+9*c;               rect[1].y = h2-5*c;
+  rect[2].x = w2+9*c;               rect[2].y = h2+3*c;
+  rect[3].x = w2+8*c;               rect[3].y = h2+3*c;
+  XFillPolygon(nxagentDisplay, nxagentPixmapLogo, gc, rect, 4, Convex, CoordModeOrigin);
 
+  rect[0].x = w2+11*c;               rect[0].y = h2-5*c;
+  rect[1].x = w2+12*c;               rect[1].y = h2-5*c;
+  rect[2].x = w2+12*c;               rect[2].y = h2+3*c;
+  rect[3].x = w2+11*c;               rect[3].y = h2+3*c;
   XFillPolygon(nxagentDisplay, nxagentPixmapLogo, gc, rect, 4, Convex, CoordModeOrigin);
 
   /*
-   * End 'M'.
+   * End 'O'.
    */
 
+
   XSetWindowBackgroundPixmap(nxagentDisplay, win, nxagentPixmapLogo);
 
   #ifdef NXAGENT_LOGO_DEBUG
diff --git a/nx-X11/programs/Xserver/hw/nxagent/Splash.h b/nx-X11/programs/Xserver/hw/nxagent/Splash.h
index f7ba6c2..39becaa 100644
--- a/nx-X11/programs/Xserver/hw/nxagent/Splash.h
+++ b/nx-X11/programs/Xserver/hw/nxagent/Splash.h
@@ -33,6 +33,7 @@ extern int nxagentLogoDepth;
 extern int nxagentLogoWhite;
 extern int nxagentLogoRed;
 extern int nxagentLogoBlack;
+extern int nxagentLogoGray;
 
 extern Window nxagentSplashWindow;
 
diff --git a/nx-X11/programs/Xserver/hw/nxagent/Window.c b/nx-X11/programs/Xserver/hw/nxagent/Window.c
index 35a3598..0a8e8c2 100644
--- a/nx-X11/programs/Xserver/hw/nxagent/Window.c
+++ b/nx-X11/programs/Xserver/hw/nxagent/Window.c
@@ -176,6 +176,14 @@ static void nxagentReconfigureWindow(pointer, XID, pointer);
 
 static int nxagentForceExposure(WindowPtr pWin, pointer ptr);
 
+/* by dimbor */
+typedef struct
+{
+  CARD32 state;
+  Window icon;
+}
+nxagentWMStateRec;
+    
 /*
  * This is currently unused.
  */
@@ -1858,6 +1866,17 @@ Bool nxagentRealizeWindow(WindowPtr pWin)
   nxagentAddConfiguredWindow(pWin, CWStackingOrder);
   nxagentAddConfiguredWindow(pWin, CW_Shape);
 
+  /* add by dimbor */
+  if (nxagentOption(Rootless) &amp;&amp; nxagentWindowTopLevel(pWin))
+  {
+    Atom prop = MakeAtom(&quot;WM_STATE&quot;, strlen(&quot;WM_STATE&quot;), True);
+    nxagentWMStateRec wmState;
+    wmState.state = 1; /* NormalState */
+    wmState.icon = None;
+    if (ChangeWindowProperty(pWin, prop, prop, 32, 0, 2, &amp;wmState, 1) != Success)
+      fprintf(stderr, &quot;nxagentRealizeWindow: Additing WM_STATE fail.\n&quot;);
+  }
+
   #ifdef SHAPE
 
   /*
@@ -1904,6 +1923,17 @@ Bool nxagentUnrealizeWindow(pWin)
     return True;
   }
 
+  /* add by dimbor */
+  if (nxagentOption(Rootless) &amp;&amp; nxagentWindowTopLevel(pWin))
+  {
+    Atom prop = MakeAtom(&quot;WM_STATE&quot;, strlen(&quot;WM_STATE&quot;), True);
+    nxagentWMStateRec wmState;
+    wmState.state = 3; /* WithdrawnState */
+    wmState.icon = None;
+    if (ChangeWindowProperty(pWin, prop, prop, 32, 0, 2, &amp;wmState, 1) != Success)
+      fprintf(stderr, &quot;nxagentUnRealizeWindow: Changing WM_STATE failed.\n&quot;);
+  }
+
   XUnmapWindow(nxagentDisplay, nxagentWindow(pWin));
 
   return True;
diff --git a/nx-X11/programs/Xserver/hw/nxagent/X/NXpicture.c b/nx-X11/programs/Xserver/hw/nxagent/X/NXpicture.c
index d9054b4..4b342eb 100644
--- a/nx-X11/programs/Xserver/hw/nxagent/X/NXpicture.c
+++ b/nx-X11/programs/Xserver/hw/nxagent/X/NXpicture.c
@@ -1137,6 +1137,10 @@ CreateSolidPicture (Picture pid, xRenderColor *color, int *error)
     }
     pPicture-&gt;pSourcePict-&gt;type = SourcePictTypeSolidFill;
     pPicture-&gt;pSourcePict-&gt;solidFill.color = xRenderColorToCard32(*color);
+    pPicture-&gt;pSourcePict-&gt;solidFill.fullColor.alpha=color-&gt;alpha;
+    pPicture-&gt;pSourcePict-&gt;solidFill.fullColor.red=color-&gt;red;
+    pPicture-&gt;pSourcePict-&gt;solidFill.fullColor.green=color-&gt;green;
+    pPicture-&gt;pSourcePict-&gt;solidFill.fullColor.blue=color-&gt;blue;
     return pPicture;
 }
 
diff --git a/nx-X11/programs/Xserver/hw/nxagent/X/NXpicturestr.h b/nx-X11/programs/Xserver/hw/nxagent/X/NXpicturestr.h
index 0d1a8e1..b267925 100644
--- a/nx-X11/programs/Xserver/hw/nxagent/X/NXpicturestr.h
+++ b/nx-X11/programs/Xserver/hw/nxagent/X/NXpicturestr.h
@@ -95,6 +95,7 @@ typedef struct _PictTransform {
 typedef struct _PictSolidFill {
     unsigned int type;
     CARD32 color;
+    xRenderColor fullColor;
 } PictSolidFill, *PictSolidFillPtr;
 
 typedef struct _PictGradientStop {
diff --git a/nx-X11/programs/Xserver/hw/nxagent/X/NXxvdisp.c b/nx-X11/programs/Xserver/hw/nxagent/X/NXxvdisp.c
index f6dad31..cbb3f63 100644
--- a/nx-X11/programs/Xserver/hw/nxagent/X/NXxvdisp.c
+++ b/nx-X11/programs/Xserver/hw/nxagent/X/NXxvdisp.c
@@ -275,17 +275,19 @@ ProcXvDispatch(ClientPtr client)
     case xv_PutVideo:
 #ifdef PANORAMIX
         if(!noPanoramiXExtension)
-            result = (XineramaXvPutVideo(client)); break;
+            result = (XineramaXvPutVideo(client));
         else
 #endif
-            result = (ProcXvPutVideo(client)); break;
+            result = (ProcXvPutVideo(client));
+            break;
     case xv_PutStill:
 #ifdef PANORAMIX
         if(!noPanoramiXExtension)
-            result = (XineramaXvPutStill(client)); break
+            result = (XineramaXvPutStill(client));
         else
 #endif
-    	    result = (ProcXvPutStill(client)); break;
+    	    result = (ProcXvPutStill(client));
+    	    break;
     case xv_GetVideo: result = (ProcXvGetVideo(client)); break;
     case xv_GetStill: result = (ProcXvGetStill(client)); break;
     case xv_GrabPort: result = (ProcXvGrabPort(client)); break;
@@ -295,35 +297,39 @@ ProcXvDispatch(ClientPtr client)
     case xv_StopVideo: 
 #ifdef PANORAMIX
         if(!noPanoramiXExtension)
-	    result = (XineramaXvStopVideo(client)); break;
+	    result = (XineramaXvStopVideo(client));
 	else
 #endif
-	    result = (ProcXvStopVideo(client)); break;
+	    result = (ProcXvStopVideo(client));
+            break;
     case xv_SetPortAttribute: 
 #ifdef PANORAMIX
         if(!noPanoramiXExtension)
-	    result = (XineramaXvSetPortAttribute(client)); break;
+	    result = (XineramaXvSetPortAttribute(client));
 	else
 #endif
-	    result = (ProcXvSetPortAttribute(client)); break;
+	    result = (ProcXvSetPortAttribute(client));
+            break;
     case xv_GetPortAttribute: result = (ProcXvGetPortAttribute(client)); break;
     case xv_QueryBestSize: result = (ProcXvQueryBestSize(client)); break;
     case xv_QueryPortAttributes: result = (ProcXvQueryPortAttributes(client)); break;
     case xv_PutImage:
 #ifdef PANORAMIX
         if(!noPanoramiXExtension)
-	    result = (XineramaXvPutImage(client)); break;
+	    result = (XineramaXvPutImage(client));
 	else
 #endif
-	    result = (ProcXvPutImage(client)); break;
+	    result = (ProcXvPutImage(client));
+            break;
 #ifdef MITSHM
     case xv_ShmPutImage: 
 #ifdef PANORAMIX
         if(!noPanoramiXExtension)
-	    result = (XineramaXvShmPutImage(client)); break;
+	    result = (XineramaXvShmPutImage(client));
 	else
 #endif
-	    result = (ProcXvShmPutImage(client)); break;
+	    result = (ProcXvShmPutImage(client));
+	    break;
 #endif
     case xv_QueryImageAttributes: result = (ProcXvQueryImageAttributes(client)); break;
     case xv_ListImageFormats: result = (ProcXvListImageFormats(client)); break;
diff --git a/nx-X11/programs/Xserver/hw/xfree86/parser/Imakefile b/nx-X11/programs/Xserver/hw/xfree86/parser/Imakefile
index 29708b6..8513c51 100644
--- a/nx-X11/programs/Xserver/hw/xfree86/parser/Imakefile
+++ b/nx-X11/programs/Xserver/hw/xfree86/parser/Imakefile
@@ -7,7 +7,7 @@
 #define DoDebugLib      NO
 #define DoProfileLib    NO
 #define HasSharedData   NO
-#define LibName         xf86config
+#define LibName         NX_xf86config
 
 #define UseDBMalloc	NO
 
diff --git a/nx-X11/programs/Xserver/os/oscolor.c b/nx-X11/programs/Xserver/os/oscolor.c
index cf79857..ea99450 100644
--- a/nx-X11/programs/Xserver/os/oscolor.c
+++ b/nx-X11/programs/Xserver/os/oscolor.c
@@ -53,7 +53,7 @@ SOFTWARE.
 #include &lt;sys/stat.h&gt;
 #include &lt;unistd.h&gt;
 
-static char* nxAltRgbPaths[] = {&quot;/usr/NX/share/rgb&quot;, &quot;/usr/share/X11/rgb&quot;, &quot;/etc/X11/rgb&quot;};
+static char* nxAltRgbPaths[] = {&quot;/usr/share/nx/rgb&quot;, &quot;/usr/local/share/nx/rgb&quot;, &quot;/usr/NX/share/rgb&quot;, &quot;/usr/share/X11/rgb&quot;, &quot;/etc/X11/rgb&quot;};
 static char _NXRgbPath[1024];
 
 #endif
diff --git a/nx-X11/programs/nxauth/Imakefile b/nx-X11/programs/nxauth/Imakefile
index 07b1ca7..278904f 100644
--- a/nx-X11/programs/nxauth/Imakefile
+++ b/nx-X11/programs/nxauth/Imakefile
@@ -26,7 +26,7 @@ XCOMM $XFree86: xc/programs/xauth/Imakefile,v 3.5 2001/03/30 02:15:23 keithp Exp
 
   INCLUDES=-I../../lib
   DEPLIBS = $(DEPXAUTHLIB)
-  LOCAL_LIBRARIES = ../../exports/lib/libXau.a
+  LOCAL_LIBRARIES = $(XAUTHLIB)
            SRCS = xauth.c gethost.c process.c parsedpy.c
            OBJS = xauth.o gethost.o process.o parsedpy.o
    CONN_DEFINES = $(CONNECTION_FLAGS)
diff --git a/nx-X11/programs/nxauth/nxauth.man b/nx-X11/programs/nxauth/nxauth.man
index a414afa..b9df373 100644
--- a/nx-X11/programs/nxauth/nxauth.man
+++ b/nx-X11/programs/nxauth/nxauth.man
@@ -27,51 +27,51 @@
 .\&quot;
 .TH XAUTH 1 __xorgversion__
 .SH NAME
-xauth \- X authority file utility
+nxauth \- NoMachine X authority file utility
 .SH SYNOPSIS
-.B xauth
+.B nxauth
 [ \fB\-f\fP \fIauthfile\fP ] [ \fB\-vqib\fP ] [ \fIcommand arg ...\fP ]
 .SH DESCRIPTION
 .PP
-The \fIxauth\fP program is used to edit and display the authorization 
+The \fInxauth\fP program is used to edit and display the authorization 
 information used in connecting to the X server.  This program is usually
 used to extract authorization records from one machine and merge them in on 
 another (as is the case when using remote logins or granting access to
 other users).  Commands (described below) may be entered interactively,
-on the \fIxauth\fP command line, or in scripts.  Note that this program
+on the \fInxauth\fP command line, or in scripts.  Note that this program
 does \fBnot\fP contact the X server except when the generate command is used.
-Normally \fIxauth\fP is not used to create the authority file entry in
+Normally \fInxauth\fP is not used to create the authority file entry in
 the first place; \fIxdm\fP does that.
 .SH OPTIONS
-The following options may be used with \fIxauth\fP.  They may be given 
+The following options may be used with \fInxauth\fP.  They may be given 
 individually (e.g., \fI\-q \-i\|\fP) or may combined (e.g., \fI\-qi\|\fP).
 .TP 8
 .B &quot;\-f \fIauthfile\fP&quot;
 This option specifies the name of the authority file to use.  By default,
-\fIxauth\fP will use the file specified by the XAUTHORITY environment variable
+\fInxauth\fP will use the file specified by the nxauthORITY environment variable
 or \fI\.Xauthority\fP in the user's home directory.
 .TP 8
 .B \-q
-This option indicates that \fIxauth\fP should operate quietly and not print
-unsolicited status messages.  This is the default if an \fIxauth\fP command is
+This option indicates that \fInxauth\fP should operate quietly and not print
+unsolicited status messages.  This is the default if an \fInxauth\fP command is
 is given on the command line or if the standard output is not directed to a
 terminal.
 .TP 8
 .B \-v
-This option indicates that \fIxauth\fP should operate verbosely and print
+This option indicates that \fInxauth\fP should operate verbosely and print
 status messages indicating the results of various operations (e.g., how many
-records have been read in or written out).  This is the default if \fIxauth\fP
+records have been read in or written out).  This is the default if \fInxauth\fP
 is reading commands from its standard input and its standard output is
 directed to a terminal.
 .TP 8
 .B \-i
-This option indicates that \fIxauth\fP should ignore any authority file
-locks.  Normally, \fIxauth\fP will refuse to read or edit any authority files
+This option indicates that \fInxauth\fP should ignore any authority file
+locks.  Normally, \fInxauth\fP will refuse to read or edit any authority files
 that have been locked by other programs (usually \fIxdm\fP or another 
-\fIxauth\fP).
+\fInxauth\fP).
 .TP 8
 .B \-b
-This option indicates that \fIxauth\fP should attempt to break any authority
+This option indicates that \fInxauth\fP should attempt to break any authority
 file locks before proceeding.  Use this option only to clean up stale locks.
 .SH COMMANDS
 The following commands may be used to manipulate authority files:
@@ -157,14 +157,14 @@ Authorization entries matching the specified displays are removed from the
 authority file.
 .TP 8
 .B &quot;source \fIfilename&quot;
-The specified file is treated as a script containing \fIxauth\fP commands
+The specified file is treated as a script containing \fInxauth\fP commands
 to execute.  Blank lines and lines beginning with a sharp sign (#) are 
 ignored.  A single dash may be used to indicate the standard input, if it
 hasn't already been read.
 .TP 8
 .B &quot;info&quot;
 Information describing the authorization file, whether or not any changes
-have been made, and from where \fIxauth\fP commands are being read
+have been made, and from where \fInxauth\fP commands are being read
 is printed on the standard output. 
 .TP 8
 .B &quot;exit&quot;
@@ -194,12 +194,12 @@ referred to as \fIhostname\fP/unix:\fIdisplaynumber\fP so that
 local entries for different machines may be stored in one authority file.
 .SH EXAMPLE
 .PP
-The most common use for \fIxauth\fP is to extract the entry for the 
+The most common use for \fInxauth\fP is to extract the entry for the 
 current display, copy it to another machine, and merge it into the 
 user's authority file on the remote machine:
 .sp
 .nf
-        %  xauth extract \- $DISPLAY | rsh otherhost xauth merge \-
+        %  nxauth extract \- $DISPLAY | rsh otherhost nxauth merge \-
 .fi
 .PP
 .sp
@@ -207,10 +207,10 @@ The following command contacts the server :0 to create an
 authorization using the MIT-MAGIC-COOKIE-1 protocol.  Clients that
 connect with this authorization will be untrusted.
 .nf
-	%  xauth generate :0 .
+	%  nxauth generate :0 .
 .fi
 .SH ENVIRONMENT
-This \fIxauth\fP program uses the following environment variables:
+This \fInxauth\fP program uses the following environment variables:
 .TP 8
 .B XAUTHORITY
 to get the name of the authority file to use if the \fI\-f\fP option isn't
diff --git a/nx-X11/programs/xterm/config.guess b/nx-X11/programs/xterm/config.guess
index 6d71f75..c2246a4 100644
--- a/nx-X11/programs/xterm/config.guess
+++ b/nx-X11/programs/xterm/config.guess
@@ -1,9 +1,10 @@
 #! /bin/sh
 # Attempt to guess a canonical system name.
 #   Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999,
-#   2000, 2001, 2002, 2003, 2004, 2005 Free Software Foundation, Inc.
+#   2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010
+#   Free Software Foundation, Inc.
 
-timestamp='2005-05-27'
+timestamp='2009-12-30'
 
 # This file is free software; you can redistribute it and/or modify it
 # under the terms of the GNU General Public License as published by
@@ -26,16 +27,16 @@ timestamp='2005-05-27'
 # the same distribution terms that you use for the rest of that program.
 
 
-# Originally written by Per Bothner &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">per at bothner.com</A>&gt;.
-# Please send patches to &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">config-patches at gnu.org</A>&gt;.  Submit a context
-# diff and a properly formatted ChangeLog entry.
+# Originally written by Per Bothner.  Please send patches (context
+# diff format) to &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">config-patches at gnu.org</A>&gt; and include a ChangeLog
+# entry.
 #
 # This script attempts to guess a canonical system name similar to
 # config.sub.  If it succeeds, it prints the system name on stdout, and
 # exits with 0.  Otherwise, it exits with 1.
 #
-# The plan is that this can be called by configure scripts if you
-# don't specify an explicit build system type.
+# You can get the latest version of this script from:
+# <A HREF="http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.guess;hb=HEAD">http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.guess;hb=HEAD</A>
 
 me=`echo &quot;$0&quot; | sed -e 's,.*/,,'`
 
@@ -55,8 +56,9 @@ version=&quot;\
 GNU config.guess ($timestamp)
 
 Originally written by Per Bothner.
-Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005
-Free Software Foundation, Inc.
+Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000,
+2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010 Free
+Software Foundation, Inc.
 
 This is free software; see the source for copying conditions.  There is NO
 warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&quot;
@@ -106,7 +108,7 @@ set_cc_for_build='
 trap &quot;exitcode=\$?; (rm -f \$tmpfiles 2&gt;/dev/null; rmdir \$tmp 2&gt;/dev/null) &amp;&amp; exit \$exitcode&quot; 0 ;
 trap &quot;rm -f \$tmpfiles 2&gt;/dev/null; rmdir \$tmp 2&gt;/dev/null; exit 1&quot; 1 2 13 15 ;
 : ${TMPDIR=/tmp} ;
- { tmp=`(umask 077 &amp;&amp; mktemp -d -q &quot;$TMPDIR/cgXXXXXX&quot;) 2&gt;/dev/null` &amp;&amp; test -n &quot;$tmp&quot; &amp;&amp; test -d &quot;$tmp&quot; ; } ||
+ { tmp=`(umask 077 &amp;&amp; mktemp -d &quot;$TMPDIR/cgXXXXXX&quot;) 2&gt;/dev/null` &amp;&amp; test -n &quot;$tmp&quot; &amp;&amp; test -d &quot;$tmp&quot; ; } ||
  { test -n &quot;$RANDOM&quot; &amp;&amp; tmp=$TMPDIR/cg$$-$RANDOM &amp;&amp; (umask 077 &amp;&amp; mkdir $tmp) ; } ||
  { tmp=$TMPDIR/cg-$$ &amp;&amp; (umask 077 &amp;&amp; mkdir $tmp) &amp;&amp; echo &quot;Warning: creating insecure temp directory&quot; &gt;&amp;2 ; } ||
  { echo &quot;$me: cannot create a temporary directory in $TMPDIR&quot; &gt;&amp;2 ; exit 1 ; } ;
@@ -125,7 +127,7 @@ case $CC_FOR_BUILD,$HOST_CC,$CC in
 	;;
  ,,*)   CC_FOR_BUILD=$CC ;;
  ,*,*)  CC_FOR_BUILD=$HOST_CC ;;
-esac ;'
+esac ; set_cc_for_build= ;'
 
 # This is needed to find uname on a Pyramid OSx when run in the BSD universe.
 # (<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">ghazi at noc.rutgers.edu</A> 1994-08-24)
@@ -160,6 +162,7 @@ case &quot;${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}&quot; in
 	    arm*) machine=arm-unknown ;;
 	    sh3el) machine=shl-unknown ;;
 	    sh3eb) machine=sh-unknown ;;
+	    sh5el) machine=sh5le-unknown ;;
 	    *) machine=${UNAME_MACHINE_ARCH}-unknown ;;
 	esac
 	# The Operating System including object format, if it has switched
@@ -168,7 +171,7 @@ case &quot;${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}&quot; in
 	    arm*|i386|m68k|ns32k|sh3*|sparc|vax)
 		eval $set_cc_for_build
 		if echo __ELF__ | $CC_FOR_BUILD -E - 2&gt;/dev/null \
-			| grep __ELF__ &gt;/dev/null
+			| grep -q __ELF__
 		then
 		    # Once all utilities can be ECOFF (netbsdecoff) or a.out (netbsdaout).
 		    # Return netbsd for either.  FIX?
@@ -199,50 +202,18 @@ case &quot;${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}&quot; in
 	# CPU_TYPE-MANUFACTURER-OPERATING_SYSTEM is used.
 	echo &quot;${machine}-${os}${release}&quot;
 	exit ;;
-    amd64:OpenBSD:*:*)
-	echo x86_64-unknown-openbsd${UNAME_RELEASE}
-	exit ;;
-    amiga:OpenBSD:*:*)
-	echo m68k-unknown-openbsd${UNAME_RELEASE}
-	exit ;;
-    cats:OpenBSD:*:*)
-	echo arm-unknown-openbsd${UNAME_RELEASE}
-	exit ;;
-    hp300:OpenBSD:*:*)
-	echo m68k-unknown-openbsd${UNAME_RELEASE}
-	exit ;;
-    luna88k:OpenBSD:*:*)
-    	echo m88k-unknown-openbsd${UNAME_RELEASE}
-	exit ;;
-    mac68k:OpenBSD:*:*)
-	echo m68k-unknown-openbsd${UNAME_RELEASE}
-	exit ;;
-    macppc:OpenBSD:*:*)
-	echo powerpc-unknown-openbsd${UNAME_RELEASE}
-	exit ;;
-    mvme68k:OpenBSD:*:*)
-	echo m68k-unknown-openbsd${UNAME_RELEASE}
-	exit ;;
-    mvme88k:OpenBSD:*:*)
-	echo m88k-unknown-openbsd${UNAME_RELEASE}
-	exit ;;
-    mvmeppc:OpenBSD:*:*)
-	echo powerpc-unknown-openbsd${UNAME_RELEASE}
-	exit ;;
-    sgi:OpenBSD:*:*)
-	echo mips64-unknown-openbsd${UNAME_RELEASE}
-	exit ;;
-    sun3:OpenBSD:*:*)
-	echo m68k-unknown-openbsd${UNAME_RELEASE}
-	exit ;;
     *:OpenBSD:*:*)
-	echo ${UNAME_MACHINE}-unknown-openbsd${UNAME_RELEASE}
+	UNAME_MACHINE_ARCH=`arch | sed 's/OpenBSD.//'`
+	echo ${UNAME_MACHINE_ARCH}-unknown-openbsd${UNAME_RELEASE}
 	exit ;;
     *:ekkoBSD:*:*)
 	echo ${UNAME_MACHINE}-unknown-ekkobsd${UNAME_RELEASE}
 	exit ;;
+    *:SolidBSD:*:*)
+	echo ${UNAME_MACHINE}-unknown-solidbsd${UNAME_RELEASE}
+	exit ;;
     macppc:MirBSD:*:*)
-	echo powerppc-unknown-mirbsd${UNAME_RELEASE}
+	echo powerpc-unknown-mirbsd${UNAME_RELEASE}
 	exit ;;
     *:MirBSD:*:*)
 	echo ${UNAME_MACHINE}-unknown-mirbsd${UNAME_RELEASE}
@@ -354,14 +325,33 @@ case &quot;${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}&quot; in
 	case `/usr/bin/uname -p` in
 	    sparc) echo sparc-icl-nx7; exit ;;
 	esac ;;
+    s390x:SunOS:*:*)
+	echo ${UNAME_MACHINE}-ibm-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
+	exit ;;
     sun4H:SunOS:5.*:*)
 	echo sparc-hal-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
 	exit ;;
     sun4*:SunOS:5.*:* | tadpole*:SunOS:5.*:*)
 	echo sparc-sun-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
 	exit ;;
-    i86pc:SunOS:5.*:*)
-	echo i386-pc-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
+    i86pc:AuroraUX:5.*:* | i86xen:AuroraUX:5.*:*)
+	echo i386-pc-auroraux${UNAME_RELEASE}
+	exit ;;
+    i86pc:SunOS:5.*:* | i86xen:SunOS:5.*:*)
+	eval $set_cc_for_build
+	SUN_ARCH=&quot;i386&quot;
+	# If there is a compiler, see if it is configured for 64-bit objects.
+	# Note that the Sun cc does not turn __LP64__ into 1 like gcc does.
+	# This test works for both compilers.
+	if [ &quot;$CC_FOR_BUILD&quot; != 'no_compiler_found' ]; then
+	    if (echo '#ifdef __amd64'; echo IS_64BIT_ARCH; echo '#endif') | \
+		(CCOPTS= $CC_FOR_BUILD -E - 2&gt;/dev/null) | \
+		grep IS_64BIT_ARCH &gt;/dev/null
+	    then
+		SUN_ARCH=&quot;x86_64&quot;
+	    fi
+	fi
+	echo ${SUN_ARCH}-pc-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
 	exit ;;
     sun4*:SunOS:6*:*)
 	# According to config.sub, this is the proper way to canonicalize
@@ -562,7 +552,7 @@ EOF
 		echo rs6000-ibm-aix3.2
 	fi
 	exit ;;
-    *:AIX:*:[45])
+    *:AIX:*:[456])
 	IBM_CPU_ID=`/usr/sbin/lsdev -C -c processor -S available | sed 1q | awk '{ print $1 }'`
 	if /usr/sbin/lsattr -El ${IBM_CPU_ID} | grep ' POWER' &gt;/dev/null 2&gt;&amp;1; then
 		IBM_ARCH=rs6000
@@ -658,8 +648,7 @@ EOF
 	esac
 	if [ ${HP_ARCH} = &quot;hppa2.0w&quot; ]
 	then
-	    # avoid double evaluation of $set_cc_for_build
-	    test -n &quot;$CC_FOR_BUILD&quot; || eval $set_cc_for_build
+	    eval $set_cc_for_build
 
 	    # hppa2.0w-hp-hpux* has a 64-bit kernel and a compiler generating
 	    # 32-bit code.  hppa64-hp-hpux* has the same kernel and a compiler
@@ -671,7 +660,7 @@ EOF
 	    # =&gt; hppa64-hp-hpux11.23
 
 	    if echo __LP64__ | (CCOPTS= $CC_FOR_BUILD -E - 2&gt;/dev/null) |
-		grep __LP64__ &gt;/dev/null
+		grep -q __LP64__
 	    then
 		HP_ARCH=&quot;hppa2.0w&quot;
 	    else
@@ -800,12 +789,19 @@ EOF
 	echo ${UNAME_MACHINE}-unknown-bsdi${UNAME_RELEASE}
 	exit ;;
     *:FreeBSD:*:*)
-	echo ${UNAME_MACHINE}-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'`
+	case ${UNAME_MACHINE} in
+	    pc98)
+		echo i386-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'` ;;
+	    amd64)
+		echo x86_64-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'` ;;
+	    *)
+		echo ${UNAME_MACHINE}-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'` ;;
+	esac
 	exit ;;
     i*:CYGWIN*:*)
 	echo ${UNAME_MACHINE}-pc-cygwin
 	exit ;;
-    i*:MINGW*:*)
+    *:MINGW*:*)
 	echo ${UNAME_MACHINE}-pc-mingw32
 	exit ;;
     i*:windows32*:*)
@@ -815,12 +811,24 @@ EOF
     i*:PW*:*)
 	echo ${UNAME_MACHINE}-pc-pw32
 	exit ;;
-    x86:Interix*:[34]*)
-	echo i586-pc-interix${UNAME_RELEASE}|sed -e 's/\..*//'
-	exit ;;
+    *:Interix*:*)
+    	case ${UNAME_MACHINE} in
+	    x86)
+		echo i586-pc-interix${UNAME_RELEASE}
+		exit ;;
+	    authenticamd | genuineintel | EM64T)
+		echo x86_64-unknown-interix${UNAME_RELEASE}
+		exit ;;
+	    IA64)
+		echo ia64-unknown-interix${UNAME_RELEASE}
+		exit ;;
+	esac ;;
     [345]86:Windows_95:* | [345]86:Windows_98:* | [345]86:Windows_NT:*)
 	echo i${UNAME_MACHINE}-pc-mks
 	exit ;;
+    8664:Windows_NT:*)
+	echo x86_64-pc-mks
+	exit ;;
     i*:Windows_NT*:* | Pentium*:Windows_NT*:*)
 	# How do we know it's Interix rather than the generic POSIX subsystem?
 	# It also conflicts with pre-2.0 versions of AT&amp;T UWIN. Should we
@@ -830,7 +838,7 @@ EOF
     i*:UWIN*:*)
 	echo ${UNAME_MACHINE}-pc-uwin
 	exit ;;
-    amd64:CYGWIN*:*:*)
+    amd64:CYGWIN*:*:* | x86_64:CYGWIN*:*:*)
 	echo x86_64-unknown-cygwin
 	exit ;;
     p*:CYGWIN*:*)
@@ -850,7 +858,31 @@ EOF
     i*86:Minix:*:*)
 	echo ${UNAME_MACHINE}-pc-minix
 	exit ;;
+    alpha:Linux:*:*)
+	case `sed -n '/^cpu model/s/^.*: \(.*\)/\1/p' &lt; /proc/cpuinfo` in
+	  EV5)   UNAME_MACHINE=alphaev5 ;;
+	  EV56)  UNAME_MACHINE=alphaev56 ;;
+	  PCA56) UNAME_MACHINE=alphapca56 ;;
+	  PCA57) UNAME_MACHINE=alphapca56 ;;
+	  EV6)   UNAME_MACHINE=alphaev6 ;;
+	  EV67)  UNAME_MACHINE=alphaev67 ;;
+	  EV68*) UNAME_MACHINE=alphaev68 ;;
+        esac
+	objdump --private-headers /bin/sh | grep -q ld.so.1
+	if test &quot;$?&quot; = 0 ; then LIBC=&quot;libc1&quot; ; else LIBC=&quot;&quot; ; fi
+	echo ${UNAME_MACHINE}-unknown-linux-gnu${LIBC}
+	exit ;;
     arm*:Linux:*:*)
+	eval $set_cc_for_build
+	if echo __ARM_EABI__ | $CC_FOR_BUILD -E - 2&gt;/dev/null \
+	    | grep -q __ARM_EABI__
+	then
+	    echo ${UNAME_MACHINE}-unknown-linux-gnu
+	else
+	    echo ${UNAME_MACHINE}-unknown-linux-gnueabi
+	fi
+	exit ;;
+    avr32*:Linux:*:*)
 	echo ${UNAME_MACHINE}-unknown-linux-gnu
 	exit ;;
     cris:Linux:*:*)
@@ -862,6 +894,17 @@ EOF
     frv:Linux:*:*)
     	echo frv-unknown-linux-gnu
 	exit ;;
+    i*86:Linux:*:*)
+	LIBC=gnu
+	eval $set_cc_for_build
+	sed 's/^	//' &lt;&lt; EOF &gt;$dummy.c
+	#ifdef __dietlibc__
+	LIBC=dietlibc
+	#endif
+EOF
+	eval `$CC_FOR_BUILD -E $dummy.c 2&gt;/dev/null | grep '^LIBC'`
+	echo &quot;${UNAME_MACHINE}-pc-linux-${LIBC}&quot;
+	exit ;;
     ia64:Linux:*:*)
 	echo ${UNAME_MACHINE}-unknown-linux-gnu
 	exit ;;
@@ -871,63 +914,33 @@ EOF
     m68*:Linux:*:*)
 	echo ${UNAME_MACHINE}-unknown-linux-gnu
 	exit ;;
-    mips:Linux:*:*)
-	eval $set_cc_for_build
-	sed 's/^	//' &lt;&lt; EOF &gt;$dummy.c
-	#undef CPU
-	#undef mips
-	#undef mipsel
-	#if defined(__MIPSEL__) || defined(__MIPSEL) || defined(_MIPSEL) || defined(MIPSEL)
-	CPU=mipsel
-	#else
-	#if defined(__MIPSEB__) || defined(__MIPSEB) || defined(_MIPSEB) || defined(MIPSEB)
-	CPU=mips
-	#else
-	CPU=
-	#endif
-	#endif
-EOF
-	eval `$CC_FOR_BUILD -E $dummy.c 2&gt;/dev/null | grep ^CPU=`
-	test x&quot;${CPU}&quot; != x &amp;&amp; { echo &quot;${CPU}-unknown-linux-gnu&quot;; exit; }
-	;;
-    mips64:Linux:*:*)
+    mips:Linux:*:* | mips64:Linux:*:*)
 	eval $set_cc_for_build
 	sed 's/^	//' &lt;&lt; EOF &gt;$dummy.c
 	#undef CPU
-	#undef mips64
-	#undef mips64el
+	#undef ${UNAME_MACHINE}
+	#undef ${UNAME_MACHINE}el
 	#if defined(__MIPSEL__) || defined(__MIPSEL) || defined(_MIPSEL) || defined(MIPSEL)
-	CPU=mips64el
+	CPU=${UNAME_MACHINE}el
 	#else
 	#if defined(__MIPSEB__) || defined(__MIPSEB) || defined(_MIPSEB) || defined(MIPSEB)
-	CPU=mips64
+	CPU=${UNAME_MACHINE}
 	#else
 	CPU=
 	#endif
 	#endif
 EOF
-	eval `$CC_FOR_BUILD -E $dummy.c 2&gt;/dev/null | grep ^CPU=`
+	eval `$CC_FOR_BUILD -E $dummy.c 2&gt;/dev/null | grep '^CPU'`
 	test x&quot;${CPU}&quot; != x &amp;&amp; { echo &quot;${CPU}-unknown-linux-gnu&quot;; exit; }
 	;;
-    ppc:Linux:*:*)
-	echo powerpc-unknown-linux-gnu
+    or32:Linux:*:*)
+	echo or32-unknown-linux-gnu
 	exit ;;
-    ppc64:Linux:*:*)
-	echo powerpc64-unknown-linux-gnu
+    padre:Linux:*:*)
+	echo sparc-unknown-linux-gnu
 	exit ;;
-    alpha:Linux:*:*)
-	case `sed -n '/^cpu model/s/^.*: \(.*\)/\1/p' &lt; /proc/cpuinfo` in
-	  EV5)   UNAME_MACHINE=alphaev5 ;;
-	  EV56)  UNAME_MACHINE=alphaev56 ;;
-	  PCA56) UNAME_MACHINE=alphapca56 ;;
-	  PCA57) UNAME_MACHINE=alphapca56 ;;
-	  EV6)   UNAME_MACHINE=alphaev6 ;;
-	  EV67)  UNAME_MACHINE=alphaev67 ;;
-	  EV68*) UNAME_MACHINE=alphaev68 ;;
-        esac
-	objdump --private-headers /bin/sh | grep ld.so.1 &gt;/dev/null
-	if test &quot;$?&quot; = 0 ; then LIBC=&quot;libc1&quot; ; else LIBC=&quot;&quot; ; fi
-	echo ${UNAME_MACHINE}-unknown-linux-gnu${LIBC}
+    parisc64:Linux:*:* | hppa64:Linux:*:*)
+	echo hppa64-unknown-linux-gnu
 	exit ;;
     parisc:Linux:*:* | hppa:Linux:*:*)
 	# Look for CPU level
@@ -937,8 +950,11 @@ EOF
 	  *)    echo hppa-unknown-linux-gnu ;;
 	esac
 	exit ;;
-    parisc64:Linux:*:* | hppa64:Linux:*:*)
-	echo hppa64-unknown-linux-gnu
+    ppc64:Linux:*:*)
+	echo powerpc64-unknown-linux-gnu
+	exit ;;
+    ppc:Linux:*:*)
+	echo powerpc-unknown-linux-gnu
 	exit ;;
     s390:Linux:*:* | s390x:Linux:*:*)
 	echo ${UNAME_MACHINE}-ibm-linux
@@ -952,68 +968,15 @@ EOF
     sparc:Linux:*:* | sparc64:Linux:*:*)
 	echo ${UNAME_MACHINE}-unknown-linux-gnu
 	exit ;;
+    vax:Linux:*:*)
+	echo ${UNAME_MACHINE}-dec-linux-gnu
+	exit ;;
     x86_64:Linux:*:*)
 	echo x86_64-unknown-linux-gnu
 	exit ;;
-    i*86:Linux:*:*)
-	# The BFD linker knows what the default object file format is, so
-	# first see if it will tell us. cd to the root directory to prevent
-	# problems with other programs or directories called `ld' in the path.
-	# Set LC_ALL=C to ensure ld outputs messages in English.
-	ld_supported_targets=`cd /; LC_ALL=C ld --help 2&gt;&amp;1 \
-			 | sed -ne '/supported targets:/!d
-				    s/[ 	][ 	]*/ /g
-				    s/.*supported targets: *//
-				    s/ .*//
-				    p'`
-        case &quot;$ld_supported_targets&quot; in
-	  elf32-i386)
-		TENTATIVE=&quot;${UNAME_MACHINE}-pc-linux-gnu&quot;
-		;;
-	  a.out-i386-linux)
-		echo &quot;${UNAME_MACHINE}-pc-linux-gnuaout&quot;
-		exit ;;
-	  coff-i386)
-		echo &quot;${UNAME_MACHINE}-pc-linux-gnucoff&quot;
-		exit ;;
-	  &quot;&quot;)
-		# Either a pre-BFD a.out linker (linux-gnuoldld) or
-		# one that does not give us useful --help.
-		echo &quot;${UNAME_MACHINE}-pc-linux-gnuoldld&quot;
-		exit ;;
-	esac
-	# Determine whether the default compiler is a.out or elf
-	eval $set_cc_for_build
-	sed 's/^	//' &lt;&lt; EOF &gt;$dummy.c
-	#include &lt;features.h&gt;
-	#ifdef __ELF__
-	# ifdef __GLIBC__
-	#  if __GLIBC__ &gt;= 2
-	LIBC=gnu
-	#  else
-	LIBC=gnulibc1
-	#  endif
-	# else
-	LIBC=gnulibc1
-	# endif
-	#else
-	#ifdef __INTEL_COMPILER
-	LIBC=gnu
-	#else
-	LIBC=gnuaout
-	#endif
-	#endif
-	#ifdef __dietlibc__
-	LIBC=dietlibc
-	#endif
-EOF
-	eval `$CC_FOR_BUILD -E $dummy.c 2&gt;/dev/null | grep ^LIBC=`
-	test x&quot;${LIBC}&quot; != x &amp;&amp; {
-		echo &quot;${UNAME_MACHINE}-pc-linux-${LIBC}&quot;
-		exit
-	}
-	test x&quot;${TENTATIVE}&quot; != x &amp;&amp; { echo &quot;${TENTATIVE}&quot;; exit; }
-	;;
+    xtensa*:Linux:*:*)
+    	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	exit ;;
     i*86:DYNIX/ptx:4*:*)
 	# ptx 4.0 does uname -s correctly, with DYNIX/ptx in there.
 	# earlier versions are messed up and put the nodename in both
@@ -1042,7 +1005,7 @@ EOF
     i*86:syllable:*:*)
 	echo ${UNAME_MACHINE}-pc-syllable
 	exit ;;
-    i*86:LynxOS:2.*:* | i*86:LynxOS:3.[01]*:* | i*86:LynxOS:4.0*:*)
+    i*86:LynxOS:2.*:* | i*86:LynxOS:3.[01]*:* | i*86:LynxOS:4.[02]*:*)
 	echo i386-unknown-lynxos${UNAME_RELEASE}
 	exit ;;
     i*86:*DOS:*:*)
@@ -1086,8 +1049,11 @@ EOF
     pc:*:*:*)
 	# Left here for compatibility:
         # uname -m prints for DJGPP always 'pc', but it prints nothing about
-        # the processor, so we play safe by assuming i386.
-	echo i386-pc-msdosdjgpp
+        # the processor, so we play safe by assuming i586.
+	# Note: whatever this is, it MUST be the same as what config.sub
+	# prints for the &quot;djgpp&quot; host, or else GDB configury will decide that
+	# this is a cross-build.
+	echo i586-pc-msdosdjgpp
         exit ;;
     Intel:Mach:3*:*)
 	echo i386-pc-mach3
@@ -1125,6 +1091,16 @@ EOF
     3[34]??:*:4.0:* | 3[34]??,*:*:4.0:*)
         /bin/uname -p 2&gt;/dev/null | grep 86 &gt;/dev/null \
           &amp;&amp; { echo i486-ncr-sysv4; exit; } ;;
+    NCR*:*:4.2:* | MPRAS*:*:4.2:*)
+	OS_REL='.3'
+	test -r /etc/.relid \
+	    &amp;&amp; OS_REL=.`sed -n 's/[^ ]* [^ ]* \([0-9][0-9]\).*/\1/p' &lt; /etc/.relid`
+	/bin/uname -p 2&gt;/dev/null | grep 86 &gt;/dev/null \
+	    &amp;&amp; { echo i486-ncr-sysv4.3${OS_REL}; exit; }
+	/bin/uname -p 2&gt;/dev/null | /bin/grep entium &gt;/dev/null \
+	    &amp;&amp; { echo i586-ncr-sysv4.3${OS_REL}; exit; }
+	/bin/uname -p 2&gt;/dev/null | /bin/grep pteron &gt;/dev/null \
+	    &amp;&amp; { echo i586-ncr-sysv4.3${OS_REL}; exit; } ;;
     m68*:LynxOS:2.*:* | m68*:LynxOS:3.0*:*)
 	echo m68k-unknown-lynxos${UNAME_RELEASE}
 	exit ;;
@@ -1137,7 +1113,7 @@ EOF
     rs6000:LynxOS:2.*:*)
 	echo rs6000-unknown-lynxos${UNAME_RELEASE}
 	exit ;;
-    PowerPC:LynxOS:2.*:* | PowerPC:LynxOS:3.[01]*:* | PowerPC:LynxOS:4.0*:*)
+    PowerPC:LynxOS:2.*:* | PowerPC:LynxOS:3.[01]*:* | PowerPC:LynxOS:4.[02]*:*)
 	echo powerpc-unknown-lynxos${UNAME_RELEASE}
 	exit ;;
     SM[BE]S:UNIX_SV:*:*)
@@ -1200,6 +1176,9 @@ EOF
     BePC:BeOS:*:*)	# BeOS running on Intel PC compatible.
 	echo i586-pc-beos
 	exit ;;
+    BePC:Haiku:*:*)	# Haiku running on Intel PC compatible.
+	echo i586-pc-haiku
+	exit ;;
     SX-4:SUPER-UX:*:*)
 	echo sx4-nec-superux${UNAME_RELEASE}
 	exit ;;
@@ -1209,6 +1188,15 @@ EOF
     SX-6:SUPER-UX:*:*)
 	echo sx6-nec-superux${UNAME_RELEASE}
 	exit ;;
+    SX-7:SUPER-UX:*:*)
+	echo sx7-nec-superux${UNAME_RELEASE}
+	exit ;;
+    SX-8:SUPER-UX:*:*)
+	echo sx8-nec-superux${UNAME_RELEASE}
+	exit ;;
+    SX-8R:SUPER-UX:*:*)
+	echo sx8r-nec-superux${UNAME_RELEASE}
+	exit ;;
     Power*:Rhapsody:*:*)
 	echo powerpc-apple-rhapsody${UNAME_RELEASE}
 	exit ;;
@@ -1218,7 +1206,16 @@ EOF
     *:Darwin:*:*)
 	UNAME_PROCESSOR=`uname -p` || UNAME_PROCESSOR=unknown
 	case $UNAME_PROCESSOR in
-	    *86) UNAME_PROCESSOR=i686 ;;
+	    i386)
+		eval $set_cc_for_build
+		if [ &quot;$CC_FOR_BUILD&quot; != 'no_compiler_found' ]; then
+		  if (echo '#ifdef __LP64__'; echo IS_64BIT_ARCH; echo '#endif') | \
+		      (CCOPTS= $CC_FOR_BUILD -E - 2&gt;/dev/null) | \
+		      grep IS_64BIT_ARCH &gt;/dev/null
+		  then
+		      UNAME_PROCESSOR=&quot;x86_64&quot;
+		  fi
+		fi ;;
 	    unknown) UNAME_PROCESSOR=powerpc ;;
 	esac
 	echo ${UNAME_PROCESSOR}-apple-darwin${UNAME_RELEASE}
@@ -1297,6 +1294,12 @@ EOF
     i*86:skyos:*:*)
 	echo ${UNAME_MACHINE}-pc-skyos`echo ${UNAME_RELEASE}` | sed -e 's/ .*$//'
 	exit ;;
+    i*86:rdos:*:*)
+	echo ${UNAME_MACHINE}-pc-rdos
+	exit ;;
+    i*86:AROS:*:*)
+	echo ${UNAME_MACHINE}-pc-aros
+	exit ;;
 esac
 
 #echo '(No uname command or uname output not recognized.)' 1&gt;&amp;2
@@ -1457,9 +1460,9 @@ This script, last modified $timestamp, has failed to recognize
 the operating system you are using. It is advised that you
 download the most up to date version of the config scripts from
 
-  <A HREF="http://savannah.gnu.org/cgi-bin/viewcvs/*checkout*/config/config/config.guess">http://savannah.gnu.org/cgi-bin/viewcvs/*checkout*/config/config/config.guess</A>
+  <A HREF="http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.guess;hb=HEAD">http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.guess;hb=HEAD</A>
 and
-  <A HREF="http://savannah.gnu.org/cgi-bin/viewcvs/*checkout*/config/config/config.sub">http://savannah.gnu.org/cgi-bin/viewcvs/*checkout*/config/config/config.sub</A>
+  <A HREF="http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.sub;hb=HEAD">http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.sub;hb=HEAD</A>
 
 If the version you run ($0) is already up to date, please
 send the following data and any information you think might be
diff --git a/nx-X11/programs/xterm/config.sub b/nx-X11/programs/xterm/config.sub
index 8b2c57a..c2d1257 100644
--- a/nx-X11/programs/xterm/config.sub
+++ b/nx-X11/programs/xterm/config.sub
@@ -1,9 +1,10 @@
 #! /bin/sh
 # Configuration validation subroutine script.
 #   Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999,
-#   2000, 2001, 2002, 2003, 2004, 2005 Free Software Foundation, Inc.
+#   2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010
+#   Free Software Foundation, Inc.
 
-timestamp='2005-06-02'
+timestamp='2010-01-22'
 
 # This file is (in principle) common to ALL GNU software.
 # The presence of a machine in this file suggests that SOME GNU software
@@ -31,13 +32,16 @@ timestamp='2005-06-02'
 
 
 # Please send patches to &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">config-patches at gnu.org</A>&gt;.  Submit a context
-# diff and a properly formatted ChangeLog entry.
+# diff and a properly formatted GNU ChangeLog entry.
 #
 # Configuration subroutine to validate and canonicalize a configuration type.
 # Supply the specified configuration type as an argument.
 # If it is invalid, we print an error message on stderr and exit with code 1.
 # Otherwise, we print the canonical config type on stdout and succeed.
 
+# You can get the latest version of this script from:
+# <A HREF="http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.sub;hb=HEAD">http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.sub;hb=HEAD</A>
+
 # This file is supposed to be the same for all GNU packages
 # and recognize all the CPU types, system types and aliases
 # that are meaningful with *any* GNU software.
@@ -71,8 +75,9 @@ Report bugs and patches to &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">config-patches at gnu.org</A>&gt;.&quot;
 version=&quot;\
 GNU config.sub ($timestamp)
 
-Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005
-Free Software Foundation, Inc.
+Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000,
+2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010 Free
+Software Foundation, Inc.
 
 This is free software; see the source for copying conditions.  There is NO
 warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&quot;
@@ -119,8 +124,10 @@ esac
 # Here we must recognize all the valid KERNEL-OS combinations.
 maybe_os=`echo $1 | sed 's/^\(.*\)-\([^-]*-[^-]*\)$/\2/'`
 case $maybe_os in
-  nto-qnx* | linux-gnu* | linux-dietlibc | linux-uclibc* | uclinux-uclibc* | uclinux-gnu* | \
-  kfreebsd*-gnu* | knetbsd*-gnu* | netbsd*-gnu* | storm-chaos* | os2-emx* | rtmk-nova*)
+  nto-qnx* | linux-gnu* | linux-dietlibc | linux-newlib* | linux-uclibc* | \
+  uclinux-uclibc* | uclinux-gnu* | kfreebsd*-gnu* | knetbsd*-gnu* | netbsd*-gnu* | \
+  kopensolaris*-gnu* | \
+  storm-chaos* | os2-emx* | rtmk-nova*)
     os=-$maybe_os
     basic_machine=`echo $1 | sed 's/^\(.*\)-\([^-]*-[^-]*\)$/\1/'`
     ;;
@@ -146,10 +153,13 @@ case $os in
 	-convergent* | -ncr* | -news | -32* | -3600* | -3100* | -hitachi* |\
 	-c[123]* | -convex* | -sun | -crds | -omron* | -dg | -ultra | -tti* | \
 	-harris | -dolphin | -highlevel | -gould | -cbm | -ns | -masscomp | \
-	-apple | -axis | -knuth | -cray)
+	-apple | -axis | -knuth | -cray | -microblaze)
 		os=
 		basic_machine=$1
 		;;
+        -bluegene*)
+	        os=-cnk
+		;;
 	-sim | -cisco | -oki | -wec | -winbond)
 		os=
 		basic_machine=$1
@@ -171,6 +181,10 @@ case $os in
 	-hiux*)
 		os=-hiuxwe2
 		;;
+	-sco6)
+		os=-sco5v6
+		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
+		;;
 	-sco5)
 		os=-sco3.2v5
 		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
@@ -187,6 +201,10 @@ case $os in
 		# Don't forget version if it is 3.2v4 or newer.
 		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
 		;;
+	-sco5v6*)
+		# Don't forget version if it is 3.2v4 or newer.
+		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
+		;;
 	-sco*)
 		os=-sco3.2v2
 		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
@@ -231,23 +249,28 @@ case $basic_machine in
 	| alpha | alphaev[4-8] | alphaev56 | alphaev6[78] | alphapca5[67] \
 	| alpha64 | alpha64ev[4-8] | alpha64ev56 | alpha64ev6[78] | alpha64pca5[67] \
 	| am33_2.0 \
-	| arc | arm | arm[bl]e | arme[lb] | armv[2345] | armv[345][lb] | avr \
+	| arc | arm | arm[bl]e | arme[lb] | armv[2345] | armv[345][lb] | avr | avr32 \
 	| bfin \
 	| c4x | clipper \
 	| d10v | d30v | dlx | dsp16xx \
-	| fr30 | frv \
+	| fido | fr30 | frv \
 	| h8300 | h8500 | hppa | hppa1.[01] | hppa2.0 | hppa2.0[nw] | hppa64 \
 	| i370 | i860 | i960 | ia64 \
 	| ip2k | iq2000 \
-	| m32r | m32rle | m68000 | m68k | m88k | maxq | mcore \
+	| lm32 \
+	| m32c | m32r | m32rle | m68000 | m68k | m88k \
+	| maxq | mb | microblaze | mcore | mep | metag \
 	| mips | mipsbe | mipseb | mipsel | mipsle \
 	| mips16 \
 	| mips64 | mips64el \
-	| mips64vr | mips64vrel \
+	| mips64octeon | mips64octeonel \
 	| mips64orion | mips64orionel \
+	| mips64r5900 | mips64r5900el \
+	| mips64vr | mips64vrel \
 	| mips64vr4100 | mips64vr4100el \
 	| mips64vr4300 | mips64vr4300el \
 	| mips64vr5000 | mips64vr5000el \
+	| mips64vr5900 | mips64vr5900el \
 	| mipsisa32 | mipsisa32el \
 	| mipsisa32r2 | mipsisa32r2el \
 	| mipsisa64 | mipsisa64el \
@@ -256,35 +279,40 @@ case $basic_machine in
 	| mipsisa64sr71k | mipsisa64sr71kel \
 	| mipstx39 | mipstx39el \
 	| mn10200 | mn10300 \
-	| ms1 \
+	| moxie \
+	| mt \
 	| msp430 \
+	| nios | nios2 \
 	| ns16k | ns32k \
-	| openrisc | or32 \
+	| or32 \
 	| pdp10 | pdp11 | pj | pjl \
 	| powerpc | powerpc64 | powerpc64le | powerpcle | ppcbe \
 	| pyramid \
-	| sh | sh[1234] | sh[23]e | sh[34]eb | shbe | shle | sh[1234]le | sh3ele \
+	| rx \
+	| score \
+	| sh | sh[1234] | sh[24]a | sh[24]aeb | sh[23]e | sh[34]eb | sheb | shbe | shle | sh[1234]le | sh3ele \
 	| sh64 | sh64le \
-	| sparc | sparc64 | sparc64b | sparc86x | sparclet | sparclite \
-	| sparcv8 | sparcv9 | sparcv9b \
-	| strongarm \
+	| sparc | sparc64 | sparc64b | sparc64v | sparc86x | sparclet | sparclite \
+	| sparcv8 | sparcv9 | sparcv9b | sparcv9v \
+	| spu | strongarm \
 	| tahoe | thumb | tic4x | tic80 | tron \
+	| ubicom32 \
 	| v850 | v850e \
 	| we32k \
-	| x86 | xscale | xscalee[bl] | xstormy16 | xtensa \
-	| z8k)
+	| x86 | xc16x | xscale | xscalee[bl] | xstormy16 | xtensa \
+	| z8k | z80)
 		basic_machine=$basic_machine-unknown
 		;;
-	m32c)
-		basic_machine=$basic_machine-unknown
-		;;
-	m6811 | m68hc11 | m6812 | m68hc12)
+	m6811 | m68hc11 | m6812 | m68hc12 | picochip)
 		# Motorola 68HC11/12.
 		basic_machine=$basic_machine-unknown
 		os=-none
 		;;
 	m88110 | m680[12346]0 | m683?2 | m68360 | m5200 | v70 | w65 | z8k)
 		;;
+	ms1)
+		basic_machine=mt-unknown
+		;;
 
 	# We use `pc' rather than `unknown'
 	# because (1) that's what they normally are, and
@@ -304,28 +332,32 @@ case $basic_machine in
 	| alpha64-* | alpha64ev[4-8]-* | alpha64ev56-* | alpha64ev6[78]-* \
 	| alphapca5[67]-* | alpha64pca5[67]-* | arc-* \
 	| arm-*  | armbe-* | armle-* | armeb-* | armv*-* \
-	| avr-* \
+	| avr-* | avr32-* \
 	| bfin-* | bs2000-* \
 	| c[123]* | c30-* | [cjt]90-* | c4x-* | c54x-* | c55x-* | c6x-* \
 	| clipper-* | craynv-* | cydra-* \
 	| d10v-* | d30v-* | dlx-* \
 	| elxsi-* \
-	| f30[01]-* | f700-* | fr30-* | frv-* | fx80-* \
+	| f30[01]-* | f700-* | fido-* | fr30-* | frv-* | fx80-* \
 	| h8300-* | h8500-* \
 	| hppa-* | hppa1.[01]-* | hppa2.0-* | hppa2.0[nw]-* | hppa64-* \
 	| i*86-* | i860-* | i960-* | ia64-* \
 	| ip2k-* | iq2000-* \
-	| m32r-* | m32rle-* \
+	| lm32-* \
+	| m32c-* | m32r-* | m32rle-* \
 	| m68000-* | m680[012346]0-* | m68360-* | m683?2-* | m68k-* \
-	| m88110-* | m88k-* | maxq-* | mcore-* \
+	| m88110-* | m88k-* | maxq-* | mcore-* | metag-* | microblaze-* \
 	| mips-* | mipsbe-* | mipseb-* | mipsel-* | mipsle-* \
 	| mips16-* \
 	| mips64-* | mips64el-* \
-	| mips64vr-* | mips64vrel-* \
+	| mips64octeon-* | mips64octeonel-* \
 	| mips64orion-* | mips64orionel-* \
+	| mips64r5900-* | mips64r5900el-* \
+	| mips64vr-* | mips64vrel-* \
 	| mips64vr4100-* | mips64vr4100el-* \
 	| mips64vr4300-* | mips64vr4300el-* \
 	| mips64vr5000-* | mips64vr5000el-* \
+	| mips64vr5900-* | mips64vr5900el-* \
 	| mipsisa32-* | mipsisa32el-* \
 	| mipsisa32r2-* | mipsisa32r2el-* \
 	| mipsisa64-* | mipsisa64el-* \
@@ -334,30 +366,35 @@ case $basic_machine in
 	| mipsisa64sr71k-* | mipsisa64sr71kel-* \
 	| mipstx39-* | mipstx39el-* \
 	| mmix-* \
-	| ms1-* \
+	| mt-* \
 	| msp430-* \
+	| nios-* | nios2-* \
 	| none-* | np1-* | ns16k-* | ns32k-* \
 	| orion-* \
 	| pdp10-* | pdp11-* | pj-* | pjl-* | pn-* | power-* \
 	| powerpc-* | powerpc64-* | powerpc64le-* | powerpcle-* | ppcbe-* \
 	| pyramid-* \
-	| romp-* | rs6000-* \
-	| sh-* | sh[1234]-* | sh[23]e-* | sh[34]eb-* | shbe-* \
+	| romp-* | rs6000-* | rx-* \
+	| sh-* | sh[1234]-* | sh[24]a-* | sh[24]aeb-* | sh[23]e-* | sh[34]eb-* | sheb-* | shbe-* \
 	| shle-* | sh[1234]le-* | sh3ele-* | sh64-* | sh64le-* \
-	| sparc-* | sparc64-* | sparc64b-* | sparc86x-* | sparclet-* \
+	| sparc-* | sparc64-* | sparc64b-* | sparc64v-* | sparc86x-* | sparclet-* \
 	| sparclite-* \
-	| sparcv8-* | sparcv9-* | sparcv9b-* | strongarm-* | sv1-* | sx?-* \
+	| sparcv8-* | sparcv9-* | sparcv9b-* | sparcv9v-* | strongarm-* | sv1-* | sx?-* \
 	| tahoe-* | thumb-* \
 	| tic30-* | tic4x-* | tic54x-* | tic55x-* | tic6x-* | tic80-* \
+	| tile-* | tilegx-* \
 	| tron-* \
+	| ubicom32-* \
 	| v850-* | v850e-* | vax-* \
 	| we32k-* \
-	| x86-* | x86_64-* | xps100-* | xscale-* | xscalee[bl]-* \
-	| xstormy16-* | xtensa-* \
+	| x86-* | x86_64-* | xc16x-* | xps100-* | xscale-* | xscalee[bl]-* \
+	| xstormy16-* | xtensa*-* \
 	| ymp-* \
-	| z8k-*)
+	| z8k-* | z80-*)
 		;;
-	m32c-*)
+	# Recognize the basic CPU types without company name, with glob match.
+	xtensa*)
+		basic_machine=$basic_machine-unknown
 		;;
 	# Recognize the various machine names and aliases which stand
 	# for a CPU type and a company and sometimes even an OS.
@@ -421,6 +458,10 @@ case $basic_machine in
 		basic_machine=m68k-apollo
 		os=-bsd
 		;;
+	aros)
+		basic_machine=i386-pc
+		os=-aros
+		;;
 	aux)
 		basic_machine=m68k-apple
 		os=-aux
@@ -429,10 +470,26 @@ case $basic_machine in
 		basic_machine=ns32k-sequent
 		os=-dynix
 		;;
+	blackfin)
+		basic_machine=bfin-unknown
+		os=-linux
+		;;
+	blackfin-*)
+		basic_machine=bfin-`echo $basic_machine | sed 's/^[^-]*-//'`
+		os=-linux
+		;;
+	bluegene*)
+		basic_machine=powerpc-ibm
+		os=-cnk
+		;;
 	c90)
 		basic_machine=c90-cray
 		os=-unicos
 		;;
+        cegcc)
+		basic_machine=arm-unknown
+		os=-cegcc
+		;;
 	convex-c1)
 		basic_machine=c1-convex
 		os=-bsd
@@ -461,8 +518,8 @@ case $basic_machine in
 		basic_machine=craynv-cray
 		os=-unicosmp
 		;;
-	cr16c)
-		basic_machine=cr16c-unknown
+	cr16)
+		basic_machine=cr16-unknown
 		os=-elf
 		;;
 	crds | unos)
@@ -500,6 +557,10 @@ case $basic_machine in
 		basic_machine=m88k-motorola
 		os=-sysv3
 		;;
+	dicos)
+		basic_machine=i686-pc
+		os=-dicos
+		;;
 	djgpp)
 		basic_machine=i586-pc
 		os=-msdosdjgpp
@@ -654,6 +715,14 @@ case $basic_machine in
 		basic_machine=m68k-isi
 		os=-sysv
 		;;
+	m68knommu)
+		basic_machine=m68k-unknown
+		os=-linux
+		;;
+	m68knommu-*)
+		basic_machine=m68k-`echo $basic_machine | sed 's/^[^-]*-//'`
+		os=-linux
+		;;
 	m88k-omron*)
 		basic_machine=m88k-omron
 		;;
@@ -665,10 +734,17 @@ case $basic_machine in
 		basic_machine=ns32k-utek
 		os=-sysv
 		;;
+        microblaze)
+		basic_machine=microblaze-xilinx
+		;;
 	mingw32)
 		basic_machine=i386-pc
 		os=-mingw32
 		;;
+	mingw32ce)
+		basic_machine=arm-unknown
+		os=-mingw32ce
+		;;
 	miniframe)
 		basic_machine=m68000-convergent
 		;;
@@ -694,6 +770,9 @@ case $basic_machine in
 		basic_machine=i386-pc
 		os=-msdos
 		;;
+	ms1-*)
+		basic_machine=`echo $basic_machine | sed -e 's/ms1-/mt-/'`
+		;;
 	mvs)
 		basic_machine=i370-ibm
 		os=-mvs
@@ -769,9 +848,8 @@ case $basic_machine in
 		basic_machine=hppa1.1-oki
 		os=-proelf
 		;;
-	or32 | or32-*)
+	openrisc | openrisc-*)
 		basic_machine=or32-unknown
-		os=-coff
 		;;
 	os400)
 		basic_machine=powerpc-ibm
@@ -793,6 +871,14 @@ case $basic_machine in
 		basic_machine=i860-intel
 		os=-osf
 		;;
+	parisc)
+		basic_machine=hppa-unknown
+		os=-linux
+		;;
+	parisc-*)
+		basic_machine=hppa-`echo $basic_machine | sed 's/^[^-]*-//'`
+		os=-linux
+		;;
 	pbd)
 		basic_machine=sparc-tti
 		;;
@@ -802,6 +888,12 @@ case $basic_machine in
 	pc532 | pc532-*)
 		basic_machine=ns32k-pc532
 		;;
+	pc98)
+		basic_machine=i386-pc
+		;;
+	pc98-*)
+		basic_machine=i386-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
 	pentium | p5 | k5 | k6 | nexgen | viac3)
 		basic_machine=i586-pc
 		;;
@@ -858,6 +950,10 @@ case $basic_machine in
 		basic_machine=i586-unknown
 		os=-pw32
 		;;
+	rdos)
+		basic_machine=i386-pc
+		os=-rdos
+		;;
 	rom68k)
 		basic_machine=m68k-rom68k
 		os=-coff
@@ -884,6 +980,10 @@ case $basic_machine in
 	sb1el)
 		basic_machine=mipsisa64sb1el-unknown
 		;;
+	sde)
+		basic_machine=mipsisa32-sde
+		os=-elf
+		;;
 	sei)
 		basic_machine=mips-sei
 		os=-seiux
@@ -895,6 +995,9 @@ case $basic_machine in
 		basic_machine=sh-hitachi
 		os=-hms
 		;;
+	sh5el)
+		basic_machine=sh5le-unknown
+		;;
 	sh64)
 		basic_machine=sh64-unknown
 		;;
@@ -984,6 +1087,15 @@ case $basic_machine in
 		basic_machine=tic6x-unknown
 		os=-coff
 		;;
+        # This must be matched before tile*.
+        tilegx*)
+		basic_machine=tilegx-unknown
+		os=-linux-gnu
+		;;
+	tile*)
+		basic_machine=tile-unknown
+		os=-linux-gnu
+		;;
 	tx39)
 		basic_machine=mipstx39-unknown
 		;;
@@ -1059,6 +1171,10 @@ case $basic_machine in
 		basic_machine=z8k-unknown
 		os=-sim
 		;;
+	z80-*-coff)
+		basic_machine=z80-unknown
+		os=-sim
+		;;
 	none)
 		basic_machine=none-none
 		os=-none
@@ -1097,13 +1213,10 @@ case $basic_machine in
 	we32k)
 		basic_machine=we32k-att
 		;;
-	sh3 | sh4 | sh[34]eb | sh[1234]le | sh[23]ele)
+	sh[1234] | sh[24]a | sh[24]aeb | sh[34]eb | sh[1234]le | sh[23]ele)
 		basic_machine=sh-unknown
 		;;
-	sh64)
-		basic_machine=sh64-unknown
-		;;
-	sparc | sparcv8 | sparcv9 | sparcv9b)
+	sparc | sparcv8 | sparcv9 | sparcv9b | sparcv9v)
 		basic_machine=sparc-sun
 		;;
 	cydra)
@@ -1150,6 +1263,9 @@ case $os in
         # First match some system type aliases
         # that might get confused with valid system types.
 	# -solaris* is a basic system type, with this one exception.
+        -auroraux)
+	        os=-auroraux
+		;;
 	-solaris1 | -solaris1.*)
 		os=`echo $os | sed -e 's|solaris1|sunos4|'`
 		;;
@@ -1170,26 +1286,30 @@ case $os in
 	# Each alternative MUST END IN A *, to match a version number.
 	# -sysv* is not here because it comes later, after sysvr4.
 	-gnu* | -bsd* | -mach* | -minix* | -genix* | -ultrix* | -irix* \
-	      | -*vms* | -sco* | -esix* | -isc* | -aix* | -sunos | -sunos[34]*\
-	      | -hpux* | -unos* | -osf* | -luna* | -dgux* | -solaris* | -sym* \
+	      | -*vms* | -sco* | -esix* | -isc* | -aix* | -cnk* | -sunos | -sunos[34]*\
+	      | -hpux* | -unos* | -osf* | -luna* | -dgux* | -auroraux* | -solaris* \
+	      | -sym* | -kopensolaris* \
 	      | -amigaos* | -amigados* | -msdos* | -newsos* | -unicos* | -aof* \
-	      | -aos* \
+	      | -aos* | -aros* \
 	      | -nindy* | -vxsim* | -vxworks* | -ebmon* | -hms* | -mvs* \
 	      | -clix* | -riscos* | -uniplus* | -iris* | -rtu* | -xenix* \
-	      | -hiux* | -386bsd* | -knetbsd* | -mirbsd* | -netbsd* | -openbsd* \
+	      | -hiux* | -386bsd* | -knetbsd* | -mirbsd* | -netbsd* \
+	      | -openbsd* | -solidbsd* \
 	      | -ekkobsd* | -kfreebsd* | -freebsd* | -riscix* | -lynxos* \
 	      | -bosx* | -nextstep* | -cxux* | -aout* | -elf* | -oabi* \
 	      | -ptx* | -coff* | -ecoff* | -winnt* | -domain* | -vsta* \
 	      | -udi* | -eabi* | -lites* | -ieee* | -go32* | -aux* \
-	      | -chorusos* | -chorusrdb* \
+	      | -chorusos* | -chorusrdb* | -cegcc* \
 	      | -cygwin* | -pe* | -psos* | -moss* | -proelf* | -rtems* \
-	      | -mingw32* | -linux-gnu* | -linux-uclibc* | -uxpv* | -beos* | -mpeix* | -udk* \
+	      | -mingw32* | -linux-gnu* | -linux-newlib* | -linux-uclibc* \
+	      | -uxpv* | -beos* | -mpeix* | -udk* \
 	      | -interix* | -uwin* | -mks* | -rhapsody* | -darwin* | -opened* \
 	      | -openstep* | -oskit* | -conix* | -pw32* | -nonstopux* \
 	      | -storm-chaos* | -tops10* | -tenex* | -tops20* | -its* \
 	      | -os2* | -vos* | -palmos* | -uclinux* | -nucleus* \
 	      | -morphos* | -superux* | -rtmk* | -rtmk-nova* | -windiss* \
-	      | -powermax* | -dnix* | -nx6 | -nx7 | -sei* | -dragonfly* | -skyos*)
+	      | -powermax* | -dnix* | -nx6 | -nx7 | -sei* | -dragonfly* \
+	      | -skyos* | -haiku* | -rdos* | -toppers* | -drops* | -es*)
 	# Remember, each alternative MUST END IN *, to match a version number.
 		;;
 	-qnx*)
@@ -1207,7 +1327,7 @@ case $os in
 		os=`echo $os | sed -e 's|nto|nto-qnx|'`
 		;;
 	-sim | -es1800* | -hms* | -xray | -os68k* | -none* | -v88r* \
-	      | -windows* | -osx | -abug | -netware* | -os9* | -beos* \
+	      | -windows* | -osx | -abug | -netware* | -os9* | -beos* | -haiku* \
 	      | -macos* | -mpw* | -magic* | -mmixware* | -mon960* | -lnews*)
 		;;
 	-mac*)
@@ -1319,6 +1439,11 @@ case $os in
 	-zvmoe)
 		os=-zvmoe
 		;;
+	-dicos*)
+		os=-dicos
+		;;
+        -nacl*)
+	        ;;
 	-none)
 		;;
 	*)
@@ -1341,6 +1466,12 @@ else
 # system, and we'll never get to this point.
 
 case $basic_machine in
+        score-*)
+		os=-elf
+		;;
+        spu-*)
+		os=-elf
+		;;
 	*-acorn)
 		os=-riscix1.2
 		;;
@@ -1350,9 +1481,9 @@ case $basic_machine in
 	arm*-semi)
 		os=-aout
 		;;
-    c4x-* | tic4x-*)
-        os=-coff
-        ;;
+        c4x-* | tic4x-*)
+        	os=-coff
+		;;
 	# This must come before the *-dec entry.
 	pdp10-*)
 		os=-tops20
@@ -1378,6 +1509,9 @@ case $basic_machine in
 	m68*-cisco)
 		os=-aout
 		;;
+        mep-*)
+		os=-elf
+		;;
 	mips*-cisco)
 		os=-elf
 		;;
@@ -1396,6 +1530,9 @@ case $basic_machine in
 	*-be)
 		os=-beos
 		;;
+	*-haiku)
+		os=-haiku
+		;;
 	*-ibm)
 		os=-aix
 		;;
@@ -1504,7 +1641,7 @@ case $basic_machine in
 			-sunos*)
 				vendor=sun
 				;;
-			-aix*)
+			-cnk*|-aix*)
 				vendor=ibm
 				;;
 			-beos*)
diff --git a/nxcomp/Agent.h b/nxcomp/Agent.h
index fac5acd..ded344d 100644
--- a/nxcomp/Agent.h
+++ b/nxcomp/Agent.h
@@ -149,30 +149,38 @@ class Agent
 
   int remoteCanRead(const fd_set * const readSet)
   {
+    // OS X 10.5 requires the second argument to be non-const, so copy readSet.
+    // It's safe though, as FD_ISSET does not operate on it.
+    fd_set readWorkSet = *readSet;
+
     #if defined(TEST) || defined(INFO)
     *logofs &lt;&lt; &quot;Agent: remoteCanRead() is &quot; &lt;&lt;
-               (FD_ISSET(remoteFd_, readSet) &amp;&amp; transport_ -&gt; dequeuable() != 0)
-            &lt;&lt; &quot; with FD_ISSET() &quot; &lt;&lt; (int) FD_ISSET(remoteFd_, readSet)
+               (FD_ISSET(remoteFd_, &amp;readWorkSet) &amp;&amp; transport_ -&gt; dequeuable() != 0)
+            &lt;&lt; &quot; with FD_ISSET() &quot; &lt;&lt; (int) FD_ISSET(remoteFd_, &amp;readWorkSet)
             &lt;&lt; &quot; and dequeuable &quot; &lt;&lt; transport_ -&gt; dequeuable()
             &lt;&lt; &quot;.\n&quot; &lt;&lt; logofs_flush;
     #endif
 
-    return (FD_ISSET(remoteFd_, readSet) &amp;&amp;
+    return (FD_ISSET(remoteFd_, &amp;readWorkSet) &amp;&amp;
                 transport_ -&gt; dequeuable() != 0);
   }
 
   int remoteCanWrite(const fd_set * const writeSet)
   {
+    // OS X 10.5 requires the second argument to be non-const, so copy writeSet.
+    // It's safe though, as FD_ISSET does not operate on it.
+    fd_set writeWorkSet = *writeSet;
+
     #if defined(TEST) || defined(INFO)
     *logofs &lt;&lt; &quot;Agent: remoteCanWrite() is &quot; &lt;&lt;
-               (FD_ISSET(remoteFd_, writeSet) &amp;&amp; transport_ -&gt;
+               (FD_ISSET(remoteFd_, &amp;writeWorkSet) &amp;&amp; transport_ -&gt;
                queuable() != 0 &amp;&amp; canRead_ == 1) &lt;&lt; &quot; with FD_ISSET() &quot;
-            &lt;&lt; (int) FD_ISSET(remoteFd_, writeSet) &lt;&lt; &quot; queueable &quot;
+            &lt;&lt; (int) FD_ISSET(remoteFd_, &amp;writeWorkSet) &lt;&lt; &quot; queueable &quot;
             &lt;&lt; transport_ -&gt; queuable() &lt;&lt; &quot; channel can read &quot;
             &lt;&lt; canRead_ &lt;&lt; &quot;.\n&quot; &lt;&lt; logofs_flush;
     #endif
 
-    return (FD_ISSET(remoteFd_, writeSet) &amp;&amp;
+    return (FD_ISSET(remoteFd_, &amp;writeWorkSet) &amp;&amp;
                 transport_ -&gt; queuable() != 0 &amp;&amp;
                     canRead_ == 1);
   }
@@ -203,13 +211,17 @@ class Agent
 
   int proxyCanRead(const fd_set * const readSet)
   {
+    // OS X 10.5 requires the second argument to be non-const, so copy readSet.
+    // It's safe though, as FD_ISSET does not operate on it.
+    fd_set readWorkSet = *readSet;
+
     #if defined(TEST) || defined(INFO)
     *logofs &lt;&lt; &quot;Agent: proxyCanRead() is &quot;
-            &lt;&lt; ((int) FD_ISSET(proxy -&gt; getFd(), readSet)
+            &lt;&lt; ((int) FD_ISSET(proxy -&gt; getFd(), &amp;readWorkSet)
             &lt;&lt; &quot;.\n&quot; &lt;&lt; logofs_flush;
     #endif
 
-    return (FD_ISSET(proxy -&gt; getFd(), readSet));
+    return (FD_ISSET(proxy -&gt; getFd(), &amp;readWorkSet));
   }
 
   int enqueueData(const char *data, const int size) const
diff --git a/nxcomp/Auth.cpp b/nxcomp/Auth.cpp
index d8e9991..c52392a 100644
--- a/nxcomp/Auth.cpp
+++ b/nxcomp/Auth.cpp
@@ -217,22 +217,31 @@ int Auth::getCookie()
 
   //
   // Use the nxauth command on Windows and the Mac, xauth
-  // on all the other platforms. On Windows and on the Mac
-  // we assume that the nxauth command is located under
-  // bin in the client installation directory. On all the
+  // on all the other platforms. On Windows we assume that
+  // the nxauth command is located under bin in the client
+  // installation directory. On Mac OS X we assume that the
+  // command is located directly in the client installation
+  // directory, to make bundle shipping easier. On all the
   // other platforms we use the default xauth command that
   // is in our path.
   //
 
   char command[DEFAULT_STRING_LIMIT];
 
-  #if defined(__CYGWIN32__) || defined(__APPLE__)
+  #if defined(__CYGWIN32__)
 
   snprintf(command, DEFAULT_STRING_LIMIT - 1,
                &quot;%s/bin/nxauth&quot;, control -&gt; SystemPath);
 
   *(command + DEFAULT_STRING_LIMIT - 1) = '\0';
 
+  #elif defined(__APPLE__)
+
+  snprintf(command, DEFAULT_STRING_LIMIT - 1,
+               &quot;%s/nxauth&quot;, control -&gt; SystemPath);
+
+  *(command + DEFAULT_STRING_LIMIT - 1) = '\0';
+
   #else
 
   strcpy(command, &quot;xauth&quot;);
diff --git a/nxcomp/Loop.cpp b/nxcomp/Loop.cpp
index 92b6fc2..8069af5 100644
--- a/nxcomp/Loop.cpp
+++ b/nxcomp/Loop.cpp
@@ -952,6 +952,7 @@ static char listenHost[DEFAULT_STRING_LENGTH]  = { 0 };
 static char displayHost[DEFAULT_STRING_LENGTH] = { 0 };
 static char authCookie[DEFAULT_STRING_LENGTH]  = { 0 };
 
+static int loopbackBind = DEFAULT_LOOPBACK_BIND;
 static int proxyPort = DEFAULT_NX_PROXY_PORT;
 static int xPort     = DEFAULT_NX_X_PORT;
 
@@ -3959,7 +3960,14 @@ int SetupTcpSocket()
 
   tcpAddr.sin_family = AF_INET;
   tcpAddr.sin_port = htons(proxyPortTCP);
-  tcpAddr.sin_addr.s_addr = htonl(INADDR_ANY);
+  if ( loopbackBind )
+  {
+    tcpAddr.sin_addr.s_addr = htonl(INADDR_LOOPBACK);
+  }
+  else
+  {
+    tcpAddr.sin_addr.s_addr = htonl(INADDR_ANY);
+  }
 
   if (bind(tcpFD, (sockaddr *) &amp;tcpAddr, sizeof(tcpAddr)) == -1)
   {
@@ -4512,7 +4520,14 @@ int ListenConnection(int port, const char *label)
 
   tcpAddr.sin_family = AF_INET;
   tcpAddr.sin_port = htons(portTCP);
-  tcpAddr.sin_addr.s_addr = htonl(INADDR_ANY);
+  if ( loopbackBind )
+  {
+    tcpAddr.sin_addr.s_addr = htonl(INADDR_LOOPBACK);
+  }
+  else
+  {
+    tcpAddr.sin_addr.s_addr = htonl(INADDR_ANY);
+  }
 
   if (bind(newFD, (sockaddr *) &amp;tcpAddr, sizeof(tcpAddr)) == -1)
   {
@@ -5884,20 +5899,9 @@ void InstallSignal(int signal, int action)
 
   struct sigaction newAction;
 
-  newAction.sa_handler = HandleSignal;
-
-  //
-  // This field doesn't exist on most OSes except
-  // Linux. We keep setting the field to NULL to
-  // avoid side-effects in the case the field is
-  // a value return.
-  //
+  memset(&amp;newAction, 0, sizeof(newAction));
 
-  #if defined(__linux__)
-
-  newAction.sa_restorer = NULL;
-
-  #endif
+  newAction.sa_handler = HandleSignal;
 
   sigemptyset(&amp;(newAction.sa_mask));
 
@@ -6509,13 +6513,9 @@ void SetTimer(int value)
 
   struct sigaction action;
 
-  action.sa_handler = HandleTimer;
-
-  #if defined(__linux__)
-
-  action.sa_restorer = NULL;
+  memset(&amp;action, 0, sizeof(action));
 
-  #endif
+  action.sa_handler = HandleTimer;
 
   sigemptyset(&amp;action.sa_mask);
 
@@ -6695,7 +6695,14 @@ int WaitForRemote(int portNum)
 
   #ifdef __APPLE__
 
-  tcpAddr.sin_addr.s_addr = htonl(INADDR_ANY);
+  if ( loopbackBind )
+  {
+    tcpAddr.sin_addr.s_addr = htonl(INADDR_LOOPBACK);
+  }
+  else
+  {
+    tcpAddr.sin_addr.s_addr = htonl(INADDR_ANY);
+  }
 
   #else
 
@@ -8374,6 +8381,10 @@ int ParseEnvironmentOptions(const char *env, int force)
 
       listenPort = ValidateArg(&quot;local&quot;, name, value);
     }
+    else if (strcasecmp(name, &quot;loopback&quot;) == 0)
+    {
+      loopbackBind = ValidateArg(&quot;local&quot;, name, value);
+    }
     else if (strcasecmp(name, &quot;accept&quot;) == 0)
     {
       if (*connectHost != '\0')
@@ -13750,7 +13761,14 @@ int ParseListenOption(int &amp;address)
     }
     else
     {
-      address = htonl(INADDR_ANY);
+      if ( loopbackBind )
+      {
+        address = htonl(INADDR_LOOPBACK);
+      }
+      else
+      {
+        address = htonl(INADDR_ANY);
+      }
     }
   }
   else
diff --git a/nxcomp/Makefile.in b/nxcomp/Makefile.in
index 434118b..5a86332 100644
--- a/nxcomp/Makefile.in
+++ b/nxcomp/Makefile.in
@@ -64,10 +64,15 @@ exec_prefix = @exec_prefix@
 bindir      = @bindir@
 man1dir     = @mandir@/man1
 VPATH       = @srcdir@
+libdir      = @libdir@
+includedir  = @includedir@
 
 INSTALL         = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA    = @INSTALL_DATA@
+INSTALL_LINK    = cp -av
+DESTDIR         =
+RM_FILE         = rm -f
 
 #
 # This should be autodetected.
@@ -264,16 +269,48 @@ depend.status:
 		fi
 		touch depend.status
 
-install:	install.bin install.man
+install:	install.bin install.lib install.man
 
 install.bin:
 
+install.lib: all
+	./mkinstalldirs $(DESTDIR)${libdir}/nx
+	./mkinstalldirs $(DESTDIR)${includedir}/nx
+	$(INSTALL_DATA) $(LIBFULL)              $(DESTDIR)${libdir}/nx
+	$(INSTALL_LINK) libXcomp.so.3           $(DESTDIR)${libdir}/nx
+	$(INSTALL_LINK) libXcomp.so             $(DESTDIR)${libdir}/nx
+	$(INSTALL_DATA) libXcomp.a              $(DESTDIR)${libdir}/nx
+	$(INSTALL_DATA) NX*.h                   $(DESTDIR)${includedir}/nx
+	$(INSTALL_DATA) MD5.h                   $(DESTDIR)${includedir}/nx
+	echo &quot;Running ldconfig tool, this may take a while...&quot; &amp;&amp; ldconfig || true
+
 install.man:
 
+uninstall:	uninstall.bin uninstall.lib uninstall.man
+
+uninstall.bin:
+
+uninstall.lib:
+	$(RM_FILE) $(DESTDIR)${libdir}/nx/$(LIBFULL)
+	$(RM_FILE) $(DESTDIR)${libdir}/nx/libXcomp.so.3
+	$(RM_FILE) $(DESTDIR)${libdir}/nx/libXcomp.so
+	$(RM_FILE) $(DESTDIR)${libdir}/nx/libXcomp.a
+	$(RM_FILE) $(DESTDIR)${includedir}/nx/NXalert.h
+	$(RM_FILE) $(DESTDIR)${includedir}/nx/NX.h
+	$(RM_FILE) $(DESTDIR)${includedir}/nx/NXmitshm.h
+	$(RM_FILE) $(DESTDIR)${includedir}/nx/NXpack.h
+	$(RM_FILE) $(DESTDIR)${includedir}/nx/NXproto.h
+	$(RM_FILE) $(DESTDIR)${includedir}/nx/NXrender.h
+	$(RM_FILE) $(DESTDIR)${includedir}/nx/NXvars.h
+	$(RM_FILE) $(DESTDIR)${includedir}/nx/MD5.h
+	echo &quot;Running ldconfig tool, this may take a while...&quot; &amp;&amp; ldconfig || true
+
+uninstall.man:
+
 clean:
 		-rm -f *~ *.o *.bak *.orig *.rej st?????? core core.* *.out.* \
 		@ALL@
 
 distclean:	clean
 		-rm -rf autom4te.cache config.status config.log \
-		config.cache depend.status Makefile tags
+		config.cache depend.status Makefile tags configure
diff --git a/nxcomp/Message.cpp b/nxcomp/Message.cpp
index 72d4fff..188ed9a 100644
--- a/nxcomp/Message.cpp
+++ b/nxcomp/Message.cpp
@@ -15,9 +15,9 @@
 /*                                                                        */
 /**************************************************************************/
 
-#include &lt;stdio.h&gt;
+#include &lt;cstdio&gt;
 #include &lt;unistd.h&gt;
-#include &lt;string.h&gt;
+#include &lt;cstring&gt;
 
 #include &lt;algorithm&gt;
 
diff --git a/nxcomp/Misc.cpp b/nxcomp/Misc.cpp
index 2c72259..0095eaa 100644
--- a/nxcomp/Misc.cpp
+++ b/nxcomp/Misc.cpp
@@ -15,11 +15,11 @@
 /*                                                                        */
 /**************************************************************************/
 
-#include &lt;stdio.h&gt;
-#include &lt;ctype.h&gt;
-#include &lt;stdlib.h&gt;
+#include &lt;cstdio&gt;
+#include &lt;cctype&gt;
+#include &lt;cstdlib&gt;
 #include &lt;unistd.h&gt;
-#include &lt;signal.h&gt;
+#include &lt;csignal&gt;
 
 #include &lt;errno.h&gt;
 #include &lt;string.h&gt;
@@ -42,6 +42,14 @@
 #undef  DEBUG
 
 //
+// By default nxproxy binds to all network interfaces, setting
+// DEFAULT_LOOPBACK_BIND to 1 enables binding to the loopback
+// device only.
+//
+
+const int DEFAULT_LOOPBACK_BIND = 0;
+
+//
 // TCP port offset applied to any NX port specification.
 //
 
@@ -137,6 +145,8 @@ static const char UsageInfo[] =
 \n\
   listen=n     Local port used for accepting the proxy connection.\n\
 \n\
+  loopback=b   Bind to the loopback device only.\n\
+\n\
   accept=s     Name or IP of host that can connect to the proxy.\n\
 \n\
   connect=s    Name or IP of host that the proxy will connect to.\n\
diff --git a/nxcomp/Misc.h b/nxcomp/Misc.h
index 2008317..21a5030 100644
--- a/nxcomp/Misc.h
+++ b/nxcomp/Misc.h
@@ -21,8 +21,8 @@
 #include &lt;iostream&gt;
 #include &lt;fstream&gt;
 
-#include &lt;errno.h&gt;
-#include &lt;string.h&gt;
+#include &lt;cerrno&gt;
+#include &lt;cstring&gt;
 
 #ifdef __sun
 
@@ -90,6 +90,14 @@ extern const int DEFAULT_NX_SLAVE_PORT_CLIENT_OFFSET;
 extern const int DEFAULT_NX_SLAVE_PORT_SERVER_OFFSET;
 
 //
+// NX proxy binds to all network interfaces by default
+// With the -loopback parameter, you can switch
+// over to binding to the loopback device only.
+//
+
+extern const int DEFAULT_LOOPBACK_BIND;
+
+//
 // Return strings containing various info.
 //
 
diff --git a/nxcomp/Pgn.cpp b/nxcomp/Pgn.cpp
index a683734..af26724 100644
--- a/nxcomp/Pgn.cpp
+++ b/nxcomp/Pgn.cpp
@@ -414,7 +414,7 @@ int DecompressPng16(unsigned char *compressedData, int compressedLen,
 
   png_read_info(pngPtr, infoPtr);
 
-  if (infoPtr -&gt; color_type == PNG_COLOR_TYPE_PALETTE)
+  if (png_get_color_type(pngPtr, infoPtr) == PNG_COLOR_TYPE_PALETTE)
   {
     png_set_expand(pngPtr);
   }
@@ -565,7 +565,7 @@ int DecompressPng24(unsigned char *compressedData, int compressedLen,
 
   png_read_info( pngPtr, infoPtr ) ;
 
-  if (infoPtr -&gt; color_type == PNG_COLOR_TYPE_PALETTE)
+  if (png_get_color_type(pngPtr, infoPtr) == PNG_COLOR_TYPE_PALETTE)
   {
     png_set_expand(pngPtr);
   }
@@ -709,7 +709,7 @@ int DecompressPng32(unsigned char *compressedData, int compressedLen,
   png_read_info(pngPtr, infoPtr) ;
 
 
-  if (infoPtr -&gt; color_type == PNG_COLOR_TYPE_PALETTE)
+  if (png_get_color_type(pngPtr, infoPtr) == PNG_COLOR_TYPE_PALETTE)
   {
     png_set_expand(pngPtr);
   }
diff --git a/nxcomp/Proxy.cpp b/nxcomp/Proxy.cpp
index 3b4df7e..d6c67e0 100644
--- a/nxcomp/Proxy.cpp
+++ b/nxcomp/Proxy.cpp
@@ -15,9 +15,9 @@
 /*                                                                        */
 /**************************************************************************/
 
-#include &lt;stdio.h&gt;
+#include &lt;cstdio&gt;
 #include &lt;unistd.h&gt;
-#include &lt;stdlib.h&gt;
+#include &lt;cstdlib&gt;
 #include &lt;sys/types.h&gt;
 #include &lt;sys/stat.h&gt;
 
diff --git a/nxcomp/Split.cpp b/nxcomp/Split.cpp
index 50627e7..35a4ed4 100644
--- a/nxcomp/Split.cpp
+++ b/nxcomp/Split.cpp
@@ -16,7 +16,7 @@
 /**************************************************************************/
 
 #include &lt;unistd.h&gt;
-#include &lt;string.h&gt;
+#include &lt;cstring&gt;
 #include &lt;sys/stat.h&gt;
 #include &lt;sys/types.h&gt;
 #include &lt;utime.h&gt;
diff --git a/nxcomp/configure.in b/nxcomp/configure.in
index e9ab81d..6fa9757 100644
--- a/nxcomp/configure.in
+++ b/nxcomp/configure.in
@@ -7,8 +7,8 @@ AC_PREREQ(2.13)
 
 dnl Set our default compilation flags.
 
-CXXFLAGS=&quot;-O3 -fno-rtti -fno-exceptions&quot;
-CFLAGS=&quot;-O3&quot;
+CXXFLAGS=&quot;$CXXFLAGS -O3 -fno-rtti -fno-exceptions&quot;
+CFLAGS=&quot;$CFLAGS -O3&quot;
 
 dnl Reset default linking directives.
 
diff --git a/nxcompext/Makefile.in b/nxcompext/Makefile.in
index cdf0b1c..ff1bd8b 100644
--- a/nxcompext/Makefile.in
+++ b/nxcompext/Makefile.in
@@ -42,12 +42,12 @@ CCINCLUDES  = -I. -I../nxcomp
 CCDEFINES   =
 
 LDFLAGS     = @LDFLAGS@ -L../nxcomp
-LIBS        = @LIBS@ -lz -lX11 -lXcomp
+LIBS        = @LIBS@ -lz -lNX_X11 -lXcomp
 
 #
 # Only if THREADS is defined
 #
-# LIBS = @LIBS@ -lz -ljpeg -lpthread -lX11 -lXcomp
+# LIBS = @LIBS@ -lz -ljpeg -lpthread -lNX_X11 -lXcomp
 #
 
 srcdir      = @srcdir@
@@ -56,11 +56,15 @@ exec_prefix = @exec_prefix@
 bindir      = @bindir@
 man1dir     = @mandir@/man1
 VPATH       = @srcdir@
+libdir = @libdir@
+includedir = @includedir@
 
 INSTALL         = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA    = @INSTALL_DATA@
-
+INSTALL_LINK    = cp -av
+DESTDIR         =
+RM_FILE         = rm -f
 #
 # This should be autodetected.
 #
@@ -147,16 +151,39 @@ depend.status:
 		fi
 		touch depend.status
 
-install:	install.bin install.man
+install:       install.bin install.lib install.man
 
 install.bin:
 
+install.lib: all
+	./mkinstalldirs $(DESTDIR)${libdir}/nx
+	./mkinstalldirs $(DESTDIR)${includedir}/nx
+	$(INSTALL_DATA) $(LIBFULL)              $(DESTDIR)${libdir}/nx
+	$(INSTALL_LINK) libXcompext.so.3	$(DESTDIR)${libdir}/nx
+	$(INSTALL_LINK) libXcompext.so          $(DESTDIR)${libdir}/nx
+	$(INSTALL_DATA) NX*.h                   $(DESTDIR)${includedir}/nx
+	echo &quot;Running ldconfig tool, this may take a while...&quot; &amp;&amp; ldconfig || true
+
 install.man:
 
+uninstall:     uninstall.bin uninstall.lib uninstall.man
+
+uninstall.bin:
+
+uninstall.lib:
+	$(RM_FILE) $(DESTDIR)${libdir}/nx/$(LIBFULL)
+	$(RM_FILE) $(DESTDIR)${libdir}/nx/libXcompext.so.3
+	$(RM_FILE) $(DESTDIR)${libdir}/nx/libXcompext.so
+	$(RM_FILE) $(DESTDIR)${includedir}/nx/NXlib.h
+	$(RM_FILE) $(DESTDIR)${includedir}/nx/NXlibint.h
+	echo &quot;Running ldconfig tool, this may take a while...&quot; &amp;&amp; ldconfig || true
+
+uninstall.man:
+
 clean:
 		-rm -f *~ *.o *.bak *.orig *.rej st?????? core core.* *.out.* \
 		@ALL@
 
 distclean:	clean
-		-rm -rf autom4te.cache config.status config.log \
+		-rm -rf autom4te.cache config.status config.log configure \
 		config.cache depend.status Makefile tags
diff --git a/nxcompext/configure.in b/nxcompext/configure.in
index fe5abf7..08c48a7 100644
--- a/nxcompext/configure.in
+++ b/nxcompext/configure.in
@@ -7,8 +7,8 @@ AC_PREREQ(2.13)
 
 dnl Reset default compilation flags.
 
-CXXFLAGS=&quot;-O3&quot;
-CFLAGS=&quot;-O3&quot;
+CXXFLAGS=&quot;$CXXFLAGS -O3&quot;
+CFLAGS=&quot;$CFLAGS -O3&quot;
 
 dnl Reset default linking directives.
 
diff --git a/nxcompshad/Logger.h b/nxcompshad/Logger.h
index 94e4da8..2e6430b 100644
--- a/nxcompshad/Logger.h
+++ b/nxcompshad/Logger.h
@@ -18,8 +18,8 @@
 #ifndef Logger_H
 #define Logger_H
 
-#include &lt;errno.h&gt;
-#include &lt;stdarg.h&gt;
+#include &lt;cerrno&gt;
+#include &lt;cstdarg&gt;
 
 //
 // Error handling macros.
diff --git a/nxcompshad/Makefile.in b/nxcompshad/Makefile.in
index 1580a35..089a4f6 100644
--- a/nxcompshad/Makefile.in
+++ b/nxcompshad/Makefile.in
@@ -48,7 +48,7 @@ CCINCLUDES  =
 CCDEFINES   =
 
 LDFLAGS     = @LDFLAGS@
-LIBS        = @LIBS@ -L/usr/X11R6/lib -lX11
+LIBS        = @LIBS@ -lNX_X11
 
 #
 # Only if THREADS is defined.
@@ -74,10 +74,17 @@ exec_prefix = @exec_prefix@
 bindir      = @bindir@
 man1dir     = @mandir@/man1
 VPATH       = @srcdir@
+libdir      = @libdir@
+includedir  = @includedir@
 
 INSTALL         = @INSTALL@
+INSTALL_DIR     = $(INSTALL) -d -o root -g root -m 0755 
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA    = @INSTALL_DATA@
+INSTALL_LINK    = cp -av
+DESTDIR         =
+RM_FILE         = rm -f
+RM_DIR          = rmdir -p --ignore-fail-on-non-empty
 
 #
 # This should be autodetected.
@@ -132,7 +139,7 @@ all: depend $(LIBARCHIVE) $(LIBDLL)
 
 else
 
-EXTRALIBS = -lXtst -lXrandr -lXdamage
+EXTRALIBS = -lNX_Xtst -lNX_Xrandr -lNX_Xdamage
 
 all: depend $(LIBFULL) $(LIBLOAD) $(LIBSHARED) $(LIBARCHIVE)
 
@@ -162,7 +169,7 @@ $(LIBDLL): $(LIBARCHIVE)
 		-Wl,--enable-auto-import \
 		-Wl,--whole-archive ${LIBARCHIVE} \
 		-Wl,--no-whole-archive \
-		${LIBS} -L/usr/X11R6/lib
+		${LIBS}
 
 $(PROGRAM):	$(MOBJ) $(COBJ) $(CXXOBJ) $(LIBDLL)
 #		$(CC) $(CCFLAGS) -o $@ $(MOBJ) $(MLIBS)
@@ -178,15 +185,41 @@ depend.status:
 		fi
 		touch depend.status
 
-install:	install.bin install.man
+install:       install.bin install.lib install.man
 
 install.bin:
 
+install.lib: all
+	$(INSTALL_DIR)                          $(DESTDIR)${libdir}/nx
+	$(INSTALL_DIR)                          $(DESTDIR)${includedir}/nx
+	$(INSTALL_DATA) $(LIBFULL)              $(DESTDIR)${libdir}/nx
+	$(INSTALL_LINK) libXcompshad.so.3       $(DESTDIR)${libdir}/nx
+	$(INSTALL_LINK) libXcompshad.so         $(DESTDIR)${libdir}/nx
+	$(INSTALL_DATA) *.a                     $(DESTDIR)${libdir}/nx
+	$(INSTALL_DATA) *.h                     $(DESTDIR)${includedir}/nx
+	echo &quot;Running ldconfig tool, this may take a while...&quot; &amp;&amp; ldconfig || true
+
 install.man:
 
+uninstall:     uninstall.bin uninstall.lib uninstall.man
+
+uninstall.bin:
+
+uninstall.lib:
+	$(RM_FILE) $(DESTDIR)${libdir}/nx/$(LIBFULL)
+	$(RM_FILE) $(DESTDIR)${libdir}/nx/libXcompshad.so.3
+	$(RM_FILE) $(DESTDIR)${libdir}/nx/libXcompshad.so
+	$(RM_FILE) $(DESTDIR)${libdir}/nx/libXcompshad.a
+	for header in *.h; do $(RM_FILE) $(DESTDIR)${includedir}/nx/$$header; done
+	$(RM_DIR) $(DESTDIR)${libdir}/nx/
+	$(RM_DIR) $(DESTDIR)${includedir}/nx/
+	echo &quot;Running ldconfig tool, this may take a while...&quot; &amp;&amp; ldconfig || true
+
+uninstall.man:
+
 clean:
-		-rm -f *~ *.o *.bak st?????? core core.* *.out.* *.exe.stackdump \
+		-rm -f *~ *.o *.gch *.bak st?????? core core.* *.out.* *.exe.stackdump \
 		$(LIBFULL) $(LIBLOAD) $(LIBSHARED) $(LIBARCHIVE) $(LIBDLL) $(LIBDLLSTATIC) $(PROGRAM) $(PROGRAM).exe
 
 distclean:	clean
-		-rm -rf config.status config.log config.cache depend.status Makefile tags autom4te.cache
+		-rm -rf config.status config.log config.cache depend.status Makefile tags autom4te.cache configure 
diff --git a/nxcompshad/Misc.h b/nxcompshad/Misc.h
index 6dc8635..27f2670 100644
--- a/nxcompshad/Misc.h
+++ b/nxcompshad/Misc.h
@@ -20,8 +20,8 @@
 
 #include &lt;iostream&gt;
 
-#include &lt;errno.h&gt;
-#include &lt;string.h&gt;
+#include &lt;cerrno&gt;
+#include &lt;cstring&gt;
 
 using namespace std;
 
diff --git a/nxcompshad/configure.in b/nxcompshad/configure.in
index 3f16ee9..13149b3 100644
--- a/nxcompshad/configure.in
+++ b/nxcompshad/configure.in
@@ -7,8 +7,8 @@ AC_PREREQ(2.13)
 
 dnl Reset default compilation flags.
 
-CXXFLAGS=&quot;-O3&quot;
-CPPFLAGS=&quot;-O3&quot;
+CXXFLAGS=&quot;$CXXFLAGS -O3&quot;
+CPPFLAGS=&quot;$CPPFLAGS -O3&quot;
 
 dnl Reset default linking directives.
 
@@ -19,7 +19,7 @@ dnl Prefer headers and libraries from nx-X11, if present.
 
 if test -d &quot;../nx-X11/exports/include&quot; ; then
     CXXFLAGS=&quot;$CXXFLAGS -I../nx-X11/exports/include&quot;
-    LIBS=&quot;$LIBS -L../nx-X11/exports/lib&quot;
+    LIBS=&quot;-L../nx-X11/exports/lib&quot;
 fi
 
 dnl Check whether --with-ipaq was given.
diff --git a/nxproxy/Makefile.in b/nxproxy/Makefile.in
index 928e0d3..6fea52f 100644
--- a/nxproxy/Makefile.in
+++ b/nxproxy/Makefile.in
@@ -33,7 +33,7 @@ LIBS    = @LIBS@
 
 srcdir      = @srcdir@
 prefix      = @prefix@
-exec_prefix = @exec_prefix@
+exec_prefix = @exec_prefix@/lib/nx
 bindir      = @bindir@
 man1dir     = @mandir@/man1
 VPATH       = @srcdir@
@@ -41,6 +41,8 @@ VPATH       = @srcdir@
 INSTALL         = @INSTALL@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_DATA    = @INSTALL_DATA@
+DESTDIR         =
+RM_FILE         = rm -f
 
 #
 # This should be autodetected.
@@ -87,15 +89,24 @@ depend.status:
 install:	install.bin install.man
 
 install.bin:	$(PROGRAM)
-		$(srcdir)/mkinstalldirs $(bindir)
-		$(INSTALL) $(PROGRAM) $(bindir)/$(PROGRAM)
+		$(srcdir)/mkinstalldirs $(DESTDIR)$(bindir)
+		$(INSTALL_PROGRAM) $(PROGRAM) $(DESTDIR)$(bindir)/$(PROGRAM)
 
 install.man:
-		$(srcdir)/mkinstalldirs $(man1dir)
+		$(srcdir)/mkinstalldirs $(DESTDIR)$(man1dir)
+		$(INSTALL_DATA) man/$(PROGRAM).1 $(DESTDIR)$(man1dir)/$(PROGRAM).1
+
+uninstall:      uninstall.bin uninstall.man
+
+uninstall.bin:
+		$(RM_FILE) $(DESTDIR)$(bindir)/$(PROGRAM)
+
+uninstall.man:
+		$(RM_FILE) $(DESTDIR)$(man1dir)/nxproxy.1
 
 clean:
 		-rm -f *~ *.o *.bak st?????? core core.* *.out.* \
 		$(PROGRAM) $(PROGRAM).exe $(LIBFULL) $(LIBLOAD) $(LIBSHARED) $(LIBARCHIVE)
 
 distclean:	clean
-		-rm -f config.status config.log config.cache depend.status Makefile tags
+		-rm -rf autom4te.cache config.status config.log config.cache depend.status Makefile tags configure
diff --git a/nxproxy/configure.in b/nxproxy/configure.in
index bd930f1..b86828d 100644
--- a/nxproxy/configure.in
+++ b/nxproxy/configure.in
@@ -7,8 +7,8 @@ AC_PREREQ(2.13)
 
 dnl Reset default compilation flags.
 
-CXXFLAGS=&quot;-O3&quot;
-CPPFLAGS=&quot;-O3&quot;
+CXXFLAGS=&quot;$CXXFLAGS -O3&quot;
+CPPFLAGS=&quot;$CPPFLAGS -O3&quot;
 
 dnl Prefer headers and libraries from nx-X11 if present.
 


hooks/post-receive
-- 
nx-libs.git (NX (redistributed))

This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;nx-libs.git&quot; (NX (redistributed)).

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005217.html">[X2Go-Commits] nx-libs.git - master (branch) updated:	redist-client/3.5.0.18-5-ge77bf36
</A></li>
	<LI>Next message: <A HREF="005219.html">[X2Go-Commits] nx-libs.git - build-main (branch) updated:	redist-client/3.5.0.18-7-g436d067
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5218">[ date ]</a>
              <a href="thread.html#5218">[ thread ]</a>
              <a href="subject.html#5218">[ subject ]</a>
              <a href="author.html#5218">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/x2go-commits">More information about the X2Go-commits
mailing list</a><br>
</body></html>
