<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [X2go-Commits] x2goclient.git - build-main (branch) updated:	3.99.0.2-11-ge665a27
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/x2go-commits/2011-December/index.html" >
   <LINK REL="made" HREF="mailto:x2go-commits%40lists.berlios.de?Subject=Re%3A%20%5BX2go-Commits%5D%20x2goclient.git%20-%20build-main%20%28branch%29%20updated%3A%0A%093.99.0.2-11-ge665a27&In-Reply-To=%3C20111227140732.AE5555DB1F%40ymir%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002014.html">
   <LINK REL="Next"  HREF="002016.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[X2go-Commits] x2goclient.git - build-main (branch) updated:	3.99.0.2-11-ge665a27</H1>
    <B>X2go dev team</B> 
    <A HREF="mailto:x2go-commits%40lists.berlios.de?Subject=Re%3A%20%5BX2go-Commits%5D%20x2goclient.git%20-%20build-main%20%28branch%29%20updated%3A%0A%093.99.0.2-11-ge665a27&In-Reply-To=%3C20111227140732.AE5555DB1F%40ymir%3E"
       TITLE="[X2go-Commits] x2goclient.git - build-main (branch) updated:	3.99.0.2-11-ge665a27">git-admin at x2go.org
       </A><BR>
    <I>Tue Dec 27 15:07:32 CET 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="002014.html">[X2go-Commits] x2goclient.git - master (branch) updated:	3.99.0.2-11-ge665a27
</A></li>
        <LI>Next message: <A HREF="002016.html">[X2go-Commits] x2goclient.git - master (branch) updated:	3.99.0.2-12-ge3a8f0e
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2015">[ date ]</a>
              <a href="thread.html#2015">[ thread ]</a>
              <a href="subject.html#2015">[ subject ]</a>
              <a href="author.html#2015">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch, build-main has been updated
       via  e665a2710772436abba5f998250e6ba84b7d58ff (commit)
       via  7488eba9969da7250612c7767434dbab92682525 (commit)
       via  c357cafc82aae887c38aafa46288e3d3ed05050c (commit)
       via  3cc2704301afd08ed3202af04e12e92c85578b04 (commit)
       via  63121e5ae383ee304fdd93824fd9889d1975b330 (commit)
       via  58676ee2db55c815abb3f578bc04c12a49d3a613 (commit)
       via  d5dcd78237f7eca7d7ba73e2ed0cdce1b6d89fc9 (commit)
       via  14969ce19a2c10767a3759e3119ed40a6f990f6e (commit)
       via  a22d0649cb88fb83c833c3ba5fb1ee770888d3c0 (commit)
       via  d70895fcd1a0a69b9b382c624e49c8a28ed09e68 (commit)
       via  e1c182ae6ae9f2c9f0cafd358cd36237132ab225 (commit)
      from  f3e8850ff93d619ee8dff0251571193c760a0aea (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
-----------------------------------------------------------------------

Summary of changes:
 VERSION                            |    2 +-
 debian/changelog                   |   29 +-
 debian/control                     |   21 +-
 debian/copyright                   |    2 +-
 debian/menu                        |    2 +-
 desktop/x2goclient.desktop         |    2 +-
 object_script.npx2goplugin.Debug   |   58 ---
 object_script.npx2goplugin.Release |   58 ---
 object_script.x2goclient.Debug     |   64 ---
 object_script.x2goclient.Release   |   64 ---
 object_script.x2goplugin.Debug     |   57 ---
 object_script.x2goplugin.Release   |   57 ---
 onmainwindow.cpp                   |  502 ++++++++++----------
 onmainwindow.h                     |   36 +-
 onmainwindow_part2.cpp             |   18 +-
 onmainwindow_part3.cpp             |    3 +-
 onmainwindow_part4.cpp             |  266 ++++++++++-
 onmainwindow_privat.h              |    2 +
 sessionbutton.cpp                  |  116 +++--
 sessionbutton.h                    |  109 +++--
 sessionwidget.cpp                  |   12 +-
 sessionwidget.h                    |    1 +
 settingswidget.cpp                 |  925 ++++++++++++++++++++----------------
 settingswidget.h                   |   94 ++--
 sshmasterconnection.cpp            |   39 ++-
 sshmasterconnection.h              |   36 ++-
 version.h                          |    2 +-
 wapi.cpp                           |  727 ++++++++++++++++-------------
 wapi.h                             |   35 +-
 x2goclient.pro                     |    6 +-
 x2goplugin.rc                      |   10 +-
 31 files changed, 1808 insertions(+), 1547 deletions(-)
 delete mode 100644 object_script.npx2goplugin.Debug
 delete mode 100644 object_script.npx2goplugin.Release
 delete mode 100644 object_script.x2goclient.Debug
 delete mode 100644 object_script.x2goclient.Release
 delete mode 100644 object_script.x2goplugin.Debug
 delete mode 100644 object_script.x2goplugin.Release
 mode change 100644 =&gt; 100755 x2goclient.pro

The diff of changes is:
diff --git a/VERSION b/VERSION
index df56986..d2b4138 100644
--- a/VERSION
+++ b/VERSION
@@ -1 +1 @@
-3.99.0.2
+3.99.0.3
diff --git a/debian/changelog b/debian/changelog
index faba982..334348b 100644
--- a/debian/changelog
+++ b/debian/changelog
@@ -1,12 +1,31 @@
-x2goclient (3.99.0.2-0~x2go1) unstable; urgency=low
+x2goclient (3.99.0.3-0~x2go1) unstable; urgency=low
 
   [ Mike Gabriel ]
-  * New upstream version (3.99.0.2):
-    - Continue development...
+  * Rename icon title in /debian/menu file.
+  * Also split package dependencies for x2goplugin.
+
+  [ Guido G&#195;&#188;nther ]
+  * Split package dependencies for SSH server/client.
+
+  [ Oleksandr Shneyder ]
+  * New upstream version (3.99.0.3):
+    - LDAP: ssh port for every x2goserver can be specified in Server entry,
+      parameter &quot;l&quot;
+    - Change title of proxy window to session name
+    - Change icon of proxy window (only on Linux)
+    - Multi-display support: x2goclient can be configured to fit proxy window
+      on one of the existing displays.
+    - Multi-display support: support for xinerama (temporarily disabled--support
+      in x2goagent needed)
+
+ -- Mike Gabriel &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">mike.gabriel at das-netzwerkteam.de</A>&gt;  Tue, 27 Dec 2011 15:06:16 +0100
+
+x2goclient (3.99.0.2-0~x2go1) unstable; urgency=low
 
   [ Oleksandr Shneyder ]
-  * QTcpSocket working not correct with some Antiviral software ( for example Avast) under windows. Fixing this by replacing it with Winsocks
-  * Connectivity test dialog to use with a broker
+  * New upstream version (3.99.0.2):
+    - QTcpSocket working not correct with some Antiviral software ( for example Avast) under windows. Fixing this by replacing it with Winsocks
+    - Connectivity test dialog to use with a broker
 
  -- Mike Gabriel &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">mike.gabriel at das-netzwerkteam.de</A>&gt;  Fri, 25 Nov 2011 11:27:42 +0100
 
diff --git a/debian/control b/debian/control
index 155f5ad..6289bf6 100644
--- a/debian/control
+++ b/debian/control
@@ -23,13 +23,15 @@ Architecture: any
 Depends:
  ${shlibs:Depends},
  ${misc:Depends},
- ssh,
  libssh-4 (&gt;= 0.4.7),
+ openssh-client,
  nxproxy
+Recommends:
+ openssh-server
 Suggests:
  pinentry-x2go 
-Description: X2go Client application (Qt4)
- X2go is a serverbased computing environment with
+Description: X2Go Client application (Qt4)
+ X2Go is a serverbased computing environment with
     - session resuming
     - low bandwith support
     - LDAP support
@@ -37,7 +39,7 @@ Description: X2go Client application (Qt4)
     - audio support
     - authentication by smartcard and USB stick
  .
- x2goclient is a graphical client (Qt4) for the X2go system.
+ x2goclient is a graphical client (Qt4) for the X2Go system.
  You can use it to connect to running sessions and start new sessions. 
 
 Package: x2goplugin
@@ -45,9 +47,14 @@ Architecture: any
 Depends:
  ${shlibs:Depends},
  ${misc:Depends},
+ openssh-client,
  nxproxy
-Description: X2go Client (Qt4) as browser plugin
- X2go is a serverbased computing environment with
+Recommends:
+ openssh-server
+Suggests:
+ pinentry-x2go
+Description: X2Go Client (Qt4) as browser plugin
+ X2Go is a serverbased computing environment with
     - session resuming
     - low bandwith support
     - LDAP support
@@ -55,7 +62,7 @@ Description: X2go Client (Qt4) as browser plugin
     - audio support
     - authentication by smartcard and USB stick
  .
- x2goclient is a graphical client (qt4) for the x2go system.
+ x2goclient is a graphical client (qt4) for the X2Go system.
  You can use it to connect to running sessions and start new sessions. 
  .
  This package provides x2goclient as Mozilla plugin.
diff --git a/debian/copyright b/debian/copyright
index 47b11d5..a340aaf 100644
--- a/debian/copyright
+++ b/debian/copyright
@@ -1,6 +1,6 @@
 Upstream Author: Oleksandr Shneyder &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">oleksandr.shneyder at obviously-nice.de</A>&gt;
 
-Copyright (C) 2007-2011 X2go Project - <A HREF="http://wiki.x2go.org">http://wiki.x2go.org</A>
+Copyright (C) 2007-2011 X2Go Project - <A HREF="http://wiki.x2go.org">http://wiki.x2go.org</A>
 
 This program is free software; you can redistribute it and/or modify
 it under the terms of the GNU General Public License as published by
diff --git a/debian/menu b/debian/menu
index 2ce9d6c..128ca99 100644
--- a/debian/menu
+++ b/debian/menu
@@ -1,6 +1,6 @@
 ?package(x2goclient):\
 	needs=&quot;X11&quot;\
 	section=&quot;Applications/Network/Communication&quot;\
-	title=&quot;X2GO Client (Qt)&quot;\
+	title=&quot;X2Go Client (Qt)&quot;\
 	icon=&quot;/usr/share/x2goclient/icons/x2goclient.xpm&quot;\
 	command=&quot;/usr/bin/x2goclient&quot;
diff --git a/desktop/x2goclient.desktop b/desktop/x2goclient.desktop
index fbf9efb..918a344 100644
--- a/desktop/x2goclient.desktop
+++ b/desktop/x2goclient.desktop
@@ -1,6 +1,6 @@
 [Desktop Entry]
 Encoding=UTF-8
-Version=3.99.0.0
+Version=3.99.0.3
 Type=Application
 Name=X2Go Client
 Exec=/usr/bin/x2goclient
diff --git a/object_script.npx2goplugin.Debug b/object_script.npx2goplugin.Debug
deleted file mode 100644
index 2e85c85..0000000
--- a/object_script.npx2goplugin.Debug
+++ /dev/null
@@ -1,58 +0,0 @@
-INPUT(
-./debug/sharewidget.o
-./debug/settingswidget.o
-./debug/configwidget.o
-./debug/sessionwidget.o
-./debug/connectionwidget.o
-./debug/configdialog.o
-./debug/editconnectiondialog.o
-./debug/exportdialog.o
-./debug/imgframe.o
-./debug/LDAPSession.o
-./debug/onmainwindow.o
-./debug/sessionbutton.o
-./debug/sessionmanagedialog.o
-./debug/sshmasterconnection.o
-./debug/sshprocess.o
-./debug/SVGFrame.o
-./debug/userbutton.o
-./debug/x2gologdebug.o
-./debug/printprocess.o
-./debug/cupsprint.o
-./debug/cupsprintwidget.o
-./debug/cupsprintersettingsdialog.o
-./debug/printwidget.o
-./debug/printercmddialog.o
-./debug/printdialog.o
-./debug/wapi.o
-./debug/clicklineedit.o
-./debug/httpbrokerclient.o
-./debug/ongetpass.o
-./debug/x2gosettings.o
-./debug/qtbrowserplugin.o
-./debug/qtbrowserplugin_win.o
-./debug/moc_configdialog.o
-./debug/moc_editconnectiondialog.o
-./debug/moc_exportdialog.o
-./debug/moc_imgframe.o
-./debug/moc_onmainwindow.o
-./debug/moc_sessionbutton.o
-./debug/moc_sessionmanagedialog.o
-./debug/moc_sshmasterconnection.o
-./debug/moc_sshprocess.o
-./debug/moc_SVGFrame.o
-./debug/moc_userbutton.o
-./debug/moc_printprocess.o
-./debug/moc_cupsprintwidget.o
-./debug/moc_cupsprintersettingsdialog.o
-./debug/moc_printwidget.o
-./debug/moc_printercmddialog.o
-./debug/moc_printdialog.o
-./debug/moc_sessionwidget.o
-./debug/moc_connectionwidget.o
-./debug/moc_settingswidget.o
-./debug/moc_sharewidget.o
-./debug/moc_clicklineedit.o
-./debug/moc_httpbrokerclient.o
-./debug/qrc_resources.o
-);
diff --git a/object_script.npx2goplugin.Release b/object_script.npx2goplugin.Release
deleted file mode 100644
index 68a5ff0..0000000
--- a/object_script.npx2goplugin.Release
+++ /dev/null
@@ -1,58 +0,0 @@
-INPUT(
-./release/sharewidget.o
-./release/settingswidget.o
-./release/configwidget.o
-./release/sessionwidget.o
-./release/connectionwidget.o
-./release/configdialog.o
-./release/editconnectiondialog.o
-./release/exportdialog.o
-./release/imgframe.o
-./release/LDAPSession.o
-./release/onmainwindow.o
-./release/sessionbutton.o
-./release/sessionmanagedialog.o
-./release/sshmasterconnection.o
-./release/sshprocess.o
-./release/SVGFrame.o
-./release/userbutton.o
-./release/x2gologdebug.o
-./release/printprocess.o
-./release/cupsprint.o
-./release/cupsprintwidget.o
-./release/cupsprintersettingsdialog.o
-./release/printwidget.o
-./release/printercmddialog.o
-./release/printdialog.o
-./release/wapi.o
-./release/clicklineedit.o
-./release/httpbrokerclient.o
-./release/ongetpass.o
-./release/x2gosettings.o
-./release/qtbrowserplugin.o
-./release/qtbrowserplugin_win.o
-./release/moc_configdialog.o
-./release/moc_editconnectiondialog.o
-./release/moc_exportdialog.o
-./release/moc_imgframe.o
-./release/moc_onmainwindow.o
-./release/moc_sessionbutton.o
-./release/moc_sessionmanagedialog.o
-./release/moc_sshmasterconnection.o
-./release/moc_sshprocess.o
-./release/moc_SVGFrame.o
-./release/moc_userbutton.o
-./release/moc_printprocess.o
-./release/moc_cupsprintwidget.o
-./release/moc_cupsprintersettingsdialog.o
-./release/moc_printwidget.o
-./release/moc_printercmddialog.o
-./release/moc_printdialog.o
-./release/moc_sessionwidget.o
-./release/moc_connectionwidget.o
-./release/moc_settingswidget.o
-./release/moc_sharewidget.o
-./release/moc_clicklineedit.o
-./release/moc_httpbrokerclient.o
-./release/qrc_resources.o
-);
diff --git a/object_script.x2goclient.Debug b/object_script.x2goclient.Debug
deleted file mode 100644
index 8c972be..0000000
--- a/object_script.x2goclient.Debug
+++ /dev/null
@@ -1,64 +0,0 @@
-INPUT(
-./debug\sharewidget.o
-./debug\settingswidget.o
-./debug\configwidget.o
-./debug\sessionwidget.o
-./debug\connectionwidget.o
-./debug\configdialog.o
-./debug\editconnectiondialog.o
-./debug\exportdialog.o
-./debug\imgframe.o
-./debug\LDAPSession.o
-./debug\onmainwindow.o
-./debug\onmainwindow_part2.o
-./debug\onmainwindow_part3.o
-./debug\onmainwindow_part4.o
-./debug\sessionbutton.o
-./debug\sessionmanagedialog.o
-./debug\sshmasterconnection.o
-./debug\sshprocess.o
-./debug\SVGFrame.o
-./debug\userbutton.o
-./debug\x2gologdebug.o
-./debug\printprocess.o
-./debug\cupsprint.o
-./debug\cupsprintwidget.o
-./debug\cupsprintersettingsdialog.o
-./debug\printwidget.o
-./debug\printercmddialog.o
-./debug\printdialog.o
-./debug\wapi.o
-./debug\clicklineedit.o
-./debug\httpbrokerclient.o
-./debug\ongetpass.o
-./debug\x2gosettings.o
-./debug\brokerpassdlg.o
-./debug\xsettingswidget.o
-./debug\x2goclient.o
-./debug\moc_configdialog.o
-./debug\moc_editconnectiondialog.o
-./debug\moc_exportdialog.o
-./debug\moc_imgframe.o
-./debug\moc_onmainwindow.o
-./debug\moc_sessionbutton.o
-./debug\moc_sessionmanagedialog.o
-./debug\moc_sshmasterconnection.o
-./debug\moc_sshprocess.o
-./debug\moc_SVGFrame.o
-./debug\moc_userbutton.o
-./debug\moc_printprocess.o
-./debug\moc_cupsprintwidget.o
-./debug\moc_cupsprintersettingsdialog.o
-./debug\moc_printwidget.o
-./debug\moc_printercmddialog.o
-./debug\moc_printdialog.o
-./debug\moc_sessionwidget.o
-./debug\moc_connectionwidget.o
-./debug\moc_settingswidget.o
-./debug\moc_sharewidget.o
-./debug\moc_clicklineedit.o
-./debug\moc_httpbrokerclient.o
-./debug\moc_brokerpassdlg.o
-./debug\moc_xsettingswidget.o
-./debug\qrc_resources.o
-);
diff --git a/object_script.x2goclient.Release b/object_script.x2goclient.Release
deleted file mode 100644
index 74e0753..0000000
--- a/object_script.x2goclient.Release
+++ /dev/null
@@ -1,64 +0,0 @@
-INPUT(
-./release\sharewidget.o
-./release\settingswidget.o
-./release\configwidget.o
-./release\sessionwidget.o
-./release\connectionwidget.o
-./release\configdialog.o
-./release\editconnectiondialog.o
-./release\exportdialog.o
-./release\imgframe.o
-./release\LDAPSession.o
-./release\onmainwindow.o
-./release\onmainwindow_part2.o
-./release\onmainwindow_part3.o
-./release\onmainwindow_part4.o
-./release\sessionbutton.o
-./release\sessionmanagedialog.o
-./release\sshmasterconnection.o
-./release\sshprocess.o
-./release\SVGFrame.o
-./release\userbutton.o
-./release\x2gologdebug.o
-./release\printprocess.o
-./release\cupsprint.o
-./release\cupsprintwidget.o
-./release\cupsprintersettingsdialog.o
-./release\printwidget.o
-./release\printercmddialog.o
-./release\printdialog.o
-./release\wapi.o
-./release\clicklineedit.o
-./release\httpbrokerclient.o
-./release\ongetpass.o
-./release\x2gosettings.o
-./release\brokerpassdlg.o
-./release\xsettingswidget.o
-./release\x2goclient.o
-./release\moc_configdialog.o
-./release\moc_editconnectiondialog.o
-./release\moc_exportdialog.o
-./release\moc_imgframe.o
-./release\moc_onmainwindow.o
-./release\moc_sessionbutton.o
-./release\moc_sessionmanagedialog.o
-./release\moc_sshmasterconnection.o
-./release\moc_sshprocess.o
-./release\moc_SVGFrame.o
-./release\moc_userbutton.o
-./release\moc_printprocess.o
-./release\moc_cupsprintwidget.o
-./release\moc_cupsprintersettingsdialog.o
-./release\moc_printwidget.o
-./release\moc_printercmddialog.o
-./release\moc_printdialog.o
-./release\moc_sessionwidget.o
-./release\moc_connectionwidget.o
-./release\moc_settingswidget.o
-./release\moc_sharewidget.o
-./release\moc_clicklineedit.o
-./release\moc_httpbrokerclient.o
-./release\moc_brokerpassdlg.o
-./release\moc_xsettingswidget.o
-./release\qrc_resources.o
-);
diff --git a/object_script.x2goplugin.Debug b/object_script.x2goplugin.Debug
deleted file mode 100644
index af4d381..0000000
--- a/object_script.x2goplugin.Debug
+++ /dev/null
@@ -1,57 +0,0 @@
-INPUT(
-./debug/sharewidget.o
-./debug/settingswidget.o
-./debug/configwidget.o
-./debug/sessionwidget.o
-./debug/connectionwidget.o
-./debug/configdialog.o
-./debug/editconnectiondialog.o
-./debug/exportdialog.o
-./debug/imgframe.o
-./debug/LDAPSession.o
-./debug/onmainwindow.o
-./debug/sessionbutton.o
-./debug/sessionmanagedialog.o
-./debug/sshmasterconnection.o
-./debug/sshprocess.o
-./debug/SVGFrame.o
-./debug/userbutton.o
-./debug/x2gologdebug.o
-./debug/printprocess.o
-./debug/cupsprint.o
-./debug/cupsprintwidget.o
-./debug/cupsprintersettingsdialog.o
-./debug/printwidget.o
-./debug/printercmddialog.o
-./debug/printdialog.o
-./debug/embedwidget.o
-./debug/wapi.o
-./debug/clicklineedit.o
-./debug/httpbrokerclient.o
-./debug/ongetpass.o
-./debug/x2gosettings.o
-./debug/moc_configdialog.o
-./debug/moc_editconnectiondialog.o
-./debug/moc_exportdialog.o
-./debug/moc_imgframe.o
-./debug/moc_onmainwindow.o
-./debug/moc_sessionbutton.o
-./debug/moc_sessionmanagedialog.o
-./debug/moc_sshmasterconnection.o
-./debug/moc_sshprocess.o
-./debug/moc_SVGFrame.o
-./debug/moc_userbutton.o
-./debug/moc_printprocess.o
-./debug/moc_cupsprintwidget.o
-./debug/moc_cupsprintersettingsdialog.o
-./debug/moc_printwidget.o
-./debug/moc_printercmddialog.o
-./debug/moc_printdialog.o
-./debug/moc_sessionwidget.o
-./debug/moc_connectionwidget.o
-./debug/moc_settingswidget.o
-./debug/moc_sharewidget.o
-./debug/moc_clicklineedit.o
-./debug/moc_httpbrokerclient.o
-./debug/qrc_resources.o
-);
diff --git a/object_script.x2goplugin.Release b/object_script.x2goplugin.Release
deleted file mode 100644
index 39406a3..0000000
--- a/object_script.x2goplugin.Release
+++ /dev/null
@@ -1,57 +0,0 @@
-INPUT(
-./release/sharewidget.o
-./release/settingswidget.o
-./release/configwidget.o
-./release/sessionwidget.o
-./release/connectionwidget.o
-./release/configdialog.o
-./release/editconnectiondialog.o
-./release/exportdialog.o
-./release/imgframe.o
-./release/LDAPSession.o
-./release/onmainwindow.o
-./release/sessionbutton.o
-./release/sessionmanagedialog.o
-./release/sshmasterconnection.o
-./release/sshprocess.o
-./release/SVGFrame.o
-./release/userbutton.o
-./release/x2gologdebug.o
-./release/printprocess.o
-./release/cupsprint.o
-./release/cupsprintwidget.o
-./release/cupsprintersettingsdialog.o
-./release/printwidget.o
-./release/printercmddialog.o
-./release/printdialog.o
-./release/embedwidget.o
-./release/wapi.o
-./release/clicklineedit.o
-./release/httpbrokerclient.o
-./release/ongetpass.o
-./release/x2gosettings.o
-./release/moc_configdialog.o
-./release/moc_editconnectiondialog.o
-./release/moc_exportdialog.o
-./release/moc_imgframe.o
-./release/moc_onmainwindow.o
-./release/moc_sessionbutton.o
-./release/moc_sessionmanagedialog.o
-./release/moc_sshmasterconnection.o
-./release/moc_sshprocess.o
-./release/moc_SVGFrame.o
-./release/moc_userbutton.o
-./release/moc_printprocess.o
-./release/moc_cupsprintwidget.o
-./release/moc_cupsprintersettingsdialog.o
-./release/moc_printwidget.o
-./release/moc_printercmddialog.o
-./release/moc_printdialog.o
-./release/moc_sessionwidget.o
-./release/moc_connectionwidget.o
-./release/moc_settingswidget.o
-./release/moc_sharewidget.o
-./release/moc_clicklineedit.o
-./release/moc_httpbrokerclient.o
-./release/qrc_resources.o
-);
diff --git a/onmainwindow.cpp b/onmainwindow.cpp
index ecafee0..81dce94 100644
--- a/onmainwindow.cpp
+++ b/onmainwindow.cpp
@@ -45,6 +45,9 @@ QString ONMainWindow::u3Device;
 
 ONMainWindow::ONMainWindow ( QWidget *parent ) :QMainWindow ( parent )
 {
+#ifdef Q_OS_LINUX
+    image=shape=0;
+#endif
     x2goDebug&lt;&lt;&quot;ONMainWindow constructor&quot;&lt;&lt;endl;
     setFocusPolicy ( Qt::StrongFocus );
     installTranslator();
@@ -212,7 +215,7 @@ ONMainWindow::ONMainWindow ( QWidget *parent ) :QMainWindow ( parent )
         homeDir=portableDataPath;
         x2goDebug&lt;&lt;&quot;running in \&quot;portable\&quot; mode\n&quot;&lt;&lt;
         &quot;Data Dir is &quot;&lt;&lt;portableDataPath;
-	QTimer *timer = new QTimer(this);
+        QTimer *timer = new QTimer(this);
         connect(timer, SIGNAL(timeout()), this, SLOT(slotCheckPortableDir()));
         timer-&gt;start(1000);
     }
@@ -266,10 +269,10 @@ ONMainWindow::ONMainWindow ( QWidget *parent ) :QMainWindow ( parent )
 
 
 #ifndef Q_WS_HILDON
-    if(BGFile.size())
-       bgFrame=new SVGFrame ( ( QString ) BGFile,true,fr );
+    if (BGFile.size())
+        bgFrame=new SVGFrame ( ( QString ) BGFile,true,fr );
     else
-       bgFrame=new SVGFrame ( ( QString ) &quot;:/svg/bg.svg&quot;,true,fr );
+        bgFrame=new SVGFrame ( ( QString ) &quot;:/svg/bg.svg&quot;,true,fr );
 #else
     bgFrame=new SVGFrame ( ( QString ) &quot;:/svg/bg_hildon.svg&quot;,true,fr );
 #endif
@@ -324,18 +327,18 @@ ONMainWindow::ONMainWindow ( QWidget *parent ) :QMainWindow ( parent )
     act_set=new QAction (
         QIcon ( iconsPath ( &quot;/32x32/edit_settings.png&quot; ) ),
         tr ( &quot;&amp;Settings ...&quot; ),this );
-	
-    if(supportMenuFile!=QString::null)
+
+    if (supportMenuFile!=QString::null)
     {
         act_support=new QAction ( tr ( &quot;Support ...&quot; ),this );
         connect ( act_support,SIGNAL ( triggered ( bool ) ),this,
-              SLOT ( slotSupport() ) );
-      
+                  SLOT ( slotSupport() ) );
+
     }
-    
+
     act_abclient=new QAction ( QIcon ( &quot;:icons/32x32/x2goclient.png&quot; ),
                                tr ( &quot;About X2GO client&quot; ),this );
-			       
+
 
 
 
@@ -378,6 +381,8 @@ ONMainWindow::ONMainWindow ( QWidget *parent ) :QMainWindow ( parent )
 
 #endif
 
+
+
     mainL-&gt;setSpacing ( 0 );
     mainL-&gt;setMargin ( 0 );
     mainL-&gt;insertWidget ( 0, bgFrame );
@@ -386,26 +391,32 @@ ONMainWindow::ONMainWindow ( QWidget *parent ) :QMainWindow ( parent )
     connect ( fr,SIGNAL ( resized ( const QSize ) ),this,
               SLOT ( slotResize ( const QSize ) ) );
     slotResize ( fr-&gt;size() );
-    
-    if(brokerMode)
-    {
-          broker=new HttpBrokerClient ( this, &amp;config );
-    connect ( broker,SIGNAL ( haveSshKey ( QString ) ),this,
-              SLOT ( slotStartSshAgent ( QString ) ) );
-    connect ( broker,SIGNAL ( haveAgentInfo () ),this,
-              SLOT ( slotStartNewBrokerSession () ) );
-    connect ( broker,SIGNAL ( fatalHttpError() ),this,
-              SLOT ( close() ) );
-    connect ( broker,SIGNAL ( cmdReconnect() ),this,
-              SLOT ( slotReconnectSession() ) );
-    connect ( broker, SIGNAL ( authFailed()), this ,SLOT ( slotGetBrokerAuth()));
-    connect ( broker, SIGNAL( sessionsLoaded()), this, SLOT (slotReadSessions()));
-    connect ( broker, SIGNAL ( getSession(QString)), this, SLOT (slotGetBrokerSession(QString))); 
-    connect ( broker, SIGNAL ( passwordChanged(QString)), this, SLOT ( slotPassChanged(QString)));
-    
 
+    if (brokerMode)
+    {
+        broker=new HttpBrokerClient ( this, &amp;config );
+        connect ( broker,SIGNAL ( haveSshKey ( QString ) ),this,
+                  SLOT ( slotStartSshAgent ( QString ) ) );
+        connect ( broker,SIGNAL ( haveAgentInfo () ),this,
+                  SLOT ( slotStartNewBrokerSession () ) );
+        connect ( broker,SIGNAL ( fatalHttpError() ),this,
+                  SLOT ( close() ) );
+        connect ( broker,SIGNAL ( cmdReconnect() ),this,
+                  SLOT ( slotReconnectSession() ) );
+        connect ( broker, SIGNAL ( authFailed()), this ,SLOT ( slotGetBrokerAuth()));
+        connect ( broker, SIGNAL( sessionsLoaded()), this, SLOT (slotReadSessions()));
+        connect ( broker, SIGNAL ( getSession(QString)), this, SLOT (slotGetBrokerSession(QString)));
+        connect ( broker, SIGNAL ( passwordChanged(QString)), this, SLOT ( slotPassChanged(QString)));
     }
-    
+
+    proxyWinTimer=new QTimer ( this );
+    connect ( proxyWinTimer, SIGNAL ( timeout() ), this,
+              SLOT ( slotFindProxyWin() ) );
+
+    xineramaTimer=new QTimer (this);
+
+    connect( xineramaTimer, SIGNAL(timeout()), this, SLOT(slotConfigXinerama()));
+
     x2goDebug&lt;&lt;&quot;ONMainWindows constructor finished, home Directory is:&quot;&lt;&lt;homeDir&lt;&lt;endl;
 }
 
@@ -468,9 +479,6 @@ void ONMainWindow::initWidgetsEmbed()
 #ifndef Q_OS_WIN
     statusBar()-&gt;hide();
 #endif
-    proxyWinTimer=new QTimer ( this );
-    connect ( proxyWinTimer, SIGNAL ( timeout() ), this,
-              SLOT ( slotFindProxyWin() ) );
 
 
     act_shareFolder=new QAction ( QIcon ( &quot;:icons/32x32/file-open.png&quot; ),
@@ -664,39 +672,39 @@ void ONMainWindow::initWidgetsNormal()
     act_edit=new QAction ( QIcon ( iconsPath ( &quot;/32x32/edit.png&quot; ) ),
                            tr ( &quot;Session management...&quot; ),this );
     act_edit-&gt;setShortcut ( tr ( &quot;Ctrl+E&quot; ) );
-    
-    if(noSessionEdit)
+
+    if (noSessionEdit)
     {
-      act_edit-&gt;setEnabled(false);
-      act_new-&gt;setEnabled(false);
+        act_edit-&gt;setEnabled(false);
+        act_new-&gt;setEnabled(false);
     }
 
     act_sessicon=new QAction (
         QIcon ( iconsPath ( &quot;/32x32/create_file.png&quot; ) ),
         tr ( &quot;&amp;Create session icon on desktop...&quot; ),
         this );
-    if(brokerMode)
-      act_sessicon-&gt;setEnabled(false);
-    
-    if(changeBrokerPass)
-    {
-      act_changeBrokerPass=new QAction (
-        QIcon ( iconsPath ( &quot;/32x32/auth.png&quot; ) ),
-        tr ( &quot;&amp;Set broker password...&quot; ),
-        this );
-      connect ( act_changeBrokerPass,SIGNAL ( triggered(bool)),this,
-              SLOT ( slotChangeBrokerPass()) );
-	      act_changeBrokerPass-&gt;setEnabled(false);
+    if (brokerMode)
+        act_sessicon-&gt;setEnabled(false);
+
+    if (changeBrokerPass)
+    {
+        act_changeBrokerPass=new QAction (
+            QIcon ( iconsPath ( &quot;/32x32/auth.png&quot; ) ),
+            tr ( &quot;&amp;Set broker password...&quot; ),
+            this );
+        connect ( act_changeBrokerPass,SIGNAL ( triggered(bool)),this,
+                  SLOT ( slotChangeBrokerPass()) );
+        act_changeBrokerPass-&gt;setEnabled(false);
     }
-    
-    if(connTest)
+
+    if (connTest)
     {
-      act_testCon=new QAction (
-        QIcon ( iconsPath ( &quot;/32x32/contest.png&quot; ) ),
-        tr ( &quot;&amp;Connectivity test...&quot; ),
-        this );
-      connect ( act_testCon,SIGNAL ( triggered(bool)),this,
-              SLOT ( slotTestConnection()) );
+        act_testCon=new QAction (
+            QIcon ( iconsPath ( &quot;/32x32/contest.png&quot; ) ),
+            tr ( &quot;&amp;Connectivity test...&quot; ),
+            this );
+        connect ( act_testCon,SIGNAL ( triggered(bool)),this,
+                  SLOT ( slotTestConnection()) );
     }
 
 
@@ -720,7 +728,7 @@ void ONMainWindow::initWidgetsNormal()
               SLOT ( trayQuit()) ) ;
     connect ( act_tb,SIGNAL ( toggled ( bool ) ),this,
               SLOT ( displayToolBar ( bool ) ) );
-	      
+
     stb=addToolBar ( tr ( &quot;Show toolbar&quot; ) );
 
     QShortcut* ex=new QShortcut ( QKeySequence ( tr ( &quot;Ctrl+Q&quot;,&quot;exit&quot; ) ),
@@ -731,45 +739,45 @@ void ONMainWindow::initWidgetsNormal()
     {
         QMenu* menu_sess=menuBar()-&gt;addMenu ( tr ( &quot;&amp;Session&quot; ) );
         QMenu* menu_opts=menuBar()-&gt;addMenu ( tr ( &quot;&amp;Options&quot; ) );
-        if(!brokerMode)
+        if (!brokerMode)
         {
-        menu_sess-&gt;addAction ( act_new );
-        menu_sess-&gt;addAction ( act_edit );
+            menu_sess-&gt;addAction ( act_new );
+            menu_sess-&gt;addAction ( act_edit );
 #if (!defined Q_WS_HILDON) &amp;&amp; (!defined Q_OS_DARWIN)
-        if ( !portable )
-            menu_sess-&gt;addAction ( act_sessicon );
+            if ( !portable )
+                menu_sess-&gt;addAction ( act_sessicon );
 #endif
-        menu_sess-&gt;addSeparator();
-	}
+            menu_sess-&gt;addSeparator();
+        }
         menu_sess-&gt;addAction ( act_exit );
         menu_opts-&gt;addAction ( act_set );
         menu_opts-&gt;addAction ( act_tb );
-	if(changeBrokerPass)
-	  menu_opts-&gt;addAction(act_changeBrokerPass);
-	if(connTest)
-	  menu_opts-&gt;addAction(act_testCon);
+        if (changeBrokerPass)
+            menu_opts-&gt;addAction(act_changeBrokerPass);
+        if (connTest)
+            menu_opts-&gt;addAction(act_testCon);
 
         QMenu* menu_help=menuBar()-&gt;addMenu ( tr ( &quot;&amp;Help&quot; ) );
-	if(supportMenuFile!=QString::null)
-	    menu_help-&gt;addAction ( act_support );
+        if (supportMenuFile!=QString::null)
+            menu_help-&gt;addAction ( act_support );
         menu_help-&gt;addAction ( act_abclient );
         menu_help-&gt;addAction ( act_abqt );
 
-        if(!brokerMode)
-	{
-        stb-&gt;addAction ( act_new );
-        stb-&gt;addAction ( act_edit );
+        if (!brokerMode)
+        {
+            stb-&gt;addAction ( act_new );
+            stb-&gt;addAction ( act_edit );
 #if (!defined Q_WS_HILDON) &amp;&amp; (!defined Q_OS_DARWIN)
-        if ( !portable )
-            stb-&gt;addAction ( act_sessicon );
+            if ( !portable )
+                stb-&gt;addAction ( act_sessicon );
 #endif
-        stb-&gt;addSeparator();
-	}
+            stb-&gt;addSeparator();
+        }
         stb-&gt;addAction ( act_set );
-	if(changeBrokerPass)
-	  stb-&gt;addAction(act_changeBrokerPass);
-	if(connTest)
-	  stb-&gt;addAction(act_testCon);
+        if (changeBrokerPass)
+            stb-&gt;addAction(act_changeBrokerPass);
+        if (connTest)
+            stb-&gt;addAction(act_testCon);
 
         if ( !showToolBar )
             stb-&gt;hide();
@@ -793,117 +801,107 @@ void ONMainWindow::initWidgetsNormal()
     }
     else
     {
-      if(!brokerMode)
-        QTimer::singleShot ( 1, this, SLOT ( slotReadSessions() ) );
-      else
-      {
-	QTimer::singleShot(1, this,SLOT(slotGetBrokerAuth()));
-      }
-    }
-/*    QTimer* t=new QTimer ( this );
-    connect ( t,SIGNAL ( timeout() ),this,SLOT ( slotRereadUsers() ) );
-    t-&gt;start ( 20000 );
-*/
-#ifdef Q_OS_WIN
-    proxyWinTimer=new QTimer ( this );
-    connect ( proxyWinTimer, SIGNAL ( timeout() ), this,
-              SLOT ( slotFindProxyWin() ) );
-#endif
-
+        if (!brokerMode)
+            QTimer::singleShot ( 1, this, SLOT ( slotReadSessions() ) );
+        else
+        {
+            QTimer::singleShot(1, this,SLOT(slotGetBrokerAuth()));
+        }
+    }
 }
 
 
 
 void ONMainWindow::slotPassChanged(const QString&amp; result)
 {
-  
-  if(result==QString::null)
-  {
-    QMessageBox::critical(this, tr(&quot;Error&quot;),tr(&quot;Operation failed&quot;));
-  }
-  else
-  {    
-    QMessageBox::information(this, tr(&quot;Password changed&quot;),tr(&quot;Password changed&quot;));
-    config.brokerPass=result;
-  }
-  setEnabled(true);
-  
-  slotClosePass();
-  sessionStatusDlg-&gt;hide();
-  
+
+    if (result==QString::null)
+    {
+        QMessageBox::critical(this, tr(&quot;Error&quot;),tr(&quot;Operation failed&quot;));
+    }
+    else
+    {
+        QMessageBox::information(this, tr(&quot;Password changed&quot;),tr(&quot;Password changed&quot;));
+        config.brokerPass=result;
+    }
+    setEnabled(true);
+
+    slotClosePass();
+    sessionStatusDlg-&gt;hide();
+
 }
 
 void ONMainWindow::slotTestConnection()
 {
-  ConTest test( broker, config.brokerurl, this);
-  test.exec();
+    ConTest test( broker, config.brokerurl, this);
+    test.exec();
 }
 
 void ONMainWindow::slotChangeBrokerPass()
 {
-  x2goDebug&lt;&lt;&quot;change broker pass&quot;;
-  BrokerPassDlg passDlg;
-  if(passDlg.exec()!=QDialog::Accepted)
-    return;
-  if(passDlg.oldPass()!=config.brokerPass)
-  {
-    QMessageBox::critical(this,tr(&quot;Error&quot;),tr(&quot;Wrong password!&quot;));
+    x2goDebug&lt;&lt;&quot;change broker pass&quot;;
+    BrokerPassDlg passDlg;
+    if (passDlg.exec()!=QDialog::Accepted)
+        return;
+    if (passDlg.oldPass()!=config.brokerPass)
+    {
+        QMessageBox::critical(this,tr(&quot;Error&quot;),tr(&quot;Wrong password!&quot;));
+        return;
+    }
+    broker-&gt;changePassword(passDlg.newPass());
+    setStatStatus ( tr ( &quot;Connecting to broker&quot; ) );
+    stInfo-&gt;insertPlainText ( &quot;broker url: &quot;+config.brokerurl );
+    setEnabled ( false );
+    uname-&gt;hide();
+    u-&gt;hide();
     return;
-  }
-  broker-&gt;changePassword(passDlg.newPass());
-  setStatStatus ( tr ( &quot;Connecting to broker&quot; ) );
-  stInfo-&gt;insertPlainText ( &quot;broker url: &quot;+config.brokerurl );
-  setEnabled ( false );
-  uname-&gt;hide();
-  u-&gt;hide();
-  return;  
 }
 
 
 void ONMainWindow::slotCheckPortableDir()
 {
-  if(!QFile::exists(homeDir))
-  {
-    x2goDebug&lt;&lt;&quot;portable dir not exists, close&quot;;
-    close();
-  }
+    if (!QFile::exists(homeDir))
+    {
+        x2goDebug&lt;&lt;&quot;portable dir not exists, close&quot;;
+        close();
+    }
 }
 
 void ONMainWindow::slotGetBrokerAuth()
 {
-        pass-&gt;clear();
-	login-&gt;clear();
-	QString pixFile=&quot;:icons/128x128/x2gosession.png&quot;;
-	if(SPixFile!=QString::null)
-	  pixFile=SPixFile;
-	QPixmap pix(pixFile);
-	if ( !miniMode )
-        {
-	  fotoLabel-&gt;setPixmap (
-          pix.scaled ( 64,64,
+    pass-&gt;clear();
+    login-&gt;clear();
+    QString pixFile=&quot;:icons/128x128/x2gosession.png&quot;;
+    if (SPixFile!=QString::null)
+        pixFile=SPixFile;
+    QPixmap pix(pixFile);
+    if ( !miniMode )
+    {
+        fotoLabel-&gt;setPixmap (
+            pix.scaled ( 64,64,
                          Qt::IgnoreAspectRatio,
                          Qt::SmoothTransformation ) );
-          fotoLabel-&gt;setFixedSize ( 64,64 );
-        }
-        else
-        {
-           fotoLabel-&gt;setPixmap (
-               pix.scaled ( 48,48,
+        fotoLabel-&gt;setFixedSize ( 64,64 );
+    }
+    else
+    {
+        fotoLabel-&gt;setPixmap (
+            pix.scaled ( 48,48,
                          Qt::IgnoreAspectRatio,
                          Qt::SmoothTransformation ) );
-           fotoLabel-&gt;setFixedSize ( 48,48 );
-         }
-         users-&gt;hide();
-	 ln-&gt;hide();
-	 bgLay-&gt;insertStretch(3);
-         QString text=tr(&quot;&lt;b&gt;Authentication&lt;/b&gt;&quot;);
-	/* if(config.brokerName.length()&gt;0)
-	   text+=config.brokerName;
-	 else
-	   text+=config.brokerurl;*/
-         nameLabel-&gt;setText ( text );
-	 slotShowPassForm();
-	 config.brokerAuthenticated=false;
+        fotoLabel-&gt;setFixedSize ( 48,48 );
+    }
+    users-&gt;hide();
+    ln-&gt;hide();
+    bgLay-&gt;insertStretch(3);
+    QString text=tr(&quot;&lt;b&gt;Authentication&lt;/b&gt;&quot;);
+    /* if(config.brokerName.length()&gt;0)
+       text+=config.brokerName;
+     else
+       text+=config.brokerurl;*/
+    nameLabel-&gt;setText ( text );
+    slotShowPassForm();
+    config.brokerAuthenticated=false;
 }
 
 
@@ -1078,6 +1076,12 @@ void ONMainWindow::closeClient()
                                  QVariant ( isMaximized() ) );
         st.setting()-&gt;sync();
         x2goDebug&lt;&lt;&quot;done&quot;;
+#ifdef Q_OS_LINUX
+        if (image)
+            XFreePixmap(QX11Info::display(),image);
+        if (shape)
+            XFreePixmap(QX11Info::display(),shape);
+#endif
     }
     if ( nxproxy!=0l )
     {
@@ -1099,18 +1103,18 @@ void ONMainWindow::closeClient()
         sshConnection-&gt;wait ( 10000 );
         x2goDebug&lt;&lt;&quot;sshConnection is closed\n&quot;;
     }
-    if(useLdap)
+    if (useLdap)
     {
-      for(int i=0;i&lt;serverSshConnections.count();++i)
-      {
-	if(serverSshConnections[i])
-	{
-	  serverSshConnections[i]-&gt;disconnectSession();
-          x2goDebug&lt;&lt;&quot;waiting sshConnection to finish\n&quot;;
-          serverSshConnections[i]-&gt;wait ( 10000 );
-          x2goDebug&lt;&lt;&quot;sshConnection is closed\n&quot;;
-	}
-      }
+        for (int i=0;i&lt;serverSshConnections.count();++i)
+        {
+            if (serverSshConnections[i])
+            {
+                serverSshConnections[i]-&gt;disconnectSession();
+                x2goDebug&lt;&lt;&quot;waiting sshConnection to finish\n&quot;;
+                serverSshConnections[i]-&gt;wait ( 10000 );
+                x2goDebug&lt;&lt;&quot;sshConnection is closed\n&quot;;
+            }
+        }
     }
 
     /*	if ( tunnel!=0l )
@@ -1440,10 +1444,10 @@ void ONMainWindow::slotSelectedFromList ( UserButton* user )
 
 void ONMainWindow::slotClosePass()
 {
-    if(brokerMode)
+    if (brokerMode)
     {
-      if(!config.brokerAuthenticated)
-	close();
+        if (!config.brokerAuthenticated)
+            close();
     }
     passForm-&gt;hide();
     if ( !embedMode )
@@ -1460,11 +1464,11 @@ void ONMainWindow::slotClosePass()
         }
         else
         {
-	  if(lastSession)
-	  {
-            lastSession-&gt;show();
-            uname-&gt;setText ( lastSession-&gt;name() );
-	  }
+            if (lastSession)
+            {
+                lastSession-&gt;show();
+                uname-&gt;setText ( lastSession-&gt;name() );
+            }
         }
         uname-&gt;setEnabled ( true );
         u-&gt;setEnabled ( true );
@@ -1477,7 +1481,7 @@ void ONMainWindow::slotClosePass()
 
 void ONMainWindow::slotPassEnter()
 {
-      
+
     shadowSession=false;
 #if defined ( Q_OS_WIN ) || defined (Q_OS_DARWIN )
     QString disp=getXDisplay();
@@ -1503,6 +1507,7 @@ void ONMainWindow::slotPassEnter()
     list&lt;string&gt; attr;
     attr.push_back ( &quot;cn&quot; );
     attr.push_back ( &quot;serialNumber&quot; );
+    attr.push_back ( &quot;l&quot; );
     list&lt;LDAPStringEntry&gt; res;
     QString searchBase=&quot;ou=Servers,ou=ON,&quot;+ldapDn;
 
@@ -1541,11 +1546,17 @@ void ONMainWindow::slotPassEnter()
         serv server;
         server.name=LDAPSession::getStringAttrValues (
                         *it,&quot;cn&quot; ).front().c_str();
-        if ( !isFirstServerSet )
+
+        QString sPort=&quot;22&quot;;
+        list&lt;string&gt; sL=LDAPSession::getStringAttrValues (
+                            *it,&quot;l&quot; );
+        if ( sL.size() &gt;0 )
         {
-            isFirstServerSet=true;
-            firstServer=server.name;
+            sPort=sL.front().c_str();
         }
+        x2goDebug&lt;&lt;server.name&lt;&lt;&quot;: ssh port is &quot;&lt;&lt;sPort;
+
+
         QString sFactor=&quot;1&quot;;
         list&lt;string&gt; serialNumber=LDAPSession::getStringAttrValues (
                                       *it,&quot;serialNumber&quot; );
@@ -1556,7 +1567,14 @@ void ONMainWindow::slotPassEnter()
         x2goDebug&lt;&lt;server.name&lt;&lt;&quot;: factor is &quot;&lt;&lt;sFactor;
         server.factor=sFactor.toFloat();
         server.sess=0;
+        server.sshPort=sPort;
         server.connOk=true;
+        if ( !isFirstServerSet )
+        {
+            isFirstServerSet=true;
+            firstServer=server.name;
+            sshPort=server.sshPort;
+        }
         x2goServers.append ( server );
     }
     if ( ld )
@@ -1575,9 +1593,9 @@ void ONMainWindow::slotPassEnter()
 // 	QString host=ldapServer;
     QString host=firstServer;
     passwd=getCurrentPass();
-    if(sshConnection)
-      sshConnection-&gt;disconnectSession();
-    sshConnection=startSshConnection ( host,sshPort,acceptRsa,user,passwd,true );
+    if (sshConnection)
+        sshConnection-&gt;disconnectSession();
+    sshConnection=startSshConnection ( host,sshPort,acceptRsa,user,passwd,true, false );
 
 #endif
 }
@@ -1900,45 +1918,45 @@ void ONMainWindow::slotCreateDesktopIcon ( SessionButton* bt )
 
 void ONMainWindow::slotReadSessions()
 {
-  
+
     users-&gt;show();
     ln-&gt;show();
 
     X2goSettings *st;
     lastSession=0;
-    
-    if(brokerMode)
-    {
-      if(changeBrokerPass)
-	act_changeBrokerPass-&gt;setEnabled(true);
-      config.key=QString::null;
-      config.user=QString::null;
-      config.sessiondata=QString::null;
-      for (int i=sessions.count()-1;i&gt;=0;--i)
-      {
-        SessionButton* but=sessions.takeAt(i);
-	if(but)
-	   delete but;
-      }
-      
-      st=new X2goSettings(config.iniFile,QSettings::IniFormat);
-          sessionStatusDlg-&gt;hide();
-          selectSessionDlg-&gt;hide();
-          setEnabled ( true );
-	  slotClosePass();
+
+    if (brokerMode)
+    {
+        if (changeBrokerPass)
+            act_changeBrokerPass-&gt;setEnabled(true);
+        config.key=QString::null;
+        config.user=QString::null;
+        config.sessiondata=QString::null;
+        for (int i=sessions.count()-1;i&gt;=0;--i)
+        {
+            SessionButton* but=sessions.takeAt(i);
+            if (but)
+                delete but;
+        }
+
+        st=new X2goSettings(config.iniFile,QSettings::IniFormat);
+        sessionStatusDlg-&gt;hide();
+        selectSessionDlg-&gt;hide();
+        setEnabled ( true );
+        slotClosePass();
     }
     else
-      st= new X2goSettings( &quot;sessions&quot; );
+        st= new X2goSettings( &quot;sessions&quot; );
 
     QStringList slst=st-&gt;setting()-&gt;childGroups();
     x2goDebug&lt;&lt;&quot;read &quot;&lt;&lt;slst.size()&lt;&lt;&quot; sessions from config file&quot;;
-    if(brokerMode &amp;&amp; (slst.size()==0))
+    if (brokerMode &amp;&amp; (slst.size()==0))
     {
-      QMessageBox::critical(this,tr(&quot;Error&quot;),tr(&quot;X2Go sessions not found&quot;));
-      close();
+        QMessageBox::critical(this,tr(&quot;Error&quot;),tr(&quot;X2Go sessions not found&quot;));
+        close();
     }
     for ( int i=0;i&lt;slst.size();++i )
-    {      
+    {
         if ( slst[i]!=&quot;embedded&quot; )
             createBut ( slst[i] );
     }
@@ -2058,7 +2076,7 @@ void ONMainWindow::placeButtons()
         else
             sessions[i]-&gt;move ( ( users-&gt;width()-260 ) /2,
                                 i*155+i*20+5 );
-	if(brokerMode)
+        if (brokerMode)
             sessions[i]-&gt;move ( ( users-&gt;width()-360 ) /2,
                                 i*150+i*25+5 );
         sessions[i]-&gt;show();
@@ -2071,7 +2089,7 @@ void ONMainWindow::placeButtons()
         else
             uframe-&gt;setFixedHeight (
                 sessions.size() *155+ ( sessions.size()-1 ) *20 );
-	if(brokerMode)
+        if (brokerMode)
             uframe-&gt;setFixedHeight (
                 sessions.size() *150+ ( sessions.size()-1 ) *25 );
     }
@@ -2357,6 +2375,7 @@ void ONMainWindow::slotSelectedFromList ( SessionButton* session )
     QString server;
     QString userName;
     bool autologin=false;
+    bool krblogin=false;
     QString sessIcon;
     QPalette pal;
     QString sessionName;
@@ -2368,15 +2387,15 @@ void ONMainWindow::slotSelectedFromList ( SessionButton* session )
         sessionName=session-&gt;name();
 
         QString sid=session-&gt;id();
-        if(brokerMode)
+        if (brokerMode)
         {
-           broker-&gt;selectUserSession(session-&gt;id());
-           setStatStatus ( tr ( &quot;Connecting to broker&quot; ) );
-           stInfo-&gt;insertPlainText ( &quot;broker url: &quot;+config.brokerurl );
-           setEnabled ( false );
-	   uname-&gt;hide();
-	   u-&gt;hide();
-           return;
+            broker-&gt;selectUserSession(session-&gt;id());
+            setStatStatus ( tr ( &quot;Connecting to broker&quot; ) );
+            stInfo-&gt;insertPlainText ( &quot;broker url: &quot;+config.brokerurl );
+            setEnabled ( false );
+            uname-&gt;hide();
+            u-&gt;hide();
+            return;
         }
 
         X2goSettings st ( &quot;sessions&quot; );
@@ -2405,7 +2424,10 @@ void ONMainWindow::slotSelectedFromList ( SessionButton* session )
                        ( QVariant ) QString::null ).toString();
         autologin=st.setting()-&gt;value (
                       sid+&quot;/autologin&quot;,
-                      ( QVariant ) QString::null ).toBool();
+                      ( QVariant ) false ).toBool();
+        krblogin=st.setting()-&gt;value (
+                     sid+&quot;/krblogin&quot;,
+                     ( QVariant ) false ).toBool();
 #ifdef Q_OS_WIN
         if ( portable &amp;&amp;
                 u3Device.length() &gt;0 )
@@ -2508,7 +2530,7 @@ void ONMainWindow::slotSelectedFromList ( SessionButton* session )
         x2goDebug&lt;&lt;&quot;Have key, starting session&quot;&lt;&lt;endl;
         slotSessEnter();
     }
-    if ( cardReady ||/* useSshAgent ||*/ autologin )
+    if ( cardReady || autologin || krblogin )
     {
         nopass=true;
         if ( cardReady )
@@ -2532,13 +2554,13 @@ void ONMainWindow::slotSelectedFromList ( SessionButton* session )
 }
 
 
-SshMasterConnection* ONMainWindow::startSshConnection ( QString host, QString port, bool acceptUnknownHosts, 
-					QString login,
-                                        QString password, bool autologin, bool getSrv)
+SshMasterConnection* ONMainWindow::startSshConnection ( QString host, QString port, bool acceptUnknownHosts,
+        QString login,
+        QString password, bool autologin, bool krbLogin, bool getSrv)
 {
-    
+
     SshMasterConnection* con;
-    x2goDebug&lt;&lt;&quot;start new ssh connection&quot;&lt;&lt;endl;
+    x2goDebug&lt;&lt;&quot;start new ssh connection to server:&quot;&lt;&lt;host&lt;&lt;&quot;:&quot;&lt;&lt;port&lt;&lt;&quot;krb: &quot;&lt;&lt;krbLogin&lt;&lt;endl;
     for ( int i=0;i&lt;sshEnv.size();++i )
     {
 #ifndef Q_OS_WIN
@@ -2561,16 +2583,16 @@ SshMasterConnection* ONMainWindow::startSshConnection ( QString host, QString po
 
     passForm-&gt;setEnabled ( false );
     con=new SshMasterConnection ( host, port.toInt(),acceptUnknownHosts,
-                                            login, password,currentKey, autologin, this );
-    if(!getSrv)
-         connect ( con, SIGNAL ( connectionOk(QString) ), this, SLOT ( slotSshConnectionOk() ) );
+                                  login, password,currentKey, autologin,krbLogin, this );
+    if (!getSrv)
+        connect ( con, SIGNAL ( connectionOk(QString) ), this, SLOT ( slotSshConnectionOk() ) );
     else
-         connect ( con, SIGNAL ( connectionOk(QString)), this, SLOT ( slotServSshConnectionOk(QString) ) );
-    
+        connect ( con, SIGNAL ( connectionOk(QString)), this, SLOT ( slotServSshConnectionOk(QString) ) );
+
     connect ( con, SIGNAL ( serverAuthError ( int,QString ) ),this,SLOT ( slotSshServerAuthError ( int,QString ) ) );
     connect ( con, SIGNAL ( userAuthError ( QString ) ),this,SLOT ( slotSshUserAuthError ( QString ) ) );
-    connect ( con, SIGNAL ( connectionError ( QString,QString ) ), this, 
-	      SLOT ( slotSshConnectionError ( QString,QString ) ) );
+    connect ( con, SIGNAL ( connectionError ( QString,QString ) ), this,
+              SLOT ( slotSshConnectionError ( QString,QString ) ) );
     con-&gt;start();
     return con;
 }
diff --git a/onmainwindow.h b/onmainwindow.h
index 0fe58f7..4a41d58 100644
--- a/onmainwindow.h
+++ b/onmainwindow.h
@@ -115,6 +115,7 @@ struct serv
     {
         return it.sess&lt;it1.sess;
     }
+    QString sshPort;
 };
 
 struct x2goSession
@@ -145,7 +146,7 @@ struct ConfigFile
     QString brokerUserId;
     QString brokerName;
     bool brokerAuthenticated;
-    QString iniFile; 
+    QString iniFile;
     QString server;
     QString sshport;
     QString proxy;
@@ -413,10 +414,10 @@ public:
     }
     bool sessionEditEnabled()
     {
-      return !noSessionEdit;
+        return !noSessionEdit;
     }
-    
-    
+
+
     SshMasterConnection* findServerSshConnection(QString host);
 
     void showHelp();
@@ -576,6 +577,10 @@ private:
     QTimer *agentCheckTimer;
     QTimer *spoolTimer;
     QTimer *proxyWinTimer;
+    QTimer *xineramaTimer;
+    short xinSizeInc;
+    QRect lastDisplayGeometry;
+    QList &lt;QRect&gt; xineramaScreens;
     QStyle* widgetExtraStyle;
     bool isPassShown;
     bool xmodExecuted;
@@ -625,7 +630,7 @@ private:
     bool ldapOnly;
     bool isScDaemonOk;
     bool parecTunnelOk;
-    
+
 
     bool startSessSound;
     int startSessSndSystem;
@@ -644,7 +649,7 @@ private:
     int ldapPort2;
     QString ldapDn;
     QString sessionCmd;
-    
+
     QString supportMenuFile;
     QString BGFile;
     QString SPixFile;
@@ -726,6 +731,11 @@ private:
     QString xorgWidth;
     QString xorgHeight;
     int waitingForX;
+    QRect dispGeometry;
+#endif
+
+#ifdef Q_OS_LINUX
+    long image, shape;
 #endif
 
     // Tray icon stuff based on patch from Joachim Langenbach &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">joachim at falaba.de</A>&gt;
@@ -780,9 +790,12 @@ private:
     void closeClient();
     void continueNormalSession();
     void continueLDAPSession();
-    SshMasterConnection* startSshConnection ( QString host, QString port, 
-					      bool acceptUnknownHosts, QString login, 
-					      QString password, bool autologin, bool getSrv=false);
+    SshMasterConnection* startSshConnection ( QString host, QString port,
+            bool acceptUnknownHosts, QString login,
+            QString password, bool autologin, bool krbLogin, bool getSrv=false);
+    void setProxyWinTitle();
+    QRect proxyWinGeometry();
+
 
 protected:
     virtual void closeEvent ( QCloseEvent* event );
@@ -898,6 +911,7 @@ private slots:
 
 
 private slots:
+    void slotSetProxyWinFullscreen();
     void slotCheckPrintSpool();
     void slotRereadUsers();
     void slotExtTimer();
@@ -916,6 +930,8 @@ private slots:
     void slotExecXmodmap();
     void slotCreateSessionIcon();
     void slotFindProxyWin();
+    void slotConfigXinerama();
+    void slotXineramaConfigured();
     void slotAttachProxyWindow();
     void slotEmbedIntoParentWindow();
     void slotEmbedWindow();
@@ -933,7 +949,9 @@ private slots:
     void slotReconnectSession();
     void slotStartBroker();
     void slotStartNewBrokerSession ();
+
 private:
+    void resizeProxyWinOnDisplay(int display);
 #ifdef Q_OS_LINUX
     long X11FindWindow ( QString text, long rootWin=0 );
 #endif
diff --git a/onmainwindow_part2.cpp b/onmainwindow_part2.cpp
index ac5ecd4..aa98603 100644
--- a/onmainwindow_part2.cpp
+++ b/onmainwindow_part2.cpp
@@ -226,6 +226,7 @@ bool ONMainWindow::startSession ( const QString&amp; sid )
     QString user;
     QString host;
     bool autologin=false;
+    bool krblogin=false;
     user=getCurrentUname();
     runRemoteCommand=true;
     shadowSession=false;
@@ -247,7 +248,9 @@ bool ONMainWindow::startSession ( const QString&amp; sid )
         QString cmd=st.setting()-&gt;value ( sid+&quot;/command&quot;,
                                           ( QVariant ) QString::null ).toString();
         autologin=st.setting()-&gt;value ( sid+&quot;/autologin&quot;,
-                                        ( QVariant ) QString::null ).toBool();
+                                        ( QVariant ) false ).toBool();
+        krblogin=st.setting()-&gt;value ( sid+&quot;/krblogin&quot;,
+                                        ( QVariant ) false ).toBool();
         if ( cmd==&quot;SHADOW&quot; )
             shadowSession=true;
     }
@@ -273,7 +276,7 @@ bool ONMainWindow::startSession ( const QString&amp; sid )
     }
     if(sshConnection)
       sshConnection-&gt;disconnectSession();
-    sshConnection=startSshConnection ( host,sshPort,acceptRsa,user,passwd,autologin );
+    sshConnection=startSshConnection ( host,sshPort,acceptRsa,user,passwd,autologin, krblogin );
     return true;
 }
 
@@ -1920,10 +1923,11 @@ void ONMainWindow::slotTunnelOk()
 #endif //Q_OS_DARWIN
     x2goDebug&lt;&lt;&quot;starting nxproxy with: &quot;&lt;&lt;proxyCmd&lt;&lt;endl;
     nxproxy-&gt;start ( proxyCmd );
-
+//always search for proxyWin
+    proxyWinTimer-&gt;start ( 300 );
     if ( embedMode )
     {
-        proxyWinTimer-&gt;start ( 300 );
+//         proxyWinTimer-&gt;start ( 300 );
         if ( !startEmbedded )
         {
             act_embedContol-&gt;setText (
@@ -1934,10 +1938,10 @@ void ONMainWindow::slotTunnelOk()
     else
     {
 // #ifdef CFGCLIENT
-        // if using XMing, we must find proxy win for case, that we should make it fullscreen
-        if(useInternalX&amp;&amp; (internalX==XMING))
+//         // if using XMing, we must find proxy win for case, that we should make it fullscreen
+        //         if(useInternalX&amp;&amp; (internalX==XMING))
 // #endif
-        proxyWinTimer-&gt;start ( 300 );
+//         proxyWinTimer-&gt;start ( 300 );
     }
 #endif
 
diff --git a/onmainwindow_part3.cpp b/onmainwindow_part3.cpp
index 8fc3122..abd29f5 100644
--- a/onmainwindow_part3.cpp
+++ b/onmainwindow_part3.cpp
@@ -824,7 +824,8 @@ void ONMainWindow::slotGetServers ( bool result, QString output,
     for ( int j=0;j&lt;x2goServers.size();++j )
     {
         QString host=x2goServers[j].name;
-	serverSshConnections&lt;&lt;startSshConnection ( host,sshPort,acceptRsa,user,passwd,true,true);
+	sshPort=x2goServers[j].sshPort;
+	serverSshConnections&lt;&lt;startSshConnection ( host,sshPort,acceptRsa,user,passwd,true,false,true);
     }
 }
 
diff --git a/onmainwindow_part4.cpp b/onmainwindow_part4.cpp
index 76fd224..5d8eecd 100644
--- a/onmainwindow_part4.cpp
+++ b/onmainwindow_part4.cpp
@@ -246,32 +246,32 @@ bool ONMainWindow::isServerRunning ( int port )
     char* localIP;
     int iResult;
     WSADATA wsaData;
-    
+
     struct in_addr addr = { 0 };
-    
+
     iResult = WSAStartup(MAKEWORD(2, 2), &amp;wsaData);
-    if (iResult != 0) 
+    if (iResult != 0)
     {
         x2goDebug&lt;&lt;&quot;WARNING: WSAStartup failed: &quot;&lt;&lt; iResult&lt;&lt;endl;
         return false;
     }
-    
+
     addr.s_addr = inet_addr(&quot;127.0.0.1&quot;);
-    if (addr.s_addr == INADDR_NONE) 
+    if (addr.s_addr == INADDR_NONE)
     {
-            x2goDebug&lt;&lt; &quot;WARNING:  The IPv4 address entered must be a legal address\n&quot;;
-            return false;
+        x2goDebug&lt;&lt; &quot;WARNING:  The IPv4 address entered must be a legal address\n&quot;;
+        return false;
     }
-    
+
 
     localHost = gethostbyaddr((char*)&amp;addr,4, AF_INET);
-    if(!localHost)
+    if (!localHost)
     {
-      x2goDebug&lt;&lt;&quot;WARNING: gethostbyaddr failed: &quot;&lt;&lt;WSAGetLastError()&lt;&lt;endl;
-      return false;
+        x2goDebug&lt;&lt;&quot;WARNING: gethostbyaddr failed: &quot;&lt;&lt;WSAGetLastError()&lt;&lt;endl;
+        return false;
     }
     x2goDebug&lt;&lt;&quot;got localhost&quot;&lt;&lt;endl;
-    
+
     localIP = inet_ntoa (*(struct in_addr *)*localHost-&gt;h_addr_list);
 
     saServer.sin_family = AF_INET;
@@ -961,20 +961,254 @@ void ONMainWindow::startSshd()
 #endif
 }
 
+void ONMainWindow::setProxyWinTitle()
+{
+
+    QString title;
+
+    if (!useLdap)
+        title=lastSession-&gt;name();
+    else
+        title=getCurrentUname()+&quot;@&quot;+resumingSession.server;
+
+    QPixmap pixmap;
+
+    if (useLdap)
+        pixmap=lastUser-&gt;foto();
+    else
+        pixmap=*(lastSession-&gt;sessIcon());
+
+#ifdef Q_OS_LINUX
+
+    XStoreName(QX11Info::display(), proxyWinId, title.toLocal8Bit().data());
+
+    XWMHints* win_hints;
+
+
+    QByteArray bytes;
+    QBuffer buffer(&amp;bytes);
+    buffer.open(QIODevice::WriteOnly);
+    pixmap.save(&amp;buffer, &quot;XPM&quot;);
+
+
+    int rez;
+
+    if (image)
+        XFreePixmap(QX11Info::display(),image);
+    if (shape)
+        XFreePixmap(QX11Info::display(),shape);
+
+
+    rez=XpmCreatePixmapFromBuffer(QX11Info::display(), proxyWinId, bytes.data(),
+                                  (Pixmap *) &amp;image, (Pixmap *) &amp;shape, NULL);
+    if (!rez)
+    {
+
+        win_hints = XAllocWMHints();
+        if (win_hints)
+        {
+            win_hints-&gt;flags = IconPixmapHint|IconMaskHint;
+            win_hints-&gt;icon_pixmap = image;
+            win_hints-&gt;icon_mask = shape;
+            XSetWMHints(QX11Info::display(), proxyWinId, win_hints);
+            XFree(win_hints);
+        }
+    }
+
+#endif
+#ifdef Q_OS_WIN
+    wapiSetWindowText((HWND)proxyWinId, title);
+//       wapiSetWindowIcon((HWND)proxyWinId, pixmap);
+#endif
+}
+
+void ONMainWindow::slotSetProxyWinFullscreen()
+{
+
+#ifdef Q_OS_LINUX
+    XSync(QX11Info::display(),false);
+    XEvent event;
+    long emask = StructureNotifyMask | ResizeRedirectMask;
+    event.xclient.type = ClientMessage;
+    event.xclient.serial = 0;
+    event.xclient.send_event = True;
+    event.xclient.display = QX11Info::display();
+    event.xclient.window = proxyWinId;
+    event.xclient.message_type = XInternAtom(QX11Info::display(),&quot;_NET_WM_STATE&quot;,False);
+    event.xclient.format = 32;
+    event.xclient.data.l[0] = 1;
+    event.xclient.data.l[1] = XInternAtom(QX11Info::display(),&quot;_NET_WM_STATE_FULLSCREEN&quot;,False);
+    event.xclient.data.l[2] = 0;
+    event.xclient.data.l[3] = 0;
+    event.xclient.data.l[4] = 0;
+    Status st;
+    st=XSendEvent(QX11Info::display(), DefaultRootWindow(QX11Info::display()),
+                  False, emask,&amp;event);
+    XSync(QX11Info::display(),false);
+#endif
+#ifdef Q_OS_WIN
+    wapiSetFSWindow ( ( HWND ) proxyWinId,
+                      dispGeometry );
+
+#endif
+}
+
+
+void ONMainWindow::resizeProxyWinOnDisplay(int disp)
+{
+    QRect geom=QApplication::desktop()-&gt;screenGeometry(disp-1);
+    x2goDebug&lt;&lt;&quot;resizing proxy win to fit display &quot;&lt;&lt;disp&lt;&lt;&quot;(&quot;&lt;&lt;geom&lt;&lt;&quot;)&quot;&lt;&lt;endl;
+#ifdef Q_OS_LINUX
+    XSync(QX11Info::display(),false);
+    XMoveWindow(QX11Info::display(), proxyWinId,geom.x(),geom.y());
+#endif
+#ifdef Q_OS_WIN
+    dispGeometry=geom;
+#endif
+    QTimer::singleShot(500, this, SLOT(slotSetProxyWinFullscreen()));
+}
+
+
+QRect ONMainWindow::proxyWinGeometry()
+{
+#ifdef Q_OS_WIN
+    QRect proxyRect;
+    if (!wapiWindowRectWithoutDecoration((HWND)proxyWinId,proxyRect))
+        return QRect();
+    return proxyRect;
+#endif
+#ifdef Q_OS_LINUX
+    QRect proxyRect;
+    Window root;
+    int x,y;
+    uint w,h,border,depth;
+    if (XGetGeometry(QX11Info::display(), proxyWinId, &amp;root,&amp;x,&amp;y,&amp;w,&amp;h,&amp;border,&amp;depth))
+    {
+
+        int realx,realy;
+        Window child;
+        XTranslateCoordinates(QX11Info::display(), proxyWinId, root, 0, 0, &amp;realx, &amp;realy, &amp;child);
+        proxyRect.setRect(realx, realy, w,h);
+    }
+    return proxyRect;
+#endif
+    return QRect();
+}
+
+void ONMainWindow::slotConfigXinerama()
+{
+    QRect newGeometry=proxyWinGeometry();
+    if (newGeometry.isNull())
+    {
+//     x2goDebug&lt;&lt;&quot;error getting window geometry (window closed?)\n&quot;;
+        xineramaTimer-&gt;stop();
+        return;
+    }
+    if (newGeometry==lastDisplayGeometry)
+        return;
+    lastDisplayGeometry=newGeometry;
+   x2goDebug&lt;&lt;&quot;New proxy geometry: &quot;&lt;&lt;lastDisplayGeometry&lt;&lt;endl;
+    QDesktopWidget* root=QApplication::desktop();
+    QList&lt;QRect&gt; newXineramaScreens;
+    for (int i=0; i&lt; root-&gt;numScreens();++i)
+    {
+        QRect intersection=root-&gt;screenGeometry(i).intersected(lastDisplayGeometry);
+        if (!intersection.isNull())
+        {
+       x2goDebug&lt;&lt;&quot;intersected with &quot;&lt;&lt;i&lt;&lt;&quot;: &quot;&lt;&lt;intersection&lt;&lt;endl;
+            intersection.moveLeft(intersection.x()-lastDisplayGeometry.x());
+            intersection.moveTop(intersection.y()-lastDisplayGeometry.y());
+       x2goDebug&lt;&lt;&quot;xinerama screen: &quot;&lt;&lt;intersection&lt;&lt;endl;
+            newXineramaScreens&lt;&lt;intersection;
+        }
+    }
+    if (xineramaScreens != newXineramaScreens)
+    {
+        xineramaScreens=newXineramaScreens;
+        x2goDebug&lt;&lt;&quot;xinerama screen changed, new screens: &quot;&lt;&lt;xineramaScreens&lt;&lt;endl;
+        SshProcess* proc=new SshProcess(sshConnection, this);
+        xineramaTimer-&gt;stop();
+        connect (proc, SIGNAL(sshFinished(bool,QString,SshProcess*)), this, SLOT(slotXineramaConfigured()));
+        QStringList screens;
+        foreach (QRect disp, xineramaScreens)
+        screens&lt;&lt;QString::number(disp.x())+&quot; &quot;+QString::number(disp.y())+&quot; &quot;+QString::number(disp.width())+
+        &quot; &quot;+QString::number(disp.height());
+        QString cmd=&quot;export DISPLAY=:&quot;+resumingSession.display+&quot;;echo -e &quot;+screens.join(&quot;\\\\n&quot;)+&quot; &gt;  ~/.x2go/C-&quot;+
+                    resumingSession.sessionId+&quot;/xinerama.conf&quot;;
+
+        x2goDebug&lt;&lt;cmd&lt;&lt;endl;
+        proc-&gt;startNormal(cmd);
+    }
+}
+
+void ONMainWindow::slotXineramaConfigured()
+{
+    if (xinSizeInc == -1)
+        xinSizeInc=1;
+    else
+        xinSizeInc=-1;
+#ifdef Q_OS_LINUX
+    XSync(QX11Info::display(),false);
+    XResizeWindow(QX11Info::display(), proxyWinId,
+                  lastDisplayGeometry.width()+xinSizeInc,lastDisplayGeometry.height());
+    XSync(QX11Info::display(),false);
+    lastDisplayGeometry=proxyWinGeometry();
+#endif
+#ifdef Q_OS_WIN
+    QRect geom;
+    wapiWindowRect ( (HWND) proxyWinId, geom );
+    wapiMoveWindow( (HWND) proxyWinId, geom.x(), geom.y(), geom.width()+xinSizeInc, geom.height(),true);
+    lastDisplayGeometry=proxyWinGeometry();
+#endif
+    xineramaTimer-&gt;start(500);
+}
 
 void ONMainWindow::slotFindProxyWin()
 {
-    x2goDebug&lt;&lt;&quot;search proxy win: &quot;&lt;&lt;&quot;X2GO-&quot;+resumingSession.sessionId;
 #ifndef Q_OS_DARWIN
+    x2goDebug&lt;&lt;&quot;search proxy win: &quot;&lt;&lt;&quot;X2GO-&quot;+resumingSession.sessionId;
 
-//#ifdef CFGPLUGIN
     proxyWinId=findWindow ( &quot;X2GO-&quot;+resumingSession.sessionId );
-//#endif
-
     if ( proxyWinId )
     {
         x2goDebug&lt;&lt;&quot;proxy win found:&quot;&lt;&lt;proxyWinId;
+        setProxyWinTitle();
         proxyWinTimer-&gt;stop();
+        if (!useLdap)
+        {
+            X2goSettings *st;
+            QString sid;
+            if ( !embedMode )
+                sid=lastSession-&gt;id();
+            else
+                sid=&quot;embedded&quot;;
+
+            if (brokerMode)
+                st=new X2goSettings(config.iniFile,QSettings::IniFormat);
+            else
+                st= new X2goSettings( &quot;sessions&quot; );
+            uint displays=QApplication::desktop()-&gt;numScreens();
+            if (st-&gt;setting()-&gt;value ( sid+&quot;/xinerama&quot;,
+                                       ( QVariant ) false ).toBool())
+            {
+                x2goDebug&lt;&lt;&quot;Starting xinerama timer\n&quot;;
+                lastDisplayGeometry=QRect();
+                xineramaScreens.clear();
+                xineramaTimer-&gt;start(500);
+            }
+            if (st-&gt;setting()-&gt;value ( sid+&quot;/multidisp&quot;,
+                                       ( QVariant ) false ).toBool())
+            {
+                uint disp=st-&gt;setting()-&gt;value ( sid+&quot;/display&quot;,
+                                                 ( QVariant ) 1 ).toUInt();
+                if (disp&gt;displays)
+                {
+                    disp=1;
+                }
+                resizeProxyWinOnDisplay(disp);
+                return;
+            }
+        }
         if ( embedMode )
         {
             if ( config.rootless )
diff --git a/onmainwindow_privat.h b/onmainwindow_privat.h
index a97e961..98cef6e 100644
--- a/onmainwindow_privat.h
+++ b/onmainwindow_privat.h
@@ -82,6 +82,8 @@
 #if !defined Q_OS_WIN
 #include &lt;sys/mount.h&gt;
 #ifdef Q_OS_LINUX
+#include &lt;X11/Xatom.h&gt;
+#include &lt;X11/xpm.h&gt;
 #include &lt;linux/fs.h&gt;
 #endif // Q_OS_LINUX
 #endif // !defined Q_OS_WIN
diff --git a/sessionbutton.cpp b/sessionbutton.cpp
index c5ec122..e4ad225 100644
--- a/sessionbutton.cpp
+++ b/sessionbutton.cpp
@@ -24,6 +24,8 @@
 #include &lt;QPushButton&gt;
 #include &quot;onmainwindow.h&quot;
 #include &quot;x2gologdebug.h&quot;
+#include &lt;QApplication&gt;
+#include &lt;QDesktopWidget&gt;
 
 
 SessionButton::SessionButton ( ONMainWindow* mw,QWidget *parent, QString id )
@@ -143,7 +145,7 @@ SessionButton::SessionButton ( ONMainWindow* mw,QWidget *parent, QString id )
     if ( !miniMode )
     {
         sessName-&gt;move ( 80,34 );
-	sessStatus-&gt;move(80,50);
+        sessStatus-&gt;move(80,50);
         editBut-&gt;move ( 307,156 );
         serverIcon-&gt;move ( 58,84 );
         server-&gt;move ( 80,84 );
@@ -160,7 +162,7 @@ SessionButton::SessionButton ( ONMainWindow* mw,QWidget *parent, QString id )
     {
         editBut-&gt;move ( 218,113 );
         sessName-&gt;move ( 64,11 );
-	sessStatus-&gt;hide();
+        sessStatus-&gt;hide();
         serverIcon-&gt;move ( 66,44 );
         server-&gt;move ( 88,44 );
         cmdIcon-&gt;move ( 66,68 );
@@ -172,13 +174,13 @@ SessionButton::SessionButton ( ONMainWindow* mw,QWidget *parent, QString id )
         soundIcon-&gt;move ( 66,116 );
         sound-&gt;move ( 86,116 );
     }
-    
-    if(mw-&gt;brokerMode)
+
+    if (mw-&gt;brokerMode)
     {
-      icon-&gt;move(10,30);
-      sessName-&gt;move(90,50);
-      sessStatus-&gt;move(90,70);
-      setFixedHeight(120);
+        icon-&gt;move(10,30);
+        sessName-&gt;move(90,50);
+        sessStatus-&gt;move(90,70);
+        setFixedHeight(120);
     }
 
 
@@ -219,16 +221,16 @@ SessionButton::SessionButton ( ONMainWindow* mw,QWidget *parent, QString id )
         sessMenu-&gt;hide();
         sound-&gt;setEnabled(false);
     }
-    if(mw-&gt;brokerMode)
+    if (mw-&gt;brokerMode)
     {
-      cmd-&gt;hide();
-      cmdIcon-&gt;hide();
-      server-&gt;hide();
-      serverIcon-&gt;hide();
-      geom-&gt;hide();
-      geomIcon-&gt;hide();
-      sound-&gt;hide();
-      soundIcon-&gt;hide();
+        cmd-&gt;hide();
+        cmdIcon-&gt;hide();
+        server-&gt;hide();
+        serverIcon-&gt;hide();
+        geom-&gt;hide();
+        geomIcon-&gt;hide();
+        sound-&gt;hide();
+        soundIcon-&gt;hide();
     }
 }
 
@@ -381,6 +383,11 @@ void SessionButton::redraw()
 
     geomBox-&gt;clear();
     geomBox-&gt;addItem ( tr ( &quot;fullscreen&quot; ) );
+    uint displays=QApplication::desktop()-&gt;numScreens();
+    for (uint i=0;i&lt;displays;++i)
+    {
+        geomBox-&gt;addItem ( tr( &quot;Display &quot; )+QString::number(i+1));
+    }
 #ifndef Q_WS_HILDON
     geomBox-&gt;addItem ( &quot;1440x900&quot; );
     geomBox-&gt;addItem ( &quot;1280x1024&quot; );
@@ -395,21 +402,42 @@ void SessionButton::redraw()
         geom-&gt;setText ( tr ( &quot;fullscreen&quot; ) );
     }
     else
-    {
+        if (st-&gt;setting()-&gt;value ( sid+&quot;/multidisp&quot;,
+                                   ( QVariant ) false ).toBool())
+        {
+            uint disp=st-&gt;setting()-&gt;value ( sid+&quot;/display&quot;,
+                                             ( QVariant ) 1 ).toUInt();
+            if (disp&lt;=displays)
+            {
+                geom-&gt;setText( tr( &quot;Display &quot; )+QString::number(disp));
+            }
+            else
+            {
+                geom-&gt;setText( tr( &quot;Display &quot; )+QString::number(1));
+            }
+            for (int i=0;i&lt;geomBox-&gt;count();++i)
+                if (geomBox-&gt;itemText(i)==geom-&gt;text())
+                {
+                    geomBox-&gt;setCurrentIndex(i);
+                    break;
+                }
+        }
+        else
+        {
 #ifndef	Q_WS_HILDON
-        QString g=QString::number ( st-&gt;setting()-&gt;value (
-                                        sid+&quot;/width&quot; ).toInt() );
-        g+=&quot;x&quot;+QString::number ( st-&gt;setting()-&gt;value (
-                                     sid+&quot;/height&quot; ).toInt() );
-        geom-&gt;setText ( g );
-        if ( geomBox-&gt;findText ( g ) ==-1 )
-            geomBox-&gt;addItem ( g );
-        geomBox-&gt;setCurrentIndex ( geomBox-&gt;findText ( g ) );
+            QString g=QString::number ( st-&gt;setting()-&gt;value (
+                                            sid+&quot;/width&quot; ).toInt() );
+            g+=&quot;x&quot;+QString::number ( st-&gt;setting()-&gt;value (
+                                         sid+&quot;/height&quot; ).toInt() );
+            geom-&gt;setText ( g );
+            if ( geomBox-&gt;findText ( g ) ==-1 )
+                geomBox-&gt;addItem ( g );
+            geomBox-&gt;setCurrentIndex ( geomBox-&gt;findText ( g ) );
 #else
-        geom-&gt;setText ( tr ( &quot;window&quot; ) );
-        geomBox-&gt;setCurrentIndex ( 1 );
+            geom-&gt;setText ( tr ( &quot;window&quot; ) );
+            geomBox-&gt;setCurrentIndex ( 1 );
 #endif
-    }
+        }
 
 
     snd=st-&gt;setting()-&gt;value ( sid+&quot;/sound&quot;, ( QVariant ) true ).toBool();
@@ -633,19 +661,31 @@ void SessionButton::slot_geom_change ( const QString&amp; new_g )
     geom-&gt;setText ( new_g );
     X2goSettings st ( &quot;sessions&quot; );
     if ( new_g==tr ( &quot;fullscreen&quot; ) )
+    {
         st.setting()-&gt;setValue ( sid+&quot;/fullscreen&quot;, ( QVariant ) true );
+        st.setting()-&gt;setValue ( sid+&quot;/multidisp&quot;, ( QVariant ) false );
+    }
     else
-    {
-        QString new_geom=new_g;
+        if (new_g.indexOf(tr(&quot;Display &quot;))==0)
+        {
+            QString g= new_g;
+            g.replace(tr(&quot;Display &quot;),&quot;&quot;);
+            st.setting()-&gt;setValue ( sid+&quot;/multidisp&quot;, ( QVariant ) true );
+            st.setting()-&gt;setValue ( sid+&quot;/display&quot;, ( QVariant ) g.toUInt());
+            st.setting()-&gt;setValue ( sid+&quot;/fullscreen&quot;, ( QVariant ) false );
+        }
+        else
+        {
+            QString new_geom=new_g;
 #ifdef Q_WS_HILDON
-        new_geom=&quot;800x600&quot;;
+            new_geom=&quot;800x600&quot;;
 #endif
-        st.setting()-&gt;setValue ( sid+&quot;/fullscreen&quot;,
-                                 ( QVariant ) false );
-        QStringList lst=new_geom.split ( 'x' );
-        st.setting()-&gt;setValue ( sid+&quot;/width&quot;, ( QVariant ) lst[0] );
-        st.setting()-&gt;setValue ( sid+&quot;/height&quot;, ( QVariant ) lst[1] );
-    }
+            st.setting()-&gt;setValue ( sid+&quot;/fullscreen&quot;, ( QVariant ) false );
+            st.setting()-&gt;setValue ( sid+&quot;/multidisp&quot;, ( QVariant ) false );
+            QStringList lst=new_geom.split ( 'x' );
+            st.setting()-&gt;setValue ( sid+&quot;/width&quot;, ( QVariant ) lst[0] );
+            st.setting()-&gt;setValue ( sid+&quot;/height&quot;, ( QVariant ) lst[1] );
+        }
     st.setting()-&gt;sync();
 }
 
diff --git a/sessionbutton.h b/sessionbutton.h
index b39bdb5..cad3770 100644
--- a/sessionbutton.h
+++ b/sessionbutton.h
@@ -14,8 +14,8 @@
 
 #include &quot;SVGFrame.h&quot;
 #include &lt;QPushButton&gt;
+#include &lt;QLabel&gt;
 class ONMainWindow;
-class QLabel;
 class QComboBox;
 class QPushButton;
 
@@ -24,58 +24,63 @@ class QPushButton;
 */
 class SessionButton : public SVGFrame
 {
-		Q_OBJECT
-	public:
-		enum {KDE,GNOME,LXDE,RDP,XDMCP,SHADOW,OTHER,APPLICATION};
-		SessionButton ( ONMainWindow* mw, QWidget* parent,QString id );
-		~SessionButton();
-		QString id() {  return sid; }
-		void redraw();
-		static bool lessThen ( const SessionButton* b1, const SessionButton* b2 );
-		QString name();
-	private:
-		QString sid;
-		QLabel* sessName;
-		QLabel* sessStatus;
-		QLabel* icon;
-		QComboBox* cmdBox;
-		QLabel* cmd;
-		QLabel* serverIcon;
-		QLabel* geomIcon;
-		QLabel* cmdIcon;
-		QLabel* server;
-		QPushButton* editBut;
-		QLabel* geom;
-		QMenu* sessMenu;
-		QComboBox* geomBox;
-		QPushButton* sound;
-		QLabel* soundIcon;
-		ONMainWindow* par;
-		QAction* act_edit;
-		QAction* act_createIcon;
-		QAction* act_remove;
-		bool rootless;
-		bool editable;
+    Q_OBJECT
+public:
+    enum {KDE,GNOME,LXDE,RDP,XDMCP,SHADOW,OTHER,APPLICATION};
+    SessionButton ( ONMainWindow* mw, QWidget* parent,QString id );
+    ~SessionButton();
+    QString id() {
+        return sid;
+    }
+    void redraw();
+    const QPixmap* sessIcon() {
+        return icon-&gt;pixmap();
+    }
+    static bool lessThen ( const SessionButton* b1, const SessionButton* b2 );
+    QString name();
+private:
+    QString sid;
+    QLabel* sessName;
+    QLabel* sessStatus;
+    QLabel* icon;
+    QComboBox* cmdBox;
+    QLabel* cmd;
+    QLabel* serverIcon;
+    QLabel* geomIcon;
+    QLabel* cmdIcon;
+    QLabel* server;
+    QPushButton* editBut;
+    QLabel* geom;
+    QMenu* sessMenu;
+    QComboBox* geomBox;
+    QPushButton* sound;
+    QLabel* soundIcon;
+    ONMainWindow* par;
+    QAction* act_edit;
+    QAction* act_createIcon;
+    QAction* act_remove;
+    bool rootless;
+    bool editable;
 
-	private slots:
-		void slotClicked();
-		void slotEdit();
-		void slot_soundClicked();
-		void slot_cmd_change ( const QString&amp; command );
-		void slot_geom_change ( const QString&amp; new_g );
-		void slotRemove();
-		void slotMenuHide();
-		void slotShowMenu();
-		void slotCreateSessionIcon();
-	signals:
-		void sessionSelected ( SessionButton* );
-		void signal_edit ( SessionButton* );
-		void signal_remove ( SessionButton* );
-		void clicked();
-	protected:
-		virtual void mouseMoveEvent ( QMouseEvent * event );
-		virtual void mousePressEvent ( QMouseEvent * event );
-		virtual void mouseReleaseEvent ( QMouseEvent * event );
+private slots:
+    void slotClicked();
+    void slotEdit();
+    void slot_soundClicked();
+    void slot_cmd_change ( const QString&amp; command );
+    void slot_geom_change ( const QString&amp; new_g );
+    void slotRemove();
+    void slotMenuHide();
+    void slotShowMenu();
+    void slotCreateSessionIcon();
+signals:
+    void sessionSelected ( SessionButton* );
+    void signal_edit ( SessionButton* );
+    void signal_remove ( SessionButton* );
+    void clicked();
+protected:
+    virtual void mouseMoveEvent ( QMouseEvent * event );
+    virtual void mousePressEvent ( QMouseEvent * event );
+    virtual void mouseReleaseEvent ( QMouseEvent * event );
 };
 
 #endif
diff --git a/sessionwidget.cpp b/sessionwidget.cpp
index 9faae9a..4a9603c 100644
--- a/sessionwidget.cpp
+++ b/sessionwidget.cpp
@@ -105,7 +105,9 @@ SessionWidget::SessionWidget ( QString id, ONMainWindow * mw,
     sgbLay-&gt;addLayout ( suLay );
     sgbLay-&gt;addLayout ( keyLay );
     cbAutoLogin=new QCheckBox(tr(&quot;Try auto login (ssh-agent or default ssh key)&quot;),sgb);
+    cbKrbLogin=new QCheckBox(tr(&quot;Kerberos 5 (GSSAPI) authentication&quot;),sgb);
     sgbLay-&gt;addWidget(cbAutoLogin);
+    sgbLay-&gt;addWidget(cbKrbLogin);
 
 #ifndef Q_WS_HILDON
     QGroupBox *deskSess=new QGroupBox ( tr ( &quot;&amp;Session type&quot; ),this );
@@ -178,6 +180,8 @@ SessionWidget::SessionWidget ( QString id, ONMainWindow * mw,
     connect ( sessName,SIGNAL ( textChanged ( const QString &amp; ) ),this,
               SIGNAL ( nameChanged ( const QString &amp; ) ) );
     readConfig();
+    cbKrbLogin-&gt;setChecked(false);
+    cbKrbLogin-&gt;setVisible(false);
 }
 
 SessionWidget::~SessionWidget()
@@ -320,7 +324,10 @@ void SessionWidget::readConfig()
                        ( QVariant ) QString::null ).toString() );
     cbAutoLogin-&gt;setChecked(st.setting()-&gt;value (
                                 sessionId+&quot;/autologin&quot;,
-                                ( QVariant ) QString::null ).toBool());
+                                ( QVariant ) false ).toBool());
+    cbKrbLogin-&gt;setChecked(st.setting()-&gt;value (
+                                sessionId+&quot;/krblogin&quot;,
+                                ( QVariant ) false ).toBool());
     sshPort-&gt;setValue (
         st.setting()-&gt;value (
             sessionId+&quot;/sshport&quot;,
@@ -416,7 +423,9 @@ void SessionWidget::setDefaults()
     cmdCombo-&gt;addItem ( &quot;&quot; );
     cmdCombo-&gt;addItems ( mainWindow-&gt;transApplicationsNames() );
     cbAutoLogin-&gt;setChecked(false);
+    cbKrbLogin-&gt;setChecked(false);
     cmdCombo-&gt;lineEdit()-&gt;setText (
+    
         tr ( &quot;Path to executable&quot; ) );
     cmdCombo-&gt;lineEdit()-&gt;selectAll();
     slot_changeCmd ( 0 );
@@ -446,6 +455,7 @@ void SessionWidget::saveSettings()
     st.setting()-&gt;setValue ( sessionId+&quot;/sshport&quot;,
                              ( QVariant ) sshPort-&gt;value() );
     st.setting()-&gt;setValue(sessionId+&quot;/autologin&quot;,( QVariant ) cbAutoLogin-&gt;isChecked());
+    st.setting()-&gt;setValue(sessionId+&quot;/krblogin&quot;,( QVariant ) cbKrbLogin-&gt;isChecked());
     QString command;
     bool rootless=false;
 
diff --git a/sessionwidget.h b/sessionwidget.h
index 9cf8af0..27767d2 100644
--- a/sessionwidget.h
+++ b/sessionwidget.h
@@ -47,6 +47,7 @@ class SessionWidget : public ConfigWidget
 		QSpinBox* sshPort;
 		QLineEdit* key;
 		QCheckBox* cbAutoLogin;
+		QCheckBox* cbKrbLogin;
 		QString sessIcon;
 		QPushButton* icon;
 		QLineEdit* cmd;
diff --git a/settingswidget.cpp b/settingswidget.cpp
index 8adf148..86c5395 100644
--- a/settingswidget.cpp
+++ b/settingswidget.cpp
@@ -21,205 +21,258 @@
 #include &lt;QLabel&gt;
 #include &quot;x2gosettings.h&quot;
 #include &lt;QDir&gt;
+#include &lt;QApplication&gt;
+#include &lt;QDesktopWidget&gt;
+#include &lt;QTimer&gt;
+#include &lt;QSplashScreen&gt;
+#include &quot;x2gologdebug.h&quot;
+
 SettingsWidget::SettingsWidget ( QString id, ONMainWindow * mw,
                                  QWidget * parent, Qt::WindowFlags f )
-		: ConfigWidget ( id,mw,parent,f )
+        : ConfigWidget ( id,mw,parent,f )
 {
+    multiDisp=(QApplication::desktop()-&gt;screenCount()&gt;1);
 #ifdef Q_WS_HILDON
-	QTabWidget* tabSettings=new QTabWidget ( this );
-	QFrame* dgb=new QFrame();
-	QFrame* kgb=new QFrame();
-	QFrame* sbgr=new QFrame();
-	tabSettings-&gt;addTab ( dgb, tr ( &quot;&amp;Display&quot; ) );
-	tabSettings-&gt;addTab ( kgb,tr ( &quot;&amp;Keyboard&quot; ) );
-	tabSettings-&gt;addTab ( sbgr,tr ( &quot;Sound&quot; ) );
+    QTabWidget* tabSettings=new QTabWidget ( this );
+    QFrame* dgb=new QFrame();
+    QFrame* kgb=new QFrame();
+    QFrame* sbgr=new QFrame();
+    tabSettings-&gt;addTab ( dgb, tr ( &quot;&amp;Display&quot; ) );
+    tabSettings-&gt;addTab ( kgb,tr ( &quot;&amp;Keyboard&quot; ) );
+    tabSettings-&gt;addTab ( sbgr,tr ( &quot;Sound&quot; ) );
 #else
-	QGroupBox *dgb=new QGroupBox ( tr ( &quot;&amp;Display&quot; ),this );
-	QGroupBox *kgb=new QGroupBox ( tr ( &quot;&amp;Keyboard&quot; ),this );
-	QGroupBox *sbgr=new QGroupBox ( tr ( &quot;Sound&quot; ),this );
+    QGroupBox *dgb=new QGroupBox ( tr ( &quot;&amp;Display&quot; ),this );
+    QGroupBox *kgb=new QGroupBox ( tr ( &quot;&amp;Keyboard&quot; ),this );
+    QGroupBox *sbgr=new QGroupBox ( tr ( &quot;Sound&quot; ),this );
 #endif
-	QVBoxLayout *dbLay = new QVBoxLayout ( dgb );
-	QVBoxLayout  *sndLay=new QVBoxLayout ( sbgr );
-	QHBoxLayout* sLay=new QHBoxLayout ( );
-	QVBoxLayout* sLay_sys=new QVBoxLayout ( );
-	QVBoxLayout* sLay_opt=new QVBoxLayout ( );
-	sLay-&gt;addLayout ( sLay_sys );
-	sLay-&gt;addLayout ( sLay_opt );
-	QVBoxLayout* setLay=new QVBoxLayout ( this );
-	QButtonGroup* radio = new QButtonGroup ( dgb );
-	fs=new QRadioButton ( tr ( &quot;Fullscreen&quot; ),dgb );
+    QVBoxLayout *dbLay = new QVBoxLayout ( dgb );
+    QVBoxLayout  *sndLay=new QVBoxLayout ( sbgr );
+    QHBoxLayout* sLay=new QHBoxLayout ( );
+    QVBoxLayout* sLay_sys=new QVBoxLayout ( );
+    QVBoxLayout* sLay_opt=new QVBoxLayout ( );
+    sLay-&gt;addLayout ( sLay_sys );
+    sLay-&gt;addLayout ( sLay_opt );
+    QVBoxLayout* setLay=new QVBoxLayout ( this );
+    QButtonGroup* radio = new QButtonGroup ( dgb );
+    fs=new QRadioButton ( tr ( &quot;Fullscreen&quot; ),dgb );
 #ifndef Q_WS_HILDON
-	custom=new QRadioButton ( tr ( &quot;Custom&quot; ),dgb );
+    custom=new QRadioButton ( tr ( &quot;Custom&quot; ),dgb );
 #else
-	custom=new QRadioButton ( tr ( &quot;Window&quot; ),dgb );
+    custom=new QRadioButton ( tr ( &quot;Window&quot; ),dgb );
 #endif
-	radio-&gt;addButton ( fs );
-	radio-&gt;addButton ( custom );
-	radio-&gt;setExclusive ( true );
-	width=new QSpinBox ( dgb );
-	height=new QSpinBox ( dgb );
-	cbSetDPI=new QCheckBox ( tr ( &quot;Set display DPI&quot; ),dgb );
-
-	DPI=new QSpinBox ( dgb );
-	DPI-&gt;setRange ( 1,1000 );
-
-	QHBoxLayout *dgLay =new QHBoxLayout();
-	QHBoxLayout *dwLay =new QHBoxLayout();
-	QHBoxLayout *ddLay =new QHBoxLayout();
-	ddLay-&gt;addWidget ( cbSetDPI );
-	ddLay-&gt;addWidget ( DPI );
-	ddLay-&gt;addStretch();
-	ddLay-&gt;setSpacing ( 15 );
-
-	dgLay-&gt;addWidget ( fs );
-	dgLay-&gt;addStretch();
-
-	dwLay-&gt;addWidget ( custom );
-	dwLay-&gt;addSpacing ( 15 );
-	dwLay-&gt;addWidget ( widthLabel=new QLabel ( tr ( &quot;Width:&quot; ),dgb ) );
-	dwLay-&gt;addWidget ( width );
-	width-&gt;setRange ( 0,10000 );
-	dwLay-&gt;addWidget ( heightLabel=new QLabel ( tr ( &quot;Height:&quot; ),dgb ) );
-	dwLay-&gt;addWidget ( height );
-	height-&gt;setRange ( 0,10000 );
-	dwLay-&gt;addStretch();
-	dbLay-&gt;addLayout ( dgLay );
-	dbLay-&gt;addLayout ( dwLay );
-	QFrame* dhl=new QFrame ( dgb );
-	dhl-&gt;setFrameStyle ( QFrame::HLine | QFrame::Sunken );
-	dbLay-&gt;addWidget ( dhl );
-	dbLay-&gt;addLayout ( ddLay );
+    display=new QRadioButton ( tr ( &quot;Use whole display&quot; ),dgb );
+
+    radio-&gt;addButton ( fs );
+    radio-&gt;addButton ( custom );
+    radio-&gt;setExclusive ( true );
+    radio-&gt;addButton(display);
+    width=new QSpinBox ( dgb );
+    height=new QSpinBox ( dgb );
+    cbSetDPI=new QCheckBox ( tr ( &quot;Set display DPI&quot; ),dgb );
+
+    DPI=new QSpinBox ( dgb );
+    DPI-&gt;setRange ( 1,1000 );
+
+    cbXinerama= new QCheckBox(tr( &quot;Xinerama extension (support for two or more physical displays)&quot;),dgb);
+
+    QHBoxLayout *dgLay =new QHBoxLayout();
+    QHBoxLayout *dwLay =new QHBoxLayout();
+    QHBoxLayout *ddLay =new QHBoxLayout();
+    QHBoxLayout *dispLay= new QHBoxLayout();
+    ddLay-&gt;addWidget ( cbSetDPI );
+    ddLay-&gt;addWidget ( DPI );
+    ddLay-&gt;addStretch();
+    ddLay-&gt;setSpacing ( 15 );
+
+    dgLay-&gt;addWidget ( fs );
+    dgLay-&gt;addStretch();
+
+    dwLay-&gt;addWidget ( custom );
+    dwLay-&gt;addSpacing ( 15 );
+    dwLay-&gt;addWidget ( widthLabel=new QLabel ( tr ( &quot;Width:&quot; ),dgb ) );
+    dwLay-&gt;addWidget ( width );
+    width-&gt;setRange ( 0,10000 );
+    dwLay-&gt;addWidget ( heightLabel=new QLabel ( tr ( &quot;Height:&quot; ),dgb ) );
+    dwLay-&gt;addWidget ( height );
+    height-&gt;setRange ( 0,10000 );
+    dwLay-&gt;addStretch();
+
+    dispLay-&gt;addWidget(display);
+    dispLay-&gt;addSpacing(15);
+    dispLay-&gt;addWidget(lDisplay=new QLabel(tr(&quot;&amp;Display:&quot;),dgb));
+    dispLay-&gt;addWidget(displayNumber=new QSpinBox(dgb));
+    pbIdentDisp=new QPushButton(tr(&quot;&amp;Identify all displays&quot;), dgb);
+    dispLay-&gt;addWidget(pbIdentDisp);
+    dispLay-&gt;addStretch();
+    lDisplay-&gt;setBuddy(displayNumber);
+
+    displayNumber-&gt;setMinimum(1);
+    displayNumber-&gt;setMaximum(QApplication::desktop()-&gt;screenCount());
+    if (!multiDisp)
+    {
+        displayNumber-&gt;hide();
+        lDisplay-&gt;hide();
+        pbIdentDisp-&gt;hide();
+        display-&gt;hide();
+    }
+    lDisplay-&gt;setEnabled ( false );
+    displayNumber-&gt;setEnabled ( false );
+
+
+    dbLay-&gt;addLayout ( dgLay );
+    dbLay-&gt;addLayout ( dwLay );
+    dbLay-&gt;addLayout(dispLay);
+    QFrame* dhl=new QFrame ( dgb );
+    dhl-&gt;setFrameStyle ( QFrame::HLine | QFrame::Sunken );
+    dbLay-&gt;addWidget ( dhl );
+    dbLay-&gt;addLayout ( ddLay );
+    dhl=new QFrame ( dgb );
+    dhl-&gt;setFrameStyle ( QFrame::HLine | QFrame::Sunken );
+    dbLay-&gt;addWidget ( dhl );
+    dbLay-&gt;addWidget ( cbXinerama );
 
 #ifdef Q_WS_HILDON
-	width-&gt;hide();
-	height-&gt;hide();
-	widthLabel-&gt;hide();
-	heightLabel-&gt;hide();
+    width-&gt;hide();
+    height-&gt;hide();
+    widthLabel-&gt;hide();
+    heightLabel-&gt;hide();
 #endif
 
 
-	kbd=new QCheckBox ( tr ( &quot;Keep current keyboard Settings&quot; ),kgb );
-	layout=new QLineEdit ( kgb );
-	type=new QLineEdit ( kgb );
-	QVBoxLayout *kbLay = new QVBoxLayout ( kgb );
-
-	QVBoxLayout *klLay = new QVBoxLayout();
-	QVBoxLayout *kwLay = new QVBoxLayout();
-	QHBoxLayout *ksLay = new QHBoxLayout();
-
-	klLay-&gt;addWidget ( layoutLabel= new QLabel (
-	    tr ( &quot;Keyboard layout:&quot; ),kgb ) );
-	klLay-&gt;addWidget ( typeLabel= new QLabel (
-	    tr ( &quot;Keyboard model:&quot; ),kgb ) );
-
-	kwLay-&gt;addWidget ( layout );
-	kwLay-&gt;addWidget ( type );
-
-	ksLay-&gt;addLayout ( klLay );
-	ksLay-&gt;addLayout ( kwLay );
-
-	kbLay-&gt;addWidget ( kbd );
-	kbLay-&gt;addLayout ( ksLay );
-
-	sound=new QCheckBox ( tr ( &quot;Enable sound support&quot; ),sbgr );
-	QButtonGroup* sndsys=new QButtonGroup;
-	pulse=new QRadioButton ( &quot;PulseAudio&quot;,sbgr );
-	arts=new QRadioButton ( &quot;arts&quot;,sbgr );
-	esd=new QRadioButton ( &quot;esd&quot;,sbgr );
-	sndsys-&gt;addButton ( pulse,PULSE );
-	sndsys-&gt;addButton ( arts,ARTS );
-	sndsys-&gt;addButton ( esd,ESD );
-	sndsys-&gt;setExclusive ( true );
-	rbStartSnd=new QRadioButton ( tr ( &quot;Start sound daemon&quot; ),sbgr );
-	rbNotStartSnd=new QRadioButton (
-	    tr ( &quot;Use running sound daemon&quot; ),sbgr );
-	cbSndSshTun=new QCheckBox (
-	    tr ( &quot;Use SSH port forwarding to tunnel\n&quot;
-	         &quot;sound system connections through firewalls&quot; ),sbgr );
-	cbDefSndPort=new QCheckBox ( tr ( &quot;Use default sound port&quot; ),sbgr );
-	sbSndPort=new QSpinBox ( sbgr );
-	sbSndPort-&gt;setMinimum ( 1 );
-	sbSndPort-&gt;setMaximum ( 99999999 );
-
-
-	QHBoxLayout *sndPortLay = new QHBoxLayout();
-	lSndPort=new QLabel ( tr ( &quot;Sound port:&quot; ),sbgr );
-	sndPortLay-&gt;addWidget ( lSndPort );
-	sndPortLay-&gt;addWidget ( sbSndPort );
-
-	sLay_sys-&gt;addWidget ( pulse );
-	sLay_sys-&gt;addWidget ( arts );
-	sLay_sys-&gt;addWidget ( esd );
-
-	sLay_opt-&gt;addWidget ( rbStartSnd );
-	sLay_opt-&gt;addWidget ( rbNotStartSnd );
-	sLay_opt-&gt;addWidget ( cbSndSshTun );
-	QFrame* hl=new QFrame ( sbgr );
-	hl-&gt;setFrameStyle ( QFrame::HLine | QFrame::Sunken );
-	sLay_opt-&gt;addWidget ( hl );
-	sLay_opt-&gt;addWidget ( cbDefSndPort );
-	sLay_opt-&gt;addLayout ( sndPortLay );
-	sndLay-&gt;addWidget ( sound );
-	sndLay-&gt;addLayout ( sLay );
+    kbd=new QCheckBox ( tr ( &quot;Keep current keyboard Settings&quot; ),kgb );
+    layout=new QLineEdit ( kgb );
+    type=new QLineEdit ( kgb );
+    QVBoxLayout *kbLay = new QVBoxLayout ( kgb );
+
+    QVBoxLayout *klLay = new QVBoxLayout();
+    QVBoxLayout *kwLay = new QVBoxLayout();
+    QHBoxLayout *ksLay = new QHBoxLayout();
+
+    klLay-&gt;addWidget ( layoutLabel= new QLabel (
+        tr ( &quot;Keyboard layout:&quot; ),kgb ) );
+    klLay-&gt;addWidget ( typeLabel= new QLabel (
+        tr ( &quot;Keyboard model:&quot; ),kgb ) );
+
+    kwLay-&gt;addWidget ( layout );
+    kwLay-&gt;addWidget ( type );
+
+    ksLay-&gt;addLayout ( klLay );
+    ksLay-&gt;addLayout ( kwLay );
+
+    kbLay-&gt;addWidget ( kbd );
+    kbLay-&gt;addLayout ( ksLay );
+
+    sound=new QCheckBox ( tr ( &quot;Enable sound support&quot; ),sbgr );
+    QButtonGroup* sndsys=new QButtonGroup;
+    pulse=new QRadioButton ( &quot;PulseAudio&quot;,sbgr );
+    arts=new QRadioButton ( &quot;arts&quot;,sbgr );
+    esd=new QRadioButton ( &quot;esd&quot;,sbgr );
+    sndsys-&gt;addButton ( pulse,PULSE );
+    sndsys-&gt;addButton ( arts,ARTS );
+    sndsys-&gt;addButton ( esd,ESD );
+    sndsys-&gt;setExclusive ( true );
+    rbStartSnd=new QRadioButton ( tr ( &quot;Start sound daemon&quot; ),sbgr );
+    rbNotStartSnd=new QRadioButton (
+        tr ( &quot;Use running sound daemon&quot; ),sbgr );
+    cbSndSshTun=new QCheckBox (
+        tr ( &quot;Use SSH port forwarding to tunnel\n&quot;
+             &quot;sound system connections through firewalls&quot; ),sbgr );
+    cbDefSndPort=new QCheckBox ( tr ( &quot;Use default sound port&quot; ),sbgr );
+    sbSndPort=new QSpinBox ( sbgr );
+    sbSndPort-&gt;setMinimum ( 1 );
+    sbSndPort-&gt;setMaximum ( 99999999 );
+
+
+    QHBoxLayout *sndPortLay = new QHBoxLayout();
+    lSndPort=new QLabel ( tr ( &quot;Sound port:&quot; ),sbgr );
+    sndPortLay-&gt;addWidget ( lSndPort );
+    sndPortLay-&gt;addWidget ( sbSndPort );
+
+    sLay_sys-&gt;addWidget ( pulse );
+    sLay_sys-&gt;addWidget ( arts );
+    sLay_sys-&gt;addWidget ( esd );
+
+    sLay_opt-&gt;addWidget ( rbStartSnd );
+    sLay_opt-&gt;addWidget ( rbNotStartSnd );
+    sLay_opt-&gt;addWidget ( cbSndSshTun );
+    QFrame* hl=new QFrame ( sbgr );
+    hl-&gt;setFrameStyle ( QFrame::HLine | QFrame::Sunken );
+    sLay_opt-&gt;addWidget ( hl );
+    sLay_opt-&gt;addWidget ( cbDefSndPort );
+    sLay_opt-&gt;addLayout ( sndPortLay );
+    sndLay-&gt;addWidget ( sound );
+    sndLay-&gt;addLayout ( sLay );
 #ifdef Q_OS_WIN
-	arts-&gt;hide();
-	hl-&gt;hide();
-	cbDefSndPort-&gt;hide();
-	lSndPort-&gt;hide();
-	sbSndPort-&gt;hide();
+    arts-&gt;hide();
+    hl-&gt;hide();
+    cbDefSndPort-&gt;hide();
+    lSndPort-&gt;hide();
+    sbSndPort-&gt;hide();
 #endif
 
 
-	cbClientPrint=new QCheckBox ( tr ( &quot;Client side printing support&quot; ),
-	                              this );
+    cbClientPrint=new QCheckBox ( tr ( &quot;Client side printing support&quot; ),
+                                  this );
 #ifdef	Q_OS_DARWIN
-	arts-&gt;hide();
-	pulse-&gt;hide();
-	esd-&gt;setChecked ( true );
+    arts-&gt;hide();
+    pulse-&gt;hide();
+    esd-&gt;setChecked ( true );
 #endif
 
 #ifndef Q_WS_HILDON
-	setLay-&gt;addWidget ( dgb );
-	setLay-&gt;addWidget ( kgb );
-	setLay-&gt;addWidget ( sbgr );
+    setLay-&gt;addWidget ( dgb );
+    setLay-&gt;addWidget ( kgb );
+    setLay-&gt;addWidget ( sbgr );
 #else
-	setLay-&gt;addWidget ( tabSettings );
+    setLay-&gt;addWidget ( tabSettings );
 // 	cbClientPrint-&gt;hide();
 #endif
-	setLay-&gt;addWidget ( cbClientPrint );
-	setLay-&gt;addStretch();
-
-	connect ( custom,SIGNAL ( toggled ( bool ) ),width,
-	          SLOT ( setEnabled ( bool ) ) );
-	connect ( custom,SIGNAL ( toggled ( bool ) ),height,
-	          SLOT ( setEnabled ( bool ) ) );
-	connect ( custom,SIGNAL ( toggled ( bool ) ),widthLabel,
-	          SLOT ( setEnabled ( bool ) ) );
-	connect ( custom,SIGNAL ( toggled ( bool ) ),heightLabel,
-	          SLOT ( setEnabled ( bool ) ) );
-	connect ( cbSetDPI,SIGNAL ( toggled ( bool ) ),DPI,
-	          SLOT ( setEnabled ( bool ) ) );
-	connect ( kbd,SIGNAL ( toggled ( bool ) ),layout,
-	          SLOT ( setDisabled ( bool ) ) );
-	connect ( kbd,SIGNAL ( toggled ( bool ) ),layoutLabel,
-	          SLOT ( setDisabled ( bool ) ) );
-	connect ( kbd,SIGNAL ( toggled ( bool ) ),type,
-	          SLOT ( setDisabled ( bool ) ) );
-	connect ( kbd,SIGNAL ( toggled ( bool ) ),typeLabel,
-	          SLOT ( setDisabled ( bool ) ) );
-	connect ( sound,SIGNAL ( toggled ( bool ) ),this,
-	          SLOT ( slot_sndToggled ( bool ) ) );
-	connect ( sndsys,SIGNAL ( buttonClicked ( int ) ),this,
-	          SLOT ( slot_sndSysSelected ( int ) ) );
-	connect ( rbStartSnd,SIGNAL ( clicked ( ) ),this,
-	          SLOT ( slot_sndStartClicked() ) );
-	connect ( rbNotStartSnd,SIGNAL ( clicked ( ) ),this,
-	          SLOT ( slot_sndStartClicked() ) );
-	connect ( cbDefSndPort,SIGNAL ( toggled ( bool ) ),this,
-	          SLOT ( slot_sndDefPortChecked ( bool ) ) );
-	kbd-&gt;setChecked ( true );
-	custom-&gt;setChecked ( true );
-	readConfig();
+    setLay-&gt;addWidget ( cbClientPrint );
+    setLay-&gt;addStretch();
+
+    connect ( custom,SIGNAL ( toggled ( bool ) ),width,
+              SLOT ( setEnabled ( bool ) ) );
+    connect ( custom,SIGNAL ( toggled ( bool ) ),height,
+              SLOT ( setEnabled ( bool ) ) );
+    connect ( custom,SIGNAL ( toggled ( bool ) ),widthLabel,
+              SLOT ( setEnabled ( bool ) ) );
+    connect ( custom,SIGNAL ( toggled ( bool ) ),heightLabel,
+              SLOT ( setEnabled ( bool ) ) );
+
+    connect ( display,SIGNAL ( toggled ( bool ) ),displayNumber,
+              SLOT ( setEnabled ( bool ) ) );
+    connect ( display,SIGNAL ( toggled ( bool ) ),lDisplay,
+              SLOT ( setEnabled ( bool ) ) );
+    connect(pbIdentDisp, SIGNAL(clicked()), this, SLOT (slot_identDisplays()));
+
+
+
+    connect ( cbSetDPI,SIGNAL ( toggled ( bool ) ),DPI,
+              SLOT ( setEnabled ( bool ) ) );
+    connect ( kbd,SIGNAL ( toggled ( bool ) ),layout,
+              SLOT ( setDisabled ( bool ) ) );
+    connect ( kbd,SIGNAL ( toggled ( bool ) ),layoutLabel,
+              SLOT ( setDisabled ( bool ) ) );
+    connect ( kbd,SIGNAL ( toggled ( bool ) ),type,
+              SLOT ( setDisabled ( bool ) ) );
+    connect ( kbd,SIGNAL ( toggled ( bool ) ),typeLabel,
+              SLOT ( setDisabled ( bool ) ) );
+    connect ( sound,SIGNAL ( toggled ( bool ) ),this,
+              SLOT ( slot_sndToggled ( bool ) ) );
+    connect ( sndsys,SIGNAL ( buttonClicked ( int ) ),this,
+              SLOT ( slot_sndSysSelected ( int ) ) );
+    connect ( rbStartSnd,SIGNAL ( clicked ( ) ),this,
+              SLOT ( slot_sndStartClicked() ) );
+    connect ( rbNotStartSnd,SIGNAL ( clicked ( ) ),this,
+              SLOT ( slot_sndStartClicked() ) );
+    connect ( cbDefSndPort,SIGNAL ( toggled ( bool ) ),this,
+              SLOT ( slot_sndDefPortChecked ( bool ) ) );
+    kbd-&gt;setChecked ( true );
+    custom-&gt;setChecked ( true );
+    readConfig();
+    
+    cbXinerama-&gt;setVisible(false);
+    cbXinerama-&gt;setChecked(false);
 }
 
 
@@ -227,268 +280,340 @@ SettingsWidget::~SettingsWidget()
 {
 }
 
+
+void SettingsWidget::slot_identDisplays()
+{
+    pbIdentDisp-&gt;setEnabled(false);
+    identWins.clear();
+    for (int i=0;i&lt;QApplication::desktop()-&gt;screenCount();++i)
+    {
+        QMainWindow *mw=new QMainWindow(
+            this, Qt::FramelessWindowHint|Qt::X11BypassWindowManagerHint|Qt::WindowStaysOnTopHint);
+        mw-&gt;setFixedSize(150,200);
+        QLabel* fr=new QLabel(QString::number(i+1), mw);
+        QFont f=fr-&gt;font();
+        f.setBold(true);
+        f.setPointSize(56);
+        fr-&gt;setFont(f);
+        fr-&gt;setAlignment(Qt::AlignCenter);
+        mw-&gt;setCentralWidget(fr);
+        fr-&gt;setFrameStyle(QFrame::Box);
+        QRect geom=QApplication::desktop()-&gt;screenGeometry(i);
+        int x_pos=geom.width()/2-75;
+        int y_pos=geom.height()/2-100;
+        x_pos=565;
+        identWins&lt;&lt;mw;
+        mw -&gt;move(geom.x()+x_pos, geom.y()+y_pos);
+        mw-&gt;show();
+        mw-&gt;raise();
+    }
+    QTimer::singleShot(1200,this, SLOT(slot_hideIdentWins()));
+}
+
+void SettingsWidget::slot_hideIdentWins()
+{
+    QMainWindow* mw;
+    foreach(mw,identWins)
+    {
+        mw-&gt;close();
+    }
+    pbIdentDisp-&gt;setEnabled(true);
+}
+
+
 void SettingsWidget::slot_sndSysSelected ( int system )
 {
-	rbStartSnd-&gt;show();
-	rbNotStartSnd-&gt;show();
-	cbSndSshTun-&gt;hide();
-	cbDefSndPort-&gt;setChecked ( true );
-	cbDefSndPort-&gt;setEnabled ( true );
-
-	switch ( system )
-	{
-		case PULSE:
-		{
-			rbStartSnd-&gt;hide();
-			rbNotStartSnd-&gt;hide();
-			cbSndSshTun-&gt;show();
-			cbSndSshTun-&gt;setEnabled ( true );
-			break;
-		}
-		case ARTS:
-		{
-			cbDefSndPort-&gt;setChecked ( false );
-			cbDefSndPort-&gt;setEnabled ( false );
-			sbSndPort-&gt;setValue ( 20221 );
-			break;
-		}
-		case ESD:
-		{
+    rbStartSnd-&gt;show();
+    rbNotStartSnd-&gt;show();
+    cbSndSshTun-&gt;hide();
+    cbDefSndPort-&gt;setChecked ( true );
+    cbDefSndPort-&gt;setEnabled ( true );
+
+    switch ( system )
+    {
+    case PULSE:
+    {
+        rbStartSnd-&gt;hide();
+        rbNotStartSnd-&gt;hide();
+        cbSndSshTun-&gt;show();
+        cbSndSshTun-&gt;setEnabled ( true );
+        break;
+    }
+    case ARTS:
+    {
+        cbDefSndPort-&gt;setChecked ( false );
+        cbDefSndPort-&gt;setEnabled ( false );
+        sbSndPort-&gt;setValue ( 20221 );
+        break;
+    }
+    case ESD:
+    {
 #ifdef Q_OS_WIN
-			rbStartSnd-&gt;hide();
-			rbNotStartSnd-&gt;hide();
-			cbSndSshTun-&gt;show();
-			cbSndSshTun-&gt;setEnabled ( false );
-			cbSndSshTun-&gt;setChecked ( true );
+        rbStartSnd-&gt;hide();
+        rbNotStartSnd-&gt;hide();
+        cbSndSshTun-&gt;show();
+        cbSndSshTun-&gt;setEnabled ( false );
+        cbSndSshTun-&gt;setChecked ( true );
 #endif
-			sbSndPort-&gt;setValue ( 16001 );
-			break;
-		}
-	}
-	slot_sndStartClicked();
+        sbSndPort-&gt;setValue ( 16001 );
+        break;
+    }
+    }
+    slot_sndStartClicked();
 }
 
 void SettingsWidget::slot_sndToggled ( bool val )
 {
-	arts-&gt;setEnabled ( val );
-	pulse-&gt;setEnabled ( val );
-	esd-&gt;setEnabled ( val );
-
-	rbStartSnd-&gt;setEnabled ( val );
-	rbNotStartSnd-&gt;setEnabled ( val );
-
-	cbSndSshTun-&gt;setEnabled ( false );
-	if ( pulse-&gt;isChecked() )
-		cbSndSshTun-&gt;setEnabled ( val );
-	lSndPort-&gt;setEnabled ( val );
-	if ( !arts-&gt;isChecked() )
-		cbDefSndPort-&gt;setEnabled ( val );
-	sbSndPort-&gt;setEnabled ( val );
-	if ( val )
-		slot_sndStartClicked();
+    arts-&gt;setEnabled ( val );
+    pulse-&gt;setEnabled ( val );
+    esd-&gt;setEnabled ( val );
+
+    rbStartSnd-&gt;setEnabled ( val );
+    rbNotStartSnd-&gt;setEnabled ( val );
+
+    cbSndSshTun-&gt;setEnabled ( false );
+    if ( pulse-&gt;isChecked() )
+        cbSndSshTun-&gt;setEnabled ( val );
+    lSndPort-&gt;setEnabled ( val );
+    if ( !arts-&gt;isChecked() )
+        cbDefSndPort-&gt;setEnabled ( val );
+    sbSndPort-&gt;setEnabled ( val );
+    if ( val )
+        slot_sndStartClicked();
 
 }
 
 void SettingsWidget::slot_sndStartClicked()
 {
-	bool start=rbStartSnd-&gt;isChecked();
+    bool start=rbStartSnd-&gt;isChecked();
 #ifdef Q_OS_WIN
-	start=false;
+    start=false;
 #endif
-	if ( pulse-&gt;isChecked() )
-	{
-		lSndPort-&gt;setEnabled ( true );
-		sbSndPort-&gt;setEnabled ( true );
-		cbDefSndPort-&gt;setEnabled ( true );
-	}
-	else
-	{
-		lSndPort-&gt;setEnabled ( !start );
-		sbSndPort-&gt;setEnabled ( !start );
-		cbDefSndPort-&gt;setEnabled ( !start );
-	}
-	if ( arts-&gt;isChecked() )
-		cbDefSndPort-&gt;setEnabled ( false );
-	if ( ( !start  &amp;&amp; esd-&gt;isChecked() ) ||pulse-&gt;isChecked() )
-		slot_sndDefPortChecked ( cbDefSndPort-&gt;isChecked() );
+    if ( pulse-&gt;isChecked() )
+    {
+        lSndPort-&gt;setEnabled ( true );
+        sbSndPort-&gt;setEnabled ( true );
+        cbDefSndPort-&gt;setEnabled ( true );
+    }
+    else
+    {
+        lSndPort-&gt;setEnabled ( !start );
+        sbSndPort-&gt;setEnabled ( !start );
+        cbDefSndPort-&gt;setEnabled ( !start );
+    }
+    if ( arts-&gt;isChecked() )
+        cbDefSndPort-&gt;setEnabled ( false );
+    if ( ( !start  &amp;&amp; esd-&gt;isChecked() ) ||pulse-&gt;isChecked() )
+        slot_sndDefPortChecked ( cbDefSndPort-&gt;isChecked() );
 
 }
 
 void SettingsWidget::slot_sndDefPortChecked ( bool val )
 {
-	sbSndPort-&gt;setEnabled ( !val );
-	lSndPort-&gt;setEnabled ( !val );
-	if ( val )
-	{
-		if ( pulse-&gt;isChecked() )
-			sbSndPort-&gt;setValue ( 4713 );
-		if ( arts-&gt;isChecked() )
-			sbSndPort-&gt;setValue ( 20221 );
-		if ( esd-&gt;isChecked() )
-			sbSndPort-&gt;setValue ( 16001 );
-	}
+    sbSndPort-&gt;setEnabled ( !val );
+    lSndPort-&gt;setEnabled ( !val );
+    if ( val )
+    {
+        if ( pulse-&gt;isChecked() )
+            sbSndPort-&gt;setValue ( 4713 );
+        if ( arts-&gt;isChecked() )
+            sbSndPort-&gt;setValue ( 20221 );
+        if ( esd-&gt;isChecked() )
+            sbSndPort-&gt;setValue ( 16001 );
+    }
 
 }
 
 void SettingsWidget::readConfig()
 {
 
-	X2goSettings st ( &quot;sessions&quot; );
-
-	fs-&gt;setChecked (
-	    st.setting()-&gt;value ( sessionId+&quot;/fullscreen&quot;,
-	                          ( QVariant ) mainWindow-&gt;getDefaultFullscreen() ).toBool() );
-
-	custom-&gt;setChecked ( ! st.setting()-&gt;value (
-	                         sessionId+&quot;/fullscreen&quot;,
-	                         ( QVariant ) mainWindow-&gt;getDefaultFullscreen()
-	                     ).toBool() );
-
-
-	width-&gt;setValue (
-	    st.setting()-&gt;value ( sessionId+&quot;/width&quot;,
-	                          ( QVariant ) mainWindow-&gt;getDefaultWidth() ).toInt() );
-	height-&gt;setValue (
-	    st.setting()-&gt;value ( sessionId+&quot;/height&quot;,
-	                          ( QVariant ) mainWindow-&gt;getDefaultHeight() ).toInt() );
-
-	cbSetDPI-&gt;setChecked (
-	    st.setting()-&gt;value ( sessionId+&quot;/setdpi&quot;,
-	                          ( QVariant ) mainWindow-&gt;getDefaultSetDPI() ).toBool() );
-	DPI-&gt;setEnabled ( cbSetDPI-&gt;isChecked() );
-	DPI-&gt;setValue (
-	    st.setting()-&gt;value ( sessionId+&quot;/dpi&quot;,
-	                          ( QVariant ) mainWindow-&gt;getDefaultDPI() ).toUInt() );
-
-	kbd-&gt;setChecked ( !st.setting()-&gt;value (
-	                      sessionId+&quot;/usekbd&quot;,
-	                      ( QVariant ) mainWindow-&gt;getDefaultSetKbd()
-	                  ).toBool() );
-	layout-&gt;setText (
-	    st.setting()-&gt;value ( sessionId+&quot;/layout&quot;,
-	                          ( QVariant ) mainWindow-&gt;getDefaultLayout()
-	                        ).toString() );
-	type-&gt;setText (
-	    st.setting()-&gt;value ( sessionId+&quot;/type&quot;,
-	                          ( QVariant ) mainWindow-&gt;getDefaultKbdType()
-	                        ).toString() );
-	bool snd=st.setting()-&gt;value (
-	             sessionId+&quot;/sound&quot;,
-	             ( QVariant ) mainWindow-&gt;getDefaultUseSound()
-	         ).toBool();
-	QString sndsys=st.setting()-&gt;value ( sessionId+&quot;/soundsystem&quot;,
-	                                     &quot;pulse&quot; ).toString();
-	bool startServ=st.setting()-&gt;value ( sessionId+&quot;/startsoundsystem&quot;,
-	                                     true ).toBool();
-	bool sndInTun=st.setting()-&gt;value ( sessionId+&quot;/soundtunnel&quot;,
-	                                    true ).toBool();
-	bool defSndPort=st.setting()-&gt;value ( sessionId+&quot;/defsndport&quot;,
-	                                      true ).toBool();
-	int sndPort= st.setting()-&gt;value ( sessionId+&quot;/sndport&quot;,4713 ).toInt();
-	if ( startServ )
-		rbStartSnd-&gt;setChecked ( true );
-	else
-		rbNotStartSnd-&gt;setChecked ( true );
-
-	pulse-&gt;setChecked ( true );
-	slot_sndSysSelected ( PULSE );
+    X2goSettings st ( &quot;sessions&quot; );
+
+    fs-&gt;setChecked (
+        st.setting()-&gt;value ( sessionId+&quot;/fullscreen&quot;,
+                              ( QVariant ) mainWindow-&gt;getDefaultFullscreen() ).toBool() );
+
+    custom-&gt;setChecked ( ! st.setting()-&gt;value (
+                             sessionId+&quot;/fullscreen&quot;,
+                             ( QVariant ) mainWindow-&gt;getDefaultFullscreen()
+                         ).toBool() );
+
+
+    width-&gt;setValue (
+        st.setting()-&gt;value ( sessionId+&quot;/width&quot;,
+                              ( QVariant ) mainWindow-&gt;getDefaultWidth() ).toInt() );
+    height-&gt;setValue (
+        st.setting()-&gt;value ( sessionId+&quot;/height&quot;,
+                              ( QVariant ) mainWindow-&gt;getDefaultHeight() ).toInt() );
+
+    if (multiDisp)
+    {
+        bool md=st.setting()-&gt;value ( sessionId+&quot;/multidisp&quot;,
+                                      ( QVariant ) false).toBool();
+        if (md)
+            display-&gt;setChecked(true);
+        int disp=st.setting()-&gt;value ( sessionId+&quot;/display&quot;,
+                                       ( QVariant ) 1).toUInt();
+        if (disp&lt;= displayNumber-&gt;maximum())
+            displayNumber-&gt;setValue(disp);
+        else
+            displayNumber-&gt;setValue(1);
+    }
+
+    cbSetDPI-&gt;setChecked (
+        st.setting()-&gt;value ( sessionId+&quot;/setdpi&quot;,
+                              ( QVariant ) mainWindow-&gt;getDefaultSetDPI() ).toBool() );
+
+    cbXinerama-&gt;setChecked (
+        st.setting()-&gt;value ( sessionId+&quot;/xinerama&quot;,
+                              ( QVariant ) false).toBool());
+
+
+    DPI-&gt;setEnabled ( cbSetDPI-&gt;isChecked() );
+    DPI-&gt;setValue (
+        st.setting()-&gt;value ( sessionId+&quot;/dpi&quot;,
+                              ( QVariant ) mainWindow-&gt;getDefaultDPI() ).toUInt() );
+
+    kbd-&gt;setChecked ( !st.setting()-&gt;value (
+                          sessionId+&quot;/usekbd&quot;,
+                          ( QVariant ) mainWindow-&gt;getDefaultSetKbd()
+                      ).toBool() );
+    layout-&gt;setText (
+        st.setting()-&gt;value ( sessionId+&quot;/layout&quot;,
+                              ( QVariant ) mainWindow-&gt;getDefaultLayout()
+                            ).toString() );
+    type-&gt;setText (
+        st.setting()-&gt;value ( sessionId+&quot;/type&quot;,
+                              ( QVariant ) mainWindow-&gt;getDefaultKbdType()
+                            ).toString() );
+    bool snd=st.setting()-&gt;value (
+                 sessionId+&quot;/sound&quot;,
+                 ( QVariant ) mainWindow-&gt;getDefaultUseSound()
+             ).toBool();
+    QString sndsys=st.setting()-&gt;value ( sessionId+&quot;/soundsystem&quot;,
+                                         &quot;pulse&quot; ).toString();
+    bool startServ=st.setting()-&gt;value ( sessionId+&quot;/startsoundsystem&quot;,
+                                         true ).toBool();
+    bool sndInTun=st.setting()-&gt;value ( sessionId+&quot;/soundtunnel&quot;,
+                                        true ).toBool();
+    bool defSndPort=st.setting()-&gt;value ( sessionId+&quot;/defsndport&quot;,
+                                          true ).toBool();
+    int sndPort= st.setting()-&gt;value ( sessionId+&quot;/sndport&quot;,4713 ).toInt();
+    if ( startServ )
+        rbStartSnd-&gt;setChecked ( true );
+    else
+        rbNotStartSnd-&gt;setChecked ( true );
+
+    pulse-&gt;setChecked ( true );
+    slot_sndSysSelected ( PULSE );
 #ifdef Q_OS_WIN
-	if ( sndsys==&quot;arts&quot; )
-	{
-		sndsys=&quot;pulse&quot;;
-	}
+    if ( sndsys==&quot;arts&quot; )
+    {
+        sndsys=&quot;pulse&quot;;
+    }
 #endif
-	if ( sndsys==&quot;arts&quot; )
-	{
-		arts-&gt;setChecked ( true );
-		slot_sndSysSelected ( ARTS );
-	}
+    if ( sndsys==&quot;arts&quot; )
+    {
+        arts-&gt;setChecked ( true );
+        slot_sndSysSelected ( ARTS );
+    }
 #ifdef	Q_OS_DARWIN
-	sndsys=&quot;esd&quot;;
+    sndsys=&quot;esd&quot;;
 #endif
-	if ( sndsys==&quot;esd&quot; )
-	{
-		esd-&gt;setChecked ( true );
-		slot_sndSysSelected ( ESD );
-	}
-	cbSndSshTun-&gt;setChecked ( sndInTun );
-	sound-&gt;setChecked ( snd );
-	if ( !defSndPort )
-		sbSndPort-&gt;setValue ( sndPort );
-	cbDefSndPort-&gt;setChecked ( defSndPort );
-	if ( sndsys==&quot;arts&quot; )
-		cbDefSndPort-&gt;setChecked ( false );
-	slot_sndToggled ( snd );
-	slot_sndStartClicked();
-
-	cbClientPrint-&gt;setChecked ( st.setting()-&gt;value ( sessionId+&quot;/print&quot;,
-	                                       true ).toBool() );
+    if ( sndsys==&quot;esd&quot; )
+    {
+        esd-&gt;setChecked ( true );
+        slot_sndSysSelected ( ESD );
+    }
+    cbSndSshTun-&gt;setChecked ( sndInTun );
+    sound-&gt;setChecked ( snd );
+    if ( !defSndPort )
+        sbSndPort-&gt;setValue ( sndPort );
+    cbDefSndPort-&gt;setChecked ( defSndPort );
+    if ( sndsys==&quot;arts&quot; )
+        cbDefSndPort-&gt;setChecked ( false );
+    slot_sndToggled ( snd );
+    slot_sndStartClicked();
+
+    cbClientPrint-&gt;setChecked ( st.setting()-&gt;value ( sessionId+&quot;/print&quot;,
+                                true ).toBool() );
 }
 
 void SettingsWidget::setDefaults()
 {
-	fs-&gt;setChecked ( false );
-	custom-&gt;setChecked ( true );
-	width-&gt;setValue ( 800 );
-	height-&gt;setValue ( 600 );
-
-	cbSetDPI-&gt;setChecked ( mainWindow-&gt;getDefaultSetDPI() );
-	DPI-&gt;setValue ( mainWindow-&gt;getDefaultDPI() );
-	DPI-&gt;setEnabled ( mainWindow-&gt;getDefaultSetDPI() );
-
-	kbd-&gt;setChecked ( !mainWindow-&gt;getDefaultSetKbd() );
-	layout-&gt;setText ( tr ( &quot;us&quot; ) );
-	type-&gt;setText ( tr ( &quot;pc105/us&quot; ) );
-	sound-&gt;setChecked ( true );
-	pulse-&gt;setChecked ( true );
-	slot_sndToggled ( true );
-	slot_sndSysSelected ( PULSE );
-	cbSndSshTun-&gt;setChecked ( true );
-	rbStartSnd-&gt;setChecked ( true );
-	cbClientPrint-&gt;setChecked ( true );
+    fs-&gt;setChecked ( false );
+    display-&gt;setChecked ( false );
+    lDisplay-&gt;setEnabled ( false );
+    displayNumber-&gt;setEnabled ( false );
+    custom-&gt;setChecked ( true );
+    width-&gt;setValue ( 800 );
+    height-&gt;setValue ( 600 );
+
+    cbSetDPI-&gt;setChecked ( mainWindow-&gt;getDefaultSetDPI() );
+    DPI-&gt;setValue ( mainWindow-&gt;getDefaultDPI() );
+    DPI-&gt;setEnabled ( mainWindow-&gt;getDefaultSetDPI() );
+
+    kbd-&gt;setChecked ( !mainWindow-&gt;getDefaultSetKbd() );
+    layout-&gt;setText ( tr ( &quot;us&quot; ) );
+    type-&gt;setText ( tr ( &quot;pc105/us&quot; ) );
+    sound-&gt;setChecked ( true );
+    pulse-&gt;setChecked ( true );
+    slot_sndToggled ( true );
+    slot_sndSysSelected ( PULSE );
+    cbSndSshTun-&gt;setChecked ( true );
+    rbStartSnd-&gt;setChecked ( true );
+    cbClientPrint-&gt;setChecked ( true );
+    cbXinerama-&gt;setChecked ( false );
 }
 
 void SettingsWidget::saveSettings()
 {
-	X2goSettings st ( &quot;sessions&quot; );
-
-	st.setting()-&gt;setValue ( sessionId+&quot;/fullscreen&quot;,
-	                         ( QVariant ) fs-&gt;isChecked() );
-	st.setting()-&gt;setValue ( sessionId+&quot;/width&quot;,
-	                         ( QVariant ) width-&gt;value() );
-	st.setting()-&gt;setValue ( sessionId+&quot;/height&quot;,
-	                         ( QVariant ) height-&gt;value() );
-	st.setting()-&gt;setValue ( sessionId+&quot;/dpi&quot;,
-	                         ( QVariant ) DPI-&gt;value() );
-	st.setting()-&gt;setValue ( sessionId+&quot;/setdpi&quot;,
-	                         ( QVariant ) cbSetDPI-&gt;isChecked() );
-	st.setting()-&gt;setValue ( sessionId+&quot;/usekbd&quot;,
-	                         ( QVariant ) !kbd-&gt;isChecked() );
-	st.setting()-&gt;setValue ( sessionId+&quot;/layout&quot;,
-	                         ( QVariant ) layout-&gt;text() );
-	st.setting()-&gt;setValue ( sessionId+&quot;/type&quot;,
-	                         ( QVariant ) type-&gt;text() );
-	st.setting()-&gt;setValue ( sessionId+&quot;/sound&quot;,
-	                         ( QVariant ) sound-&gt;isChecked() );
-	if ( arts-&gt;isChecked() )
-		st.setting()-&gt;setValue ( sessionId+&quot;/soundsystem&quot;,
-		                         ( QVariant ) &quot;arts&quot; );
-	if ( esd-&gt;isChecked() )
-		st.setting()-&gt;setValue ( sessionId+&quot;/soundsystem&quot;,
-		                         ( QVariant ) &quot;esd&quot; );
-	if ( pulse-&gt;isChecked() )
-		st.setting()-&gt;setValue ( sessionId+&quot;/soundsystem&quot;,
-		                         ( QVariant ) &quot;pulse&quot; );
-
-	st.setting()-&gt;setValue ( sessionId+&quot;/startsoundsystem&quot;,
-	                         ( QVariant ) rbStartSnd-&gt;isChecked() );
-	st.setting()-&gt;setValue ( sessionId+&quot;/soundtunnel&quot;,
-	                         ( QVariant ) cbSndSshTun-&gt;isChecked() );
-	st.setting()-&gt;setValue ( sessionId+&quot;/defsndport&quot;,
-	                         ( QVariant ) cbDefSndPort-&gt;isChecked() );
-	st.setting()-&gt;setValue ( sessionId+&quot;/sndport&quot;,
-	                         ( QVariant ) sbSndPort-&gt;value() );
-	st.setting()-&gt;setValue ( sessionId+&quot;/print&quot;,
-	                         ( QVariant ) cbClientPrint-&gt;isChecked() );
-	st.setting()-&gt;sync();
+    X2goSettings st ( &quot;sessions&quot; );
+
+    st.setting()-&gt;setValue ( sessionId+&quot;/fullscreen&quot;,
+                             ( QVariant ) fs-&gt;isChecked() );
+    st.setting()-&gt;setValue ( sessionId+&quot;/width&quot;,
+                             ( QVariant ) width-&gt;value() );
+    st.setting()-&gt;setValue ( sessionId+&quot;/multidisp&quot;,
+                             ( QVariant ) display-&gt;isChecked() );
+    st.setting()-&gt;setValue ( sessionId+&quot;/display&quot;,
+                             ( QVariant ) displayNumber-&gt;value() );
+    st.setting()-&gt;setValue ( sessionId+&quot;/height&quot;,
+                             ( QVariant ) height-&gt;value() );
+    st.setting()-&gt;setValue ( sessionId+&quot;/dpi&quot;,
+                             ( QVariant ) DPI-&gt;value() );
+    st.setting()-&gt;setValue ( sessionId+&quot;/setdpi&quot;,
+                             ( QVariant ) cbSetDPI-&gt;isChecked() );
+    st.setting()-&gt;setValue ( sessionId+&quot;/xinerama&quot;,
+                             ( QVariant ) cbXinerama-&gt;isChecked() );
+
+    st.setting()-&gt;setValue ( sessionId+&quot;/usekbd&quot;,
+                             ( QVariant ) !kbd-&gt;isChecked() );
+    st.setting()-&gt;setValue ( sessionId+&quot;/layout&quot;,
+                             ( QVariant ) layout-&gt;text() );
+    st.setting()-&gt;setValue ( sessionId+&quot;/type&quot;,
+                             ( QVariant ) type-&gt;text() );
+    st.setting()-&gt;setValue ( sessionId+&quot;/sound&quot;,
+                             ( QVariant ) sound-&gt;isChecked() );
+    if ( arts-&gt;isChecked() )
+        st.setting()-&gt;setValue ( sessionId+&quot;/soundsystem&quot;,
+                                 ( QVariant ) &quot;arts&quot; );
+    if ( esd-&gt;isChecked() )
+        st.setting()-&gt;setValue ( sessionId+&quot;/soundsystem&quot;,
+                                 ( QVariant ) &quot;esd&quot; );
+    if ( pulse-&gt;isChecked() )
+        st.setting()-&gt;setValue ( sessionId+&quot;/soundsystem&quot;,
+                                 ( QVariant ) &quot;pulse&quot; );
+
+    st.setting()-&gt;setValue ( sessionId+&quot;/startsoundsystem&quot;,
+                             ( QVariant ) rbStartSnd-&gt;isChecked() );
+    st.setting()-&gt;setValue ( sessionId+&quot;/soundtunnel&quot;,
+                             ( QVariant ) cbSndSshTun-&gt;isChecked() );
+    st.setting()-&gt;setValue ( sessionId+&quot;/defsndport&quot;,
+                             ( QVariant ) cbDefSndPort-&gt;isChecked() );
+    st.setting()-&gt;setValue ( sessionId+&quot;/sndport&quot;,
+                             ( QVariant ) sbSndPort-&gt;value() );
+    st.setting()-&gt;setValue ( sessionId+&quot;/print&quot;,
+                             ( QVariant ) cbClientPrint-&gt;isChecked() );
+    st.setting()-&gt;sync();
 }
diff --git a/settingswidget.h b/settingswidget.h
index a52573b..8c5ebf8 100644
--- a/settingswidget.h
+++ b/settingswidget.h
@@ -23,49 +23,61 @@ class QCheckBox;
 class QLineEdit;
 class QSpinBox;
 class QLabel;
+class QPushButton;
+class QMainWindow;
+
+
 class SettingsWidget : public ConfigWidget
 {
-		Q_OBJECT
-	public:
-		SettingsWidget ( QString id, ONMainWindow * mw,
-		                 QWidget * parent=0, Qt::WindowFlags f=0 );
-		~SettingsWidget();
-		void setDefaults();
-		void saveSettings();
-	private slots:
-		void slot_sndSysSelected ( int system );
-		void slot_sndToggled ( bool val );
-		void slot_sndStartClicked();
-		void slot_sndDefPortChecked ( bool val );
-	private:
-		enum {PULSE,ARTS,ESD};
-		QSpinBox* width;
-		QSpinBox* height;
-		QRadioButton* fs;
-		QCheckBox* kbd;
-		QLineEdit* layout;
-		QLineEdit* type;
-		QRadioButton* custom;
-		QRadioButton* arts;
-		QRadioButton* pulse;
-		QRadioButton* esd;
-		QCheckBox* sound;
-		QRadioButton* rbStartSnd;
-		QRadioButton* rbNotStartSnd;
-		QCheckBox* cbSndSshTun;
-		QCheckBox* cbClientPrint;
-		QCheckBox* cbDefSndPort;
-		QCheckBox* cbSetDPI;
-		QLabel* lSndPort;
-		QSpinBox* sbSndPort;
-		QSpinBox* DPI;
-		QLabel* widthLabel;
-		QLabel* heightLabel;
-		QLabel* layoutLabel;
-		QLabel* typeLabel;
-	private:
-		void readConfig();
-
+    Q_OBJECT
+public:
+    SettingsWidget ( QString id, ONMainWindow * mw,
+                     QWidget * parent=0, Qt::WindowFlags f=0 );
+    ~SettingsWidget();
+    void setDefaults();
+    void saveSettings();
+private slots:
+    void slot_sndSysSelected ( int system );
+    void slot_sndToggled ( bool val );
+    void slot_sndStartClicked();
+    void slot_sndDefPortChecked ( bool val );
+    void slot_identDisplays();
+    void slot_hideIdentWins();
+private:
+    enum {PULSE,ARTS,ESD};
+    QSpinBox* width;
+    QSpinBox* height;
+    QSpinBox* displayNumber;
+    QRadioButton* fs;
+    QCheckBox* kbd;
+    QLineEdit* layout;
+    QLineEdit* type;
+    QRadioButton* custom;
+    QRadioButton* display;
+    QRadioButton* arts;
+    QRadioButton* pulse;
+    QRadioButton* esd;
+    QCheckBox* sound;
+    QRadioButton* rbStartSnd;
+    QRadioButton* rbNotStartSnd;
+    QCheckBox* cbSndSshTun;
+    QCheckBox* cbClientPrint;
+    QCheckBox* cbDefSndPort;
+    QCheckBox* cbSetDPI;
+    QCheckBox* cbXinerama;
+    QLabel* lSndPort;
+    QSpinBox* sbSndPort;
+    QSpinBox* DPI;
+    QLabel* widthLabel;
+    QLabel* heightLabel;
+    QLabel* layoutLabel;
+    QLabel* typeLabel;
+    QLabel* lDisplay;
+    bool multiDisp;
+    QPushButton* pbIdentDisp;
+    QList &lt;QMainWindow*&gt; identWins;
+private:
+    void readConfig();
 };
 
 #endif
diff --git a/sshmasterconnection.cpp b/sshmasterconnection.cpp
index 1f89963..ef08cd8 100644
--- a/sshmasterconnection.cpp
+++ b/sshmasterconnection.cpp
@@ -27,16 +27,18 @@
 #ifndef Q_OS_WIN
 #include &lt;arpa/inet.h&gt;
 #endif
+#include &lt;math.h&gt;
 
 #include &quot;onmainwindow.h&quot;
 
 #undef DEBUG
-// #define DEBUG
+//#define DEBUG
 
 static bool isLibSshInited=false;
 
+
 SshMasterConnection::SshMasterConnection ( QString host, int port, bool acceptUnknownServers, QString user,
-        QString pass, QString key,bool autologin, QObject* parent ) : QThread ( parent )
+        QString pass, QString key,bool autologin, bool krblogin, QObject* parent ) : QThread ( parent )
 {
     this-&gt;host=host;
     this-&gt;port=port;
@@ -47,12 +49,20 @@ SshMasterConnection::SshMasterConnection ( QString host, int port, bool acceptUn
     this-&gt;acceptUnknownServers=acceptUnknownServers;
     reverseTunnel=false;
     mainWnd=(ONMainWindow*) parent;
+    kerberos=krblogin;
+#ifdef DEBUG
+    if (kerberos)
+        x2goDebug&lt;&lt;&quot;starting ssh connection with kerberos authentication&quot;&lt;&lt;endl;
+    else
+        x2goDebug&lt;&lt;&quot;starting ssh connection without kerberos authentication&quot;&lt;&lt;endl;
+#endif
+kerberos=false;
 }
 
 SshMasterConnection::SshMasterConnection ( QString host, int port, bool acceptUnknownServers, QString user,
         QString pass, QString key, bool autologin,
-        int remotePort, QString localHost, int localPort, SshProcess* creator, 
-					   QObject* parent, ONMainWindow* mwd ) : QThread ( parent )
+        int remotePort, QString localHost, int localPort, SshProcess* creator,
+        QObject* parent, ONMainWindow* mwd ) : QThread ( parent )
 {
 
     this-&gt;host=host;
@@ -76,6 +86,7 @@ SshMasterConnection* SshMasterConnection::reverseTunnelConnection ( SshProcess*
     SshMasterConnection* con=new SshMasterConnection ( host,port,acceptUnknownServers,user,pass,
             key,autologin, remotePort,localHost,
             localPort,creator,this, mainWnd);
+    con-&gt;kerberos=kerberos;
 
     connect ( con,SIGNAL ( ioErr ( SshProcess*,QString,QString ) ),this,SIGNAL ( ioErr ( SshProcess*,QString,QString ) ) );
     connect ( con,SIGNAL ( stdErr ( SshProcess*,QByteArray ) ),this,SIGNAL ( stdErr ( SshProcess*,QByteArray ) ) );
@@ -125,7 +136,7 @@ void SshMasterConnection::run()
         quit();
         return;
     }
-#ifdef Q_OS_WIN    
+#ifdef Q_OS_WIN
     ssh_options_set ( my_ssh_session, SSH_OPTIONS_SSH_DIR, (mainWnd-&gt;getHomeDirectory()+&quot;/ssh&quot;).toAscii());
 #endif
 //     ssh_options_set(my_ssh_session, SSH_OPTIONS_LOG_VERBOSITY, &amp;verbosity);
@@ -153,21 +164,26 @@ void SshMasterConnection::run()
     }
 
     ssh_options_set ( my_ssh_session, SSH_OPTIONS_USER, user.toAscii() );
-#ifdef Q_OS_WIN    
+#ifdef Q_OS_WIN
     ssh_options_set ( my_ssh_session, SSH_OPTIONS_SSH_DIR, (mainWnd-&gt;getHomeDirectory()+&quot;/ssh&quot;).toAscii());
-#endif    
+
+#ifdef DEBUG
     x2goDebug&lt;&lt;&quot;setting SSH DIR to &quot;&lt;&lt;mainWnd-&gt;getHomeDirectory()+&quot;/ssh&quot;;
+#endif
+#endif
 
     if ( userAuth() )
     {
-      #ifdef DEBUG
+#ifdef DEBUG
         x2goDebug&lt;&lt;&quot;user auth OK\n&quot;;
-      #endif
+#endif
         emit connectionOk(host);
     }
     else
     {
-        QString err=ssh_get_error ( my_ssh_session );
+        QString err;
+        if (!kerberos)
+            err=ssh_get_error ( my_ssh_session );
         QString message=tr ( &quot;Authentication failed&quot; );
         x2goDebug&lt;&lt;message&lt;&lt;&quot; - &quot;&lt;&lt;err;
         emit userAuthError ( authErrors.join ( &quot;\n&quot; ) );
@@ -237,6 +253,8 @@ bool SshMasterConnection::sshConnect()
 
 }
 
+
+
 int SshMasterConnection::serverAuth ( QString&amp; errorMsg )
 {
 #ifdef DEBUG
@@ -250,6 +268,7 @@ int SshMasterConnection::serverAuth ( QString&amp; errorMsg )
     state = ssh_is_server_known ( my_ssh_session );
     hlen = ssh_get_pubkey_hash ( my_ssh_session, &amp;hash );
 
+
     if ( hlen &lt; 0 )
         return SSH_SERVER_ERROR;
 
diff --git a/sshmasterconnection.h b/sshmasterconnection.h
index 0de9a22..c5d79e1 100644
--- a/sshmasterconnection.h
+++ b/sshmasterconnection.h
@@ -56,7 +56,7 @@ class SshMasterConnection: public QThread
 public:
     void run();
     SshMasterConnection(QString host, int port, bool acceptUnknownServers, QString user,
-                        QString pass, QString key,bool autologin, QObject* parent = 0);
+                        QString pass, QString key, bool autologin, bool krblogin, QObject* parent = 0);
     ~SshMasterConnection();
     static void finalizeLibSsh();
     void addChannelConnection(SshProcess* creator, int sock, QString forwardHost,
@@ -66,16 +66,33 @@ public:
     void disconnectSession();
     void setAcceptUnknownServers(bool accept)
     {
-      acceptUnknownServers=accept;
+        acceptUnknownServers=accept;
     }
-    SshMasterConnection* reverseTunnelConnection(SshProcess* creator, int remotePort, QString localHost, int localPort);
-    QString getHost(){return host;}
+    SshMasterConnection* reverseTunnelConnection(SshProcess* creator, int remotePort,
+            QString localHost, int localPort);
+    QString getHost()
+    {
+        return host;
+    }
+    QString getUser()
+    {
+        return user;
+    }
+    int getPort()
+    {
+        return port;
+    }
+    bool useKerberos()
+    {
+        return kerberos;
+    };
+
 
 private:
     SshMasterConnection(QString host, int port, bool acceptUnknownServers, QString user, QString pass, QString key,
                         bool autologin,
-                        int remotePort, QString localHost, int localPort, SshProcess* creator, 
-			QObject* parent, ONMainWindow* parWnd);
+                        int remotePort, QString localHost, int localPort, SshProcess* creator,
+                        QObject* parent, ONMainWindow* parWnd);
     bool sshConnect();
     bool userAuthWithPass();
     bool userAuthAuto();
@@ -85,6 +102,9 @@ private:
     void finalize(int arg1);
     void copy();
     int serverAuth(QString&amp; errorMsg);
+#ifdef Q_OS_WIN
+    void parseKnownHosts();
+#endif
 
 private:
     ssh_session my_ssh_session;
@@ -108,8 +128,10 @@ private:
     int reverseTunnelLocalPort;
     bool acceptUnknownServers;
     QString reverseTunnelLocalHost;
-    SshProcess* reverseTunnelCreator;   
+    SshProcess* reverseTunnelCreator;
     ONMainWindow* mainWnd;
+    bool kerberos;
+    QString sshProcErrString;
 
 signals:
     void stdErr(SshProcess* caller, QByteArray data);
diff --git a/version.h b/version.h
index 373dbab..6e5c5e0 100644
--- a/version.h
+++ b/version.h
@@ -1 +1 @@
-#define VERSION &quot;3.99.0.2&quot;
+#define VERSION &quot;3.99.0.4&quot;
diff --git a/wapi.cpp b/wapi.cpp
index e565cc6..9af6085 100644
--- a/wapi.cpp
+++ b/wapi.cpp
@@ -13,415 +13,488 @@
 
 long wapiSetFSWindow ( HWND hWnd, const QRect&amp; desktopGeometry )
 {
-	long style=GetWindowLong ( hWnd,GWL_STYLE );
-	SetWindowPos ( hWnd, HWND_TOP, desktopGeometry.x(),
-	               desktopGeometry.y(),
-	               desktopGeometry.width(),
-	               desktopGeometry.height(),
-	               SWP_FRAMECHANGED );
-	SetWindowLong ( hWnd, GWL_STYLE,
-	                WS_VISIBLE | WS_SYSMENU |
-	                WS_CLIPCHILDREN | WS_CLIPSIBLINGS );
-
-	SetWindowPos ( hWnd, HWND_TOP, desktopGeometry.x(),
-	               desktopGeometry.y(),
-	               desktopGeometry.width(),
-	               desktopGeometry.height(),
-	               SWP_FRAMECHANGED );
-	
-	SetForegroundWindow ( hWnd );
-	return style;
+    long style=GetWindowLong ( hWnd,GWL_STYLE );
+    SetWindowPos ( hWnd, HWND_TOP, desktopGeometry.x(),
+                   desktopGeometry.y(),
+                   desktopGeometry.width(),
+                   desktopGeometry.height(),
+                   SWP_FRAMECHANGED );
+    SetWindowLong ( hWnd, GWL_STYLE,
+                    WS_VISIBLE | WS_SYSMENU |
+                    WS_CLIPCHILDREN | WS_CLIPSIBLINGS );
+
+    SetWindowPos ( hWnd, HWND_TOP, desktopGeometry.x(),
+                   desktopGeometry.y(),
+                   desktopGeometry.width(),
+                   desktopGeometry.height(),
+                   SWP_FRAMECHANGED );
+
+    SetForegroundWindow ( hWnd );
+    return style;
 }
 
 void wapiRestoreWindow( HWND hWnd, long style, const QRect&amp; desktopGeometry )
 {
-	SetWindowLong ( hWnd, GWL_STYLE,style);	
-	SetWindowPos ( hWnd, HWND_TOP, desktopGeometry.x(),
-	               desktopGeometry.y(),
-	               desktopGeometry.width(),
-	               desktopGeometry.height(),
-	               SWP_FRAMECHANGED );
+    SetWindowLong ( hWnd, GWL_STYLE,style);
+    SetWindowPos ( hWnd, HWND_TOP, desktopGeometry.x(),
+                   desktopGeometry.y(),
+                   desktopGeometry.width(),
+                   desktopGeometry.height(),
+                   SWP_FRAMECHANGED );
 }
 
 void wapiHideFromTaskBar ( HWND wnd )
 {
-	ShowWindow ( wnd, SW_HIDE ) ;
-	SetWindowLong ( wnd, GWL_EXSTYLE, GetWindowLong ( wnd, GWL_EXSTYLE )  &amp;
-	                ~WS_EX_APPWINDOW );
-	SetWindowLong ( wnd, GWL_EXSTYLE, GetWindowLong ( wnd, GWL_EXSTYLE )  |
-	                WS_EX_TOOLWINDOW );
-	ShowWindow ( wnd, SW_SHOW ) ;
+    ShowWindow ( wnd, SW_HIDE ) ;
+    SetWindowLong ( wnd, GWL_EXSTYLE, GetWindowLong ( wnd, GWL_EXSTYLE )  &amp;
+                    ~WS_EX_APPWINDOW );
+    SetWindowLong ( wnd, GWL_EXSTYLE, GetWindowLong ( wnd, GWL_EXSTYLE )  |
+                    WS_EX_TOOLWINDOW );
+    ShowWindow ( wnd, SW_SHOW ) ;
 }
 
 HWND wapiSetParent ( HWND child, HWND par )
 {
-	HWND wn=SetParent ( child,par );
-	if ( par )
-		SetWindowLong ( child, GWL_STYLE,
-		                GetWindowLong ( child, GWL_STYLE ) | WS_CHILD );
-	else
-		SetWindowLong (
-		    child, GWL_STYLE,
-		    GetWindowLong ( child, GWL_STYLE ) &amp;~ WS_CHILD );
-	SetWindowLong ( child, GWL_STYLE,
-	                GetWindowLong ( child, GWL_STYLE ) | WS_POPUP );
-	return wn;
+    HWND wn=SetParent ( child,par );
+    if ( par )
+        SetWindowLong ( child, GWL_STYLE,
+                        GetWindowLong ( child, GWL_STYLE ) | WS_CHILD );
+    else
+        SetWindowLong (
+            child, GWL_STYLE,
+            GetWindowLong ( child, GWL_STYLE ) &amp;~ WS_CHILD );
+    SetWindowLong ( child, GWL_STYLE,
+                    GetWindowLong ( child, GWL_STYLE ) | WS_POPUP );
+    return wn;
 }
 
 bool wapiClientRect ( HWND wnd, QRect&amp; rect )
 {
-	RECT rcWindow;
-	if ( GetClientRect ( wnd,&amp;rcWindow ) )
-	{
-		rect.setCoords ( rcWindow.left,
-		                 rcWindow.top,
-		                 rcWindow.right,rcWindow.bottom );
-		return true;
-	}
-	return false;
+    RECT rcWindow;
+    if ( GetClientRect ( wnd,&amp;rcWindow ) )
+    {
+        rect.setCoords ( rcWindow.left,
+                         rcWindow.top,
+                         rcWindow.right,rcWindow.bottom );
+        return true;
+    }
+    return false;
+}
+
+bool wapiWindowRectWithoutDecoration ( HWND wnd, QRect&amp; rect )
+{
+    RECT rcWindow;
+    if ( GetClientRect ( wnd,&amp;rcWindow ) )
+    {
+        POINT pnt;
+        pnt.x=0;
+        pnt.y=0;
+        ClientToScreen(wnd,&amp;pnt);
+        rect.setRect ( pnt.x,
+                       pnt.y,
+                       rcWindow.right-rcWindow.left,rcWindow.bottom-rcWindow.top );
+        return true;
+    }
+    return false;
 }
 
+
 bool wapiWindowRect ( HWND wnd, QRect&amp; rect )
 {
-	RECT rcWindow;
-	if ( GetWindowRect ( wnd,&amp;rcWindow ) )
-	{
-		rect.setCoords ( rcWindow.left,
-		                 rcWindow.top,
-		                 rcWindow.right,rcWindow.bottom );
-		return true;
-	}
-	return false;
+    RECT rcWindow;
+    if ( GetWindowRect ( wnd,&amp;rcWindow ) )
+    {
+        rect.setCoords ( rcWindow.left,
+                         rcWindow.top,
+                         rcWindow.right,rcWindow.bottom );
+        return true;
+    }
+    return false;
 }
 
 bool wapiGetBorders ( HWND wnd, int&amp; vBorder, int&amp; hBorder, int&amp; barHeight )
 {
-	WINDOWINFO wifo;
-	wifo.cbSize=sizeof ( WINDOWINFO );
-	if ( !GetWindowInfo ( wnd,&amp;wifo ) )
-		return false;
-	vBorder=wifo.cxWindowBorders;
-	hBorder=wifo.cyWindowBorders;
-	TITLEBARINFO bifo;
-	bifo.cbSize=sizeof ( TITLEBARINFO );
-	if ( !GetTitleBarInfo ( wnd,&amp;bifo ) )
-		return false;
-	barHeight=bifo.rcTitleBar.bottom-bifo.rcTitleBar.top;
-
-	return true;
+    WINDOWINFO wifo;
+    wifo.cbSize=sizeof ( WINDOWINFO );
+    if ( !GetWindowInfo ( wnd,&amp;wifo ) )
+        return false;
+    vBorder=wifo.cxWindowBorders;
+    hBorder=wifo.cyWindowBorders;
+    TITLEBARINFO bifo;
+    bifo.cbSize=sizeof ( TITLEBARINFO );
+    if ( !GetTitleBarInfo ( wnd,&amp;bifo ) )
+        return false;
+    barHeight=bifo.rcTitleBar.bottom-bifo.rcTitleBar.top;
+
+    return true;
 
 }
 
 bool wapiShowWindow ( HWND wnd, wapiCmdShow nCmdShow )
 {
-	int cmd=WAPI_SHOWNORMAL;
-	switch ( nCmdShow )
-	{
-		case WAPI_FORCEMINIMIZE:cmd=SW_FORCEMINIMIZE;break;
-		case WAPI_HIDE:cmd=SW_HIDE;break;
-		case WAPI_MAXIMIZE:cmd=SW_MAXIMIZE;break;
-		case WAPI_MINIMIZE:cmd=SW_MINIMIZE;break;
-		case WAPI_RESTORE:cmd=SW_RESTORE;break;
-		case WAPI_SHOW:cmd=SW_SHOW;break;
-		case WAPI_SHOWDEFAULT:cmd=SW_SHOWDEFAULT;break;
-		case WAPI_SHOWMAXIMIZED:cmd=SW_SHOWMAXIMIZED;break;
-		case WAPI_SHOWMINIMIZED:cmd=SW_SHOWMINIMIZED;break;
-		case WAPI_SHOWMINNOACTIVE:cmd=SW_SHOWMINNOACTIVE;break;
-		case WAPI_SHOWNA:cmd=SW_SHOWNA;break;
-		case WAPI_SHOWNOACTIVATE:cmd=SW_SHOWNOACTIVATE;break;
-		case WAPI_SHOWNORMAL:cmd=SW_SHOWNORMAL;break;
-	}
-
-	return ShowWindow ( wnd, cmd );
+    int cmd=WAPI_SHOWNORMAL;
+    switch ( nCmdShow )
+    {
+    case WAPI_FORCEMINIMIZE:
+        cmd=SW_FORCEMINIMIZE;
+        break;
+    case WAPI_HIDE:
+        cmd=SW_HIDE;
+        break;
+    case WAPI_MAXIMIZE:
+        cmd=SW_MAXIMIZE;
+        break;
+    case WAPI_MINIMIZE:
+        cmd=SW_MINIMIZE;
+        break;
+    case WAPI_RESTORE:
+        cmd=SW_RESTORE;
+        break;
+    case WAPI_SHOW:
+        cmd=SW_SHOW;
+        break;
+    case WAPI_SHOWDEFAULT:
+        cmd=SW_SHOWDEFAULT;
+        break;
+    case WAPI_SHOWMAXIMIZED:
+        cmd=SW_SHOWMAXIMIZED;
+        break;
+    case WAPI_SHOWMINIMIZED:
+        cmd=SW_SHOWMINIMIZED;
+        break;
+    case WAPI_SHOWMINNOACTIVE:
+        cmd=SW_SHOWMINNOACTIVE;
+        break;
+    case WAPI_SHOWNA:
+        cmd=SW_SHOWNA;
+        break;
+    case WAPI_SHOWNOACTIVATE:
+        cmd=SW_SHOWNOACTIVATE;
+        break;
+    case WAPI_SHOWNORMAL:
+        cmd=SW_SHOWNORMAL;
+        break;
+    }
+
+    return ShowWindow ( wnd, cmd );
 }
 
 bool wapiUpdateWindow ( HWND wnd )
 {
-	return RedrawWindow ( wnd,0,0,RDW_INVALIDATE );
+    return RedrawWindow ( wnd,0,0,RDW_INVALIDATE );
 }
 
 bool wapiMoveWindow ( HWND wnd, int x, int y, int width, int height,
                       bool repaint )
 {
-	return MoveWindow ( wnd, x, y, width, height, repaint );
+    return MoveWindow ( wnd, x, y, width, height, repaint );
 }
 
 HWND wapiFindWindow ( const ushort * className, const ushort * text )
 {
-	return FindWindowEx ( 0,0, ( LPCTSTR ) className, ( LPCTSTR ) text );
+    return FindWindowEx ( 0,0, ( LPCTSTR ) className, ( LPCTSTR ) text );
+}
+
+bool wapiSetWindowText( HWND wnd, const QString&amp; text)
+{
+    return SetWindowText(wnd, (LPCTSTR)text.utf16() );
 }
 
+void wapiSetWindowIcon ( HWND wnd, const QPixmap&amp; icon)
+{
+    int iconx=GetSystemMetrics(SM_CXICON);
+    int icony=GetSystemMetrics(SM_CYICON);
+    int smallx=GetSystemMetrics(SM_CXSMICON);
+    int smally=GetSystemMetrics(SM_CXSMICON);
+
+    HICON largeIcon=0;
+    HICON smallIcon=0;
+
+    largeIcon=icon.scaled(iconx,icony, Qt::IgnoreAspectRatio,Qt::SmoothTransformation).toWinHICON ();
+    smallIcon=icon.scaled(smallx,smally, Qt::IgnoreAspectRatio,Qt::SmoothTransformation).toWinHICON ();
+
+    x2goDebug&lt;&lt;&quot;large icon: &quot;&lt;&lt;largeIcon&lt;&lt;iconx&lt;&lt;&quot;x&quot;&lt;&lt;icony&lt;&lt;endl;
+    x2goDebug&lt;&lt;&quot;small icon: &quot;&lt;&lt;smallIcon&lt;&lt;smallx&lt;&lt;&quot;x&quot;&lt;&lt;smally&lt;&lt;endl;
+    int rez=SetClassLong(wnd,GCL_HICON, (LONG)largeIcon);
+    if (!rez)
+        x2goDebug&lt;&lt;&quot;ERROR: &quot;&lt;&lt;GetLastError()&lt;&lt;endl;
+    rez=SetClassLong(wnd,GCL_HICONSM,(LONG)smallIcon);
+    if (!rez)
+        x2goDebug&lt;&lt;&quot;ERROR: &quot;&lt;&lt;GetLastError()&lt;&lt;endl;
+    /*    ShowWindow(wnd, SW_HIDE);
+        ShowWindow(wnd, SW_SHOW);*/
+}
 
 QString wapiShortFileName ( const QString&amp; longName )
 {
-	long     length = 0;
-	TCHAR*   buffer = NULL;
-
-	length = GetShortPathName ( ( LPCTSTR ) longName.utf16(), NULL, 0 );
-	if ( !length )
-	{
-		return QString::null;
-	}
-
-	buffer = new TCHAR[length];
-	length = GetShortPathName ( ( LPCTSTR ) longName.utf16(),
-	                            buffer,length );
-	if ( !length )
-	{
-		delete []buffer;
-		return QString::null;
-	}
-	QString spath=QString::fromUtf16 ( ( const ushort* ) buffer );
-	delete []buffer;
-	return spath;
+    long     length = 0;
+    TCHAR*   buffer = NULL;
+
+    length = GetShortPathName ( ( LPCTSTR ) longName.utf16(), NULL, 0 );
+    if ( !length )
+    {
+        return QString::null;
+    }
+
+    buffer = new TCHAR[length];
+    length = GetShortPathName ( ( LPCTSTR ) longName.utf16(),
+                                buffer,length );
+    if ( !length )
+    {
+        delete []buffer;
+        return QString::null;
+    }
+    QString spath=QString::fromUtf16 ( ( const ushort* ) buffer );
+    delete []buffer;
+    return spath;
 }
 
 
 QString wapiGetDriveByLabel(const QString&amp; label)
 {
-  int len=GetLogicalDriveStrings(0,0);
-  if(len&gt;0)
-  {
-    TCHAR* buf=new TCHAR[len+1];
-    len=GetLogicalDriveStrings(len,buf);
-    for(int i=0;i&lt;len;i+=4)
-    {      
-       QString drive=QString::fromUtf16 ( ( const ushort* ) buf+i );
-       x2goDebug&lt;&lt;&quot;drive:&quot;&lt;&lt;drive;
-       TCHAR vol[MAX_PATH+1];
-       TCHAR fs[MAX_PATH+1];
-       GetVolumeInformation(buf+i,vol,MAX_PATH,0,0,0,fs,MAX_PATH);       
-       QString volume=QString::fromUtf16 ( ( const ushort* ) vol );
-       x2goDebug&lt;&lt;&quot;vol:&quot;&lt;&lt;volume&lt;&lt;
-       &quot;fs:&quot;&lt;&lt;QString::fromUtf16 ( ( const ushort* ) fs );
-       if(!volume.compare(label,Qt::CaseInsensitive))
-       {
-	 x2goDebug&lt;&lt;&quot;matched! &quot;;
-	 
-	 delete []buf;
-	 return drive.replace(&quot;:\\&quot;,&quot;&quot;);
-       }
+    int len=GetLogicalDriveStrings(0,0);
+    if (len&gt;0)
+    {
+        TCHAR* buf=new TCHAR[len+1];
+        len=GetLogicalDriveStrings(len,buf);
+        for (int i=0;i&lt;len;i+=4)
+        {
+            QString drive=QString::fromUtf16 ( ( const ushort* ) buf+i );
+            x2goDebug&lt;&lt;&quot;drive:&quot;&lt;&lt;drive;
+            TCHAR vol[MAX_PATH+1];
+            TCHAR fs[MAX_PATH+1];
+            GetVolumeInformation(buf+i,vol,MAX_PATH,0,0,0,fs,MAX_PATH);
+            QString volume=QString::fromUtf16 ( ( const ushort* ) vol );
+            x2goDebug&lt;&lt;&quot;vol:&quot;&lt;&lt;volume&lt;&lt;
+            &quot;fs:&quot;&lt;&lt;QString::fromUtf16 ( ( const ushort* ) fs );
+            if (!volume.compare(label,Qt::CaseInsensitive))
+            {
+                x2goDebug&lt;&lt;&quot;matched! &quot;;
+
+                delete []buf;
+                return drive.replace(&quot;:\\&quot;,&quot;&quot;);
+            }
+        }
+        delete []buf;
     }
-    delete []buf;
-  }
-  
-  return label;
+
+    return label;
 }
 
 
 QString getNameFromSid ( PSID psid, QString* systemName )
 {
-	DWORD length=0;
-	DWORD dlength=0;
-	TCHAR* name=0;
-	TCHAR* sysName=0;
-	SID_NAME_USE eUse;
-
-	LookupAccountSid ( 0,psid,
-	                   name,&amp;length,sysName,&amp;dlength,&amp;eUse );
-	if ( !length )
-	{
-		return QString::null;
-	}
-
-	name=new TCHAR[length];
-	sysName=new TCHAR[dlength];
-
-	if ( ! LookupAccountSid ( 0,psid,
-	                          name,&amp;length,sysName,
-	                          &amp;dlength,&amp;eUse ) )
-	{
-		delete []name;
-		delete []sysName;
-		return QString::null;
-	}
-
-	QString strName=QString::fromUtf16 (
-	                    ( const ushort* ) name );
-	if ( systemName )
-		*systemName=QString::fromUtf16 (
-		                ( const ushort* ) sysName );
-	delete []sysName;
-	delete []name;
-	return strName;
+    DWORD length=0;
+    DWORD dlength=0;
+    TCHAR* name=0;
+    TCHAR* sysName=0;
+    SID_NAME_USE eUse;
+
+    LookupAccountSid ( 0,psid,
+                       name,&amp;length,sysName,&amp;dlength,&amp;eUse );
+    if ( !length )
+    {
+        return QString::null;
+    }
+
+    name=new TCHAR[length];
+    sysName=new TCHAR[dlength];
+
+    if ( ! LookupAccountSid ( 0,psid,
+                              name,&amp;length,sysName,
+                              &amp;dlength,&amp;eUse ) )
+    {
+        delete []name;
+        delete []sysName;
+        return QString::null;
+    }
+
+    QString strName=QString::fromUtf16 (
+                        ( const ushort* ) name );
+    if ( systemName )
+        *systemName=QString::fromUtf16 (
+                        ( const ushort* ) sysName );
+    delete []sysName;
+    delete []name;
+    return strName;
 }
 
 QString getStringFromSid ( PSID psid )
 {
-	LPTSTR stringSid;
-	ConvertSidToStringSid ( psid,
-	                        &amp;stringSid );
-	QString str=QString::fromUtf16 (
-	                ( const ushort* ) stringSid );
-	LocalFree ( stringSid );
-	return str;
+    LPTSTR stringSid;
+    ConvertSidToStringSid ( psid,
+                            &amp;stringSid );
+    QString str=QString::fromUtf16 (
+                    ( const ushort* ) stringSid );
+    LocalFree ( stringSid );
+    return str;
 }
 
 bool wapiAccountInfo ( QString* retSid, QString* retUname,
                        QString* primaryGroupSID, QString* primaryGroupName,
                        QString* retSysName )
 {
-	HANDLE hToken;
-	if ( !OpenProcessToken ( GetCurrentProcess(),
-	                         TOKEN_QUERY, &amp;hToken ) )
-	{
-		return false;
-	}
-	if ( primaryGroupSID || primaryGroupName )
-	{
-		PTOKEN_PRIMARY_GROUP pGroupInfo=0;
-		DWORD dwResult=0;
-		DWORD dwSize=0;
-		if ( !GetTokenInformation ( hToken, TokenPrimaryGroup,
-		                            NULL, dwSize, &amp;dwSize ) )
-		{
-			dwResult = GetLastError();
-			if ( dwResult != ERROR_INSUFFICIENT_BUFFER )
-			{
-				CloseHandle ( hToken );
-				return false;
-			}
-		}
-		pGroupInfo = ( PTOKEN_PRIMARY_GROUP ) GlobalAlloc ( GPTR,
-		             dwSize );
-
-		if ( ! GetTokenInformation ( hToken, TokenPrimaryGroup,
-		                             pGroupInfo,
-		                             dwSize, &amp;dwSize ) )
-		{
-			if ( pGroupInfo )
-				GlobalFree ( pGroupInfo );
-			CloseHandle ( hToken );
-			return false;
-		}
-
-		if ( primaryGroupSID )
-		{
-			*primaryGroupSID=getStringFromSid (
-			                     pGroupInfo-&gt;PrimaryGroup );
-		}
-		if ( primaryGroupName )
-		{
-			*primaryGroupName=getNameFromSid (
-			                      pGroupInfo-&gt;PrimaryGroup,
-			                      retSysName );
-		}
-
-		if ( pGroupInfo )
-			GlobalFree ( pGroupInfo );
-	}
-	if ( retSid || retUname )
-	{
-		PTOKEN_USER pUserInfo=0;
-		DWORD dwResult=0;
-		DWORD dwSize=0;
-
-		if ( !GetTokenInformation ( hToken, TokenUser,
-		                            NULL, dwSize, &amp;dwSize ) )
-		{
-			dwResult = GetLastError();
-			if ( dwResult != ERROR_INSUFFICIENT_BUFFER )
-			{
-				CloseHandle ( hToken );
-				return false;
-			}
-		}
-		pUserInfo = ( PTOKEN_USER ) GlobalAlloc ( GPTR,
-		            dwSize );
-
-		if ( ! GetTokenInformation ( hToken, TokenUser,
-		                             pUserInfo,
-		                             dwSize, &amp;dwSize ) )
-		{
-			if ( pUserInfo )
-				GlobalFree ( pUserInfo );
-			CloseHandle ( hToken );
-			return false;
-		}
-
-		if ( retSid )
-		{
-			*retSid=getStringFromSid (
-			            pUserInfo-&gt;User.Sid );
-		}
-		if ( retUname )
-		{
-			*retUname=getNameFromSid (
-			              pUserInfo-&gt;User.Sid,
-			              retSysName );
-		}
-		if ( pUserInfo )
-			GlobalFree ( pUserInfo );
-	}
-	CloseHandle ( hToken );
-	return true;
+    HANDLE hToken;
+    if ( !OpenProcessToken ( GetCurrentProcess(),
+                             TOKEN_QUERY, &amp;hToken ) )
+    {
+        return false;
+    }
+    if ( primaryGroupSID || primaryGroupName )
+    {
+        PTOKEN_PRIMARY_GROUP pGroupInfo=0;
+        DWORD dwResult=0;
+        DWORD dwSize=0;
+        if ( !GetTokenInformation ( hToken, TokenPrimaryGroup,
+                                    NULL, dwSize, &amp;dwSize ) )
+        {
+            dwResult = GetLastError();
+            if ( dwResult != ERROR_INSUFFICIENT_BUFFER )
+            {
+                CloseHandle ( hToken );
+                return false;
+            }
+        }
+        pGroupInfo = ( PTOKEN_PRIMARY_GROUP ) GlobalAlloc ( GPTR,
+                     dwSize );
+
+        if ( ! GetTokenInformation ( hToken, TokenPrimaryGroup,
+                                     pGroupInfo,
+                                     dwSize, &amp;dwSize ) )
+        {
+            if ( pGroupInfo )
+                GlobalFree ( pGroupInfo );
+            CloseHandle ( hToken );
+            return false;
+        }
+
+        if ( primaryGroupSID )
+        {
+            *primaryGroupSID=getStringFromSid (
+                                 pGroupInfo-&gt;PrimaryGroup );
+        }
+        if ( primaryGroupName )
+        {
+            *primaryGroupName=getNameFromSid (
+                                  pGroupInfo-&gt;PrimaryGroup,
+                                  retSysName );
+        }
+
+        if ( pGroupInfo )
+            GlobalFree ( pGroupInfo );
+    }
+    if ( retSid || retUname )
+    {
+        PTOKEN_USER pUserInfo=0;
+        DWORD dwResult=0;
+        DWORD dwSize=0;
+
+        if ( !GetTokenInformation ( hToken, TokenUser,
+                                    NULL, dwSize, &amp;dwSize ) )
+        {
+            dwResult = GetLastError();
+            if ( dwResult != ERROR_INSUFFICIENT_BUFFER )
+            {
+                CloseHandle ( hToken );
+                return false;
+            }
+        }
+        pUserInfo = ( PTOKEN_USER ) GlobalAlloc ( GPTR,
+                    dwSize );
+
+        if ( ! GetTokenInformation ( hToken, TokenUser,
+                                     pUserInfo,
+                                     dwSize, &amp;dwSize ) )
+        {
+            if ( pUserInfo )
+                GlobalFree ( pUserInfo );
+            CloseHandle ( hToken );
+            return false;
+        }
+
+        if ( retSid )
+        {
+            *retSid=getStringFromSid (
+                        pUserInfo-&gt;User.Sid );
+        }
+        if ( retUname )
+        {
+            *retUname=getNameFromSid (
+                          pUserInfo-&gt;User.Sid,
+                          retSysName );
+        }
+        if ( pUserInfo )
+            GlobalFree ( pUserInfo );
+    }
+    CloseHandle ( hToken );
+    return true;
 }
 
 void wapiShellExecute ( const QString&amp; operation, const QString&amp; file,
                         const QString&amp; parameters,
                         const QString&amp; dir, HWND win )
 {
-	if ( parameters==QString::null )
-		ShellExecute ( win, ( LPCTSTR ) ( operation.utf16() ),
-		               ( LPCTSTR ) ( file.utf16() ),0,
-		               ( LPCTSTR ) ( dir.utf16() ),SW_SHOWNORMAL );
-	else
-		ShellExecute ( win, ( LPCTSTR ) ( operation.utf16() ),
-		               ( LPCTSTR ) ( file.utf16() ),
-		               ( LPCTSTR ) ( parameters.utf16() ),
-		               ( LPCTSTR ) ( dir.utf16() ),SW_SHOWNORMAL );
+    if ( parameters==QString::null )
+        ShellExecute ( win, ( LPCTSTR ) ( operation.utf16() ),
+                       ( LPCTSTR ) ( file.utf16() ),0,
+                       ( LPCTSTR ) ( dir.utf16() ),SW_SHOWNORMAL );
+    else
+        ShellExecute ( win, ( LPCTSTR ) ( operation.utf16() ),
+                       ( LPCTSTR ) ( file.utf16() ),
+                       ( LPCTSTR ) ( parameters.utf16() ),
+                       ( LPCTSTR ) ( dir.utf16() ),SW_SHOWNORMAL );
 }
 
 QString wapiGetDefaultPrinter()
 {
-	TCHAR *prName;
-	DWORD length;
-	GetDefaultPrinter ( 0,&amp;length );
-	if ( !length )
-		return QString::null;
-	prName=new TCHAR[length];
-	GetDefaultPrinter ( prName,&amp;length );
-	if ( !length )
-	{
-		delete []prName;
-		return QString::null;
-	}
-	QString printer=QString::fromUtf16 ( ( const ushort* ) prName );
-	delete []prName;
-	return printer;
+    TCHAR *prName;
+    DWORD length;
+    GetDefaultPrinter ( 0,&amp;length );
+    if ( !length )
+        return QString::null;
+    prName=new TCHAR[length];
+    GetDefaultPrinter ( prName,&amp;length );
+    if ( !length )
+    {
+        delete []prName;
+        return QString::null;
+    }
+    QString printer=QString::fromUtf16 ( ( const ushort* ) prName );
+    delete []prName;
+    return printer;
 
 }
 
 QStringList wapiGetLocalPrinters()
 {
-	QStringList printers;
-	PRINTER_INFO_4 *info_array;
-	DWORD sizeOfArray;
-	DWORD bufSize=0;
-	DWORD sizeNeeded=0;
-	EnumPrinters ( PRINTER_ENUM_LOCAL,0,4,NULL,bufSize,
-	               &amp;sizeNeeded,&amp;sizeOfArray );
-	if ( !sizeNeeded )
-	{
-		return printers;
-	}
-	info_array= ( PRINTER_INFO_4* ) new char[sizeNeeded];
-	if ( !info_array )
-		return printers;
-	bufSize=sizeNeeded;
-	EnumPrinters ( PRINTER_ENUM_LOCAL,0,4, ( LPBYTE ) info_array,bufSize,
-	               &amp;sizeNeeded,&amp;sizeOfArray );
-	if ( !sizeNeeded || !sizeOfArray )
-	{
-		delete []info_array;
-		return printers;
-	}
-	for ( uint i=0;i&lt;sizeOfArray;++i )
-	{
-		printers&lt;&lt;QString::fromUtf16 (
-		    ( const ushort* ) ( info_array[i].pPrinterName ) );
-	}
-	delete []info_array;
-	return printers;
+    QStringList printers;
+    PRINTER_INFO_4 *info_array;
+    DWORD sizeOfArray;
+    DWORD bufSize=0;
+    DWORD sizeNeeded=0;
+    EnumPrinters ( PRINTER_ENUM_LOCAL,0,4,NULL,bufSize,
+                   &amp;sizeNeeded,&amp;sizeOfArray );
+    if ( !sizeNeeded )
+    {
+        return printers;
+    }
+    info_array= ( PRINTER_INFO_4* ) new char[sizeNeeded];
+    if ( !info_array )
+        return printers;
+    bufSize=sizeNeeded;
+    EnumPrinters ( PRINTER_ENUM_LOCAL,0,4, ( LPBYTE ) info_array,bufSize,
+                   &amp;sizeNeeded,&amp;sizeOfArray );
+    if ( !sizeNeeded || !sizeOfArray )
+    {
+        delete []info_array;
+        return printers;
+    }
+    for ( uint i=0;i&lt;sizeOfArray;++i )
+    {
+        printers&lt;&lt;QString::fromUtf16 (
+            ( const ushort* ) ( info_array[i].pPrinterName ) );
+    }
+    delete []info_array;
+    return printers;
 }
 #endif
diff --git a/wapi.h b/wapi.h
index ffdd392..e7ec667 100644
--- a/wapi.h
+++ b/wapi.h
@@ -6,34 +6,39 @@
 #include &lt;QPoint&gt;
 #include &lt;QString&gt;
 #include &lt;QStringList&gt;
+#include &lt;QPixmap&gt;
+
 enum wapiCmdShow
 {
-	WAPI_FORCEMINIMIZE,
-	WAPI_HIDE,
-	WAPI_MAXIMIZE,
-	WAPI_MINIMIZE,
-	WAPI_RESTORE,
-	WAPI_SHOW,
-	WAPI_SHOWDEFAULT,
-	WAPI_SHOWMAXIMIZED,
-	WAPI_SHOWMINIMIZED,
-	WAPI_SHOWMINNOACTIVE,
-	WAPI_SHOWNA,
-	WAPI_SHOWNOACTIVATE,
-	WAPI_SHOWNORMAL
+    WAPI_FORCEMINIMIZE,
+    WAPI_HIDE,
+    WAPI_MAXIMIZE,
+    WAPI_MINIMIZE,
+    WAPI_RESTORE,
+    WAPI_SHOW,
+    WAPI_SHOWDEFAULT,
+    WAPI_SHOWMAXIMIZED,
+    WAPI_SHOWMINIMIZED,
+    WAPI_SHOWMINNOACTIVE,
+    WAPI_SHOWNA,
+    WAPI_SHOWNOACTIVATE,
+    WAPI_SHOWNORMAL
 };
 
 enum wapiBtnEvent
 {
-	WAPI_LBUTTONUP,
-	WAPI_LBUTTONDOWN
+    WAPI_LBUTTONUP,
+    WAPI_LBUTTONDOWN
 };
 
 HWND wapiSetParent ( HWND child, HWND par );
 bool wapiClientRect ( HWND wnd, QRect&amp; rect );
 bool wapiWindowRect ( HWND wnd, QRect&amp; rect );
+bool wapiWindowRectWithoutDecoration(HWND wnd, QRect&amp; rect) ;
 bool wapiShowWindow ( HWND wnd, wapiCmdShow nCmdShow );
 bool wapiUpdateWindow ( HWND wnd );
+bool wapiSetWindowText ( HWND wnd, const QString&amp; text);
+void wapiSetWindowIcon ( HWND wnd, const QPixmap&amp; icon);
 bool wapiMoveWindow ( HWND wnd, int x, int y, int width, int height,
                       bool repaint );
 bool wapiGetBorders ( HWND wnd, int&amp; vBorder, int&amp; hBorder, int&amp; barHeight );
diff --git a/x2goclient.pro b/x2goclient.pro
old mode 100644
new mode 100755
index a7deb90..d10dfcb
--- a/x2goclient.pro
+++ b/x2goclient.pro
@@ -108,7 +108,7 @@ RESOURCES += resources.rcc
 
 linux-g++ {
     message(building $$TARGET with ldap and cups)
-    LIBS += -lldap -lcups -lX11
+    LIBS += -lldap -lcups -lX11 -lXpm
 }
 linux-g++-64 {
     message(building $$TARGET with ldap and cups)
@@ -127,8 +127,8 @@ macx {
 }
 win32-* {
     message(building $$TARGET for windows without ldap and cups)
-    LIBS += -lwinspool
-    CONFIG += static
+    LIBS += -lwinspool -lws2_32
+    CONFIG += static release
 }
 QT += svg network
 ICON =icons/x2go-mac.icns
diff --git a/x2goplugin.rc b/x2goplugin.rc
index c876831..75794ac 100644
--- a/x2goplugin.rc
+++ b/x2goplugin.rc
@@ -1,8 +1,8 @@
 1 TYPELIB &quot;x2goplugin.rc&quot;
 
 1 VERSIONINFO
- FILEVERSION 3,99,0,2
- PRODUCTVERSION 3,99,0,2
+ FILEVERSION 3,99,0,4
+ PRODUCTVERSION 3,99,0,4
  FILEFLAGSMASK 0x3fL
 #ifdef _DEBUG
  FILEFLAGS 0x1L
@@ -21,13 +21,13 @@ BEGIN
             VALUE &quot;FileDescription&quot;, &quot;Allows you to start X2Go session in a webbrowser\0&quot;
 	    VALUE &quot;FileExtents&quot;, &quot;x2go\0&quot;
 	    VALUE &quot;FileOpenName&quot;, &quot;Configuration File for X2Go Session (*.x2go)\0&quot;
-            VALUE &quot;FileVersion&quot;, &quot;3, 99, 0 ,2\0&quot;
+            VALUE &quot;FileVersion&quot;, &quot;3, 99, 0 ,4\0&quot;
             VALUE &quot;InternalName&quot;, &quot;x2goplugin\0&quot;
             VALUE &quot;LegalCopyright&quot;, &quot;Copyright &#169; 2010 Obviously Nice\0&quot;
 	    VALUE &quot;MIMEType&quot;, &quot;application/x2go\0&quot;
             VALUE &quot;OriginalFilename&quot;, &quot;npx2goplugin.dll\0&quot;
-            VALUE &quot;ProductName&quot;, &quot;X2GoClient Plug-in 3.99.0.2\0&quot;
-            VALUE &quot;ProductVersion&quot;, &quot;3, 99, 0, 1\0&quot;
+            VALUE &quot;ProductName&quot;, &quot;X2GoClient Plug-in 3.99.0.4\0&quot;
+            VALUE &quot;ProductVersion&quot;, &quot;3, 99, 0, 4\0&quot;
         END
     END
     BLOCK &quot;VarFileInfo&quot;


hooks/post-receive
-- 
x2goclient.git (X2Go Client)

This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;x2goclient.git&quot; (X2Go Client).


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002014.html">[X2go-Commits] x2goclient.git - master (branch) updated:	3.99.0.2-11-ge665a27
</A></li>
	<LI>Next message: <A HREF="002016.html">[X2go-Commits] x2goclient.git - master (branch) updated:	3.99.0.2-12-ge3a8f0e
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2015">[ date ]</a>
              <a href="thread.html#2015">[ thread ]</a>
              <a href="subject.html#2015">[ subject ]</a>
              <a href="author.html#2015">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/x2go-commits">More information about the X2go-commits
mailing list</a><br>
</body></html>
