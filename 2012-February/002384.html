<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [X2go-Commits] x2gothinclient.git - master (branch) updated:	1.0.1.5-11-gfe09501
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/x2go-commits/2012-February/index.html" >
   <LINK REL="made" HREF="mailto:x2go-commits%40lists.berlios.de?Subject=Re%3A%20%5BX2go-Commits%5D%20x2gothinclient.git%20-%20master%20%28branch%29%20updated%3A%0A%091.0.1.5-11-gfe09501&In-Reply-To=%3C20120224120957.3B6405DB17%40ymir%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002383.html">
   <LINK REL="Next"  HREF="002385.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[X2go-Commits] x2gothinclient.git - master (branch) updated:	1.0.1.5-11-gfe09501</H1>
    <B>X2go dev team</B> 
    <A HREF="mailto:x2go-commits%40lists.berlios.de?Subject=Re%3A%20%5BX2go-Commits%5D%20x2gothinclient.git%20-%20master%20%28branch%29%20updated%3A%0A%091.0.1.5-11-gfe09501&In-Reply-To=%3C20120224120957.3B6405DB17%40ymir%3E"
       TITLE="[X2go-Commits] x2gothinclient.git - master (branch) updated:	1.0.1.5-11-gfe09501">git-admin at x2go.org
       </A><BR>
    <I>Fri Feb 24 13:09:57 CET 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="002383.html">[X2go-Commits] x2goclient.git - master (branch) updated:	3.99.1.0-7-g236d841
</A></li>
        <LI>Next message: <A HREF="002385.html">[X2go-Commits] x2gothinclient.git - master (branch) updated:	1.0.1.5-11-g7d5e199
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2384">[ date ]</a>
              <a href="thread.html#2384">[ thread ]</a>
              <a href="subject.html#2384">[ subject ]</a>
              <a href="author.html#2384">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch, master has been updated
       via  fe095012e879566e5a782b791f3aed8a2b150d7a (commit)
      from  cbd84540554db2861d2fd431d12e1ca7754c9fe2 (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
commit fe095012e879566e5a782b791f3aed8a2b150d7a
Author: Oleksandr Shneyder &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">oleksandr.shneyder at treuchtlingen.de</A>&gt;
Date:   Fri Feb 24 13:06:48 2012 +0100

    Support for new fetures of X2Go Client

-----------------------------------------------------------------------

Summary of changes:
 debian/changelog                                   |   10 ++++
 debian/control                                     |   30 +-----------
 debian/rules                                       |    3 -
 debian/x2gothinshutdown.install                    |    1 -
 debian/x2gothinshutdown.manpages                   |    1 -
 x2gothinclient/sbin/x2gothinclientd                |   37 +++++-----------
 .../share/x2gothinclient_start                     |    4 ++
 x2gothinshutdown/man/thinshutdown.1                |   25 -----------
 x2gothinshutdown/thinshutdown/mb.cpp               |   18 --------
 x2gothinshutdown/thinshutdown/mb.h                 |   13 ------
 x2gothinshutdown/thinshutdown/power-button.png     |  Bin 742 -&gt; 0 bytes
 x2gothinshutdown/thinshutdown/resources.rcc        |    5 --
 x2gothinshutdown/thinshutdown/thinshutdown.cpp     |   46 --------------------
 x2gothinshutdown/thinshutdown/thinshutdown.pro     |   13 ------
 14 files changed, 29 insertions(+), 177 deletions(-)
 delete mode 100644 debian/x2gothinshutdown.install
 delete mode 100644 debian/x2gothinshutdown.manpages
 delete mode 100644 x2gothinshutdown/man/thinshutdown.1
 delete mode 100644 x2gothinshutdown/thinshutdown/mb.cpp
 delete mode 100644 x2gothinshutdown/thinshutdown/mb.h
 delete mode 100644 x2gothinshutdown/thinshutdown/power-button.png
 delete mode 100644 x2gothinshutdown/thinshutdown/resources.rcc
 delete mode 100644 x2gothinshutdown/thinshutdown/thinshutdown.cpp
 delete mode 100644 x2gothinshutdown/thinshutdown/thinshutdown.pro

The diff of changes is:
diff --git a/debian/changelog b/debian/changelog
index 37f7dbb..d118043 100644
--- a/debian/changelog
+++ b/debian/changelog
@@ -1,10 +1,20 @@
 x2gothinclient (1.0.1.6-0~x2go1) UNRELEASED; urgency=low
 
+  [ Mike Gabriel ]
   * New upstream version (1.0.1.6):
     - Add background image support.
     - Add new boot splash background image.
     - New look'n'feel for boot splash menu.
 
+  [ Oleksandr Shneyder ]
+  * New upstream version (1.0.1.6):
+   - x2gothinshutdown is removed.
+   - Options --thinclient and --haltbt added to x2gothinclient_sessions.
+   - x2gothinclientd is modified to use x2goclient shutdown button
+     instead of x2gothinshutdown.
+   - gnupg-agent, pinentry-x2go and gpgsm added to &quot;Recommends&quot; section
+     for package x2gothinclient.
+
  -- Mike Gabriel &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">mike.gabriel at das-netzwerkteam.de</A>&gt;  Wed, 01 Feb 2012 13:51:00 +0100
 
 x2gothinclient (1.0.1.5-0~x2go1) unstable; urgency=low
diff --git a/debian/control b/debian/control
index 4348bf8..4c562b0 100644
--- a/debian/control
+++ b/debian/control
@@ -48,15 +48,16 @@ Depends:
  ${misc:Depends},
  psmisc,
  x2goclient,
- x2gothinshutdown,
  xauth,
  xinit,
  locales
 Recommends:
  x2gocdmanager,
- x2gothinshutdown,
  x2gousbmount,
  x2gosmartcardrules,
+ gnupg-agent,
+ pinentry-x2go,
+ gpgsm,
  vim,
  mc,
  acpid,
@@ -130,31 +131,6 @@ Description: clientside daemon enabling automatic CD-Rom mounting
  This package adds a client-side daemon to your X2Go thin client that enables
  automatic CD-ROM mounting within thin client X2Go sessions.
 
-Package: x2gothinshutdown
-Architecture: any
-Depends:
- ${shlibs:Depends},
- ${misc:Depends},
- libqt4-gui,
-Conflicts: 
- x2gocdmanager (&lt;= 1.0.1.2-0~)
-Description: shutdown button for X2Go thin client
- X2Go is a server based computing environment with
-    - session resuming
-    - low bandwith support
-    - LDAP support
-    - client side mass storage mounting support
-    - audio support
-    - authentication by smartcard and USB stick
- .
- x2gothinshutdown:
- --------------
- IMPORTANT: Use this Package only for the x2go THIN CLIENT ENVIRONMENT
- (This package is meant to be installed in a CHROOT environment!!!)
- .
- This package provides an on-screen power-off button (Qt4) for shutting 
- down your X2Go thin client.
-
 Package: x2gosmartcardrules
 Architecture: all
 Depends:
diff --git a/debian/rules b/debian/rules
index d10f2e9..d2fdbb4 100755
--- a/debian/rules
+++ b/debian/rules
@@ -12,7 +12,6 @@ configure: configure-stamp
 configure-stamp:
 	dh_testdir
 	cd x2gocdmanager/powerej      &amp;&amp; qmake-qt4 powerej.pro
-	cd x2gothinshutdown/thinshutdown &amp;&amp; qmake-qt4 thinshutdown.pro
 	touch $@
 
 build: build-stamp
@@ -20,14 +19,12 @@ build-stamp: configure-stamp
 	dh_testdir
 	dh_prep
 	$(MAKE) -C x2gocdmanager/powerej
-	$(MAKE) -C x2gothinshutdown/thinshutdown
 	touch $@
 
 clean:
 	dh_testdir
 	dh_testroot
 	[ ! -f x2gocdmanager/powerej/Makefile ] || $(MAKE) -C x2gocdmanager/powerej distclean
-	[ ! -f x2gothinshutdown/thinshutdown/Makefile ] || $(MAKE) -C x2gothinshutdown/thinshutdown distclean
 	dh_clean build-stamp configure-stamp
 
 binary-indep: build
diff --git a/debian/x2gothinshutdown.install b/debian/x2gothinshutdown.install
deleted file mode 100644
index 225868f..0000000
--- a/debian/x2gothinshutdown.install
+++ /dev/null
@@ -1 +0,0 @@
-x2gothinshutdown/thinshutdown/thinshutdown  usr/sbin
diff --git a/debian/x2gothinshutdown.manpages b/debian/x2gothinshutdown.manpages
deleted file mode 100644
index dca66a8..0000000
--- a/debian/x2gothinshutdown.manpages
+++ /dev/null
@@ -1 +0,0 @@
-x2gothinshutdown/man/thinshutdown.1
\ No newline at end of file
diff --git a/x2gothinclient/sbin/x2gothinclientd b/x2gothinclient/sbin/x2gothinclientd
index a7f4af0..eb0be03 100755
--- a/x2gothinclient/sbin/x2gothinclientd
+++ b/x2gothinclient/sbin/x2gothinclientd
@@ -89,15 +89,15 @@ elsif ($pid == 0 )
 
 	while(sleep 1)
 	{
-
-		my $thinshutdown_delay = 4;
-
+		# test if shutdown button on X2Go Client was clicked
+		if ( -e &quot;/home/x2goclient/.halt&quot;)
+		{
+			system(&quot;shutdown -h now&quot;);
+		}
 		# test if XServer is running, if not launch it...
 		if ( check_x() ==0 )
 		{
 			system(&quot;/usr/bin/Xorg -br &amp;&quot;);
-			# delay appearance of thinshutdown button a little longer on X server (re)start
-			$thinshutdown_delay = 10;
 		}
 
 		# test if pulseaudio is running, if not launch it...
@@ -114,26 +114,13 @@ elsif ($pid == 0 )
 			$x2goclient_pid = eval {
 				open3( \*IN, \*OUT, \*ERR, &quot;su - x2goclient -c 'DISPLAY=:0 bash -c \&quot;/etc/x2go/x2gothinclient_start &amp;\&quot;'&quot;);
 			};
-		}
-
-		# handle availability of the thinshutdown button GUI...
-		my $outp=`ps ax`;
-		my $CLIENT=($outp =~ m/x2goclient/);
-		my $PROXY=($outp =~ m/nxproxy/);
-		my $SHUTD=($outp =~ m/thinshutdown/);
-		if ( $SHUTD &amp;&amp; $PROXY )
-		{
-			system(&quot;killall thinshutdown&quot;);
-		}
-		if (  !$SHUTD &amp;&amp; !$PROXY &amp;&amp; $CLIENT)
-		{
-			system(&quot;sleep $thinshutdown_delay; DISPLAY=:0 thinshutdown &amp;&quot;);
-		}
-
-		## wait for x2goclient to finish
-		if ( check_client() )
-		{
-			waitpid( $x2goclient_pid, 0 );
+			## give X2Go Client some time to start
+			sleep(3);
+			## wait for x2goclient to finish
+			if ( check_client() )
+			{
+				waitpid( $x2goclient_pid, 0 );
+			}
 		}
 	}
 }
diff --git a/x2gothinclientmanagement/share/x2gothinclient_start b/x2gothinclientmanagement/share/x2gothinclient_start
index abc1b6f..b603c00 100755
--- a/x2gothinclientmanagement/share/x2gothinclient_start
+++ b/x2gothinclientmanagement/share/x2gothinclient_start
@@ -27,6 +27,8 @@
                     --kbd-type=pc105/de \
                     --set-kbd=1 \
                     --geometry=fullscreen \
+                    --thinclient \
+                    --haltbt \
                     --read-exports-from=/home/x2goclient/export \
                     --background=/etc/x2go/x2goclient-background.svg \
                     --no-session-edit \
@@ -39,6 +41,8 @@
 #                    --no-menu \
 #                    --maximize \
 #                    --link=lan \
+#                    --thinclient \
+#                    --haltbt \
 #                    --kbd-layout=de \
 #                    --kbd-type=pc105/de \
 #                    --set-kbd=1 \
diff --git a/x2gothinshutdown/man/thinshutdown.1 b/x2gothinshutdown/man/thinshutdown.1
deleted file mode 100644
index ead3d4a..0000000
--- a/x2gothinshutdown/man/thinshutdown.1
+++ /dev/null
@@ -1,25 +0,0 @@
-'\&quot; -*- coding: utf-8 -*-
-.if \n(.g .ds T&lt; \\FC
-.if \n(.g .ds T&gt; \\F[\n[.fam]]
-.de URL
-\\$2 \(la\\$1\(ra\\$3
-..
-.if \n(.g .mso www.tmac
-.TH thinshutdown 8 &quot;02 May 2011&quot; &quot;Version 1.0.1.x&quot; &quot;X2go Thin Client Environment&quot;
-.SH NAME
-thinshutdown \- Shutdown tool for X2Go Thin Clients.
-.SH SYNOPSIS
-'nh
-.fi
-.ad l
-\fBthinshutdown\fR 
-
-.SH DESCRIPTION
-\fBthinshutdown\fR is a tool that allows session-controlled shutdown of X2Go thin clients.
-.PP
-.SH OPTIONS
-\fBthinshutdown\fR has no known options.
-.PP
-.SH AUTHOR
-This manual has been written by Mike Gabriel &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">mike.gabriel at das-netzwerkteam.de</A>&gt; for the X2Go project
-(<A HREF="http://www.x2go.org">http://www.x2go.org</A>).
diff --git a/x2gothinshutdown/thinshutdown/mb.cpp b/x2gothinshutdown/thinshutdown/mb.cpp
deleted file mode 100644
index 7d81e04..0000000
--- a/x2gothinshutdown/thinshutdown/mb.cpp
+++ /dev/null
@@ -1,18 +0,0 @@
-#include &quot;mb.h&quot;
-#include &lt;QProcess&gt;
-#include &lt;QFile&gt;
-#include &lt;QTextStream&gt;
-#include &lt;QDebug&gt;
-
-MPushButton::MPushButton():QPushButton(&quot;&quot;,0)
-{
-    QPixmap p(&quot;:/power-button.png&quot;);
-    setIcon(p);
-    setFlat(true);
-    connect(this,SIGNAL(clicked()),this,SLOT(slot_cl()));
-}
-
-void MPushButton::slot_cl()
-{
-       QProcess::startDetached(&quot;halt&quot;);
-}
diff --git a/x2gothinshutdown/thinshutdown/mb.h b/x2gothinshutdown/thinshutdown/mb.h
deleted file mode 100644
index 7fc94ea..0000000
--- a/x2gothinshutdown/thinshutdown/mb.h
+++ /dev/null
@@ -1,13 +0,0 @@
-#ifndef _______MB_H_
-#define _______MB_H_ 
-
-#include &lt;QPushButton&gt;
-class MPushButton: public QPushButton
-{
-Q_OBJECT
-   public:
-      MPushButton();
-    private slots:
-   void slot_cl();
-};
-#endif
diff --git a/x2gothinshutdown/thinshutdown/power-button.png b/x2gothinshutdown/thinshutdown/power-button.png
deleted file mode 100644
index 03b1d1b..0000000
Binary files a/x2gothinshutdown/thinshutdown/power-button.png and /dev/null differ
diff --git a/x2gothinshutdown/thinshutdown/resources.rcc b/x2gothinshutdown/thinshutdown/resources.rcc
deleted file mode 100644
index fa02634..0000000
--- a/x2gothinshutdown/thinshutdown/resources.rcc
+++ /dev/null
@@ -1,5 +0,0 @@
-&lt;RCC&gt;
-   &lt;qresource&gt;
-       &lt;file&gt;power-button.png&lt;/file&gt;
-   &lt;/qresource&gt;
-&lt;/RCC&gt;
diff --git a/x2gothinshutdown/thinshutdown/thinshutdown.cpp b/x2gothinshutdown/thinshutdown/thinshutdown.cpp
deleted file mode 100644
index 796adad..0000000
--- a/x2gothinshutdown/thinshutdown/thinshutdown.cpp
+++ /dev/null
@@ -1,46 +0,0 @@
-/***************************************************************************
- *   Copyright (C) 2005-2012 by Oleksandr Shneyder                         *
- *   <A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">oleksandr.shneyder at obviously-nice.de</A>                                  *
- *                                                                         *
- *   This program is free software; you can redistribute it and/or modify  *
- *   it under the terms of the GNU General Public License as published by  *
- *   the Free Software Foundation; either version 2 of the License, or     *
- *   (at your option) any later version.                                   *
- *                                                                         *
- *   This program is distributed in the hope that it will be useful,       *
- *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
- *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
- *   GNU General Public License for more details.                          *
- *                                                                         *
- *   You should have received a copy of the GNU General Public License     *
- *   along with this program; if not, write to the                         *
- *   Free Software Foundation, Inc.,                                       *
- *   51 Franklin St, Fifth Floor, Boston, MA 02110-1301, USA.              *
- ***************************************************************************/
-
-
-#ifdef HAVE_CONFIG_H
-#include &lt;config.h&gt;
-#endif
-
-#include &lt;QApplication&gt;
-#include &lt;QTranslator&gt;
-#include &lt;QLocale&gt;
-#include &lt;QFrame&gt;
-#include &lt;mb.h&gt;
-#include &lt;QPlastiqueStyle&gt;
-#include &lt;QDesktopWidget&gt;
-
-using namespace std;
-int main(int argc, char *argv[])
-{
-  QApplication app(argc,argv);
-  app.setStyle(new QPlastiqueStyle());
-  
-// QFrame*fr =new QFrame(0,Qt::WindowStaysOnTopHint|Qt::X11BypassWindowManagerHint);
-  MPushButton*fr =new MPushButton();
-  fr-&gt;setFixedSize(24,24);
-  fr-&gt;move(6,6);
-  fr-&gt;show();
-  return app.exec();
-}
diff --git a/x2gothinshutdown/thinshutdown/thinshutdown.pro b/x2gothinshutdown/thinshutdown/thinshutdown.pro
deleted file mode 100644
index 344c8e9..0000000
--- a/x2gothinshutdown/thinshutdown/thinshutdown.pro
+++ /dev/null
@@ -1,13 +0,0 @@
-######################################################################
-# Automatically generated by qmake (2.01a) Fr Jun 1 09:19:29 2007
-######################################################################
-
-TEMPLATE = app
-TARGET = 
-DEPENDPATH += .
-INCLUDEPATH += .
-
-# Input
-HEADERS += mb.h
-SOURCES += thinshutdown.cpp mb.cpp
-RESOURCES += resources.rcc


hooks/post-receive
-- 
x2gothinclient.git (X2Go Thin Client Environment)

This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;x2gothinclient.git&quot; (X2Go Thin Client Environment).


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002383.html">[X2go-Commits] x2goclient.git - master (branch) updated:	3.99.1.0-7-g236d841
</A></li>
	<LI>Next message: <A HREF="002385.html">[X2go-Commits] x2gothinclient.git - master (branch) updated:	1.0.1.5-11-g7d5e199
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2384">[ date ]</a>
              <a href="thread.html#2384">[ thread ]</a>
              <a href="subject.html#2384">[ subject ]</a>
              <a href="author.html#2384">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/x2go-commits">More information about the X2go-commits
mailing list</a><br>
</body></html>
