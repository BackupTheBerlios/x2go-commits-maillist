<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [X2go-Commits] x2goserver.git - release/4.0.0.x (branch) updated:	3.1.1.9-14-g214bc14
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/x2go-commits/2012-December/index.html" >
   <LINK REL="made" HREF="mailto:x2go-commits%40lists.berlios.de?Subject=Re%3A%20%5BX2go-Commits%5D%20x2goserver.git%20-%20release/4.0.0.x%20%28branch%29%20updated%3A%0A%093.1.1.9-14-g214bc14&In-Reply-To=%3C20121230153042.7AE905DB1A%40ymir%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003920.html">
   <LINK REL="Next"  HREF="003922.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[X2go-Commits] x2goserver.git - release/4.0.0.x (branch) updated:	3.1.1.9-14-g214bc14</H1>
    <B>X2Go dev team</B> 
    <A HREF="mailto:x2go-commits%40lists.berlios.de?Subject=Re%3A%20%5BX2go-Commits%5D%20x2goserver.git%20-%20release/4.0.0.x%20%28branch%29%20updated%3A%0A%093.1.1.9-14-g214bc14&In-Reply-To=%3C20121230153042.7AE905DB1A%40ymir%3E"
       TITLE="[X2go-Commits] x2goserver.git - release/4.0.0.x (branch) updated:	3.1.1.9-14-g214bc14">git-admin at x2go.org
       </A><BR>
    <I>Sun Dec 30 16:30:42 CET 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="003920.html">[X2go-Commits] x2goserver.git - master (branch) updated:	3.1.1.3-115-g8b1b91f
</A></li>
        <LI>Next message: <A HREF="003922.html">[X2go-Commits] x2goserver.git - release/4.0.0.x (branch) updated:	3.1.1.9-15-g258bd11
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3921">[ date ]</a>
              <a href="thread.html#3921">[ thread ]</a>
              <a href="subject.html#3921">[ subject ]</a>
              <a href="author.html#3921">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch, release/4.0.0.x has been updated
       via  214bc14b65100bc223042901c96ad2e063891c9c (commit)
       via  d2ce99bd8a74b465711e8a0a775a632282224587 (commit)
       via  355c2a9cdba1acc5e373ae5401b8a6731c48bd6a (commit)
       via  23f6b25d1b586b9f82c17098f87c6b469b46d506 (commit)
       via  6199b60e71cd957a7bf49fbfde82f0bb399d0138 (commit)
       via  d38f6b8b69ee54e504446d8dd63bf78a1439a284 (commit)
       via  54ced06113c3e1d60d279d438ec485bbc040d310 (commit)
      from  961c61c1b70c53dbddea01f6cd6c5716691e3f98 (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
commit 214bc14b65100bc223042901c96ad2e063891c9c
Author: Mike Gabriel &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">mike.gabriel at das-netzwerkteam.de</A>&gt;
Date:   Sun Dec 30 16:29:08 2012 +0100

    Bump version to 4.0.0.0 (for Baikal bundle release).

commit d2ce99bd8a74b465711e8a0a775a632282224587
Author: Mike Gabriel &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">mike.gabriel at das-netzwerkteam.de</A>&gt;
Date:   Sun Dec 30 16:02:42 2012 +0100

    rename nxagent.options to x2goagent.options
    
    Conflicts (resolved by Mike Gabriel):
    	debian/changelog
    	debian/x2goserver.install
    	x2goserver/Makefile

commit 355c2a9cdba1acc5e373ae5401b8a6731c48bd6a
Author: Mike Gabriel &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">mike.gabriel at das-netzwerkteam.de</A>&gt;
Date:   Sun Dec 30 16:24:16 2012 +0100

    fix changelog

commit 23f6b25d1b586b9f82c17098f87c6b469b46d506
Author: Mike Gabriel &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">mike.gabriel at das-netzwerkteam.de</A>&gt;
Date:   Sun Dec 30 16:23:59 2012 +0100

    Create /tmp/.X11-unix if not exists.

commit 6199b60e71cd957a7bf49fbfde82f0bb399d0138
Author: Mike Gabriel &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">mike.gabriel at das-netzwerkteam.de</A>&gt;
Date:   Sun Dec 30 16:22:01 2012 +0100

    fix changelog

commit d38f6b8b69ee54e504446d8dd63bf78a1439a284
Author: Reinhard Tartler &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">siretart at tauware.de</A>&gt;
Date:   Thu Dec 20 10:14:11 2012 +0100

    Introduce /etc/x2go/nxagent.options to allow overriding nxagent options
    
    This new configuration file specifies default options that clients can
    override.
    
    This patch also disables XFIXES and GLX. Both are known to cause certain
    problems. Hopefully we find better solutions so that we can reenable
    them soon.
    
    Conflicts (by Mike Gabriel):
    	debian/changelog
    	x2goserver/Makefile

commit 54ced06113c3e1d60d279d438ec485bbc040d310
Author: Oleksandr Shneyder &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">o.shneyder at phoca-gmbh.de</A>&gt;
Date:   Tue Dec 18 14:37:53 2012 +0100

    Fix SSHFS mounting from Ubuntu clients
    
    Conflicts (resolved by Mike Gabriel):
    	debian/changelog

-----------------------------------------------------------------------

Summary of changes:
 debian/changelog                                   |   23 ++++++++++++---
 debian/x2goserver.init                             |   30 ++++++++++++++------
 x2goserver-compat/VERSION.x2goserver-compat        |    2 +-
 .../VERSION.x2goserver-extensions                  |    2 +-
 .../VERSION.x2goserver-fmbindings                  |    2 +-
 x2goserver-printing/VERSION.x2goserver-printing    |    2 +-
 x2goserver-pyhoca/VERSION.x2goserver-pyhoca        |    2 +-
 x2goserver-xsession/VERSION.x2goserver-xsession    |    2 +-
 x2goserver/Makefile                                |    4 +++
 x2goserver/VERSION.x2goserver                      |    2 +-
 x2goserver/bin/x2gomountdirs                       |    2 +-
 x2goserver/bin/x2gostartagent                      |   12 ++++++--
 x2goserver/etc/x2goagent.options                   |   15 ++++++++++
 13 files changed, 78 insertions(+), 22 deletions(-)
 create mode 100644 x2goserver/etc/x2goagent.options

The diff of changes is:
diff --git a/debian/changelog b/debian/changelog
index 7cad632..a67e2c9 100644
--- a/debian/changelog
+++ b/debian/changelog
@@ -1,21 +1,36 @@
-x2goserver (3.1.1.10-0~x2go1) UNRELEASED; urgency=low
+x2goserver (4.0.0.0-0~x2go1) UNRELEASED; urgency=low
 
   [ Jan Engelhardt ]
-  * New upstream version (3.1.1.10):
+  * New upstream version (4.0.0.0):
     - Replace script x2gobasepath by script x2gopath that makes it much easier
       for distro packagers to tweak the installation paths of X2Go Server
       components.
 
   [ Mike Gabriel ]
-  * New upstream version (3.1.1.10):
+  * Bump version to 4.0.0.0 (for Baikal bundle release).
+  * New upstream version (4.0.0.0):
     - Adapt Xinerama path in x2gopath: use $base for detecting the path to the
       Xinerama libs, as well, as is done with all the other paths.
     - Fix mounting of multiple paths, thanks to Pascal Vibet. (Fixes: #67).
 
   [ Orion Poplawski ]
-  * New upstream version (3.1.1.10):
+  * New upstream version (4.0.0.0):
     - Honour CFLAGS when compiling the server's sgid wrapper script (Fixes: #83).
 
+  [ Oleksandr Shneyder ]
+  * New upstream version (4.0.0.0):
+    - Fix SSHFS mounting from Ubuntu clients.
+    - Create /tmp/.X11-unix if not exists.
+
+  [ Reinhard Tartler ]
+  * New upstream version (4.0.0.0):
+    - Introduce /etc/x2go/x2goagent.options to allow overriding x2goagent
+      options. This new configuration file specifies default options
+      that clients can override.
+    - Disable XFIXES and GLX. Both are known to cause certain
+      problems. Hopefully we find better solutions so that we can reenable
+      them soon.
+
  -- Mike Gabriel &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">mike.gabriel at das-netzwerkteam.de</A>&gt;  Fri, 23 Nov 2012 15:35:48 +0100
 
 x2goserver (3.1.1.9-0~x2go1) unstable; urgency=low
diff --git a/debian/x2goserver.init b/debian/x2goserver.init
index b56a4cb..5ae86e4 100644
--- a/debian/x2goserver.init
+++ b/debian/x2goserver.init
@@ -9,21 +9,35 @@
 ### END INIT INFO
 
 PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
+XSOCKDIR=/tmp/.X11-unix
 
-case &quot;$1&quot; in
-	start)
+start()
+{
+		if [ ! -d $XSOCKDIR ]
+		then
+			mkdir $XSOCKDIR
+			chmod 1777 $XSOCKDIR
+		fi
 		echo &quot;Cleaning up stale X2Go sessions.&quot;
 		/usr/sbin/x2gocleansessions
-	;;
-	stop)
+}
+
+stop()
+{
 		# kill x2gocleansessions, ignore on failure
 		killall x2gocleansessions || true
+}
+
+case &quot;$1&quot; in
+	start)
+		start
+	;;
+	stop)
+		stop
 	;;
 	reload|force-reload|restart)
-		# kill x2gocleansessions, ignore on failure
-		killall x2gocleansessions || true
-		echo &quot;Cleaning up stale X2Go sessions.&quot;
-		/usr/sbin/x2gocleansessions
+		stop
+		start
 	;;
 	*)
 		N=/etc/init.d/x2goserver
diff --git a/x2goserver-compat/VERSION.x2goserver-compat b/x2goserver-compat/VERSION.x2goserver-compat
index 42ab9ff..f69d489 100644
--- a/x2goserver-compat/VERSION.x2goserver-compat
+++ b/x2goserver-compat/VERSION.x2goserver-compat
@@ -1 +1 @@
-3.1.1.10
\ No newline at end of file
+4.0.0.0
\ No newline at end of file
diff --git a/x2goserver-extensions/VERSION.x2goserver-extensions b/x2goserver-extensions/VERSION.x2goserver-extensions
index 42ab9ff..f69d489 100644
--- a/x2goserver-extensions/VERSION.x2goserver-extensions
+++ b/x2goserver-extensions/VERSION.x2goserver-extensions
@@ -1 +1 @@
-3.1.1.10
\ No newline at end of file
+4.0.0.0
\ No newline at end of file
diff --git a/x2goserver-fmbindings/VERSION.x2goserver-fmbindings b/x2goserver-fmbindings/VERSION.x2goserver-fmbindings
index 42ab9ff..f69d489 100644
--- a/x2goserver-fmbindings/VERSION.x2goserver-fmbindings
+++ b/x2goserver-fmbindings/VERSION.x2goserver-fmbindings
@@ -1 +1 @@
-3.1.1.10
\ No newline at end of file
+4.0.0.0
\ No newline at end of file
diff --git a/x2goserver-printing/VERSION.x2goserver-printing b/x2goserver-printing/VERSION.x2goserver-printing
index 42ab9ff..f69d489 100644
--- a/x2goserver-printing/VERSION.x2goserver-printing
+++ b/x2goserver-printing/VERSION.x2goserver-printing
@@ -1 +1 @@
-3.1.1.10
\ No newline at end of file
+4.0.0.0
\ No newline at end of file
diff --git a/x2goserver-pyhoca/VERSION.x2goserver-pyhoca b/x2goserver-pyhoca/VERSION.x2goserver-pyhoca
index 42ab9ff..f69d489 100644
--- a/x2goserver-pyhoca/VERSION.x2goserver-pyhoca
+++ b/x2goserver-pyhoca/VERSION.x2goserver-pyhoca
@@ -1 +1 @@
-3.1.1.10
\ No newline at end of file
+4.0.0.0
\ No newline at end of file
diff --git a/x2goserver-xsession/VERSION.x2goserver-xsession b/x2goserver-xsession/VERSION.x2goserver-xsession
index 42ab9ff..f69d489 100644
--- a/x2goserver-xsession/VERSION.x2goserver-xsession
+++ b/x2goserver-xsession/VERSION.x2goserver-xsession
@@ -1 +1 @@
-3.1.1.10
\ No newline at end of file
+4.0.0.0
\ No newline at end of file
diff --git a/x2goserver/Makefile b/x2goserver/Makefile
index 4f93d24..43fdccf 100755
--- a/x2goserver/Makefile
+++ b/x2goserver/Makefile
@@ -75,7 +75,11 @@ install_config:
 	$(INSTALL_DIR) $(DESTDIR)$(ETCDIR)/x2gosql
 	$(INSTALL_DIR) $(DESTDIR)$(ETCDIR)/x2gosql/passwords
 	$(INSTALL_FILE) etc/x2goserver.conf     $(DESTDIR)$(ETCDIR)/
+	$(INSTALL_FILE) etc/x2goagent.options   $(DESTDIR)$(ETCDIR)/
 	$(INSTALL_FILE) etc/x2gosql/sql         $(DESTDIR)$(ETCDIR)/x2gosql
+	$(INSTALL_DIR) $(DESTDIR)$(ETCDIR)/x2go_logout.d
+	$(INSTALL_FILE) etc/x2go_logout     $(DESTDIR)$(ETCDIR)/
+	$(INSTALL_FILE) etc/x2go_logout.d/* $(DESTDIR)$(ETCDIR)/x2go_logout.d/
 
 install_man:
 	$(INSTALL_DIR) $(DESTDIR)$(MANDIR)
diff --git a/x2goserver/VERSION.x2goserver b/x2goserver/VERSION.x2goserver
index 42ab9ff..f69d489 100644
--- a/x2goserver/VERSION.x2goserver
+++ b/x2goserver/VERSION.x2goserver
@@ -1 +1 @@
-3.1.1.10
\ No newline at end of file
+4.0.0.0
\ No newline at end of file
diff --git a/x2goserver/bin/x2gomountdirs b/x2goserver/bin/x2gomountdirs
index 5ebf101..ef7f139 100755
--- a/x2goserver/bin/x2gomountdirs
+++ b/x2goserver/bin/x2gomountdirs
@@ -116,7 +116,7 @@ print F $dsa_key;
 close(F);
 
 open (F,&quot;&gt;$key.ident&quot;);
-print F &quot;$host $rsa_identity&quot;;
+print F &quot;\[$host\]:$port $rsa_identity&quot;;
 close(F);
 
 chmod(0600,&quot;$key&quot;);
diff --git a/x2goserver/bin/x2gostartagent b/x2goserver/bin/x2gostartagent
index fae66ab..45b3ba5 100755
--- a/x2goserver/bin/x2gostartagent
+++ b/x2goserver/bin/x2gostartagent
@@ -30,6 +30,14 @@ SSH_PORT=30000 #First ssh port 30001
 X2GO_ROOT=&quot;${HOME}/.x2go&quot;
 export NX_ROOT=$X2GO_ROOT
 
+if [ -r /etc/x2go/x2goagent.options ]; then
+    source /etc/x2go/x2goagent.options
+fi
+
+if [ -z &quot;$X2GO_NXAGENT_OPTIONS&quot; ]; then
+    X2GO_NXAGENT_OPTIONS=&quot;$X2GO_NXAGENT_DEFAULT_OPTIONS&quot;
+fi
+
 REMOTE=localhost
 
 X2GO_CLIENT=`echo $SSH_CLIENT | awk '{print $1}'`
@@ -263,10 +271,10 @@ SESSION_WINDOW_TITLE=&quot;X2GO-${SESSION_NAME}&quot;
 
 if  [ &quot;$X2GO_STYPE&quot; == &quot;S&quot; ]; then
 	# set NX_TEMP to /tmp, make sure x2goagent starts when pam_tmpdir.so is in use
-	NX_TEMP=/tmp x2goagent $NOLISTOPT $X2GODPIOPTION_ -$SESSION_TYPE -auth &quot;$XAUTHORITY&quot; -shadow $SHADOW_DESKTOP -shadowmode $SHADOW_MODE -geometry ${X2GO_GEOMETRY} -name &quot;${SESSION_WINDOW_TITLE}&quot;  &quot;${NX_AGENT}&quot; 2&gt;&quot;${SESSION_LOG}&quot; &amp;
+	NX_TEMP=/tmp x2goagent $X2GO_NXAGENT_OPTIONS $NOLISTOPT $X2GODPIOPTION_ -$SESSION_TYPE -auth &quot;$XAUTHORITY&quot; -shadow $SHADOW_DESKTOP -shadowmode $SHADOW_MODE -geometry ${X2GO_GEOMETRY} -name &quot;${SESSION_WINDOW_TITLE}&quot;  &quot;${NX_AGENT}&quot; 2&gt;&quot;${SESSION_LOG}&quot; &amp;
 else
 	# set NX_TEMP to /tmp, make sure x2goagent starts when pam_tmpdir.so is in use
-	NX_TEMP=/tmp x2goagent $NOLISTOPT $X2GODPIOPTION_ $XDMCPOPT -$SESSION_TYPE $NOEXITPARAM -auth &quot;$XAUTHORITY&quot; -geometry ${X2GO_GEOMETRY} -name &quot;${SESSION_WINDOW_TITLE}&quot;  &quot;${NX_AGENT}&quot; 2&gt;&quot;${SESSION_LOG}&quot; &amp;
+	NX_TEMP=/tmp x2goagent $X2GO_NXAGENT_OPTIONS $NOLISTOPT $X2GODPIOPTION_ $XDMCPOPT -$SESSION_TYPE $NOEXITPARAM -auth &quot;$XAUTHORITY&quot; -geometry ${X2GO_GEOMETRY} -name &quot;${SESSION_WINDOW_TITLE}&quot;  &quot;${NX_AGENT}&quot; 2&gt;&quot;${SESSION_LOG}&quot; &amp;
 fi
 
 X2GO_AGENT_PID=$!
diff --git a/x2goserver/etc/x2goagent.options b/x2goserver/etc/x2goagent.options
new file mode 100644
index 0000000..afe12f9
--- /dev/null
+++ b/x2goserver/etc/x2goagent.options
@@ -0,0 +1,15 @@
+#
+# This file can be used to specify default options that are passed to nxagent
+# These options can be overriden by the client!
+
+X2GO_NXAGENT_DEFAULT_OPTIONS=&quot;&quot;
+
+# Disable XFIXES.
+# Workaround for <A HREF="https://bugs.launchpad.net/ubuntu/+source/libxfixes/+bug/985202">https://bugs.launchpad.net/ubuntu/+source/libxfixes/+bug/985202</A>
+#
+X2GO_NXAGENT_DEFAULT_OPTIONS+=&quot; -extension XFIXES&quot;
+
+# Disable GLX, the old mesa version is hopelessly outdated anyways.
+# Unbreaks the gnome3 control center
+#
+X2GO_NXAGENT_DEFAULT_OPTIONS+=&quot; -extension GLX&quot;


hooks/post-receive
-- 
x2goserver.git (X2Go Server)

This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;x2goserver.git&quot; (X2Go Server).

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003920.html">[X2go-Commits] x2goserver.git - master (branch) updated:	3.1.1.3-115-g8b1b91f
</A></li>
	<LI>Next message: <A HREF="003922.html">[X2go-Commits] x2goserver.git - release/4.0.0.x (branch) updated:	3.1.1.9-15-g258bd11
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3921">[ date ]</a>
              <a href="thread.html#3921">[ thread ]</a>
              <a href="subject.html#3921">[ subject ]</a>
              <a href="author.html#3921">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/x2go-commits">More information about the X2go-commits
mailing list</a><br>
</body></html>
