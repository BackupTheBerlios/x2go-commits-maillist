<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [X2go-Commits] x2goserver.git - master (branch) updated:	3.0.99-2-115-g26ca613
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/x2go-commits/2011-July/index.html" >
   <LINK REL="made" HREF="mailto:x2go-commits%40lists.berlios.de?Subject=Re%3A%20%5BX2go-Commits%5D%20x2goserver.git%20-%20master%20%28branch%29%20updated%3A%0A%093.0.99-2-115-g26ca613&In-Reply-To=%3C20110719140012.1325E5DB18%40ymir.das-netzwerkteam.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001234.html">
   <LINK REL="Next"  HREF="001236.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[X2go-Commits] x2goserver.git - master (branch) updated:	3.0.99-2-115-g26ca613</H1>
    <B>X2go dev team</B> 
    <A HREF="mailto:x2go-commits%40lists.berlios.de?Subject=Re%3A%20%5BX2go-Commits%5D%20x2goserver.git%20-%20master%20%28branch%29%20updated%3A%0A%093.0.99-2-115-g26ca613&In-Reply-To=%3C20110719140012.1325E5DB18%40ymir.das-netzwerkteam.de%3E"
       TITLE="[X2go-Commits] x2goserver.git - master (branch) updated:	3.0.99-2-115-g26ca613">git-admin at x2go.org
       </A><BR>
    <I>Tue Jul 19 16:00:11 CEST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="001234.html">[X2go-Commits] x2goserver.git - master (branch) updated:	3.0.99-2-114-gc8c54cd
</A></li>
        <LI>Next message: <A HREF="001236.html">[X2go-Commits] x2goserver.git - master (branch) updated:	3.0.99-2-116-g870f074
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1235">[ date ]</a>
              <a href="thread.html#1235">[ thread ]</a>
              <a href="subject.html#1235">[ subject ]</a>
              <a href="author.html#1235">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch, master has been updated
       via  26ca613e9d48e6368805f1a7aad471dead9cfc71 (commit)
      from  c8c54cd38251c843d97e13776b47b75e51e6cb1f (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
commit 26ca613e9d48e6368805f1a7aad471dead9cfc71
Author: Mike Gabriel &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">mike.gabriel at das-netzwerkteam.de</A>&gt;
Date:   Tue Jul 19 16:00:34 2011 +0200

    Tab'ified (forgotten) scripts in /usr/sbin.

-----------------------------------------------------------------------

Summary of changes:
 debian/changelog                  |    1 +
 x2goserver/sbin/x2gocleansessions |  146 +++---
 x2goserver/sbin/x2godbadmin       |  894 +++++++++++++++++++------------------
 3 files changed, 539 insertions(+), 502 deletions(-)

The diff of changes is:
diff --git a/debian/changelog b/debian/changelog
index 3120baf..dcb4e66 100644
--- a/debian/changelog
+++ b/debian/changelog
@@ -18,6 +18,7 @@ x2goserver (3.0.99.5-0~x2go3) UNRELEASED; urgency=low
   * Switch to setgid instead of setuid for SQLite wrapper.
   * Tab'ified postinst/postrm scripts.
   * Store SQLite db in /var/lib/x2go to comply to latest FHS.
+  * Tab'ified (forgotten) scripts in /usr/sbin.
 
   [Martin Oehler]
   * Removes old debug code fragment, fixes x2golistsessions parsing.
diff --git a/x2goserver/sbin/x2gocleansessions b/x2goserver/sbin/x2gocleansessions
index 14c38ac..1b99474 100755
--- a/x2goserver/sbin/x2gocleansessions
+++ b/x2goserver/sbin/x2gocleansessions
@@ -25,41 +25,40 @@ use strict;
 
 sub check_pid
 {
-   my $pid=shift;
-   my $sess=shift;
-   my $sec=shift;
-   if($sec &lt; 30)
-   {
-      return 1;
-   }
-   open (F,&quot;&lt;/proc/$pid/cmdline&quot;) or return 0;
-   my $text=&lt;F&gt;;
-   close (F);
-   if($text =~ m/$sess/)
-   {
-      return 1;
-   }
-   return 0;
+	my $pid=shift;
+	my $sess=shift;
+	my $sec=shift;
+	if ($sec &lt; 30)
+	{
+		return 1;
+	}
+	open (F,&quot;&lt;/proc/$pid/cmdline&quot;) or return 0;
+	my $text=&lt;F&gt;;
+	close (F);
+	if ($text =~ m/$sess/)
+	{
+		return 1;
+	}
+	return 0;
 }
 
 sub check_stat
 {
-   my $sess=shift;
-   my $user=shift;
-   my $log=&quot;~$user/.x2go/C-$sess/session.log&quot;;
-   my $text=`tail -1 $log`;
-   if($text =~ m/Session suspended/)
-   {
-       return 0;
-   }
-   return 1;
+	my $sess=shift;
+	my $user=shift;
+	my $log=&quot;~$user/.x2go/C-$sess/session.log&quot;;
+	my $text=`tail -1 $log`;
+	if ($text =~ m/Session suspended/)
+	{
+		return 0;
+	}
+		return 1;
 }
 
-
 sub catch_term
 {
-   unlink(&quot;/var/run/x2goserver.pid&quot;);
-   exit;
+	unlink(&quot;/var/run/x2goserver.pid&quot;);
+	exit;
 }
 
 my $uname;
@@ -68,59 +67,56 @@ my $serv = hostname;
 my $pid = fork();
 if (not defined $pid) 
 {
-  print &quot;resources not avilable.\n&quot;;
+	print &quot;resources not avilable.\n&quot;;
 } 
 elsif ($pid != 0) 
 {
-    open (F,&quot;&gt;/var/run/x2goserver.pid&quot;);
-    print F &quot;$pid\n&quot;;
-    close(F);
+	open (F,&quot;&gt;/var/run/x2goserver.pid&quot;);
+	print F &quot;$pid\n&quot;;
+	close(F);
 }
 elsif ($pid == 0 )
 {
+	close(STDIN);
+	close(STDOUT);
+	close(STDERR);
 
- close(STDIN);
- close(STDOUT);
- close(STDERR);
- 
- $SIG{TERM}=\&amp;catch_term;
- 
- while(sleep 5)
- {
-  $serv=`hostname`;
-  my $outp=`x2golistsessions_sql $serv 2&gt;/dev/null`;
-
-  my @outp=split(&quot;\n&quot;,&quot;$outp&quot;);
+	$SIG{TERM}=\&amp;catch_term;
 
-  for(my $i=0;$i&lt;@outp;$i++)
-  {
-     my @sinfo=split('\\|',&quot;@outp[$i]&quot;);
-     if(@sinfo[4]eq 'F')
-     {
-	 #print &quot;@sinfo[1], is blocked\n&quot;;
-	 #print &quot;(@sinfo[1])Unmounting all shares\n&quot;;	        
-	 system( &quot;su @sinfo[11] -c \&quot;export HOSTNAME &amp;&amp; x2goumount-session @sinfo[1]\&quot; 2&gt; /dev/null&quot;);
-     }       
-     elsif(! check_pid (@sinfo[0]<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">, at sinfo</A>[1]<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">, at sinfo</A>[12]))
-     {
-         system(&quot;su @sinfo[11] -c \&quot;x2gochangestatus 'F' @sinfo[1] \&quot; &gt; /dev/null&quot;);
-	 #print &quot;@sinfo[1], pid @sinfo[0] not exist, changing status from @sinfo[4] to F\n&quot;;
-	 #print &quot;(@sinfo[1])Unmounting all shares\n&quot;;	 
-	 system( &quot;su @sinfo[11] -c \&quot;export HOSTNAME &amp;&amp; x2goumount-session @sinfo[1]\&quot; 2&gt; /dev/null&quot;);
-     }
-     else
-     { 
-       if(@sinfo[4]eq 'R')
-       {
-           if(!check_stat(@sinfo[1]<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">, at sinfo</A>[11]))
-	   {
-               system(&quot;su @sinfo[11] -c  \&quot;x2gochangestatus 'S' @sinfo[1] \&quot; &gt; /dev/null&quot;);
-	       #print &quot;@sinfo[1], is suspended, changing status from @sinfo[4] to S\n&quot;;
-	       #print &quot;(@sinfo[1])Unmounting all shares\n&quot;;	        
-	       system( &quot;su @sinfo[11] -c \&quot;export HOSTNAME &amp;&amp; x2goumount-session @sinfo[1]\&quot; 2&gt; /dev/null&quot;);
-           }
-       }       
-     }
-  }
- }
-}
\ No newline at end of file
+	while(sleep 5)
+	{
+		$serv=`hostname`;
+		my $outp=`x2golistsessions_sql $serv 2&gt;/dev/null`;
+		my @outp=split(&quot;\n&quot;,&quot;$outp&quot;);
+		for (my $i=0;$i&lt;@outp;$i++)
+		{
+			my @sinfo=split('\\|',&quot;@outp[$i]&quot;);
+			if (@sinfo[4]eq 'F')
+			{
+				#print &quot;@sinfo[1], is blocked\n&quot;;
+				#print &quot;(@sinfo[1])Unmounting all shares\n&quot;;	        
+				system( &quot;su @sinfo[11] -c \&quot;export HOSTNAME &amp;&amp; x2goumount-session @sinfo[1]\&quot; 2&gt; /dev/null&quot;);
+			}
+			elsif (! check_pid (@sinfo[0]<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">, at sinfo</A>[1]<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">, at sinfo</A>[12]))
+			{
+				system(&quot;su @sinfo[11] -c \&quot;x2gochangestatus 'F' @sinfo[1] \&quot; &gt; /dev/null&quot;);
+				#print &quot;@sinfo[1], pid @sinfo[0] not exist, changing status from @sinfo[4] to F\n&quot;;
+				#print &quot;(@sinfo[1])Unmounting all shares\n&quot;;	 
+				system( &quot;su @sinfo[11] -c \&quot;export HOSTNAME &amp;&amp; x2goumount-session @sinfo[1]\&quot; 2&gt; /dev/null&quot;);
+			}
+			else
+			{ 
+				if (@sinfo[4]eq 'R')
+				{
+					if (!check_stat(@sinfo[1]<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">, at sinfo</A>[11]))
+					{
+						system(&quot;su @sinfo[11] -c  \&quot;x2gochangestatus 'S' @sinfo[1] \&quot; &gt; /dev/null&quot;);
+						#print &quot;@sinfo[1], is suspended, changing status from @sinfo[4] to S\n&quot;;
+						#print &quot;(@sinfo[1])Unmounting all shares\n&quot;;	        
+						system( &quot;su @sinfo[11] -c \&quot;export HOSTNAME &amp;&amp; x2goumount-session @sinfo[1]\&quot; 2&gt; /dev/null&quot;);
+					}
+				}
+			}
+		}
+	}
+}
diff --git a/x2goserver/sbin/x2godbadmin b/x2goserver/sbin/x2godbadmin
index 35dd8ed..b03e6aa 100755
--- a/x2goserver/sbin/x2godbadmin
+++ b/x2goserver/sbin/x2godbadmin
@@ -24,16 +24,15 @@ use strict;
 
 use Getopt::Long;
 use Config::Simple;   
-use DBI;                                                                                                                                       
-                                                       
-                                                                                                   
+use DBI;
+
 sub show_usage()
 {
-      print &quot;X2Go SQL admin interface. Use it to create x2go database and insert or remove users or groups in x2go database\n&quot;.
-            &quot;Usage:\nx2godbadmin --createdb\n&quot;.
-            &quot;x2godbadmin --listusers\n&quot;.
-            &quot;x2godbadmin --adduser|rmuser &lt;UNIX user&gt;\n&quot;.
-            &quot;x2godbadmin --addgroup|rmgroup &lt;UNIX group&gt;\n&quot;;
+	print &quot;X2Go SQL admin interface. Use it to create x2go database and insert or remove users or groups in x2go database\n&quot;.
+	      &quot;Usage:\nx2godbadmin --createdb\n&quot;.
+	      &quot;x2godbadmin --listusers\n&quot;.
+	      &quot;x2godbadmin --adduser|rmuser &lt;UNIX user&gt;\n&quot;.
+	      &quot;x2godbadmin --addgroup|rmgroup &lt;UNIX group&gt;\n&quot;;
 }
 
 my $help='';
@@ -49,449 +48,490 @@ GetOptions('listusers' =&gt; \$listusers, 'createdb' =&gt; \$createdb, 'help' =&gt; \$hel
 
 if ($help  || ! ( $createdb || $adduser || $rmuser || $addgroup || $rmgroup || $listusers))
 {
-      show_usage();
-      exit(0);
+	show_usage();
+	exit(0);
 }
 
-
 my $Config = new Config::Simple(syntax=&gt;'ini');
 $Config-&gt;read('/etc/x2go/x2gosql/sql' ) or die &quot;Can't read config file /etc/x2go/x2gosql/sql&quot;;
-if($Config-&gt;param(&quot;backend&quot;) eq 'sqlite')
+
+if ($Config-&gt;param(&quot;backend&quot;) eq 'sqlite')
+{
+my $user=&quot;x2gouser&quot;;
+	my  ($name, $pass, $uid, $pgid, $quota, $comment, $gcos, $dir, $shell, $expire) = getpwnam($user);
+	my $dbfile=&quot;$dir/x2go_sessions&quot;;
+
+	if (! $uid)
+	{
+		print &quot;Can not find user ($user)\n&quot;;
+		exit(-1);
+	}
+
+	if ($listusers|| $adduser||$addgroup||$rmuser||$rmgroup)
+	{
+		print &quot;Only \&quot;--createdb\&quot; option is available with sqlite backend\n&quot;;
+		exit(0);
+	}
+	if ($createdb)
+	{
+		if (! -d &quot;$dir&quot; )
+		{
+			mkdir(&quot;$dir&quot;);
+		}
+		if ( -e $dbfile)
+		{
+			unlink($dbfile);
+		}
+		my $dbh=DBI-&gt;connect(&quot;dbi:SQLite:dbname=$dbfile&quot;,&quot;&quot;,&quot;&quot;,{AutoCommit =&gt; 1}) or die $_;
+
+		my $sth=$dbh-&gt;prepare(&quot;
+		                      create table sessions(
+		                      session_id varchar(500) primary key,
+		                      display integer not null,
+		                      uname varchar(100) not null,
+		                      server varchar(100) not null,
+		                      client inet,
+		                      status char(1) not null default 'R',
+		                      init_time timestamp not null default CURRENT_TIMESTAMP,
+		                      last_time timestamp not null default CURRENT_TIMESTAMP,
+		                      cookie char(33),
+		                      agent_pid int,
+		                      gr_port int,
+		                      sound_port int,
+		                      fs_port int,
+		                      unique(display))
+		                      &quot;);
+		$sth-&gt;execute() or die;
+
+		my $sth=$dbh-&gt;prepare(&quot;
+		                      create table messages(mess_id varchar(20) primary key, message text)
+		                      &quot;);
+		$sth-&gt;execute() or die;
+
+		my $sth=$dbh-&gt;prepare(&quot;
+		                      create table user_messages(
+		                      mess_id varchar(20) not null,
+		                      uname varchar(100) not null)
+		                      &quot;);
+		$sth-&gt;execute() or die;
+
+		my $sth=$dbh-&gt;prepare(&quot;
+		                      create table used_ports(
+		                      server varchar(100) not null,
+		                      session_id varchar(500) references sessions on delete cascade,
+		                      port integer primary key)
+		                      &quot;);
+		$sth-&gt;execute() or die;
+
+		my $sth=$dbh-&gt;prepare(&quot;
+		                      create table mounts(
+		                      session_id varchar(500) references sessions on delete restrict,
+		                      path varchar(512) not null,
+		                      client inet not null,
+		                      primary key(path,client))
+		                      &quot;);
+		$sth-&gt;execute() or die;
+
+		my $sth=$dbh-&gt;prepare(&quot;
+		                      CREATE TRIGGER fkd_mounts_session_id
+		                      BEFORE DELETE ON sessions
+		                      FOR EACH ROW BEGIN
+		                      SELECT CASE
+		                      WHEN ((SELECT session_id FROM mounts WHERE session_id = OLD.session_id) IS NOT NULL)
+		                      THEN RAISE(ABORT, 'delete on table \&quot;sessions\&quot; violates foreign key on table \&quot;mounts\&quot;')
+		                      END;
+		                      END;
+		                      &quot;);
+		$sth-&gt;execute() or die; 
+
+		my $sth=$dbh-&gt;prepare(&quot;
+		                      CREATE TRIGGER fkd_ports_session_id
+		                      BEFORE DELETE ON sessions
+		                      FOR EACH ROW 
+		                      BEGIN
+		                      DELETE  FROM used_ports WHERE session_id = OLD.session_id;
+		                      END;
+		                      END;
+		                      &quot;);
+		$sth-&gt;execute() or die; 
+
+		$sth-&gt;finish();
+		$dbh-&gt;disconnect();
+		chmod(0770, &quot;$dir&quot;);
+		chown('root',$pgid,&quot;$dir&quot;);
+		chmod(0660, &quot;$dbfile&quot;);
+		chown('root',$pgid,&quot;$dbfile&quot;);
+
+		exit(0);
+	}
+}
+
+my $host=$Config-&gt;param(&quot;postgres.host&quot;);
+my $port=$Config-&gt;param(&quot;postgres.port&quot;);
+my $sslmode=$Config-&gt;param(&quot;postgres.ssl&quot;);
+if (!$sslmode)
+{
+	$sslmode=&quot;prefer&quot;;
+}
+my $dbadmin=$Config-&gt;param(&quot;postgres.dbadmin&quot;);
+my $x2goadmin=&quot;x2godbuser&quot;;
+my $x2goadminpass=`makepasswd`;
+chomp ($x2goadminpass);
+my $db=&quot;x2go_sessions&quot;;
+
+if (!$host)
+{
+	$host='localhost';
+}
+if (!$port)
+{
+	$port='5432';
+}
+if (!$dbadmin)
+{
+	$dbadmin='postgres';
+}
+
+open (FL,&quot;&lt; /etc/x2go/x2gosql/passwords/pgadmin &quot;) or die &quot;Can't read password file /etc/x2go/x2gosql/passwords/pgadmin&quot;;
+my $dbadminpass=&lt;FL&gt;;
+close(FL);
+chomp($dbadminpass);
+
+my $dbh;
+if ($createdb)
 {
-      my $user=&quot;x2gouser&quot;;
-      my  ($name, $pass, $uid, $pgid, $quota, $comment, $gcos, $dir, $shell, $expire) = getpwnam($user);
-      my $dbfile=&quot;$dir/x2go_sessions&quot;;
-      
-      if(! $uid)
-      {	
-	print &quot;Can not find user ($user)\n&quot;;
-	exit(-1);
-      }
-
-    
-    
-    if($listusers|| $adduser||$addgroup||$rmuser||$rmgroup)
-    {
-      print &quot;Only \&quot;--createdb\&quot; option is available with sqlite backend\n&quot;;
-      exit(0);
-    }
-    if($createdb)
-    {
-	  if (! -d &quot;$dir&quot; )
-	  {
-		mkdir(&quot;$dir&quot;);
-	  }
-          if( -e $dbfile)
-	  {
-	    unlink($dbfile);
-	  }
-	  my $dbh=DBI-&gt;connect(
-	  &quot;dbi:SQLite:dbname=$dbfile&quot;,&quot;&quot;,&quot;&quot;,{AutoCommit =&gt; 1}) or die $_;
-
-	  my $sth=$dbh-&gt;prepare(&quot;create table sessions(
-				  session_id varchar(500) primary key,
-				  display integer not null,
-				  uname varchar(100) not null,
-				  server varchar(100) not null,
-				  client inet,
-				  status char(1) not null default 'R',
-				  init_time timestamp not null default CURRENT_TIMESTAMP,
-				  last_time timestamp not null default CURRENT_TIMESTAMP,
-				  cookie char(33),
-				  agent_pid int,
-				  gr_port int,
-				  sound_port int,
-				  fs_port int,
-				  unique(display))&quot;);
-          $sth-&gt;execute() or die;
-	  
-          my $sth=$dbh-&gt;prepare(&quot;create table messages(mess_id varchar(20) primary key, message text)&quot;);
-          $sth-&gt;execute() or die;
-	  
-          my $sth=$dbh-&gt;prepare(&quot;create table user_messages(
-                mess_id varchar(20) not null,
-                uname varchar(100) not null)&quot;);
-          $sth-&gt;execute() or die;
-	  
-          my $sth=$dbh-&gt;prepare(&quot;create table used_ports(
-                server varchar(100) not null,
-                session_id varchar(500) references sessions on delete cascade,
-                port integer primary key)&quot;);
-          $sth-&gt;execute() or die;
-	  
-          my $sth=$dbh-&gt;prepare(&quot;create table mounts(
-                session_id varchar(500) references sessions on delete restrict,
-                path varchar(512) not null,
-                client inet not null,
-                primary key(path,client))&quot;);
-          $sth-&gt;execute() or die;
-	  
-          my $sth=$dbh-&gt;prepare(&quot;CREATE TRIGGER fkd_mounts_session_id
-				  BEFORE DELETE ON sessions
-				  FOR EACH ROW BEGIN
-				    SELECT CASE
-				      WHEN ((SELECT session_id FROM mounts WHERE session_id = OLD.session_id) IS NOT NULL)
-				      THEN RAISE(ABORT, 'delete on table \&quot;sessions\&quot; violates foreign key on table \&quot;mounts\&quot;')
-				    END;
-				  END;&quot;);
-          $sth-&gt;execute() or die; 
-	  
-          my $sth=$dbh-&gt;prepare(&quot;CREATE TRIGGER fkd_ports_session_id
-				  BEFORE DELETE ON sessions
-				  FOR EACH ROW 
-                                    BEGIN
-				       DELETE  FROM used_ports WHERE session_id = OLD.session_id;
-				    END;
-				  END;&quot;);
-          $sth-&gt;execute() or die; 
-	  
-	  $sth-&gt;finish();	  
-	  $dbh-&gt;disconnect();
-	  chmod(0770, &quot;$dir&quot;);
-	  chown('root',$pgid,&quot;$dir&quot;);
-	  chmod(0660, &quot;$dbfile&quot;);
-	  chown('root',$pgid,&quot;$dbfile&quot;);
-
-	  exit(0);
-    }
+	$dbh=DBI-&gt;connect(&quot;dbi:Pg:dbname=postgres;host=$host;port=$port;sslmode=$sslmode&quot;, &quot;$dbadmin&quot;, &quot;$dbadminpass&quot;,{AutoCommit =&gt; 1}) or die $_;
+	create_database();
+	$dbh-&gt;disconnect();
+	$dbh=DBI-&gt;connect(&quot;dbi:Pg:dbname=$db;host=$host;port=$port;sslmode=$sslmode&quot;, &quot;$dbadmin&quot;, &quot;$dbadminpass&quot;,{AutoCommit =&gt; 1}) or die $_;
+	create_tables();
+	$dbh-&gt;disconnect();
+	exit(0);
 }
 
-    my $host=$Config-&gt;param(&quot;postgres.host&quot;);
-    my $port=$Config-&gt;param(&quot;postgres.port&quot;);
-    my $sslmode=$Config-&gt;param(&quot;postgres.ssl&quot;);
-    if(!$sslmode)
-    {
-         $sslmode=&quot;prefer&quot;;
-    }
-    my $dbadmin=$Config-&gt;param(&quot;postgres.dbadmin&quot;);
-    my $x2goadmin=&quot;x2godbuser&quot;;
-    my $x2goadminpass=`makepasswd`;
-    chomp($x2goadminpass);
-    my $db=&quot;x2go_sessions&quot;;
-
-    if(!$host)
-    {
-      $host='localhost';
-    }
-    if(!$port)
-    {
-      $port='5432';
-    }
-    if(!$dbadmin)
-    {
-      $dbadmin='postgres';
-    }
-
-    open (FL,&quot;&lt; /etc/x2go/x2gosql/passwords/pgadmin &quot;) or die &quot;Can't read password file /etc/x2go/x2gosql/passwords/pgadmin&quot;;
-    my $dbadminpass=&lt;FL&gt;;
-    close(FL);
-    chomp($dbadminpass);
-
-    my $dbh;
-    if($createdb)
-    {
-	  $dbh=DBI-&gt;connect(&quot;dbi:Pg:dbname=postgres;host=$host;port=$port;sslmode=$sslmode&quot;, &quot;$dbadmin&quot;, &quot;$dbadminpass&quot;,{AutoCommit =&gt; 1}) or die $_;
-	  create_database();
-	  $dbh-&gt;disconnect();
-	  $dbh=DBI-&gt;connect(&quot;dbi:Pg:dbname=$db;host=$host;port=$port;sslmode=$sslmode&quot;, &quot;$dbadmin&quot;, &quot;$dbadminpass&quot;,{AutoCommit =&gt; 1}) or die $_;
-	  create_tables();
-	  $dbh-&gt;disconnect();      
-	  exit(0);
-    }
-
-    if($listusers)
-    {
-	  $dbh=DBI-&gt;connect(&quot;dbi:Pg:dbname=postgres;host=$host;port=$port;sslmode=$sslmode&quot;, &quot;$dbadmin&quot;, &quot;$dbadminpass&quot;,{AutoCommit =&gt; 1}) or die $_;
-	  list_users();
-	  $dbh-&gt;disconnect();
-	  exit(0);
-    }
-
-    $dbh=DBI-&gt;connect(&quot;dbi:Pg:dbname=$db;host=$host;port=$port;sslmode=$sslmode&quot;, &quot;$dbadmin&quot;, &quot;$dbadminpass&quot;,{AutoCommit =&gt; 1}) or die $_;
-    if($adduser)
-    {
+if ($listusers)
+{
+	$dbh=DBI-&gt;connect(&quot;dbi:Pg:dbname=postgres;host=$host;port=$port;sslmode=$sslmode&quot;, &quot;$dbadmin&quot;, &quot;$dbadminpass&quot;,{AutoCommit =&gt; 1}) or die $_;
+	list_users();
+	$dbh-&gt;disconnect();
+	exit(0);
+}
+
+$dbh=DBI-&gt;connect(&quot;dbi:Pg:dbname=$db;host=$host;port=$port;sslmode=$sslmode&quot;, &quot;$dbadmin&quot;, &quot;$dbadminpass&quot;,{AutoCommit =&gt; 1}) or die $_;
+if ($adduser)
+{
 	add_user($adduser);
-    }
-
-    if($addgroup)
-    {
-      my ($name, $passwd, $gid, $members)  = getgrnam( $addgroup); 
-      my @grp_members=split(' ',$members);
-      foreach (@grp_members)
-      {
-	chomp($_);
-	add_user($_);
-      }
-    }
-
-    if($rmuser)
-    {
-      rm_user($rmuser);
-    }
-
-    if($rmgroup)
-    {
-      my ($name, $passwd, $gid, $members)  = getgrnam( $rmgroup); 
-      my @grp_members=split(' ',$members);
-      foreach (@grp_members)
-      {
-	chomp($_);
-	rm_user($_);
-      }
-    }
-    $dbh-&gt;disconnect();      
+}
+
+if ($addgroup)
+{
+	my ($name, $passwd, $gid, $members)  = getgrnam( $addgroup); 
+	my @grp_members=split(' ',$members);
+	foreach (@grp_members)
+	{
+		chomp($_);
+		add_user($_);
+	}
+}
+
+if ($rmuser)
+{
+	rm_user($rmuser);
+}
+
+if ($rmgroup)
+{
+	my ($name, $passwd, $gid, $members)  = getgrnam( $rmgroup); 
+	my @grp_members=split(' ',$members);
+	foreach (@grp_members)
+	{
+		chomp($_);
+		rm_user($_);
+	}
+}
+$dbh-&gt;disconnect();
 
 sub list_users()
 {
-      my $sth=$dbh-&gt;prepare(&quot;select rolname from pg_roles where rolname like 'x2gouser_%'&quot;);
-      $sth-&gt;execute()or die;
-      printf (&quot;%-20s DB user\n&quot;,&quot;UNIX user&quot;);
-      print &quot;---------------------------------------\n&quot;;
-      my @data;
-      while (@data = $sth-&gt;fetchrow_array) 
-      {
-	  @data[0]=~s/x2gouser_//;
-          printf (&quot;%-20s <A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">x2gouser_ at data</A>[0]\n&quot;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">, at data</A>[0]);
-      }
-      $sth-&gt;finish();
+	my $sth=$dbh-&gt;prepare(&quot;select rolname from pg_roles where rolname like 'x2gouser_%'&quot;);
+	$sth-&gt;execute()or die;
+	printf (&quot;%-20s DB user\n&quot;,&quot;UNIX user&quot;);
+	print &quot;---------------------------------------\n&quot;;
+	my @data;
+	while (@data = $sth-&gt;fetchrow_array) 
+	{
+		@data[0]=~s/x2gouser_//;
+		printf (&quot;%-20s <A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">x2gouser_ at data</A>[0]\n&quot;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">, at data</A>[0]);
+	}
+	$sth-&gt;finish();
 }
 
 sub rm_user()
 {
-      my $user=shift;
-      
-      print (&quot;rm DB user x2gouser_$user\n&quot;); 
-      
-      my $sth=$dbh-&gt;prepare(&quot;DROP OWNED BY x2gouser_$user&quot;);
-      $sth-&gt;execute();      
-      
-      my $sth=$dbh-&gt;prepare(&quot;drop USER if exists x2gouser_$user&quot;);
-      $sth-&gt;execute();
-      $sth-&gt;finish();
-
-      my ($name, $pass, $uid, $pgid, $quota, $comment, $gcos, $dir, $shell, $expire) = getpwnam($user);
-      if(! $uid)
-      {	
-	return;
-      }
-      if ( -e &quot;$dir/.x2go/sqlpass&quot; )
-      {
-	unlink(&quot;$dir/.x2go/sqlpass&quot;);
-      }
+	my $user=shift;
+
+	print (&quot;rm DB user x2gouser_$user\n&quot;); 
+
+	my $sth=$dbh-&gt;prepare(&quot;DROP OWNED BY x2gouser_$user&quot;);
+	$sth-&gt;execute();      
+
+	my $sth=$dbh-&gt;prepare(&quot;drop USER if exists x2gouser_$user&quot;);
+	$sth-&gt;execute();
+	$sth-&gt;finish();
+
+	my ($name, $pass, $uid, $pgid, $quota, $comment, $gcos, $dir, $shell, $expire) = getpwnam($user);
+	if (! $uid)
+	{
+		return;
+	}
+	if ( -e &quot;$dir/.x2go/sqlpass&quot; )
+	{
+		unlink(&quot;$dir/.x2go/sqlpass&quot;);
+	}
 }
 
-
 sub add_user()
 {
-      my $user=shift;
-      my ($name, $pass, $uid, $pgid, $quota, $comment, $gcos, $dir, $shell, $expire) = getpwnam($user);
-      if(! $uid)
-      {	
-	print &quot;Can not find user ($user)\n&quot;;
-	return;
-      }
-      $pass=`makepasswd`;
-      chomp($pass);
-      
-      my $sth=$dbh-&gt;prepare(&quot;DROP OWNED BY x2gouser_$user&quot;);
-      $sth-&gt;{Warn}=0;
-      $sth-&gt;{PrintError}=0;          
-      $sth-&gt;execute();      
-      
-      $sth=$dbh-&gt;prepare(&quot;drop USER if exists x2gouser_$user&quot;);
-      $sth-&gt;{Warn}=0;
-      $sth-&gt;{PrintError}=0;          
-      $sth-&gt;execute();
-
-      print (&quot;create DB user x2gouser_$user\n&quot;); 
-      $sth=$dbh-&gt;prepare(&quot;create USER x2gouser_$user WITH ENCRYPTED PASSWORD '$pass'&quot;);
-      $sth-&gt;execute();
-
-      $sth=$dbh-&gt;prepare(&quot;GRANT INSERT, UPDATE, DELETE ON sessions, used_ports, mounts TO x2gouser_$user&quot;);
-      $sth-&gt;execute();
-  
-      $sth=$dbh-&gt;prepare(&quot;GRANT SELECT, UPDATE, DELETE ON sessions_view, mounts_view, servers_view, ports_view TO x2gouser_$user&quot;);
-      $sth-&gt;execute();
-      $sth-&gt;finish();
-
-      if (! -d &quot;$dir/.x2go&quot; )
-      {
-	mkdir(&quot;$dir/.x2go&quot;);
-      }
-      #save user password
-      open (FL,&quot;&gt; $dir/.x2go/sqlpass&quot;) or die &quot;Can't open password file $dir/.x2go/sqlpass&quot;;
-      print FL $pass;
-      close(FL);
-      chmod(0700,&quot;$dir/.x2go&quot;);
-      chown($uid,$pgid,&quot;$dir/.x2go&quot;);
-      chmod(0600,&quot;$dir/.x2go/sqlpass&quot;);
-      chown($uid,$pgid,&quot;$dir/.x2go/sqlpass&quot;);
+	my $user=shift;
+	my ($name, $pass, $uid, $pgid, $quota, $comment, $gcos, $dir, $shell, $expire) = getpwnam($user);
+	if (! $uid)
+	{
+		print &quot;Can not find user ($user)\n&quot;;
+		return;
+	}
+	$pass=`makepasswd`;
+	chomp($pass);
+
+	my $sth=$dbh-&gt;prepare(&quot;DROP OWNED BY x2gouser_$user&quot;);
+	$sth-&gt;{Warn}=0;
+	$sth-&gt;{PrintError}=0;
+	$sth-&gt;execute();
+
+	$sth=$dbh-&gt;prepare(&quot;drop USER if exists x2gouser_$user&quot;);
+	$sth-&gt;{Warn}=0;
+	$sth-&gt;{PrintError}=0;
+	$sth-&gt;execute();
+
+	print (&quot;create DB user x2gouser_$user\n&quot;); 
+	$sth=$dbh-&gt;prepare(&quot;create USER x2gouser_$user WITH ENCRYPTED PASSWORD '$pass'&quot;);
+	$sth-&gt;execute();
+
+	$sth=$dbh-&gt;prepare(&quot;GRANT INSERT, UPDATE, DELETE ON sessions, used_ports, mounts TO x2gouser_$user&quot;);
+	$sth-&gt;execute();
+
+	$sth=$dbh-&gt;prepare(&quot;GRANT SELECT, UPDATE, DELETE ON sessions_view, mounts_view, servers_view, ports_view TO x2gouser_$user&quot;);
+	$sth-&gt;execute();
+	$sth-&gt;finish();
+
+	if (! -d &quot;$dir/.x2go&quot; )
+	{
+		mkdir(&quot;$dir/.x2go&quot;);
+	}
+
+	#save user password
+	open (FL,&quot;&gt; $dir/.x2go/sqlpass&quot;) or die &quot;Can't open password file $dir/.x2go/sqlpass&quot;;
+	print FL $pass;
+	close(FL);
+	chmod(0700,&quot;$dir/.x2go&quot;);
+	chown($uid,$pgid,&quot;$dir/.x2go&quot;);
+	chmod(0600,&quot;$dir/.x2go/sqlpass&quot;);
+	chown($uid,$pgid,&quot;$dir/.x2go/sqlpass&quot;);
 }
 
 sub create_tables()
 {
-          my $sth=$dbh-&gt;prepare(&quot;
-                create table sessions(
-                session_id text primary key,
-                display integer not null,
-                uname text not null,
-                server text not null,
-                client inet,
-                status char(1) not null default 'R',
-                init_time timestamp not null default now(),
-                last_time timestamp not null default now(),
-                cookie char(33),
-                agent_pid int,
-                gr_port int,
-                sound_port int,
-                fs_port int,
-                creator_id text NOT NULL default current_user,
-                unique(display))
-                &quot;);
-          $sth-&gt;execute() or die;
-	  
-	  $sth=$dbh-&gt;prepare(&quot;
-                create VIEW sessions_view as 
-                SELECT 
-                agent_pid, session_id, display, server, status, init_time, cookie, client, gr_port,
-				     sound_port, last_time, uname, fs_port from  sessions 
-				     where creator_id = current_user&quot;);
-          $sth-&gt;execute() or die;
-	  
-	  $sth=$dbh-&gt;prepare(&quot;
-                create VIEW servers_view as 
-                SELECT 
-                server, display, status from  sessions&quot;);
-          $sth-&gt;execute() or die;
-	  
-	  
-          
-          $sth=$dbh-&gt;prepare(&quot;create or replace RULE update_sess_priv AS ON UPDATE
-                TO sessions where (OLD.creator_id &lt;&gt; current_user or OLD.creator_id &lt;&gt; NEW.creator_id) and current_user &lt;&gt; '$x2goadmin'
-                DO INSTEAD NOTHING&quot;);
-          $sth-&gt;execute() or die;
-          
-          $sth=$dbh-&gt;prepare(&quot;create or replace RULE insert_sess_priv AS ON INSERT
-                TO sessions where NEW.creator_id &lt;&gt; current_user and current_user &lt;&gt; '$x2goadmin'
-                DO INSTEAD NOTHING&quot;);
-          $sth-&gt;execute() or die;
-	  
-          $sth=$dbh-&gt;prepare(&quot;create or replace RULE delete_sess_priv AS ON DELETE
-                TO sessions where OLD.creator_id &lt;&gt; current_user and current_user &lt;&gt; '$x2goadmin'
-                DO INSTEAD NOTHING&quot;);
-          $sth-&gt;execute() or die;
-	  
-          $sth=$dbh-&gt;prepare(&quot;create or replace RULE update_sess_view AS ON UPDATE
-                TO sessions_view DO INSTEAD 
-                update sessions set 
-                status=NEW.status,
-		last_time=NEW.last_time,
-		cookie=NEW.cookie,
-		agent_pid=NEW.agent_pid,
-		client=NEW.client,
-		gr_port=NEW.gr_port,
-		sound_port=NEW.sound_port,
-		fs_port=NEW.fs_port
-	        where session_id=OLD.session_id and creator_id=current_user&quot;);
-          $sth-&gt;execute() or die;	  
-
-          $sth=$dbh-&gt;prepare(&quot;create table messages(mess_id varchar(20) primary key, message text)&quot;);
-          $sth-&gt;execute() or die;
-
-          $sth=$dbh-&gt;prepare(&quot;create table user_messages(
-                mess_id text not null,
-                uname text not null)&quot;);
-          $sth-&gt;execute() or die;
-
-          $sth=$dbh-&gt;prepare(&quot;create table used_ports(
-                server text not null,
-                session_id text references sessions on delete cascade,
-                creator_id text NOT NULL default current_user,
-                port integer primary key)&quot;);
-          $sth-&gt;execute() or die;
-	  
-	  $sth=$dbh-&gt;prepare(&quot;
-                create VIEW ports_view as 
-                SELECT 
-                server, port from used_ports&quot;);
-          $sth-&gt;execute() or die;
-	  
-
-          $sth=$dbh-&gt;prepare(&quot;create or replace RULE insert_port_priv AS ON INSERT
-                TO used_ports where NEW.creator_id &lt;&gt; current_user and current_user &lt;&gt; '$x2goadmin'
-                DO INSTEAD NOTHING&quot;);
-          $sth-&gt;execute() or die;
-
-          $sth=$dbh-&gt;prepare(&quot;create or replace RULE update_port_priv AS ON UPDATE
-                TO used_ports where (NEW.creator_id &lt;&gt; current_user or OLD.creator_id &lt;&gt; current_user) and current_user &lt;&gt; '$x2goadmin'
-                DO INSTEAD NOTHING&quot;);
-          $sth-&gt;execute() or die;
-
-          $sth=$dbh-&gt;prepare(&quot;create or replace RULE delete_port_priv AS ON DELETE
-                TO used_ports where OLD.creator_id &lt;&gt; current_user and current_user &lt;&gt; '$x2goadmin'
-                DO INSTEAD NOTHING &quot;);
-          $sth-&gt;execute() or die;
-
-          $sth=$dbh-&gt;prepare(&quot;create table mounts(
-                session_id text references sessions on delete restrict,
-                path text not null,
-                client inet not null,
-                creator_id text NOT NULL default current_user,
-                primary key(path,client))&quot;);
-          $sth-&gt;execute() or die;
-
-	  
-  	  $sth=$dbh-&gt;prepare(&quot;
-                create VIEW mounts_view as 
-                SELECT 
-                client,path, session_id from mounts
-				     where creator_id = current_user&quot;);
-          $sth-&gt;execute() or die;
-	  
-          $sth=$dbh-&gt;prepare(&quot;create or replace RULE delete_mounts_view AS ON DELETE
-                TO mounts_view DO INSTEAD 
-                delete from mounts
-	        where session_id=OLD.session_id and creator_id=current_user and path=OLD.path&quot;);
-          $sth-&gt;execute() or die;	  
-	  	  
-	  
-          $sth=$dbh-&gt;prepare(&quot;create or replace RULE insert_mount_priv AS ON INSERT
-                TO mounts where NEW.creator_id &lt;&gt; current_user and current_user &lt;&gt; '$x2goadmin'
-                DO INSTEAD NOTHING&quot;);
-          $sth-&gt;execute() or die;
-
-          $sth=$dbh-&gt;prepare(&quot; create or replace RULE update_mount_priv AS ON UPDATE
-                TO mounts where (NEW.creator_id &lt;&gt; current_user or OLD.creator_id &lt;&gt; current_user) and current_user &lt;&gt; '$x2goadmin'
-                DO INSTEAD NOTHING&quot;);
-          $sth-&gt;execute() or die;
-
-          $sth=$dbh-&gt;prepare(&quot; create or replace RULE delete_mount_priv AS ON DELETE
-                TO mounts where OLD.creator_id &lt;&gt; current_user and current_user &lt;&gt; '$x2goadmin'
-                DO INSTEAD NOTHING&quot;);
-          $sth-&gt;execute() or die;
-
-          $sth=$dbh-&gt;prepare(&quot;GRANT ALL PRIVILEGES ON sessions, messages, user_messages, used_ports, mounts TO $x2goadmin&quot;);
-          $sth-&gt;execute() or die;
-	  $sth-&gt;finish();
+	my $sth=$dbh-&gt;prepare(&quot;
+	                      create table sessions(
+	                      session_id text primary key,
+	                      display integer not null,
+	                      uname text not null,
+	                      server text not null,
+	                      client inet,
+	                      status char(1) not null default 'R',
+	                      init_time timestamp not null default now(),
+	                      last_time timestamp not null default now(),
+	                      cookie char(33),
+	                      agent_pid int,
+	                      gr_port int,
+	                      sound_port int,
+	                      fs_port int,
+	                      creator_id text NOT NULL default current_user,
+	                      unique(display))
+	                      &quot;);
+	$sth-&gt;execute() or die;
+
+	$sth=$dbh-&gt;prepare(&quot;
+	                   create VIEW sessions_view as 
+	                   SELECT 
+	                   agent_pid, session_id, display, server, status, init_time, cookie, client, gr_port,
+	                   sound_port, last_time, uname, fs_port from  sessions 
+	                   where creator_id = current_user
+	                   &quot;);
+	$sth-&gt;execute() or die;
+
+	$sth=$dbh-&gt;prepare(&quot;
+	                   create VIEW servers_view as 
+	                   SELECT 
+	                   server, display, status from  sessions
+	                   &quot;);
+	$sth-&gt;execute() or die;
+
+	$sth=$dbh-&gt;prepare(&quot;
+	                   create or replace RULE update_sess_priv AS ON UPDATE
+	                   TO sessions where (OLD.creator_id &lt;&gt; current_user or OLD.creator_id &lt;&gt; NEW.creator_id) and current_user &lt;&gt; '$x2goadmin'
+	                   DO INSTEAD NOTHING
+	                   &quot;);
+	$sth-&gt;execute() or die;
+
+	$sth=$dbh-&gt;prepare(&quot;
+	                   create or replace RULE insert_sess_priv AS ON INSERT
+	                   TO sessions where NEW.creator_id &lt;&gt; current_user and current_user &lt;&gt; '$x2goadmin'
+	                   DO INSTEAD NOTHING
+	                   &quot;);
+	$sth-&gt;execute() or die;
+
+	$sth=$dbh-&gt;prepare(&quot;
+	                   create or replace RULE delete_sess_priv AS ON DELETE
+	                   TO sessions where OLD.creator_id &lt;&gt; current_user and current_user &lt;&gt; '$x2goadmin'
+	                   DO INSTEAD NOTHING
+	                   &quot;);
+	$sth-&gt;execute() or die;
+
+	$sth=$dbh-&gt;prepare(&quot;
+	                   create or replace RULE update_sess_view AS ON UPDATE
+	                   TO sessions_view DO INSTEAD 
+	                   update sessions set 
+	                   status=NEW.status,
+	                   last_time=NEW.last_time,
+	                   cookie=NEW.cookie,
+	                   agent_pid=NEW.agent_pid,
+	                   client=NEW.client,
+	                   gr_port=NEW.gr_port,
+	                   sound_port=NEW.sound_port,
+	                   fs_port=NEW.fs_port
+	                   where session_id=OLD.session_id and creator_id=current_user
+	                   &quot;);
+	$sth-&gt;execute() or die;
+
+	$sth=$dbh-&gt;prepare(&quot;
+	                   create table messages(mess_id varchar(20) primary key, message text)
+	                   &quot;);
+	$sth-&gt;execute() or die;
+
+	$sth=$dbh-&gt;prepare(&quot;
+	                   create table user_messages(
+	                   mess_id text not null,
+	                   uname text not null)
+	                   &quot;);
+	$sth-&gt;execute() or die;
+
+	$sth=$dbh-&gt;prepare(&quot;
+	                   create table used_ports(
+	                   server text not null,
+	                   session_id text references sessions on delete cascade,
+	                   creator_id text NOT NULL default current_user,
+	                   port integer primary key)
+	                   &quot;);
+	$sth-&gt;execute() or die;
+
+	$sth=$dbh-&gt;prepare(&quot;
+	                   create VIEW ports_view as 
+	                   SELECT
+	                   server, port from used_ports
+	                   &quot;);
+	$sth-&gt;execute() or die;
+
+
+	$sth=$dbh-&gt;prepare(&quot;
+	                   create or replace RULE insert_port_priv AS ON INSERT
+	                   TO used_ports where NEW.creator_id &lt;&gt; current_user and current_user &lt;&gt; '$x2goadmin'
+	                   DO INSTEAD NOTHING
+	                   &quot;);
+	$sth-&gt;execute() or die;
+
+	$sth=$dbh-&gt;prepare(&quot;
+	                   create or replace RULE update_port_priv AS ON UPDATE
+	                   TO used_ports where (NEW.creator_id &lt;&gt; current_user or OLD.creator_id &lt;&gt; current_user) and current_user &lt;&gt; '$x2goadmin'
+	                   DO INSTEAD NOTHING
+	                   &quot;);
+	$sth-&gt;execute() or die;
+
+	$sth=$dbh-&gt;prepare(&quot;
+	                   create or replace RULE delete_port_priv AS ON DELETE
+	                   TO used_ports where OLD.creator_id &lt;&gt; current_user and current_user &lt;&gt; '$x2goadmin'
+	                   DO INSTEAD NOTHING
+	                   &quot;);
+	$sth-&gt;execute() or die;
+
+	$sth=$dbh-&gt;prepare(&quot;
+	                   create table mounts(
+	                   session_id text references sessions on delete restrict,
+	                   path text not null,
+	                   client inet not null,
+	                   creator_id text NOT NULL default current_user,
+	                   primary key(path,client))
+	                   &quot;);
+	$sth-&gt;execute() or die;
+
+	$sth=$dbh-&gt;prepare(&quot;
+	                   create VIEW mounts_view as 
+	                   SELECT
+	                   client,path, session_id from mounts
+	                   where creator_id = current_user
+	                   &quot;);
+	$sth-&gt;execute() or die;
+
+	$sth=$dbh-&gt;prepare(&quot;
+	                   create or replace RULE delete_mounts_view AS ON DELETE
+	                   TO mounts_view DO INSTEAD 
+	                   delete from mounts
+	                   where session_id=OLD.session_id and creator_id=current_user and path=OLD.path
+	                   &quot;);
+	$sth-&gt;execute() or die;	  
+
+	$sth=$dbh-&gt;prepare(&quot;
+	                   create or replace RULE insert_mount_priv AS ON INSERT
+	                   TO mounts where NEW.creator_id &lt;&gt; current_user and current_user &lt;&gt; '$x2goadmin'
+	                   DO INSTEAD NOTHING
+	                   &quot;);
+	$sth-&gt;execute() or die;
+
+	$sth=$dbh-&gt;prepare(&quot;
+	                   create or replace RULE update_mount_priv AS ON UPDATE
+	                   TO mounts where (NEW.creator_id &lt;&gt; current_user or OLD.creator_id &lt;&gt; current_user) and current_user &lt;&gt; '$x2goadmin'
+	                   DO INSTEAD NOTHING
+	                   &quot;);
+	$sth-&gt;execute() or die;
+
+	$sth=$dbh-&gt;prepare(&quot;
+	                   create or replace RULE delete_mount_priv AS ON DELETE
+	                   TO mounts where OLD.creator_id &lt;&gt; current_user and current_user &lt;&gt; '$x2goadmin'
+	                   DO INSTEAD NOTHING
+	                   &quot;);
+	$sth-&gt;execute() or die;
+
+	$sth=$dbh-&gt;prepare(&quot;GRANT ALL PRIVILEGES ON sessions, messages, user_messages, used_ports, mounts TO $x2goadmin&quot;);
+	$sth-&gt;execute() or die;
+	$sth-&gt;finish();
 }
 
 sub create_database
 {
-         #drop db if exists
-         my $sth=$dbh-&gt;prepare(&quot;drop database if exists x2go_sessions&quot;);
-         $sth-&gt;execute();
-         #drop x2goadmin
-         $sth=$dbh-&gt;prepare(&quot;drop user if exists $x2goadmin&quot;);
-         $sth-&gt;execute();
-         #create db
-         $sth=$dbh-&gt;prepare(&quot;create database $db&quot;);
-         $sth-&gt;execute() or die;
-         #create x2goadmin
-         $sth=$dbh-&gt;prepare(&quot;create USER $x2goadmin WITH ENCRYPTED PASSWORD '$x2goadminpass'&quot;);
-         $sth-&gt;execute() or die;
-         #save x2goadmin password
-         open (FL,&quot;&gt; /etc/x2go/x2gosql/passwords/x2goadmin &quot;) or die &quot;Can't write password file /etc/x2go/x2gosql/passwords/x2goadmin&quot;;
-         print FL $x2goadminpass;
-         close(FL);       
-	 $sth-&gt;finish();
-}
\ No newline at end of file
+	#drop db if exists
+	my $sth=$dbh-&gt;prepare(&quot;drop database if exists x2go_sessions&quot;);
+	$sth-&gt;execute();
+	#drop x2goadmin
+	$sth=$dbh-&gt;prepare(&quot;drop user if exists $x2goadmin&quot;);
+	$sth-&gt;execute();
+	#create db
+	$sth=$dbh-&gt;prepare(&quot;create database $db&quot;);
+	$sth-&gt;execute() or die;
+	#create x2goadmin
+	$sth=$dbh-&gt;prepare(&quot;create USER $x2goadmin WITH ENCRYPTED PASSWORD '$x2goadminpass'&quot;);
+	$sth-&gt;execute() or die;
+	#save x2goadmin password
+	open (FL,&quot;&gt; /etc/x2go/x2gosql/passwords/x2goadmin &quot;) or die &quot;Can't write password file /etc/x2go/x2gosql/passwords/x2goadmin&quot;;
+	print FL $x2goadminpass;
+	close(FL);
+	$sth-&gt;finish();
+}


hooks/post-receive
-- 
x2goserver.git (X2go Server)

This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;x2goserver.git&quot; (X2go Server).


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001234.html">[X2go-Commits] x2goserver.git - master (branch) updated:	3.0.99-2-114-gc8c54cd
</A></li>
	<LI>Next message: <A HREF="001236.html">[X2go-Commits] x2goserver.git - master (branch) updated:	3.0.99-2-116-g870f074
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1235">[ date ]</a>
              <a href="thread.html#1235">[ thread ]</a>
              <a href="subject.html#1235">[ subject ]</a>
              <a href="author.html#1235">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/x2go-commits">More information about the X2go-commits
mailing list</a><br>
</body></html>
