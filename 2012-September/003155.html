<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [X2go-Commits] x2gothinclient.git - master (branch) updated:	1.0.1.8-39-g2bdd777
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/x2go-commits/2012-September/index.html" >
   <LINK REL="made" HREF="mailto:x2go-commits%40lists.berlios.de?Subject=Re%3A%20%5BX2go-Commits%5D%20x2gothinclient.git%20-%20master%20%28branch%29%20updated%3A%0A%091.0.1.8-39-g2bdd777&In-Reply-To=%3C20120913072027.6D0595DB70%40ymir%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003154.html">
   <LINK REL="Next"  HREF="003156.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[X2go-Commits] x2gothinclient.git - master (branch) updated:	1.0.1.8-39-g2bdd777</H1>
    <B>X2Go dev team</B> 
    <A HREF="mailto:x2go-commits%40lists.berlios.de?Subject=Re%3A%20%5BX2go-Commits%5D%20x2gothinclient.git%20-%20master%20%28branch%29%20updated%3A%0A%091.0.1.8-39-g2bdd777&In-Reply-To=%3C20120913072027.6D0595DB70%40ymir%3E"
       TITLE="[X2go-Commits] x2gothinclient.git - master (branch) updated:	1.0.1.8-39-g2bdd777">git-admin at x2go.org
       </A><BR>
    <I>Thu Sep 13 09:20:27 CEST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="003154.html">[X2go-Commits] x2goserver.git - master (branch) updated:	3.1.1.3-13-g22ede8d
</A></li>
        <LI>Next message: <A HREF="003156.html">[X2go-Commits] x2gothinclient.git - master (branch) updated:	1.0.1.8-40-g5aaf114
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3155">[ date ]</a>
              <a href="thread.html#3155">[ thread ]</a>
              <a href="subject.html#3155">[ subject ]</a>
              <a href="author.html#3155">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch, master has been updated
       via  2bdd777ef57df2ce3407e05c6dd089f98e3e5cac (commit)
       via  d695810b0dec1df18a1d12657b3b6bcbd869bdd0 (commit)
       via  97b0adae0dd42a1dd1d7d44fb564a875192281c4 (commit)
       via  9af63fad8282f9d61b982501178b7b687804170b (commit)
      from  9a8654798ec88f499b38644aa373be38a5c3bacf (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
commit 2bdd777ef57df2ce3407e05c6dd089f98e3e5cac
Author: Mike Gabriel &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">mike.gabriel at das-netzwerkteam.de</A>&gt;
Date:   Thu Sep 13 09:15:06 2012 +0200

    Provide a README.hostname file in doc folder of x2gothinclientmanagement.

commit d695810b0dec1df18a1d12657b3b6bcbd869bdd0
Author: Mike Gabriel &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">mike.gabriel at das-netzwerkteam.de</A>&gt;
Date:   Thu Sep 13 09:02:19 2012 +0200

    Revert &quot;Remove /etc/hostname, whithout the file, the hostname gets set during PXE boot.&quot;
    
    This reverts commit 2e41eb4c545fb1e8c6209c4ed21dfa6ae68d8607.

commit 97b0adae0dd42a1dd1d7d44fb564a875192281c4
Author: Mike Gabriel &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">mike.gabriel at das-netzwerkteam.de</A>&gt;
Date:   Thu Sep 13 08:54:26 2012 +0200

    Xorg appears as /usr/bin/X in ps ax output. Make sure it gets detected.

commit 9af63fad8282f9d61b982501178b7b687804170b
Author: Mike Gabriel &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">mike.gabriel at das-netzwerkteam.de</A>&gt;
Date:   Thu Sep 13 08:52:14 2012 +0200

    Only mount /proc, /sys, /dev/pts inside chroot if not already mounted.

-----------------------------------------------------------------------

Summary of changes:
 debian/changelog                                   |    5 ++-
 debian/x2gothinclientmanagement.docs               |    3 +-
 x2gothinclient/sbin/x2gothinclientd                |    4 +-
 x2gothinclientmanagement/README.hostname           |   37 ++++++++++++++++++++
 .../sbin/x2gothinclient_create                     |    1 -
 x2gothinclientmanagement/sbin/x2gothinclient_shell |    9 ++---
 .../sbin/x2gothinclient_upgrade                    |    9 ++---
 7 files changed, 50 insertions(+), 18 deletions(-)
 create mode 100644 x2gothinclientmanagement/README.hostname

The diff of changes is:
diff --git a/debian/changelog b/debian/changelog
index 75c56b4..59c4f2d 100644
--- a/debian/changelog
+++ b/debian/changelog
@@ -29,8 +29,6 @@ x2gothinclient (1.0.99.1-0~x2go1) UNRELEASED; urgency=low
       we only find a 686-pae kernel which fails on some (virtual) hardware (e.g.
       virtualbox).
     - Make sure that kernel + initrd symlinks are relative symlinks.
-    - Remove /etc/hostname, whithout the file, the hostname gets set during PXE
-      boot.
     - Keep mounts for /proc and /dev/pts with option noauto for mounting inside
       of chroot. They are not needed during TCE boot.
     - Make the SSH daemon listen on IPv4 localhost address only.
@@ -38,6 +36,9 @@ x2gothinclient (1.0.99.1-0~x2go1) UNRELEASED; urgency=low
     - Move configuration template from /usr/share/tce to /usr/share/tce/etc.
     - Add direct FreeRDP support for defaults TCE installation.
     - Start with US keyboard as default keyboard layout.
+    - Only mount /proc, /sys, /dev/pts inside chroot if not already mounted.
+    - Xorg appears as /usr/bin/X in ps ax output. Make sure it gets detected.
+    - Provide a README.hostname file in doc folder of x2gothinclientmanagement.
 
  -- Mike Gabriel &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">mike.gabriel at das-netzwerkteam.de</A>&gt;  Fri, 10 Aug 2012 14:13:49 +0200
 
diff --git a/debian/x2gothinclientmanagement.docs b/debian/x2gothinclientmanagement.docs
index 76b6c95..362fedf 100644
--- a/debian/x2gothinclientmanagement.docs
+++ b/debian/x2gothinclientmanagement.docs
@@ -1 +1,2 @@
-x2gothinclientmanagement/README
\ No newline at end of file
+x2gothinclientmanagement/README
+x2gothinclientmanagement/README.hostname
\ No newline at end of file
diff --git a/x2gothinclient/sbin/x2gothinclientd b/x2gothinclient/sbin/x2gothinclientd
index 61bd512..f822454 100755
--- a/x2gothinclient/sbin/x2gothinclientd
+++ b/x2gothinclient/sbin/x2gothinclientd
@@ -33,8 +33,8 @@ sub catch_term
 
 sub check_x
 {
-	my $x=`ps ax | grep Xorg`;
-	if ( $x=~m/usr.bin.Xorg/ )
+	my $x=`ps ax | grep X`;
+	if ( $x=~m/usr.bin.(Xorg|X)/ )
 	{
 		return 1;
 	}
diff --git a/x2gothinclientmanagement/README.hostname b/x2gothinclientmanagement/README.hostname
new file mode 100644
index 0000000..c76568a
--- /dev/null
+++ b/x2gothinclientmanagement/README.hostname
@@ -0,0 +1,37 @@
+Accept X2GO thin client hostname from DHCP/DNS server
+------------------------------------------------------
+
+Inside the TCE chroot you find an /etc/hostname file.
+
+With some DHCP/DNS setups the hostname gets set during
+PXE boot and if /etc/hostname is missing, the hostname
+will be kept as is.
+
+If you want to use that feature:
+
+  $ x2gothinclient_shell
+  (chroot)$ rm -f /etc/hostname
+  (chroot)$ exit
+
+
+Generic Linux networks (isc-dhcp-server, bind):
+-----------------------------------------------
+ToDo. Anyone can give good information on how to setup
+the DHCP/DNS services to make that work?
+
+
+Debian Edu
+----------
+In Debian Edu networks you can remove /etc/hostname inside th
+chroot and then the hostname gets set during PXE boot.
+
+
+Windows DHCP server
+-------------------
+By default, the Windows DHCP server does not provide a hostname
+via PXE boot. So, in this case you should keep /etc/hostname.
+
+
+light+love,
+Mike Gabriel, 20120913
+
diff --git a/x2gothinclientmanagement/sbin/x2gothinclient_create b/x2gothinclientmanagement/sbin/x2gothinclient_create
index b8f0c7e..7414f3a 100755
--- a/x2gothinclientmanagement/sbin/x2gothinclient_create
+++ b/x2gothinclientmanagement/sbin/x2gothinclient_create
@@ -164,7 +164,6 @@ export X2GO_HANDLE_DAEMONS=false
 [ \$? -eq 0 ] &amp;&amp; LINK_TARGET=\$(readlink /initrd.img.486.tmp | sed 's@/<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">boot at boot</A>@') &amp;&amp; ln -s \$LINK_TARGET /initrd.img.486 &amp;&amp; rm -f /initrd.img.486.tmp
 
 [ \$? -eq 0 ] &amp;&amp; apt-get install x2gothinclient x2gocdmanager x2gosmartcardrules x2gousbmount -y
-[ \$? -eq 0 ] &amp;&amp; rm -f /etc/hostname
 
 # blacklist kernel modules
 [ \$? -eq 0 ] &amp;&amp; echo &amp;&amp; echo &quot;# modules blacklisted on X2Go Thin Clients...&quot; &gt;&gt; /etc/modprobe.d/blacklist.conf
diff --git a/x2gothinclientmanagement/sbin/x2gothinclient_shell b/x2gothinclientmanagement/sbin/x2gothinclient_shell
index cb9fab6..aef3ed7 100755
--- a/x2gothinclientmanagement/sbin/x2gothinclient_shell
+++ b/x2gothinclientmanagement/sbin/x2gothinclient_shell
@@ -78,9 +78,6 @@ if [ \$(stat --format '%s' /sbin/start-stop-daemon) -gt 200 ]; then
 	chmod a+x /sbin/start-stop-daemon
 fi
 
-# make sure the /etc/hostname file is not presented in the chroot
-[ -e /etc/hostname ] &amp;&amp; rm -f /etc/hostname
-
 export X2GO_HANDLE_DAEMONS=false
 
 mount /root
@@ -96,9 +93,9 @@ EOF
 chmod u+x &quot;$TC_CHROOT/x2go_tce_shell.sh&quot;
 
 mkdir -p $TC_CHROOT/{proc,dev/pts,sys}
-mount -tproc proc $TC_CHROOT/proc || true
-mount -tsysfs sys $TC_CHROOT/sys || true
-mount -tdevpts devts $TC_CHROOT/dev/pts || true
+mount | grep $TC_CHROOT/proc &gt;/dev/null || mount -tproc proc $TC_CHROOT/proc || true
+mount | grep $TC_CHROOT/sys &gt;/dev/null || mount -tsysfs sys $TC_CHROOT/sys || true
+mount | grep $TC_CHROOT/dev/pts &gt;/dev/null || mount -tdevpts devts $TC_CHROOT/dev/pts || true
 
 chroot &quot;$TC_CHROOT&quot; /x2go_tce_shell.sh
 
diff --git a/x2gothinclientmanagement/sbin/x2gothinclient_upgrade b/x2gothinclientmanagement/sbin/x2gothinclient_upgrade
index acd9a5b..1cdca46 100755
--- a/x2gothinclientmanagement/sbin/x2gothinclient_upgrade
+++ b/x2gothinclientmanagement/sbin/x2gothinclient_upgrade
@@ -68,9 +68,6 @@ if [ \$(stat --format '%s' /sbin/start-stop-daemon) -gt 200 ]; then
         chmod a+x /sbin/start-stop-daemon
 fi
 
-# make sure the /etc/hostname file is not presented in the chroot
-[ -e /etc/hostname ] &amp;&amp; rm -f /etc/hostname
-
 export X2GO_HANDLE_DAEMONS=false
 
 [ \$? -eq 0 ] &amp;&amp; apt-get update
@@ -95,9 +92,9 @@ EOF
 chmod u+x &quot;$TC_CHROOT/x2go_tce_upgrade.sh&quot;
 
 mkdir -p $TC_CHROOT/{proc,dev/pts,sys}
-mount -tproc proc $TC_CHROOT/proc || true
-mount -tsysfs sys $TC_CHROOT/sys || true
-mount -tdevpts devpts $TC_CHROOT/dev/pts || true
+mount | grep $TC_CHROOT/proc &gt;/dev/null || mount -tproc proc $TC_CHROOT/proc || true
+mount | grep $TC_CHROOT/sys &gt;/dev/null || mount -tsysfs sys $TC_CHROOT/sys || true
+mount | grep $TC_CHROOT/dev/pts &gt;/dev/null || mount -tdevpts devts $TC_CHROOT/dev/pts || true
 
 chroot &quot;$TC_CHROOT&quot; /x2go_tce_upgrade.sh
 


hooks/post-receive
-- 
x2gothinclient.git (X2Go Thin Client Environment)

This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;x2gothinclient.git&quot; (X2Go Thin Client Environment).

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003154.html">[X2go-Commits] x2goserver.git - master (branch) updated:	3.1.1.3-13-g22ede8d
</A></li>
	<LI>Next message: <A HREF="003156.html">[X2go-Commits] x2gothinclient.git - master (branch) updated:	1.0.1.8-40-g5aaf114
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3155">[ date ]</a>
              <a href="thread.html#3155">[ thread ]</a>
              <a href="subject.html#3155">[ subject ]</a>
              <a href="author.html#3155">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/x2go-commits">More information about the X2go-commits
mailing list</a><br>
</body></html>
