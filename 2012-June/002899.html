<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [X2go-Commits] x2goclient.git - build-main (branch) updated:	3.99.2.1
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/x2go-commits/2012-June/index.html" >
   <LINK REL="made" HREF="mailto:x2go-commits%40lists.berlios.de?Subject=Re%3A%20%5BX2go-Commits%5D%20x2goclient.git%20-%20build-main%20%28branch%29%20updated%3A%0A%093.99.2.1&In-Reply-To=%3C20120608105554.9331D5DB34%40ymir%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002898.html">
   <LINK REL="Next"  HREF="002900.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[X2go-Commits] x2goclient.git - build-main (branch) updated:	3.99.2.1</H1>
    <B>X2Go dev team</B> 
    <A HREF="mailto:x2go-commits%40lists.berlios.de?Subject=Re%3A%20%5BX2go-Commits%5D%20x2goclient.git%20-%20build-main%20%28branch%29%20updated%3A%0A%093.99.2.1&In-Reply-To=%3C20120608105554.9331D5DB34%40ymir%3E"
       TITLE="[X2go-Commits] x2goclient.git - build-main (branch) updated:	3.99.2.1">git-admin at x2go.org
       </A><BR>
    <I>Fri Jun  8 12:55:54 CEST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="002898.html">[X2go-Commits] x2goclient.git - master (branch) updated:	3.99.2.0-20-g26aac92
</A></li>
        <LI>Next message: <A HREF="002900.html">[X2go-Commits] pyhoca-cli.git - master (branch) updated:	0.1.4.2-14-g3816f7d
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2899">[ date ]</a>
              <a href="thread.html#2899">[ thread ]</a>
              <a href="subject.html#2899">[ subject ]</a>
              <a href="author.html#2899">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch, build-main has been updated
       via  26aac92d6769fdb9194211108caf5ac96226a612 (commit)
       via  4ccfeaffa19e3ccc20084f3683ccd4512926b5f9 (commit)
       via  adefcb0cd27987107424e251a4d172b930390a14 (commit)
       via  f388d5f473a4939730a10ecb1e50611c45732717 (commit)
       via  1b21d75f2c10609f3586f5b5e0b4ceb7fca83fdd (commit)
       via  dd0a6376138afbaec5b5447360a32bf6bdf24d7b (commit)
       via  bad7a0bdb342649e5cad359d644bd5e33cbf7d54 (commit)
       via  367b245a575649a16fe01320f0ba412cc5fa73a5 (commit)
       via  ea3adb1cce7727a6114537ee3039e044f297d2dd (commit)
       via  82e8f77fc996de04b148ae9c6d53a78f37442ec9 (commit)
       via  4f41b1600794e06c5a9ec5e14b1621c52f867ae0 (commit)
       via  8c41c073e281b7a7d6a876381096b45458748ec1 (commit)
       via  74d212292d0e8d085032aeb59c469b8f5155e74a (commit)
       via  c736df204c427849b1a4f512fd2113ceab723fa7 (commit)
       via  868871c1c4a359f7f739037ffcc62dff853a65af (commit)
       via  1ba12c3814eb80361a03837afd0ac62b1dce6b6a (commit)
       via  a19e5dadfd929d11bcd411df7b77c3a8b063ede4 (commit)
       via  be9f453bfe1458c8c4b7e772b6b5dff0c1306bd3 (commit)
       via  60ee3404e96f23e81dfd45561405db53d3e316f5 (commit)
       via  b026eb6b729095f6907a2a6a00f1c59de2664850 (commit)
      from  7b871ac84fc2877af240ec5a4a6172d1eaec61b3 (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
-----------------------------------------------------------------------

Summary of changes:
 Makefile                   |    8 +-
 VERSION                    |    2 +-
 debian/changelog           |   32 +
 desktop/x2goclient.desktop |    2 +-
 icons/128x128/unity.png    |  Bin 0 -&gt; 17622 bytes
 icons/16x16/unity.png      |  Bin 0 -&gt; 1410 bytes
 icons/32x32/unity.png      |  Bin 0 -&gt; 2984 bytes
 icons/64x64/unity.png      |  Bin 0 -&gt; 7241 bytes
 onmainwindow.cpp           | 8090 +++++++++++++++++++++++++++++++++++++++++++-
 onmainwindow.h             |    3 +
 onmainwindow_part2.cpp     | 2577 --------------
 onmainwindow_part3.cpp     | 2510 --------------
 onmainwindow_part4.cpp     | 2861 ----------------
 onmainwindow_privat.h      |    1 +
 resources.rcc              |    1 +
 sessionbutton.cpp          |   16 +
 sessionbutton.h            |    2 +-
 sessionwidget.cpp          |    6 +
 sessionwidget.h            |    2 +-
 sshmasterconnection.cpp    |   19 +-
 svg/unity.svg              |    8 +
 version.h                  |    3 +-
 x2goclient.pro             |   34 +-
 x2goclient_de.ts           |   73 +-
 x2goclient_nb_no.ts        |  741 ++--
 x2goclient_sv.ts           |   65 +-
 x2goplugin.rc              |   10 +-
 27 files changed, 8631 insertions(+), 8435 deletions(-)
 create mode 100644 icons/128x128/unity.png
 create mode 100644 icons/16x16/unity.png
 create mode 100644 icons/32x32/unity.png
 create mode 100644 icons/64x64/unity.png
 delete mode 100644 onmainwindow_part2.cpp
 delete mode 100644 onmainwindow_part3.cpp
 delete mode 100644 onmainwindow_part4.cpp
 create mode 100644 svg/unity.svg

The diff of changes is:
diff --git a/Makefile b/Makefile
index 30c12dc..19d83db 100755
--- a/Makefile
+++ b/Makefile
@@ -41,10 +41,10 @@ build_man:
 	${MAKE} -f Makefile.man2html build
 
 clean: clean_client clean_plugin clean_man
-	find . -type f -name '*.o' -exec rm -vf {} +
-	find . -type f -name 'moc_*.cpp' -exec rm -vf {} +
-	find . -type f -name 'ui_*.h' -exec rm -vf {} +
-	find . -type f -name 'qrc_*.cpp' -exec rm -vf {} +
+	find . -type f -maxdepth 2 -name '*.o' -exec rm -vf {} +
+	find . -type f -maxdepth 2 -name 'moc_*.cpp' -exec rm -vf {} +
+	find . -type f -maxdepth 2 -name 'ui_*.h' -exec rm -vf {} +
+	find . -type f -maxdepth 2 -name 'qrc_*.cpp' -exec rm -vf {} +
 	rm -f x2goclient
 	rm -f x2goclient.tag
 
diff --git a/VERSION b/VERSION
index 1296fd3..399ee7b 100644
--- a/VERSION
+++ b/VERSION
@@ -1 +1 @@
-3.99.2.0
+3.99.2.1
diff --git a/debian/changelog b/debian/changelog
index 49f5464..baad6e2 100644
--- a/debian/changelog
+++ b/debian/changelog
@@ -1,3 +1,35 @@
+x2goclient (3.99.2.1-0~x2go1) unstable; urgency=low
+
+  [ Oleksandr Shneyder ]
+  * New upstream version (3.99.2.1):
+    - Not starting smart card daemon before users are loaded in LDAP mode.
+    - Merging onmainwindow_part*.cpp into onmainwindow.cpp
+    - Support recent pulseuadio on windows
+    - removing %USERPROFILE%\.x2go\pulse\.pulse\%COMPUTERNAME%-runtime\pid
+      if exists under windows
+    - --user=&lt;username&gt; set username in session mode if this field is blank
+      in session settings.
+    - --autostart=&lt;app&gt; launch &quot;app&quot; by session start in &quot;published
+      applications&quot; mode
+
+  [ Daniel Lindgren ]
+  * New upstream version (3.99.2.1):
+    - Swedish i18n update for published applications.
+
+  [ Terje Andersen ]
+  * New upstream version (3.99.2.1):
+    - Norwegian (Bokmal) i18n update for published applications.
+
+  [ Stefan Baur ]
+  * New upstream version (3.99.2.1):
+    - German i18n update for published applications.
+
+  [ Mike Gabriel ]
+  * New upstream version (3.99.2.1):
+    - Add Ubuntu-2d (Unity) support to X2Go Client.
+
+ -- Mike Gabriel &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">mike.gabriel at das-netzwerkteam.de</A>&gt;  Fri, 08 Jun 2012 12:52:07 +0200
+
 x2goclient (3.99.2.0-0~x2go1) unstable; urgency=low
 
   [ Oleksandr Shneyder ]
diff --git a/desktop/x2goclient.desktop b/desktop/x2goclient.desktop
index 5e806a0..16f2040 100644
--- a/desktop/x2goclient.desktop
+++ b/desktop/x2goclient.desktop
@@ -1,6 +1,6 @@
 [Desktop Entry]
 Encoding=UTF-8
-Version=3.99.2.0
+Version=3.99.2.1
 Type=Application
 Name=X2Go Client
 Exec=/usr/bin/x2goclient
diff --git a/icons/128x128/unity.png b/icons/128x128/unity.png
new file mode 100644
index 0000000..e953c76
Binary files /dev/null and b/icons/128x128/unity.png differ
diff --git a/icons/16x16/unity.png b/icons/16x16/unity.png
new file mode 100644
index 0000000..f6fc88d
Binary files /dev/null and b/icons/16x16/unity.png differ
diff --git a/icons/32x32/unity.png b/icons/32x32/unity.png
new file mode 100644
index 0000000..c13cf9a
Binary files /dev/null and b/icons/32x32/unity.png differ
diff --git a/icons/64x64/unity.png b/icons/64x64/unity.png
new file mode 100644
index 0000000..3062e96
Binary files /dev/null and b/icons/64x64/unity.png differ
diff --git a/onmainwindow.cpp b/onmainwindow.cpp
index 4ba3231..6cbd6b4 100644
--- a/onmainwindow.cpp
+++ b/onmainwindow.cpp
@@ -56,6 +56,7 @@ ONMainWindow::ONMainWindow ( QWidget *parent ) :QMainWindow ( parent )
     cleanAllFiles=false;
     drawMenu=true;
     usePGPCard=false;
+    PGPInited=false;
     extLogin=false;
     startMaximized=false;
     startHidden=false;
@@ -268,7 +269,7 @@ ONMainWindow::ONMainWindow ( QWidget *parent ) :QMainWindow ( parent )
     }
 
 
-    if ( usePGPCard )
+    if ( usePGPCard  &amp;&amp; !useLdap)
     {
         QTimer::singleShot ( 10, this, SLOT ( slotStartPGPAuth() ) );
     }
@@ -1035,8 +1036,8 @@ void ONMainWindow::trayIconInit()
             trayIconActiveConnectionMenu-&gt;addAction(tr (&quot;Share folder...&quot; ),this, SLOT(slotExportDirectory()));
             trayIconActiveConnectionMenu-&gt;addAction(tr(&quot;Suspend&quot;),this, SLOT(slotSuspendSessFromSt()));
             trayIconActiveConnectionMenu-&gt;addAction(tr(&quot;Terminate&quot;),this, SLOT(slotTermSessFromSt()));
-            connect (trayIconActiveConnectionMenu, SIGNAL(triggered(QAction*)), this, 
-		     SLOT(slotAppMenuTriggered(QAction*)));
+            connect (trayIconActiveConnectionMenu, SIGNAL(triggered(QAction*)), this,
+                     SLOT(slotAppMenuTriggered(QAction*)));
 
 
             if (sessionStatusDlg &amp;&amp; sessionStatusDlg-&gt;isVisible())
@@ -1081,8 +1082,8 @@ QMenu* ONMainWindow::initTrayAppMenu(QString text, QPixmap icon)
 void ONMainWindow::slotAppMenuTriggered(QAction* action)
 {
     x2goDebug&lt;&lt;&quot;slotAppMenuTriggered :&quot;&lt;&lt;action-&gt;data().toString()&lt;&lt;endl;
-    if(action-&gt;data().toString() != &quot;&quot;)
-      runApplication(action-&gt;data().toString());
+    if (action-&gt;data().toString() != &quot;&quot;)
+        runApplication(action-&gt;data().toString());
 }
 
 void ONMainWindow::plugAppsInTray()
@@ -1095,18 +1096,18 @@ void ONMainWindow::plugAppsInTray()
     topActions.clear();
     foreach(Application app, applications)
     {
-      QAction* act;
-      if(app.category==Application::TOP)
-      {
-	 act=new QAction(app.icon,app.name,trayIconActiveConnectionMenu);
-         trayIconActiveConnectionMenu-&gt;insertAction(appSeparator, act);
-	 topActions.append(act);
-      }
-      else
-      {
-        act=appMenu[app.category]-&gt;addAction(app.icon,app.name);
-        appMenu[app.category]-&gt;menuAction()-&gt;setVisible(true);
-      }
+        QAction* act;
+        if (app.category==Application::TOP)
+        {
+            act=new QAction(app.icon,app.name,trayIconActiveConnectionMenu);
+            trayIconActiveConnectionMenu-&gt;insertAction(appSeparator, act);
+            topActions.append(act);
+        }
+        else
+        {
+            act=appMenu[app.category]-&gt;addAction(app.icon,app.name);
+            appMenu[app.category]-&gt;menuAction()-&gt;setVisible(true);
+        }
         act-&gt;setToolTip(app.comment);
         act-&gt;setData(app.exec);
         empty=false;
@@ -1128,8 +1129,8 @@ void ONMainWindow::removeAppsFromTray()
     }
     foreach (QAction* act, topActions)
     {
-      trayIconActiveConnectionMenu-&gt;removeAction(act);
-      delete act;
+        trayIconActiveConnectionMenu-&gt;removeAction(act);
+        delete act;
     }
     topActions.clear();
     appSeparator-&gt;setVisible(false);
@@ -1555,6 +1556,12 @@ void ONMainWindow::displayUsers()
                  SLOT ( slotSnameChanged ( const QString&amp; ) ) );
     connect ( uname,SIGNAL ( textEdited ( const QString&amp; ) ),this,
               SLOT ( slotUnameChanged ( const QString&amp; ) ) );
+    if ( usePGPCard  &amp;&amp; !PGPInited)
+    {
+        PGPInited=true;
+        x2goDebug&lt;&lt;&quot;Users loaded, starting smart card daemon\n&quot;;
+        QTimer::singleShot ( 10, this, SLOT ( slotStartPGPAuth() ) );
+    }
 }
 
 void ONMainWindow::showPass ( UserButton* user )
@@ -2574,6 +2581,9 @@ void ONMainWindow::slotSelectedFromList ( SessionButton* session )
         userName=st.setting()-&gt;value (
                      sid+&quot;/user&quot;,
                      ( QVariant ) QString::null ).toString();
+        if (defaultUser &amp;&amp; userName.length()&lt;1)
+            userName=defaultUserName;
+
         sshPort=st.setting()-&gt;value (
                     sid+&quot;/sshport&quot;,
                     ( QVariant ) defaultSshPort ).toString();
@@ -2788,3 +2798,8045 @@ void ONMainWindow::slotSshConnectionError ( QString message, QString lastSession
 }
 
 
+
+
+void ONMainWindow::slotSshConnectionOk()
+{
+    x2goDebug&lt;&lt;&quot;ssh connection ok&quot;&lt;&lt;endl;
+    passForm-&gt;setEnabled ( true );
+    if ( useLdap )
+    {
+        continueLDAPSession();
+    }
+    else
+        continueNormalSession();
+}
+
+
+SshMasterConnection*  ONMainWindow::findServerSshConnection(QString host)
+{
+    for (int i=0;i&lt;serverSshConnections.count();++i)
+    {
+        if (serverSshConnections[i])
+        {
+            if (serverSshConnections[i]-&gt;getHost()==host)
+                return serverSshConnections[i];
+        }
+    }
+    return 0l;
+}
+
+void ONMainWindow::slotServSshConnectionOk(QString server)
+{
+    SshMasterConnection* con=findServerSshConnection(server);
+    if (!con)
+        return;
+    SshProcess* lproc;
+    lproc=new SshProcess ( con,  this );
+    connect ( lproc,SIGNAL ( sshFinished ( bool,
+                                           QString,SshProcess* ) ),
+              this,SLOT (
+                  slotListAllSessions ( bool,
+                                        QString,SshProcess* ) ) );
+    x2goDebug&lt;&lt;&quot;getting sessions on &quot;&lt;&lt;server&lt;&lt;endl;
+    lproc-&gt;startNormal ( &quot;export HOSTNAME &amp;&amp; x2golistsessions&quot; );
+}
+
+void ONMainWindow::slotSshServerAuthError ( int error, QString sshMessage )
+{
+    if ( startHidden )
+    {
+        startHidden=false;
+        slotResize();
+        show();
+        activateWindow();
+        raise();
+    }
+    QString errMsg;
+    switch ( error )
+    {
+    case SSH_SERVER_KNOWN_CHANGED:
+        errMsg=tr ( &quot;Host key for server changed.\nIt is now: &quot; ) +sshMessage+&quot;\n&quot;+
+               tr ( &quot;For security reasons, connection will be stopped&quot; );
+        if ( sshConnection )
+        {
+            sshConnection-&gt;wait();
+            delete sshConnection;
+            sshConnection=0l;
+        }
+        slotSshUserAuthError ( errMsg );
+        return;
+
+    case SSH_SERVER_FOUND_OTHER:
+        errMsg=tr ( &quot;The host key for this server was not found but an other&quot;
+                    &quot;type of key exists.An attacker might change the default server key to&quot;
+                    &quot;confuse your client into thinking the key does not exist&quot; );
+        if ( sshConnection )
+        {
+            sshConnection-&gt;wait();
+            delete sshConnection;
+            sshConnection=0l;
+        }
+        slotSshUserAuthError ( errMsg );
+        return ;
+
+    case SSH_SERVER_ERROR:
+        if ( sshConnection )
+        {
+            sshConnection-&gt;wait();
+            delete sshConnection;
+            sshConnection=0l;
+        }
+        slotSshUserAuthError ( errMsg );
+        return ;
+    case SSH_SERVER_FILE_NOT_FOUND:
+        errMsg=tr ( &quot;Could not find known host file.&quot;
+                    &quot;If you accept the host key here, the file will be automatically created&quot; );
+        break;
+
+    case SSH_SERVER_NOT_KNOWN:
+        errMsg=tr ( &quot;The server is unknown. Do you trust the host key?\nPublic key hash: &quot; ) +sshMessage;
+        break;
+    }
+
+    if ( QMessageBox::warning ( this, tr ( &quot;Host key verification failed&quot; ),errMsg,tr ( &quot;Yes&quot; ), tr ( &quot;No&quot; ) ) !=0 )
+    {
+        if ( sshConnection )
+        {
+            sshConnection-&gt;wait();
+            delete sshConnection;
+            sshConnection=0l;
+        }
+        slotSshUserAuthError ( tr ( &quot;Host key verification failed&quot; ) );
+        return;
+    }
+    sshConnection-&gt;setAcceptUnknownServers ( true );
+    sshConnection-&gt;start();
+}
+
+void ONMainWindow::slotSshUserAuthError ( QString error )
+{
+    if ( sshConnection )
+    {
+        sshConnection-&gt;wait();
+        delete sshConnection;
+        sshConnection=0l;
+    }
+
+    QMessageBox::critical ( 0l,tr ( &quot;Authentication failed&quot; ),error,
+                            QMessageBox::Ok,
+                            QMessageBox::NoButton );
+// 	currentKey=QString::null;
+    setEnabled ( true );
+    passForm-&gt;setEnabled ( true );
+    slotShowPassForm();
+    pass-&gt;setFocus();
+    pass-&gt;selectAll();
+
+
+
+    passForm-&gt;setEnabled ( true );
+    if ( startHidden )
+    {
+        startHidden=false;
+        slotResize();
+        show();
+        activateWindow();
+        raise();
+    }
+}
+
+void ONMainWindow::slotSessEnter()
+{
+    if ( useLdap )
+    {
+        slotPassEnter();
+        return;
+    }
+    if (brokerMode)
+    {
+        if (!config.brokerAuthenticated)
+        {
+            x2goDebug&lt;&lt;&quot;starting broker request&quot;;
+            slotStartBroker();
+            return;
+        }
+    }
+
+    resumingSession.sessionId=QString::null;
+    resumingSession.server=QString::null;
+    resumingSession.display=QString::null;
+    setStatStatus ( tr ( &quot;connecting&quot; ) );
+
+    QString sid=&quot;&quot;;
+    if ( !embedMode )
+        sid=lastSession-&gt;id();
+    startSession ( sid );
+}
+
+void ONMainWindow::continueNormalSession()
+{
+    x2goDebug&lt;&lt;&quot;continue normal x2go session&quot;&lt;&lt;endl;
+    if (brokerMode)
+    {
+        slotListSessions(true,QString::null,0);
+        return;
+    }
+    SshProcess* proc=new SshProcess ( sshConnection, this );
+    connect ( proc,SIGNAL ( sshFinished ( bool,QString,SshProcess* ) ),
+              this,SLOT ( slotListSessions ( bool, QString,
+                                             SshProcess* ) ) );
+    if ( !shadowSession )
+        proc-&gt;startNormal ( &quot;export HOSTNAME &amp;&amp; x2golistsessions&quot; );
+    else
+        proc-&gt;startNormal ( &quot;export HOSTNAME &amp;&amp; x2golistdesktops&quot; );
+
+}
+
+void ONMainWindow::continueLDAPSession()
+{
+
+
+    SshProcess* proc=new SshProcess ( sshConnection,this );
+    connect ( proc,SIGNAL ( sshFinished ( bool,QString,SshProcess* ) ),
+              this,SLOT ( slotGetServers ( bool, QString,SshProcess* ) ) );
+    proc-&gt;startNormal ( &quot;x2gogetservers&quot; );
+}
+
+
+bool ONMainWindow::startSession ( const QString&amp; sid )
+{
+    setEnabled ( false );
+    QString passwd;
+    QString user;
+    QString host;
+    bool autologin=false;
+    bool krblogin=false;
+    user=getCurrentUname();
+    runRemoteCommand=true;
+    shadowSession=false;
+    applications.clear();
+    removeAppsFromTray();
+
+    if ( managedMode )
+    {
+        slotListSessions ( true, QString::null,0 );
+        return true;
+    }
+
+    if ( !embedMode &amp;&amp; !brokerMode )
+    {
+
+        X2goSettings st ( &quot;sessions&quot; );
+
+        passForm-&gt;setEnabled ( false );
+        host=st.setting()-&gt;value ( sid+&quot;/host&quot;,
+                                   ( QVariant ) QString::null ).toString();
+        QString cmd=st.setting()-&gt;value ( sid+&quot;/command&quot;,
+                                          ( QVariant ) QString::null ).toString();
+        autologin=st.setting()-&gt;value ( sid+&quot;/autologin&quot;,
+                                        ( QVariant ) false ).toBool();
+        krblogin=st.setting()-&gt;value ( sid+&quot;/krblogin&quot;,
+                                       ( QVariant ) false ).toBool();
+        if ( cmd==&quot;SHADOW&quot; )
+            shadowSession=true;
+    }
+    else
+    {
+        host=config.server;
+        sshPort=config.sshport;
+        selectedCommand=config.command;
+    }
+    if (!brokerMode)
+        passwd=getCurrentPass();
+    else
+    {
+        currentKey=config.key;
+        host=config.server;
+        X2goSettings st ( config.iniFile, QSettings::IniFormat );
+        passForm-&gt;setEnabled ( false );
+        user=st.setting()-&gt;value ( sid+&quot;/user&quot;,
+                                   ( QVariant ) QString::null ).toString();
+        login-&gt;setText(user);
+        sshPort=config.sshport;
+        /*        sshPort=st.setting()-&gt;value ( sid+&quot;/sshport&quot;,
+                                              ( QVariant ) &quot;22&quot; ).toString();*/
+    }
+    if (sshConnection)
+        sshConnection-&gt;disconnectSession();
+    sshConnection=startSshConnection ( host,sshPort,acceptRsa,user,passwd,autologin, krblogin );
+    return true;
+}
+
+
+void ONMainWindow::slotListSessions ( bool result,QString output,
+                                      SshProcess* proc )
+{
+    if ( proc )
+        delete proc;
+    if ( result==false )
+    {
+        cardReady=false;
+        cardStarted=false;
+        QString message=tr ( &quot;&lt;b&gt;Connection failed&lt;/b&gt;\n&quot; ) +output;
+        if ( message.indexOf ( &quot;publickey,password&quot; ) !=-1 )
+        {
+            message=tr ( &quot;&lt;b&gt;Wrong password!&lt;/b&gt;&lt;br&gt;&lt;br&gt;&quot; ) +
+                    message;
+        }
+
+        QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),message,
+                                QMessageBox::Ok,
+                                QMessageBox::NoButton );
+// 		currentKey=QString::null;
+        setEnabled ( true );
+        passForm-&gt;setEnabled ( true );
+        slotShowPassForm();
+        pass-&gt;setFocus();
+        pass-&gt;selectAll();
+        return;
+    }
+
+    passForm-&gt;hide();
+    if ( !embedMode )
+    {
+        setUsersEnabled ( false );
+        uname-&gt;setEnabled ( false );
+        u-&gt;setEnabled ( false );
+    }
+    if ( managedMode || brokerMode )
+    {
+        x2goDebug&lt;&lt;&quot;sess data:&quot;&lt;&lt;config.sessiondata;
+        if ( config.sessiondata.indexOf ( &quot;|S|&quot; ) ==-1 )
+        {
+            x2goDebug&lt;&lt;&quot;start new managed session&quot;;
+            startNewSession();
+        }
+        else
+        {
+            x2goSession s=getSessionFromString (
+                              config.sessiondata );
+            x2goDebug&lt;&lt;&quot;resuming managed session:&quot;&lt;&lt;s.sessionId;
+            resumeSession ( s );
+        }
+        return;
+    }
+
+    QStringList sessions=output.trimmed().split ( '\n',
+                         QString::SkipEmptyParts );
+    if ( shadowSession )
+    {
+        selectSession ( sessions );
+    }
+    else
+    {
+        if ( ( sessions.size() ==0 ) ||
+                ( sessions.size() ==1&amp;&amp;sessions[0].length() &lt;5 ) )
+            startNewSession();
+        else if ( sessions.size() ==1 )
+        {
+            x2goSession s=getSessionFromString ( sessions[0] );
+            QDesktopWidget wd;
+            if ( s.status==&quot;S&quot; &amp;&amp; isColorDepthOk ( wd.depth(),
+                                                   s.colorDepth )
+                    &amp;&amp;s.command == selectedCommand )
+                resumeSession ( s );
+            else
+            {
+                if ( startHidden )
+                    startNewSession();
+                else
+                    selectSession ( sessions );
+            }
+        }
+        else
+        {
+            if ( !startHidden )
+                selectSession ( sessions );
+            else
+            {
+                for ( int i=0;i&lt;sessions.size();++i )
+                {
+                    x2goSession s=getSessionFromString (
+                                      sessions[i] );
+                    QDesktopWidget wd;
+                    if ( s.status==&quot;S&quot; &amp;&amp; isColorDepthOk (
+                                wd.depth(),s.colorDepth )
+                            &amp;&amp;s.command == selectedCommand )
+                    {
+                        resumeSession ( s );
+                        return;
+                    }
+                }
+                startNewSession();
+            }
+        }
+    }
+}
+
+
+x2goSession ONMainWindow::getSessionFromString ( const QString&amp; string )
+{
+    QStringList lst=string.split ( '|' );
+    x2goSession s;
+    s.agentPid=lst[0];
+    s.sessionId=lst[1];
+    s.display=lst[2];
+    s.server=lst[3];
+    s.status=lst[4];
+    s.crTime=lst[5];
+    s.cookie=lst[6];
+    s.clientIp=lst[7];
+    s.grPort=lst[8];
+    s.sndPort=lst[9];
+    if ( lst.count() &gt;13 )
+        s.fsPort=lst[13];
+    s.colorDepth=0;
+    if ( s.sessionId.indexOf ( &quot;_dp&quot; ) !=-1 )
+    {
+        s.colorDepth=s.sessionId.split ( &quot;_dp&quot; ) [1].toInt();
+    }
+    s.sessionType=x2goSession::DESKTOP;
+    s.command=tr ( &quot;unknown&quot; );
+    if ( s.sessionId.indexOf ( &quot;_st&quot; ) !=-1 )
+    {
+        QString cmdinfo=s.sessionId.split ( &quot;_st&quot; ) [1];
+        cmdinfo=cmdinfo.split ( &quot;_&quot; ) [0];
+        QChar st=cmdinfo[0];
+        if ( st=='R' )
+            s.sessionType=x2goSession::ROOTLESS;
+        if ( st=='S' )
+            s.sessionType=x2goSession::SHADOW;
+        QString command=cmdinfo.mid ( 1 );
+        if ( command.length() &gt;0 )
+            s.command=command;
+    }
+    return s;
+}
+
+
+void ONMainWindow::startNewSession()
+{
+    newSession=true;
+    QString passwd=getCurrentPass();
+    QString user=getCurrentUname();
+
+    QString pack;
+    bool fullscreen;
+    int height;
+    int width;
+    int quality;
+    int speed;
+    bool usekbd;
+    bool rootless=false;
+    resumingSession.published=false;
+    bool setDPI=defaultSetDPI;
+    uint dpi=defaultDPI;
+    QString layout;
+    QString type;
+    QString command;
+    QString xdmcpServer;
+    runRemoteCommand=true;
+    QString host=QString::null;
+    runStartApp=true;
+    removeAppsFromTray();
+    if ( useLdap )
+    {
+        pack=defaultPack;
+        fullscreen=defaultFullscreen;
+        height=defaultHeight;
+        width=defaultWidth;
+        quality=defaultQuality;
+        speed=defaultLink;
+        usekbd=defaultSetKbd;
+        layout=defaultLayout[0];
+        type=defaultKbdType;
+        command=defaultCmd;
+        shadowSession=false;
+        for ( int j=0;j&lt;x2goServers.size();++j )
+        {
+            if ( x2goServers[j].connOk )
+            {
+                host=x2goServers[j].name;
+                break;
+            }
+        }
+        if ( host==QString::null )
+        {
+            QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),
+                                    tr ( &quot;No server availabel&quot; ),
+                                    QMessageBox::Ok,
+                                    QMessageBox::NoButton );
+            return;
+        }
+        sshConnection=findServerSshConnection(host);
+        if (!sshConnection)
+        {
+            QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),
+                                    tr ( &quot;Server not availabel&quot; ),
+                                    QMessageBox::Ok,
+                                    QMessageBox::NoButton );
+            return;
+        }
+    }
+    else
+    {
+        X2goSettings* st;
+
+        if (!brokerMode)
+            st=new X2goSettings( &quot;sessions&quot; );
+        else
+            st= new X2goSettings(config.iniFile,QSettings::IniFormat);
+
+        QString sid;
+        if ( !embedMode )
+            sid=lastSession-&gt;id();
+        else
+            sid=&quot;embedded&quot;;
+        pack=st-&gt;setting()-&gt;value ( sid+&quot;/pack&quot;,
+                                    ( QVariant ) defaultPack ).toString();
+        fullscreen=st-&gt;setting()-&gt;value ( sid+&quot;/fullscreen&quot;,
+                                          ( QVariant )
+                                          defaultFullscreen ).toBool();
+        height=st-&gt;setting()-&gt;value ( sid+&quot;/height&quot;,
+                                      ( QVariant ) defaultHeight ).toInt();
+        width=st-&gt;setting()-&gt;value ( sid+&quot;/width&quot;,
+                                     ( QVariant ) defaultWidth ).toInt();
+        setDPI=st-&gt;setting()-&gt;value ( sid+&quot;/setdpi&quot;,
+                                      ( QVariant ) defaultSetDPI ).toBool();
+        dpi=st-&gt;setting()-&gt;value ( sid+&quot;/dpi&quot;,
+                                   ( QVariant ) defaultDPI ).toUInt();
+        quality=st-&gt;setting()-&gt;value (
+                    sid+&quot;/quality&quot;,
+                    ( QVariant ) defaultQuality ).toInt();
+        speed=st-&gt;setting()-&gt;value ( sid+&quot;/speed&quot;,
+                                     ( QVariant ) defaultLink ).toInt();
+
+        usekbd=st-&gt;setting()-&gt;value ( sid+&quot;/usekbd&quot;,
+                                      ( QVariant ) defaultSetKbd ).toBool();
+        layout=st-&gt;setting()-&gt;value ( sid+&quot;/layout&quot;,
+                                      ( QVariant )
+                                      defaultLayout[0] ).toString();
+        type=st-&gt;setting()-&gt;value ( sid+&quot;/type&quot;,
+                                    ( QVariant )
+                                    defaultKbdType ).toString();
+        if ( !embedMode )
+        {
+            command=st-&gt;setting()-&gt;value ( sid+&quot;/command&quot;,
+                                           ( QVariant ) defaultCmd ).toString();
+            host=st-&gt;setting()-&gt;value (
+                     sid+&quot;/host&quot;,
+                     ( QVariant )
+                     ( QString ) &quot;localhost&quot; ).toString();
+
+            rootless=st-&gt;setting()-&gt;value ( sid+&quot;/rootless&quot;,
+                                            ( QVariant ) false ).toBool();
+            resumingSession.published=st-&gt;setting()-&gt;value ( sid+&quot;/published&quot;,
+                                      ( QVariant ) false ).toBool();
+            xdmcpServer=st-&gt;setting()-&gt;value ( sid+&quot;/xdmcpserver&quot;,
+                                               ( QVariant )
+                                               &quot;localhost&quot; ).toString();
+        }
+        else
+        {
+            command=config.command;
+            rootless= config.rootless;
+            host=config.server;
+            startEmbedded=false;
+            if ( st-&gt;setting()-&gt;value ( sid+&quot;/startembed&quot;,
+                                        ( QVariant ) true ).toBool() )
+            {
+                startEmbedded=true;
+                fullscreen=false;
+                height=bgFrame-&gt;size().height()-stb-&gt;height();
+                width=bgFrame-&gt;size().width();
+
+                if ( height&lt;0 ||width&lt;0 )
+                {
+                    height=defaultHeight;
+                    width=defaultWidth;
+                }
+            }
+            if ( config.confConSpd )
+                speed=config.conSpeed;
+            if ( config.confCompMet )
+                pack=config.compMet;
+            if ( config.confImageQ )
+                quality=config.imageQ;
+            if ( config.confDPI )
+            {
+                dpi=config.dpi;
+                setDPI=true;
+            }
+            if ( config.confKbd )
+            {
+                layout=config.kbdLay;
+                type=config.kbdType;
+                usekbd=true;
+            }
+        }
+        if ( command==&quot;RDP&quot; )
+            rootless=true;
+        if ( command==&quot;XDMCP&quot; )
+        {
+            runRemoteCommand=false;
+        }
+        delete st;
+    }
+
+
+    if ( shadowSession )
+    {
+        runRemoteCommand=false;
+    }
+
+    resumingSession.server=host;
+
+    if (defaultLayout.size()&gt;0)
+        layout=cbLayout-&gt;currentText();
+
+
+    QString geometry;
+#ifdef Q_OS_WIN
+    x2goDebug&lt;&lt;&quot;fullscreen: &quot;&lt;&lt;fullscreen;
+    maximizeProxyWin=false;
+    proxyWinWidth=width;
+    proxyWinHeight=height;
+//#ifdef CFGCLIENT
+    xorgMode=WIN;
+    if (fullscreen)
+        xorgMode=FS;
+    if (rootless)
+        xorgMode=SAPP;
+    xorgWidth=QString::number(width);
+    xorgHeight=QString::number(height);
+    if (! startXorgOnStart)
+        startXOrg();
+//#endif
+#endif
+    if ( fullscreen )
+    {
+        geometry=&quot;fullscreen&quot;;
+#ifdef Q_OS_WIN
+//        fullscreen=false;
+        maximizeProxyWin=true;
+        x2goDebug&lt;&lt;&quot;maximizeProxyWin: &quot;&lt;&lt;maximizeProxyWin;
+#endif
+    }
+    if ( ! fullscreen )
+    {
+        geometry=QString::number ( width ) +&quot;x&quot;+
+                 QString::number ( height );
+        if ( embedMode )
+        {
+            QPoint position=mapToGlobal ( bgFrame-&gt;pos() );
+            geometry+=&quot;+&quot;+QString::number ( position.x() ) +&quot;+&quot;+
+                      QString::number ( position.y() +
+                                        stb-&gt;height() );
+        }
+
+    }
+    QString link;
+    switch ( speed )
+    {
+    case MODEM:
+        link=&quot;modem&quot;;
+        break;
+    case ISDN:
+        link=&quot;isdn&quot;;
+        break;
+    case ADSL:
+        link=&quot;adsl&quot;;
+        break;
+    case WAN:
+        link=&quot;wan&quot;;
+        break;
+    case LAN:
+        link=&quot;lan&quot;;
+        break;
+    }
+
+    QFile file ( &quot;:/txt/packs&quot; );
+    if ( !file.open ( QIODevice::ReadOnly | QIODevice::Text ) )
+        return;
+    QTextStream in ( &amp;file );
+    while ( !in.atEnd() )
+    {
+        QString pc=in.readLine();
+        if ( pc.indexOf ( &quot;-%&quot; ) !=-1 )
+        {
+            pc=pc.left ( pc.indexOf ( &quot;-%&quot; ) );
+            if ( pc==pack )
+            {
+                pack+=&quot;-&quot;+QString::number ( quality );
+                break;
+            }
+        }
+    }
+    file.close();
+
+
+    if ( selectSessionDlg-&gt;isVisible() )
+    {
+        if ( !embedMode )
+            slotCloseSelectDlg();
+        else
+            selectSessionDlg-&gt;hide();
+    }
+    QDesktopWidget wd;
+    QString depth=QString::number ( wd.depth() );
+#ifdef Q_OS_DARWIN
+    usekbd=0;
+    type=&quot;query&quot;;
+#endif
+    QString sessTypeStr=&quot;D &quot;;
+    if ( rootless )
+        sessTypeStr=&quot;R &quot;;
+    if ( shadowSession )
+        sessTypeStr=&quot;S &quot;;
+    if ( resumingSession.published)
+    {
+        sessTypeStr=&quot;P &quot;;
+        command=&quot;PUBLISHED&quot;;
+    }
+    QString dpiEnv;
+    QString xdmcpEnv;
+    if ( runRemoteCommand==false &amp;&amp; command==&quot;XDMCP&quot; )
+        xdmcpEnv=&quot;X2GOXDMCP=&quot;+xdmcpServer+&quot; &quot;;
+    if ( setDPI )
+    {
+        dpiEnv=&quot;X2GODPI=&quot;+QString::number ( dpi ) +&quot; &quot;;
+    }
+    QString cmd=dpiEnv+xdmcpEnv+&quot;x2gostartagent &quot;+
+                geometry+&quot; &quot;+link+&quot; &quot;+pack+
+                &quot; unix-kde-depth_&quot;+depth+&quot; &quot;+layout+&quot; &quot;+type+&quot; &quot;;
+    if ( usekbd )
+        cmd += &quot;1 &quot;;
+    else
+        cmd += &quot;0 &quot;;
+    QFileInfo f ( command );
+    if ( !shadowSession )
+        cmd+=sessTypeStr+f.fileName();
+    else
+    {
+        cmd+=sessTypeStr+QString::number ( shadowMode ) +&quot;XSHAD&quot;+
+             shadowUser+&quot;XSHAD&quot;+shadowDisplay;
+    }
+    resumingSession.fullscreen=fullscreen;
+    x2goDebug&lt;&lt;cmd&lt;&lt;endl;
+    if ( managedMode )
+    {
+        slotRetResumeSess ( true,config.sessiondata,0 );
+        passForm-&gt;hide();
+        return;
+    }
+
+    SshProcess* proc=0l;
+
+    proc=new SshProcess ( sshConnection, this ) ;
+
+
+    connect ( proc,SIGNAL ( sshFinished ( bool, QString,SshProcess* ) ),
+              this,SLOT ( slotRetResumeSess ( bool,
+                                              QString,SshProcess* ) ) );
+
+    proc-&gt;startNormal ( cmd );
+    passForm-&gt;hide();
+}
+
+
+
+void ONMainWindow::resumeSession ( const x2goSession&amp; s )
+{
+    newSession=false;
+    runStartApp=false;
+    applications.clear();
+    removeAppsFromTray();
+    QString passwd=getCurrentPass();
+    QString user=getCurrentUname();
+    QString host=s.server;
+    bool rootless=false;
+
+    QString pack;
+    bool fullscreen;
+    int height;
+    int width;
+    int quality;
+    int speed;
+    bool usekbd;
+    QString layout;
+    QString type;
+    removeAppsFromTray();
+
+    if ( useLdap )
+    {
+        pack=defaultPack;
+        fullscreen=defaultFullscreen;
+        height=defaultHeight;
+        width=defaultWidth;
+        quality=defaultQuality;
+        speed=defaultLink;
+        usekbd=defaultSetKbd;
+        layout=defaultLayout[0];
+        type=defaultKbdType;
+        sshConnection=findServerSshConnection(host);
+        if (!sshConnection)
+        {
+            QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),
+                                    tr ( &quot;Server not availabel&quot; ),
+                                    QMessageBox::Ok,
+                                    QMessageBox::NoButton );
+            return;
+        }
+    }
+    else
+    {
+
+        QString sid;
+        if ( !embedMode )
+            sid=lastSession-&gt;id();
+        else
+            sid=&quot;embedded&quot;;
+        X2goSettings* st;
+        if (!brokerMode)
+            st=new X2goSettings( &quot;sessions&quot; );
+        else
+            st=new X2goSettings(config.iniFile,QSettings::IniFormat);
+
+        pack=st-&gt;setting()-&gt;value ( sid+&quot;/pack&quot;,
+                                    ( QVariant ) defaultPack ).toString();
+
+        fullscreen=st-&gt;setting()-&gt;value ( sid+&quot;/fullscreen&quot;,
+                                          ( QVariant )
+                                          defaultFullscreen ).toBool();
+        height=st-&gt;setting()-&gt;value ( sid+&quot;/height&quot;,
+                                      ( QVariant ) defaultHeight ).toInt();
+        width=st-&gt;setting()-&gt;value ( sid+&quot;/width&quot;,
+                                     ( QVariant ) defaultWidth ).toInt();
+        quality=st-&gt;setting()-&gt;value ( sid+&quot;/quality&quot;,
+                                       ( QVariant )
+                                       defaultQuality ).toInt();
+        speed=st-&gt;setting()-&gt;value ( sid+&quot;/speed&quot;,
+                                     ( QVariant ) defaultLink ).toInt();
+        usekbd=st-&gt;setting()-&gt;value ( sid+&quot;/usekbd&quot;,
+                                      ( QVariant ) defaultSetKbd ).toBool();
+        layout=st-&gt;setting()-&gt;value ( sid+&quot;/layout&quot;,
+                                      ( QVariant )
+                                      defaultLayout[0] ).toString();
+        type=st-&gt;setting()-&gt;value ( sid+&quot;/type&quot;,
+                                    ( QVariant )
+                                    defaultKbdType ).toString();
+        rootless=st-&gt;setting()-&gt;value ( sid+&quot;/rootless&quot;,
+                                        ( QVariant ) false ).toBool();
+
+        if ( !embedMode )
+        {
+            host=st-&gt;setting()-&gt;value ( sid+&quot;/host&quot;,
+                                        ( QVariant ) s.server ).toString();
+        }
+        else
+        {
+            startEmbedded=false;
+            if ( st-&gt;setting()-&gt;value ( sid+&quot;/startembed&quot;,
+                                        ( QVariant ) true ).toBool() )
+            {
+                fullscreen=false;
+                startEmbedded=true;
+                height=bgFrame-&gt;size().height()-stb-&gt;height();
+                width=bgFrame-&gt;size().width();
+                if ( height&lt;0 ||width&lt;0 )
+                {
+                    height=defaultHeight;
+                    width=defaultWidth;
+                }
+            }
+            rootless=config.rootless;
+            host=config.server;
+            if ( config.confConSpd )
+                speed=config.conSpeed;
+            if ( config.confCompMet )
+                pack=config.compMet;
+            if ( config.confImageQ )
+                quality=config.imageQ;
+            if ( config.confKbd )
+            {
+                layout=config.kbdLay;
+                type=config.kbdType;
+                usekbd=true;
+            }
+        }
+        delete st;
+    }
+
+    if (defaultLayout.size()&gt;0)
+        layout=cbLayout-&gt;currentText();
+
+    QString geometry;
+#ifdef Q_OS_WIN
+    maximizeProxyWin=false;
+    proxyWinWidth=width;
+    proxyWinHeight=height;
+// #ifdef CFGCLIENT
+    xorgMode=WIN;
+    if (fullscreen)
+        xorgMode=FS;
+    if (rootless)
+        xorgMode=SAPP;
+    xorgWidth=QString::number(width);
+    xorgHeight=QString::number(height);
+    if (! startXorgOnStart)
+        startXOrg();
+// #endif
+
+#endif
+    if ( fullscreen )
+    {
+        geometry=&quot;fullscreen&quot;;
+#ifdef Q_OS_WIN
+//        fullscreen=false;
+        maximizeProxyWin=true;
+        x2goDebug&lt;&lt;&quot;maximizeProxyWin: &quot;&lt;&lt;maximizeProxyWin;
+
+#endif
+    }
+    if ( !fullscreen )
+    {
+        geometry=QString::number ( width ) +&quot;x&quot;+
+                 QString::number ( height );
+    }
+    resumingSession.fullscreen=fullscreen;
+    QString link;
+    switch ( speed )
+    {
+    case MODEM:
+        link=&quot;modem&quot;;
+        break;
+    case ISDN:
+        link=&quot;isdn&quot;;
+        break;
+    case ADSL:
+        link=&quot;adsl&quot;;
+        break;
+    case WAN:
+        link=&quot;wan&quot;;
+        break;
+    case LAN:
+        link=&quot;lan&quot;;
+        break;
+    }
+
+    QFile file ( &quot;:/txt/packs&quot; );
+    if ( !file.open ( QIODevice::ReadOnly | QIODevice::Text ) )
+        return;
+    QTextStream in ( &amp;file );
+    while ( !in.atEnd() )
+    {
+        QString pc=in.readLine();
+        if ( pc.indexOf ( &quot;-%&quot; ) !=-1 )
+        {
+            pc=pc.left ( pc.indexOf ( &quot;-%&quot; ) );
+            if ( pc==pack )
+            {
+                pack+=&quot;-&quot;+QString::number ( quality );
+                break;
+            }
+        }
+    }
+    file.close();
+
+#ifdef Q_OS_DARWIN
+    usekbd=0;
+    type=&quot;query&quot;;
+#endif
+
+    if (s.sessionId.indexOf(&quot;RPUBLISHED&quot;)!=-1)
+    {
+        resumingSession.published=true;
+        sbApps-&gt;setDisabled(true);
+    }
+    else
+        resumingSession.published=false;
+
+
+
+    if ( selectSessionDlg-&gt;isVisible() )
+    {
+        if ( !embedMode )
+            slotCloseSelectDlg();
+        else
+            selectSessionDlg-&gt;hide();
+    }
+    QString cmd=&quot;x2goresume-session &quot;+s.sessionId+&quot; &quot;+geometry+
+                &quot; &quot;+link+&quot; &quot;+pack+&quot; &quot;+layout+
+                &quot; &quot;+type+&quot; &quot;;
+    if ( usekbd )
+        cmd += &quot;1&quot;;
+    else
+        cmd += &quot;0&quot;;
+
+    SshProcess* proc=0l;
+    proc=new SshProcess ( sshConnection, this );
+
+    connect ( proc,SIGNAL ( sshFinished ( bool, QString,SshProcess* ) ),
+              this,SLOT ( slotRetResumeSess ( bool, QString,
+                                              SshProcess* ) ) );
+
+    proc-&gt;startNormal ( cmd );
+    resumingSession=s;
+    passForm-&gt;hide();
+}
+
+
+void ONMainWindow::selectSession ( QStringList&amp; sessions )
+{
+    setEnabled ( true );
+    sessionStatusDlg-&gt;hide();
+    passForm-&gt;hide();
+// 	x2goDebug&lt;&lt;&quot;check type&quot;;
+    if ( !shadowSession )
+    {
+// 		x2goDebug&lt;&lt;&quot;! shadow&quot;;
+        if ( !miniMode )
+            selectSesDlgLayout-&gt;setContentsMargins ( 25,25,10,10 );
+
+        bNew-&gt;show();
+        bSusp-&gt;show();
+        bTerm-&gt;show();
+        sOk-&gt;show();
+        sCancel-&gt;show();
+// 		x2goDebug&lt;&lt;&quot;standart buttons ok&quot;;
+        desktopFilter-&gt;hide();
+        desktopFilterCb-&gt;hide();
+        bShadow-&gt;hide();
+        bShadowView-&gt;hide();
+        bCancel-&gt;hide();
+// 		x2goDebug&lt;&lt;&quot;shadow buttons ok&quot;;
+// 		model-&gt;clear();
+        model-&gt;removeRows ( 0,model-&gt;rowCount() );
+        selectSessionLabel-&gt;setText ( tr ( &quot;Select session:&quot; ) );
+        selectedSessions.clear();
+        QFontMetrics fm ( sessTv-&gt;font() );
+        for ( int row = 0; row &lt; sessions.size(); ++row )
+        {
+
+// 			x2goDebug&lt;&lt;&quot;decoding sessionstr:&quot;&lt;&lt;sessions[row];
+            x2goSession s=getSessionFromString ( sessions[row] );
+// 			x2goDebug&lt;&lt;&quot;listing id:&quot;&lt;&lt;s.sessionId;
+            selectedSessions.append ( s );
+            QStandardItem *item;
+
+            item= new QStandardItem ( s.display );
+            model-&gt;setItem ( row,S_DISPLAY,item );
+
+            if ( s.status==&quot;R&quot; )
+                item= new QStandardItem ( tr ( &quot;running&quot; ) );
+            else
+                item= new QStandardItem ( tr ( &quot;suspended&quot; ) );
+            model-&gt;setItem ( row,S_STATUS,item );
+
+            item= new QStandardItem ( transAppName ( s.command ) );
+            model-&gt;setItem ( row,S_COMMAND,item );
+
+            QString type=tr ( &quot;Desktop&quot; );
+            if ( s.sessionType==x2goSession::ROOTLESS )
+                type=tr ( &quot;single application&quot; );
+            if ( s.sessionType==x2goSession::SHADOW )
+                type=tr ( &quot;shadow session&quot; );
+
+            item= new QStandardItem ( type );
+            model-&gt;setItem ( row,S_TYPE,item );
+
+            item= new QStandardItem ( s.crTime );
+            model-&gt;setItem ( row,S_CRTIME,item );
+            item= new QStandardItem ( s.server );
+            model-&gt;setItem ( row,S_SERVER,item );
+            item= new QStandardItem ( s.clientIp );
+            model-&gt;setItem ( row,S_IP,item );
+            item= new QStandardItem ( s.sessionId );
+            model-&gt;setItem ( row,S_ID,item );
+            for ( int j=0;j&lt;8;++j )
+            {
+                QString txt=
+                    model-&gt;index ( row,j ).data().toString();
+                if ( sessTv-&gt;header()-&gt;sectionSize ( j ) &lt;
+                        fm.width ( txt ) +6 )
+                {
+                    sessTv-&gt;header()-&gt;resizeSection (
+                        j,fm.width ( txt ) +6 );
+                }
+            }
+        }
+    }
+    else
+    {
+        shadowMode=SHADOW_VIEWONLY;
+        selectedDesktops.clear();
+        selectedDesktops=sessions;
+        if ( sessions.size() ==0 )
+        {
+            QMessageBox::information ( this,tr ( &quot;Information&quot; ),
+                                       tr ( &quot;No accessible desktop &quot;
+                                            &quot;found&quot; ) );
+            slotCloseSelectDlg();
+            return;
+        }
+        sessTv-&gt;setModel ( ( QAbstractItemModel* ) modelDesktop );
+        desktopFilter-&gt;show();
+        desktopFilterCb-&gt;show();
+        sOk-&gt;hide();
+        sCancel-&gt;hide();
+        bShadow-&gt;show();
+        bCancel-&gt;show();
+        bShadowView-&gt;show();
+        desktopFilter-&gt;setText ( tr ( &quot;Filter&quot; ) );
+        sessions.sort();
+        if ( !miniMode )
+            selectSesDlgLayout-&gt;setContentsMargins ( 25,25,25,25 );
+        bNew-&gt;hide();
+        bSusp-&gt;hide();
+        bTerm-&gt;hide();
+        selectSessionLabel-&gt;setText ( tr ( &quot;Select desktop:&quot; ) );
+        filterDesktops ( &quot;&quot; );
+        desktopFilter-&gt;setFocus();
+        desktopFilter-&gt;selectAll();
+    }
+    selectSessionDlg-&gt;show();
+}
+
+void ONMainWindow::slotCloseSelectDlg()
+{
+    selectSessionDlg-&gt;hide();
+    if ( !embedMode )
+    {
+        u-&gt;setEnabled ( true );
+        uname-&gt;setEnabled ( true );
+    }
+    slotShowPassForm();
+}
+
+
+
+void ONMainWindow::slotActivated ( const QModelIndex&amp; index )
+{
+    if ( !shadowSession )
+    {
+        QString status=sessTv-&gt;model()-&gt;index (
+                           index.row(),
+                           S_STATUS ).data().toString();
+        if ( status==tr ( &quot;running&quot; ) )
+        {
+            bSusp-&gt;setEnabled ( true );
+            sOk-&gt;setEnabled ( false );
+        }
+        else
+        {
+            bSusp-&gt;setEnabled ( false );
+            sOk-&gt;setEnabled ( true );
+        }
+        bTerm-&gt;setEnabled ( true );
+        if ( status==QString::null )
+        {
+            sOk-&gt;setEnabled ( false );
+            bTerm-&gt;setEnabled ( false );
+        }
+    }
+    else
+    {
+        QString user=sessTv-&gt;model()-&gt;index (
+                         index.row(),
+                         D_USER ).data().toString();
+        bShadowView-&gt;setEnabled ( true );
+        bShadow-&gt;setEnabled ( user==getCurrentUname() );
+    }
+}
+
+
+void ONMainWindow::slotResumeSess()
+{
+    x2goSession s=getSelectedSession();
+    QDesktopWidget wd;
+    if ( isColorDepthOk ( wd.depth(),s.colorDepth ) )
+        resumeSession ( s );
+    else
+    {
+        QString depth=QString::number ( s.colorDepth );
+        int res;
+        if ( s.colorDepth==24 || s.colorDepth==32 )
+        {
+            res=QMessageBox::warning (
+                    0l,tr ( &quot;Warning&quot; ),
+                    tr (
+                        &quot;Your current color depth is &quot;
+                        &quot;different to the color depth of your &quot;
+                        &quot;x2go-session. This may cause problems &quot;
+                        &quot;reconnecting to this session and in most &quot;
+                        &quot;cases &lt;b&gt;you will loose the session&lt;/b&gt; &quot;
+                        &quot;and have to start a new one! It's highly &quot;
+                        &quot;recommended to change the color depth of &quot;
+                        &quot;your Display to &quot; ) +tr ( &quot;24 or 32&quot; ) +
+                    tr (
+                        &quot; bit and restart your X-server before you &quot;
+                        &quot;reconnect to this x2go-session.&lt;br&gt;Resume &quot;
+                        &quot;this session anyway?&quot; ),tr ( &quot;Yes&quot; ),
+                    tr ( &quot;No&quot; ) );
+
+        }
+        else
+        {
+            res=QMessageBox::warning (
+                    0l,tr ( &quot;Warning&quot; ),
+                    tr (
+                        &quot;Your current color depth is different to &quot;
+                        &quot;the color depth of your x2go-session. &quot;
+                        &quot;This may cause problems reconnecting to &quot;
+                        &quot;this session and in most cases &lt;b&gt;you &quot;
+                        &quot;will loose the session&lt;/b&gt; and have to &quot;
+                        &quot;start a new one! It's highly recommended &quot;
+                        &quot;to change the color depth of your &quot;
+                        &quot;Display to &quot; ) +depth+
+                    tr (
+                        &quot; bit and restart your X-server before you &quot;
+                        &quot;reconnect to this x2go-session.&lt;br&gt;Resume &quot;
+                        &quot;this session anyway?&quot; ),tr ( &quot;Yes&quot; ),
+                    tr ( &quot;No&quot; ) );
+        }
+        if ( res==0 )
+            resumeSession ( s );
+    }
+
+}
+
+
+void ONMainWindow::slotSuspendSess()
+{
+
+    QString passwd;
+    QString user=getCurrentUname();
+
+    passwd=getCurrentPass();
+
+    selectSessionDlg-&gt;setEnabled ( false );
+
+
+    QString sessId=sessTv-&gt;model()-&gt;index (
+                       sessTv-&gt;currentIndex().row(),
+                       S_ID ).data().toString();
+    QString host=sessTv-&gt;model()-&gt;index (
+                     sessTv-&gt;currentIndex().row(),
+                     S_SERVER ).data().toString();
+    if ( !useLdap )
+    {
+        if ( !embedMode )
+        {
+            X2goSettings st ( &quot;sessions&quot; );
+            QString sid=lastSession-&gt;id();
+            host=st.setting()-&gt;value ( sid+&quot;/host&quot;,
+                                       ( QVariant ) host ).toString();
+        }
+        else
+        {
+            host=config.server;
+        }
+    }
+    else
+    {
+        sshConnection=findServerSshConnection(host);
+        if (!sshConnection)
+        {
+            QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),
+                                    tr ( &quot;Server not availabel&quot; ),
+                                    QMessageBox::Ok,
+                                    QMessageBox::NoButton );
+            return;
+        }
+    }
+
+
+    suspendSession ( sessId );
+}
+
+
+void ONMainWindow::slotSuspendSessFromSt()
+{
+    QString passwd;
+    QString user=getCurrentUname();
+    passwd=getCurrentPass();
+    setStatStatus ( tr ( &quot;suspending&quot; ) );
+
+
+    sbExp-&gt;setEnabled ( false );
+
+    if ( !shadowSession )
+        suspendSession ( resumingSession.sessionId );
+    else
+        termSession ( resumingSession.sessionId,false );
+}
+
+void ONMainWindow::slotTermSessFromSt()
+{
+
+    /*	x2goDebug &lt;&lt;&quot;disconnect export&quot;&lt;&lt;endl;
+    	disconnect ( sbExp,SIGNAL ( clicked() ),this,
+    	             SLOT ( slot_exportDirectory() ) );*/
+    sbExp-&gt;setEnabled ( false );
+
+    if ( !shadowSession )
+    {
+        if ( termSession ( resumingSession.sessionId ) )
+            setStatStatus ( tr ( &quot;terminating&quot; ) );
+    }
+    else
+        termSession ( resumingSession.sessionId,false );
+}
+
+
+void ONMainWindow::slotRetSuspSess ( bool result, QString output,
+                                     SshProcess* proc )
+{
+    if ( proc )
+        delete proc;
+    if ( result==false )
+    {
+        QString message=tr ( &quot;&lt;b&gt;Connection failed&lt;/b&gt;\n&quot; ) +output;
+        if ( message.indexOf ( &quot;publickey,password&quot; ) !=-1 )
+        {
+            message=tr (
+                        &quot;&lt;b&gt;Wrong password!&lt;/b&gt;&lt;br&gt;&lt;br&gt;&quot; ) +message;
+        }
+
+        QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),message,
+                                QMessageBox::Ok,
+                                QMessageBox::NoButton );
+    }
+    else
+    {
+        if ( selectSessionDlg-&gt;isVisible() )
+        {
+            ( ( QStandardItemModel* )
+              ( sessTv-&gt;model() ) )-&gt;item (
+                  sessTv-&gt;currentIndex().row(),
+                  S_STATUS )-&gt;setData (
+                      QVariant ( ( QString ) tr ( &quot;suspended&quot; ) ),
+                      Qt::DisplayRole );
+            bSusp-&gt;setEnabled ( false );
+            sOk-&gt;setEnabled ( true );
+
+        }
+    }
+    if ( selectSessionDlg-&gt;isVisible() )
+        selectSessionDlg-&gt;setEnabled ( true );
+}
+
+
+
+void ONMainWindow::slotTermSess()
+{
+
+    selectSessionDlg-&gt;setEnabled ( false );
+
+
+    QString sessId=sessTv-&gt;model()-&gt;index ( sessTv-&gt;currentIndex().row(),
+                                            S_ID ).data().toString();
+
+    if ( !useLdap )
+    {
+        if ( !embedMode )
+        {
+            X2goSettings st ( &quot;sessions&quot; );
+
+            QString sid=lastSession-&gt;id();
+        }
+    }
+    else
+    {
+        QString host=sessTv-&gt;model()-&gt;index ( sessTv-&gt;currentIndex().row(),
+                                              S_SERVER ).data().toString();
+
+        sshConnection=findServerSshConnection(host);
+        if (!sshConnection)
+        {
+            QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),
+                                    tr ( &quot;Server not availabel&quot; ),
+                                    QMessageBox::Ok,
+                                    QMessageBox::NoButton );
+            return;
+        }
+    }
+
+    termSession ( sessId );
+}
+
+
+void ONMainWindow::slotNewSess()
+{
+    startNewSession();
+}
+
+
+void ONMainWindow::slotRetTermSess ( bool result,  QString output,
+                                     SshProcess* proc )
+{
+    bool nodel= ( proc==0 );
+    if ( proc )
+        delete proc;
+    if ( result==false )
+    {
+        QString message=tr ( &quot;&lt;b&gt;Connection failed&lt;/b&gt;\n&quot; ) +output;
+        if ( message.indexOf ( &quot;publickey,password&quot; ) !=-1 )
+        {
+            message=tr (
+                        &quot;&lt;b&gt;Wrong password!&lt;/b&gt;&lt;br&gt;&lt;br&gt;&quot; ) +message;
+        }
+
+        QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),
+                                message,QMessageBox::Ok,
+                                QMessageBox::NoButton );
+    }
+    else
+    {
+        if ( selectSessionDlg-&gt;isVisible() &amp;&amp;!nodel )
+        {
+            sessTv-&gt;model()-&gt;removeRow (
+                sessTv-&gt;currentIndex().row() );
+            slotActivated ( sessTv-&gt;currentIndex() );
+        }
+    }
+    if ( selectSessionDlg-&gt;isVisible() )
+        selectSessionDlg-&gt;setEnabled ( true );
+}
+
+void ONMainWindow::slotRetResumeSess ( bool result,
+                                       QString output,
+                                       SshProcess* proc )
+{
+    if ( proc )
+        delete proc;
+    x2goDebug&lt;&lt;&quot;Agent output:&quot;&lt;&lt;output;
+    if ( result==false )
+    {
+        QString message=tr ( &quot;&lt;b&gt;Connection failed&lt;/b&gt;\n&quot; ) +output;
+        if ( message.indexOf ( &quot;publickey,password&quot; ) !=-1 )
+        {
+            message=tr (
+                        &quot;&lt;b&gt;Wrong Password!&lt;/b&gt;&lt;br&gt;&lt;br&gt;&quot; ) +message;
+        }
+        if ( output.indexOf ( &quot;LIMIT&quot; ) !=-1 )
+        {
+            QString sessions=output.mid (
+                                 output.indexOf ( &quot;LIMIT&quot; ) +6 );
+
+            message=&quot;Sessions limit reached:&quot;+sessions;
+        }
+        if ( output.indexOf ( &quot;ACCESS DENIED&quot; ) !=-1 )
+        {
+            message=&quot;Access denied from user&quot;;
+        }
+
+        QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),
+                                message,QMessageBox::Ok,
+                                QMessageBox::NoButton );
+        slotShowPassForm();
+        return;
+    }
+
+    output.replace ( &quot; &quot;,&quot;&quot; );
+    QString passwd=getCurrentPass();
+    QString user=getCurrentUname();
+    QString host;
+
+    bool sound=true;
+    int sndSystem=PULSE;
+    QString sndPort;
+#ifndef Q_OS_WIN
+    sndPort=&quot;4713&quot;;
+#endif
+    bool startSoundServer=true;
+    bool sshSndTunnel=true;
+
+    if ( useLdap )
+    {
+        sound=startSound;
+        startSoundServer=LDAPSndStartServer;
+        if ( LDAPSndSys==&quot;arts&quot; )
+            sndSystem=ARTS;
+        if ( LDAPSndSys==&quot;esd&quot; )
+            sndSystem=ESD;
+        sndPort=LDAPSndPort;
+    }
+    else
+    {
+        QString sid;
+        if ( !embedMode )
+            sid=lastSession-&gt;id();
+        else
+            sid=&quot;embedded&quot;;
+        X2goSettings st ( &quot;sessions&quot; );
+
+        sound=st.setting()-&gt;value ( sid+&quot;/sound&quot;,
+                                    ( QVariant ) true ).toBool();
+        QString sndsys=st.setting()-&gt;value (
+                           sid+&quot;/soundsystem&quot;,
+                           ( QVariant ) &quot;pulse&quot; ).toString();
+        if ( sndsys==&quot;arts&quot; )
+            sndSystem=ARTS;
+        if ( sndsys==&quot;esd&quot; )
+            sndSystem=ESD;
+#ifndef Q_OS_WIN
+        sndPort=st.setting()-&gt;value ( sid+&quot;/sndport&quot; ).toString();
+#endif
+        startSoundServer=st.setting()-&gt;value (
+                             sid+&quot;/startsoundsystem&quot;,
+                             true ).toBool();
+
+        if ( embedMode&amp;&amp;config.confSnd )
+        {
+            sound=config.useSnd;
+        }
+
+
+#ifndef Q_OS_WIN
+        bool defPort=st.setting()-&gt;value ( sid+
+                                           &quot;/defsndport&quot;,true ).toBool();
+        if ( defPort )
+        {
+            switch ( sndSystem )
+            {
+            case PULSE:
+                sndPort=&quot;4713&quot;;
+                break;
+            case ESD:
+                sndPort=&quot;16001&quot;;
+                break;
+            }
+        }
+#endif
+        sshSndTunnel=st.setting()-&gt;value ( sid+&quot;/soundtunnel&quot;,
+                                           true ).toBool();
+
+#ifdef Q_OS_WIN
+        switch ( sndSystem )
+        {
+        case PULSE:
+            sndPort=QString::number ( pulsePort );
+            break;
+        case ESD:
+            sndPort=QString::number ( esdPort );
+            break;
+        }
+#endif
+    }
+
+    //Will be used in runCommand
+    startSessSound=sound;
+    startSessSndSystem=sndSystem;
+
+    if ( newSession )
+    {
+        QString sString=output.trimmed();
+        sString.replace ( '\n','|' );
+        host=resumingSession.server;
+        resumingSession=getNewSessionFromString ( sString );
+        resumingSession.server=host;
+        resumingSession.crTime=QDateTime::currentDateTime().toString (
+                                   &quot;dd.MM.yy HH:mm:ss&quot; );
+        if ( managedMode )
+        {
+            //replace session data for future resuming
+            config.sessiondata=resumingSession.agentPid+&quot;|&quot;+
+                               resumingSession.sessionId+&quot;|&quot;+
+                               resumingSession.display+&quot;|&quot;+
+                               resumingSession.server+&quot;|&quot;+
+                               &quot;S|&quot;+
+                               resumingSession.crTime+&quot;|&quot;+
+                               resumingSession.cookie+&quot;|&quot;+
+                               resumingSession.clientIp+&quot;|&quot;+
+                               resumingSession.grPort+&quot;|&quot;+
+                               resumingSession.sndPort+&quot;|&quot;+
+                               resumingSession.crTime+&quot;|&quot;+
+                               user+&quot;|&quot;+
+                               &quot;0|&quot;+
+                               resumingSession.fsPort;
+        }
+    }
+    else
+    {
+        host=resumingSession.server;
+        QStringList outputLines=output.split(&quot;\n&quot;,QString::SkipEmptyParts);
+        foreach(QString line,outputLines)
+        {
+            if (line.indexOf(&quot;gr_port=&quot;)!=-1)
+            {
+                resumingSession.grPort=line.replace(&quot;gr_port=&quot;,&quot;&quot;);
+                x2goDebug&lt;&lt;&quot;new gr_port: &quot;&lt;&lt;resumingSession.grPort&lt;&lt;endl;
+            }
+            if (line.indexOf(&quot;sound_port=&quot;)!=-1)
+            {
+                resumingSession.sndPort=line.replace(&quot;sound_port=&quot;,&quot;&quot;);
+                x2goDebug&lt;&lt;&quot;new sound_port: &quot;&lt;&lt;resumingSession.sndPort&lt;&lt;endl;
+            }
+            if (line.indexOf(&quot;fs_port=&quot;)!=-1)
+            {
+                resumingSession.fsPort=line.replace(&quot;fs_port=&quot;,&quot;&quot;);
+                x2goDebug&lt;&lt;&quot;new fs_port: &quot;&lt;&lt;resumingSession.fsPort&lt;&lt;endl;
+            }
+        }
+        if (resumingSession.published)
+            readApplications();
+    }
+    if ( !useLdap )
+    {
+        if ( !embedMode )
+        {
+            X2goSettings st ( &quot;sessions&quot; );
+
+            QString sid=lastSession-&gt;id();
+            host=st.setting()-&gt;value ( sid+&quot;/host&quot;,
+                                       ( QVariant ) host ).toString();
+        }
+        else
+            host=config.server;
+        resumingSession.server=host;
+    }
+    tunnel=new SshProcess ( sshConnection, this );
+
+    connect ( tunnel,SIGNAL ( sshFinished ( bool,  QString,SshProcess* ) ),
+              this,SLOT ( slotTunnelFailed ( bool,
+                                             QString,SshProcess* ) ) );
+    connect ( tunnel,SIGNAL ( sshTunnelOk() ),
+              this,SLOT ( slotTunnelOk() ) );
+
+    localGraphicPort=resumingSession.grPort;
+    int iport=localGraphicPort.toInt() +1000;
+    while ( iport == resumingSession.sndPort.toInt() ||
+            iport == resumingSession.fsPort.toInt() ||
+            isServerRunning ( iport ) )
+        ++iport;
+    localGraphicPort=QString::number ( iport );
+
+    tunnel-&gt;startTunnel ( &quot;localhost&quot;,resumingSession.grPort.toInt(),&quot;localhost&quot;,
+                          localGraphicPort.toInt() );
+    if ( shadowSession )
+        return;
+
+    sndTunnel=0l;
+    if ( sound )
+    {
+        if ( sndSystem==PULSE )
+        {
+            startSoundServer=false;
+            QString scmd;
+            if ( !sshSndTunnel )
+                scmd=&quot;echo \&quot;default-server=`echo &quot;
+                     &quot;$SSH_CLIENT | awk '{print $1}'`:&quot;+
+                     sndPort+
+                     &quot;\&quot;&gt; ~/.x2go/C-&quot;+
+                     resumingSession.sessionId+
+                     &quot;/.pulse-client.conf&quot;
+                     &quot;;echo \&quot;cookie-file=.x2go/C-&quot;+
+                     resumingSession.sessionId+
+                     &quot;/.pulse-cookie&quot;+
+                     &quot;\&quot;&gt;&gt; ~/.x2go/C-&quot;+
+                     resumingSession.sessionId+
+                     &quot;/.pulse-client.conf&quot;;
+            else
+                scmd=&quot;echo \&quot;default-server=localhost:&quot;+
+                     resumingSession.sndPort+
+                     &quot;\&quot;&gt; ~/.x2go/C-&quot;+
+                     resumingSession.sessionId+
+                     &quot;/.pulse-client.conf&quot;
+                     &quot;;echo \&quot;cookie-file=.x2go/C-&quot;+
+                     resumingSession.sessionId+
+                     &quot;/.pulse-cookie&quot;+
+                     &quot;\&quot;&gt;&gt; ~/.x2go/C-&quot;+
+                     resumingSession.sessionId+
+                     &quot;/.pulse-client.conf&quot;;
+            SshProcess* paProc;
+            paProc=new SshProcess ( sshConnection, this );
+            paProc-&gt;startNormal ( scmd );
+
+            bool sysPulse=false;
+#ifdef Q_OS_LINUX
+            loadPulseModuleNativeProtocol();
+            QFile file ( &quot;/etc/default/pulseaudio&quot; );
+            if ( file.open ( QIODevice::ReadOnly |
+                             QIODevice::Text ) )
+            {
+
+                while ( !file.atEnd() )
+                {
+                    QByteArray line = file.readLine();
+                    int pos=line.indexOf (
+                                &quot;PULSEAUDIO_SYSTEM_START=1&quot;
+                            );
+                    if ( pos!=-1 )
+                    {
+                        int commentPos=line.indexOf (
+                                           &quot;#&quot; );
+                        if ( commentPos==-1 ||
+                                commentPos&gt;pos )
+                        {
+                            sysPulse=true;
+                            break;
+                        }
+                    }
+                }
+                file.close();
+            }
+#endif
+            if ( sysPulse )
+                paProc-&gt;start_cp (
+                    &quot;/var/run/pulse/.pulse-cookie&quot;,
+                    &quot;~/.x2go/C-&quot;+
+                    resumingSession.sessionId+
+                    &quot;/.pulse-cookie&quot; );
+            else
+            {
+#ifndef Q_OS_WIN
+                paProc-&gt;start_cp ( homeDir+&quot;/.pulse-cookie&quot;,
+                                   &quot;~/.x2go/C-&quot;+
+                                   resumingSession.sessionId+
+                                   &quot;/.pulse-cookie&quot; );
+#else
+                QString cooFile=
+                    wapiShortFileName ( homeDir )  +
+                    &quot;/.x2go/pulse/.pulse-cookie&quot;;
+                QString destFile=&quot;~/.x2go/C-&quot;+
+                                 resumingSession.sessionId+
+                                 &quot;/.pulse-cookie&quot;;
+                paProc-&gt;start_cp ( cooFile,
+                                   destFile );
+
+                /*x2goDebug&lt;&lt;&quot;cookie file: &quot;&lt;&lt;cooFile
+                &lt;&lt;&quot; remote:&quot;&lt;&lt;
+                destFile&lt;&lt;endl;*/
+                connect ( paProc,
+                          SIGNAL (
+                              sshFinished ( bool,
+                                            QString,
+                                            SshProcess* ) ),
+                          this,
+                          SLOT (
+                              slotPCookieReady ( bool,
+                                                 QString,
+                                                 SshProcess* )
+                          ) );
+                parecTunnelOk=true;
+#endif
+            }
+        }
+        if ( sndSystem==ESD )
+        {
+            SshProcess* paProc;
+            paProc=new SshProcess ( sshConnection, this );
+#ifndef Q_OS_WIN
+            paProc-&gt;start_cp ( homeDir+&quot;/.esd_auth&quot;,
+                               &quot;~/.esd_auth&quot; );
+#else
+            QString cooFile=
+                wapiShortFileName ( homeDir )  +
+                &quot;/.x2go/pulse/.esd_auth&quot;;
+            QString destFile=&quot;~/.esd_auth&quot;;
+            paProc-&gt;start_cp ( cooFile,
+                               destFile );
+#endif
+        }
+#ifndef Q_OS_WIN
+        if ( startSoundServer )
+        {
+            soundServer=new QProcess ( this );
+            QString acmd=&quot;artsd&quot;,ecmd=&quot;esd&quot;;
+#ifdef Q_OS_DARWIN
+            QStringList env = soundServer-&gt;environment();
+            QDir dir ( appDir );
+            dir.cdUp();
+            dir.cd ( &quot;esd&quot; );
+            env.insert ( 0,&quot;DYLD_LIBRARY_PATH=&quot;+
+                         dir.absolutePath() );
+            soundServer-&gt;setEnvironment ( env );
+            ecmd=&quot;\&quot;&quot;+dir.absolutePath() +&quot;\&quot;/esd&quot;;
+#endif //Q_OS_DARWIN
+            if ( sndSystem==ESD )
+                soundServer-&gt;start (
+                    ecmd+
+                    &quot; -tcp -nobeeps -bind localhost -port &quot;+
+                    resumingSession.sndPort );
+            if ( sndSystem==ARTS )
+                soundServer-&gt;start ( acmd+&quot; -u -N -p &quot;+
+                                     resumingSession.sndPort );
+            sndPort=resumingSession.sndPort;
+        }
+#endif //Q_OS_WIN
+        if ( sshSndTunnel )
+        {
+            sndTunnel=new SshProcess ( sshConnection, this );
+
+#ifdef Q_OS_WIN
+            if ( sndSystem==PULSE )
+            {
+                parecTunnelOk=false;
+                connect ( sndTunnel,SIGNAL ( sshTunnelOk() ),
+                          this,SLOT ( slotSndTunOk() ) );
+            }
+#endif
+            connect ( sndTunnel,SIGNAL ( sshFinished ( bool,
+                                         QString,
+                                         SshProcess* ) ),
+                      this,SLOT (
+                          slotSndTunnelFailed ( bool,
+                                                QString,
+                                                SshProcess* ) ) );
+
+            sndTunnel-&gt;startTunnel (
+                &quot;localhost&quot;,
+                resumingSession.sndPort.toInt(),&quot;127.0.0.1&quot;,
+                sndPort.toInt(),true );
+            /*x2goDebug&lt;&lt;&quot;starting tunnel, local port:&quot;&lt;&lt;
+            	sndPort&lt;&lt;&quot;, remote: &quot;&lt;&lt;
+            	resumingSession.sndPort&lt;&lt;
+            	endl;*/
+        }
+    }
+}
+
+
+
+x2goSession ONMainWindow::getSelectedSession()
+{
+    QString sessId=sessTv-&gt;model()-&gt;index ( sessTv-&gt;currentIndex().row(),
+                                            S_ID ).data().toString();
+    for ( int i=0;i&lt;selectedSessions.size();++i )
+    {
+        if ( selectedSessions[i].sessionId==sessId )
+            return selectedSessions[i];
+    }
+    return selectedSessions[0]; //warning !!!!! undefined session
+}
+
+
+void ONMainWindow::slotTunnelOk()
+{
+
+#ifdef Q_OS_WIN
+    //waiting for X
+    if ( !winServersReady )
+    {
+        x2goDebug&lt;&lt;&quot;waiting for win-servers&quot;;
+        QTimer::singleShot ( 100, this, SLOT ( slotTunnelOk() ) );
+        return;
+    }
+#endif
+
+    showExport=false;
+    QString nxroot=homeDir +&quot;/.x2go&quot;;
+    QString dirpath=nxroot+&quot;/S-&quot;+resumingSession.sessionId;
+    QDir d ( dirpath );
+    if ( !d.exists() )
+        if ( !d.mkpath ( dirpath ) )
+        {
+            QString message=tr ( &quot;Unable to create folder:&quot; ) +
+                            dirpath;
+            QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),message,
+                                    QMessageBox::Ok,
+                                    QMessageBox::NoButton );
+            slotShowPassForm();
+            if ( tunnel )
+                delete tunnel;
+            if ( sndTunnel )
+                delete sndTunnel;
+            if ( fsTunnel )
+                delete fsTunnel;
+            if ( soundServer )
+                delete soundServer;
+            tunnel=sndTunnel=fsTunnel=0l;
+            soundServer=0l;
+            nxproxy=0l;
+            return;
+        }
+#ifdef Q_OS_WIN
+    dirpath=wapiShortFileName ( dirpath );
+    nxroot=wapiShortFileName ( nxroot );
+#endif
+    QFile file ( dirpath+&quot;/options&quot; );
+    if ( !file.open ( QIODevice::WriteOnly | QIODevice::Text ) )
+    {
+        QString message=tr ( &quot;Unable to write file:&quot; ) +
+                        dirpath+&quot;/options&quot;;
+        QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),message,
+                                QMessageBox::Ok,
+                                QMessageBox::NoButton );
+        slotShowPassForm();
+        return;
+    }
+
+    QTextStream out ( &amp;file );
+#ifdef Q_OS_WIN
+    dirpath=cygwinPath ( dirpath );
+    nxroot=cygwinPath ( nxroot );
+#endif
+    out &lt;&lt; &quot;nx/nx,root=&quot;&lt;&lt;nxroot&lt;&lt;&quot;,connect=localhost,cookie=&quot;&lt;&lt;
+    resumingSession.cookie&lt;&lt;&quot;,port=&quot;
+    &lt;&lt;localGraphicPort/*resumingSession.grPort*/&lt;&lt;
+    &quot;,errors=&quot;&lt;&lt;dirpath&lt;&lt;&quot;/sessions:&quot;&lt;&lt;
+    resumingSession.display;
+    file.close();
+    xmodExecuted=false;
+
+
+    nxproxy=new QProcess;
+    QStringList env = QProcess::systemEnvironment();
+    QString x2golibpath=&quot;/usr/lib/x2go&quot;;
+#if defined ( Q_OS_WIN ) || defined ( Q_OS_DARWIN )
+    int dispInd=-1;
+#endif
+    for ( int l=0;l&lt;env.size();++l )
+    {
+// 		x2goDebug&lt;&lt;env[l]&lt;&lt;endl;
+        if ( env[l].indexOf ( &quot;X2GO_LIB&quot; ) ==0 )
+        {
+            x2golibpath=env[l].split ( &quot;=&quot; ) [1];
+        }
+#if defined ( Q_OS_WIN ) || defined ( Q_OS_DARWIN )
+        if ( env[l].indexOf ( &quot;DISPLAY&quot; ) ==0 )
+        {
+            dispInd=l;
+        }
+#endif
+    }
+    env &lt;&lt; &quot;LD_LIBRARY_PATH=&quot;+x2golibpath;
+    env &lt;&lt; &quot;NX_CLIENT=&quot;+QCoreApplication::applicationFilePath ();
+
+#if defined ( Q_OS_WIN ) || defined ( Q_OS_DARWIN )
+    // On Mac OS X, we want to make sure that DISPLAY is set to a proper value,
+    // but at the same time don't want to set the value ourselves but keep
+    // the provided one.
+    QString disp=getXDisplay();
+    if ( disp==QString::null )
+    {
+        //slotProxyerror ( QProcess::FailedToStart );
+        return;
+    }
+#endif // Q_OS_WIN || Q_OS_DARWIN
+#if defined ( Q_OS_WIN )
+    if ( dispInd==-1 )
+    {
+        env &lt;&lt;&quot;DISPLAY=localhost:&quot;+disp;
+        /*		x2goDebug&lt;&lt;&quot;new env DISPLAY&quot;&lt;&lt;&quot;DISPLAY=localhost:&quot;+disp&lt;&lt;endl;*/
+    }
+    else
+    {
+        env[dispInd]=&quot;DISPLAY=localhost:&quot;+disp;
+        /*		x2goDebug&lt;&lt;&quot;existing env DISPLAY(&quot;&lt;&lt;dispInd&lt;&lt;
+        		&quot;) DISPLAY=localhost:&quot;+disp&lt;&lt;endl;*/
+    }
+#endif // Q_OS_WIN
+#if defined ( Q_OS_DARWIN )
+    // setting /usr/X11/bin to find xauth
+    // /usr/X11R6/bin is added for compatibility reasons with OS X 10.4.
+    env.insert (
+        0,
+        &quot;PATH=/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/usr/X11/bin:/usr/X11R6/bin&quot; );
+    // Set the NX base dir to bundle/exe/, used for finding nxauth.
+    {
+        QDir tmpDir (appDir);
+        tmpDir.cd (&quot;../exe&quot;);
+        env.append (&quot;NX_SYSTEM=&quot; + tmpDir.absolutePath ());
+    }
+    if (dispInd == -1)
+    {
+        x2goDebug &lt;&lt; &quot;No DISPLAY variable found in global environment, using autodetected setting.&quot;;
+        env.append (&quot;DISPLAY=&quot; + disp);
+    }
+#endif
+    nxproxy-&gt;setEnvironment ( env );
+    /*	x2goDebug&lt;&lt;&quot;new env:&quot;&lt;&lt;endl;
+    	for ( int l=0;l&lt;env.size();++l )
+    	{
+    		x2goDebug&lt;&lt;env[l]&lt;&lt;endl;
+    	}
+    	x2goDebug&lt;&lt;&quot;##########################&quot;&lt;&lt;endl;*/
+    connect ( nxproxy,SIGNAL ( error ( QProcess::ProcessError ) ),this,
+              SLOT ( slotProxyError ( QProcess::ProcessError ) ) );
+    connect ( nxproxy,SIGNAL ( finished ( int,QProcess::ExitStatus ) ),this,
+              SLOT ( slotProxyFinished ( int,QProcess::ExitStatus ) ) );
+    connect ( nxproxy,SIGNAL ( readyReadStandardError() ),this,
+              SLOT ( slotProxyStderr() ) );
+    connect ( nxproxy,SIGNAL ( readyReadStandardOutput() ),this,
+              SLOT ( slotProxyStdout() ) );
+
+    QString proxyCmd=&quot;nxproxy -S nx/nx,options=&quot;+dirpath+&quot;/options:&quot;+
+                     resumingSession.display;
+#ifdef Q_OS_DARWIN
+    //run nxproxy from bundle
+    QDir dir ( appDir );
+    dir.cdUp();
+    dir.cd ( &quot;exe&quot; );
+    proxyCmd=&quot;\&quot;&quot;+dir.absolutePath() +&quot;/\&quot;&quot;+proxyCmd;
+#endif //Q_OS_DARWIN
+    x2goDebug&lt;&lt;&quot;starting nxproxy with: &quot;&lt;&lt;proxyCmd&lt;&lt;endl;
+    nxproxy-&gt;start ( proxyCmd );
+//always search for proxyWin
+    proxyWinTimer-&gt;start ( 300 );
+    if ( embedMode )
+    {
+//         proxyWinTimer-&gt;start ( 300 );
+        if ( !startEmbedded )
+        {
+            act_embedContol-&gt;setText (
+                tr ( &quot;Attach X2Go window&quot; ) );
+        }
+    }
+#ifdef Q_OS_WIN
+    else
+    {
+// #ifdef CFGCLIENT
+//         // if using XMing, we must find proxy win for case, that we should make it fullscreen
+        //         if(useInternalX&amp;&amp; (internalX==XMING))
+// #endif
+//         proxyWinTimer-&gt;start ( 300 );
+    }
+#endif
+
+    showSessionStatus();
+    QTimer::singleShot ( 30000,this,SLOT ( slotRestartProxy() ) );
+
+}
+
+void ONMainWindow::slotTunnelFailed ( bool result,  QString output,
+                                      SshProcess* )
+{
+    if ( result==false )
+    {
+        if ( !managedMode )
+        {
+            QString message=tr ( &quot;Unable to create SSL tunnel:\n&quot; )
+                            +output;
+            QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),message,
+                                    QMessageBox::Ok,
+                                    QMessageBox::NoButton );
+        }
+        if ( tunnel )
+            delete tunnel;
+        if ( sndTunnel )
+            delete sndTunnel;
+        if ( fsTunnel )
+            delete fsTunnel;
+        if ( soundServer )
+            delete soundServer;
+        tunnel=sndTunnel=fsTunnel=0l;
+        soundServer=0l;
+        nxproxy=0l;
+        if ( !managedMode )
+            slotShowPassForm();
+    }
+}
+
+void ONMainWindow::slotSndTunnelFailed ( bool result,  QString output,
+        SshProcess* )
+{
+    if ( result==false )
+    {
+        if ( !managedMode )
+        {
+            QString message=tr ( &quot;Unable to create SSL Tunnel:\n&quot; )
+                            +output;
+            QMessageBox::warning ( 0l,tr ( &quot;Warning&quot; ),message,
+                                   QMessageBox::Ok,
+                                   QMessageBox::NoButton );
+        }
+        if ( sndTunnel )
+            delete sndTunnel;
+        sndTunnel=0l;
+    }
+}
+
+
+
+void ONMainWindow::slotProxyError ( QProcess::ProcessError )
+{
+    slotProxyFinished ( -1,QProcess::CrashExit );
+}
+
+
+void ONMainWindow::slotProxyFinished ( int,QProcess::ExitStatus )
+{
+    if ( embedMode )
+    {
+        if ( proxyWinEmbedded )
+        {
+#ifdef CFGPLUGIN
+            detachClient();
+#endif
+        }
+        proxyWinTimer-&gt;stop();
+        setEmbedSessionActionsEnabled ( false );
+    }
+#ifdef Q_OS_WIN
+    else
+        proxyWinTimer-&gt;stop();
+// #ifdef CFGCLIENT
+    if (! startXorgOnStart)
+    {
+        if (xorg)
+        {
+            if (xorg-&gt;state() ==QProcess::Running)
+            {
+                xorg-&gt;terminate();
+                delete xorg;
+                xorg=0;
+            }
+        }
+    }
+// #endif
+#endif
+    if ( closeEventSent )
+        return;
+    if ( tunnel )
+        delete tunnel;
+    if ( sndTunnel )
+        delete sndTunnel;
+    if ( fsTunnel )
+        delete fsTunnel;
+    if ( soundServer )
+        delete soundServer;
+    if ( spoolTimer )
+        delete spoolTimer;
+
+    x2goDebug&lt;&lt;&quot;deleting proxy&quot;&lt;&lt;endl;
+    disconnect ( nxproxy,SIGNAL ( error ( QProcess::ProcessError ) ),this,
+                 SLOT ( slotProxyError ( QProcess::ProcessError ) ) );
+    disconnect ( nxproxy,SIGNAL ( finished ( int,QProcess::ExitStatus ) ),this,
+                 SLOT ( slotProxyFinished ( int,QProcess::ExitStatus ) ) );
+    disconnect ( nxproxy,SIGNAL ( readyReadStandardError() ),this,
+                 SLOT ( slotProxyStderr() ) );
+    disconnect ( nxproxy,SIGNAL ( readyReadStandardOutput() ),this,
+                 SLOT ( slotProxyStdout() ) );
+#ifndef CFGPLUGIN
+    if (trayEnabled)
+    {
+        trayIconActiveConnectionMenu-&gt;setTitle(tr(&quot;Not connected&quot;));
+        trayIconActiveConnectionMenu-&gt;setEnabled(false);
+        if (trayMaxDiscon)
+            showNormal();
+    }
+    trayAutoHidden=false;
+#endif
+
+
+#if ! (defined(Q_OS_WIN) &amp;&amp; defined (CFGPLUGIN))
+    if ( nxproxy )
+    {
+        if ( nxproxy-&gt;state() ==QProcess::Running )
+        {
+            x2goDebug&lt;&lt;&quot;waiting for proxy to exit&quot;&lt;&lt;endl;
+            if ( !nxproxy-&gt;waitForFinished ( 3000 ) )
+            {
+                x2goDebug&lt;&lt;&quot;Failed, try to kill&quot;&lt;&lt;endl;
+                nxproxy-&gt;kill();
+            }
+        }
+        x2goDebug&lt;&lt;&quot;nxproxy not running&quot;&lt;&lt;endl;
+        delete nxproxy;
+    }
+#endif
+    x2goDebug&lt;&lt;&quot;proxy deleted&quot;&lt;&lt;endl;
+    spoolTimer=0l;
+    tunnel=sndTunnel=fsTunnel=0l;
+    soundServer=0l;
+    nxproxy=0l;
+    proxyWinId=0;
+
+    if ( !shadowSession &amp;&amp; !usePGPCard &amp;&amp; ! ( embedMode &amp;&amp;
+            ( config.checkexitstatus==false ) ) )
+        check_cmd_status();
+    else
+        sshConnection-&gt;disconnectSession();
+    if ( startHidden )
+        close();
+
+    if ( readExportsFrom!=QString::null )
+    {
+        exportTimer-&gt;stop();
+        if ( extLogin )
+        {
+            currentKey=QString::null;
+        }
+    }
+    if ( printSupport )
+        cleanPrintSpool();
+    if ( !restartResume )
+    {
+        if ( !embedMode )
+        {
+            if (!brokerMode)
+            {
+                pass-&gt;setText ( &quot;&quot; );
+                QTimer::singleShot ( 2000,this,
+                                     SLOT ( slotShowPassForm() ) );
+            }
+            else
+                QTimer::singleShot ( 2000,broker,
+                                     SLOT ( getUserSessions() ) );
+
+        }
+    }
+    else
+    {
+        restartResume=false;
+        sessionStatusDlg-&gt;hide();
+        resumeSession ( resumingSession );
+    }
+    setStatStatus ( tr ( &quot;Finished&quot; ) );
+}
+
+
+void ONMainWindow::slotProxyStderr()
+{
+    QString reserr;
+    if ( nxproxy )
+        reserr= nxproxy-&gt;readAllStandardError();
+    x2goDebug&lt;&lt;reserr&lt;&lt;endl;
+    stInfo-&gt;insertPlainText ( reserr );
+    stInfo-&gt;ensureCursorVisible();
+    if ( stInfo-&gt;toPlainText().indexOf (
+                &quot;Connecting to remote host 'localhost:&quot;+
+                /*resumingSession.grPort*/ localGraphicPort ) !=-1 )
+        setStatStatus ( tr ( &quot;connecting&quot; ) );
+
+    if ( stInfo-&gt;toPlainText().indexOf (
+                &quot;Connection to remote proxy 'localhost:&quot;+
+                /*resumingSession.grPort*/
+                localGraphicPort+&quot;' established&quot; ) !=-1 )
+    {
+        if ( newSession )
+        {
+            setStatStatus ( tr ( &quot;starting&quot; ) );
+        }
+        else
+        {
+            setStatStatus ( tr ( &quot;resuming&quot; ) );
+        }
+    }
+
+    if ( stInfo-&gt;toPlainText().indexOf (
+                &quot;Established X server connection&quot; ) !=-1 )
+    {
+        setStatStatus ( tr ( &quot;running&quot; ) );
+#ifndef CFGPLUGIN
+        if (trayEnabled)
+        {
+            if (!useLdap)
+                trayIconActiveConnectionMenu-&gt;setTitle(lastSession-&gt;name());
+            else
+                trayIconActiveConnectionMenu-&gt;setTitle(lastUser-&gt;username());
+            trayIconActiveConnectionMenu-&gt;setEnabled(true);
+            if (trayMinCon &amp;&amp; !trayAutoHidden)
+            {
+                trayAutoHidden=true;
+                hide();
+            }
+        }
+#endif
+        if ( embedMode )
+            setEmbedSessionActionsEnabled ( true );
+        disconnect ( sbSusp,SIGNAL ( clicked() ),this,
+                     SLOT ( slotTestSessionStatus() ) );
+        disconnect ( sbSusp,SIGNAL ( clicked() ),this,
+                     SLOT ( slotSuspendSessFromSt() ) );
+        connect ( sbSusp,SIGNAL ( clicked() ),this,
+                  SLOT ( slotSuspendSessFromSt() ) );
+        if ( !showExport )
+        {
+            showExport=true;
+            /*connect ( sbExp,SIGNAL ( clicked() ),this,
+              SLOT ( slot_exportDirectory() ) );*/
+            sbExp-&gt;setEnabled ( true );
+            exportDefaultDirs();
+            if ( readExportsFrom!=QString::null )
+            {
+                exportTimer-&gt;start ( 2000 );
+            }
+        }
+        sbSusp-&gt;setToolTip ( tr ( &quot;Suspend&quot; ) );
+        if ( newSession )
+        {
+            runCommand();
+            newSession=false;
+        }
+#ifdef 	Q_WS_HILDON
+        else
+        {
+            if ( !xmodExecuted )
+            {
+                xmodExecuted=true;
+                QTimer::singleShot (
+                    2000, this,
+                    SLOT ( slotExecXmodmap() ) );
+            }
+        }
+#endif
+    }
+    if ( stInfo-&gt;toPlainText().indexOf (
+                tr ( &quot;Connection timeout, aborting&quot; ) ) !=-1 )
+        setStatStatus ( tr ( &quot;aborting&quot; ) );
+#if defined( Q_OS_WIN ) &amp;&amp; defined (CFGPLUGIN)
+    if ( reserr.indexOf ( &quot;Session terminated at&quot; ) !=-1 )
+    {
+        x2goDebug&lt;&lt;&quot;proxy finished&quot;&lt;&lt;endl;
+        slotProxyFinished ( 0, QProcess::NormalExit );
+    }
+#endif
+
+
+}
+
+
+void ONMainWindow::slotProxyStdout()
+{
+    QString resout ( nxproxy-&gt;readAllStandardOutput() );
+    x2goDebug&lt;&lt;resout&lt;&lt;endl;
+
+}
+
+
+void ONMainWindow::slotShowPassForm()
+{
+    if ( !useLdap )
+    {
+        loginPrompt-&gt;show();
+        login-&gt;show();
+    }
+    else
+    {
+        loginPrompt-&gt;hide();
+        login-&gt;hide();
+    }
+    setEnabled ( true );
+    if ( !embedMode )
+    {
+        u-&gt;hide();
+        uname-&gt;hide();
+    }
+    sessionStatusDlg-&gt;hide();
+    selectSessionDlg-&gt;hide();
+    setEnabled ( true );
+    if ( isPassShown )
+    {
+        passForm-&gt;show();
+        passForm-&gt;setEnabled ( true );
+    }
+    isPassShown=true;
+    login-&gt;setEnabled ( true );
+    if ( login-&gt;text().length() &gt;0 )
+    {
+        pass-&gt;setFocus();
+        pass-&gt;selectAll();
+    }
+    else
+        login-&gt;setFocus();
+
+
+    if ( !embedMode )
+    {
+        u-&gt;setEnabled ( true );
+    }
+    else
+    {
+        if ( config.user.length() &gt;0 )
+            login-&gt;setEnabled ( false );
+    }
+}
+
+
+void ONMainWindow::showSessionStatus()
+{
+    setStatStatus();
+}
+
+
+void ONMainWindow::slotShowAdvancedStat()
+{
+    if ( !miniMode )
+    {
+        if ( sbAdv-&gt;isChecked() )
+        {
+            sessionStatusDlg-&gt;setFixedSize (
+                sessionStatusDlg-&gt;width(),
+                sessionStatusDlg-&gt;height() *2 );
+        }
+        else
+        {
+            sessionStatusDlg-&gt;setFixedSize (
+                sessionStatusDlg-&gt;sizeHint() );
+            stInfo-&gt;hide();
+        }
+    }
+    else
+    {
+        if ( sbAdv-&gt;isChecked() )
+        {
+            sessionStatusDlg-&gt;setFixedSize ( 310,300 );
+        }
+        else
+        {
+            stInfo-&gt;hide();
+            sessionStatusDlg-&gt;setFixedSize ( 310,200 );
+        }
+    }
+
+
+// 	username-&gt;invalidate();
+
+
+    if ( sbAdv-&gt;isChecked() )
+    {
+        stInfo-&gt;show();
+    }
+
+    X2goSettings st ( &quot;settings&quot; );
+    st.setting()-&gt;setValue ( &quot;showStatus&quot;,
+                             ( QVariant ) sbAdv-&gt;isChecked() );
+    st.setting()-&gt;sync();
+}
+
+
+
+
+void ONMainWindow::slotResumeDoubleClick ( const QModelIndex&amp; )
+{
+    if ( !shadowSession )
+        slotResumeSess();
+}
+
+
+void ONMainWindow::suspendSession ( QString sessId )
+{
+    SshProcess* proc=0l;
+    proc=new SshProcess ( sshConnection, this );
+
+    connect ( proc,SIGNAL ( sshFinished ( bool,  QString,SshProcess* ) ),
+              this,SLOT ( slotRetSuspSess ( bool,  QString,
+                                            SshProcess* ) ) );
+
+    proc-&gt;startNormal ( &quot;x2gosuspend-session &quot;+sessId );
+}
+
+
+bool ONMainWindow::termSession ( QString sessId, bool warn )
+{
+    if ( warn )
+    {
+        bool hide_after=false;
+        if (isHidden())
+        {
+            showNormal();
+            hide_after=true;
+        }
+        int answer=QMessageBox::warning (
+                       this,tr ( &quot;Warning&quot; ),
+                       tr (
+                           &quot;Are you sure you want to terminate &quot;
+                           &quot;this session?\n&quot;
+                           &quot;Unsaved documents will be lost&quot; ),
+                       QMessageBox::Yes,QMessageBox::No );
+        if (hide_after)
+            hide();
+
+        if ( answer !=
+                QMessageBox::Yes )
+        {
+            slotRetTermSess ( true,QString::null,0 );
+            return false;
+        }
+    }
+    if ( shadowSession )
+    {
+        nxproxy-&gt;terminate();
+        return true;
+    }
+
+    SshProcess* proc=0l;
+    proc=new SshProcess ( sshConnection,  this );
+
+    connect ( proc,SIGNAL ( sshFinished ( bool,  QString,SshProcess* ) ),
+              this,SLOT ( slotRetTermSess ( bool,
+                                            QString,SshProcess* ) ) );
+
+    proc-&gt;startNormal ( &quot;x2goterminate-session &quot;+sessId );
+    return true;
+}
+
+
+
+void ONMainWindow::setStatStatus ( QString status )
+{
+    setEnabled ( true );
+    passForm-&gt;hide();
+    selectSessionDlg-&gt;hide();
+    if ( status == QString::null )
+        status=statusString;
+    else
+        statusString=status;
+    QString tstr;
+    if ( statusLabel )
+        statusLabel-&gt;setText ( QString::null );
+    if ( resumingSession.sessionId!=QString::null )
+    {
+        QString f=&quot;dd.MM.yy HH:mm:ss&quot;;
+        QDateTime dt=QDateTime::fromString ( resumingSession.crTime,f );
+        dt=dt.addYears ( 100 );
+        tstr=dt.toString();
+    }
+    if ( !embedMode || !proxyWinEmbedded )
+    {
+        statusBar()-&gt;showMessage ( &quot;&quot;);
+#if ! (defined Q_OS_WIN &amp;&amp; defined CFGPLUGIN)
+        statusBar()-&gt;hide();
+#endif
+        QString srv;
+        if ( embedMode )
+            srv=config.server;
+        else
+            srv=resumingSession.server;
+        slVal-&gt;setText ( resumingSession.sessionId+&quot;\n&quot;+
+                         srv+&quot;\n&quot;+
+                         getCurrentUname() +&quot;\n&quot;+
+                         resumingSession.display+
+                         &quot;\n&quot;+tstr+&quot;\n&quot;+status );
+
+        slVal-&gt;setFixedSize ( slVal-&gt;sizeHint() );
+        sessionStatusDlg-&gt;show();
+        if (resumingSession.published)
+            sbApps-&gt;show();
+        else
+            sbApps-&gt;hide();
+    }
+    else
+    {
+
+        QString srv=config.server;
+        QString message=getCurrentUname() +&quot;@&quot;+
+                        srv+
+                        &quot;, &quot;+tr ( &quot;Session&quot; ) +&quot;: &quot;+
+                        resumingSession.sessionId+&quot;, &quot;+
+                        tr ( &quot;Display&quot; ) +&quot;: &quot;+
+                        resumingSession.display+&quot;, &quot;+
+                        tr ( &quot;Creation time&quot; ) +&quot;: &quot;+tstr;
+#if ! (defined Q_OS_WIN &amp;&amp; defined CFGPLUGIN)
+        if ( statusLabel )
+        {
+            statusLabel-&gt;setText ( &quot;   &quot;+message );
+        }
+        else
+#endif
+        {
+            if ( config.showstatusbar )
+            {
+                statusBar()-&gt;show();
+                statusBar()-&gt;showMessage ( message );
+            }
+        }
+        sessionStatusDlg-&gt;hide();
+    }
+}
+
+
+void ONMainWindow::slotRestartProxy()
+{
+    if ( !sessionStatusDlg-&gt;isVisible() )
+        return;
+    if ( stInfo-&gt;toPlainText().indexOf (
+                &quot;Established X server connection&quot; ) ==-1 )
+    {
+        stInfo-&gt;insertPlainText (
+            tr (
+                &quot;Connection timeout, aborting&quot; ) );
+        if ( nxproxy )
+            nxproxy-&gt;terminate();
+        restartResume=true;
+    }
+}
+
+
+void ONMainWindow::slotTestSessionStatus()
+{
+
+    if ( !sessionStatusDlg-&gt;isVisible() )
+        return;
+    if ( stInfo-&gt;toPlainText().indexOf (
+                &quot;Established X server connection&quot; ) ==-1 )
+    {
+        stInfo-&gt;insertPlainText (
+            tr ( &quot;Connection timeout, aborting&quot; ) );
+        if ( nxproxy )
+            nxproxy-&gt;terminate();
+    }
+}
+
+
+x2goSession ONMainWindow::getNewSessionFromString ( const QString&amp; string )
+{
+    QStringList lst=string.split ( '|' );
+    x2goSession s;
+    s.display=lst[0];
+    s.cookie=lst[1];
+    s.agentPid=lst[2];
+    s.sessionId=lst[3];
+    s.grPort=lst[4];
+    s.sndPort=lst[5];
+    if ( lst.count() &gt;6 )
+        s.fsPort=lst[6];
+    return s;
+}
+
+
+void ONMainWindow::slotAppDialog()
+{
+    AppDialog dlg(this);
+    dlg.exec();
+}
+
+void ONMainWindow::runCommand()
+{
+    QString passwd=getCurrentPass();
+    QString user=getCurrentUname();
+    QString host=resumingSession.server;
+    QString command;
+    QString sessionType=&quot;D&quot;;
+    QString rdpOpts,rdpServer;
+    bool rdpFS=false;
+    QString rdpWidth;
+    QString rdpHeight;
+    bool rootless=false;
+    resumingSession.published=false;
+    if ( !embedMode )
+    {
+        X2goSettings* st;
+        if (!brokerMode)
+            st=new X2goSettings( &quot;sessions&quot; );
+        else
+            st=new X2goSettings(config.iniFile, QSettings::IniFormat);
+
+
+        if ( useLdap )
+            command=sessionCmd;
+        else
+        {
+            QString sid=lastSession-&gt;id();
+            command=st-&gt;setting()-&gt;value (
+                        sid+&quot;/command&quot;,
+                        ( QVariant ) tr ( &quot;KDE&quot; ) ).toString();
+            rdpOpts=st-&gt;setting()-&gt;value (
+                        sid+&quot;/rdpoptions&quot;,
+                        ( QVariant ) &quot;&quot; ).toString();
+            rdpServer=st-&gt;setting()-&gt;value (
+                          sid+&quot;/rdpserver&quot;,
+                          ( QVariant ) &quot;&quot; ).toString();
+            rootless=st-&gt;setting()-&gt;value ( sid+&quot;/rootless&quot;,
+                                            ( QVariant ) false ).toBool();
+            resumingSession.published=st-&gt;setting()-&gt;value ( sid+&quot;/published&quot;,
+                                      ( QVariant ) false ).toBool();
+
+            rdpFS=st-&gt;setting()-&gt;value (
+                      sid+&quot;/fullscreen&quot;,
+                      ( QVariant ) defaultFullscreen ).toBool();
+            rdpHeight=st-&gt;setting()-&gt;value (
+                          sid+&quot;/height&quot;,
+                          ( QVariant ) defaultHeight ).toString();
+            rdpWidth=st-&gt;setting()-&gt;value (
+                         sid+&quot;/width&quot;,
+                         ( QVariant ) defaultWidth ).toString();
+
+        }
+        delete st;
+    }
+    else
+    {
+        command=config.command;
+        rootless=config.rootless;
+    }
+    if ( rootless )
+        sessionType=&quot;R&quot;;
+    if ( resumingSession.published )
+    {
+        sessionType=&quot;P&quot;;
+        command=&quot;PUBLISHED&quot;;
+    }
+
+    if ( command==&quot;KDE&quot; )
+    {
+        command=&quot;startkde&quot;;
+    }
+    else if ( command==&quot;GNOME&quot; )
+    {
+        command=&quot;gnome-session&quot;;
+    }
+    else if ( command==&quot;UNITY&quot; )
+    {
+        command=&quot;unity&quot;;
+    }
+    else if ( command==&quot;LXDE&quot; )
+    {
+        command=&quot;startlxde&quot;;
+    }
+    else if ( command==&quot;RDP&quot; )
+    {
+        command=&quot;rdesktop &quot;;
+        if ( rdpFS )
+            command+=&quot; -f &quot;;
+        else
+            command+=&quot; -g &quot;+rdpWidth+&quot;x&quot;+rdpHeight;
+        command+=&quot; &quot;+rdpOpts+ &quot; &quot;+rdpServer;
+
+        sessionType=&quot;R&quot;;
+    }
+
+    if ( managedMode )
+        return;
+
+    SshProcess *proc=0l;
+
+    QString cmd;
+
+    command.replace ( &quot; &quot;,&quot;X2GO_SPACE_CHAR&quot; );
+
+    if ( !startSessSound  || startSessSndSystem==PULSE )
+    {
+        cmd=&quot;setsid x2goruncommand &quot;+resumingSession.display+&quot; &quot;+
+            resumingSession.agentPid + &quot; &quot; +
+            resumingSession.sessionId+&quot; &quot;+
+            resumingSession.sndPort+ &quot; &quot;+ command+&quot; nosnd &quot;+
+            sessionType +&quot;&gt;&amp; /dev/null &amp; exit&quot;;
+        if ( startSessSndSystem ==PULSE )
+        {
+            cmd=&quot;PULSE_CLIENTCONFIG=~/.x2go/C-&quot;+
+                resumingSession.sessionId+
+                &quot;/.pulse-client.conf &quot;+cmd;
+        }
+    }
+    else
+    {
+        switch ( startSessSndSystem )
+        {
+        case ESD:
+            cmd=&quot;setsid x2goruncommand &quot;+
+                resumingSession.display+&quot; &quot;+
+                resumingSession.agentPid + &quot; &quot; +
+                resumingSession.sessionId+&quot; &quot;+
+                resumingSession.sndPort+ &quot; &quot;+
+                command+&quot; esd &quot;+
+                sessionType +&quot;&gt;&amp; /dev/null &amp; exit&quot;;
+            break;
+        case ARTS:
+            cmd=&quot;setsid x2goruncommand &quot;+
+                resumingSession.display+&quot; &quot;+
+                resumingSession.agentPid + &quot; &quot; +
+                resumingSession.sessionId+&quot; &quot;+
+                resumingSession.sndPort+ &quot; &quot;+
+                command+&quot; arts &quot;+
+                sessionType +&quot;&gt;&amp; /dev/null &amp; exit&quot;;
+            break;
+
+        }
+    }
+
+    if ( runRemoteCommand )
+    {
+        proc=new SshProcess ( sshConnection, this );
+        connect ( proc,SIGNAL ( sshFinished ( bool, QString,
+                                              SshProcess* ) ),
+                  this,SLOT ( slotRetRunCommand ( bool,
+                                                  QString,
+                                                  SshProcess* ) ) );
+
+        proc-&gt;startNormal ( cmd );
+    }
+#ifdef Q_WS_HILDON
+    //wait 5 seconds and execute xkbcomp
+    QTimer::singleShot ( 5000, this, SLOT ( slotExecXmodmap() ) );
+#endif
+}
+
+
+void ONMainWindow::runApplication(QString exec)
+{
+    SshProcess* proc=new SshProcess ( sshConnection, this );
+    proc-&gt;startNormal (&quot;PULSE_CLIENTCONFIG=~/.x2go/C-&quot;+
+                       resumingSession.sessionId+&quot;/.pulse-client.conf DISPLAY=:&quot;+
+                       resumingSession.display+
+                       &quot; setsid &quot;+exec+&quot;&gt;&amp; /dev/null &amp; exit&quot;);
+}
+
+void ONMainWindow::slotRetRunCommand ( bool result, QString output,
+                                       SshProcess* proc )
+{
+    if ( proc )
+        delete proc;
+    if ( result==false )
+    {
+        QString message=tr ( &quot;&lt;b&gt;Connection failed&lt;/b&gt;\n:\n&quot; ) +output;
+        if ( message.indexOf ( &quot;publickey,password&quot; ) !=-1 )
+        {
+            message=tr ( &quot;&lt;b&gt;Wrong password!&lt;/b&gt;&lt;br&gt;&lt;br&gt;&quot; ) +
+                    message;
+        }
+        QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),message,
+                                QMessageBox::Ok,
+                                QMessageBox::NoButton );
+    }
+    else
+    {
+        if (resumingSession.published)
+            readApplications();
+    }
+}
+
+void ONMainWindow::readApplications()
+{
+    SshProcess* proc=new SshProcess ( sshConnection, this );
+    connect ( proc,SIGNAL ( sshFinished ( bool, QString,
+                                          SshProcess* ) ),
+              this,SLOT ( slotReadApplications ( bool,
+                                                 QString,
+                                                 SshProcess* ) ) );
+    proc-&gt;startNormal ( &quot;x2gogetapps&quot; );
+    sbApps-&gt;setEnabled(false);
+}
+
+void ONMainWindow::slotReadApplications(bool result, QString output,
+                                        SshProcess* proc )
+{
+    if ( proc )
+        delete proc;
+    if ( result==false )
+    {
+        QString message=tr ( &quot;&lt;b&gt;Connection failed&lt;/b&gt;\n:\n&quot; ) +output;
+        if ( message.indexOf ( &quot;publickey,password&quot; ) !=-1 )
+        {
+            message=tr ( &quot;&lt;b&gt;Wrong password!&lt;/b&gt;&lt;br&gt;&lt;br&gt;&quot; ) +
+                    message;
+        }
+        QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),message,
+                                QMessageBox::Ok,
+                                QMessageBox::NoButton );
+        return;
+    }
+    sbApps-&gt;setEnabled(true);
+    applications.clear();
+    QString locallong=QLocale::system().name();
+    QString localshort=QLocale::system().name().split(&quot;_&quot;)[0];
+    bool startAppFound=false;
+
+    foreach(QString appstr, output.split(&quot;&lt;/desktop&gt;&quot;,QString::SkipEmptyParts))
+    {
+        bool localcomment=false;
+        bool localname=false;
+        Application app;
+        app.category=Application::OTHER;
+        QStringList lines=appstr.split(&quot;\n&quot;, QString::SkipEmptyParts);
+        for (int i=0; i&lt;lines.count(); ++i)
+        {
+            QString line=lines[i];
+            if (line.indexOf(&quot;Name[&quot;+localshort+&quot;]=&quot;)!=-1  || line.indexOf(&quot;Name[&quot;+locallong+&quot;]=&quot;)!=-1)
+            {
+                app.name=QString::fromUtf8(line.split(&quot;=&quot;)[1].toAscii());
+//                 x2goDebug&lt;&lt;&quot;local name: &quot;&lt;&lt;app.name&lt;&lt;endl;
+                localname=true;
+            }
+            if (line.indexOf(&quot;Comment[&quot;+localshort+&quot;]=&quot;)!=-1 || line.indexOf(&quot;Comment[&quot;+locallong+&quot;]=&quot;)!=-1)
+            {
+                app.comment=QString::fromUtf8(line.split(&quot;=&quot;)[1].toAscii());
+//                 x2goDebug&lt;&lt;&quot;local comment: &quot;&lt;&lt;app.comment&lt;&lt;endl;
+                localcomment=true;
+            }
+            if (line.indexOf(&quot;Name=&quot;)!=-1 &amp;&amp; !localname)
+            {
+                app.name=line.split(&quot;=&quot;)[1];
+                if (app.name==autostartApp)
+                    startAppFound=true;
+//                 x2goDebug&lt;&lt;&quot;name: &quot;&lt;&lt;app.name&lt;&lt;endl;
+            }
+            if (line.indexOf(&quot;Comment=&quot;)!=-1 &amp;&amp; !localcomment)
+            {
+                app.comment=line.split(&quot;=&quot;)[1];
+//                 x2goDebug&lt;&lt;&quot;comment: &quot;&lt;&lt;app.comment&lt;&lt;endl;
+            }
+            if (line.indexOf(&quot;Exec=&quot;)!=-1)
+            {
+                app.exec=line.split(&quot;=&quot;)[1];
+                app.exec.replace(&quot; %f&quot;,&quot;&quot;,Qt::CaseInsensitive);
+                app.exec.replace(&quot; %u&quot;,&quot;&quot;,Qt::CaseInsensitive);
+                app.exec.replace(&quot;%f&quot;,&quot;&quot;,Qt::CaseInsensitive);
+                app.exec.replace(&quot;%u&quot;,&quot;&quot;,Qt::CaseInsensitive);
+                if (app.exec==autostartApp)
+                    startAppFound=true;
+//                 x2goDebug&lt;&lt;&quot;exec: &quot;&lt;&lt;app.exec&lt;&lt;endl;
+            }
+            if (line.indexOf(&quot;Categories=&quot;)!=-1)
+            {
+                if (line.indexOf(&quot;Audio&quot;)!=-1)
+                    app.category=Application::MULTIMEDIA;
+                if (line.indexOf(&quot;Vide&quot;)!=-1)
+                    app.category=Application::MULTIMEDIA;
+                if (line.indexOf(&quot;Development&quot;)!=-1)
+                    app.category=Application::DEVELOPMENT;
+                if (line.indexOf(&quot;Education&quot;)!=-1)
+                    app.category=Application::EDUCATION;
+                if (line.indexOf(&quot;Game&quot;)!=-1)
+                    app.category=Application::GAME;
+                if (line.indexOf(&quot;Graphics&quot;)!=-1)
+                    app.category=Application::GRAPHICS;
+                if (line.indexOf(&quot;Network&quot;)!=-1)
+                    app.category=Application::NETWORK;
+                if (line.indexOf(&quot;Office&quot;)!=-1)
+                    app.category=Application::OFFICE;
+                if (line.indexOf(&quot;Settings&quot;)!=-1)
+                    app.category=Application::SETTINGS;
+                if (line.indexOf(&quot;System&quot;)!=-1)
+                    app.category=Application::SYSTEM;
+                if (line.indexOf(&quot;Utility&quot;)!=-1)
+                    app.category=Application::UTILITY;
+                if (line.indexOf(&quot;X2Go-Top&quot;,0,Qt::CaseInsensitive)!=-1)
+                    app.category=Application::TOP;
+            }
+            if (line.indexOf(&quot;&lt;icon&gt;&quot;)!=-1)
+            {
+                bool isSvg=false;
+                line=lines[++i];
+                QByteArray pic;
+                while (line.indexOf(&quot;&lt;/icon&gt;&quot;)==-1)
+                {
+                    pic+=QByteArray::fromBase64(line.toAscii());
+                    line=lines[++i];
+                    if (QString(QByteArray::fromBase64(line.toAscii())).indexOf(&quot;&lt;/svg&gt;&quot;,Qt::CaseInsensitive)!=-1)
+                    {
+                        isSvg=true;
+                    }
+                }
+                if (!isSvg)
+                    app.icon.loadFromData(pic);
+                else
+                {
+                    QPixmap pix(32,32);
+                    QSvgRenderer svgRenderer( pic );
+                    QPainter pixPainter(&amp;pix);
+                    svgRenderer.render(&amp;pixPainter);
+                    app.icon=pix;
+                }
+            }
+        }
+        if (app.name.length()&gt;0)
+        {
+            if (app.comment.length()&lt;=0)
+                app.comment=app.name;
+            applications.append(app);
+        }
+    }
+
+    qSort(applications.begin(), applications.end(),Application::lessThen);
+    plugAppsInTray();
+    if (runStartApp &amp;&amp; autostartApp.length()&gt;1)
+    {
+        if (!startAppFound)
+            x2goDebug&lt;&lt;&quot;Autostart application &quot;&lt;&lt;autostartApp&lt;&lt; &quot; not found in Desktop files&quot;&lt;&lt;endl;
+        else
+            runApplication(autostartApp);
+    }
+}
+
+
+bool ONMainWindow::parseParameter ( QString param )
+{
+    if ( param==&quot;--help&quot; )
+    {
+        showHelp();
+        return false;
+    }
+
+    if ( param==&quot;--help-pack&quot; )
+    {
+        showHelpPack();
+        return false;
+    }
+
+    if ( param == &quot;--portable&quot; )
+    {
+        ONMainWindow::portable=true;
+        return true;
+    }
+    if ( param == &quot;--clean-all-files&quot; )
+    {
+        cleanAllFiles=true;
+        return true;
+    }
+    if (param == &quot;--connectivity-test&quot;)
+    {
+        connTest=true;
+        return true;
+    }
+
+    if ( param==&quot;--no-menu&quot; )
+    {
+        drawMenu=false;
+        return true;
+    }
+
+    if ( param==&quot;--maximize&quot; )
+    {
+        startMaximized=true;
+        return true;
+    }
+    if ( param==&quot;--xinerama&quot; )
+    {
+        defaultXinerama=true;
+        return true;
+    }
+    if (param == &quot;--thinclient&quot;)
+    {
+        thinMode=true;
+        startMaximized=true;
+        return true;
+    }
+    if (param == &quot;--haltbt&quot;)
+    {
+        showHaltBtn=true;
+        return true;
+    }
+    if ( param==&quot;--hide&quot; )
+    {
+        startHidden=true;
+        return true;
+    }
+    if ( param==&quot;--pgp-card&quot; )
+    {
+        usePGPCard=true;
+        return true;
+    }
+    if ( param==&quot;--ldap-printing&quot; )
+    {
+        LDAPPrintSupport=true;
+        return true;
+    }
+    if ( param==&quot;--add-to-known-hosts&quot; )
+    {
+        acceptRsa=true;
+        return true;
+    }
+    if ( param==&quot;--no-session-edit&quot; )
+    {
+        noSessionEdit=true;
+        return true;
+    }
+    if ( param==&quot;--change-broker-pass&quot;)
+    {
+        changeBrokerPass=true;
+        return true;
+    }
+
+
+    QString setting,value;
+    QStringList vals=param.split ( &quot;=&quot; );
+    if ( vals.size() &lt;2 )
+    {
+        printError ( param );
+        return false;
+    }
+    setting=vals[0];
+    vals.removeFirst();
+    value=vals.join ( &quot;=&quot; );
+    if ( setting==&quot;--link&quot; )
+    {
+        return linkParameter ( value );
+    }
+    if ( setting==&quot;--sound&quot; )
+    {
+        return soundParameter ( value );
+    }
+    if ( setting==&quot;--geometry&quot; )
+    {
+        return geometry_par ( value );
+    }
+    if ( setting==&quot;--pack&quot; )
+    {
+        return packParameter ( value );
+    }
+    if ( setting==&quot;--kbd-layout&quot; )
+    {
+        defaultLayout=value.split(&quot;,&quot;,QString::SkipEmptyParts);
+        if (defaultLayout.size()==0)
+            defaultLayout&lt;&lt;tr(&quot;us&quot;);
+        return true;
+    }
+    if ( setting==&quot;--session&quot; )
+    {
+        defaultSession=true;
+        defaultSessionName=value;
+        return true;
+    }
+    if ( setting==&quot;--session-conf&quot; )
+    {
+        ONMainWindow::sessionCfg=value;
+        return true;
+    }
+    if ( setting==&quot;--sessionid&quot; )
+    {
+        defaultSession=true;
+        defaultSessionId=value;
+        return true;
+    }
+    if ( setting==&quot;--user&quot; )
+    {
+        defaultUser=true;
+        defaultUserName=value;
+        return true;
+    }
+    if ( setting==&quot;--kbd-type&quot; )
+    {
+        defaultKbdType=value;
+        return true;
+    }
+    if ( setting==&quot;--set-kbd&quot; )
+    {
+        return setKbd_par ( value );
+    }
+    if ( setting==&quot;--ldap&quot; )
+    {
+        return ldapParameter ( value );
+    }
+    if ( setting==&quot;--ldap1&quot; )
+    {
+        return ldap1Parameter ( value );
+    }
+    if ( setting==&quot;--ldap2&quot; )
+    {
+        return ldap2Parameter ( value );
+    }
+    if ( setting==&quot;--command&quot; )
+    {
+        defaultCmd=value;
+        return true;
+    }
+    if ( setting==&quot;--read-exports-from&quot; )
+    {
+        readExportsFrom=value;
+        return true;
+    }
+    if ( setting==&quot;--external-login&quot; )
+    {
+        extLogin=true;
+        readLoginsFrom=value;
+        return true;
+    }
+    if ( setting==&quot;--ssh-port&quot; )
+    {
+        defaultSshPort=value;
+        return true;
+    }
+    if ( setting==&quot;--dpi&quot; )
+    {
+        defaultSetDPI=true;
+        defaultDPI=value.toUInt();
+        return true;
+    }
+    if ( setting==&quot;--client-ssh-port&quot; )
+    {
+        clientSshPort=value;
+        return true;
+    }
+    if ( setting == &quot;--embed-into&quot; )
+    {
+        embedMode=true;
+        embedParent=value.toLong();
+        return true;
+    }
+    if ( setting == &quot;--broker-url&quot;)
+    {
+        brokerMode=true;
+        noSessionEdit=true;
+        config.brokerurl=value;
+        return true;
+    }
+    if ( setting == &quot;--broker-name&quot;)
+    {
+        config.brokerName=value;
+        return true;
+    }
+    if ( setting == &quot;--autostart&quot;)
+    {
+        autostartApp=value;
+        return true;
+    }
+    if ( setting == &quot;--auth-id&quot;)
+    {
+        QFile file(value);
+        if (!file.open(QIODevice::ReadOnly | QIODevice::Text))
+        {
+            printError ( param + tr(&quot; (can't open file)&quot;));
+            return false;
+        }
+        QTextStream in(&amp;file);
+        config.brokerUserId = in.readLine();
+        return true;
+    }
+    if (setting == &quot;--support-menu&quot;)
+    {
+        if (! QFile::exists(value))
+        {
+            printError( param + tr(&quot; (file not exists)&quot;));
+            return false;
+        }
+        supportMenuFile=value;
+        return true;
+    }
+    if (setting == &quot;--background&quot;)
+    {
+        if (! QFile::exists(value))
+        {
+            printError( param + tr(&quot; (file not exists)&quot;));
+            return false;
+        }
+        BGFile=value;
+        return true;
+    }
+    if (setting == &quot;--session-icon&quot;)
+    {
+        if (! QFile::exists(value))
+        {
+            printError( param + tr(&quot; (file not exists)&quot;));
+            return false;
+        }
+        SPixFile=value;
+        return true;
+    }
+    if (setting == &quot;--home&quot;)
+    {
+        QDir dr;
+
+#ifdef Q_OS_WIN
+        int find=value.indexOf(&quot;(&quot;);
+        int lind=value.indexOf(&quot;)&quot;);
+        if (find!=-1 &amp;&amp; lind !=-1)
+        {
+            QString label=value.mid(find+1,lind-find-1);
+            x2goDebug&lt;&lt; &quot;searching for drive with label: &quot;&lt;&lt;label;
+            QString drive=wapiGetDriveByLabel(label);
+            value.replace(&quot;(&quot;+label+&quot;)&quot;,drive);
+            x2goDebug&lt;&lt;&quot;new path: &quot;&lt;&lt;value;
+        }
+#endif
+        if (! dr.exists(value))
+        {
+            printError( param + tr(&quot; (directory not exists)&quot;));
+            return false;
+        }
+        homeDir=value;
+        portableDataPath=value;
+        return true;
+    }
+
+    printError ( param );
+    return false;
+}
+
+
+bool ONMainWindow::linkParameter ( QString value )
+{
+    if ( value==&quot;modem&quot; )
+        defaultLink=MODEM;
+    else if ( value==&quot;isdn&quot; )
+        defaultLink=ISDN;
+    else if ( value==&quot;adsl&quot; )
+        defaultLink=ADSL;
+    else if ( value==&quot;wan&quot; )
+        defaultLink=WAN;
+    else if ( value==&quot;lan&quot; )
+        defaultLink=LAN;
+    else
+    {
+        qCritical (
+            &quot;%s&quot;,tr (
+                &quot;wrong value for argument\&quot;--link\&quot;&quot;
+            ).toLocal8Bit().data() );
+        return false;
+    }
+    return true;
+
+}
+
+bool ONMainWindow::soundParameter ( QString val )
+{
+    if ( val==&quot;1&quot; )
+        defaultUseSound=true;
+    else if ( val==&quot;0&quot; )
+        defaultUseSound=false;
+    else
+    {
+        qCritical (
+            &quot;%s&quot;,tr ( &quot;wrong value for &quot;
+                      &quot;argument\&quot;--sound\&quot;&quot; ).toLocal8Bit().data() );
+        return false;
+    }
+    return true;
+}
+
+bool ONMainWindow::geometry_par ( QString val )
+{
+    if ( val==&quot;fullscreen&quot; )
+        defaultFullscreen=true;
+    else
+    {
+        QStringList res=val.split ( &quot;x&quot; );
+        if ( res.size() !=2 )
+        {
+            qCritical (
+                &quot;%s&quot;,tr (
+                    &quot;wrong value for argument\&quot;--geometry\&quot;&quot; ).
+                toLocal8Bit().data() );
+            return false;
+        }
+        bool o1,o2;
+        defaultWidth=res[0].toInt ( &amp;o1 );
+        defaultHeight=res[1].toInt ( &amp;o2 );
+        if ( ! ( defaultWidth &gt;0 &amp;&amp; defaultHeight &gt;0 &amp;&amp; o1 &amp;&amp; o2 ) )
+        {
+            qCritical (
+                &quot;%s&quot;,tr (
+                    &quot;wrong value for argument\&quot;--geometry\&quot;&quot; ).
+                toLocal8Bit().data() );
+            return false;
+        }
+    }
+    return true;
+}
+
+bool ONMainWindow::setKbd_par ( QString val )
+{
+    if ( val==&quot;1&quot; )
+        defaultSetKbd=true;
+    else if ( val==&quot;0&quot; )
+        defaultSetKbd=false;
+    else
+    {
+        qCritical (
+            &quot;%s&quot;,tr (
+                &quot;wrong value for argument\&quot;--set-kbd\&quot;&quot; ).
+            toLocal8Bit().data() );
+        return false;
+    }
+    return true;
+}
+
+bool ONMainWindow::ldapParameter ( QString val )
+{
+    QString ldapstring=val;
+    useLdap=true;
+    ldapstring.replace ( &quot;\&quot;&quot;,&quot;&quot; );
+    QStringList lst=ldapstring.split ( ':',QString::SkipEmptyParts );
+    if ( lst.size() !=3 )
+    {
+        qCritical (
+            &quot;%s&quot;,tr (
+                &quot;wrong value for argument\&quot;--ldap\&quot;&quot; ).
+            toLocal8Bit().data() );
+        return false;
+    }
+    ldapOnly=true;
+    ldapServer=lst[0];
+    ldapPort=lst[1].toInt();
+    ldapDn=lst[2];
+
+
+    return true;
+}
+
+bool ONMainWindow::ldap1Parameter ( QString val )
+{
+    QString ldapstring=val;
+    ldapstring.replace ( &quot;\&quot;&quot;,&quot;&quot; );
+    QStringList lst=ldapstring.split ( ':',QString::SkipEmptyParts );
+    if ( lst.size() !=2 )
+    {
+        qCritical (
+            &quot;%s&quot;,tr (
+                &quot;wrong value for argument\&quot;--ldap1\&quot;&quot; ).
+            toLocal8Bit().data() );
+        return false;
+    }
+    ldapServer1=lst[0];
+    ldapPort1=lst[1].toInt();
+
+    return true;
+}
+
+bool ONMainWindow::ldap2Parameter ( QString val )
+{
+    QString ldapstring=val;
+    ldapstring.replace ( &quot;\&quot;&quot;,&quot;&quot; );
+    QStringList lst=ldapstring.split ( ':',QString::SkipEmptyParts );
+    if ( lst.size() !=2 )
+    {
+        qCritical ( &quot;%s&quot;,
+                    tr (
+                        &quot;wrong value for argument\&quot;--ldap2\&quot;&quot; ).
+                    toLocal8Bit().data() );
+        return false;
+    }
+    ldapServer2=lst[0];
+    ldapPort2=lst[1].toInt();
+
+    return true;
+}
+
+
+bool ONMainWindow::packParameter ( QString val )
+{
+
+    QFile file ( &quot;:/txt/packs&quot; );
+    if ( !file.open ( QIODevice::ReadOnly | QIODevice::Text ) )
+        return true;
+    QTextStream in ( &amp;file );
+    while ( !in.atEnd() )
+    {
+        QString pc=in.readLine();
+        if ( pc.indexOf ( &quot;-%&quot; ) !=-1 )
+        {
+            pc=pc.left ( pc.indexOf ( &quot;-%&quot; ) );
+
+            QStringList pctails=val.split ( &quot;-&quot; );
+            QString pcq=pctails[pctails.size()-1];
+            pctails.removeLast();
+
+            if ( pctails.join ( &quot;-&quot; ) ==pc )
+            {
+                bool ok;
+                int v=pcq.toInt ( &amp;ok );
+                if ( ok &amp;&amp; v&gt;=0 &amp;&amp; v&lt;=9 )
+                {
+                    defaultPack=pc;
+                    defaultQuality=v;
+                    return true;
+                }
+                else
+                    break;
+            }
+        }
+        else
+        {
+            if ( pc==val )
+            {
+                defaultPack=val;
+                return true;
+            }
+        }
+    }
+    file.close();
+    qCritical ( &quot;%s&quot;,tr ( &quot;wrong value for argument\&quot;--pack\&quot;&quot; ).
+                toLocal8Bit().data() );
+    return false;
+}
+
+
+void ONMainWindow::printError ( QString param )
+{
+    qCritical ( &quot;%s&quot;, ( tr ( &quot;wrong parameter: &quot; ) +param ).
+                toLocal8Bit().data() );
+#ifdef Q_OS_WIN
+    x2goDebug&lt;&lt;tr ( &quot;wrong parameter: &quot; ) +param &lt;&lt;endl;
+#endif
+}
+
+void ONMainWindow::showHelp()
+{
+    QString helpMsg=
+        &quot;Usage: x2goclient [Options]\n&quot;
+        &quot;Options:\n&quot;
+        &quot;--help\t\t\t\t show this message\n&quot;
+        &quot;--help-pack\t\t\t show available pack methods\n&quot;
+        &quot;--no-menu\t\t\t hide menu bar\n&quot;
+        &quot;--no-session-edit\t\t not allow user to edit preconfigured\n&quot;
+        &quot;\t\t\t\t sessions\n&quot;
+        &quot;--maximize\t\t\t start maximized\n&quot;
+        &quot;--hide\t\t\t\t start hidden\n&quot;
+        &quot;--portable\t\t\t start in \&quot;portable\&quot; mode\n&quot;
+        &quot;--pgp-card\t\t\t use openPGP card authentication\n&quot;
+        &quot;--xinerama\t\t\t use Xinerama by default\n&quot;
+        &quot;--ldap-printing\t\t\t allow client side printing in LDAP mode\n&quot;
+        &quot;--thinclient\t\t\t run without window manager\n&quot;
+        &quot;--haltbt\t\t\t show shutdown button\n&quot;
+        &quot;--add-to-known-hosts\t\t add RSA key fingerprint to &quot;
+        &quot;.ssh/known_hosts\n&quot;
+        &quot;\t\t\t\t if authenticity of server can't be established\n\n&quot;
+        &quot;--ldap=&lt;host:port:dn&gt; \t\t start with LDAP support. Example:\n&quot;
+        &quot;\t\t\t\t --ldap=ldapserver:389:o=organization,c=de\n\n&quot;
+        &quot;--ldap1=&lt;host:port&gt;\t\t LDAP failover server #1 \n&quot;
+        &quot;--ldap2=&lt;host:port&gt;\t\t LDAP failover server #2 \n&quot;
+        &quot;--ssh-port=&lt;port&gt;\t\t connect to this port, default 22\n&quot;
+        &quot;--client-ssh-port=&lt;port&gt;\t local ssh port (for fs export), &quot;
+        &quot;default 22\n&quot;
+        &quot;--command=&lt;cmd&gt;\t\t\t Set default command, default value 'KDE'\n&quot;
+        &quot;--session=&lt;session&gt;\t\t Start session 'session'\n&quot;
+        &quot;--user=&lt;username&gt;\t\t select user 'username'\n&quot;
+        &quot;--geomerty=&lt;W&gt;x&lt;H&gt;|fullscreen\t set default geometry, default &quot;
+        &quot;value '800x600'\n&quot;
+        &quot;--dpi=&lt;dpi&gt;\t\t\t set dpi of x2goagent to dpi, default not set\n&quot;
+        &quot;--link=&lt;modem|isdn|adsl|wan|lan&gt; set default link type, &quot;
+        &quot;default 'adsl'\n&quot;
+        &quot;--pack=&lt;packmethod&gt;\t\t set default pack method, default &quot;
+        &quot;'16m-jpeg-9'\n&quot;
+        &quot;--kbd-layout=&lt;layout&gt;\t\t set default keyboard layout or layouts\n&quot;
+        &quot;\t\t\t\t comma separated\n&quot;
+        &quot;--kbd-type=&lt;typed&gt;\t\t set default keyboard type\n&quot;
+        &quot;--home=&lt;dir&gt;\t\t\t set users home directory\n&quot;
+        &quot;--set-kbd=&lt;0|1&gt;\t\t\t overwrite current keyboard settings\n&quot;
+        &quot;--autostart=&lt;app&gt; \t\t launch \&quot;app\&quot; by session start in \&quot;published &quot;
+        &quot;applications\&quot; mode\n&quot;
+        &quot;--session-conf=&lt;file&gt;\t\t path to alternative session config\n&quot;;
+    qCritical ( &quot;%s&quot;,helpMsg.toLocal8Bit().data() );
+    QMessageBox::information ( this,tr ( &quot;Options&quot; ),helpMsg );
+}
+
+void ONMainWindow::showHelpPack()
+{
+    qCritical ( &quot;%s&quot;,tr (
+                    &quot;Available pack methodes:&quot; ).toLocal8Bit().data() );
+    QFile file ( &quot;:/txt/packs&quot; );
+    if ( !file.open ( QIODevice::ReadOnly | QIODevice::Text ) )
+        return;
+    QTextStream in ( &amp;file );
+    QString msg;
+    while ( !in.atEnd() )
+    {
+        QString pc=in.readLine();
+        if ( pc.indexOf ( &quot;-%&quot; ) !=-1 )
+        {
+            pc=pc.left ( pc.indexOf ( &quot;-%&quot; ) );
+            pc+=&quot;-[0-9]&quot;;
+        }
+        msg+=pc+&quot;\n&quot;;
+        qCritical ( &quot;%s&quot;,pc.toLocal8Bit().data() );
+    }
+    file.close();
+#ifdef Q_OS_WIN
+
+    QMessageBox::information ( this,tr ( &quot;Options&quot; ),msg );
+#endif
+
+}
+
+void ONMainWindow::slotGetServers ( bool result, QString output,
+                                    SshProcess* proc )
+{
+    if ( proc )
+        delete proc;
+    proc=0;
+    if ( result==false )
+    {
+        cardReady=false;
+        cardStarted=false;
+
+        QString message=tr ( &quot;&lt;b&gt;Connection failed&lt;/b&gt;\n&quot; ) +output;
+        if ( message.indexOf ( &quot;publickey,password&quot; ) !=-1 )
+        {
+            message=tr ( &quot;&lt;b&gt;Wrong password!&lt;/b&gt;&lt;br&gt;&lt;br&gt;&quot; ) +
+                    message;
+        }
+
+        QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),message,
+                                QMessageBox::Ok,
+                                QMessageBox::NoButton );
+// 		currentKey=QString::null;
+        setEnabled ( true );
+        passForm-&gt;setEnabled ( true );
+        pass-&gt;setFocus();
+        pass-&gt;selectAll();
+        return;
+    }
+
+    passForm-&gt;hide();
+    setUsersEnabled ( false );
+    uname-&gt;setEnabled ( false );
+    u-&gt;setEnabled ( false );
+    QStringList servers=output.trimmed().split ( '\n' );
+    for ( int i=0;i&lt;servers.size();++i )
+    {
+        QStringList lst=servers[i].simplified().split ( ' ' );
+        if ( lst.size() &gt;1 )
+        {
+            for ( int j=0;j&lt;x2goServers.size();++j )
+                if ( x2goServers[j].name==lst[0] )
+                {
+                    x2goServers[j].sess=
+                        lst[1].toInt() *
+                        x2goServers[j].factor;
+                    x2goDebug&lt;&lt;x2goServers[j].name&lt;&lt;
+                    &quot;: sessions &quot;&lt;&lt;
+                    lst[1].toInt() &lt;&lt;
+                    &quot;, multiplied &quot;&lt;&lt;x2goServers[j].sess;
+                    break;
+                }
+        }
+    }
+
+    qSort ( x2goServers.begin(),x2goServers.end(),serv::lt );
+
+    listedSessions.clear();
+    retSessions=0;
+    if (sshConnection)
+        sshConnection-&gt;disconnectSession();
+    QString passwd;
+    QString user=getCurrentUname();
+    passwd=getCurrentPass();
+    for (int i=0; i&lt; serverSshConnections.count();++i)
+    {
+        if (serverSshConnections[i])
+            serverSshConnections[i]-&gt;disconnectSession();
+    }
+    serverSshConnections.clear();
+    for ( int j=0;j&lt;x2goServers.size();++j )
+    {
+        QString host=x2goServers[j].name;
+        sshPort=x2goServers[j].sshPort;
+        serverSshConnections&lt;&lt;startSshConnection ( host,sshPort,acceptRsa,user,passwd,true,false,true);
+    }
+}
+
+
+void ONMainWindow::slotListAllSessions ( bool result,QString output,
+        SshProcess* proc )
+{
+    bool last=false;
+
+    ++retSessions;
+    if ( retSessions == x2goServers.size() )
+        last=true;
+    if ( proc )
+        delete proc;
+    proc=0;
+
+    if ( result==false )
+    {
+        QString message=tr ( &quot;&lt;b&gt;Connection failed&lt;/b&gt;\n&quot; ) +output;
+        if ( message.indexOf ( &quot;publickey,password&quot; ) !=-1 )
+        {
+            message=tr ( &quot;&lt;b&gt;Wrong password!&lt;/b&gt;&lt;br&gt;&lt;br&gt;&quot; ) +
+                    message;
+        }
+
+        QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),message,
+                                QMessageBox::Ok,
+                                QMessageBox::NoButton );
+        QString sv=output.split ( &quot;:&quot; ) [0];
+        for ( int j=0;j&lt;x2goServers.size();++j )
+        {
+            if ( x2goServers[j].name==sv )
+            {
+                x2goServers[j].connOk=false;
+            }
+        }
+    }
+    else
+    {
+        listedSessions+=output.trimmed().split ( '\n',
+                        QString::SkipEmptyParts );
+    }
+    if ( last )
+    {
+        if ( listedSessions.size() ==0||
+                ( listedSessions.size() ==1 &amp;&amp;
+                  listedSessions[0].length() &lt;5 ) )
+        {
+// 	x2goDebug&lt;&lt;&quot;start New Session&quot;;
+            startNewSession();
+        }
+        else if ( listedSessions.size() ==1 )
+        {
+// 	x2goDebug&lt;&lt;&quot;have one session&quot;;
+            x2goSession s=getSessionFromString (
+                              listedSessions[0] );
+// 		x2goDebug&lt;&lt;&quot;will procceed one session&quot;;
+            QDesktopWidget wd;
+            if ( s.status==&quot;S&quot; &amp;&amp; isColorDepthOk (
+                        wd.depth(),s.colorDepth ) )
+                resumeSession ( s );
+            else
+            {
+// 				x2goDebug&lt;&lt;&quot;select one Session&quot;;
+                selectSession ( listedSessions );
+            }
+        }
+        else
+        {
+            selectSession ( listedSessions );
+        }
+    }
+}
+
+void ONMainWindow::slotResize()
+{
+    if ( startHidden )
+    {
+        hide();
+        return;
+    }
+    if ( !startMaximized &amp;&amp; !mwMax )
+    {
+        resize ( mwSize );
+        move ( mwPos );
+        show();
+    }
+    else
+        showMaximized();
+}
+
+void ONMainWindow::slotExportDirectory()
+{
+    if ( shadowSession )
+        return;
+
+    bool hide_after=false;
+    if (isHidden())
+    {
+        showNormal();
+        hide_after=true;
+    }
+    QString path;
+    if ( !useLdap &amp;&amp; !embedMode )
+    {
+        ExportDialog dlg ( lastSession-&gt;id(),this );
+        if ( dlg.exec() ==QDialog::Accepted )
+            path=dlg.getExport();
+    }
+    else
+
+        path= QFileDialog::getExistingDirectory (
+                  this,QString::null,
+                  homeDir );
+    if (hide_after)
+        hide();
+#ifdef Q_OS_WIN
+    if ( ONMainWindow::getPortable() &amp;&amp;
+            ONMainWindow::U3DevicePath().length() &gt;0 )
+    {
+        path.replace ( &quot;(U3)&quot;,u3Device );
+    }
+
+    path=cygwinPath ( wapiShortFileName ( path ) );
+#endif
+    if ( path!=QString::null )
+        exportDirs ( path );
+}
+
+
+void ONMainWindow::exportDirs ( QString exports,bool removable )
+{
+    if ( shadowSession )
+        return;
+    if ( embedMode )
+    {
+        if ( config.confFS  &amp;&amp; ! ( config.useFs ) )
+        {
+            return;
+        }
+    }
+    fsExportKeyReady=false;
+    directory dr;
+
+
+    dr.dirList=exports;
+    dr.key=createRSAKey();
+    QString passwd;
+    x2goDebug&lt;&lt;&quot;key created on: &quot;&lt;&lt;dr.key;
+
+    passwd=getCurrentPass();
+
+    fsInTun=false;
+    if ( !useLdap )
+    {
+        if ( !embedMode )
+        {
+            X2goSettings st ( &quot;sessions&quot; );
+
+            QString sid=lastSession-&gt;id();
+
+            fsInTun=st.setting()-&gt;value ( sid+&quot;/fstunnel&quot;,
+                                          ( QVariant ) true ).toBool();
+        }
+        else
+            fsInTun=true;
+    }
+    if ( fsInTun )
+    {
+        if ( fsTunnel==0l )
+            if ( startSshFsTunnel() )
+                return;
+    }
+    SshProcess* lproc;
+    QString uname=getCurrentUname();
+    lproc=new SshProcess ( sshConnection, this );
+    connect ( lproc,SIGNAL ( sshFinished ( bool,QString,SshProcess* ) ),
+              this,SLOT ( slotCopyKey ( bool, QString,SshProcess* ) ) );
+    QString dst=dr.key;
+    QString dhdir=homeDir+&quot;/.x2go&quot;;
+#ifdef Q_OS_WIN
+    dhdir=wapiShortFileName ( dhdir );
+#endif
+    dst.replace ( dhdir +&quot;/ssh/gen/&quot;,&quot;&quot; );
+    dst=&quot;~&quot;+uname +&quot;/.x2go/ssh/&quot;+dst;
+    dr.dstKey=dst;
+    dr.isRemovable=removable;
+    exportDir.append ( dr );
+    QString keyFile=dr.key;
+    lproc-&gt;start_cp ( keyFile,dst );
+
+}
+
+
+void ONMainWindow::exportDefaultDirs()
+{
+    QStringList dirs;
+    bool clientPrinting= ( useLdap &amp;&amp; LDAPPrintSupport );
+
+    if ( !useLdap )
+    {
+        if ( !embedMode )
+        {
+
+            X2goSettings st ( &quot;sessions&quot; );
+            clientPrinting= st.setting()-&gt;value (
+                                lastSession-&gt;id() +
+                                &quot;/print&quot;, true ).toBool();
+
+            QString exd=st.setting()-&gt;value (
+                            lastSession-&gt;id() +&quot;/export&quot;,
+                            ( QVariant ) QString::null ).toString();
+            QStringList lst=exd.split ( &quot;;&quot;,
+                                        QString::SkipEmptyParts );
+            for ( int i=0;i&lt;lst.size();++i )
+            {
+#ifndef Q_OS_WIN
+                QStringList tails=lst[i].split (
+                                      &quot;:&quot;,
+                                      QString::SkipEmptyParts );
+#else
+
+                QStringList tails=lst[i].split (
+                                      &quot;#&quot;,
+                                      QString::SkipEmptyParts );
+#endif
+
+                if ( tails[1]==&quot;1&quot; )
+                {
+#ifdef Q_OS_WIN
+                    if ( ONMainWindow::getPortable() &amp;&amp;
+                            ONMainWindow::U3DevicePath (
+                            ).length() &gt;0 )
+                    {
+                        tails[0].replace (
+                            &quot;(U3)&quot;,u3Device );
+                    }
+
+                    tails[0]=cygwinPath (
+                                 wapiShortFileName (
+                                     tails[0] ) );
+#endif
+                    dirs+=tails[0];
+                }
+            }
+        }
+        else
+        {
+            clientPrinting=true;
+            if ( config.confFS )
+            {
+                clientPrinting=config.useFs;
+            }
+        }
+    }
+
+    if ( clientPrinting )
+    {
+        QString path= homeDir +
+                      &quot;/.x2go/S-&quot;+
+                      resumingSession.sessionId +&quot;/spool&quot;;
+        QDir spooldir;
+        if ( !spooldir.exists ( path ) )
+        {
+            if ( !spooldir.mkpath ( path ) )
+            {
+                QString message=
+                    tr (
+                        &quot;Unable to create folder:&quot; ) + path;
+                QMessageBox::critical ( 0l,tr (
+                                            &quot;Error&quot; ),message,
+                                        QMessageBox::Ok,
+                                        QMessageBox::NoButton );
+
+            }
+        }
+        spoolDir=path;
+#ifdef Q_OS_WIN
+        path=cygwinPath (
+                 wapiShortFileName (
+                     path ) );
+#endif
+        QFile::setPermissions (
+            path,QFile::ReadOwner|QFile::WriteOwner|QFile::ExeOwner );
+
+        path+=&quot;__PRINT_SPOOL_&quot;;
+        dirs+=path;
+        printSupport=true;
+        if ( spoolTimer )
+            delete spoolTimer;
+        spoolTimer=new QTimer ( this );
+        connect ( spoolTimer,SIGNAL ( timeout() ),this,
+                  SLOT ( slotCheckPrintSpool() ) );
+        spoolTimer-&gt;start ( 2000 );
+    }
+    if ( dirs.size() &lt;=0 )
+        return;
+    exportDirs ( dirs.join ( &quot;:&quot; ) );
+}
+
+QString ONMainWindow::createRSAKey()
+{
+    QDir dr;
+    QString keyPath=homeDir +&quot;/.x2go/ssh/gen&quot;;
+    dr.mkpath ( keyPath );
+#ifdef Q_OS_WIN
+    keyPath=wapiShortFileName ( keyPath );
+#endif
+    QTemporaryFile fl ( keyPath+&quot;/key&quot; );
+    fl.open();
+    QString keyName=fl.fileName();
+    fl.setAutoRemove ( false );
+    fl.close();
+    fl.remove();
+
+    QStringList args;
+
+    args&lt;&lt;&quot;-t&quot;&lt;&lt;&quot;rsa&quot;&lt;&lt;&quot;-b&quot;&lt;&lt;&quot;1024&quot;&lt;&lt;&quot;-N&quot;&lt;&lt;&quot;&quot;&lt;&lt;&quot;-f&quot;&lt;&lt;keyName;
+// 	x2goDebug &lt;&lt;keyName&lt;&lt;endl;
+
+    if ( QProcess::execute ( &quot;ssh-keygen&quot;,args ) !=0 )
+    {
+        x2goDebug &lt;&lt;&quot;ssh-keygen failed&quot; &lt;&lt;endl;
+        return QString::null;
+    }
+// 	x2goDebug &lt;&lt;&quot;ssh-keygen ok&quot; &lt;&lt;endl;
+
+    QFile rsa ( &quot;/etc/ssh/ssh_host_rsa_key.pub&quot; );
+#ifdef Q_OS_WIN
+    rsa.setFileName (
+        wapiShortFileName (
+            homeDir+&quot;\\.x2go\\etc\\ssh_host_dsa_key.pub&quot; ) );
+#else
+    if ( userSshd )
+        rsa.setFileName ( homeDir+&quot;/.x2go/etc/ssh_host_dsa_key.pub&quot; );
+
+#endif
+
+#ifdef Q_OS_DARWIN
+    rsa.setFileName ( &quot;/etc/ssh_host_rsa_key.pub&quot; );
+#endif
+    if ( !rsa.open ( QIODevice::ReadOnly | QIODevice::Text ) )
+    {
+#ifdef Q_OS_LINUX
+        generateHostDsaKey();
+        generateEtcFiles();
+        startSshd();
+        rsa.setFileName ( homeDir+&quot;/.x2go/etc/ssh_host_dsa_key.pub&quot; );
+        rsa.open ( QIODevice::ReadOnly | QIODevice::Text );
+#else
+        printSshDError();
+        return QString::null;
+#endif
+    }
+
+    QByteArray rsa_pub;
+
+    if ( !rsa.atEnd() )
+        rsa_pub = rsa.readLine();
+    else
+    {
+        x2goDebug&lt;&lt;&quot;error: rsa file empty&quot;;
+        return QString::null;
+    }
+
+    QFile file ( keyName );
+    if ( !file.open (
+                QIODevice::WriteOnly | QIODevice::Text | QIODevice::Append )
+       )
+    {
+        x2goDebug&lt;&lt;&quot;error openning key:&quot;&lt;&lt;keyName;
+        return keyName;
+    }
+    QTextStream out ( &amp;file );
+    out&lt;&lt;&quot;----BEGIN RSA IDENTITY----&quot;&lt;&lt;rsa_pub;
+    file.close();
+    return keyName;
+}
+
+void ONMainWindow::slotCopyKey ( bool result, QString output, SshProcess* proc )
+{
+    fsExportKey=proc-&gt;getSource();
+    if ( proc )
+        delete proc;
+    proc=0;
+    x2goDebug&lt;&lt;&quot;exported key &quot;&lt;&lt;fsExportKey;
+    QFile::remove ( fsExportKey );
+    x2goDebug&lt;&lt;&quot;key removed&quot;;
+    if ( result==false )
+    {
+        QString message=tr ( &quot;&lt;b&gt;Connection failed&lt;/b&gt;\n&quot; ) +output;
+        if ( message.indexOf ( &quot;publickey,password&quot; ) !=-1 )
+        {
+            message=tr ( &quot;&lt;b&gt;Wrong password!&lt;/b&gt;&lt;br&gt;&lt;br&gt;&quot; ) +
+                    message;
+        }
+
+        QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),message,
+                                QMessageBox::Ok,
+                                QMessageBox::NoButton );
+        QFile::remove ( fsExportKey+&quot;.pub&quot; );
+        return;
+    }
+    fsExportKeyReady=true;
+
+    //start reverse mounting if RSA Key and FS tunnel are ready
+    //start only once from slotFsTunnelOk() or slotCopyKey().
+    if ( !fsInTun || fsTunReady )
+        startX2goMount();
+
+}
+
+directory* ONMainWindow::getExpDir ( QString key )
+{
+    for ( int i=0;i&lt;exportDir.size();++i )
+    {
+        if ( exportDir[i].key==key )
+            return &amp;exportDir[i];
+    }
+    return 0l;
+}
+
+
+
+
+void ONMainWindow::slotRetExportDir ( bool result,QString output,
+                                      SshProcess* proc )
+{
+
+    QString key;
+    for ( int i=0;i&lt;exportDir.size();++i )
+        if ( exportDir[i].proc==proc )
+        {
+            key=exportDir[i].key;
+            exportDir.removeAt ( i );
+            break;
+        }
+
+    if ( proc )
+        delete proc;
+
+    if ( result==false )
+    {
+        QString message=tr ( &quot;&lt;b&gt;Connection failed&lt;/b&gt;\n&quot; ) +output;
+        if ( message.indexOf ( &quot;publickey,password&quot; ) !=-1 )
+        {
+            message=tr ( &quot;&lt;b&gt;Wrong password!&lt;/b&gt;&lt;br&gt;&lt;br&gt;&quot; ) +
+                    message;
+        }
+
+        QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),message,
+                                QMessageBox::Ok,
+                                QMessageBox::NoButton );
+    }
+    QFile file ( key+&quot;.pub&quot; );
+    if ( !file.open ( QIODevice::ReadOnly | QIODevice::Text ) )
+    {
+        printSshDError();
+        QFile::remove
+        ( key+&quot;.pub&quot; );
+        return;
+    }
+
+    QByteArray line = file.readLine();
+    file.close();
+    QString authofname=homeDir;
+#ifdef Q_OS_WIN
+    QDir dir;
+    dir.mkpath ( authofname+&quot;\\.x2go\\.ssh&quot; );
+    x2goDebug&lt;&lt;&quot;Creating &quot;&lt;&lt;authofname+&quot;\\.x2go\\.ssh&quot;&lt;&lt;endl;
+    authofname=wapiShortFileName ( authofname ) +&quot;/.x2go&quot;;
+#endif
+    authofname+=&quot;/.ssh/authorized_keys&quot; ;
+    file.setFileName ( authofname );
+    if ( !file.open ( QIODevice::ReadOnly | QIODevice::Text ) )
+    {
+        printSshDError();
+        QFile::remove
+        ( key+&quot;.pub&quot; );
+        return;
+    }
+
+
+    QTemporaryFile tfile ( authofname );
+    tfile.open();
+    tfile.setAutoRemove ( true );
+    QTextStream out ( &amp;tfile );
+
+    while ( !file.atEnd() )
+    {
+        QByteArray newline = file.readLine();
+        if ( newline!=line )
+            out&lt;&lt;newline;
+    }
+    file.close();
+    tfile.close();
+    file.remove();
+    tfile.copy ( authofname );
+    QFile::remove
+    ( key+&quot;.pub&quot; );
+}
+
+
+
+void ONMainWindow::exportsEdit ( SessionButton* bt )
+{
+    EditConnectionDialog dlg ( bt-&gt;id(),this,3 );
+    if ( dlg.exec() ==QDialog::Accepted )
+    {
+        bt-&gt;redraw();
+        bool vis=bt-&gt;isVisible();
+        placeButtons();
+        users-&gt;ensureVisible ( bt-&gt;x(),bt-&gt;y(),50,220 );
+        bt-&gt;setVisible ( vis );
+    }
+}
+
+
+void ONMainWindow::slotExtTimer()
+{
+
+    if ( QFile::permissions ( readLoginsFrom ) !=
+            ( QFile::ReadUser|QFile::WriteUser|QFile::ExeUser|
+              QFile::ReadOwner|QFile::WriteOwner|QFile::ExeOwner ) )
+    {
+        x2goDebug &lt;&lt;&quot;Wrong permissions on &quot;&lt;&lt;readLoginsFrom &lt;&lt;&quot;:&quot;&lt;&lt;endl;
+        x2goDebug &lt;&lt; ( int ) ( QFile::permissions (
+                                   readLoginsFrom+&quot;/.&quot; ) )
+        &lt;&lt;&quot;must be&quot;&lt;&lt; ( int ) ( QFile::ReadUser|QFile::WriteUser
+                                |QFile::ExeUser|QFile::ReadOwner|
+                                QFile::WriteOwner|
+                                QFile::ExeOwner ) &lt;&lt;endl;
+        if ( extLogin )
+            extTimer-&gt;stop();
+        return;
+    }
+    QString loginDir;
+    QString logoutDir;
+    QDir dir ( readLoginsFrom );
+    QStringList list = dir.entryList ( QDir::Files );
+    for ( int i=0;i&lt;list.size();++i )
+    {
+        QFile file ( readLoginsFrom+&quot;/&quot;+list[i] );
+        if ( !file.open ( QIODevice::ReadOnly | QIODevice::Text ) )
+            continue;
+        if ( !file.atEnd() )
+        {
+            QByteArray line = file.readLine();
+            QString ln ( line );
+            QStringList args=ln.split ( &quot;=&quot;,
+                                        QString::SkipEmptyParts );
+            if ( args.size() &gt;1 )
+            {
+                if ( args[0]==&quot;login&quot; )
+                {
+                    args[1].replace ( &quot;\n&quot;,&quot;&quot; );
+                    if ( args[1].size() )
+                        loginDir=args[1];
+                }
+                if ( args[0]==&quot;logout&quot; )
+                {
+                    x2goDebug &lt;&lt;
+                    &quot; I HAVE external logout&quot;&lt;&lt;
+                    endl;
+                    args[1].replace ( &quot;\n&quot;,&quot;&quot; );
+                    if ( args[1].size() )
+                        logoutDir=args[1];
+                }
+            }
+        }
+        file.close();
+        file.remove();
+    }
+    if ( exportTimer-&gt;isActive() ) //running session
+    {
+        if ( logoutDir != QString::null )
+        {
+            x2goDebug &lt;&lt;&quot;external logout&quot;&lt;&lt;endl;
+            externalLogout ( logoutDir );
+        }
+    }
+    else
+    {
+        if ( loginDir != QString::null )
+        {
+            x2goDebug &lt;&lt;&quot;external login&quot;&lt;&lt;endl;
+            externalLogin ( loginDir );
+        }
+    }
+}
+
+
+void ONMainWindow::slotExportTimer()
+{
+
+    if ( QFile::permissions ( readExportsFrom ) != ( QFile::ReadUser|
+            QFile::WriteUser|
+            QFile::ExeUser|
+            QFile::ReadOwner|QFile::WriteOwner|QFile::ExeOwner ) )
+    {
+        x2goDebug &lt;&lt;&quot;Wrong permissions on &quot;&lt;&lt;
+        readExportsFrom &lt;&lt;&quot;:&quot;&lt;&lt;endl;
+        x2goDebug &lt;&lt; ( int ) ( QFile::permissions (
+                                   readExportsFrom+&quot;/.&quot; ) )
+        &lt;&lt;&quot;must be&quot;&lt;&lt; ( int ) ( QFile::ReadUser|QFile::WriteUser
+                                |QFile::ExeUser|QFile::ReadOwner|
+                                QFile::WriteOwner|
+                                QFile::ExeOwner ) &lt;&lt;endl;
+        exportTimer-&gt;stop();
+        return;
+    }
+
+    QDir dir ( readExportsFrom );
+    QStringList list = dir.entryList ( QDir::Files );
+    QString expList;
+    QString unexpList;
+    QString loginDir;
+    QString logoutDir;
+    for ( int i=0;i&lt;list.size();++i )
+    {
+        QFile file ( readExportsFrom+&quot;/&quot;+list[i] );
+        if ( !file.open ( QIODevice::ReadOnly | QIODevice::Text ) )
+            continue;
+        if ( !file.atEnd() )
+        {
+            QByteArray line = file.readLine();
+            QString ln ( line );
+            QStringList args=ln.split ( &quot;=&quot;,
+                                        QString::SkipEmptyParts );
+            if ( args.size() &gt;1 )
+            {
+                if ( args[0]==&quot;export&quot; )
+                {
+                    args[1].replace ( &quot;\n&quot;,&quot;&quot; );
+                    if ( args[1].size() )
+                        expList+=&quot;:&quot;+args[1];
+                }
+                if ( args[0]==&quot;unexport&quot; )
+                {
+                    args[1].replace ( &quot;\n&quot;,&quot;&quot; );
+                    if ( args[1].size() )
+                        unexpList+=&quot;:&quot;+args[1];
+                }
+            }
+        }
+        file.close();
+        file.remove();
+    }
+    QStringList args=expList.split ( &quot;:&quot;,QString::SkipEmptyParts );
+    expList=args.join ( &quot;:&quot; );
+    if ( expList.size() &gt;0 )
+    {
+        exportDirs ( expList,true );
+    }
+    args.clear();
+    args=unexpList.split ( &quot;:&quot;,QString::SkipEmptyParts );
+
+    QString passwd=getCurrentPass();
+    QString user=getCurrentUname();
+    QString host=resumingSession.server;
+    QString sessionId=resumingSession.sessionId;
+
+    for ( int i=0;i&lt;args.size();++i )
+    {
+        SshProcess* sproc=new SshProcess (
+            sshConnection, this );
+        sproc-&gt;startNormal ( &quot;export HOSTNAME &amp;&amp; x2goumount_session &quot;+
+                             sessionId+&quot; &quot;+args[i] );
+    }
+}
+
+void ONMainWindow::slotAboutQt()
+{
+    QMessageBox::aboutQt ( this );
+}
+
+void ONMainWindow::slotSupport()
+{
+    QFile file(supportMenuFile);
+    if (!file.open(QIODevice::ReadOnly | QIODevice::Text))
+        return;
+
+    QTextStream in(&amp;file);
+    QString sup;
+    while (!in.atEnd())
+    {
+        sup+=in.readLine();
+    }
+    QMessageBox::information (this,tr ( &quot;Support&quot; ),sup);
+}
+
+void ONMainWindow::slotAbout()
+{
+    QString aboutStr=tr (
+                         &quot;&lt;/b&gt;&lt;br&gt; (C. 2006-2012 &lt;b&gt;obviously nice&lt;/b&gt;: &quot;
+                         &quot;Oleksandr Shneyder, Heinz-Markus Graesing)&lt;br&gt;&quot; );
+    if ( embedMode )
+        aboutStr+=tr ( &quot;&lt;br&gt;x2goplugin mode was sponsored by &quot;
+                       &quot;&lt;a href=\&quot;<A HREF="http://www.foss-group.de/\">http://www.foss-group.de/\</A>&quot;&gt;&quot;
+                       &quot;FOSS-Group GmbH(Freiburg)&lt;/a&gt;&lt;br&gt;&quot; );
+    aboutStr+=
+        tr (
+            &quot;&lt;br&gt;Client for use with the X2Go network based &quot;
+            &quot;computing environment. This Client will be able &quot;
+            &quot;to connect to X2Go server(s) and start, stop, &quot;
+            &quot;resume and terminate (running) desktop sessions. &quot;
+            &quot;X2Go Client stores different server connections &quot;
+            &quot;and may automatically request authentification &quot;
+            &quot;data from LDAP directories. Furthermore it can be &quot;
+            &quot;used as fullscreen loginscreen (replacement for &quot;
+            &quot;loginmanager like xdm). Please visit x2go.org for &quot;
+            &quot;further information.&quot; );
+    QMessageBox::about (
+        this,tr ( &quot;About X2GO client&quot; ),
+        tr ( &quot;&lt;b&gt;X2Go client V. &quot; ) +VERSION+
+        &quot; &lt;/b &gt;(Qt - &quot;+qVersion() +&quot;)&quot;+
+        aboutStr );
+}
+
+
+
+void ONMainWindow::slotRereadUsers()
+{
+    if ( !useLdap )
+        return;
+#ifdef USELDAP
+
+    if ( ld )
+    {
+        delete ld;
+        ld=0;
+    }
+
+
+    if ( ! initLdapSession ( false ) )
+    {
+        return;
+    }
+
+
+    list&lt;string&gt; attr;
+    attr.push_back ( &quot;uidNumber&quot; );
+    attr.push_back ( &quot;uid&quot; );
+
+
+    list&lt;LDAPBinEntry&gt; result;
+    try
+    {
+        ld-&gt;binSearch ( ldapDn.toStdString(),attr,
+                        &quot;objectClass=posixAccount&quot;,result );
+    }
+    catch ( LDAPExeption e )
+    {
+        QString message=&quot;Exeption in: &quot;;
+        message=message+e.err_type.c_str();
+        message=message+&quot; : &quot;+e.err_str.c_str();
+        QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),message,
+                                QMessageBox::Ok,QMessageBox::NoButton );
+        QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),
+                                tr ( &quot;Please check LDAP Settings&quot; ),
+                                QMessageBox::Ok,QMessageBox::NoButton );
+        slotConfig();
+        return;
+    }
+
+    list&lt;LDAPBinEntry&gt;::iterator it=result.begin();
+    list&lt;LDAPBinEntry&gt;::iterator end=result.end();
+
+    for ( ;it!=end;++it )
+    {
+        user u;
+        QString uin=LDAPSession::getBinAttrValues (
+                        *it,&quot;uidNumber&quot; ).front().getData();
+        u.uin=uin.toUInt();
+        if ( u.uin&lt;firstUid || u.uin&gt;lastUid )
+        {
+            continue;
+        }
+        u.uid=LDAPSession::getBinAttrValues (
+                  *it,&quot;uid&quot; ).front().getData();
+        if ( !findInList ( u.uid ) )
+        {
+            reloadUsers();
+            return;
+        }
+    }
+#endif
+}
+
+void ONMainWindow::reloadUsers()
+{
+    int i;
+    for ( i=0;i&lt;names.size();++i )
+        names[i]-&gt;close();
+    for ( i=0;i&lt;sessions.size();++i )
+        sessions[i]-&gt;close();
+
+    userList.clear();
+    sessions.clear();
+
+
+    loadSettings();
+    if ( useLdap )
+    {
+        act_new-&gt;setEnabled ( false );
+        act_edit-&gt;setEnabled ( false );
+        u-&gt;setText ( tr ( &quot;Login:&quot; ) );
+        QTimer::singleShot ( 1, this, SLOT ( readUsers() ) );
+    }
+    else
+    {
+        act_new-&gt;setEnabled ( true );
+        act_edit-&gt;setEnabled ( true );
+        u-&gt;setText ( tr ( &quot;Session:&quot; ) );
+        QTimer::singleShot ( 1, this, SLOT ( slotReadSessions() ) );
+    }
+    slotResize ( fr-&gt;size() );
+}
+
+
+bool ONMainWindow::findInList ( const QString&amp; uid )
+{
+    for ( int i=0;i&lt;userList.size();++i )
+    {
+        if ( userList[i].uid==uid )
+            return true;
+    }
+    return false;
+}
+
+void ONMainWindow::setUsersEnabled ( bool enable )
+{
+
+    if ( useLdap )
+    {
+        QScrollBar* bar=users-&gt;verticalScrollBar();
+        bar-&gt;setEnabled ( enable );
+        int upos=bar-&gt;value();
+        QDesktopWidget dw;
+        int height=dw.screenGeometry ( fr ).height();
+        QList&lt;UserButton*&gt;::iterator it;
+        QList&lt;UserButton*&gt;::iterator endit=names.end();
+        if ( !enable )
+        {
+            for ( it=names.begin();it!=endit;it++ )
+            {
+                QPoint pos= ( *it )-&gt;pos();
+                if ( ( pos.y() &gt;upos-height ) &amp;&amp;
+                        ( pos.y() &lt;upos+height ) )
+                    ( *it )-&gt;setEnabled ( false );
+                if ( pos.y() &gt;upos+height )
+                    break;
+            }
+        }
+        else
+        {
+            for ( it=names.begin();it!=endit;it++ )
+            {
+                if ( ! ( *it )-&gt;isEnabled() )
+                    ( *it )-&gt;setEnabled ( true );
+            }
+        }
+    }
+    else
+        users-&gt;setEnabled ( enable );
+}
+
+
+void ONMainWindow::externalLogin ( const QString&amp; loginDir )
+{
+    QFile file ( loginDir+&quot;/username&quot; );
+    QString user;
+
+    if ( !file.open ( QIODevice::ReadOnly | QIODevice::Text ) )
+        return;
+    QTextStream in ( &amp;file );
+    while ( !in.atEnd() )
+    {
+        user=in.readLine();
+        break;
+    }
+    file.close();
+
+
+    if ( passForm-&gt;isVisible() )
+        slotClosePass();
+    uname-&gt;setText ( user );
+    slotUnameEntered();
+    currentKey=loginDir+&quot;/dsa.key&quot;;
+    extStarted=true;
+    slotPassEnter();
+}
+
+
+void ONMainWindow::externalLogout ( const QString&amp; )
+{
+    if ( extStarted )
+    {
+        extStarted=false;
+        currentKey=QString::null;
+        if ( nxproxy )
+            if ( nxproxy-&gt;state() ==QProcess::Running )
+                nxproxy-&gt;terminate();
+    }
+}
+
+
+void ONMainWindow::slotStartPGPAuth()
+{
+    scDaemon=new QProcess ( this );
+    QStringList arguments;
+    arguments&lt;&lt;&quot;--multi-server&quot;;
+    connect ( scDaemon,SIGNAL ( readyReadStandardError() ),this,
+              SLOT ( slotScDaemonError() ) );
+    connect ( scDaemon,SIGNAL ( readyReadStandardOutput() ),this,
+              SLOT ( slotScDaemonOut() ) );
+    connect ( scDaemon,SIGNAL ( finished ( int,QProcess::ExitStatus ) ),
+              this,
+              SLOT (
+                  slotScDaemonFinished ( int, QProcess::ExitStatus ) ) );
+    scDaemon-&gt;start ( &quot;scdaemon&quot;,arguments );
+    QTimer::singleShot ( 3000, this, SLOT ( slotCheckScDaemon() ) );
+    isScDaemonOk=false;
+}
+
+void ONMainWindow::slotCheckScDaemon()
+{
+    if ( !isScDaemonOk )
+    {
+        scDaemon-&gt;kill();
+    }
+}
+
+void ONMainWindow::slotScDaemonError()
+{
+    QString stdOut ( scDaemon-&gt;readAllStandardError() );
+    stdOut=stdOut.simplified();
+    x2goDebug&lt;&lt;&quot;SCDAEMON err:&quot;&lt;&lt;stdOut&lt;&lt;endl;
+    if ( stdOut.indexOf ( &quot;updating slot&quot; ) !=-1 ||
+            stdOut.indexOf ( &quot;updating status of slot&quot; ) !=-1 )
+    {
+        isScDaemonOk=true;
+        //USABLE or PRESENT
+        if ( ( stdOut.indexOf ( &quot;0x0002&quot; ) !=-1 ) ||
+                ( stdOut.indexOf ( &quot;0x0007&quot; ) !=-1 ) )
+        {
+            scDaemon-&gt;kill();
+        }
+    }
+}
+
+void ONMainWindow::slotScDaemonOut()
+{
+    QString stdOut ( scDaemon-&gt;readAllStandardOutput() );
+    stdOut=stdOut.simplified();
+    x2goDebug&lt;&lt;&quot;SCDAEMON out:&quot;&lt;&lt;stdOut&lt;&lt;endl;
+}
+
+void ONMainWindow::slotScDaemonFinished ( int , QProcess::ExitStatus )
+{
+    scDaemon=0l;
+    if ( isScDaemonOk )
+    {
+        x2goDebug&lt;&lt;&quot;scDaemon finished&quot;&lt;&lt;endl;
+        gpg=new QProcess ( this );
+        QStringList arguments;
+        arguments&lt;&lt;&quot;--card-status&quot;;
+        connect ( gpg,SIGNAL ( readyReadStandardError() ),
+                  this,SLOT ( slotGpgError() ) );
+        connect ( gpg,SIGNAL ( finished ( int,
+                                          QProcess::ExitStatus ) ),this,
+                  SLOT ( slotGpgFinished ( int,
+                                           QProcess::ExitStatus ) ) );
+        gpg-&gt;start ( &quot;gpg&quot;,arguments );
+    }
+    else
+        slotStartPGPAuth();
+}
+
+
+
+void ONMainWindow::slotGpgError()
+{
+    QString stdOut ( gpg-&gt;readAllStandardError() );
+    stdOut=stdOut.simplified();
+    x2goDebug&lt;&lt;&quot;GPG err:&quot;&lt;&lt;stdOut&lt;&lt;endl;
+    if ( stdOut.indexOf ( &quot;failed&quot; ) !=-1 )
+    {
+        QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),
+                                tr ( &quot;No valid card found&quot; ),
+                                QMessageBox::Ok,
+                                QMessageBox::NoButton );
+        gpg-&gt;kill();
+    }
+}
+
+
+void ONMainWindow::slotGpgFinished ( int exitCode,
+                                     QProcess::ExitStatus exitStatus )
+{
+    x2goDebug&lt;&lt;&quot;gpg finished, exit code:&quot;&lt;&lt;exitCode&lt;&lt;&quot; exit status:&quot;&lt;&lt;
+    exitStatus&lt;&lt;endl;
+    if ( exitStatus==0 )
+    {
+        QString stdOut ( gpg-&gt;readAllStandardOutput() );
+        stdOut.chop ( 1 );
+        x2goDebug&lt;&lt;&quot;GPG out:&quot;&lt;&lt;stdOut&lt;&lt;endl;
+        QStringList lines=stdOut.split ( &quot;\n&quot; );
+        QString login;
+        QString appId;
+        QString authKey;
+        for ( int i=0;i&lt;lines.count();++i )
+        {
+            if ( lines[i].indexOf ( &quot;Application ID&quot; ) !=-1 )
+            {
+                appId=lines[i].split ( &quot;:&quot; ) [1];
+            }
+            else if ( lines[i].indexOf ( &quot;Login data&quot; ) !=-1 )
+            {
+                login=lines[i].split ( &quot;:&quot; ) [1];
+            }
+            else if ( lines[i].indexOf (
+                          &quot;Authentication key&quot; ) !=-1 )
+            {
+                authKey=lines[i].split ( &quot;:&quot; ) [1];
+                break;
+            }
+        }
+        appId=appId.simplified();
+        login=login.simplified();
+        authKey=authKey.simplified();
+        x2goDebug&lt;&lt;&quot;card data: &quot;&lt;&lt;appId&lt;&lt;login&lt;&lt;authKey&lt;&lt;endl;
+        if ( login==&quot;[not set]&quot; || authKey == &quot;[none]&quot; )
+        {
+            x2goDebug&lt;&lt;&quot;Card not configured\n&quot;;
+            QMessageBox::critical (
+                0l,tr ( &quot;Error&quot; ),
+                tr (
+                    &quot;This card is unknown by X2Go system&quot; ),
+                QMessageBox::Ok,
+                QMessageBox::NoButton );
+            QTimer::singleShot ( 1000, this,
+                                 SLOT ( slotStartPGPAuth() ) );
+        }
+        else
+            startGPGAgent ( login,appId );
+    }
+    else
+        QTimer::singleShot ( 1000, this, SLOT ( slotStartPGPAuth() ) );
+    gpg=0l;
+}
+
+
+
+void ONMainWindow::startGPGAgent ( const QString&amp; login, const QString&amp; appId )
+{
+    QString gpgPath=homeDir +&quot;/.x2goclient/gnupg&quot;;
+    QDir d;
+    cardLogin=login;
+    d.mkpath ( gpgPath );
+    QFile file ( gpgPath+&quot;/scd-event&quot; );
+    if ( !file.open ( QIODevice::WriteOnly | QIODevice::Text ) )
+    {
+        QMessageBox::critical (
+            0l,tr ( &quot;Error&quot; ),
+            tr (
+                &quot;Unable to create file: &quot; ) +
+            gpgPath+&quot;/scd-event&quot;
+            ,QMessageBox::Ok,
+            QMessageBox::NoButton );
+        exit ( -1 );
+    }
+    QTextStream out ( &amp;file );
+    out &lt;&lt; &quot;#!/bin/bash\n\n&quot;
+    &quot;if [ \&quot;$6\&quot; != \&quot;0x0002\&quot; ] &amp;&amp; [ \&quot;$6\&quot; != &quot;
+    &quot;\&quot;0x0007\&quot; ]\n\
+	then\n\
+	kill -9 $_assuan_pipe_connect_pid\n\
+	fi&quot;&lt;&lt;endl;
+    file.close();
+    file.setPermissions ( gpgPath+&quot;/scd-event&quot;,
+                          QFile::ReadOwner|
+                          QFile::WriteOwner|
+                          QFile::ExeOwner );
+
+    gpgAgent=new QProcess ( this );
+    QStringList arguments;
+    arguments&lt;&lt;&quot;--pinentry-program&quot;&lt;&lt;&quot;/usr/bin/pinentry-x2go&quot;&lt;&lt;
+    &quot;--enable-ssh-support&quot;&lt;&lt;&quot;--daemon&quot;&lt;&lt;&quot;--no-detach&quot;;
+
+    connect ( gpgAgent,SIGNAL ( finished ( int,QProcess::ExitStatus ) ),
+              this,
+              SLOT ( slotGpgAgentFinished ( int,
+                                            QProcess::ExitStatus ) ) );
+
+    QStringList env=QProcess::systemEnvironment();
+    env&lt;&lt;&quot;GNUPGHOME=&quot;+gpgPath&lt;&lt;&quot;CARDAPPID=&quot;+appId;
+    gpgAgent-&gt;setEnvironment ( env );
+    gpgAgent-&gt;start ( &quot;gpg-agent&quot;,arguments );
+}
+
+void ONMainWindow::slotGpgAgentFinished ( int , QProcess::ExitStatus )
+{
+    QString stdOut ( gpgAgent-&gt;readAllStandardOutput() );
+    stdOut=stdOut.simplified();
+    stdOut.replace ( &quot; &quot;,&quot;&quot; );
+    QStringList envLst=stdOut.split ( &quot;;&quot; );
+    QString gpg_agent_info=envLst[0].split ( &quot;=&quot; ) [1];
+    QString ssh_auth_sock=envLst[2].split ( &quot;=&quot; ) [1];
+    agentPid=envLst[4].split ( &quot;=&quot; ) [1];
+    x2goDebug&lt;&lt;gpg_agent_info&lt;&lt;ssh_auth_sock&lt;&lt;agentPid&lt;&lt;endl;
+    x2goDebug&lt;&lt;&quot;GPGAGENT out:&quot;&lt;&lt;envLst[0]&lt;&lt;envLst[2]&lt;&lt;envLst[4]&lt;&lt;endl;
+
+    agentCheckTimer-&gt;start ( 1000 );
+    cardReady=true;
+
+    sshEnv.clear();
+    sshEnv&lt;&lt;envLst[0]&lt;&lt;envLst[2]&lt;&lt;envLst[4];
+// 	x2goDebug&lt;&lt;&quot;sshenv:&quot;&lt;&lt;sshEnv&lt;&lt;endl;
+
+    if ( !useLdap )
+    {
+        if ( passForm-&gt;isVisible() &amp;&amp; !brokerMode)
+        {
+            if ( passForm-&gt;isEnabled() )
+            {
+                if ( login-&gt;isEnabled() )
+                {
+                    login-&gt;setText ( cardLogin );
+                    slotSessEnter();
+                    return;
+                }
+            }
+        }
+        QProcess sshadd ( this ); //using it to start scdaemon
+        sshadd.setEnvironment ( sshEnv );
+        QStringList arguments;
+        arguments&lt;&lt;&quot;-l&quot;;
+        sshadd.start ( &quot;ssh-add&quot;,arguments );
+        sshadd.waitForFinished ( -1 );
+        QString sshout ( sshadd.readAllStandardOutput() );
+        sshout=sshout.simplified();
+        x2goDebug&lt;&lt;&quot;SSH-ADD out:&quot;&lt;&lt;sshout&lt;&lt;endl;
+    }
+    else
+    {
+        if ( selectSessionDlg-&gt;isVisible() ||
+                sessionStatusDlg-&gt;isVisible() )
+        {
+            QProcess sshadd ( this ); //using it to start scdaemon
+            sshadd.setEnvironment ( sshEnv );
+            QStringList arguments;
+            arguments&lt;&lt;&quot;-l&quot;;
+            sshadd.start ( &quot;ssh-add&quot;,arguments );
+            sshadd.waitForFinished ( -1 );
+            QString sshout ( sshadd.readAllStandardOutput() );
+            sshout=sshout.simplified();
+            x2goDebug&lt;&lt;&quot;SSH-ADD out:&quot;&lt;&lt;sshout&lt;&lt;endl;
+            return;
+        }
+        if ( passForm-&gt;isVisible() )
+            slotClosePass();
+        uname-&gt;setText ( cardLogin );
+        slotUnameEntered();
+        slotPassEnter();
+    }
+}
+
+
+void ONMainWindow::slotCheckAgentProcess()
+{
+    if ( checkAgentProcess() )
+        return;
+    agentCheckTimer-&gt;stop();
+    cardReady=false;
+    if ( cardStarted )
+    {
+        cardStarted=false;
+        if ( nxproxy )
+            if ( nxproxy-&gt;state() ==QProcess::Running )
+            {
+                x2goDebug&lt;&lt;&quot;Suspending session\n&quot;;
+                slotSuspendSessFromSt();
+//                 nxproxy-&gt;terminate();
+            }
+    }
+
+    x2goDebug&lt;&lt;&quot;gpg-agent finished\n&quot;;
+    slotStartPGPAuth();
+}
+
+bool ONMainWindow::checkAgentProcess()
+{
+    QFile file ( &quot;/proc/&quot;+agentPid+&quot;/cmdline&quot; );
+    if ( file.open ( QIODevice::ReadOnly | QIODevice::Text ) )
+    {
+        QString line ( file.readLine() );
+        file.close();
+        if ( line.indexOf ( &quot;gpg-agent&quot; ) !=-1 )
+        {
+            return true;
+        }
+    }
+    return false;
+}
+
+#if defined ( Q_OS_DARWIN )
+QString ONMainWindow::getXDisplay()
+{
+    QLocalSocket unixSocket (this);
+    QString xsocket (getenv (&quot;DISPLAY&quot;));
+
+    if (xsocket.isEmpty ())
+    {
+        // Mac OS X 10.4 compatibility mode.
+        // There, it is possible no $DISPLAY variable is set.
+        // Start X11 manually. First, find a free display number.
+        x2goDebug &lt;&lt; &quot;entering 10.4 compat mode, checking for free X11 display&quot;;
+
+        int xFreeDisp = 0;
+        QDir xtmpdir (&quot;/tmp/.X11-unix&quot;);
+
+        if (xtmpdir.exists ())
+        {
+            xtmpdir.setFilter (QDir::Files | QDir::System | QDir::NoSymLinks | QDir::NoDotAndDotDot);
+            xtmpdir.setSorting (QDir::Name);
+
+            QFileInfoList xtmpdirList = xtmpdir.entryInfoList ();
+            bool foundFreeDisp = FALSE;
+            xFreeDisp = -1;
+
+            for (int i = 0; (i &lt; 2000) &amp;&amp; (!foundFreeDisp); ++i)
+            {
+                QFileInfo xtmpdirFile (xtmpdir.absolutePath () + &quot;/X&quot; + QString::number (i));
+
+                if ((!xtmpdirFile.exists ()) &amp;&amp; (!xtmpdirFile.isSymLink ()))
+                {
+                    xFreeDisp = i;
+                    foundFreeDisp = TRUE;
+                }
+            }
+        }
+
+        // Control flow will go to error condition if no free display port has been found.
+        if (xFreeDisp != -1)
+        {
+            xsocket = &quot;/tmp/.X11-unix/X&quot; + QString::number (xFreeDisp);
+            x2goDebug &lt;&lt; &quot;Successfully detected free socket &quot; &lt;&lt; xsocket &lt;&lt; &quot;.&quot;;
+        }
+
+        if (!(xsocket.isEmpty ()))
+        {
+            QString xname = ConfigDialog::getXDarwinDirectory () + &quot;/Contents/MacOS/X11&quot;;
+            QString xopt = &quot;:&quot; + QString::number (xFreeDisp);
+            QProcessEnvironment env = QProcessEnvironment::systemEnvironment ();
+            QProcess* startx = new QProcess (this);
+
+            x2goDebug &lt;&lt; &quot;Starting the X server on free display port.&quot;;
+            env.insert (0, &quot;PATH=/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/usr/X11R6/bin&quot;);
+
+            startx-&gt;setProcessEnvironment (env);
+            startx-&gt;start (xname + QString (&quot; &quot;) + xopt, QIODevice::NotOpen);
+            if (startx-&gt;waitForStarted (3000))
+            {
+                x2goDebug &lt;&lt; &quot;sleeping for three seconds&quot;;
+                int sleeptime = 3;
+                while ((sleeptime = sleep (sleeptime))) {};
+
+                x2goDebug &lt;&lt; &quot;Leaving OS X 10.4 compat mode.&quot;;
+            }
+        }
+    }
+
+    // OS X &gt;= 10.5 starts the X11 server automatically, as soon as the
+    // launchd UNIX socket is accessed.
+    // On user login, the DISPLAY environment variable is set to this said existing
+    // socket.
+    // By now, we should have a socket, even on 10.4. Test, if connecting works.
+    // Note: common sense may tell you to change this if into an else. Don't.
+    // We do not want to skip this part, if coming from the compat section above.
+    if (!(xsocket.isEmpty ()))
+    {
+        if (xsocket[0] == ':')
+        {
+            // Be backwards compatible with 10.4.
+            // Delete the &quot;:&quot; character.
+            xsocket.remove (0, 1);
+            // xsocket may now contain the display value (one integer),
+            // or something like &quot;0.0&quot; - we're only interested in the
+            // display value, so keep the first char only.
+            if (xsocket.indexOf (&quot;.&quot;) != -1)
+            {
+                xsocket = xsocket.left (xsocket.indexOf (&quot;.&quot;));
+            }
+            // Prepend the well-known socket path.
+            xsocket.prepend (&quot;/tmp/.X11-unix/X&quot;);
+            x2goDebug &lt;&lt; &quot;xsocket in compat mode: &quot; &lt;&lt; xsocket;
+        }
+
+        unixSocket.connectToServer (xsocket);
+
+        if (unixSocket.waitForConnected (10000))
+        {
+            unixSocket.disconnectFromServer ();
+
+            // Mac OS X 10.4 compat: nxproxy expects
+            // a DISPLAY variable like &quot;:0&quot;, passing
+            // an UNIX socket will just make it error out.
+            // Instead of altering the nxproxy code, which does
+            // already try to connect to &quot;/tmp/.X11-unix/Xi&quot; with
+            // i = display number, pass &quot;:i&quot; as DISPLAY.
+            if (xsocket.left (16).compare (&quot;/tmp/.x11-unix/x&quot;, Qt::CaseInsensitive) == 0)
+            {
+                bool ok = FALSE;
+                int tmp = -1;
+
+                xsocket = xsocket.mid (16);
+                tmp = xsocket.toInt (&amp;ok);
+
+                if (ok)
+                {
+                    x2goDebug &lt;&lt; &quot;Returning&quot; &lt;&lt; QString (&quot;:&quot;) + xsocket;
+                    return (QString (&quot;:&quot;) + xsocket);
+                }
+            }
+            else
+            {
+              return (xsocket);
+            }
+        }
+    }
+    // And if not, error out.
+    QMessageBox::critical (
+        this,tr ( &quot;Can't connect to X server\nPlease check your settings&quot; ),
+        tr (
+            &quot;Can't start X server\nPlease check your settings&quot; ) );
+    slotConfig();
+    return QString::null;
+}
+#endif
+
+#ifdef Q_OS_WIN
+QString ONMainWindow::getXDisplay()
+{
+    if ( !isServerRunning ( 6000+xDisplay ) )
+    {
+        QMessageBox::critical (
+            this,QString::null,
+            tr (
+                &quot;Can't start X Server\nPlease check your installation&quot; )
+        );
+        close();
+    }
+    return QString::number ( xDisplay );
+
+}
+
+QString ONMainWindow::cygwinPath ( const QString&amp; winPath )
+{
+    QString cPath=&quot;/cygdrive/&quot;+winPath;
+    cPath.replace ( &quot;\\&quot;,&quot;/&quot; );
+    cPath.replace ( &quot;:&quot;,&quot;&quot; );
+    return cPath;
+}
+#endif
+
+bool ONMainWindow::isColorDepthOk ( int disp, int sess )
+{
+    if ( sess==0 )
+        return true;
+    if ( disp==sess )
+        return true;
+    if ( ( disp == 24 || disp == 32 ) &amp;&amp; ( sess == 24 || sess == 32 ) )
+        return true;
+    return false;
+}
+
+#ifndef Q_OS_LINUX
+void ONMainWindow::setWidgetStyle ( QWidget* widget )
+{
+    widget-&gt;setStyle ( widgetExtraStyle );
+}
+#else
+void ONMainWindow::setWidgetStyle ( QWidget* )
+{
+}
+#endif
+
+QString ONMainWindow::internAppName ( const QString&amp; transAppName, bool* found )
+{
+    if ( found )
+        *found=false;
+    int ind=_transApplicationsNames.indexOf ( transAppName );
+    if ( ind!=-1 )
+    {
+        if ( found )
+            *found=true;
+        return _internApplicationsNames[ind];
+    }
+    return transAppName;
+}
+
+
+QString ONMainWindow::transAppName ( const QString&amp; internAppName, bool* found )
+{
+    if ( found )
+        *found=false;
+    int ind=_internApplicationsNames.indexOf ( internAppName );
+    if ( ind!=-1 )
+    {
+        if ( found )
+            *found=true;
+        return _transApplicationsNames[ind];
+    }
+    return internAppName;
+}
+
+void ONMainWindow::addToAppNames ( QString intName, QString transName )
+{
+    _internApplicationsNames.append ( intName );
+    _transApplicationsNames.append ( transName );
+}
+
+
+void ONMainWindow::slotExecXmodmap()
+{
+#ifdef Q_WS_HILDON
+    QString passwd=getCurrentPass();
+    QString user=getCurrentUname();
+    QString host=resumingSession.server;
+    QString cmd;
+
+    cmd=&quot;(xmodmap -pke ;&quot;
+        &quot;echo keycode 73= ;&quot;
+// 	    &quot;echo clear shift ;&quot;
+// 	    &quot;echo clear lock ;&quot;
+// 	    &quot;echo clear control ;&quot;
+// 	    &quot;echo clear mod1 ;&quot;
+// 	    &quot;echo clear mod2 ;&quot;
+// 	    &quot;echo clear mod3 ;&quot;
+// 	    &quot;echo clear mod4 ;&quot;
+// 	    &quot;echo clear mod5 ;&quot;
+//  	    &quot;echo add shift = Shift_L ;&quot;
+        &quot;echo add control = Control_R &quot;
+//  	    &quot;echo add mod5 = ISO_Level3_Shift&quot;
+        &quot;)| DISPLAY=:&quot;
+        +resumingSession.display+&quot; xmodmap - &quot;;
+    x2goDebug&lt;&lt;&quot;cmd:&quot;&lt;&lt;cmd;
+    SshProcess* xmodProc;
+    try
+    {
+        xmodProc=new SshProcess ( this,user,host,sshPort,
+                                  cmd,
+                                  passwd,currentKey,acceptRsa );
+    }
+    catch ( QString message )
+    {
+        return;
+    }
+
+    if ( cardReady /*|| useSshAgent*/ )
+    {
+        QStringList env=xmodProc-&gt;environment();
+        env+=sshEnv;
+        xmodProc-&gt;setEnvironment ( env );
+    }
+    xmodProc-&gt;setFwX ( true );
+    xmodProc-&gt;startNormal();
+#endif
+}
+
+void ONMainWindow::check_cmd_status()
+{
+    QString passwd;
+    QString user=getCurrentUname();
+    QString host=resumingSession.server;
+    passwd=getCurrentPass();
+
+    x2goDebug&lt;&lt;&quot;check command message&quot;&lt;&lt;endl;
+    SshProcess* proc;
+    proc=new SshProcess ( sshConnection, this );
+    connect ( proc,SIGNAL ( sshFinished ( bool,QString,SshProcess* ) ),
+              this,SLOT ( slotCmdMessage ( bool, QString,SshProcess* ) ) );
+
+    proc-&gt;startNormal ( &quot;x2gocmdexitmessage &quot;+
+                        resumingSession.sessionId );
+}
+
+void ONMainWindow::slotCmdMessage ( bool result,QString output,
+                                    SshProcess* proc )
+{
+    if ( proc )
+        delete proc;
+    if ( result==false )
+    {
+        cardReady=false;
+        cardStarted=false;
+        QString message=tr ( &quot;&lt;b&gt;Connection failed&lt;/b&gt;\n&quot; ) +output;
+        if ( message.indexOf ( &quot;publickey,password&quot; ) !=-1 )
+        {
+            message=tr ( &quot;&lt;b&gt;Wrong password!&lt;/b&gt;&lt;br&gt;&lt;br&gt;&quot; ) +
+                    message;
+        }
+
+        QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),message,
+                                QMessageBox::Ok,
+                                QMessageBox::NoButton );
+// 		currentKey=QString::null;
+        setEnabled ( true );
+        passForm-&gt;setEnabled ( true );
+        pass-&gt;setFocus();
+        pass-&gt;selectAll();
+        sshConnection-&gt;disconnectSession();
+        return;
+    }
+    if ( output.indexOf ( &quot;X2GORUNCOMMAND ERR NOEXEC:&quot; ) !=-1 )
+    {
+        QString cmd=output;
+        cmd.replace ( &quot;X2GORUNCOMMAND ERR NOEXEC:&quot;,&quot;&quot; );
+        QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),
+                                tr ( &quot;Unable to execute: &quot; ) +
+                                cmd,QMessageBox::Ok,
+                                QMessageBox::NoButton );
+    }
+    sshConnection-&gt;disconnectSession();
+}
+
+
+int ONMainWindow::startSshFsTunnel()
+{
+    fsTunReady=false;
+    x2goDebug&lt;&lt;&quot;starting fs tunnel for:&quot;&lt;&lt;resumingSession.sessionId&lt;&lt;
+    &quot;\nfs port: &quot;&lt;&lt;resumingSession.fsPort;
+
+    if ( resumingSession.fsPort.length() &lt;=0 )
+    {
+        QString message=tr (
+                            &quot;Remote server does not &quot;
+                            &quot;support file system export &quot;
+                            &quot;through SSH Tunnel\n&quot;
+                            &quot;Please update to a newer &quot;
+                            &quot;x2goserver package&quot; );
+        slotFsTunnelFailed ( false,message,0 );
+        return 1;
+    }
+    QString passwd=getCurrentPass();
+    QString uname=getCurrentUname();
+
+    fsTunnel=new SshProcess ( sshConnection, this );
+
+    connect ( fsTunnel,SIGNAL ( sshFinished ( bool,
+                                QString,SshProcess* ) ),
+              this,SLOT ( slotFsTunnelFailed ( bool,
+                                               QString,SshProcess* ) ) );
+
+    connect ( fsTunnel,SIGNAL ( sshTunnelOk() ),
+              this,SLOT ( slotFsTunnelOk() ) );
+
+    fsTunnel-&gt;startTunnel ( &quot;localhost&quot;,resumingSession.fsPort.toUInt(),&quot;127.0.0.1&quot;,
+                            clientSshPort.toInt(), true );
+    return 0;
+}
+
+void ONMainWindow::slotFsTunnelFailed ( bool result,  QString output,
+                                        SshProcess* )
+{
+    if ( result==false )
+    {
+        if ( !managedMode )
+        {
+
+            QString message=tr ( &quot;Unable to create SSL tunnel:\n&quot; )
+                            +output;
+            QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),message,
+                                    QMessageBox::Ok,
+                                    QMessageBox::NoButton );
+        }
+        if ( fsTunnel )
+            delete fsTunnel;
+        fsTunnel=0l;
+        fsTunReady=false;
+    }
+}
+
+
+void ONMainWindow::slotFsTunnelOk()
+{
+    fsTunReady=true;
+    //start reverse mounting if RSA Key and FS tunnel are ready
+    //start only once from slotFsTunnelOk() or slotCopyKey().
+    if ( fsExportKeyReady )
+        startX2goMount();
+}
+
+
+void ONMainWindow::startX2goMount()
+{
+    QFile file ( fsExportKey+&quot;.pub&quot; );
+    if ( !file.open ( QIODevice::ReadOnly | QIODevice::Text ) )
+    {
+        QString message=tr ( &quot;Unable to read :\n&quot; ) +fsExportKey+&quot;.pub&quot;;
+        QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),message,
+                                QMessageBox::Ok,
+                                QMessageBox::NoButton );
+        QFile::remove
+        ( fsExportKey+&quot;.pub&quot; );
+        return;
+    }
+
+    QByteArray line = file.readLine();
+    file.close();
+    QString authofname=homeDir;
+#ifdef Q_OS_WIN
+    QDir tdir;
+    tdir.mkpath ( authofname+&quot;\\.x2go\\.ssh&quot; );
+    x2goDebug&lt;&lt;&quot;Creating &quot;&lt;&lt;authofname+&quot;\\.x2go\\.ssh&quot;&lt;&lt;endl;
+    authofname=wapiShortFileName ( authofname ) +&quot;/.x2go&quot;;
+#endif
+    authofname+= &quot;/.ssh/authorized_keys&quot; ;
+
+    QFile file1 ( authofname );
+
+    if ( !file1.open ( QIODevice::WriteOnly | QIODevice::Text |
+                       QIODevice::Append ) )
+    {
+        QString message=tr ( &quot;Unable to write :\n&quot; ) + authofname;
+        QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),message,
+                                QMessageBox::Ok,
+                                QMessageBox::NoButton );
+        QFile::remove
+        ( fsExportKey+&quot;.pub&quot; );
+        return;
+
+    }
+    QTextStream out ( &amp;file1 );
+    out&lt;&lt;line;
+    file1.close();
+    directory* dir=getExpDir ( fsExportKey );
+    bool rem=dir-&gt;isRemovable;
+    if ( !dir )
+        return;
+
+    QString passwd=getCurrentPass();
+    QString user=getCurrentUname();
+    QString host=resumingSession.server;
+    QString sessionId=resumingSession.sessionId;
+
+    QStringList env=QProcess::systemEnvironment();
+
+
+    QString cuser;
+#ifndef Q_WS_HILDON
+    for ( int i=0;i&lt;env.size();++i )
+    {
+        QStringList ls=env[i].split ( &quot;=&quot; );
+        if ( ls[0]==&quot;USER&quot; )
+
+        {
+            cuser=ls[1];
+            break;
+        }
+    }
+#else
+    cuser=&quot;user&quot;;
+#endif
+#ifdef Q_OS_WIN
+    cuser=&quot;sshuser&quot;;
+#endif
+    SshProcess* proc=0l;
+    QString cmd;
+    QString dirs=dir-&gt;dirList;
+
+    if ( !fsInTun &amp;&amp; clientSshPort!=&quot;22&quot; )
+    {
+        dirs=dirs+&quot;__SSH_PORT__&quot;+clientSshPort;
+    }
+    if ( fsInTun )
+    {
+        dirs=dirs+&quot;__REVERSESSH_PORT__&quot;+resumingSession.fsPort;
+    }
+    if ( !rem )
+        cmd=&quot;export HOSTNAME &amp;&amp; x2gomountdirs dir &quot;+sessionId+&quot; &quot;+cuser+
+            &quot; &quot;+dir-&gt;dstKey+&quot; &quot;+dirs;
+    else
+        cmd=&quot;export HOSTNAME &amp;&amp; x2gomountdirs rem &quot;+sessionId+&quot; &quot;+cuser+
+            &quot; &quot;+dir-&gt;dstKey+&quot; &quot;+dirs;
+
+#ifdef Q_OS_WIN
+
+    cmd=&quot;chmod 600 &quot;+dir-&gt;dstKey+&quot;&amp;&amp;&quot;+cmd;
+#endif
+
+
+
+    X2goSettings st ( &quot;sessions&quot; );
+
+    if ( !useLdap )
+    {
+        QString sid;
+        if ( !embedMode )
+            sid=lastSession-&gt;id();
+        else
+            sid=&quot;embedded&quot;;
+        if ( st.setting()-&gt;value (
+                    sid+&quot;/useiconv&quot;, ( QVariant ) false ).toBool() )
+        {
+            QString toCode=st.setting()-&gt;value (
+                               sid+&quot;/iconvto&quot;,
+                               ( QVariant ) &quot;UTF-8&quot; ).toString();
+
+#ifdef Q_OS_WIN
+            QString fromCode=st.setting()-&gt;value (
+                                 sid+&quot;/iconvfrom&quot;,
+                                 ( QVariant ) tr (
+                                     &quot;WINDOWS-1252&quot; ) ).toString();
+#endif
+#ifdef Q_OS_DARWIN
+            QString fromCode=st.setting()-&gt;value (
+                                 sid+&quot;/iconvfrom&quot;,
+                                 ( QVariant )
+                                 &quot;UTF-8&quot; ).toString();
+#endif
+#ifdef Q_OS_LINUX
+            QString fromCode=st.setting()-&gt;value (
+                                 sid+&quot;/iconvfrom&quot;,
+                                 ( QVariant ) tr (
+                                     &quot;ISO8859-1&quot; ) ).toString();
+#endif
+            cmd=&quot;export X2GO_ICONV=modules=iconv,from_code=&quot;+
+                fromCode+
+                &quot;,to_code=&quot;+toCode+&quot;&amp;&amp;&quot;+cmd;
+        }
+    }
+
+    proc=new SshProcess ( sshConnection, this );
+    dir-&gt;proc=proc;
+
+    connect ( proc,SIGNAL ( sshFinished ( bool, QString,SshProcess* ) ),
+              this,SLOT ( slotRetExportDir ( bool,
+                                             QString,SshProcess* ) ) );
+
+    proc-&gt;startNormal ( cmd );
+}
+
+void ONMainWindow::slotCheckPrintSpool()
+{
+    QDir dir ( spoolDir );
+    QStringList list = dir.entryList ( QDir::Files );
+    for ( int i=0;i&lt;list.size();++i )
+    {
+        if ( !list[i].endsWith ( &quot;.ready&quot; ) )
+            continue;
+        QFile file ( spoolDir+&quot;/&quot;+list[i] );
+        if ( !file.open ( QIODevice::ReadOnly | QIODevice::Text ) )
+            continue;
+        bool startProc=false;
+        QString fname,title;
+        if ( !file.atEnd() )
+        {
+            QByteArray line = file.readLine();
+            QString fn ( line );
+            fn.replace ( &quot;\n&quot;,&quot;&quot; );
+            fname=fn;
+            if ( !file.atEnd() )
+            {
+                line = file.readLine();
+                title=line;
+                title.replace ( &quot;\n&quot;,&quot;&quot; );
+            }
+            startProc=true;
+        }
+        file.close();
+        file.remove();
+        if ( startProc )
+            new PrintProcess ( spoolDir+&quot;/&quot;+fname,title ,this );
+
+    }
+}
+
+
+void ONMainWindow::cleanPrintSpool()
+{
+    QDir dir ( spoolDir );
+    QStringList list = dir.entryList ( QDir::Files );
+    for ( int i=0;i&lt;list.size();++i )
+    {
+        QFile::remove ( spoolDir+&quot;/&quot;+list[i] );
+    }
+}
+
+
+void ONMainWindow::cleanAskPass()
+{
+    QString path=homeDir +&quot;/.x2go/ssh/&quot;;
+    QDir dir ( path );
+    QStringList list = dir.entryList ( QDir::Files );
+    for ( int i=0;i&lt;list.size();++i )
+    {
+        if ( list[i].startsWith ( &quot;askpass&quot; ) )
+            QFile::remove ( path+list[i] );
+    }
+
+}
+
+
+#ifdef Q_OS_WIN
+#include &lt;windows.h&gt;
+#include &lt;winsock2.h&gt;
+#include &lt;ws2tcpip.h&gt;
+#endif
+
+
+bool ONMainWindow::isServerRunning ( int port )
+{
+#ifdef Q_OS_WIN
+    SOCKET ConnectSocket = INVALID_SOCKET;
+    struct sockaddr_in saServer;
+    hostent* localHost;
+    char* localIP;
+    int iResult;
+    WSADATA wsaData;
+
+    struct in_addr addr = { 0 };
+
+    iResult = WSAStartup(MAKEWORD(2, 2), &amp;wsaData);
+    if (iResult != 0)
+    {
+        x2goDebug&lt;&lt;&quot;WARNING: WSAStartup failed: &quot;&lt;&lt; iResult&lt;&lt;endl;
+        return false;
+    }
+
+    addr.s_addr = inet_addr(&quot;127.0.0.1&quot;);
+    if (addr.s_addr == INADDR_NONE)
+    {
+        x2goDebug&lt;&lt; &quot;WARNING:  The IPv4 address entered must be a legal address\n&quot;;
+        return false;
+    }
+
+
+    localHost = gethostbyaddr((char*)&amp;addr,4, AF_INET);
+    if (!localHost)
+    {
+        x2goDebug&lt;&lt;&quot;WARNING: gethostbyaddr failed: &quot;&lt;&lt;WSAGetLastError()&lt;&lt;endl;
+        return false;
+    }
+    x2goDebug&lt;&lt;&quot;got localhost&quot;&lt;&lt;endl;
+
+    localIP = inet_ntoa (*(struct in_addr *)*localHost-&gt;h_addr_list);
+
+    saServer.sin_family = AF_INET;
+    saServer.sin_addr.s_addr = inet_addr(localIP);
+    saServer.sin_port = htons(port);
+
+    ConnectSocket = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);
+    if (ConnectSocket == INVALID_SOCKET)
+    {
+        x2goDebug&lt;&lt;&quot;WARNING: socket failed with error: &quot;&lt;&lt; WSAGetLastError()&lt;&lt;endl;
+        return false;
+    }
+
+    iResult = ::connect( ConnectSocket, (SOCKADDR*) &amp;saServer, sizeof(saServer));
+    if (iResult == SOCKET_ERROR)
+    {
+        closesocket(ConnectSocket);
+        x2goDebug&lt;&lt;&quot;Port is free: &quot;&lt;&lt;port&lt;&lt;endl;
+        return false;
+    }
+    closesocket(ConnectSocket);
+    x2goDebug&lt;&lt;&quot;Port already used: &quot;&lt;&lt;port&lt;&lt;endl;
+    return true;
+#endif
+    QTcpSocket tcpSocket ( 0 );
+    tcpSocket.connectToHost ( &quot;127.0.0.1&quot;,port );
+
+    if ( tcpSocket.waitForConnected ( 1000 ) )
+    {
+        tcpSocket.close();
+        return true;
+    }
+    return false;
+}
+#ifdef Q_OS_WIN
+void ONMainWindow::slotCheckXOrgLog()
+{
+    xorgLogMutex.lock();
+    if ( xorgLogFile.length() &lt;=0 )
+    {
+        xorgLogMutex.unlock();
+        return;
+    }
+    QFile file ( xorgLogFile );
+    if ( !file.open ( QIODevice::ReadOnly | QIODevice::Text ) )
+    {
+        xorgLogMutex.unlock();
+        return;
+    }
+
+    QTextStream in ( &amp;file );
+    while ( !in.atEnd() )
+    {
+        QString line = in.readLine();
+        if ( line.indexOf ( &quot;successfully opened the display&quot; ) !=-1 )
+        {
+            xorgLogTimer-&gt;stop();
+            slotSetWinServersReady();
+            xorgLogMutex.unlock();
+            return;
+        }
+    }
+    xorgLogMutex.unlock();
+}
+
+void ONMainWindow::startXOrg ()
+{
+    while ( isServerRunning ( 6000+xDisplay ) )
+        ++xDisplay;
+    QString dispString;
+    QTextStream ( &amp;dispString ) &lt;&lt;&quot;:&quot;&lt;&lt;xDisplay;
+
+    QStringList args;
+    QString exec;
+    if (internalX==XMING)
+        exec=appDir+&quot;\\xming\\Xming.exe&quot;;
+    if (internalX==VCXSRV)
+        exec=appDir+&quot;\\vcxsrv\\vcxsrv.exe&quot;;
+    winServersReady=false;
+    x2goDebug&lt;&lt;&quot;using internal X: &quot;&lt;&lt;useInternalX;
+//#ifdef CFGCLIENT
+    if (!useInternalX || internalX!=XMING)
+    {
+        if (!useInternalX)
+            exec=xorgExe;
+        QString cmdLine;
+        if (startXorgOnStart)
+            cmdLine=xorgOptions;
+        else
+        {
+            switch (xorgMode)
+            {
+            case FS:
+                cmdLine=xorgFSOptions;
+                break;
+            case SAPP:
+                cmdLine=xorgSAppOptions;
+                break;
+            case WIN:
+                cmdLine=xorgWinOptions;
+                x2goDebug&lt;&lt;&quot;WxH:&quot;&lt;&lt;xorgWidth&lt;&lt;&quot;x&quot;&lt;&lt;xorgHeight&lt;&lt;endl;
+                cmdLine.replace(&quot;%w&quot;,xorgWidth);
+                cmdLine.replace(&quot;%h&quot;,xorgHeight);
+                x2goDebug&lt;&lt;cmdLine&lt;&lt;endl;
+                break;
+            }
+        }
+        QStringList options=cmdLine.split(&quot; &quot;,QString::SkipEmptyParts);
+        QString option;
+        foreach(option,options)
+        {
+            args&lt;&lt; option;
+        }
+        args&lt;&lt;dispString;
+    }
+//#endif
+    xorg=new QProcess ( 0 );
+    if (useInternalX &amp;&amp; (internalX==XMING))
+    {
+
+        QString workingDir=appDir+&quot;\\xming&quot;;
+        QStringList env=QProcess::systemEnvironment();
+        env&lt;&lt;&quot;GLWIN_ENABLE_DEBUG=0&quot;;
+        xorgLogMutex.lock();
+        xorgLogFile=homeDir+&quot;/.x2go/xorg&quot;;
+        QDir dr ( homeDir );
+        dr.mkpath ( xorgLogFile );
+        xorgLogFile=wapiShortFileName ( xorgLogFile ) +&quot;\\xorg.log.&quot;+
+                    QString::number ( xDisplay );
+        if ( QFile::exists ( xorgLogFile ) )
+            QFile::remove ( xorgLogFile );
+        xorgLogMutex.unlock();
+//run xming with clipboard support
+        args&lt;&lt;dispString&lt;&lt;&quot;-multiwindow&quot;&lt;&lt;&quot;-notrayicon&quot;&lt;&lt;&quot;-clipboard&quot;&lt;&lt;
+        &quot;-logfile&quot;&lt;&lt;xorgLogFile;
+        xorg-&gt;setEnvironment ( env );
+        xorg-&gt; setWorkingDirectory ( workingDir);
+    }
+
+    x2goDebug&lt;&lt;&quot;running&quot;&lt;&lt;exec&lt;&lt;&quot; &quot;&lt;&lt;args.join(&quot; &quot;);
+    xorg-&gt;start ( exec, args );
+
+
+    if ( !xorg-&gt;waitForStarted ( 3000 ) )
+    {
+        QMessageBox::critical (
+            0,QString::null,
+            tr ( &quot;Can't start X Server\n&quot;
+                 &quot;Please check your installation&quot; ) );
+        close();
+    }
+// #ifdef CFGCLIENT
+    if ( !useInternalX || internalX!= XMING)
+    {
+        //check connection in slot and launch setWinServerReady
+        waitingForX=0;
+        QTimer::singleShot(1000, this, SLOT(slotCheckXOrgConnection()));
+    }
+// #endif
+}
+
+void ONMainWindow::slotCheckXOrgConnection()
+{
+    ++waitingForX;
+    if (isServerRunning(6000+xDisplay))
+    {
+        x2goDebug&lt;&lt;&quot;X is started&quot;;
+        slotSetWinServersReady();
+    }
+    else
+    {
+        if (waitingForX &gt; 10)
+        {
+            QMessageBox::critical (
+                0,QString::null,
+                tr ( &quot;Can't start X Server\n&quot;
+                     &quot;Please check your installation&quot; ) );
+            close();
+        }
+        else
+        {
+            x2goDebug&lt;&lt;&quot;waiting for X&quot;;
+            QTimer::singleShot(1000, this, SLOT(slotCheckXOrgConnection()));
+        }
+    }
+}
+
+WinServerStarter::WinServerStarter ( daemon server, ONMainWindow * par ) :
+        QThread ( 0 )
+{
+    mode=server;
+    parent=par;
+}
+
+void WinServerStarter::run()
+{
+    switch ( mode )
+    {
+    case SSH:
+        parent-&gt;startSshd();
+        break;
+    case X:
+        parent-&gt;startXOrg();
+        break;
+    case PULSE:
+        parent-&gt;startPulsed();
+        break;
+    }
+}
+
+
+
+void ONMainWindow::startWinServers()
+{
+    x2goDebug&lt;&lt;&quot;Starting win servers&quot;&lt;&lt;endl;
+
+    QString etcDir=homeDir+&quot;/.x2go/etc&quot;;
+    QDir dr ( homeDir );
+
+    pulseServer=0l;
+
+    WinServerStarter* xStarter = new WinServerStarter ( WinServerStarter::X,
+            this );
+    WinServerStarter* sshStarter = new WinServerStarter (
+        WinServerStarter::SSH, this );
+
+    WinServerStarter* pulseStarter = new WinServerStarter (
+        WinServerStarter::PULSE, this );
+
+    if ( !embedMode || !config.confFS || ( config.confFS &amp;&amp; config.useFs ) )
+    {
+
+        dr.mkpath ( etcDir );
+        generateHostDsaKey();
+        generateEtcFiles();
+        sshStarter-&gt;start();
+    }
+    if ( !embedMode || !config.confSnd ||
+            ( config.confSnd &amp;&amp; config.useSnd ) )
+    {
+        pulseStarter-&gt;start();
+    }
+// #ifdef CFGCLIENT
+//     x2goDebug&lt;&lt;&quot;xorg settings: &quot;&lt;&lt;startXorgOnStart &lt;&lt;&quot; &quot;&lt;&lt; useXming&lt;&lt;endl;
+    if ( useInternalX &amp;&amp; (internalX== XMING))
+    {
+// #endif
+        xStarter-&gt;start();
+        xorgLogTimer=new QTimer ( this );
+        connect ( xorgLogTimer,SIGNAL ( timeout() ),this,
+                  SLOT ( slotCheckXOrgLog() ) );
+        xorgLogTimer-&gt;start ( 500 );
+// #ifdef CFGCLIENT
+    }
+    else
+    {
+        if (startXorgOnStart)
+        {
+            startXOrg();
+        }
+    }
+// #endif
+}
+
+
+bool ONMainWindow::haveCySolEntry()
+{
+    QSettings CySolSt ( &quot;HKEY_CURRENT_USER\\Software&quot;
+                        &quot;\\Cygnus Solutions&quot;,
+                        QSettings::NativeFormat );
+    return ( CySolSt.childGroups().count() &gt; 0 ||
+             CySolSt.childKeys().count() &gt; 0 );
+}
+
+bool ONMainWindow::haveCygwinEntry()
+{
+    QSettings CygwSt ( &quot;HKEY_CURRENT_USER\\Software&quot;
+                       &quot;\\Cygnus Solutions\\Cygwin&quot;,
+                       QSettings::NativeFormat );
+    return ( CygwSt.childGroups().count() &gt;0||CygwSt.childKeys().count() );
+}
+
+
+
+void ONMainWindow::saveCygnusSettings()
+{
+    if ( ONMainWindow::portable )
+    {
+        if ( haveCySolEntry() )
+        {
+            x2goDebug&lt;&lt;&quot;Cygnus Solutions entry exist&quot;;
+            cySolEntry=true;
+        }
+        else
+        {
+            cySolEntry=false;
+            x2goDebug&lt;&lt;&quot;Cygnus Solutions entry not exist&quot;;
+        }
+
+        if ( haveCygwinEntry() )
+        {
+            x2goDebug&lt;&lt;&quot;Cygwin entry exist&quot;;
+            cyEntry=true;
+        }
+        else
+        {
+            x2goDebug&lt;&lt;&quot;Cygwin entry not exist&quot;;
+            cyEntry=false;
+        }
+    }
+
+    QSettings etcst ( &quot;HKEY_CURRENT_USER\\Software&quot;
+                      &quot;\\Cygnus Solutions\\Cygwin\\mounts v2\\/etc&quot;,
+                      QSettings::NativeFormat );
+    oldEtcDir=QString::null;
+    oldEtcDir=etcst.value ( &quot;native&quot;,oldEtcDir ).toString();
+    x2goDebug&lt;&lt;&quot;old etc:&quot;&lt;&lt;oldEtcDir&lt;&lt;endl;
+    QString newEtc=homeDir+&quot;/.x2go/etc&quot;;
+    QDir d ( newEtc );
+    if ( !d.exists() )
+        d.mkpath ( newEtc );
+    newEtc.replace ( &quot;/&quot;,&quot;\\&quot; );
+
+    etcst.setValue ( &quot;native&quot;,wapiShortFileName ( newEtc ) );
+    etcst.sync();
+    x2goDebug&lt;&lt;&quot;new etc:&quot;&lt;&lt;wapiShortFileName ( newEtc ) &lt;&lt;endl;
+
+    QSettings binst ( &quot;HKEY_CURRENT_USER\\Software&quot;
+                      &quot;\\Cygnus Solutions\\Cygwin\\mounts v2\\/bin&quot;,
+                      QSettings::NativeFormat );
+    oldBinDir=QString::null;
+    oldBinDir=binst.value ( &quot;native&quot;,oldBinDir ).toString();
+    x2goDebug&lt;&lt;&quot;old bin:&quot;&lt;&lt;oldBinDir&lt;&lt;endl;
+    QString newBin=appDir;
+    newBin.replace ( &quot;/&quot;,&quot;\\&quot; );
+    binst.setValue ( &quot;native&quot;,wapiShortFileName ( newBin ) );
+    binst.sync();
+    x2goDebug&lt;&lt;&quot;new bin:&quot;&lt;&lt;newBin&lt;&lt;endl;
+
+    QSettings tmpst ( &quot;HKEY_CURRENT_USER\\Software&quot;
+                      &quot;\\Cygnus Solutions\\Cygwin\\mounts v2\\/tmp&quot;,
+                      QSettings::NativeFormat );
+    oldTmpDir=QString::null;
+    oldTmpDir=tmpst.value ( &quot;native&quot;,oldTmpDir ).toString();
+    x2goDebug&lt;&lt;&quot;old tmp:&quot;&lt;&lt;oldTmpDir&lt;&lt;endl;
+    QString newTmp=QDir::tempPath();
+    newTmp.replace ( &quot;/&quot;,&quot;\\&quot; );
+    tmpst.setValue ( &quot;native&quot;,wapiShortFileName ( newTmp ) );
+    tmpst.sync();
+    x2goDebug&lt;&lt;&quot;new tmp:&quot;&lt;&lt;newTmp&lt;&lt;endl;
+}
+
+void ONMainWindow::restoreCygnusSettings()
+{
+
+    if ( oldEtcDir==QString::null )
+    {
+        QSettings st ( &quot;HKEY_CURRENT_USER\\Software&quot;
+                       &quot;\\Cygnus Solutions\\Cygwin\\mounts v2\\/etc&quot;,
+                       QSettings::NativeFormat );
+        x2goDebug&lt;&lt;&quot;Removing /etc from cygwin mounts\n&quot;;
+        st.remove ( &quot;&quot; );
+        st.sync();
+    }
+    else
+    {
+        QSettings st ( &quot;HKEY_CURRENT_USER\\Software&quot;
+                       &quot;\\Cygnus Solutions\\Cygwin\\mounts v2\\/etc&quot;,
+                       QSettings::NativeFormat );
+        st.setValue ( &quot;native&quot;,oldEtcDir );
+        st.sync();
+        x2goDebug&lt;&lt;&quot;Restoring /etc in cygwin mounts\n&quot;;
+    }
+    if ( oldBinDir==QString::null )
+    {
+        QSettings st ( &quot;HKEY_CURRENT_USER\\Software&quot;
+                       &quot;\\Cygnus Solutions\\Cygwin\\mounts v2\\/bin&quot;,
+                       QSettings::NativeFormat );
+        x2goDebug&lt;&lt;&quot;Removing /bin from cygwin mounts\n&quot;;
+        st.remove ( &quot;&quot; );
+        st.sync();
+    }
+    else
+    {
+        QSettings st ( &quot;HKEY_CURRENT_USER\\Software&quot;
+                       &quot;\\Cygnus Solutions\\Cygwin\\mounts v2\\/bin&quot;,
+                       QSettings::NativeFormat );
+        st.setValue ( &quot;native&quot;,oldBinDir );
+        st.sync();
+        x2goDebug&lt;&lt;&quot;Restoring /bin in cygwin mounts\n&quot;;
+    }
+    if ( oldTmpDir==QString::null )
+    {
+        QSettings st ( &quot;HKEY_CURRENT_USER\\Software&quot;
+                       &quot;\\Cygnus Solutions\\Cygwin\\mounts v2\\/tmp&quot;,
+                       QSettings::NativeFormat );
+        x2goDebug&lt;&lt;&quot;Removing /tmp from cygwin mounts\n&quot;;
+        st.remove ( &quot;&quot; );
+        st.sync();
+    }
+    else
+    {
+        QSettings st ( &quot;HKEY_CURRENT_USER\\Software&quot;
+                       &quot;\\Cygnus Solutions\\Cygwin\\mounts v2\\/tmp&quot;,
+                       QSettings::NativeFormat );
+        st.setValue ( &quot;native&quot;,oldTmpDir );
+        st.sync();
+        x2goDebug&lt;&lt;&quot;Restoring /tmp in cygwin mounts\n&quot;;
+    }
+    if ( ONMainWindow::portable )
+    {
+        if ( !cyEntry )
+        {
+            removeCygwinEntry();
+        }
+        if ( !cySolEntry )
+        {
+            removeCySolEntry();
+        }
+    }
+}
+
+void ONMainWindow::removeCygwinEntry()
+{
+    QSettings st ( &quot;HKEY_CURRENT_USER\\Software&quot;
+                   &quot;\\Cygnus Solutions\\Cygwin&quot;,
+                   QSettings::NativeFormat );
+    x2goDebug&lt;&lt;&quot;Removing cygwin\n&quot;;
+    st.remove ( &quot;&quot; );
+    st.sync();
+
+}
+
+void ONMainWindow::removeCySolEntry()
+{
+    QSettings st ( &quot;HKEY_CURRENT_USER\\Software&quot;
+                   &quot;\\Cygnus Solutions&quot;,
+                   QSettings::NativeFormat );
+    x2goDebug&lt;&lt;&quot;Removing cygnus solutions\n&quot;;
+    st.remove ( &quot;&quot; );
+    st.sync();
+}
+
+void ONMainWindow::startPulsed()
+{
+    while ( isServerRunning ( pulsePort ) )
+        ++pulsePort;
+    esdPort=pulsePort+1;
+    while ( isServerRunning ( esdPort ) )
+        ++esdPort;
+
+    pulseDir=homeDir+&quot;/.x2go/pulse&quot;;
+    QDir dr ( homeDir );
+    dr.mkpath ( pulseDir );
+    pulseDir=wapiShortFileName ( pulseDir );
+    x2goDebug&lt;&lt;&quot;template: &quot;&lt;&lt;pulseDir+&quot;/tmp&quot;&lt;&lt;endl;
+    QTemporaryFile* fl=new QTemporaryFile ( pulseDir+&quot;/tmp&quot; );
+    fl-&gt;open();
+    pulseDir=fl-&gt;fileName();
+    fl-&gt;close();
+    delete fl;
+    QFile::remove ( pulseDir );
+    dr.mkpath ( pulseDir );
+    x2goDebug&lt;&lt;&quot;pulse tmp file: &quot;&lt;&lt;pulseDir&lt;&lt;endl;
+    QStringList pEnv=QProcess::systemEnvironment();
+    for ( int i=0; i&lt;pEnv.size();++i )
+    {
+        if ( pEnv[i].indexOf ( &quot;USERPROFILE=&quot; ) !=-1 )
+            pEnv[i]=&quot;USERPROFILE=&quot;+
+                    wapiShortFileName ( homeDir+&quot;/.x2go/pulse&quot; );
+        if ( pEnv[i].indexOf ( &quot;TEMP=&quot; ) !=-1 )
+            pEnv[i]=&quot;TEMP=&quot;+pulseDir;
+        if ( pEnv[i].indexOf ( &quot;USERNAME=&quot; ) !=-1 )
+            pEnv[i]=&quot;USERNAME=pulseuser&quot;;
+    }
+
+    QFile file ( pulseDir+&quot;/config.pa&quot; );
+    if ( !file.open ( QIODevice::WriteOnly | QIODevice::Text ) )
+        return;
+    QTextStream out ( &amp;file );
+    out &lt;&lt; &quot;load-module module-native-protocol-tcp port=&quot;+
+    QString::number ( pulsePort ) &lt;&lt;endl;
+    out &lt;&lt; &quot;load-module module-esound-protocol-tcp port=&quot;+
+    QString::number ( esdPort ) &lt;&lt;endl;
+    out &lt;&lt; &quot;load-module module-waveout&quot;&lt;&lt;endl;
+    file.close();
+    pulseServer=new QProcess ( 0 );
+    pulseServer-&gt;setEnvironment ( pEnv );
+    QStringList args;
+#ifdef Q_OS_WIN
+    QDir drr(homeDir+&quot;/.x2go/pulse/.pulse/&quot;+QHostInfo::localHostName ()+&quot;-runtime&quot;);
+    if (!drr.exists())
+        drr.mkpath(drr.path());
+    if (QFile::exists(homeDir+&quot;/.x2go/pulse/.pulse/&quot;+QHostInfo::localHostName ()+&quot;-runtime/pid&quot;))
+        QFile::remove(homeDir+&quot;/.x2go/pulse/.pulse/&quot;+QHostInfo::localHostName ()+&quot;-runtime/pid&quot;);
+    pulseDir.replace(&quot;/&quot;,&quot;\\&quot;);
+    args&lt;&lt;&quot;--exit-idle-time=-1&quot;&lt;&lt;&quot;-n&quot;&lt;&lt;&quot;-F&quot;&lt;&lt;pulseDir+&quot;\\config.pa&quot;;
+#else
+    args&lt;&lt;&quot;--exit-idle-time=-1&quot;&lt;&lt;&quot;-n&quot;&lt;&lt;&quot;-F&quot;&lt;&lt;pulseDir+&quot;/config.pa&quot;;
+#endif
+    pulseServer-&gt;setWorkingDirectory ( wapiShortFileName (
+                                           appDir+&quot;\\pulse&quot; ) );
+    pulseServer-&gt;start ( &quot;pulse\\pulseaudio.exe&quot;,args );
+    x2goDebug&lt;&lt;&quot;starting pulse\\pulseaudio.exe &quot;&lt;&lt;args.join ( &quot; &quot; ) &lt;&lt;
+    &quot; working dir: &quot;&lt;&lt;
+    wapiShortFileName ( appDir+&quot;\\pulse&quot; ) &lt;&lt;endl;
+}
+
+
+// #ifdef CFGCLIENT
+void ONMainWindow::xorgSettings()
+{
+    x2goDebug&lt;&lt;&quot;getting xorg settings&quot;&lt;&lt;endl;
+
+    X2goSettings st ( &quot;settings&quot; );
+
+    useInternalX=(st.setting()-&gt;value(&quot;useintx&quot;,true).toBool());
+
+    xorgExe=(st.setting()-&gt;value(&quot;xexec&quot;,&quot;C:\\program files\\vcxsrv\\vcxsrv.exe&quot;).toString());
+    xorgOptions=(st.setting()-&gt;value(&quot;options&quot;,&quot;-multiwindow -notrayicon -clipboard&quot;).toString());
+    startXorgOnStart=(st.setting()-&gt;value(&quot;onstart&quot;,true).toBool());
+    xorgWinOptions=(st.setting()-&gt;value(&quot;optionswin&quot;,&quot;-screen 0 %wx%h -notrayicon -clipboard&quot;).toString());
+    xorgFSOptions=(st.setting()-&gt;value(&quot;optionsfs&quot;,&quot;-fullscreen -notrayicon -clipboard&quot;).toString());
+    xorgSAppOptions=(st.setting()-&gt;value(&quot;optionssingle&quot;,&quot;-multiwindow -notrayicon -clipboard&quot;).toString());
+
+    if (QFile::exists(appDir+&quot;\\vcxsrv&quot;))
+        internalX=VCXSRV;
+    if (QFile::exists(appDir+&quot;\\xming&quot;))
+        internalX=XMING;
+    if (useInternalX)
+    {
+        startXorgOnStart=(internalX==XMING);
+        xorgOptions=&quot;-multiwindow -notrayicon -clipboard&quot;;
+        if (internalX==VCXSRV)
+        {
+// 	xorgWinOptions=&quot;-screen 0 %wx%h -notrayicon -clipboard&quot;;
+            xorgWinOptions=&quot;-multiwindow -notrayicon -clipboard&quot;;
+            xorgFSOptions=&quot;-fullscreen -notrayicon -clipboard&quot;;
+            xorgSAppOptions=&quot;-multiwindow -notrayicon -clipboard&quot;;
+        }
+    }
+
+}
+// #endif
+
+void ONMainWindow::slotSetWinServersReady()
+{
+    x2goDebug&lt;&lt;&quot;all winservers are started\n&quot;;
+    winServersReady=true;
+    restoreCygnusSettings();
+}
+
+#include &lt;windows.h&gt;
+#include&lt;sstream&gt;
+#endif
+
+void ONMainWindow::generateEtcFiles()
+{
+    QString etcDir=homeDir+&quot;/.x2go/etc&quot;;
+    QDir dr ( homeDir );
+    dr.mkpath ( etcDir );
+#ifdef Q_OS_WIN
+    if ( !QFile::exists ( etcDir+&quot;/passwd&quot; ) )
+    {
+        QString sid, sys, user, grsid, grname;
+        if ( !wapiAccountInfo ( &amp;sid,&amp;user,&amp;grsid, &amp;grname, &amp;sys ) )
+        {
+// 			x2goDebug&lt;&lt;&quot;Get account info failed\n&quot;;
+            close();
+        }
+
+// 		x2goDebug&lt;&lt;&quot;sid: &quot;&lt;&lt;sid &lt;&lt;&quot; system:&quot;&lt;&lt;
+// 		sys&lt;&lt; &quot; user: &quot;&lt;&lt;user&lt;&lt;&quot; group sid:&quot;&lt;&lt;grsid&lt;&lt;
+// 		&quot;group name: &quot;&lt;&lt;grname&lt;&lt;endl;
+
+        QStringList sidList=sid.split ( '-' );
+        QString rid=sidList[sidList.count()-1];
+        QStringList grsidList=grsid.split ( '-' );
+        QString grid=grsidList[grsidList.count()-1];
+        QFile file ( etcDir +&quot;/passwd&quot; );
+        if ( !file.open ( QIODevice::WriteOnly | QIODevice::Text ) )
+            return;
+        QTextStream out ( &amp;file );
+        out &lt;&lt;&quot;sshuser::&quot;&lt;&lt;rid&lt;&lt;&quot;:&quot;&lt;&lt;grid&lt;&lt;&quot;:&quot;&lt;&lt;sys&lt;&lt;&quot;\\sshuser,&quot;
+        &lt;&lt;sid&lt;&lt;&quot;:&quot;&lt;&lt;cygwinPath ( wapiShortFileName ( homeDir ) ) &lt;&lt;
+        &quot;/.x2go&quot;&lt;&lt;&quot;:/bin/bash\n&quot;;
+        file.close();
+    }
+
+    if ( !QFile::exists ( etcDir+&quot;/sshd_config&quot; ) )
+    {
+#endif
+        QFile file ( etcDir +&quot;/sshd_config&quot; );
+        if ( !file.open ( QIODevice::WriteOnly | QIODevice::Text ) )
+            return;
+        QTextStream out ( &amp;file );
+        out&lt;&lt;&quot;StrictModes no\n&quot;&lt;&lt;
+        &quot;UsePrivilegeSeparation no\n&quot;&lt;&lt;
+#ifdef Q_OS_WIN
+        &quot;Subsystem sftp /bin/sftp-server\n&quot;;
+#else
+        &quot;Subsystem sftp &quot;
+        &lt;&lt;appDir&lt;&lt;&quot;/sftp-server\n&quot;;
+#endif
+        file.close();
+        x2goDebug&lt;&lt;etcDir +&quot;/sshd_config created&quot;;
+#ifdef Q_OS_WIN
+    }
+#endif
+}
+
+void ONMainWindow::generateHostDsaKey()
+{
+    QString etcDir=homeDir+&quot;/.x2go/etc&quot;;
+    QDir dr ( homeDir );
+    dr.mkpath ( etcDir );
+    if ( !QFile::exists ( etcDir+&quot;/ssh_host_dsa_key&quot; ) ||
+            !QFile::exists ( etcDir+&quot;/ssh_host_dsa_key.pub&quot; ) )
+    {
+        /*		x2goDebug&lt;&lt;&quot;Generating host DSA key\n&quot;;*/
+#ifdef Q_OS_WIN
+        QString fname=cygwinPath ( wapiShortFileName ( etcDir ) ) +
+                      &quot;/ssh_host_dsa_key&quot;;
+#else
+        QString fname=etcDir+&quot;/ssh_host_dsa_key&quot;;
+#endif
+        QStringList args;
+        args&lt;&lt;&quot;-t&quot;&lt;&lt;&quot;dsa&quot;&lt;&lt;&quot;-N&quot;&lt;&lt;&quot;&quot;&lt;&lt;&quot;-C&quot;&lt;&lt;
+        &quot;x2goclient DSA host key&quot;&lt;&lt;&quot;-f&quot;&lt;&lt;fname;
+        QProcess::execute ( &quot;ssh-keygen&quot;,args );
+    }
+}
+
+void ONMainWindow::startSshd()
+{
+    if ( embedMode &amp;&amp; config.confFS &amp;&amp; !config.useFs )
+    {
+        return;
+    }
+#ifdef Q_OS_LINUX
+    clientSshPort=&quot;7022&quot;;
+#endif
+    QString etcDir=homeDir+&quot;/.x2go/etc&quot;;
+    int port=clientSshPort.toInt();
+    //clientSshPort have initvalue
+    while ( isServerRunning ( port ) )
+        ++port;
+    clientSshPort=QString::number ( port );
+#ifdef Q_OS_WIN
+    std::string clientdir=wapiShortFileName ( appDir ).toStdString();
+    std::stringstream strm;
+    strm&lt;&lt;clientdir&lt;&lt;&quot;\\sshd.exe -D -p&quot;&lt;&lt;clientSshPort.toInt();
+
+    STARTUPINFOA si;
+    std::string desktopName=&quot;x2go_&quot;;
+    desktopName+=getenv ( &quot;USERNAME&quot; );
+    char* desktop=new char[desktopName.size() +1];
+    strcpy ( desktop,desktopName.c_str() );
+    x2goDebug&lt;&lt;&quot;Creating desktop: &quot;&lt;&lt;desktop&lt;&lt;endl;
+    if ( !CreateDesktopA (
+                desktop,
+                0,
+                0,
+                0,
+                GENERIC_ALL,
+                0
+            ) )
+    {
+        strcpy ( desktop,&quot;&quot; );
+        x2goDebug&lt;&lt;&quot;Desktop creation failed, using default\n&quot;;
+    }
+    ZeroMemory ( &amp;si, sizeof ( si ) );
+    ZeroMemory ( &amp;sshd, sizeof ( sshd ) );
+    si.lpDesktop=desktop;
+    si.cb = sizeof ( si );
+    CreateProcessA ( NULL,  // No module name (use command line)
+                     ( LPSTR ) strm.str().c_str(),  // Command line
+                     NULL,           // Process handle not inheritable
+                     NULL,           // Thread handle not inheritable
+                     TRUE,          // Set handle inheritance to FALSE
+                     0/*CREATE_NO_WINDOW|CREATE_NEW_PROCESS_GROUP*/,
+                     //creation flags
+                     NULL,           // Use parent's environment block
+                     clientdir.c_str(), // Starting directory
+                     &amp;si,            // Pointer to STARTUPINFO structure
+                     &amp;sshd );// Pointer to PROCESS_INFORMATION structure
+    delete []desktop;
+    winSshdStarted=true;
+#else
+    userSshd=true;
+    sshd=new QProcess ( this );
+    QStringList arguments;
+    arguments&lt;&lt;&quot;-f&quot;&lt;&lt;etcDir +&quot;/sshd_config&quot;&lt;&lt; &quot;-h&quot; &lt;&lt;
+    etcDir+&quot;/ssh_host_dsa_key&quot;&lt;&lt;&quot;-D&quot;&lt;&lt;&quot;-p&quot;&lt;&lt;clientSshPort;
+    sshd-&gt;start ( appDir+&quot;/sshd&quot;,arguments );
+    x2goDebug&lt;&lt;&quot;Usermode sshd started&quot;;
+#endif
+}
+
+void ONMainWindow::setProxyWinTitle()
+{
+
+    QString title;
+
+    if (!useLdap)
+        title=lastSession-&gt;name();
+    else
+        title=getCurrentUname()+&quot;@&quot;+resumingSession.server;
+
+    QPixmap pixmap;
+
+    if (useLdap)
+        pixmap=lastUser-&gt;foto();
+    else
+        pixmap=*(lastSession-&gt;sessIcon());
+
+#ifdef Q_OS_LINUX
+
+    XStoreName(QX11Info::display(), proxyWinId, title.toLocal8Bit().data());
+
+    XWMHints* win_hints;
+
+
+    QByteArray bytes;
+    QBuffer buffer(&amp;bytes);
+    buffer.open(QIODevice::WriteOnly);
+    pixmap.save(&amp;buffer, &quot;XPM&quot;);
+
+
+    int rez;
+
+    if (image)
+        XFreePixmap(QX11Info::display(),image);
+    if (shape)
+        XFreePixmap(QX11Info::display(),shape);
+
+
+    rez=XpmCreatePixmapFromBuffer(QX11Info::display(), proxyWinId, bytes.data(),
+                                  (Pixmap *) &amp;image, (Pixmap *) &amp;shape, NULL);
+    if (!rez)
+    {
+
+        win_hints = XAllocWMHints();
+        if (win_hints)
+        {
+            win_hints-&gt;flags = IconPixmapHint|IconMaskHint;
+            win_hints-&gt;icon_pixmap = image;
+            win_hints-&gt;icon_mask = shape;
+            XSetWMHints(QX11Info::display(), proxyWinId, win_hints);
+            XFree(win_hints);
+        }
+    }
+
+#endif
+#ifdef Q_OS_WIN
+    wapiSetWindowText((HWND)proxyWinId, title);
+//       wapiSetWindowIcon((HWND)proxyWinId, pixmap);
+#endif
+}
+
+void ONMainWindow::slotSetProxyWinFullscreen()
+{
+
+#ifdef Q_OS_LINUX
+    XSync(QX11Info::display(),false);
+    XEvent event;
+    long emask = StructureNotifyMask | ResizeRedirectMask;
+    event.xclient.type = ClientMessage;
+    event.xclient.serial = 0;
+    event.xclient.send_event = True;
+    event.xclient.display = QX11Info::display();
+    event.xclient.window = proxyWinId;
+    event.xclient.message_type = XInternAtom(QX11Info::display(),&quot;_NET_WM_STATE&quot;,False);
+    event.xclient.format = 32;
+    event.xclient.data.l[0] = 1;
+    event.xclient.data.l[1] = XInternAtom(QX11Info::display(),&quot;_NET_WM_STATE_FULLSCREEN&quot;,False);
+    event.xclient.data.l[2] = 0;
+    event.xclient.data.l[3] = 0;
+    event.xclient.data.l[4] = 0;
+    Status st;
+    st=XSendEvent(QX11Info::display(), DefaultRootWindow(QX11Info::display()),
+                  False, emask,&amp;event);
+    XSync(QX11Info::display(),false);
+#endif
+#ifdef Q_OS_WIN
+    wapiSetFSWindow ( ( HWND ) proxyWinId,
+                      dispGeometry );
+
+#endif
+}
+
+
+void ONMainWindow::resizeProxyWinOnDisplay(int disp)
+{
+    QRect geom=QApplication::desktop()-&gt;screenGeometry(disp-1);
+    x2goDebug&lt;&lt;&quot;resizing proxy win to fit display &quot;&lt;&lt;disp&lt;&lt;&quot;(&quot;&lt;&lt;geom&lt;&lt;&quot;)&quot;&lt;&lt;endl;
+#ifdef Q_OS_LINUX
+    XSync(QX11Info::display(),false);
+    XMoveWindow(QX11Info::display(), proxyWinId,geom.x(),geom.y());
+#endif
+#ifdef Q_OS_WIN
+    dispGeometry=geom;
+#endif
+    QTimer::singleShot(500, this, SLOT(slotSetProxyWinFullscreen()));
+}
+
+
+QRect ONMainWindow::proxyWinGeometry()
+{
+#ifdef Q_OS_WIN
+    QRect proxyRect;
+    if (!wapiWindowRectWithoutDecoration((HWND)proxyWinId,proxyRect))
+        return QRect();
+    return proxyRect;
+#endif
+#ifdef Q_OS_LINUX
+    QRect proxyRect;
+    Window root;
+    int x,y;
+    uint w,h,border,depth;
+    if (XGetGeometry(QX11Info::display(), proxyWinId, &amp;root,&amp;x,&amp;y,&amp;w,&amp;h,&amp;border,&amp;depth))
+    {
+
+        int realx,realy;
+        Window child;
+        XTranslateCoordinates(QX11Info::display(), proxyWinId, root, 0, 0, &amp;realx, &amp;realy, &amp;child);
+        proxyRect.setRect(realx, realy, w,h);
+    }
+    return proxyRect;
+#endif
+    return QRect();
+}
+
+void ONMainWindow::slotConfigXinerama()
+{
+    QRect newGeometry=proxyWinGeometry();
+    if (newGeometry.isNull())
+    {
+//     x2goDebug&lt;&lt;&quot;error getting window geometry (window closed?)\n&quot;;
+        xineramaTimer-&gt;stop();
+        return;
+    }
+    if (newGeometry==lastDisplayGeometry)
+        return;
+    lastDisplayGeometry=newGeometry;
+    x2goDebug&lt;&lt;&quot;New proxy geometry: &quot;&lt;&lt;lastDisplayGeometry&lt;&lt;endl;
+    QDesktopWidget* root=QApplication::desktop();
+    QList&lt;QRect&gt; newXineramaScreens;
+    for (int i=0; i&lt; root-&gt;numScreens();++i)
+    {
+        QRect intersection;
+        if (resumingSession.fullscreen)
+            intersection=root-&gt;screenGeometry(i);
+        else
+            intersection=root-&gt;screenGeometry(i).intersected(lastDisplayGeometry);
+        if (!intersection.isNull())
+        {
+            x2goDebug&lt;&lt;&quot;intersected with &quot;&lt;&lt;i&lt;&lt;&quot;: &quot;&lt;&lt;intersection&lt;&lt;endl;
+            intersection.moveLeft(intersection.x()-lastDisplayGeometry.x());
+            intersection.moveTop(intersection.y()-lastDisplayGeometry.y());
+            x2goDebug&lt;&lt;&quot;xinerama screen: &quot;&lt;&lt;intersection&lt;&lt;endl;
+            newXineramaScreens&lt;&lt;intersection;
+        }
+    }
+    if (xineramaScreens != newXineramaScreens)
+    {
+        xineramaScreens=newXineramaScreens;
+        x2goDebug&lt;&lt;&quot;xinerama screen changed, new screens: &quot;&lt;&lt;xineramaScreens&lt;&lt;endl;
+        SshProcess* proc=new SshProcess(sshConnection, this);
+        xineramaTimer-&gt;stop();
+        connect (proc, SIGNAL(sshFinished(bool,QString,SshProcess*)), this, SLOT(slotXineramaConfigured()));
+        QStringList screens;
+        foreach (QRect disp, xineramaScreens)
+        screens&lt;&lt;QString::number(disp.x())+&quot; &quot;+QString::number(disp.y())+&quot; &quot;+QString::number(disp.width())+
+        &quot; &quot;+QString::number(disp.height());
+        QString cmd=&quot;export DISPLAY=:&quot;+resumingSession.display+&quot;;echo -e &quot;+screens.join(&quot;\\\\n&quot;)+&quot; &gt;  ~/.x2go/C-&quot;+
+                    resumingSession.sessionId+&quot;/xinerama.conf&quot;;
+
+        x2goDebug&lt;&lt;cmd&lt;&lt;endl;
+        proc-&gt;startNormal(cmd);
+    }
+}
+
+void ONMainWindow::slotXineramaConfigured()
+{
+    if (resumingSession.fullscreen)
+        return;
+    if (xinSizeInc == -1)
+        xinSizeInc=1;
+    else
+        xinSizeInc=-1;
+#ifdef Q_OS_LINUX
+    lastDisplayGeometry.setWidth(lastDisplayGeometry.width()+xinSizeInc);
+    XSync(QX11Info::display(),false);
+    XResizeWindow(QX11Info::display(), proxyWinId,
+                  lastDisplayGeometry.width(),lastDisplayGeometry.height());
+    XSync(QX11Info::display(),false);
+#endif
+#ifdef Q_OS_WIN
+    QRect geom;
+    wapiWindowRect ( (HWND) proxyWinId, geom );
+    wapiMoveWindow( (HWND) proxyWinId, geom.x(), geom.y(), geom.width()+xinSizeInc, geom.height(),true);
+    lastDisplayGeometry=proxyWinGeometry();
+#endif
+    xineramaTimer-&gt;start(500);
+}
+
+void ONMainWindow::slotFindProxyWin()
+{
+#ifndef Q_OS_DARWIN
+    x2goDebug&lt;&lt;&quot;search proxy win: &quot;&lt;&lt;&quot;X2GO-&quot;+resumingSession.sessionId;
+    proxyWinId=findWindow ( &quot;X2GO-&quot;+resumingSession.sessionId );
+    bool xinerama=defaultXinerama;
+    if ( proxyWinId )
+    {
+        x2goDebug&lt;&lt;&quot;proxy win found:&quot;&lt;&lt;proxyWinId;
+        setProxyWinTitle();
+        proxyWinTimer-&gt;stop();
+        if (!useLdap)
+        {
+            X2goSettings *st;
+            QString sid;
+            if ( !embedMode )
+                sid=lastSession-&gt;id();
+            else
+                sid=&quot;embedded&quot;;
+
+            if (brokerMode)
+                st=new X2goSettings(config.iniFile,QSettings::IniFormat);
+            else
+                st= new X2goSettings( &quot;sessions&quot; );
+            uint displays=QApplication::desktop()-&gt;numScreens();
+            xinerama=st-&gt;setting()-&gt;value ( sid+&quot;/xinerama&quot;,
+                                            ( QVariant ) defaultXinerama ).toBool();
+            if (st-&gt;setting()-&gt;value ( sid+&quot;/multidisp&quot;,
+                                       ( QVariant ) false ).toBool())
+            {
+                uint disp=st-&gt;setting()-&gt;value ( sid+&quot;/display&quot;,
+                                                 ( QVariant ) 1 ).toUInt();
+                if (disp&gt;displays)
+                {
+                    disp=1;
+                }
+                resizeProxyWinOnDisplay(disp);
+                return;
+            }
+        }
+        if (xinerama)
+        {
+            x2goDebug&lt;&lt;&quot;Starting xinerama timer\n&quot;;
+            lastDisplayGeometry=QRect();
+            xineramaScreens.clear();
+            xineramaTimer-&gt;start(500);
+        }
+
+        if ( embedMode )
+        {
+            if ( config.rootless )
+            {
+                x2goDebug&lt;&lt;&quot;win is rootless&quot;;
+                act_embedContol-&gt;setEnabled ( false );
+            }
+            else
+                slotAttachProxyWindow();
+        }
+#ifdef Q_OS_WIN
+        x2goDebug&lt;&lt;&quot;maximizeProxyWin: &quot;&lt;&lt;maximizeProxyWin;
+        if ( !startEmbedded )
+        {
+            if ( maximizeProxyWin )
+            {
+                QDesktopWidget dw;
+                x2goDebug&lt;&lt;&quot;making proxy win full screen&quot;;
+                wapiSetFSWindow ( ( HWND ) proxyWinId,
+                                  dw.screenGeometry ( this ) );
+                /*wapiShowWindow ( ( HWND ) proxyWinId,
+                   WAPI_SHOWMAXIMIZED );*/
+            }
+            else
+            {
+                wapiMoveWindow ( ( HWND ) proxyWinId,0,0,
+                                 proxyWinWidth,
+                                 proxyWinHeight,true );
+            }
+        }
+#endif
+    }
+#endif
+}
+
+
+QString ONMainWindow::getCurrentUname()
+{
+    return login-&gt;text();
+}
+
+QString ONMainWindow::getCurrentPass()
+{
+    return pass-&gt;text();
+}
+
+void ONMainWindow::slotDetachProxyWindow()
+{
+    proxyWinEmbedded=false;
+    bgFrame-&gt;show();
+    setStatStatus();
+    act_embedContol-&gt;setText ( tr ( &quot;Attach X2Go window&quot; ) );
+    act_embedContol-&gt;setIcon ( QIcon ( &quot;:icons/32x32/attach.png&quot; ) );
+#ifdef Q_OS_LINUX
+    //if QX11EmbedContainer cannot embed window, check if window exists
+    //and reconnect
+    if ( !embedControlChanged )
+    {
+        x2goDebug&lt;&lt;&quot;\n&quot;;
+        slotFindProxyWin();
+        x2goDebug&lt;&lt;&quot;proxy win detached, proxywin is:&quot;&lt;&lt;proxyWinId&lt;&lt;endl;
+    }
+#endif
+    embedControlChanged=false;
+}
+
+
+void ONMainWindow::slotAttachProxyWindow()
+{
+    x2goDebug&lt;&lt;&quot;slotAttachProxy&quot;;
+    if ( startEmbedded )
+    {
+        embedControlChanged=false;
+        bgFrame-&gt;hide();
+        proxyWinEmbedded=true;
+        setStatStatus();
+        act_embedContol-&gt;setText ( tr ( &quot;Detach X2Go window&quot; ) );
+        act_embedContol-&gt;setIcon (
+            QIcon ( &quot;:icons/32x32/detach.png&quot; ) );
+        QTimer::singleShot ( 100, this, SLOT ( slotEmbedWindow() ) );
+    }
+    else
+    {
+        x2goDebug&lt;&lt;&quot;start embedded was false&quot;;
+        startEmbedded=true;
+    }
+
+}
+
+void ONMainWindow::slotEmbedWindow()
+{
+#ifndef Q_OS_DARWIN
+#ifdef CFGPLUGIN
+    embedWindow ( proxyWinId );
+#endif
+    QTimer::singleShot ( 1000, this,
+                         SLOT ( slotActivateWindow() ) );
+
+#endif
+}
+
+void ONMainWindow::setEmbedSessionActionsEnabled ( bool enable )
+{
+    act_shareFolder-&gt;setEnabled ( enable );
+    act_suspend-&gt;setEnabled ( enable );
+    act_terminate-&gt;setEnabled ( enable );
+    act_embedContol-&gt;setEnabled ( enable );
+    act_reconnect-&gt;setEnabled ( !enable );
+}
+
+void ONMainWindow::slotEmbedControlAction()
+{
+#ifndef Q_OS_DARWIN
+    embedControlChanged=true;
+    if ( proxyWinEmbedded )
+    {
+#ifdef CFGPLUGIN
+        detachClient();
+#endif
+    }
+    else
+        slotAttachProxyWindow();
+#endif
+}
+
+void ONMainWindow::slotEmbedIntoParentWindow()
+{
+#ifndef Q_OS_DARWIN
+// 	embedInto ( embedParent );
+#endif
+}
+
+
+void ONMainWindow::processSessionConfig()
+{
+    sshProxy.use=false;
+    bool haveKey=false;
+
+    config.command=&quot;KDE&quot;;
+    config.sshport=&quot;22&quot;;
+    config.session=tr ( &quot;X2Go Session&quot; );
+    config.checkexitstatus=true;
+    config.showtermbutton=true;
+    config.showexpbutton=true;
+    config.showconfig=true;
+    config.showextconfig=true;
+    config.showtoolbar=true;
+    config.showstatusbar=true;
+    config.kbdType=getDefaultKbdType();
+    config.kbdLay=getDefaultLayout()[0];
+
+
+    config.confSnd=false;
+    config.confFS=false;
+    config.confConSpd=false;
+    config.confCompMet=false;
+    config.confImageQ=false;
+    config.confDPI=false;
+    config.confKbd=false;
+
+    QStringList lines=m_x2goconfig.split ( &quot;\n&quot; );
+
+
+    for ( int i=0;i&lt;lines.count();++i )
+    {
+        QString line = lines[i];
+        if ( ( line==&quot;-----BEGIN DSA PRIVATE KEY-----&quot; ) ||
+                ( line==&quot;-----BEGIN RSA PRIVATE KEY-----&quot; ) )
+        {
+            while ( i&lt;lines.count() )
+                config.key+=lines[i++] +&quot;\n&quot;;
+            haveKey=true;
+        }
+        else
+            processCfgLine ( line );
+    }
+    act_terminate-&gt;setVisible ( config.showtermbutton );
+    act_shareFolder-&gt;setVisible ( config.showexpbutton );
+    act_set-&gt;setVisible ( config.showconfig );
+    if (!config.showstatusbar)
+    {
+        statusBar()-&gt;hide();
+    }
+    if ( managedMode )
+    {
+        QTimer::singleShot ( 500, this, SLOT ( slotStartBroker() ) );
+        return;
+    }
+    slotSelectedFromList ( ( SessionButton* ) 0 );
+}
+
+
+void ONMainWindow::processCfgLine ( QString line )
+{
+    QStringList lst=line.split ( &quot;=&quot; );
+    if ( lst[0]==&quot;command&quot; )
+    {
+        config.command=lst[1];
+        return;
+    }
+    if ( lst[0]==&quot;server&quot; )
+    {
+        config.server=lst[1];
+        return;
+    }
+    if ( lst[0]==&quot;session&quot; )
+    {
+        config.session=lst[1];
+        return;
+    }
+    if ( lst[0]==&quot;sshport&quot; )
+    {
+        config.sshport=lst[1];
+        return;
+    }
+    if ( lst[0]==&quot;user&quot; )
+    {
+        config.user=lst[1];
+        return;
+    }
+    if ( lst[0]==&quot;rootless&quot; )
+    {
+        if ( lst[1]==&quot;true&quot; )
+            config.rootless=true;
+        else
+            config.rootless=false;
+        return;
+    }
+    if ( lst[0]==&quot;checkexitstatus&quot; )
+    {
+        if ( lst[1]==&quot;true&quot; )
+            config.checkexitstatus=true;
+        else
+            config.checkexitstatus=false;
+        return;
+    }
+    if ( lst[0]==&quot;showtermbutton&quot; )
+    {
+        if ( lst[1]==&quot;true&quot; )
+            config.showtermbutton=true;
+        else
+            config.showtermbutton=false;
+        return;
+    }
+    if ( lst[0]==&quot;showexpbutton&quot; )
+    {
+        if ( lst[1]==&quot;true&quot; )
+            config.showexpbutton=true;
+        else
+            config.showexpbutton=false;
+        return;
+    }
+    if ( lst[0]==&quot;showconfig&quot; )
+    {
+        if ( lst[1]==&quot;true&quot; )
+            config.showconfig=true;
+        else
+            config.showconfig=false;
+        return;
+    }
+    if ( lst[0]==&quot;showextconfig&quot; )
+    {
+        if ( lst[1]==&quot;true&quot; )
+            config.showextconfig=true;
+        else
+            config.showextconfig=false;
+        return;
+    }
+    if ( lst[0]==&quot;showstatusbar&quot; )
+    {
+        if ( lst[1]==&quot;true&quot; )
+            config.showstatusbar=true;
+        else
+            config.showstatusbar=false;
+        return;
+    }
+    if ( lst[0]==&quot;showtoolbar&quot; )
+    {
+        if ( lst[1]==&quot;true&quot; )
+            config.showtoolbar=true;
+        else
+            config.showtoolbar=false;
+        return;
+    }
+
+    if ( lst[0]==&quot;sound&quot; )
+    {
+        config.confSnd=true;
+        if ( lst[1]==&quot;true&quot; )
+            config.useSnd=true;
+        else
+            config.useSnd=false;
+        return;
+    }
+    if ( lst[0]==&quot;exportfs&quot; )
+    {
+        config.confFS=true;
+        if ( lst[1]==&quot;true&quot; )
+            config.useFs=true;
+        else
+            config.useFs=false;
+        return;
+    }
+
+    if ( lst[0]==&quot;speed&quot; )
+    {
+        config.confConSpd=true;
+        config.conSpeed=ADSL;
+
+        if ( lst[1]==&quot;modem&quot; )
+            config.conSpeed=MODEM;
+        else if ( lst[1]==&quot;isdn&quot; )
+            config.conSpeed=ISDN;
+        else if ( lst[1]==&quot;adsl&quot; )
+            config.conSpeed=ADSL;
+        else if ( lst[1]==&quot;wan&quot; )
+            config.conSpeed=WAN;
+        else if ( lst[1]==&quot;lan&quot; )
+            config.conSpeed=LAN;
+        else
+        {
+            qCritical (
+                &quot;%s&quot;,tr (
+                    &quot;wrong value for argument\&quot;speed\&quot;&quot;
+                ).toLocal8Bit().data() );
+        }
+        return;
+    }
+    if ( lst[0]==&quot;compression&quot; )
+    {
+        config.confCompMet=true;
+        config.compMet=lst[1];
+        return;
+    }
+    if ( lst[0]==&quot;quality&quot; )
+    {
+        config.confImageQ=true;
+        config.imageQ=lst[1].toInt();
+        return;
+    }
+    if ( lst[0]==&quot;dpi&quot; )
+    {
+        config.confDPI=true;
+        config.dpi=lst[1].toInt();
+        return;
+    }
+    if ( lst[0]==&quot;kbdlayout&quot; )
+    {
+        config.confKbd=true;
+        config.kbdLay=lst[1];
+        return;
+    }
+    if ( lst[0]==&quot;kbdtype&quot; )
+    {
+        config.confKbd=true;
+        config.kbdType=lst[1];
+        return;
+    }
+    if ( lst[0]==&quot;brokerurl&quot; )
+    {
+        config.brokerurl=lst[1];
+        managedMode=true;
+        acceptRsa=true;
+    }
+    if ( lst[0]==&quot;proxy&quot; )
+    {
+        config.proxy=sshProxy.host=lst[1];
+        sshProxy.use=true;
+#ifdef Q_OS_WIN
+        sshProxy.bin=cygwinPath ( wapiShortFileName ( appDir ) ) +&quot;/ssh&quot;;
+#else
+        sshProxy.bin=&quot;ssh&quot;;
+#endif
+        return;
+    }
+    if ( lst[0]==&quot;proxysshport&quot; )
+    {
+        config.proxyport=sshProxy.port=lst[1];
+        return;
+    }
+    if ( lst[0]==&quot;cookie&quot; )
+    {
+        config.cookie=lst[1];
+        return;
+    }
+    if ( lst[0]==&quot;x2gosession&quot; )
+    {
+        config.sessiondata=lst[1];
+        return;
+    }
+    if ( lst[0]==&quot;connectionts&quot; )
+    {
+        config.connectionts=lst[1];
+        return;
+    }
+}
+
+void ONMainWindow::slotChangeKbdLayout(const QString&amp; layout)
+{
+#ifdef Q_OS_LINUX
+    QStringList args;
+    args&lt;&lt;&quot;-layout&quot;&lt;&lt;layout;
+    x2goDebug&lt;&lt;&quot;running setxkbmap with params: &quot;&lt;&lt;args.join(&quot; &quot;);
+    QProcess::startDetached(&quot;setxkbmap&quot;,args);
+#endif
+}
+
+void ONMainWindow::initPassDlg()
+{
+    passForm = new SVGFrame ( &quot;:/svg/passform.svg&quot;,
+                              false,bgFrame );
+#ifdef Q_OS_WIN
+    passForm-&gt;setMainWidget ( ( QWidget* ) this );
+#endif
+    username-&gt;addWidget ( passForm );
+    passForm-&gt;hide();
+    setWidgetStyle ( passForm );
+    if ( !miniMode )
+        passForm-&gt;setFixedSize ( passForm-&gt;sizeHint() );
+    else
+        passForm-&gt;setFixedSize ( 310,180 );
+    QPalette pal=passForm-&gt;palette();
+    pal.setBrush ( QPalette::Window, QColor ( 255,255,255,0 ) );
+    pal.setColor ( QPalette::Active, QPalette::WindowText, QPalette::Mid );
+    pal.setColor ( QPalette::Active, QPalette::ButtonText, QPalette::Mid );
+    pal.setColor ( QPalette::Active, QPalette::Text, QPalette::Mid );
+    pal.setColor ( QPalette::Inactive, QPalette::WindowText, QPalette::Mid );
+    pal.setColor ( QPalette::Inactive, QPalette::ButtonText, QPalette::Mid );
+    pal.setColor ( QPalette::Inactive, QPalette::Text, QPalette::Mid );
+    passForm-&gt;setPalette ( pal );
+
+    pal.setColor ( QPalette::Button, QColor ( 255,255,255,0 ) );
+    pal.setColor ( QPalette::Window, QColor ( 255,255,255,255 ) );
+    pal.setColor ( QPalette::Base, QColor ( 255,255,255,255 ) );
+
+
+    QFont fnt=passForm-&gt;font();
+    if ( miniMode )
+#ifdef Q_WS_HILDON
+        fnt.setPointSize ( 10 );
+#else
+        fnt.setPointSize ( 9 );
+#endif
+    passForm-&gt;setFont ( fnt );
+
+    fotoLabel=new QLabel ( passForm );
+    fotoLabel-&gt;hide();
+
+    nameLabel=new QLabel ( &quot;&quot;,passForm );
+    nameLabel-&gt;hide();
+
+    loginPrompt=new QLabel ( tr ( &quot;Login:&quot; ),passForm );
+    passPrompt=new QLabel ( tr ( &quot;Password:&quot; ),passForm );
+    layoutPrompt=new QLabel ( tr ( &quot;Keyboard layout:&quot; ),passForm );
+
+    login=new ClickLineEdit ( passForm );
+    setWidgetStyle ( login );
+    login-&gt;setFrame ( false );
+    login-&gt;setEnabled ( false );
+
+    login-&gt;hide();
+    loginPrompt-&gt;hide();
+
+    pass=new ClickLineEdit ( passForm );
+    setWidgetStyle ( pass );
+    pass-&gt;setFrame ( false );
+    fnt.setBold ( true );
+    pass-&gt;setFont ( fnt );
+    pass-&gt;setEchoMode ( QLineEdit::Password );
+    pass-&gt;setFocus();
+
+#ifdef Q_OS_LINUX
+    connect ( login,SIGNAL ( clicked() ),this,
+              SLOT ( slotActivateWindow() ) );
+    connect ( pass,SIGNAL ( clicked() ),this,
+              SLOT ( slotActivateWindow() ) );
+#endif
+
+    pass-&gt;hide();
+    passPrompt-&gt;hide();
+
+
+    cbLayout=new QComboBox(passForm);
+    cbLayout-&gt;addItems(defaultLayout);
+    cbLayout-&gt;setFocusPolicy(Qt::NoFocus);
+    cbLayout-&gt;setFrame(false);
+    setWidgetStyle(cbLayout);
+    cbLayout-&gt;hide();
+    layoutPrompt-&gt;hide();
+    QHBoxLayout* cbLayoutLay=new QHBoxLayout();
+    cbLayoutLay-&gt;addWidget(cbLayout);
+    cbLayoutLay-&gt;addStretch();
+
+
+    ok=new QPushButton ( tr ( &quot;Ok&quot; ),passForm );
+    setWidgetStyle ( ok );
+    cancel=new QPushButton ( tr ( &quot;Cancel&quot; ),passForm );
+    setWidgetStyle ( cancel );
+    ok-&gt;hide();
+    cancel-&gt;hide();
+
+
+
+    cbLayout-&gt;setPalette ( pal );
+    ok-&gt;setPalette ( pal );
+    cancel-&gt;setPalette ( pal );
+
+
+
+#ifndef Q_WS_HILDON
+    ok-&gt;setFixedSize ( ok-&gt;sizeHint() );
+    cancel-&gt;setFixedSize ( cancel-&gt;sizeHint() );
+#else
+    QSize sz=cancel-&gt;sizeHint();
+    sz.setWidth ( ( int ) ( sz.width() /1.5 ) );
+    sz.setHeight ( ( int ) ( sz.height() /1.5 ) );
+    cancel-&gt;setFixedSize ( sz );
+    sz=ok-&gt;sizeHint();
+    sz.setWidth ( ( int ) ( sz.width() /1.5 ) );
+    sz.setHeight ( ( int ) ( sz.height() /1.5 ) );
+    ok-&gt;setFixedSize ( sz );
+#endif
+
+    QVBoxLayout *layout=new QVBoxLayout ( passForm );
+    QHBoxLayout *labelLay=new QHBoxLayout();
+    QHBoxLayout *inputLay=new QHBoxLayout();
+    QHBoxLayout *buttonLay=new QHBoxLayout();
+
+    labelLay-&gt;setSpacing ( 20 );
+    inputLay-&gt;setSpacing ( 10 );
+    layout-&gt;setContentsMargins ( 20,20,10,10 );
+    layout-&gt;addLayout ( labelLay );
+    layout-&gt;addStretch();
+    layout-&gt;addLayout ( inputLay );
+    layout-&gt;addStretch();
+    layout-&gt;addLayout ( buttonLay );
+
+    labelLay-&gt;addWidget ( fotoLabel );
+    labelLay-&gt;addWidget ( nameLabel );
+    labelLay-&gt;addStretch();
+
+    QVBoxLayout* il1=new QVBoxLayout();
+    il1-&gt;addWidget ( loginPrompt );
+    il1-&gt;addWidget ( passPrompt );
+    il1-&gt;addWidget ( layoutPrompt );
+
+    QVBoxLayout* il2=new QVBoxLayout();
+    il2-&gt;addWidget ( login );
+    il2-&gt;addWidget ( pass );
+    il2-&gt;addLayout ( cbLayoutLay );
+    inputLay-&gt;addLayout ( il1 );
+    inputLay-&gt;addLayout ( il2 );
+    inputLay-&gt;addStretch();
+
+    buttonLay-&gt;addStretch();
+    buttonLay-&gt;addWidget ( ok );
+    buttonLay-&gt;addWidget ( cancel );
+    buttonLay-&gt;addStretch();
+
+    pal.setColor ( QPalette::Base, QColor ( 239,239,239,255 ) );
+    login-&gt;setPalette ( pal );
+    pass-&gt;setPalette ( pal );
+
+    connect ( ok,SIGNAL ( clicked() ),this, SLOT ( slotSessEnter() ) );
+    connect ( cancel,SIGNAL ( clicked() ),this, SLOT ( slotClosePass() ) );
+    connect ( pass,SIGNAL ( returnPressed() ),this,
+              SLOT ( slotSessEnter() ) );
+    connect ( login,SIGNAL ( returnPressed() ),pass, SLOT ( selectAll() ) );
+    connect ( login,SIGNAL ( returnPressed() ),pass, SLOT ( setFocus() ) );
+
+    passPrompt-&gt;show();
+    pass-&gt;show();
+    ok-&gt;show();
+    cancel-&gt;show();
+    fotoLabel-&gt;show();
+    nameLabel-&gt;show();
+    if ( !useLdap )
+    {
+        login-&gt;show();
+        loginPrompt-&gt;show();
+    }
+    if ( embedMode )
+    {
+        cancel-&gt;setEnabled ( false );
+#ifdef Q_OS_WIN
+        QRect r;
+        wapiWindowRect ( ok-&gt;winId(),r );
+#endif
+    }
+    if (defaultLayout.size()&gt;1)
+    {
+        layoutPrompt-&gt;show();
+        cbLayout-&gt;show();
+        slotChangeKbdLayout(cbLayout-&gt;currentText());
+        connect (cbLayout,SIGNAL(currentIndexChanged(QString)),this,SLOT(slotChangeKbdLayout(QString)));
+    }
+}
+
+
+void ONMainWindow::initStatusDlg()
+{
+    sessionStatusDlg = new SVGFrame ( &quot;:/svg/passform.svg&quot;,
+                                      false,bgFrame );
+    sessionStatusDlg-&gt;hide();
+    if ( !miniMode )
+        sessionStatusDlg-&gt;setFixedSize (
+            sessionStatusDlg-&gt;sizeHint() );
+    else
+        sessionStatusDlg-&gt;setFixedSize ( 310,200 );
+    QFont fnt=sessionStatusDlg-&gt;font();
+    if ( miniMode )
+#ifdef Q_WS_HILDON
+        fnt.setPointSize ( 10 );
+#else
+        fnt.setPointSize ( 9 );
+#endif
+    sessionStatusDlg-&gt;setFont ( fnt );
+    username-&gt;addWidget ( sessionStatusDlg );
+    QPalette pal=sessionStatusDlg-&gt;palette();
+    pal.setBrush ( QPalette::Window, QColor ( 0,0,0,0 ) );
+    pal.setColor ( QPalette::Active, QPalette::WindowText, QPalette::Mid );
+    pal.setColor ( QPalette::Active, QPalette::ButtonText, QPalette::Mid );
+    pal.setColor ( QPalette::Active, QPalette::Text, QPalette::Mid );
+    pal.setColor ( QPalette::Inactive, QPalette::WindowText, QPalette::Mid );
+    pal.setColor ( QPalette::Inactive, QPalette::ButtonText, QPalette::Mid );
+    pal.setColor ( QPalette::Inactive, QPalette::Text, QPalette::Mid );
+
+    sessionStatusDlg-&gt;setPalette ( pal );
+
+    slName=new QLabel ( sessionStatusDlg );
+    slVal=new QLabel ( sessionStatusDlg );
+
+    slName-&gt;setText (
+        tr (
+            &quot;&lt;b&gt;Session ID:&lt;br&gt;Server:&lt;br&gt;Username:&quot;
+            &quot;&lt;br&gt;Display:&lt;br&gt;Creation time:&lt;br&gt;Status:&lt;/b&gt;&quot; ) );
+    slName-&gt;setFixedSize ( slName-&gt;sizeHint() );
+    slName-&gt;hide();
+
+    slVal-&gt;hide();
+    slVal-&gt;setFixedHeight ( slName-&gt;sizeHint().height() );
+
+    sbApps=new QToolButton (sessionStatusDlg );
+    sbApps-&gt;setToolTip(tr ( &quot;Applications...&quot; ));
+    sbApps-&gt;setIcon(QPixmap(&quot;:/icons/32x32/apps.png&quot;));
+    sbApps-&gt;setAutoRaise(true);
+    sbApps-&gt;setFocusPolicy(Qt::NoFocus);
+
+    sbExp=new QToolButton (sessionStatusDlg );
+    sbExp-&gt;setIcon(QPixmap(&quot;:/icons/32x32/open_dir.png&quot;));
+    sbExp-&gt;setToolTip (tr (&quot;Share folder...&quot; ));
+    sbExp-&gt;setAutoRaise(true);
+    sbExp-&gt;setFocusPolicy(Qt::NoFocus);
+
+    sbSusp=new QToolButton (sessionStatusDlg );
+    sbSusp-&gt;setIcon(QPixmap(&quot;:/icons/32x32/suspend_session.png&quot;));
+    sbSusp-&gt;setToolTip(tr ( &quot;Abort&quot; ));
+    sbSusp-&gt;setAutoRaise(true);
+    sbSusp-&gt;setFocusPolicy(Qt::NoFocus);
+
+
+    sbTerm=new QToolButton (sessionStatusDlg );
+    sbTerm-&gt;setIcon(QPixmap(&quot;:/icons/32x32/stop_session.png&quot;));
+    sbTerm-&gt;setToolTip(tr ( &quot;Terminate&quot; ));
+    sbTerm-&gt;setAutoRaise(true);
+    sbTerm-&gt;setFocusPolicy(Qt::NoFocus);
+
+
+    sbAdv=new QCheckBox ( tr ( &quot;Show details&quot; ),sessionStatusDlg );
+    setWidgetStyle ( sbTerm );
+    setWidgetStyle ( sbApps );
+    setWidgetStyle ( sbExp );
+    setWidgetStyle ( sbSusp );
+    setWidgetStyle ( sbAdv );
+
+    sbAdv-&gt;setFixedSize ( sbAdv-&gt;sizeHint() );
+    sbApps-&gt;setFixedSize ( 32,32 );
+    sbSusp-&gt;setFixedSize ( 32,32 );
+    sbTerm-&gt;setFixedSize ( 32,32 );
+    sbExp-&gt;setFixedSize ( 32,32 );
+
+    /*
+        sbApps-&gt;setFocusPolicy(Qt::NoFocus);
+        sbSusp-&gt;setFocusPolicy(Qt::NoFocus);
+        sbTerm-&gt;setFocusPolicy(Qt::NoFocus);
+        sbExp-&gt;setFocusPolicy(Qt::NoFocus);*/
+
+    sbAdv-&gt;hide();
+    sbSusp-&gt;hide();
+    sbTerm-&gt;hide();
+    sbExp-&gt;hide();
+    sbApps-&gt;hide();
+
+
+    pal.setColor ( QPalette::Button, QColor ( 255,255,255,0 ) );
+    pal.setColor ( QPalette::Window, QColor ( 255,255,255,255 ) );
+    pal.setColor ( QPalette::Base, QColor ( 255,255,255,255 ) );
+
+    sbAdv-&gt;setPalette ( pal );
+    sbApps-&gt;setPalette ( pal );
+    sbSusp-&gt;setPalette ( pal );
+    sbTerm-&gt;setPalette ( pal );
+    sbExp-&gt;setPalette ( pal );
+
+    stInfo=new QTextEdit ( sessionStatusDlg );
+    setWidgetStyle ( stInfo );
+    setWidgetStyle ( stInfo-&gt;verticalScrollBar() );
+    stInfo-&gt;setReadOnly ( true );
+    stInfo-&gt;hide();
+    stInfo-&gt;setFrameStyle ( QFrame::StyledPanel|QFrame::Plain );
+    stInfo-&gt;setPalette ( pal );
+
+    sbExp-&gt;setEnabled ( false );
+
+    connect ( sbSusp,SIGNAL ( clicked() ),this,
+              SLOT ( slotTestSessionStatus() ) );
+    connect ( sbTerm,SIGNAL ( clicked() ),this,
+              SLOT ( slotTermSessFromSt() ) );
+    connect ( sbAdv,SIGNAL ( clicked() ),this,
+              SLOT ( slotShowAdvancedStat() ) );
+    connect ( sbExp,SIGNAL ( clicked() ),this,
+              SLOT ( slotExportDirectory() ) );
+    connect ( sbApps,SIGNAL ( clicked() ),this,
+              SLOT ( slotAppDialog()) );
+
+    QVBoxLayout* layout=new QVBoxLayout ( sessionStatusDlg );
+    QHBoxLayout* ll=new QHBoxLayout();
+    ll-&gt;addWidget ( slName );
+    ll-&gt;addWidget ( slVal );
+    ll-&gt;addStretch();
+    ll-&gt;setSpacing ( 10 );
+    if ( !miniMode )
+        layout-&gt;setContentsMargins ( 25,25,10,10 );
+    else
+        layout-&gt;setContentsMargins ( 10,10,10,10 );
+
+    QHBoxLayout* bl=new QHBoxLayout();
+    bl-&gt;addStretch();
+    bl-&gt;addWidget ( sbApps );
+    bl-&gt;addWidget ( sbExp );
+    bl-&gt;addWidget ( sbSusp );
+    bl-&gt;addWidget ( sbTerm );
+//     bl-&gt;addStretch();
+    layout-&gt;addLayout ( ll );
+    layout-&gt;addStretch();
+    layout-&gt;addWidget ( stInfo );
+    layout-&gt;addWidget ( sbAdv );
+    layout-&gt;addStretch();
+    layout-&gt;addLayout ( bl );
+
+
+    slName-&gt;show();
+    slVal-&gt;show();
+    sbAdv-&gt;show();
+    if ( !embedMode )
+    {
+        sbSusp-&gt;show();
+        sbTerm-&gt;show();
+        sbExp-&gt;show();
+    }
+
+    X2goSettings st ( &quot;settings&quot; );
+
+
+    if ( st.setting()-&gt;value ( &quot;showStatus&quot;, ( QVariant ) false ).toBool() )
+    {
+        sbAdv-&gt;setChecked ( true );
+        slotShowAdvancedStat();
+    }
+#ifdef Q_OS_WIN
+    if ( embedMode )
+    {
+        QRect r;
+        wapiWindowRect ( sbAdv-&gt;winId(),r );
+        wapiWindowRect ( stInfo-&gt;verticalScrollBar ()-&gt;winId(),r );
+    }
+#endif
+
+}
+
+
+void ONMainWindow::initSelectSessDlg()
+{
+    selectSessionDlg = new SVGFrame ( &quot;:/svg/passform.svg&quot;,
+                                      false,bgFrame );
+    username-&gt;addWidget ( selectSessionDlg );
+    setWidgetStyle ( selectSessionDlg );
+    if ( !miniMode )
+        selectSessionDlg-&gt;setFixedSize ( selectSessionDlg-&gt;sizeHint() );
+    else
+        selectSessionDlg-&gt;setFixedSize ( 310,180 );
+    QPalette pal=selectSessionDlg-&gt;palette();
+    pal.setBrush ( QPalette::Window, QColor ( 255,255,255,0 ) );
+    pal.setColor ( QPalette::Active, QPalette::WindowText, QPalette::Mid );
+    pal.setColor ( QPalette::Active, QPalette::ButtonText, QPalette::Mid );
+    pal.setColor ( QPalette::Active, QPalette::Text, QPalette::Mid );
+    pal.setColor ( QPalette::Inactive, QPalette::WindowText, QPalette::Mid );
+    pal.setColor ( QPalette::Inactive, QPalette::ButtonText, QPalette::Mid );
+    pal.setColor ( QPalette::Inactive, QPalette::Text, QPalette::Mid );
+
+    selectSessionDlg-&gt;setPalette ( pal );
+
+    pal.setColor ( QPalette::Button, QColor ( 255,255,255,0 ) );
+    pal.setColor ( QPalette::Window, QColor ( 255,255,255,255 ) );
+    pal.setColor ( QPalette::Base, QColor ( 255,255,255,255 ) );
+
+    QFont fnt=selectSessionDlg-&gt;font();
+    if ( miniMode )
+#ifdef Q_WS_HILDON
+        fnt.setPointSize ( 10 );
+#else
+        fnt.setPointSize ( 9 );
+#endif
+    selectSessionDlg-&gt;setFont ( fnt );
+    selectSessionLabel=new QLabel ( tr ( &quot;Select session:&quot; ),
+                                    selectSessionDlg );
+    sOk=new QPushButton ( tr ( &quot;Resume&quot; ),selectSessionDlg );
+    setWidgetStyle ( sOk );
+    sCancel=new QPushButton ( tr ( &quot;Cancel&quot; ),selectSessionDlg );
+    setWidgetStyle ( sCancel );
+    bCancel=new QPushButton ( tr ( &quot;Cancel&quot; ),selectSessionDlg );
+    setWidgetStyle ( bCancel );
+
+    bSusp=new QPushButton ( tr ( &quot;Suspend&quot; ),selectSessionDlg );
+    setWidgetStyle ( bSusp );
+    bTerm=new QPushButton ( tr ( &quot;Terminate&quot; ),selectSessionDlg );
+    setWidgetStyle ( bTerm );
+
+    bNew=new QPushButton ( tr ( &quot;New&quot; ),selectSessionDlg );
+    setWidgetStyle ( bNew );
+
+    bShadow=new QPushButton ( tr ( &quot;Full access&quot; ),selectSessionDlg );
+    setWidgetStyle ( bShadow );
+
+    bShadowView=new QPushButton ( tr ( &quot;View only&quot; ),selectSessionDlg );
+    setWidgetStyle ( bShadowView );
+
+    sOk-&gt;setPalette ( pal );
+    sCancel-&gt;setPalette ( pal );
+
+    connect ( sCancel,SIGNAL ( clicked() ),this,
+              SLOT ( slotCloseSelectDlg() ) );
+    connect ( bCancel,SIGNAL ( clicked() ),this,
+              SLOT ( slotCloseSelectDlg() ) );
+
+    selectSessionDlg-&gt;show();
+#ifndef Q_WS_HILDON
+    sOk-&gt;setFixedSize ( ok-&gt;sizeHint() );
+    sCancel-&gt;setFixedSize ( cancel-&gt;sizeHint() );
+#else
+    QSize sz=sCancel-&gt;sizeHint();
+    sz.setWidth ( ( int ) ( sz.width() /1.5 ) );
+    sz.setHeight ( ( int ) ( sz.height() /1.5 ) );
+    sCancel-&gt;setFixedSize ( sz );
+    sz=sOk-&gt;sizeHint();
+    sz.setWidth ( ( int ) ( sz.width() /1.5 ) );
+    sz.setHeight ( ( int ) ( sz.height() /1.5 ) );
+    sOk-&gt;setFixedSize ( sz );
+    sz=bSusp-&gt;sizeHint();
+    if ( bTerm-&gt;sizeHint().width() &gt; sz.width() )
+        sz=bTerm-&gt;sizeHint();
+    if ( bNew-&gt;sizeHint().width() &gt; sz.width() )
+        sz=bNew-&gt;sizeHint();
+    sz.setWidth ( ( int ) ( sz.width() /1.5 ) );
+    sz.setHeight ( ( int ) ( sz.height() /1.5 ) );
+    bSusp-&gt;setFixedSize ( sz );
+    bTerm-&gt;setFixedSize ( sz );
+    bNew-&gt;setFixedSize ( sz );
+#endif
+    int bmaxw=bNew-&gt;size().width();
+    if ( bSusp-&gt;size().width() &gt;bmaxw )
+        bmaxw=bSusp-&gt;size().width();
+    if ( bTerm-&gt;size().width() &gt;bmaxw )
+        bmaxw=bTerm-&gt;size().width();
+
+    bNew-&gt;setFixedWidth ( bmaxw );
+    bSusp-&gt;setFixedWidth ( bmaxw );
+    bTerm-&gt;setFixedWidth ( bmaxw );
+
+
+
+    sOk-&gt;setEnabled ( true );
+    sCancel-&gt;setEnabled ( true );
+    selectSessionDlg-&gt;setEnabled ( true );
+    setEnabled ( true );
+
+    sessTv=new QTreeView ( selectSessionDlg );
+    setWidgetStyle ( sessTv );
+    setWidgetStyle ( sessTv-&gt;horizontalScrollBar() );
+    setWidgetStyle ( sessTv-&gt;verticalScrollBar() );
+    sessTv-&gt;setItemsExpandable ( false );
+    sessTv-&gt;setRootIsDecorated ( false );
+
+    model=new QStandardItemModel ( sessions.size(), 8 );
+    model-&gt;setHeaderData ( S_DISPLAY,Qt::Horizontal,
+                           QVariant ( ( QString ) tr ( &quot;Display&quot; ) ) );
+    model-&gt;setHeaderData ( S_STATUS,Qt::Horizontal,
+                           QVariant ( ( QString ) tr ( &quot;Status&quot; ) ) );
+    model-&gt;setHeaderData ( S_COMMAND,Qt::Horizontal,
+                           QVariant ( ( QString ) tr ( &quot;Command&quot; ) ) );
+    model-&gt;setHeaderData ( S_TYPE,Qt::Horizontal,
+                           QVariant ( ( QString ) tr ( &quot;Type&quot; ) ) );
+    model-&gt;setHeaderData ( S_SERVER,Qt::Horizontal,
+                           QVariant ( ( QString ) tr ( &quot;Server&quot; ) ) );
+    model-&gt;setHeaderData (
+        S_CRTIME,Qt::Horizontal,
+        QVariant ( ( QString ) tr ( &quot;Creation time&quot; ) ) );
+    model-&gt;setHeaderData ( S_IP,Qt::Horizontal,
+                           QVariant ( ( QString ) tr ( &quot;Client IP&quot; ) ) );
+    model-&gt;setHeaderData ( S_ID,Qt::Horizontal,
+                           QVariant ( ( QString ) tr ( &quot;Session ID&quot; ) ) );
+
+    modelDesktop=new QStandardItemModel ( sessions.size(), 2 );
+    modelDesktop-&gt;setHeaderData ( D_USER,Qt::Horizontal,
+                                  QVariant ( ( QString ) tr ( &quot;User&quot; ) ) );
+    modelDesktop-&gt;setHeaderData (
+        D_DISPLAY,Qt::Horizontal,
+        QVariant ( ( QString ) tr ( &quot;Display&quot; ) ) );
+
+    sessTv-&gt;setModel ( ( QAbstractItemModel* ) model );
+
+    QFontMetrics fm ( sessTv-&gt;font() );
+    sessTv-&gt;setEditTriggers ( QAbstractItemView::NoEditTriggers );
+    sessTv-&gt;setPalette ( pal );
+
+    sessTv-&gt;setModel ( ( QAbstractItemModel* ) model );
+
+    bNew-&gt;setPalette ( pal );
+    bShadow-&gt;setPalette ( pal );
+    bShadowView-&gt;setPalette ( pal );
+    bSusp-&gt;setPalette ( pal );
+    bTerm-&gt;setPalette ( pal );
+    sessTv-&gt;setFrameStyle ( QFrame::StyledPanel|QFrame::Plain );
+    sOk-&gt;setEnabled ( false );
+    bSusp-&gt;setEnabled ( false );
+    bTerm-&gt;setEnabled ( false );
+    bShadow-&gt;setEnabled ( false );
+    selectSessionLabel-&gt;hide();
+    bCancel-&gt;setPalette ( pal );
+    bCancel-&gt;hide();
+
+    desktopFilter=new QLineEdit ( selectSessionDlg );
+    setWidgetStyle ( desktopFilter );
+// 	desktopFilter-&gt;setFrame ( false );
+
+    desktopFilterCb=new QCheckBox ( tr ( &quot;Only my desktops&quot; ),
+                                    selectSessionDlg );
+    desktopFilterCb-&gt;hide();
+
+    QVBoxLayout* layout=new QVBoxLayout ( selectSessionDlg );
+    QHBoxLayout* filterLay=new QHBoxLayout();
+    QHBoxLayout* blay=new QHBoxLayout();
+    QVBoxLayout* alay=new QVBoxLayout();
+    QHBoxLayout* tvlay=new QHBoxLayout();
+
+    selectSesDlgLayout=layout;
+
+    layout-&gt;addWidget ( selectSessionLabel );
+    layout-&gt;addLayout ( filterLay );
+    layout-&gt;addLayout ( tvlay );
+    layout-&gt;addLayout ( blay );
+
+    filterLay-&gt;addWidget ( desktopFilter );
+    filterLay-&gt;addWidget ( desktopFilterCb );
+
+    alay-&gt;addWidget ( bSusp );
+    alay-&gt;addWidget ( bTerm );
+    alay-&gt;addWidget ( bShadowView );
+    alay-&gt;addWidget ( bShadow );
+    alay-&gt;addStretch();
+    alay-&gt;addWidget ( bNew );
+    alay-&gt;addWidget ( bCancel );
+
+    tvlay-&gt;addWidget ( sessTv );
+    tvlay-&gt;addLayout ( alay );
+
+    blay-&gt;addStretch();
+    blay-&gt;addWidget ( sOk );
+    blay-&gt;addWidget ( sCancel );
+    blay-&gt;addStretch();
+    if ( !miniMode )
+        layout-&gt;setContentsMargins ( 25,25,10,10 );
+    else
+        layout-&gt;setContentsMargins ( 10,10,10,10 );
+
+
+
+    sOk-&gt;hide();
+    sCancel-&gt;hide();
+    bNew-&gt;hide();
+    bSusp-&gt;hide();
+    bTerm-&gt;hide();
+
+    connect ( sessTv,SIGNAL ( clicked ( const QModelIndex&amp; ) ),
+              this,SLOT ( slotActivated ( const QModelIndex&amp; ) ) );
+
+    connect ( sessTv,SIGNAL ( doubleClicked ( const QModelIndex&amp; ) ),
+              this,SLOT ( slotResumeDoubleClick ( const QModelIndex&amp; ) ) );
+
+    connect ( sOk,SIGNAL ( clicked() ),this, SLOT ( slotResumeSess() ) );
+    connect ( bSusp,SIGNAL ( clicked() ),this, SLOT ( slotSuspendSess() ) );
+    connect ( bTerm,SIGNAL ( clicked() ),this, SLOT ( slotTermSess() ) );
+    connect ( bNew,SIGNAL ( clicked() ),this, SLOT ( slotNewSess() ) );
+
+    connect ( bShadow,SIGNAL ( clicked() ),this,
+              SLOT ( slotShadowSess() ) );
+    connect ( bShadowView,SIGNAL ( clicked() ),this,
+              SLOT ( slotShadowViewSess() ) );
+
+    connect ( desktopFilter,SIGNAL ( textEdited ( const QString&amp; ) ),this,
+              SLOT ( slotDesktopFilterChanged ( const QString&amp; ) ) );
+    connect ( desktopFilterCb,SIGNAL ( stateChanged ( int ) ),
+              this,
+              SLOT ( slotDesktopFilterCb ( int ) ) );
+
+    selectSessionLabel-&gt;show();
+    sOk-&gt;show();
+    sCancel-&gt;show();
+    bNew-&gt;show();
+    bSusp-&gt;show();
+    bTerm-&gt;show();
+    sessTv-&gt;show();
+    selectSessionDlg-&gt;hide();
+#ifdef Q_OS_WIN
+    if ( embedMode )
+    {
+        QRect r;
+        wapiWindowRect ( sOk-&gt;winId(),r );
+        wapiWindowRect ( sessTv-&gt;verticalScrollBar ()-&gt;winId(),r );
+        wapiWindowRect ( sessTv-&gt;horizontalScrollBar ()-&gt;winId(),r );
+        wapiWindowRect ( sessTv-&gt;header ()-&gt;viewport()-&gt;winId(),r );
+    }
+#endif
+
+}
+
+
+
+void ONMainWindow::printSshDError()
+{
+    if ( closeEventSent )
+        return;
+    QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),
+                            tr ( &quot;sshd not started, &quot;
+                                 &quot;you'll need sshd for printing &quot;
+                                 &quot;and file sharing\n&quot;
+                                 &quot;you can install sshd with\n&quot;
+                                 &quot;&lt;b&gt;sudo apt-get install &quot;
+                                 &quot;openssh-server&lt;/b&gt;&quot; ),
+                            QMessageBox::Ok,QMessageBox::NoButton );
+}
+
+void ONMainWindow::slotStartParec ()
+{
+    if ( !parecTunnelOk )
+    {
+// 		wait 1 sec and try again
+        QTimer::singleShot ( 1000, this, SLOT ( slotStartParec() ) );
+        return;
+    }
+    SshProcess* paProc;
+    QString passwd=getCurrentPass();
+    QString user=getCurrentUname();
+    QString host=resumingSession.server;
+    QString scmd=&quot;PULSE_CLIENTCONFIG=~/.x2go/C-&quot;+
+                 resumingSession.sessionId+
+                 &quot;/.pulse-client.conf &quot;+
+                 &quot;parec &gt; /dev/null &amp;sleep 1 &amp;&amp; kill %1&quot;;
+
+    paProc=new SshProcess ( sshConnection, this );
+    paProc-&gt;startNormal ( scmd );
+}
+
+
+void ONMainWindow::slotSndTunOk()
+{
+    parecTunnelOk=true;
+}
+
+
+void ONMainWindow::slotPCookieReady (	bool result,
+                                      QString ,
+                                      SshProcess* )
+{
+    if ( result )
+        slotStartParec();
+}
+
+
+void ONMainWindow::loadPulseModuleNativeProtocol()
+{
+    QProcess* proc=new QProcess ( this );
+    QStringList args;
+    args&lt;&lt;&quot;load-module&quot;&lt;&lt;&quot;module-native-protocol-tcp&quot;;
+    proc-&gt;start ( &quot;pactl&quot;,args );
+    proc-&gt;waitForFinished ( 3000 );
+}
+
+void ONMainWindow::slotEmbedToolBar()
+{
+    if ( statusLabel )
+    {
+        delete statusLabel;
+        statusLabel=0;
+    }
+    if ( embedTbVisible )
+    {
+        stb-&gt;clear();
+        act_embedToolBar-&gt;setIcon (
+            QIcon ( &quot;:icons/16x16/tbshow.png&quot; ) );
+        stb-&gt;addAction ( act_embedToolBar );
+        stb-&gt;setToolButtonStyle ( Qt::ToolButtonIconOnly );
+        stb-&gt;widgetForAction (
+            act_embedToolBar )-&gt;setFixedHeight ( 16 );
+        act_embedToolBar-&gt;setText ( tr ( &quot;Restore toolbar&quot; ) );
+        statusLabel=new QLabel;
+        stb-&gt;addWidget ( statusLabel );
+#ifndef Q_OS_WIN
+        statusBar()-&gt;hide();
+#endif
+    }
+    else
+    {
+        initEmbedToolBar();
+        act_embedToolBar-&gt;setIcon (
+            QIcon ( &quot;:icons/32x32/tbhide.png&quot; ) );
+        act_embedToolBar-&gt;setText ( tr ( &quot;Minimize toolbar&quot; ) );
+    }
+    embedTbVisible=!embedTbVisible;
+    if ( proxyWinEmbedded )
+        setStatStatus();
+    X2goSettings st ( &quot;sessions&quot; );
+    st.setting()-&gt;setValue ( &quot;embedded/tbvisible&quot;, embedTbVisible );
+    st.setting()-&gt;sync();
+}
+
+void ONMainWindow::initEmbedToolBar()
+{
+    stb-&gt;addAction ( act_embedToolBar );
+    stb-&gt;addSeparator();
+    stb-&gt;setToolButtonStyle ( Qt::ToolButtonTextUnderIcon );
+    stb-&gt;addAction ( act_shareFolder );
+    stb-&gt;addAction ( act_reconnect );
+    stb-&gt;addAction ( act_suspend );
+    stb-&gt;addAction ( act_terminate );
+    stb-&gt;addSeparator();
+    stb-&gt;addAction ( act_embedContol );
+    stb-&gt;addSeparator();
+    stb-&gt;addAction ( act_set );
+    stb-&gt;addAction ( act_abclient );
+}
+
+void ONMainWindow::slotEmbedToolBarToolTip()
+{
+    if ( !showTbTooltip )
+        return;
+    QWidget* widg=stb-&gt;widgetForAction (
+                      act_embedToolBar );
+    QToolTip::showText ( this-&gt;mapToGlobal ( QPoint ( 6,6 ) ),
+                         tr ( &quot;&lt;br&gt;&lt;b&gt;&nbsp;&nbsp;&nbsp;Click this &quot;
+                              &quot;button&nbsp;&nbsp;&nbsp;&lt;br&gt;&quot;
+                              &quot;&nbsp;&nbsp;&nbsp;to restore toolbar&quot;
+                              &quot;&nbsp;&nbsp;&nbsp;&lt;/b&gt;&lt;br&gt;&quot; ),
+                         widg );
+}
+
+
+void ONMainWindow::slotActivateWindow()
+{
+    if ( embedMode )
+    {
+        QApplication::setActiveWindow ( this ) ;
+        activateWindow();
+
+        /*		x2goDebug&lt;&lt;&quot;focus:&quot;&lt;&lt;pass-&gt;hasFocus();
+        		x2goDebug&lt;&lt;&quot;activ:&quot;&lt;&lt;pass-&gt;isActiveWindow();*/
+        QTimer::singleShot ( 50, this,
+                             SLOT ( slotEmbedToolBarToolTip() ) );
+    }
+}
+
+#ifndef Q_OS_WIN
+void ONMainWindow::mouseReleaseEvent ( QMouseEvent * event )
+{
+    QMainWindow::mouseReleaseEvent ( event );
+    slotActivateWindow();
+}
+#endif
+
+void ONMainWindow::slotHideEmbedToolBarToolTip()
+{
+    showTbTooltip=false;
+    QToolTip::hideText();
+}
+
+
+void ONMainWindow::slotDesktopFilterChanged ( const QString&amp; text )
+{
+    filterDesktops ( text );
+}
+
+
+void ONMainWindow::slotDesktopFilterCb ( int state )
+{
+    if ( state==Qt::Checked )
+    {
+        filterDesktops ( getCurrentUname(),true );
+        desktopFilter-&gt;setEnabled ( false );
+    }
+    else
+    {
+        filterDesktops ( desktopFilter-&gt;text() );
+        desktopFilter-&gt;setEnabled ( true );
+    }
+}
+
+
+void ONMainWindow::filterDesktops ( const QString&amp; filter, bool strict )
+{
+    modelDesktop-&gt;setRowCount ( 0 );
+    bShadow-&gt;setEnabled ( false );
+    bShadowView-&gt;setEnabled ( false );
+    QFontMetrics fm ( sessTv-&gt;font() );
+    uint nextRow=0;
+    for ( int row = 0; row &lt; selectedDesktops.size(); ++row )
+    {
+        QStringList desktop=selectedDesktops[row].split ( &quot;@&quot; );
+        if ( filter==tr ( &quot;Filter&quot; ) ||filter.length() &lt;=0||
+                ( strict &amp;&amp; desktop[0]==filter )  ||
+                ( !strict &amp;&amp; desktop[0].startsWith ( filter ) ) )
+        {
+            QStandardItem *item;
+            item= new QStandardItem ( desktop[0] );
+            modelDesktop-&gt;setItem ( nextRow,D_USER,item );
+            item= new QStandardItem ( desktop[1] );
+            modelDesktop-&gt;setItem ( nextRow++,D_DISPLAY,item );
+            for ( int j=0;j&lt;2;++j )
+            {
+                QString txt=
+                    modelDesktop-&gt;index (
+                        row,j ).data().toString();
+                if ( sessTv-&gt;header()-&gt;sectionSize ( j ) &lt;
+                        fm.width ( txt ) +6 )
+                {
+                    sessTv-&gt;header()-&gt;resizeSection (
+                        j,fm.width ( txt ) +6 );
+                }
+            }
+        }
+    }
+}
+
+
+void ONMainWindow::slotShadowSess()
+{
+    shadowMode=SHADOW_FULL;
+    slotShadowViewSess();
+}
+
+void ONMainWindow::slotShadowViewSess()
+{
+    shadowUser=sessTv-&gt;model()-&gt;index ( sessTv-&gt;currentIndex().row(),
+                                        D_USER ).data().toString();
+    shadowDisplay=sessTv-&gt;model()-&gt;index ( sessTv-&gt;currentIndex().row(),
+                                           D_DISPLAY ).data().toString();
+    startNewSession();
+}
+
+
+void ONMainWindow::slotReconnectSession()
+{
+    if ( !managedMode )
+        slotSelectedFromList ( ( SessionButton* ) 0 );
+    else
+    {
+        broker-&gt;getSInfoFromBroker();
+        setEnabled ( false );
+    }
+}
+
+
+QSize ONMainWindow::getEmbedAreaSize()
+{
+    if ( embedTbVisible &amp;&amp; config.showstatusbar )
+        statusBar()-&gt;show();
+    QSize sz=bgFrame-&gt;size();
+//     sz.setHeight(sz.height()-statusBar()-&gt;size().height());
+    statusBar()-&gt;hide();
+    return sz;
+}
+
+
+void ONMainWindow::slotStartBroker()
+{
+    config.brokerPass=pass-&gt;text();
+    config.brokerUser=login-&gt;text();
+    setStatStatus ( tr ( &quot;Connecting to broker&quot; ) );
+    stInfo-&gt;insertPlainText ( &quot;broker url: &quot;+config.brokerurl );
+    setEnabled ( false );
+    broker-&gt;getUserSessions();
+}
+
+void ONMainWindow::slotGetBrokerSession(const QString&amp; sinfo)
+{
+    //x2goDebug&lt;&lt;&quot;broker session: &quot;&lt;&lt;sinfo;
+    QStringList lst=sinfo.split(&quot;SERVER:&quot;,QString::SkipEmptyParts);
+    int keyStartPos=sinfo.indexOf(&quot;-----BEGIN DSA PRIVATE KEY-----&quot;);
+    QString endStr=&quot;-----END DSA PRIVATE KEY-----&quot;;
+    int keyEndPos=sinfo.indexOf(endStr);
+    if (! (keyEndPos == -1 || keyStartPos == -1 || lst.size()==0))
+        config.key=sinfo.mid(keyStartPos, keyEndPos+endStr.length()-keyStartPos);
+    QString serverLine=(lst[1].split(&quot;\n&quot;))[0];
+    QStringList words=serverLine.split(&quot;:&quot;,QString::SkipEmptyParts);
+    config.server=words[0];
+    if (words.count()&gt;1)
+        config.sshport=words[1];
+//    x2goDebug&lt;&lt;&quot;server: &quot;&lt;&lt;config.server&lt;&lt;endl&lt;&lt;&quot; key: &quot;&lt;&lt;config.key;
+    if (sinfo.indexOf(&quot;SESSION_INFO&quot;)!=-1)
+    {
+        QStringList lst=sinfo.split(&quot;SESSION_INFO:&quot;,QString::SkipEmptyParts);
+        config.sessiondata=(lst[1].split(&quot;\n&quot;))[0];
+// 	x2goDebug&lt;&lt;&quot;data: &quot;&lt;&lt;config.sessiondata;
+    }
+    slotSessEnter();
+}
+
+void ONMainWindow::slotStartNewBrokerSession ( )
+{
+    if ( managedMode )
+    {
+        setEnabled ( true );
+        slotSelectedFromList ( ( SessionButton* ) 0 );
+    }
+}
+
+#ifdef Q_OS_WIN
+QString ONMainWindow::u3DataPath()
+{
+    QStringList env=QProcess::systemEnvironment();
+    QString dpath;
+    for ( int i=0;i&lt;env.size();++i )
+    {
+// 		x2goDebug &lt;&lt; env[i];
+        //check if we have U3 System
+        if ( env[i].indexOf ( &quot;U3_APP_DATA_PATH=&quot; ) ==0 )
+        {
+            dpath=env[i];
+        }
+        if ( env[i].indexOf ( &quot;U3_DEVICE_PATH=&quot; ) ==0 )
+        {
+            u3Device=env[i];
+            u3Device.replace ( &quot;U3_DEVICE_PATH=&quot;,&quot;&quot; );
+        }
+
+    }
+
+    if ( dpath.length() &gt;0 )
+    {
+        dpath.replace ( &quot;U3_APP_DATA_PATH=&quot;,&quot;&quot; );
+        portableDataPath=dpath;
+        return dpath;
+    }
+    return QString::null;
+}
+
+#endif
+
+void ONMainWindow::cleanPortable()
+{
+    removeDir ( homeDir +&quot;/.ssh&quot; );
+    removeDir ( homeDir +&quot;/ssh&quot; );
+    removeDir ( homeDir+&quot;/.x2go&quot; );
+    if (cleanAllFiles)
+        removeDir(homeDir+&quot;/.x2goclient&quot;);
+}
+
+void ONMainWindow::removeDir ( QString path )
+{
+    x2goDebug&lt;&lt;&quot;entering &quot; &lt;&lt;path;
+    QDir dr ( path );
+    QStringList files=dr.entryList ( QDir::Files );
+    for ( int i=0;i&lt;files.size();++i )
+    {
+        if ( files[i]!=&quot;known_hosts&quot; || cleanAllFiles)
+        {
+            x2goDebug&lt;&lt;&quot;cleaning file:&quot;&lt;&lt;path+&quot;/&quot;+files[i];
+            dr.remove ( path+&quot;/&quot;+files[i] );
+        }
+    }
+    QStringList dirs=dr.entryList ( QDir::AllDirs|QDir::NoDotAndDotDot );
+    for ( int i=0;i&lt;dirs.size();++i )
+    {
+        removeDir ( path+&quot;/&quot;+dirs[i] );
+    }
+    dr.rmdir ( path );
+}
+
+#ifdef Q_OS_LINUX
+long ONMainWindow::X11FindWindow ( QString text, long rootWin )
+{
+    Window    wParent;
+    Window    wRoot;
+    Window   *child_list;
+    unsigned  nChildren;
+    long proxyId=0;
+    if ( !rootWin )
+        rootWin= XDefaultRootWindow ( QX11Info::display() );
+
+    if ( XQueryTree ( QX11Info::display(),rootWin,&amp;wRoot,&amp;wParent,
+                      &amp;child_list,&amp;nChildren ) )
+    {
+        for ( uint i=0;i&lt;nChildren;++i )
+        {
+            char *wname;
+            if ( XFetchName ( QX11Info::display(),
+                              child_list[i],&amp;wname ) )
+            {
+                QString title ( wname );
+                XFree ( wname );
+                if ( title==text )
+                {
+                    proxyId=child_list[i];
+                    break;
+                }
+            }
+            proxyId=X11FindWindow ( text, child_list[i] );
+            if ( proxyId )
+                break;
+        }
+        XFree ( child_list );
+    }
+    return proxyId;
+}
+#endif
+
+long ONMainWindow::findWindow ( QString text )
+{
+#ifdef Q_OS_LINUX
+    return X11FindWindow ( text );
+#endif
+#ifdef Q_OS_WIN
+    return ( long ) wapiFindWindow ( 0,text.utf16() );
+#endif
+}
+
+//////////////////////////plugin stuff//////////////
+
+#ifdef CFGPLUGIN
+void ONMainWindow::setX2goconfig ( const QString&amp; text )
+{
+    m_x2goconfig=text;
+    x2goDebug&lt;&lt;&quot;have session config&quot;;
+    initWidgetsEmbed();
+}
+
+void ONMainWindow::doPluginInit()
+{
+#ifdef Q_OS_LINUX
+    Dl_info info;
+    dladdr ( ( void* ) &amp; ( ONMainWindow::getPortable ),&amp;info );
+    QString fname=info.dli_fname;
+    x2goDebug&lt;&lt;&quot;Application name:&quot; &lt;&lt;fname;
+    QString clientDir;
+    QString pluginDir;
+    int pos=fname.lastIndexOf ( &quot;/&quot; );
+    pluginDir=fname.left ( pos );
+    x2goDebug&lt;&lt;&quot;Plugin Dir:&quot; &lt;&lt;pluginDir;
+    QDir dr ( pluginDir );
+    if ( dr.exists ( &quot;x2goclient/x2goclient&quot; ) )
+    {
+        clientDir=pluginDir+&quot;/x2goclient&quot;;
+    }
+    else if ( dr.exists ( &quot;x2goclient&quot; ) )
+    {
+        clientDir=pluginDir;
+    }
+    else
+    {
+        dr.cdUp();
+        if ( dr.exists ( &quot;x2goclient/x2goclient&quot; ) )
+        {
+            clientDir=dr.absolutePath() +&quot;/x2goclient&quot;;
+        }
+        else if ( dr.exists ( &quot;x2goclient&quot; ) )
+        {
+            clientDir=dr.absolutePath();
+        }
+        else
+        {
+            clientDir=pluginDir;
+        }
+    }
+    x2goDebug&lt;&lt;&quot;Client Dir:&quot;&lt;&lt;clientDir;
+    QString path=getenv ( &quot;PATH&quot; );
+    path=clientDir+&quot;:&quot;+pluginDir+&quot;:&quot;+path;
+    setenv ( &quot;PATH&quot;,path.toAscii (),1 );
+
+    path=getenv ( &quot;LD_LIBRARY_PATH&quot; );
+    path=clientDir+&quot;:&quot;+pluginDir+&quot;:&quot;+path;
+    setenv ( &quot;LD_LIBRARY_PATH&quot;,path.toAscii () ,1 );
+
+    setenv ( &quot;X2GO_LIB&quot;,clientDir.toAscii () ,1 );
+
+    QFile::setPermissions (
+        clientDir+&quot;/x2goclient&quot;,
+        QFile::ReadOwner|QFile::WriteOwner|QFile::ExeOwner|
+        QFile::ReadGroup|QFile::WriteGroup|QFile::ExeGroup|
+        QFile::ReadOther|QFile::WriteOther|QFile::ExeOther );
+    QFile::setPermissions (
+        clientDir+&quot;/nxproxy&quot;,
+        QFile::ReadOwner|QFile::WriteOwner|QFile::ExeOwner|
+        QFile::ReadGroup|QFile::WriteGroup|QFile::ExeGroup|
+        QFile::ReadOther|QFile::WriteOther|QFile::ExeOther );
+    QFile::setPermissions (
+        clientDir+&quot;/sshd&quot;,
+        QFile::ReadOwner|QFile::WriteOwner|QFile::ExeOwner|
+        QFile::ReadGroup|QFile::WriteGroup|QFile::ExeGroup|
+        QFile::ReadOther|QFile::WriteOther|QFile::ExeOther );
+    QFile::setPermissions (
+        clientDir+&quot;/sftp-server&quot;,
+        QFile::ReadOwner|QFile::WriteOwner|QFile::ExeOwner|
+        QFile::ReadGroup|QFile::WriteGroup|QFile::ExeGroup|
+        QFile::ReadOther|QFile::WriteOther|QFile::ExeOther );
+
+#endif
+}
+
+
+#ifndef Q_OS_DARWIN
+
+
+QSize ONMainWindow::getWindowSize ( long winId )
+{
+
+#ifdef Q_OS_LINUX
+    XWindowAttributes atr;
+    if ( XGetWindowAttributes ( QX11Info::display(),winId,&amp;atr ) )
+        return QSize ( atr.width,atr.height );
+    return QSize ( 0,0 );
+#endif
+#ifdef Q_OS_WIN
+    QRect rec;
+    if ( wapiClientRect ( ( HWND ) winId,rec ) )
+        return rec.size();
+    else
+        return QSize ( 0,0 );
+#endif
+}
+
+#ifdef Q_OS_WIN
+void ONMainWindow::slotUpdateEmbedWindow()
+{
+    if ( oldContainerSize!=embedContainer-&gt;size() ||
+            oldChildPos!= mapToGlobal (
+                QPoint ( 0,0 ) ) )
+    {
+        QRect geom=embedContainer-&gt;geometry();
+        if ( gcor==1 )
+            gcor=0;
+        else
+            gcor=1;
+        geom.setWidth ( geom.width()-gcor );
+        wapiSetFSWindow ( ( HWND ) childId,
+                          geom );
+        wapiUpdateWindow ( ( HWND ) childId );
+        oldContainerSize=embedContainer-&gt;size();
+        oldChildPos= mapToGlobal (
+                         QPoint ( 0,0 ) );
+        x2goDebug&lt;&lt;&quot;updating embedded window&quot;&lt;&lt;endl;
+    }
+}
+
+#endif
+
+
+
+void ONMainWindow::embedWindow ( long wndId )
+{
+    childId=wndId;
+    embedContainer-&gt;show();
+#ifdef Q_OS_LINUX
+    x2goDebug&lt;&lt;&quot;embedding &quot;&lt;&lt;wndId&lt;&lt;&quot; in container&quot;&lt;&lt;endl;
+    embedContainer-&gt;embedClient ( wndId );
+#endif
+#ifdef Q_OS_WIN
+    wapiSetParent ( ( HWND ) childId,
+                    ( HWND ) ( embedContainer-&gt;winId() ) );
+    oldContainerSize=embedContainer-&gt;size();
+    oldChildPos= ( mapToGlobal ( QPoint ( 0,0 ) ));
+    winFlags=wapiSetFSWindow ( ( HWND ) childId,
+                               embedContainer-&gt;geometry() );
+    updateTimer-&gt;start ( 500 );
+
+#endif
+}
+
+
+void ONMainWindow::detachClient()
+{
+    if ( !childId )
+        return;
+#ifdef Q_OS_LINUX
+    if ( embedContainer )
+    {
+        embedContainer-&gt;discardClient();
+    }
+#endif
+#ifdef Q_OS_WIN
+    wapiSetParent ( ( HWND ) childId, ( HWND ) 0 );
+    slotDetachProxyWindow();
+    updateTimer-&gt;stop();
+    if ( childId )
+    {
+        wapiRestoreWindow ( ( HWND ) childId, winFlags,
+                            embedContainer-&gt;geometry() );
+        wapiMoveWindow ( ( HWND ) childId,0,0,
+                         oldContainerSize.width(),
+                         oldContainerSize.height(),true );
+
+    }
+#endif
+    childId=0;
+}
+
+#endif //(Q_OS_DARWIN)
+
+
+
+
+
+QTNPFACTORY_BEGIN ( &quot;X2GoClient Plug-in &quot;VERSION,
+                    &quot;Allows you to start X2Go session in a webbrowser&quot; )
+QTNPCLASS ( ONMainWindow )
+QTNPFACTORY_END()
+
+#ifdef QAXSERVER
+#include &lt;ActiveQt/QAxFactory&gt;
+QAXFACTORY_BEGIN ( &quot;{aa3216bf-7e20-482c-84c6-06167bacb616}&quot;, &quot;{08538ca5-eb7a-4f24-a3c4-a120c6e04dc4}&quot; )
+QAXCLASS ( ONMainWindow )
+QAXFACTORY_END()
+#endif
+#endif
diff --git a/onmainwindow.h b/onmainwindow.h
index 4a17a92..66b21e8 100644
--- a/onmainwindow.h
+++ b/onmainwindow.h
@@ -506,6 +506,7 @@ private:
     bool embedMode;
     bool thinMode;
     QString statusString;
+    QString autostartApp;
     int defaultLink;
     int defaultQuality;
     int defaultWidth;
@@ -518,6 +519,7 @@ private:
     bool showTbTooltip;
     bool noSessionEdit;
     bool cleanAllFiles;
+    bool PGPInited;
     struct SshProxy sshProxy;
     QString sshPort;
     QString clientSshPort;
@@ -663,6 +665,7 @@ private:
     bool showToolBar;
     bool showHaltBtn;
     bool newSession;
+    bool runStartApp;
     bool ldapOnly;
     bool isScDaemonOk;
     bool parecTunnelOk;
diff --git a/onmainwindow_part2.cpp b/onmainwindow_part2.cpp
deleted file mode 100644
index 9412f9d..0000000
--- a/onmainwindow_part2.cpp
+++ /dev/null
@@ -1,2577 +0,0 @@
-/***************************************************************************
-*   Copyright (C) 2005-2012 by Oleksandr Shneyder   *
-*   <A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">oleksandr.shneyder at obviously-nice.de</A>   *
-*                                                                         *
-*   This program is free software; you can redistribute it and/or modify  *
-*   it under the terms of the GNU General Public License as published by  F*
-*   the Free Software Foundation; either version 2 of the License, or     *
-*   (at your option) any later version.                                   *
-*                                                                         *
-*   This program is distributed in the hope that it will be useful,       *
-*   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
-*   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
-*   GNU General Public License for more details.                          *
-*                                                                         *
-*   You should have received a copy of the GNU General Public License     *
-*   along with this program; if not, write to the                         *
-*   Free Software Foundation, Inc.,                                       *
-*   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
-***************************************************************************/
-
-#include &quot;onmainwindow_privat.h&quot;
-
-
-void ONMainWindow::slotSshConnectionOk()
-{
-    x2goDebug&lt;&lt;&quot;ssh connection ok&quot;&lt;&lt;endl;
-    passForm-&gt;setEnabled ( true );
-    if ( useLdap )
-    {
-        continueLDAPSession();
-    }
-    else
-        continueNormalSession();
-}
-
-
-SshMasterConnection*  ONMainWindow::findServerSshConnection(QString host)
-{
-    for (int i=0;i&lt;serverSshConnections.count();++i)
-    {
-        if (serverSshConnections[i])
-        {
-            if (serverSshConnections[i]-&gt;getHost()==host)
-                return serverSshConnections[i];
-        }
-    }
-    return 0l;
-}
-
-void ONMainWindow::slotServSshConnectionOk(QString server)
-{
-    SshMasterConnection* con=findServerSshConnection(server);
-    if (!con)
-        return;
-    SshProcess* lproc;
-    lproc=new SshProcess ( con,  this );
-    connect ( lproc,SIGNAL ( sshFinished ( bool,
-                                           QString,SshProcess* ) ),
-              this,SLOT (
-                  slotListAllSessions ( bool,
-                                        QString,SshProcess* ) ) );
-    x2goDebug&lt;&lt;&quot;getting sessions on &quot;&lt;&lt;server&lt;&lt;endl;
-    lproc-&gt;startNormal ( &quot;export HOSTNAME &amp;&amp; x2golistsessions&quot; );
-}
-
-void ONMainWindow::slotSshServerAuthError ( int error, QString sshMessage )
-{
-    if ( startHidden )
-    {
-        startHidden=false;
-        slotResize();
-        show();
-        activateWindow();
-        raise();
-    }
-    QString errMsg;
-    switch ( error )
-    {
-    case SSH_SERVER_KNOWN_CHANGED:
-        errMsg=tr ( &quot;Host key for server changed.\nIt is now: &quot; ) +sshMessage+&quot;\n&quot;+
-               tr ( &quot;For security reasons, connection will be stopped&quot; );
-        if ( sshConnection )
-        {
-            sshConnection-&gt;wait();
-            delete sshConnection;
-            sshConnection=0l;
-        }
-        slotSshUserAuthError ( errMsg );
-        return;
-
-    case SSH_SERVER_FOUND_OTHER:
-        errMsg=tr ( &quot;The host key for this server was not found but an other&quot;
-                    &quot;type of key exists.An attacker might change the default server key to&quot;
-                    &quot;confuse your client into thinking the key does not exist&quot; );
-        if ( sshConnection )
-        {
-            sshConnection-&gt;wait();
-            delete sshConnection;
-            sshConnection=0l;
-        }
-        slotSshUserAuthError ( errMsg );
-        return ;
-
-    case SSH_SERVER_ERROR:
-        if ( sshConnection )
-        {
-            sshConnection-&gt;wait();
-            delete sshConnection;
-            sshConnection=0l;
-        }
-        slotSshUserAuthError ( errMsg );
-        return ;
-    case SSH_SERVER_FILE_NOT_FOUND:
-        errMsg=tr ( &quot;Could not find known host file.&quot;
-                    &quot;If you accept the host key here, the file will be automatically created&quot; );
-        break;
-
-    case SSH_SERVER_NOT_KNOWN:
-        errMsg=tr ( &quot;The server is unknown. Do you trust the host key?\nPublic key hash: &quot; ) +sshMessage;
-        break;
-    }
-
-    if ( QMessageBox::warning ( this, tr ( &quot;Host key verification failed&quot; ),errMsg,tr ( &quot;Yes&quot; ), tr ( &quot;No&quot; ) ) !=0 )
-    {
-        if ( sshConnection )
-        {
-            sshConnection-&gt;wait();
-            delete sshConnection;
-            sshConnection=0l;
-        }
-        slotSshUserAuthError ( tr ( &quot;Host key verification failed&quot; ) );
-        return;
-    }
-    sshConnection-&gt;setAcceptUnknownServers ( true );
-    sshConnection-&gt;start();
-}
-
-void ONMainWindow::slotSshUserAuthError ( QString error )
-{
-    if ( sshConnection )
-    {
-        sshConnection-&gt;wait();
-        delete sshConnection;
-        sshConnection=0l;
-    }
-
-    QMessageBox::critical ( 0l,tr ( &quot;Authentication failed&quot; ),error,
-                            QMessageBox::Ok,
-                            QMessageBox::NoButton );
-// 	currentKey=QString::null;
-    setEnabled ( true );
-    passForm-&gt;setEnabled ( true );
-    slotShowPassForm();
-    pass-&gt;setFocus();
-    pass-&gt;selectAll();
-
-
-
-    passForm-&gt;setEnabled ( true );
-    if ( startHidden )
-    {
-        startHidden=false;
-        slotResize();
-        show();
-        activateWindow();
-        raise();
-    }
-}
-
-void ONMainWindow::slotSessEnter()
-{
-    if ( useLdap )
-    {
-        slotPassEnter();
-        return;
-    }
-    if (brokerMode)
-    {
-        if (!config.brokerAuthenticated)
-        {
-            x2goDebug&lt;&lt;&quot;starting broker request&quot;;
-            slotStartBroker();
-            return;
-        }
-    }
-
-    resumingSession.sessionId=QString::null;
-    resumingSession.server=QString::null;
-    resumingSession.display=QString::null;
-    setStatStatus ( tr ( &quot;connecting&quot; ) );
-
-    QString sid=&quot;&quot;;
-    if ( !embedMode )
-        sid=lastSession-&gt;id();
-    startSession ( sid );
-}
-
-void ONMainWindow::continueNormalSession()
-{
-    x2goDebug&lt;&lt;&quot;continue normal x2go session&quot;&lt;&lt;endl;
-    if (brokerMode)
-    {
-        slotListSessions(true,QString::null,0);
-        return;
-    }
-    SshProcess* proc=new SshProcess ( sshConnection, this );
-    connect ( proc,SIGNAL ( sshFinished ( bool,QString,SshProcess* ) ),
-              this,SLOT ( slotListSessions ( bool, QString,
-                                             SshProcess* ) ) );
-    if ( !shadowSession )
-        proc-&gt;startNormal ( &quot;export HOSTNAME &amp;&amp; x2golistsessions&quot; );
-    else
-        proc-&gt;startNormal ( &quot;export HOSTNAME &amp;&amp; x2golistdesktops&quot; );
-
-}
-
-void ONMainWindow::continueLDAPSession()
-{
-
-
-    SshProcess* proc=new SshProcess ( sshConnection,this );
-    connect ( proc,SIGNAL ( sshFinished ( bool,QString,SshProcess* ) ),
-              this,SLOT ( slotGetServers ( bool, QString,SshProcess* ) ) );
-    proc-&gt;startNormal ( &quot;x2gogetservers&quot; );
-}
-
-
-bool ONMainWindow::startSession ( const QString&amp; sid )
-{
-    setEnabled ( false );
-    QString passwd;
-    QString user;
-    QString host;
-    bool autologin=false;
-    bool krblogin=false;
-    user=getCurrentUname();
-    runRemoteCommand=true;
-    shadowSession=false;
-    applications.clear();
-    removeAppsFromTray();
-
-    if ( managedMode )
-    {
-        slotListSessions ( true, QString::null,0 );
-        return true;
-    }
-
-    if ( !embedMode &amp;&amp; !brokerMode )
-    {
-
-        X2goSettings st ( &quot;sessions&quot; );
-
-        passForm-&gt;setEnabled ( false );
-        host=st.setting()-&gt;value ( sid+&quot;/host&quot;,
-                                   ( QVariant ) QString::null ).toString();
-        QString cmd=st.setting()-&gt;value ( sid+&quot;/command&quot;,
-                                          ( QVariant ) QString::null ).toString();
-        autologin=st.setting()-&gt;value ( sid+&quot;/autologin&quot;,
-                                        ( QVariant ) false ).toBool();
-        krblogin=st.setting()-&gt;value ( sid+&quot;/krblogin&quot;,
-                                       ( QVariant ) false ).toBool();
-        if ( cmd==&quot;SHADOW&quot; )
-            shadowSession=true;
-    }
-    else
-    {
-        host=config.server;
-        sshPort=config.sshport;
-        selectedCommand=config.command;
-    }
-    if (!brokerMode)
-        passwd=getCurrentPass();
-    else
-    {
-        currentKey=config.key;
-        host=config.server;
-        X2goSettings st ( config.iniFile, QSettings::IniFormat );
-        passForm-&gt;setEnabled ( false );
-        user=st.setting()-&gt;value ( sid+&quot;/user&quot;,
-                                   ( QVariant ) QString::null ).toString();
-        login-&gt;setText(user);
-        sshPort=config.sshport;
-        /*        sshPort=st.setting()-&gt;value ( sid+&quot;/sshport&quot;,
-                                              ( QVariant ) &quot;22&quot; ).toString();*/
-    }
-    if (sshConnection)
-        sshConnection-&gt;disconnectSession();
-    sshConnection=startSshConnection ( host,sshPort,acceptRsa,user,passwd,autologin, krblogin );
-    return true;
-}
-
-
-void ONMainWindow::slotListSessions ( bool result,QString output,
-                                      SshProcess* proc )
-{
-    if ( proc )
-        delete proc;
-    if ( result==false )
-    {
-        cardReady=false;
-        cardStarted=false;
-        QString message=tr ( &quot;&lt;b&gt;Connection failed&lt;/b&gt;\n&quot; ) +output;
-        if ( message.indexOf ( &quot;publickey,password&quot; ) !=-1 )
-        {
-            message=tr ( &quot;&lt;b&gt;Wrong password!&lt;/b&gt;&lt;br&gt;&lt;br&gt;&quot; ) +
-                    message;
-        }
-
-        QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),message,
-                                QMessageBox::Ok,
-                                QMessageBox::NoButton );
-// 		currentKey=QString::null;
-        setEnabled ( true );
-        passForm-&gt;setEnabled ( true );
-        slotShowPassForm();
-        pass-&gt;setFocus();
-        pass-&gt;selectAll();
-        return;
-    }
-
-    passForm-&gt;hide();
-    if ( !embedMode )
-    {
-        setUsersEnabled ( false );
-        uname-&gt;setEnabled ( false );
-        u-&gt;setEnabled ( false );
-    }
-    if ( managedMode || brokerMode )
-    {
-        x2goDebug&lt;&lt;&quot;sess data:&quot;&lt;&lt;config.sessiondata;
-        if ( config.sessiondata.indexOf ( &quot;|S|&quot; ) ==-1 )
-        {
-            x2goDebug&lt;&lt;&quot;start new managed session&quot;;
-            startNewSession();
-        }
-        else
-        {
-            x2goSession s=getSessionFromString (
-                              config.sessiondata );
-            x2goDebug&lt;&lt;&quot;resuming managed session:&quot;&lt;&lt;s.sessionId;
-            resumeSession ( s );
-        }
-        return;
-    }
-
-    QStringList sessions=output.trimmed().split ( '\n',
-                         QString::SkipEmptyParts );
-    if ( shadowSession )
-    {
-        selectSession ( sessions );
-    }
-    else
-    {
-        if ( ( sessions.size() ==0 ) ||
-                ( sessions.size() ==1&amp;&amp;sessions[0].length() &lt;5 ) )
-            startNewSession();
-        else if ( sessions.size() ==1 )
-        {
-            x2goSession s=getSessionFromString ( sessions[0] );
-            QDesktopWidget wd;
-            if ( s.status==&quot;S&quot; &amp;&amp; isColorDepthOk ( wd.depth(),
-                                                   s.colorDepth )
-                    &amp;&amp;s.command == selectedCommand )
-                resumeSession ( s );
-            else
-            {
-                if ( startHidden )
-                    startNewSession();
-                else
-                    selectSession ( sessions );
-            }
-        }
-        else
-        {
-            if ( !startHidden )
-                selectSession ( sessions );
-            else
-            {
-                for ( int i=0;i&lt;sessions.size();++i )
-                {
-                    x2goSession s=getSessionFromString (
-                                      sessions[i] );
-                    QDesktopWidget wd;
-                    if ( s.status==&quot;S&quot; &amp;&amp; isColorDepthOk (
-                                wd.depth(),s.colorDepth )
-                            &amp;&amp;s.command == selectedCommand )
-                    {
-                        resumeSession ( s );
-                        return;
-                    }
-                }
-                startNewSession();
-            }
-        }
-    }
-}
-
-
-x2goSession ONMainWindow::getSessionFromString ( const QString&amp; string )
-{
-    QStringList lst=string.split ( '|' );
-    x2goSession s;
-    s.agentPid=lst[0];
-    s.sessionId=lst[1];
-    s.display=lst[2];
-    s.server=lst[3];
-    s.status=lst[4];
-    s.crTime=lst[5];
-    s.cookie=lst[6];
-    s.clientIp=lst[7];
-    s.grPort=lst[8];
-    s.sndPort=lst[9];
-    if ( lst.count() &gt;13 )
-        s.fsPort=lst[13];
-    s.colorDepth=0;
-    if ( s.sessionId.indexOf ( &quot;_dp&quot; ) !=-1 )
-    {
-        s.colorDepth=s.sessionId.split ( &quot;_dp&quot; ) [1].toInt();
-    }
-    s.sessionType=x2goSession::DESKTOP;
-    s.command=tr ( &quot;unknown&quot; );
-    if ( s.sessionId.indexOf ( &quot;_st&quot; ) !=-1 )
-    {
-        QString cmdinfo=s.sessionId.split ( &quot;_st&quot; ) [1];
-        cmdinfo=cmdinfo.split ( &quot;_&quot; ) [0];
-        QChar st=cmdinfo[0];
-        if ( st=='R' )
-            s.sessionType=x2goSession::ROOTLESS;
-        if ( st=='S' )
-            s.sessionType=x2goSession::SHADOW;
-        QString command=cmdinfo.mid ( 1 );
-        if ( command.length() &gt;0 )
-            s.command=command;
-    }
-    return s;
-}
-
-
-void ONMainWindow::startNewSession()
-{
-    newSession=true;
-    QString passwd=getCurrentPass();
-    QString user=getCurrentUname();
-
-    QString pack;
-    bool fullscreen;
-    int height;
-    int width;
-    int quality;
-    int speed;
-    bool usekbd;
-    bool rootless=false;
-    resumingSession.published=false;
-    bool setDPI=defaultSetDPI;
-    uint dpi=defaultDPI;
-    QString layout;
-    QString type;
-    QString command;
-    QString xdmcpServer;
-    runRemoteCommand=true;
-    QString host=QString::null;
-    removeAppsFromTray();
-    if ( useLdap )
-    {
-        pack=defaultPack;
-        fullscreen=defaultFullscreen;
-        height=defaultHeight;
-        width=defaultWidth;
-        quality=defaultQuality;
-        speed=defaultLink;
-        usekbd=defaultSetKbd;
-        layout=defaultLayout[0];
-        type=defaultKbdType;
-        command=defaultCmd;
-        shadowSession=false;
-        for ( int j=0;j&lt;x2goServers.size();++j )
-        {
-            if ( x2goServers[j].connOk )
-            {
-                host=x2goServers[j].name;
-                break;
-            }
-        }
-        if ( host==QString::null )
-        {
-            QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),
-                                    tr ( &quot;No server availabel&quot; ),
-                                    QMessageBox::Ok,
-                                    QMessageBox::NoButton );
-            return;
-        }
-        sshConnection=findServerSshConnection(host);
-        if (!sshConnection)
-        {
-            QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),
-                                    tr ( &quot;Server not availabel&quot; ),
-                                    QMessageBox::Ok,
-                                    QMessageBox::NoButton );
-            return;
-        }
-    }
-    else
-    {
-        X2goSettings* st;
-
-        if (!brokerMode)
-            st=new X2goSettings( &quot;sessions&quot; );
-        else
-            st= new X2goSettings(config.iniFile,QSettings::IniFormat);
-
-        QString sid;
-        if ( !embedMode )
-            sid=lastSession-&gt;id();
-        else
-            sid=&quot;embedded&quot;;
-        pack=st-&gt;setting()-&gt;value ( sid+&quot;/pack&quot;,
-                                    ( QVariant ) defaultPack ).toString();
-        fullscreen=st-&gt;setting()-&gt;value ( sid+&quot;/fullscreen&quot;,
-                                          ( QVariant )
-                                          defaultFullscreen ).toBool();
-        height=st-&gt;setting()-&gt;value ( sid+&quot;/height&quot;,
-                                      ( QVariant ) defaultHeight ).toInt();
-        width=st-&gt;setting()-&gt;value ( sid+&quot;/width&quot;,
-                                     ( QVariant ) defaultWidth ).toInt();
-        setDPI=st-&gt;setting()-&gt;value ( sid+&quot;/setdpi&quot;,
-                                      ( QVariant ) defaultSetDPI ).toBool();
-        dpi=st-&gt;setting()-&gt;value ( sid+&quot;/dpi&quot;,
-                                   ( QVariant ) defaultDPI ).toUInt();
-        quality=st-&gt;setting()-&gt;value (
-                    sid+&quot;/quality&quot;,
-                    ( QVariant ) defaultQuality ).toInt();
-        speed=st-&gt;setting()-&gt;value ( sid+&quot;/speed&quot;,
-                                     ( QVariant ) defaultLink ).toInt();
-
-        usekbd=st-&gt;setting()-&gt;value ( sid+&quot;/usekbd&quot;,
-                                      ( QVariant ) defaultSetKbd ).toBool();
-        layout=st-&gt;setting()-&gt;value ( sid+&quot;/layout&quot;,
-                                      ( QVariant )
-                                      defaultLayout[0] ).toString();
-        type=st-&gt;setting()-&gt;value ( sid+&quot;/type&quot;,
-                                    ( QVariant )
-                                    defaultKbdType ).toString();
-        if ( !embedMode )
-        {
-            command=st-&gt;setting()-&gt;value ( sid+&quot;/command&quot;,
-                                           ( QVariant ) defaultCmd ).toString();
-            host=st-&gt;setting()-&gt;value (
-                     sid+&quot;/host&quot;,
-                     ( QVariant )
-                     ( QString ) &quot;localhost&quot; ).toString();
-
-            rootless=st-&gt;setting()-&gt;value ( sid+&quot;/rootless&quot;,
-                                            ( QVariant ) false ).toBool();
-            resumingSession.published=st-&gt;setting()-&gt;value ( sid+&quot;/published&quot;,
-                                      ( QVariant ) false ).toBool();
-            xdmcpServer=st-&gt;setting()-&gt;value ( sid+&quot;/xdmcpserver&quot;,
-                                               ( QVariant )
-                                               &quot;localhost&quot; ).toString();
-        }
-        else
-        {
-            command=config.command;
-            rootless= config.rootless;
-            host=config.server;
-            startEmbedded=false;
-            if ( st-&gt;setting()-&gt;value ( sid+&quot;/startembed&quot;,
-                                        ( QVariant ) true ).toBool() )
-            {
-                startEmbedded=true;
-                fullscreen=false;
-                height=bgFrame-&gt;size().height()-stb-&gt;height();
-                width=bgFrame-&gt;size().width();
-
-                if ( height&lt;0 ||width&lt;0 )
-                {
-                    height=defaultHeight;
-                    width=defaultWidth;
-                }
-            }
-            if ( config.confConSpd )
-                speed=config.conSpeed;
-            if ( config.confCompMet )
-                pack=config.compMet;
-            if ( config.confImageQ )
-                quality=config.imageQ;
-            if ( config.confDPI )
-            {
-                dpi=config.dpi;
-                setDPI=true;
-            }
-            if ( config.confKbd )
-            {
-                layout=config.kbdLay;
-                type=config.kbdType;
-                usekbd=true;
-            }
-        }
-        if ( command==&quot;RDP&quot; )
-            rootless=true;
-        if ( command==&quot;XDMCP&quot; )
-        {
-            runRemoteCommand=false;
-        }
-        delete st;
-    }
-
-
-    if ( shadowSession )
-    {
-        runRemoteCommand=false;
-    }
-
-    resumingSession.server=host;
-
-    if (defaultLayout.size()&gt;0)
-        layout=cbLayout-&gt;currentText();
-
-
-    QString geometry;
-#ifdef Q_OS_WIN
-    x2goDebug&lt;&lt;&quot;fullscreen: &quot;&lt;&lt;fullscreen;
-    maximizeProxyWin=false;
-    proxyWinWidth=width;
-    proxyWinHeight=height;
-//#ifdef CFGCLIENT
-    xorgMode=WIN;
-    if (fullscreen)
-        xorgMode=FS;
-    if (rootless)
-        xorgMode=SAPP;
-    xorgWidth=QString::number(width);
-    xorgHeight=QString::number(height);
-    if (! startXorgOnStart)
-        startXOrg();
-//#endif
-#endif
-    if ( fullscreen )
-    {
-        geometry=&quot;fullscreen&quot;;
-#ifdef Q_OS_WIN
-//        fullscreen=false;
-        maximizeProxyWin=true;
-        x2goDebug&lt;&lt;&quot;maximizeProxyWin: &quot;&lt;&lt;maximizeProxyWin;
-#endif
-    }
-    if ( ! fullscreen )
-    {
-        geometry=QString::number ( width ) +&quot;x&quot;+
-                 QString::number ( height );
-        if ( embedMode )
-        {
-            QPoint position=mapToGlobal ( bgFrame-&gt;pos() );
-            geometry+=&quot;+&quot;+QString::number ( position.x() ) +&quot;+&quot;+
-                      QString::number ( position.y() +
-                                        stb-&gt;height() );
-        }
-
-    }
-    QString link;
-    switch ( speed )
-    {
-    case MODEM:
-        link=&quot;modem&quot;;
-        break;
-    case ISDN:
-        link=&quot;isdn&quot;;
-        break;
-    case ADSL:
-        link=&quot;adsl&quot;;
-        break;
-    case WAN:
-        link=&quot;wan&quot;;
-        break;
-    case LAN:
-        link=&quot;lan&quot;;
-        break;
-    }
-
-    QFile file ( &quot;:/txt/packs&quot; );
-    if ( !file.open ( QIODevice::ReadOnly | QIODevice::Text ) )
-        return;
-    QTextStream in ( &amp;file );
-    while ( !in.atEnd() )
-    {
-        QString pc=in.readLine();
-        if ( pc.indexOf ( &quot;-%&quot; ) !=-1 )
-        {
-            pc=pc.left ( pc.indexOf ( &quot;-%&quot; ) );
-            if ( pc==pack )
-            {
-                pack+=&quot;-&quot;+QString::number ( quality );
-                break;
-            }
-        }
-    }
-    file.close();
-
-
-    if ( selectSessionDlg-&gt;isVisible() )
-    {
-        if ( !embedMode )
-            slotCloseSelectDlg();
-        else
-            selectSessionDlg-&gt;hide();
-    }
-    QDesktopWidget wd;
-    QString depth=QString::number ( wd.depth() );
-#ifdef Q_OS_DARWIN
-    usekbd=0;
-    type=&quot;query&quot;;
-#endif
-    QString sessTypeStr=&quot;D &quot;;
-    if ( rootless )
-        sessTypeStr=&quot;R &quot;;
-    if ( shadowSession )
-        sessTypeStr=&quot;S &quot;;
-    if ( resumingSession.published)
-    {
-        sessTypeStr=&quot;P &quot;;
-        command=&quot;PUBLISHED&quot;;
-    }
-    QString dpiEnv;
-    QString xdmcpEnv;
-    if ( runRemoteCommand==false &amp;&amp; command==&quot;XDMCP&quot; )
-        xdmcpEnv=&quot;X2GOXDMCP=&quot;+xdmcpServer+&quot; &quot;;
-    if ( setDPI )
-    {
-        dpiEnv=&quot;X2GODPI=&quot;+QString::number ( dpi ) +&quot; &quot;;
-    }
-    QString cmd=dpiEnv+xdmcpEnv+&quot;x2gostartagent &quot;+
-                geometry+&quot; &quot;+link+&quot; &quot;+pack+
-                &quot; unix-kde-depth_&quot;+depth+&quot; &quot;+layout+&quot; &quot;+type+&quot; &quot;;
-    if ( usekbd )
-        cmd += &quot;1 &quot;;
-    else
-        cmd += &quot;0 &quot;;
-    QFileInfo f ( command );
-    if ( !shadowSession )
-        cmd+=sessTypeStr+f.fileName();
-    else
-    {
-        cmd+=sessTypeStr+QString::number ( shadowMode ) +&quot;XSHAD&quot;+
-             shadowUser+&quot;XSHAD&quot;+shadowDisplay;
-    }
-    resumingSession.fullscreen=fullscreen;
-    x2goDebug&lt;&lt;cmd&lt;&lt;endl;
-    if ( managedMode )
-    {
-        slotRetResumeSess ( true,config.sessiondata,0 );
-        passForm-&gt;hide();
-        return;
-    }
-
-    SshProcess* proc=0l;
-
-    proc=new SshProcess ( sshConnection, this ) ;
-
-
-    connect ( proc,SIGNAL ( sshFinished ( bool, QString,SshProcess* ) ),
-              this,SLOT ( slotRetResumeSess ( bool,
-                                              QString,SshProcess* ) ) );
-
-    proc-&gt;startNormal ( cmd );
-    passForm-&gt;hide();
-}
-
-
-
-void ONMainWindow::resumeSession ( const x2goSession&amp; s )
-{
-    newSession=false;
-    applications.clear();
-    removeAppsFromTray();
-    QString passwd=getCurrentPass();
-    QString user=getCurrentUname();
-    QString host=s.server;
-    bool rootless=false;
-
-    QString pack;
-    bool fullscreen;
-    int height;
-    int width;
-    int quality;
-    int speed;
-    bool usekbd;
-    QString layout;
-    QString type;
-    removeAppsFromTray();
-
-    if ( useLdap )
-    {
-        pack=defaultPack;
-        fullscreen=defaultFullscreen;
-        height=defaultHeight;
-        width=defaultWidth;
-        quality=defaultQuality;
-        speed=defaultLink;
-        usekbd=defaultSetKbd;
-        layout=defaultLayout[0];
-        type=defaultKbdType;
-        sshConnection=findServerSshConnection(host);
-        if (!sshConnection)
-        {
-            QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),
-                                    tr ( &quot;Server not availabel&quot; ),
-                                    QMessageBox::Ok,
-                                    QMessageBox::NoButton );
-            return;
-        }
-    }
-    else
-    {
-
-        QString sid;
-        if ( !embedMode )
-            sid=lastSession-&gt;id();
-        else
-            sid=&quot;embedded&quot;;
-        X2goSettings* st;
-        if (!brokerMode)
-            st=new X2goSettings( &quot;sessions&quot; );
-        else
-            st=new X2goSettings(config.iniFile,QSettings::IniFormat);
-
-        pack=st-&gt;setting()-&gt;value ( sid+&quot;/pack&quot;,
-                                    ( QVariant ) defaultPack ).toString();
-
-        fullscreen=st-&gt;setting()-&gt;value ( sid+&quot;/fullscreen&quot;,
-                                          ( QVariant )
-                                          defaultFullscreen ).toBool();
-        height=st-&gt;setting()-&gt;value ( sid+&quot;/height&quot;,
-                                      ( QVariant ) defaultHeight ).toInt();
-        width=st-&gt;setting()-&gt;value ( sid+&quot;/width&quot;,
-                                     ( QVariant ) defaultWidth ).toInt();
-        quality=st-&gt;setting()-&gt;value ( sid+&quot;/quality&quot;,
-                                       ( QVariant )
-                                       defaultQuality ).toInt();
-        speed=st-&gt;setting()-&gt;value ( sid+&quot;/speed&quot;,
-                                     ( QVariant ) defaultLink ).toInt();
-        usekbd=st-&gt;setting()-&gt;value ( sid+&quot;/usekbd&quot;,
-                                      ( QVariant ) defaultSetKbd ).toBool();
-        layout=st-&gt;setting()-&gt;value ( sid+&quot;/layout&quot;,
-                                      ( QVariant )
-                                      defaultLayout[0] ).toString();
-        type=st-&gt;setting()-&gt;value ( sid+&quot;/type&quot;,
-                                    ( QVariant )
-                                    defaultKbdType ).toString();
-        rootless=st-&gt;setting()-&gt;value ( sid+&quot;/rootless&quot;,
-                                        ( QVariant ) false ).toBool();
-
-        if ( !embedMode )
-        {
-            host=st-&gt;setting()-&gt;value ( sid+&quot;/host&quot;,
-                                        ( QVariant ) s.server ).toString();
-        }
-        else
-        {
-            startEmbedded=false;
-            if ( st-&gt;setting()-&gt;value ( sid+&quot;/startembed&quot;,
-                                        ( QVariant ) true ).toBool() )
-            {
-                fullscreen=false;
-                startEmbedded=true;
-                height=bgFrame-&gt;size().height()-stb-&gt;height();
-                width=bgFrame-&gt;size().width();
-                if ( height&lt;0 ||width&lt;0 )
-                {
-                    height=defaultHeight;
-                    width=defaultWidth;
-                }
-            }
-            rootless=config.rootless;
-            host=config.server;
-            if ( config.confConSpd )
-                speed=config.conSpeed;
-            if ( config.confCompMet )
-                pack=config.compMet;
-            if ( config.confImageQ )
-                quality=config.imageQ;
-            if ( config.confKbd )
-            {
-                layout=config.kbdLay;
-                type=config.kbdType;
-                usekbd=true;
-            }
-        }
-        delete st;
-    }
-
-    if (defaultLayout.size()&gt;0)
-        layout=cbLayout-&gt;currentText();
-
-    QString geometry;
-#ifdef Q_OS_WIN
-    maximizeProxyWin=false;
-    proxyWinWidth=width;
-    proxyWinHeight=height;
-// #ifdef CFGCLIENT
-    xorgMode=WIN;
-    if (fullscreen)
-        xorgMode=FS;
-    if (rootless)
-        xorgMode=SAPP;
-    xorgWidth=QString::number(width);
-    xorgHeight=QString::number(height);
-    if (! startXorgOnStart)
-        startXOrg();
-// #endif
-
-#endif
-    if ( fullscreen )
-    {
-        geometry=&quot;fullscreen&quot;;
-#ifdef Q_OS_WIN
-//        fullscreen=false;
-        maximizeProxyWin=true;
-        x2goDebug&lt;&lt;&quot;maximizeProxyWin: &quot;&lt;&lt;maximizeProxyWin;
-
-#endif
-    }
-    if ( !fullscreen )
-    {
-        geometry=QString::number ( width ) +&quot;x&quot;+
-                 QString::number ( height );
-    }
-    resumingSession.fullscreen=fullscreen;
-    QString link;
-    switch ( speed )
-    {
-    case MODEM:
-        link=&quot;modem&quot;;
-        break;
-    case ISDN:
-        link=&quot;isdn&quot;;
-        break;
-    case ADSL:
-        link=&quot;adsl&quot;;
-        break;
-    case WAN:
-        link=&quot;wan&quot;;
-        break;
-    case LAN:
-        link=&quot;lan&quot;;
-        break;
-    }
-
-    QFile file ( &quot;:/txt/packs&quot; );
-    if ( !file.open ( QIODevice::ReadOnly | QIODevice::Text ) )
-        return;
-    QTextStream in ( &amp;file );
-    while ( !in.atEnd() )
-    {
-        QString pc=in.readLine();
-        if ( pc.indexOf ( &quot;-%&quot; ) !=-1 )
-        {
-            pc=pc.left ( pc.indexOf ( &quot;-%&quot; ) );
-            if ( pc==pack )
-            {
-                pack+=&quot;-&quot;+QString::number ( quality );
-                break;
-            }
-        }
-    }
-    file.close();
-
-#ifdef Q_OS_DARWIN
-    usekbd=0;
-    type=&quot;query&quot;;
-#endif
-
-    if (s.sessionId.indexOf(&quot;RPUBLISHED&quot;)!=-1)
-    {
-        resumingSession.published=true;
-        sbApps-&gt;setDisabled(true);
-    }
-    else
-        resumingSession.published=false;
-
-
-
-    if ( selectSessionDlg-&gt;isVisible() )
-    {
-        if ( !embedMode )
-            slotCloseSelectDlg();
-        else
-            selectSessionDlg-&gt;hide();
-    }
-    QString cmd=&quot;x2goresume-session &quot;+s.sessionId+&quot; &quot;+geometry+
-                &quot; &quot;+link+&quot; &quot;+pack+&quot; &quot;+layout+
-                &quot; &quot;+type+&quot; &quot;;
-    if ( usekbd )
-        cmd += &quot;1&quot;;
-    else
-        cmd += &quot;0&quot;;
-
-    SshProcess* proc=0l;
-    proc=new SshProcess ( sshConnection, this );
-
-    connect ( proc,SIGNAL ( sshFinished ( bool, QString,SshProcess* ) ),
-              this,SLOT ( slotRetResumeSess ( bool, QString,
-                                              SshProcess* ) ) );
-
-    proc-&gt;startNormal ( cmd );
-    resumingSession=s;
-    passForm-&gt;hide();
-}
-
-
-void ONMainWindow::selectSession ( QStringList&amp; sessions )
-{
-    setEnabled ( true );
-    sessionStatusDlg-&gt;hide();
-    passForm-&gt;hide();
-// 	x2goDebug&lt;&lt;&quot;check type&quot;;
-    if ( !shadowSession )
-    {
-// 		x2goDebug&lt;&lt;&quot;! shadow&quot;;
-        if ( !miniMode )
-            selectSesDlgLayout-&gt;setContentsMargins ( 25,25,10,10 );
-
-        bNew-&gt;show();
-        bSusp-&gt;show();
-        bTerm-&gt;show();
-        sOk-&gt;show();
-        sCancel-&gt;show();
-// 		x2goDebug&lt;&lt;&quot;standart buttons ok&quot;;
-        desktopFilter-&gt;hide();
-        desktopFilterCb-&gt;hide();
-        bShadow-&gt;hide();
-        bShadowView-&gt;hide();
-        bCancel-&gt;hide();
-// 		x2goDebug&lt;&lt;&quot;shadow buttons ok&quot;;
-// 		model-&gt;clear();
-        model-&gt;removeRows ( 0,model-&gt;rowCount() );
-        selectSessionLabel-&gt;setText ( tr ( &quot;Select session:&quot; ) );
-        selectedSessions.clear();
-        QFontMetrics fm ( sessTv-&gt;font() );
-        for ( int row = 0; row &lt; sessions.size(); ++row )
-        {
-
-// 			x2goDebug&lt;&lt;&quot;decoding sessionstr:&quot;&lt;&lt;sessions[row];
-            x2goSession s=getSessionFromString ( sessions[row] );
-// 			x2goDebug&lt;&lt;&quot;listing id:&quot;&lt;&lt;s.sessionId;
-            selectedSessions.append ( s );
-            QStandardItem *item;
-
-            item= new QStandardItem ( s.display );
-            model-&gt;setItem ( row,S_DISPLAY,item );
-
-            if ( s.status==&quot;R&quot; )
-                item= new QStandardItem ( tr ( &quot;running&quot; ) );
-            else
-                item= new QStandardItem ( tr ( &quot;suspended&quot; ) );
-            model-&gt;setItem ( row,S_STATUS,item );
-
-            item= new QStandardItem ( transAppName ( s.command ) );
-            model-&gt;setItem ( row,S_COMMAND,item );
-
-            QString type=tr ( &quot;Desktop&quot; );
-            if ( s.sessionType==x2goSession::ROOTLESS )
-                type=tr ( &quot;single application&quot; );
-            if ( s.sessionType==x2goSession::SHADOW )
-                type=tr ( &quot;shadow session&quot; );
-
-            item= new QStandardItem ( type );
-            model-&gt;setItem ( row,S_TYPE,item );
-
-            item= new QStandardItem ( s.crTime );
-            model-&gt;setItem ( row,S_CRTIME,item );
-            item= new QStandardItem ( s.server );
-            model-&gt;setItem ( row,S_SERVER,item );
-            item= new QStandardItem ( s.clientIp );
-            model-&gt;setItem ( row,S_IP,item );
-            item= new QStandardItem ( s.sessionId );
-            model-&gt;setItem ( row,S_ID,item );
-            for ( int j=0;j&lt;8;++j )
-            {
-                QString txt=
-                    model-&gt;index ( row,j ).data().toString();
-                if ( sessTv-&gt;header()-&gt;sectionSize ( j ) &lt;
-                        fm.width ( txt ) +6 )
-                {
-                    sessTv-&gt;header()-&gt;resizeSection (
-                        j,fm.width ( txt ) +6 );
-                }
-            }
-        }
-    }
-    else
-    {
-        shadowMode=SHADOW_VIEWONLY;
-        selectedDesktops.clear();
-        selectedDesktops=sessions;
-        if ( sessions.size() ==0 )
-        {
-            QMessageBox::information ( this,tr ( &quot;Information&quot; ),
-                                       tr ( &quot;No accessible desktop &quot;
-                                            &quot;found&quot; ) );
-            slotCloseSelectDlg();
-            return;
-        }
-        sessTv-&gt;setModel ( ( QAbstractItemModel* ) modelDesktop );
-        desktopFilter-&gt;show();
-        desktopFilterCb-&gt;show();
-        sOk-&gt;hide();
-        sCancel-&gt;hide();
-        bShadow-&gt;show();
-        bCancel-&gt;show();
-        bShadowView-&gt;show();
-        desktopFilter-&gt;setText ( tr ( &quot;Filter&quot; ) );
-        sessions.sort();
-        if ( !miniMode )
-            selectSesDlgLayout-&gt;setContentsMargins ( 25,25,25,25 );
-        bNew-&gt;hide();
-        bSusp-&gt;hide();
-        bTerm-&gt;hide();
-        selectSessionLabel-&gt;setText ( tr ( &quot;Select desktop:&quot; ) );
-        filterDesktops ( &quot;&quot; );
-        desktopFilter-&gt;setFocus();
-        desktopFilter-&gt;selectAll();
-    }
-    selectSessionDlg-&gt;show();
-}
-
-void ONMainWindow::slotCloseSelectDlg()
-{
-    selectSessionDlg-&gt;hide();
-    if ( !embedMode )
-    {
-        u-&gt;setEnabled ( true );
-        uname-&gt;setEnabled ( true );
-    }
-    slotShowPassForm();
-}
-
-
-
-void ONMainWindow::slotActivated ( const QModelIndex&amp; index )
-{
-    if ( !shadowSession )
-    {
-        QString status=sessTv-&gt;model()-&gt;index (
-                           index.row(),
-                           S_STATUS ).data().toString();
-        if ( status==tr ( &quot;running&quot; ) )
-        {
-            bSusp-&gt;setEnabled ( true );
-            sOk-&gt;setEnabled ( false );
-        }
-        else
-        {
-            bSusp-&gt;setEnabled ( false );
-            sOk-&gt;setEnabled ( true );
-        }
-        bTerm-&gt;setEnabled ( true );
-        if ( status==QString::null )
-        {
-            sOk-&gt;setEnabled ( false );
-            bTerm-&gt;setEnabled ( false );
-        }
-    }
-    else
-    {
-        QString user=sessTv-&gt;model()-&gt;index (
-                         index.row(),
-                         D_USER ).data().toString();
-        bShadowView-&gt;setEnabled ( true );
-        bShadow-&gt;setEnabled ( user==getCurrentUname() );
-    }
-}
-
-
-void ONMainWindow::slotResumeSess()
-{
-    x2goSession s=getSelectedSession();
-    QDesktopWidget wd;
-    if ( isColorDepthOk ( wd.depth(),s.colorDepth ) )
-        resumeSession ( s );
-    else
-    {
-        QString depth=QString::number ( s.colorDepth );
-        int res;
-        if ( s.colorDepth==24 || s.colorDepth==32 )
-        {
-            res=QMessageBox::warning (
-                    0l,tr ( &quot;Warning&quot; ),
-                    tr (
-                        &quot;Your current color depth is &quot;
-                        &quot;different to the color depth of your &quot;
-                        &quot;x2go-session. This may cause problems &quot;
-                        &quot;reconnecting to this session and in most &quot;
-                        &quot;cases &lt;b&gt;you will loose the session&lt;/b&gt; &quot;
-                        &quot;and have to start a new one! It's highly &quot;
-                        &quot;recommended to change the color depth of &quot;
-                        &quot;your Display to &quot; ) +tr ( &quot;24 or 32&quot; ) +
-                    tr (
-                        &quot; bit and restart your X-server before you &quot;
-                        &quot;reconnect to this x2go-session.&lt;br&gt;Resume &quot;
-                        &quot;this session anyway?&quot; ),tr ( &quot;Yes&quot; ),
-                    tr ( &quot;No&quot; ) );
-
-        }
-        else
-        {
-            res=QMessageBox::warning (
-                    0l,tr ( &quot;Warning&quot; ),
-                    tr (
-                        &quot;Your current color depth is different to &quot;
-                        &quot;the color depth of your x2go-session. &quot;
-                        &quot;This may cause problems reconnecting to &quot;
-                        &quot;this session and in most cases &lt;b&gt;you &quot;
-                        &quot;will loose the session&lt;/b&gt; and have to &quot;
-                        &quot;start a new one! It's highly recommended &quot;
-                        &quot;to change the color depth of your &quot;
-                        &quot;Display to &quot; ) +depth+
-                    tr (
-                        &quot; bit and restart your X-server before you &quot;
-                        &quot;reconnect to this x2go-session.&lt;br&gt;Resume &quot;
-                        &quot;this session anyway?&quot; ),tr ( &quot;Yes&quot; ),
-                    tr ( &quot;No&quot; ) );
-        }
-        if ( res==0 )
-            resumeSession ( s );
-    }
-
-}
-
-
-void ONMainWindow::slotSuspendSess()
-{
-
-    QString passwd;
-    QString user=getCurrentUname();
-
-    passwd=getCurrentPass();
-
-    selectSessionDlg-&gt;setEnabled ( false );
-
-
-    QString sessId=sessTv-&gt;model()-&gt;index (
-                       sessTv-&gt;currentIndex().row(),
-                       S_ID ).data().toString();
-    QString host=sessTv-&gt;model()-&gt;index (
-                     sessTv-&gt;currentIndex().row(),
-                     S_SERVER ).data().toString();
-    if ( !useLdap )
-    {
-        if ( !embedMode )
-        {
-            X2goSettings st ( &quot;sessions&quot; );
-            QString sid=lastSession-&gt;id();
-            host=st.setting()-&gt;value ( sid+&quot;/host&quot;,
-                                       ( QVariant ) host ).toString();
-        }
-        else
-        {
-            host=config.server;
-        }
-    }
-    else
-    {
-        sshConnection=findServerSshConnection(host);
-        if (!sshConnection)
-        {
-            QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),
-                                    tr ( &quot;Server not availabel&quot; ),
-                                    QMessageBox::Ok,
-                                    QMessageBox::NoButton );
-            return;
-        }
-    }
-
-
-    suspendSession ( sessId );
-}
-
-
-void ONMainWindow::slotSuspendSessFromSt()
-{
-    QString passwd;
-    QString user=getCurrentUname();
-    passwd=getCurrentPass();
-    setStatStatus ( tr ( &quot;suspending&quot; ) );
-
-
-    sbExp-&gt;setEnabled ( false );
-
-    if ( !shadowSession )
-        suspendSession ( resumingSession.sessionId );
-    else
-        termSession ( resumingSession.sessionId,false );
-}
-
-void ONMainWindow::slotTermSessFromSt()
-{
-
-    /*	x2goDebug &lt;&lt;&quot;disconnect export&quot;&lt;&lt;endl;
-    	disconnect ( sbExp,SIGNAL ( clicked() ),this,
-    	             SLOT ( slot_exportDirectory() ) );*/
-    sbExp-&gt;setEnabled ( false );
-
-    if ( !shadowSession )
-    {
-        if ( termSession ( resumingSession.sessionId ) )
-            setStatStatus ( tr ( &quot;terminating&quot; ) );
-    }
-    else
-        termSession ( resumingSession.sessionId,false );
-}
-
-
-void ONMainWindow::slotRetSuspSess ( bool result, QString output,
-                                     SshProcess* proc )
-{
-    if ( proc )
-        delete proc;
-    if ( result==false )
-    {
-        QString message=tr ( &quot;&lt;b&gt;Connection failed&lt;/b&gt;\n&quot; ) +output;
-        if ( message.indexOf ( &quot;publickey,password&quot; ) !=-1 )
-        {
-            message=tr (
-                        &quot;&lt;b&gt;Wrong password!&lt;/b&gt;&lt;br&gt;&lt;br&gt;&quot; ) +message;
-        }
-
-        QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),message,
-                                QMessageBox::Ok,
-                                QMessageBox::NoButton );
-    }
-    else
-    {
-        if ( selectSessionDlg-&gt;isVisible() )
-        {
-            ( ( QStandardItemModel* )
-              ( sessTv-&gt;model() ) )-&gt;item (
-                  sessTv-&gt;currentIndex().row(),
-                  S_STATUS )-&gt;setData (
-                      QVariant ( ( QString ) tr ( &quot;suspended&quot; ) ),
-                      Qt::DisplayRole );
-            bSusp-&gt;setEnabled ( false );
-            sOk-&gt;setEnabled ( true );
-
-        }
-    }
-    if ( selectSessionDlg-&gt;isVisible() )
-        selectSessionDlg-&gt;setEnabled ( true );
-}
-
-
-
-void ONMainWindow::slotTermSess()
-{
-
-    selectSessionDlg-&gt;setEnabled ( false );
-
-
-    QString sessId=sessTv-&gt;model()-&gt;index ( sessTv-&gt;currentIndex().row(),
-                                            S_ID ).data().toString();
-
-    if ( !useLdap )
-    {
-        if ( !embedMode )
-        {
-            X2goSettings st ( &quot;sessions&quot; );
-
-            QString sid=lastSession-&gt;id();
-        }
-    }
-    else
-    {
-        QString host=sessTv-&gt;model()-&gt;index ( sessTv-&gt;currentIndex().row(),
-                                              S_SERVER ).data().toString();
-
-        sshConnection=findServerSshConnection(host);
-        if (!sshConnection)
-        {
-            QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),
-                                    tr ( &quot;Server not availabel&quot; ),
-                                    QMessageBox::Ok,
-                                    QMessageBox::NoButton );
-            return;
-        }
-    }
-
-    termSession ( sessId );
-}
-
-
-void ONMainWindow::slotNewSess()
-{
-    startNewSession();
-}
-
-
-void ONMainWindow::slotRetTermSess ( bool result,  QString output,
-                                     SshProcess* proc )
-{
-    bool nodel= ( proc==0 );
-    if ( proc )
-        delete proc;
-    if ( result==false )
-    {
-        QString message=tr ( &quot;&lt;b&gt;Connection failed&lt;/b&gt;\n&quot; ) +output;
-        if ( message.indexOf ( &quot;publickey,password&quot; ) !=-1 )
-        {
-            message=tr (
-                        &quot;&lt;b&gt;Wrong password!&lt;/b&gt;&lt;br&gt;&lt;br&gt;&quot; ) +message;
-        }
-
-        QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),
-                                message,QMessageBox::Ok,
-                                QMessageBox::NoButton );
-    }
-    else
-    {
-        if ( selectSessionDlg-&gt;isVisible() &amp;&amp;!nodel )
-        {
-            sessTv-&gt;model()-&gt;removeRow (
-                sessTv-&gt;currentIndex().row() );
-            slotActivated ( sessTv-&gt;currentIndex() );
-        }
-    }
-    if ( selectSessionDlg-&gt;isVisible() )
-        selectSessionDlg-&gt;setEnabled ( true );
-}
-
-void ONMainWindow::slotRetResumeSess ( bool result,
-                                       QString output,
-                                       SshProcess* proc )
-{
-    if ( proc )
-        delete proc;
-    x2goDebug&lt;&lt;&quot;Agent output:&quot;&lt;&lt;output;
-    if ( result==false )
-    {
-        QString message=tr ( &quot;&lt;b&gt;Connection failed&lt;/b&gt;\n&quot; ) +output;
-        if ( message.indexOf ( &quot;publickey,password&quot; ) !=-1 )
-        {
-            message=tr (
-                        &quot;&lt;b&gt;Wrong Password!&lt;/b&gt;&lt;br&gt;&lt;br&gt;&quot; ) +message;
-        }
-        if ( output.indexOf ( &quot;LIMIT&quot; ) !=-1 )
-        {
-            QString sessions=output.mid (
-                                 output.indexOf ( &quot;LIMIT&quot; ) +6 );
-
-            message=&quot;Sessions limit reached:&quot;+sessions;
-        }
-        if ( output.indexOf ( &quot;ACCESS DENIED&quot; ) !=-1 )
-        {
-            message=&quot;Access denied from user&quot;;
-        }
-
-        QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),
-                                message,QMessageBox::Ok,
-                                QMessageBox::NoButton );
-        slotShowPassForm();
-        return;
-    }
-
-    output.replace ( &quot; &quot;,&quot;&quot; );
-    QString passwd=getCurrentPass();
-    QString user=getCurrentUname();
-    QString host;
-
-    bool sound=true;
-    int sndSystem=PULSE;
-    QString sndPort;
-#ifndef Q_OS_WIN
-    sndPort=&quot;4713&quot;;
-#endif
-    bool startSoundServer=true;
-    bool sshSndTunnel=true;
-
-    if ( useLdap )
-    {
-        sound=startSound;
-        startSoundServer=LDAPSndStartServer;
-        if ( LDAPSndSys==&quot;arts&quot; )
-            sndSystem=ARTS;
-        if ( LDAPSndSys==&quot;esd&quot; )
-            sndSystem=ESD;
-        sndPort=LDAPSndPort;
-    }
-    else
-    {
-        QString sid;
-        if ( !embedMode )
-            sid=lastSession-&gt;id();
-        else
-            sid=&quot;embedded&quot;;
-        X2goSettings st ( &quot;sessions&quot; );
-
-        sound=st.setting()-&gt;value ( sid+&quot;/sound&quot;,
-                                    ( QVariant ) true ).toBool();
-        QString sndsys=st.setting()-&gt;value (
-                           sid+&quot;/soundsystem&quot;,
-                           ( QVariant ) &quot;pulse&quot; ).toString();
-        if ( sndsys==&quot;arts&quot; )
-            sndSystem=ARTS;
-        if ( sndsys==&quot;esd&quot; )
-            sndSystem=ESD;
-#ifndef Q_OS_WIN
-        sndPort=st.setting()-&gt;value ( sid+&quot;/sndport&quot; ).toString();
-#endif
-        startSoundServer=st.setting()-&gt;value (
-                             sid+&quot;/startsoundsystem&quot;,
-                             true ).toBool();
-
-        if ( embedMode&amp;&amp;config.confSnd )
-        {
-            sound=config.useSnd;
-        }
-
-
-#ifndef Q_OS_WIN
-        bool defPort=st.setting()-&gt;value ( sid+
-                                           &quot;/defsndport&quot;,true ).toBool();
-        if ( defPort )
-        {
-            switch ( sndSystem )
-            {
-            case PULSE:
-                sndPort=&quot;4713&quot;;
-                break;
-            case ESD:
-                sndPort=&quot;16001&quot;;
-                break;
-            }
-        }
-#endif
-        sshSndTunnel=st.setting()-&gt;value ( sid+&quot;/soundtunnel&quot;,
-                                           true ).toBool();
-
-#ifdef Q_OS_WIN
-        switch ( sndSystem )
-        {
-        case PULSE:
-            sndPort=QString::number ( pulsePort );
-            break;
-        case ESD:
-            sndPort=QString::number ( esdPort );
-            break;
-        }
-#endif
-    }
-
-    //Will be used in runCommand
-    startSessSound=sound;
-    startSessSndSystem=sndSystem;
-
-    if ( newSession )
-    {
-        QString sString=output.trimmed();
-        sString.replace ( '\n','|' );
-        host=resumingSession.server;
-        resumingSession=getNewSessionFromString ( sString );
-        resumingSession.server=host;
-        resumingSession.crTime=QDateTime::currentDateTime().toString (
-                                   &quot;dd.MM.yy HH:mm:ss&quot; );
-        if ( managedMode )
-        {
-            //replace session data for future resuming
-            config.sessiondata=resumingSession.agentPid+&quot;|&quot;+
-                               resumingSession.sessionId+&quot;|&quot;+
-                               resumingSession.display+&quot;|&quot;+
-                               resumingSession.server+&quot;|&quot;+
-                               &quot;S|&quot;+
-                               resumingSession.crTime+&quot;|&quot;+
-                               resumingSession.cookie+&quot;|&quot;+
-                               resumingSession.clientIp+&quot;|&quot;+
-                               resumingSession.grPort+&quot;|&quot;+
-                               resumingSession.sndPort+&quot;|&quot;+
-                               resumingSession.crTime+&quot;|&quot;+
-                               user+&quot;|&quot;+
-                               &quot;0|&quot;+
-                               resumingSession.fsPort;
-        }
-    }
-    else
-    {
-        host=resumingSession.server;
-        QStringList outputLines=output.split(&quot;\n&quot;,QString::SkipEmptyParts);
-        foreach(QString line,outputLines)
-        {
-            if (line.indexOf(&quot;gr_port=&quot;)!=-1)
-            {
-                resumingSession.grPort=line.replace(&quot;gr_port=&quot;,&quot;&quot;);
-                x2goDebug&lt;&lt;&quot;new gr_port: &quot;&lt;&lt;resumingSession.grPort&lt;&lt;endl;
-            }
-            if (line.indexOf(&quot;sound_port=&quot;)!=-1)
-            {
-                resumingSession.sndPort=line.replace(&quot;sound_port=&quot;,&quot;&quot;);
-                x2goDebug&lt;&lt;&quot;new sound_port: &quot;&lt;&lt;resumingSession.sndPort&lt;&lt;endl;
-            }
-            if (line.indexOf(&quot;fs_port=&quot;)!=-1)
-            {
-                resumingSession.fsPort=line.replace(&quot;fs_port=&quot;,&quot;&quot;);
-                x2goDebug&lt;&lt;&quot;new fs_port: &quot;&lt;&lt;resumingSession.fsPort&lt;&lt;endl;
-            }
-        }
-        if (resumingSession.published)
-            readApplications();
-    }
-    if ( !useLdap )
-    {
-        if ( !embedMode )
-        {
-            X2goSettings st ( &quot;sessions&quot; );
-
-            QString sid=lastSession-&gt;id();
-            host=st.setting()-&gt;value ( sid+&quot;/host&quot;,
-                                       ( QVariant ) host ).toString();
-        }
-        else
-            host=config.server;
-        resumingSession.server=host;
-    }
-    tunnel=new SshProcess ( sshConnection, this );
-
-    connect ( tunnel,SIGNAL ( sshFinished ( bool,  QString,SshProcess* ) ),
-              this,SLOT ( slotTunnelFailed ( bool,
-                                             QString,SshProcess* ) ) );
-    connect ( tunnel,SIGNAL ( sshTunnelOk() ),
-              this,SLOT ( slotTunnelOk() ) );
-
-    localGraphicPort=resumingSession.grPort;
-    int iport=localGraphicPort.toInt() +1000;
-    while ( iport == resumingSession.sndPort.toInt() ||
-            iport == resumingSession.fsPort.toInt() ||
-            isServerRunning ( iport ) )
-        ++iport;
-    localGraphicPort=QString::number ( iport );
-
-    tunnel-&gt;startTunnel ( &quot;localhost&quot;,resumingSession.grPort.toInt(),&quot;localhost&quot;,
-                          localGraphicPort.toInt() );
-    if ( shadowSession )
-        return;
-
-    sndTunnel=0l;
-    if ( sound )
-    {
-        if ( sndSystem==PULSE )
-        {
-            startSoundServer=false;
-            QString scmd;
-            if ( !sshSndTunnel )
-                scmd=&quot;echo \&quot;default-server=`echo &quot;
-                     &quot;$SSH_CLIENT | awk '{print $1}'`:&quot;+
-                     sndPort+
-                     &quot;\&quot;&gt; ~/.x2go/C-&quot;+
-                     resumingSession.sessionId+
-                     &quot;/.pulse-client.conf&quot;
-                     &quot;;echo \&quot;cookie-file=.x2go/C-&quot;+
-                     resumingSession.sessionId+
-                     &quot;/.pulse-cookie&quot;+
-                     &quot;\&quot;&gt;&gt; ~/.x2go/C-&quot;+
-                     resumingSession.sessionId+
-                     &quot;/.pulse-client.conf&quot;;
-            else
-                scmd=&quot;echo \&quot;default-server=localhost:&quot;+
-                     resumingSession.sndPort+
-                     &quot;\&quot;&gt; ~/.x2go/C-&quot;+
-                     resumingSession.sessionId+
-                     &quot;/.pulse-client.conf&quot;
-                     &quot;;echo \&quot;cookie-file=.x2go/C-&quot;+
-                     resumingSession.sessionId+
-                     &quot;/.pulse-cookie&quot;+
-                     &quot;\&quot;&gt;&gt; ~/.x2go/C-&quot;+
-                     resumingSession.sessionId+
-                     &quot;/.pulse-client.conf&quot;;
-            SshProcess* paProc;
-            paProc=new SshProcess ( sshConnection, this );
-            paProc-&gt;startNormal ( scmd );
-
-            bool sysPulse=false;
-#ifdef Q_OS_LINUX
-            loadPulseModuleNativeProtocol();
-            QFile file ( &quot;/etc/default/pulseaudio&quot; );
-            if ( file.open ( QIODevice::ReadOnly |
-                             QIODevice::Text ) )
-            {
-
-                while ( !file.atEnd() )
-                {
-                    QByteArray line = file.readLine();
-                    int pos=line.indexOf (
-                                &quot;PULSEAUDIO_SYSTEM_START=1&quot;
-                            );
-                    if ( pos!=-1 )
-                    {
-                        int commentPos=line.indexOf (
-                                           &quot;#&quot; );
-                        if ( commentPos==-1 ||
-                                commentPos&gt;pos )
-                        {
-                            sysPulse=true;
-                            break;
-                        }
-                    }
-                }
-                file.close();
-            }
-#endif
-            if ( sysPulse )
-                paProc-&gt;start_cp (
-                    &quot;/var/run/pulse/.pulse-cookie&quot;,
-                    &quot;~/.x2go/C-&quot;+
-                    resumingSession.sessionId+
-                    &quot;/.pulse-cookie&quot; );
-            else
-            {
-#ifndef Q_OS_WIN
-                paProc-&gt;start_cp ( homeDir+&quot;/.pulse-cookie&quot;,
-                                   &quot;~/.x2go/C-&quot;+
-                                   resumingSession.sessionId+
-                                   &quot;/.pulse-cookie&quot; );
-#else
-                QString cooFile=
-                    wapiShortFileName ( homeDir )  +
-                    &quot;/.x2go/pulse/.pulse-cookie&quot;;
-                QString destFile=&quot;~/.x2go/C-&quot;+
-                                 resumingSession.sessionId+
-                                 &quot;/.pulse-cookie&quot;;
-                paProc-&gt;start_cp ( cooFile,
-                                   destFile );
-
-                /*x2goDebug&lt;&lt;&quot;cookie file: &quot;&lt;&lt;cooFile
-                &lt;&lt;&quot; remote:&quot;&lt;&lt;
-                destFile&lt;&lt;endl;*/
-                connect ( paProc,
-                          SIGNAL (
-                              sshFinished ( bool,
-                                            QString,
-                                            SshProcess* ) ),
-                          this,
-                          SLOT (
-                              slotPCookieReady ( bool,
-                                                 QString,
-                                                 SshProcess* )
-                          ) );
-                parecTunnelOk=true;
-#endif
-            }
-        }
-        if ( sndSystem==ESD )
-        {
-            SshProcess* paProc;
-            paProc=new SshProcess ( sshConnection, this );
-#ifndef Q_OS_WIN
-            paProc-&gt;start_cp ( homeDir+&quot;/.esd_auth&quot;,
-                               &quot;~/.esd_auth&quot; );
-#else
-            QString cooFile=
-                wapiShortFileName ( homeDir )  +
-                &quot;/.x2go/pulse/.esd_auth&quot;;
-            QString destFile=&quot;~/.esd_auth&quot;;
-            paProc-&gt;start_cp ( cooFile,
-                               destFile );
-#endif
-        }
-#ifndef Q_OS_WIN
-        if ( startSoundServer )
-        {
-            soundServer=new QProcess ( this );
-            QString acmd=&quot;artsd&quot;,ecmd=&quot;esd&quot;;
-#ifdef Q_OS_DARWIN
-            QStringList env = soundServer-&gt;environment();
-            QDir dir ( appDir );
-            dir.cdUp();
-            dir.cd ( &quot;esd&quot; );
-            env.insert ( 0,&quot;DYLD_LIBRARY_PATH=&quot;+
-                         dir.absolutePath() );
-            soundServer-&gt;setEnvironment ( env );
-            ecmd=&quot;\&quot;&quot;+dir.absolutePath() +&quot;\&quot;/esd&quot;;
-#endif //Q_OS_DARWIN
-            if ( sndSystem==ESD )
-                soundServer-&gt;start (
-                    ecmd+
-                    &quot; -tcp -nobeeps -bind localhost -port &quot;+
-                    resumingSession.sndPort );
-            if ( sndSystem==ARTS )
-                soundServer-&gt;start ( acmd+&quot; -u -N -p &quot;+
-                                     resumingSession.sndPort );
-            sndPort=resumingSession.sndPort;
-        }
-#endif //Q_OS_WIN
-        if ( sshSndTunnel )
-        {
-            sndTunnel=new SshProcess ( sshConnection, this );
-
-#ifdef Q_OS_WIN
-            if ( sndSystem==PULSE )
-            {
-                parecTunnelOk=false;
-                connect ( sndTunnel,SIGNAL ( sshTunnelOk() ),
-                          this,SLOT ( slotSndTunOk() ) );
-            }
-#endif
-            connect ( sndTunnel,SIGNAL ( sshFinished ( bool,
-                                         QString,
-                                         SshProcess* ) ),
-                      this,SLOT (
-                          slotSndTunnelFailed ( bool,
-                                                QString,
-                                                SshProcess* ) ) );
-
-            sndTunnel-&gt;startTunnel (
-                &quot;localhost&quot;,
-                resumingSession.sndPort.toInt(),&quot;127.0.0.1&quot;,
-                sndPort.toInt(),true );
-            /*x2goDebug&lt;&lt;&quot;starting tunnel, local port:&quot;&lt;&lt;
-            	sndPort&lt;&lt;&quot;, remote: &quot;&lt;&lt;
-            	resumingSession.sndPort&lt;&lt;
-            	endl;*/
-        }
-    }
-}
-
-
-
-x2goSession ONMainWindow::getSelectedSession()
-{
-    QString sessId=sessTv-&gt;model()-&gt;index ( sessTv-&gt;currentIndex().row(),
-                                            S_ID ).data().toString();
-    for ( int i=0;i&lt;selectedSessions.size();++i )
-    {
-        if ( selectedSessions[i].sessionId==sessId )
-            return selectedSessions[i];
-    }
-    return selectedSessions[0]; //warning !!!!! undefined session
-}
-
-
-void ONMainWindow::slotTunnelOk()
-{
-
-#ifdef Q_OS_WIN
-    //waiting for X
-    if ( !winServersReady )
-    {
-        x2goDebug&lt;&lt;&quot;waiting for win-servers&quot;;
-        QTimer::singleShot ( 100, this, SLOT ( slotTunnelOk() ) );
-        return;
-    }
-#endif
-
-    showExport=false;
-    QString nxroot=homeDir +&quot;/.x2go&quot;;
-    QString dirpath=nxroot+&quot;/S-&quot;+resumingSession.sessionId;
-    QDir d ( dirpath );
-    if ( !d.exists() )
-        if ( !d.mkpath ( dirpath ) )
-        {
-            QString message=tr ( &quot;Unable to create folder:&quot; ) +
-                            dirpath;
-            QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),message,
-                                    QMessageBox::Ok,
-                                    QMessageBox::NoButton );
-            slotShowPassForm();
-            if ( tunnel )
-                delete tunnel;
-            if ( sndTunnel )
-                delete sndTunnel;
-            if ( fsTunnel )
-                delete fsTunnel;
-            if ( soundServer )
-                delete soundServer;
-            tunnel=sndTunnel=fsTunnel=0l;
-            soundServer=0l;
-            nxproxy=0l;
-            return;
-        }
-#ifdef Q_OS_WIN
-    dirpath=wapiShortFileName ( dirpath );
-    nxroot=wapiShortFileName ( nxroot );
-#endif
-    QFile file ( dirpath+&quot;/options&quot; );
-    if ( !file.open ( QIODevice::WriteOnly | QIODevice::Text ) )
-    {
-        QString message=tr ( &quot;Unable to write file:&quot; ) +
-                        dirpath+&quot;/options&quot;;
-        QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),message,
-                                QMessageBox::Ok,
-                                QMessageBox::NoButton );
-        slotShowPassForm();
-        return;
-    }
-
-    QTextStream out ( &amp;file );
-#ifdef Q_OS_WIN
-    dirpath=cygwinPath ( dirpath );
-    nxroot=cygwinPath ( nxroot );
-#endif
-    out &lt;&lt; &quot;nx/nx,root=&quot;&lt;&lt;nxroot&lt;&lt;&quot;,connect=localhost,cookie=&quot;&lt;&lt;
-    resumingSession.cookie&lt;&lt;&quot;,port=&quot;
-    &lt;&lt;localGraphicPort/*resumingSession.grPort*/&lt;&lt;
-    &quot;,errors=&quot;&lt;&lt;dirpath&lt;&lt;&quot;/sessions:&quot;&lt;&lt;
-    resumingSession.display;
-    file.close();
-    xmodExecuted=false;
-
-
-    nxproxy=new QProcess;
-    QStringList env = QProcess::systemEnvironment();
-    QString x2golibpath=&quot;/usr/lib/x2go&quot;;
-#if defined ( Q_OS_WIN ) || defined ( Q_OS_DARWIN )
-    int dispInd=-1;
-#endif
-    for ( int l=0;l&lt;env.size();++l )
-    {
-// 		x2goDebug&lt;&lt;env[l]&lt;&lt;endl;
-        if ( env[l].indexOf ( &quot;X2GO_LIB&quot; ) ==0 )
-        {
-            x2golibpath=env[l].split ( &quot;=&quot; ) [1];
-        }
-#if defined ( Q_OS_WIN ) || defined ( Q_OS_DARWIN )
-        if ( env[l].indexOf ( &quot;DISPLAY&quot; ) ==0 )
-        {
-            dispInd=l;
-        }
-#endif
-    }
-    env &lt;&lt; &quot;LD_LIBRARY_PATH=&quot;+x2golibpath;
-    env &lt;&lt; &quot;NX_CLIENT=&quot;+QCoreApplication::applicationFilePath ();
-
-#if defined ( Q_OS_WIN ) || defined ( Q_OS_DARWIN )
-    // On Mac OS X, we want to make sure that DISPLAY is set to a proper value,
-    // but at the same time don't want to set the value ourselves but keep
-    // the provided one.
-    QString disp=getXDisplay();
-    if ( disp==QString::null )
-    {
-        //slotProxyerror ( QProcess::FailedToStart );
-        return;
-    }
-#endif // Q_OS_WIN || Q_OS_DARWIN
-#if defined ( Q_OS_WIN )
-    if ( dispInd==-1 )
-    {
-        env &lt;&lt;&quot;DISPLAY=localhost:&quot;+disp;
-        /*		x2goDebug&lt;&lt;&quot;new env DISPLAY&quot;&lt;&lt;&quot;DISPLAY=localhost:&quot;+disp&lt;&lt;endl;*/
-    }
-    else
-    {
-        env[dispInd]=&quot;DISPLAY=localhost:&quot;+disp;
-        /*		x2goDebug&lt;&lt;&quot;existing env DISPLAY(&quot;&lt;&lt;dispInd&lt;&lt;
-        		&quot;) DISPLAY=localhost:&quot;+disp&lt;&lt;endl;*/
-    }
-#endif // Q_OS_WIN
-#if defined ( Q_OS_DARWIN )
-    //setting /usr/X11/bin to find xauth
-    env.insert (
-        0,
-        &quot;PATH=/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/usr/X11/bin&quot; );
-#endif
-    nxproxy-&gt;setEnvironment ( env );
-    /*	x2goDebug&lt;&lt;&quot;new env:&quot;&lt;&lt;endl;
-    	for ( int l=0;l&lt;env.size();++l )
-    	{
-    		x2goDebug&lt;&lt;env[l]&lt;&lt;endl;
-    	}
-    	x2goDebug&lt;&lt;&quot;##########################&quot;&lt;&lt;endl;*/
-    connect ( nxproxy,SIGNAL ( error ( QProcess::ProcessError ) ),this,
-              SLOT ( slotProxyError ( QProcess::ProcessError ) ) );
-    connect ( nxproxy,SIGNAL ( finished ( int,QProcess::ExitStatus ) ),this,
-              SLOT ( slotProxyFinished ( int,QProcess::ExitStatus ) ) );
-    connect ( nxproxy,SIGNAL ( readyReadStandardError() ),this,
-              SLOT ( slotProxyStderr() ) );
-    connect ( nxproxy,SIGNAL ( readyReadStandardOutput() ),this,
-              SLOT ( slotProxyStdout() ) );
-
-    QString proxyCmd=&quot;nxproxy -S nx/nx,options=&quot;+dirpath+&quot;/options:&quot;+
-                     resumingSession.display;
-#ifdef Q_OS_DARWIN
-    //run nxproxy from bundle
-    QDir dir ( appDir );
-    dir.cdUp();
-    dir.cd ( &quot;exe&quot; );
-    proxyCmd=&quot;\&quot;&quot;+dir.absolutePath() +&quot;/\&quot;&quot;+proxyCmd;
-#endif //Q_OS_DARWIN
-    x2goDebug&lt;&lt;&quot;starting nxproxy with: &quot;&lt;&lt;proxyCmd&lt;&lt;endl;
-    nxproxy-&gt;start ( proxyCmd );
-//always search for proxyWin
-    proxyWinTimer-&gt;start ( 300 );
-    if ( embedMode )
-    {
-//         proxyWinTimer-&gt;start ( 300 );
-        if ( !startEmbedded )
-        {
-            act_embedContol-&gt;setText (
-                tr ( &quot;Attach X2Go window&quot; ) );
-        }
-    }
-#ifdef Q_OS_WIN
-    else
-    {
-// #ifdef CFGCLIENT
-//         // if using XMing, we must find proxy win for case, that we should make it fullscreen
-        //         if(useInternalX&amp;&amp; (internalX==XMING))
-// #endif
-//         proxyWinTimer-&gt;start ( 300 );
-    }
-#endif
-
-    showSessionStatus();
-    QTimer::singleShot ( 30000,this,SLOT ( slotRestartProxy() ) );
-
-}
-
-void ONMainWindow::slotTunnelFailed ( bool result,  QString output,
-                                      SshProcess* )
-{
-    if ( result==false )
-    {
-        if ( !managedMode )
-        {
-            QString message=tr ( &quot;Unable to create SSL tunnel:\n&quot; )
-                            +output;
-            QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),message,
-                                    QMessageBox::Ok,
-                                    QMessageBox::NoButton );
-        }
-        if ( tunnel )
-            delete tunnel;
-        if ( sndTunnel )
-            delete sndTunnel;
-        if ( fsTunnel )
-            delete fsTunnel;
-        if ( soundServer )
-            delete soundServer;
-        tunnel=sndTunnel=fsTunnel=0l;
-        soundServer=0l;
-        nxproxy=0l;
-        if ( !managedMode )
-            slotShowPassForm();
-    }
-}
-
-void ONMainWindow::slotSndTunnelFailed ( bool result,  QString output,
-        SshProcess* )
-{
-    if ( result==false )
-    {
-        if ( !managedMode )
-        {
-            QString message=tr ( &quot;Unable to create SSL Tunnel:\n&quot; )
-                            +output;
-            QMessageBox::warning ( 0l,tr ( &quot;Warning&quot; ),message,
-                                   QMessageBox::Ok,
-                                   QMessageBox::NoButton );
-        }
-        if ( sndTunnel )
-            delete sndTunnel;
-        sndTunnel=0l;
-    }
-}
-
-
-
-void ONMainWindow::slotProxyError ( QProcess::ProcessError )
-{
-    slotProxyFinished ( -1,QProcess::CrashExit );
-}
-
-
-void ONMainWindow::slotProxyFinished ( int,QProcess::ExitStatus )
-{
-    if ( embedMode )
-    {
-        if ( proxyWinEmbedded )
-        {
-#ifdef CFGPLUGIN
-            detachClient();
-#endif
-        }
-        proxyWinTimer-&gt;stop();
-        setEmbedSessionActionsEnabled ( false );
-    }
-#ifdef Q_OS_WIN
-    else
-        proxyWinTimer-&gt;stop();
-// #ifdef CFGCLIENT
-    if (! startXorgOnStart)
-    {
-        if (xorg)
-        {
-            if (xorg-&gt;state() ==QProcess::Running)
-            {
-                xorg-&gt;terminate();
-                delete xorg;
-                xorg=0;
-            }
-        }
-    }
-// #endif
-#endif
-    if ( closeEventSent )
-        return;
-    if ( tunnel )
-        delete tunnel;
-    if ( sndTunnel )
-        delete sndTunnel;
-    if ( fsTunnel )
-        delete fsTunnel;
-    if ( soundServer )
-        delete soundServer;
-    if ( spoolTimer )
-        delete spoolTimer;
-
-    x2goDebug&lt;&lt;&quot;deleting proxy&quot;&lt;&lt;endl;
-    disconnect ( nxproxy,SIGNAL ( error ( QProcess::ProcessError ) ),this,
-                 SLOT ( slotProxyError ( QProcess::ProcessError ) ) );
-    disconnect ( nxproxy,SIGNAL ( finished ( int,QProcess::ExitStatus ) ),this,
-                 SLOT ( slotProxyFinished ( int,QProcess::ExitStatus ) ) );
-    disconnect ( nxproxy,SIGNAL ( readyReadStandardError() ),this,
-                 SLOT ( slotProxyStderr() ) );
-    disconnect ( nxproxy,SIGNAL ( readyReadStandardOutput() ),this,
-                 SLOT ( slotProxyStdout() ) );
-#ifndef CFGPLUGIN
-    if (trayEnabled)
-    {
-        trayIconActiveConnectionMenu-&gt;setTitle(tr(&quot;Not connected&quot;));
-        trayIconActiveConnectionMenu-&gt;setEnabled(false);
-        if (trayMaxDiscon)
-            showNormal();
-    }
-    trayAutoHidden=false;
-#endif
-
-
-#if ! (defined(Q_OS_WIN) &amp;&amp; defined (CFGPLUGIN))
-    if ( nxproxy )
-    {
-        if ( nxproxy-&gt;state() ==QProcess::Running )
-        {
-            x2goDebug&lt;&lt;&quot;waiting for proxy to exit&quot;&lt;&lt;endl;
-            if ( !nxproxy-&gt;waitForFinished ( 3000 ) )
-            {
-                x2goDebug&lt;&lt;&quot;Failed, try to kill&quot;&lt;&lt;endl;
-                nxproxy-&gt;kill();
-            }
-        }
-        x2goDebug&lt;&lt;&quot;nxproxy not running&quot;&lt;&lt;endl;
-        delete nxproxy;
-    }
-#endif
-    x2goDebug&lt;&lt;&quot;proxy deleted&quot;&lt;&lt;endl;
-    spoolTimer=0l;
-    tunnel=sndTunnel=fsTunnel=0l;
-    soundServer=0l;
-    nxproxy=0l;
-    proxyWinId=0;
-
-    if ( !shadowSession &amp;&amp; !usePGPCard &amp;&amp; ! ( embedMode &amp;&amp;
-            ( config.checkexitstatus==false ) ) )
-        check_cmd_status();
-    else
-        sshConnection-&gt;disconnectSession();
-    if ( startHidden )
-        close();
-
-    if ( readExportsFrom!=QString::null )
-    {
-        exportTimer-&gt;stop();
-        if ( extLogin )
-        {
-            currentKey=QString::null;
-        }
-    }
-    if ( printSupport )
-        cleanPrintSpool();
-    if ( !restartResume )
-    {
-        if ( !embedMode )
-        {
-            if (!brokerMode)
-            {
-                pass-&gt;setText ( &quot;&quot; );
-                QTimer::singleShot ( 2000,this,
-                                     SLOT ( slotShowPassForm() ) );
-            }
-            else
-                QTimer::singleShot ( 2000,broker,
-                                     SLOT ( getUserSessions() ) );
-
-        }
-    }
-    else
-    {
-        restartResume=false;
-        sessionStatusDlg-&gt;hide();
-        resumeSession ( resumingSession );
-    }
-    setStatStatus ( tr ( &quot;Finished&quot; ) );
-}
-
-
-void ONMainWindow::slotProxyStderr()
-{
-    QString reserr;
-    if ( nxproxy )
-        reserr= nxproxy-&gt;readAllStandardError();
-    x2goDebug&lt;&lt;reserr&lt;&lt;endl;
-    stInfo-&gt;insertPlainText ( reserr );
-    stInfo-&gt;ensureCursorVisible();
-    if ( stInfo-&gt;toPlainText().indexOf (
-                &quot;Connecting to remote host 'localhost:&quot;+
-                /*resumingSession.grPort*/ localGraphicPort ) !=-1 )
-        setStatStatus ( tr ( &quot;connecting&quot; ) );
-
-    if ( stInfo-&gt;toPlainText().indexOf (
-                &quot;Connection to remote proxy 'localhost:&quot;+
-                /*resumingSession.grPort*/
-                localGraphicPort+&quot;' established&quot; ) !=-1 )
-    {
-        if ( newSession )
-            setStatStatus ( tr ( &quot;starting&quot; ) );
-        else
-            setStatStatus ( tr ( &quot;resuming&quot; ) );
-    }
-
-    if ( stInfo-&gt;toPlainText().indexOf (
-                &quot;Established X server connection&quot; ) !=-1 )
-    {
-        setStatStatus ( tr ( &quot;running&quot; ) );
-#ifndef CFGPLUGIN
-        if (trayEnabled)
-        {
-            if (!useLdap)
-                trayIconActiveConnectionMenu-&gt;setTitle(lastSession-&gt;name());
-            else
-                trayIconActiveConnectionMenu-&gt;setTitle(lastUser-&gt;username());
-            trayIconActiveConnectionMenu-&gt;setEnabled(true);
-            if (trayMinCon &amp;&amp; !trayAutoHidden)
-            {
-                trayAutoHidden=true;
-                hide();
-            }
-        }
-#endif
-        if ( embedMode )
-            setEmbedSessionActionsEnabled ( true );
-        disconnect ( sbSusp,SIGNAL ( clicked() ),this,
-                     SLOT ( slotTestSessionStatus() ) );
-        disconnect ( sbSusp,SIGNAL ( clicked() ),this,
-                     SLOT ( slotSuspendSessFromSt() ) );
-        connect ( sbSusp,SIGNAL ( clicked() ),this,
-                  SLOT ( slotSuspendSessFromSt() ) );
-        if ( !showExport )
-        {
-            showExport=true;
-            /*connect ( sbExp,SIGNAL ( clicked() ),this,
-              SLOT ( slot_exportDirectory() ) );*/
-            sbExp-&gt;setEnabled ( true );
-            exportDefaultDirs();
-            if ( readExportsFrom!=QString::null )
-            {
-                exportTimer-&gt;start ( 2000 );
-            }
-        }
-        sbSusp-&gt;setToolTip ( tr ( &quot;Suspend&quot; ) );
-        if ( newSession )
-        {
-            runCommand();
-            newSession=false;
-        }
-#ifdef 	Q_WS_HILDON
-        else
-        {
-            if ( !xmodExecuted )
-            {
-                xmodExecuted=true;
-                QTimer::singleShot (
-                    2000, this,
-                    SLOT ( slotExecXmodmap() ) );
-            }
-        }
-#endif
-    }
-    if ( stInfo-&gt;toPlainText().indexOf (
-                tr ( &quot;Connection timeout, aborting&quot; ) ) !=-1 )
-        setStatStatus ( tr ( &quot;aborting&quot; ) );
-#if defined( Q_OS_WIN ) &amp;&amp; defined (CFGPLUGIN)
-    if ( reserr.indexOf ( &quot;Session terminated at&quot; ) !=-1 )
-    {
-        x2goDebug&lt;&lt;&quot;proxy finished&quot;&lt;&lt;endl;
-        slotProxyFinished ( 0, QProcess::NormalExit );
-    }
-#endif
-
-
-}
-
-
-void ONMainWindow::slotProxyStdout()
-{
-    QString resout ( nxproxy-&gt;readAllStandardOutput() );
-    x2goDebug&lt;&lt;resout&lt;&lt;endl;
-
-}
-
-
-void ONMainWindow::slotShowPassForm()
-{
-    if ( !useLdap )
-    {
-        loginPrompt-&gt;show();
-        login-&gt;show();
-    }
-    else
-    {
-        loginPrompt-&gt;hide();
-        login-&gt;hide();
-    }
-    setEnabled ( true );
-    if ( !embedMode )
-    {
-        u-&gt;hide();
-        uname-&gt;hide();
-    }
-    sessionStatusDlg-&gt;hide();
-    selectSessionDlg-&gt;hide();
-    setEnabled ( true );
-    if ( isPassShown )
-    {
-        passForm-&gt;show();
-        passForm-&gt;setEnabled ( true );
-    }
-    isPassShown=true;
-    login-&gt;setEnabled ( true );
-    if ( login-&gt;text().length() &gt;0 )
-    {
-        pass-&gt;setFocus();
-        pass-&gt;selectAll();
-    }
-    else
-        login-&gt;setFocus();
-
-
-    if ( !embedMode )
-    {
-        u-&gt;setEnabled ( true );
-    }
-    else
-    {
-        if ( config.user.length() &gt;0 )
-            login-&gt;setEnabled ( false );
-    }
-}
-
-
-void ONMainWindow::showSessionStatus()
-{
-    setStatStatus();
-}
-
-
-void ONMainWindow::slotShowAdvancedStat()
-{
-    if ( !miniMode )
-    {
-        if ( sbAdv-&gt;isChecked() )
-        {
-            sessionStatusDlg-&gt;setFixedSize (
-                sessionStatusDlg-&gt;width(),
-                sessionStatusDlg-&gt;height() *2 );
-        }
-        else
-        {
-            sessionStatusDlg-&gt;setFixedSize (
-                sessionStatusDlg-&gt;sizeHint() );
-            stInfo-&gt;hide();
-        }
-    }
-    else
-    {
-        if ( sbAdv-&gt;isChecked() )
-        {
-            sessionStatusDlg-&gt;setFixedSize ( 310,300 );
-        }
-        else
-        {
-            stInfo-&gt;hide();
-            sessionStatusDlg-&gt;setFixedSize ( 310,200 );
-        }
-    }
-
-
-// 	username-&gt;invalidate();
-
-
-    if ( sbAdv-&gt;isChecked() )
-    {
-        stInfo-&gt;show();
-    }
-
-    X2goSettings st ( &quot;settings&quot; );
-    st.setting()-&gt;setValue ( &quot;showStatus&quot;,
-                             ( QVariant ) sbAdv-&gt;isChecked() );
-    st.setting()-&gt;sync();
-}
-
-
-
-
-void ONMainWindow::slotResumeDoubleClick ( const QModelIndex&amp; )
-{
-    if ( !shadowSession )
-        slotResumeSess();
-}
-
-
-void ONMainWindow::suspendSession ( QString sessId )
-{
-    SshProcess* proc=0l;
-    proc=new SshProcess ( sshConnection, this );
-
-    connect ( proc,SIGNAL ( sshFinished ( bool,  QString,SshProcess* ) ),
-              this,SLOT ( slotRetSuspSess ( bool,  QString,
-                                            SshProcess* ) ) );
-
-    proc-&gt;startNormal ( &quot;x2gosuspend-session &quot;+sessId );
-}
-
-
-bool ONMainWindow::termSession ( QString sessId, bool warn )
-{
-    if ( warn )
-    {
-        bool hide_after=false;
-        if (isHidden())
-        {
-            showNormal();
-            hide_after=true;
-        }
-        int answer=QMessageBox::warning (
-                       this,tr ( &quot;Warning&quot; ),
-                       tr (
-                           &quot;Are you sure you want to terminate &quot;
-                           &quot;this session?\n&quot;
-                           &quot;Unsaved documents will be lost&quot; ),
-                       QMessageBox::Yes,QMessageBox::No );
-        if (hide_after)
-            hide();
-
-        if ( answer !=
-                QMessageBox::Yes )
-        {
-            slotRetTermSess ( true,QString::null,0 );
-            return false;
-        }
-    }
-    if ( shadowSession )
-    {
-        nxproxy-&gt;terminate();
-        return true;
-    }
-
-    SshProcess* proc=0l;
-    proc=new SshProcess ( sshConnection,  this );
-
-    connect ( proc,SIGNAL ( sshFinished ( bool,  QString,SshProcess* ) ),
-              this,SLOT ( slotRetTermSess ( bool,
-                                            QString,SshProcess* ) ) );
-
-    proc-&gt;startNormal ( &quot;x2goterminate-session &quot;+sessId );
-    return true;
-}
-
-
-
-void ONMainWindow::setStatStatus ( QString status )
-{
-    setEnabled ( true );
-    passForm-&gt;hide();
-    selectSessionDlg-&gt;hide();
-    if ( status == QString::null )
-        status=statusString;
-    else
-        statusString=status;
-    QString tstr;
-    if ( statusLabel )
-        statusLabel-&gt;setText ( QString::null );
-    if ( resumingSession.sessionId!=QString::null )
-    {
-        QString f=&quot;dd.MM.yy HH:mm:ss&quot;;
-        QDateTime dt=QDateTime::fromString ( resumingSession.crTime,f );
-        dt=dt.addYears ( 100 );
-        tstr=dt.toString();
-    }
-    if ( !embedMode || !proxyWinEmbedded )
-    {
-        statusBar()-&gt;showMessage ( &quot;&quot;);
-#if ! (defined Q_OS_WIN &amp;&amp; defined CFGPLUGIN)
-        statusBar()-&gt;hide();
-#endif
-        QString srv;
-        if ( embedMode )
-            srv=config.server;
-        else
-            srv=resumingSession.server;
-        slVal-&gt;setText ( resumingSession.sessionId+&quot;\n&quot;+
-                         srv+&quot;\n&quot;+
-                         getCurrentUname() +&quot;\n&quot;+
-                         resumingSession.display+
-                         &quot;\n&quot;+tstr+&quot;\n&quot;+status );
-
-        slVal-&gt;setFixedSize ( slVal-&gt;sizeHint() );
-        sessionStatusDlg-&gt;show();
-        if (resumingSession.published)
-            sbApps-&gt;show();
-        else
-            sbApps-&gt;hide();
-    }
-    else
-    {
-
-        QString srv=config.server;
-        QString message=getCurrentUname() +&quot;@&quot;+
-                        srv+
-                        &quot;, &quot;+tr ( &quot;Session&quot; ) +&quot;: &quot;+
-                        resumingSession.sessionId+&quot;, &quot;+
-                        tr ( &quot;Display&quot; ) +&quot;: &quot;+
-                        resumingSession.display+&quot;, &quot;+
-                        tr ( &quot;Creation time&quot; ) +&quot;: &quot;+tstr;
-#if ! (defined Q_OS_WIN &amp;&amp; defined CFGPLUGIN)
-        if ( statusLabel )
-        {
-            statusLabel-&gt;setText ( &quot;   &quot;+message );
-        }
-        else
-#endif
-        {
-            if ( config.showstatusbar )
-            {
-                statusBar()-&gt;show();
-                statusBar()-&gt;showMessage ( message );
-            }
-        }
-        sessionStatusDlg-&gt;hide();
-    }
-}
-
-
-void ONMainWindow::slotRestartProxy()
-{
-    if ( !sessionStatusDlg-&gt;isVisible() )
-        return;
-    if ( stInfo-&gt;toPlainText().indexOf (
-                &quot;Established X server connection&quot; ) ==-1 )
-    {
-        stInfo-&gt;insertPlainText (
-            tr (
-                &quot;Connection timeout, aborting&quot; ) );
-        if ( nxproxy )
-            nxproxy-&gt;terminate();
-        restartResume=true;
-    }
-}
-
-
-void ONMainWindow::slotTestSessionStatus()
-{
-
-    if ( !sessionStatusDlg-&gt;isVisible() )
-        return;
-    if ( stInfo-&gt;toPlainText().indexOf (
-                &quot;Established X server connection&quot; ) ==-1 )
-    {
-        stInfo-&gt;insertPlainText (
-            tr ( &quot;Connection timeout, aborting&quot; ) );
-        if ( nxproxy )
-            nxproxy-&gt;terminate();
-    }
-}
-
diff --git a/onmainwindow_part3.cpp b/onmainwindow_part3.cpp
deleted file mode 100644
index 350a648..0000000
--- a/onmainwindow_part3.cpp
+++ /dev/null
@@ -1,2510 +0,0 @@
-/**************************************************************************
-*   Copyright (C) 2005-2012 by Oleksandr Shneyder                         *
-*   <A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">oleksandr.shneyder at obviously-nice.de</A>                                  *
-*                                                                         *
-*   This program is free software; you can redistribute it and/or modify  *
-*   it under the terms of the GNU General Public License as published by  *
-*   the Free Software Foundation; either version 2 of the License, or     *
-*   (at your option) any later version.                                   *
-*                                                                         *
-*   This program is distributed in the hope that it will be useful,       *
-*   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
-*   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
-*   GNU General Public License for more details.                          *
-*                                                                         *
-*   You should have received a copy of the GNU General Public License     *
-*   along with this program; if not, write to the                         *
-*   Free Software Foundation, Inc.,                                       *
-*   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
-***************************************************************************/
-
-#include &quot;onmainwindow_privat.h&quot;
-
-x2goSession ONMainWindow::getNewSessionFromString ( const QString&amp; string )
-{
-    QStringList lst=string.split ( '|' );
-    x2goSession s;
-    s.display=lst[0];
-    s.cookie=lst[1];
-    s.agentPid=lst[2];
-    s.sessionId=lst[3];
-    s.grPort=lst[4];
-    s.sndPort=lst[5];
-    if ( lst.count() &gt;6 )
-        s.fsPort=lst[6];
-    return s;
-}
-
-
-void ONMainWindow::slotAppDialog()
-{
-    AppDialog dlg(this);
-    dlg.exec();
-}
-
-void ONMainWindow::runCommand()
-{
-    QString passwd=getCurrentPass();
-    QString user=getCurrentUname();
-    QString host=resumingSession.server;
-    QString command;
-    QString sessionType=&quot;D&quot;;
-    QString rdpOpts,rdpServer;
-    bool rdpFS=false;
-    QString rdpWidth;
-    QString rdpHeight;
-    bool rootless=false;
-    resumingSession.published=false;
-    if ( !embedMode )
-    {
-        X2goSettings* st;
-        if (!brokerMode)
-            st=new X2goSettings( &quot;sessions&quot; );
-        else
-            st=new X2goSettings(config.iniFile, QSettings::IniFormat);
-
-
-        if ( useLdap )
-            command=sessionCmd;
-        else
-        {
-            QString sid=lastSession-&gt;id();
-            command=st-&gt;setting()-&gt;value (
-                        sid+&quot;/command&quot;,
-                        ( QVariant ) tr ( &quot;KDE&quot; ) ).toString();
-            rdpOpts=st-&gt;setting()-&gt;value (
-                        sid+&quot;/rdpoptions&quot;,
-                        ( QVariant ) &quot;&quot; ).toString();
-            rdpServer=st-&gt;setting()-&gt;value (
-                          sid+&quot;/rdpserver&quot;,
-                          ( QVariant ) &quot;&quot; ).toString();
-            rootless=st-&gt;setting()-&gt;value ( sid+&quot;/rootless&quot;,
-                                            ( QVariant ) false ).toBool();
-            resumingSession.published=st-&gt;setting()-&gt;value ( sid+&quot;/published&quot;,
-                                      ( QVariant ) false ).toBool();
-
-            rdpFS=st-&gt;setting()-&gt;value (
-                      sid+&quot;/fullscreen&quot;,
-                      ( QVariant ) defaultFullscreen ).toBool();
-            rdpHeight=st-&gt;setting()-&gt;value (
-                          sid+&quot;/height&quot;,
-                          ( QVariant ) defaultHeight ).toString();
-            rdpWidth=st-&gt;setting()-&gt;value (
-                         sid+&quot;/width&quot;,
-                         ( QVariant ) defaultWidth ).toString();
-
-        }
-        delete st;
-    }
-    else
-    {
-        command=config.command;
-        rootless=config.rootless;
-    }
-    if ( rootless )
-        sessionType=&quot;R&quot;;
-    if ( resumingSession.published )
-    {
-        sessionType=&quot;P&quot;;
-        command=&quot;PUBLISHED&quot;;
-    }
-
-    if ( command==&quot;KDE&quot; )
-    {
-        command=&quot;startkde&quot;;
-    }
-    else if ( command==&quot;GNOME&quot; )
-    {
-        command=&quot;gnome-session&quot;;
-    }
-    else if ( command==&quot;LXDE&quot; )
-    {
-        command=&quot;startlxde&quot;;
-    }
-    else if ( command==&quot;RDP&quot; )
-    {
-        command=&quot;rdesktop &quot;;
-        if ( rdpFS )
-            command+=&quot; -f &quot;;
-        else
-            command+=&quot; -g &quot;+rdpWidth+&quot;x&quot;+rdpHeight;
-        command+=&quot; &quot;+rdpOpts+ &quot; &quot;+rdpServer;
-
-        sessionType=&quot;R&quot;;
-    }
-
-    if ( managedMode )
-        return;
-
-    SshProcess *proc=0l;
-
-    QString cmd;
-
-    command.replace ( &quot; &quot;,&quot;X2GO_SPACE_CHAR&quot; );
-
-    if ( !startSessSound  || startSessSndSystem==PULSE )
-    {
-        cmd=&quot;setsid x2goruncommand &quot;+resumingSession.display+&quot; &quot;+
-            resumingSession.agentPid + &quot; &quot; +
-            resumingSession.sessionId+&quot; &quot;+
-            resumingSession.sndPort+ &quot; &quot;+ command+&quot; nosnd &quot;+
-            sessionType +&quot;&gt;&amp; /dev/null &amp; exit&quot;;
-        if ( startSessSndSystem ==PULSE )
-        {
-            cmd=&quot;PULSE_CLIENTCONFIG=~/.x2go/C-&quot;+
-                resumingSession.sessionId+
-                &quot;/.pulse-client.conf &quot;+cmd;
-        }
-    }
-    else
-    {
-        switch ( startSessSndSystem )
-        {
-        case ESD:
-            cmd=&quot;setsid x2goruncommand &quot;+
-                resumingSession.display+&quot; &quot;+
-                resumingSession.agentPid + &quot; &quot; +
-                resumingSession.sessionId+&quot; &quot;+
-                resumingSession.sndPort+ &quot; &quot;+
-                command+&quot; esd &quot;+
-                sessionType +&quot;&gt;&amp; /dev/null &amp; exit&quot;;
-            break;
-        case ARTS:
-            cmd=&quot;setsid x2goruncommand &quot;+
-                resumingSession.display+&quot; &quot;+
-                resumingSession.agentPid + &quot; &quot; +
-                resumingSession.sessionId+&quot; &quot;+
-                resumingSession.sndPort+ &quot; &quot;+
-                command+&quot; arts &quot;+
-                sessionType +&quot;&gt;&amp; /dev/null &amp; exit&quot;;
-            break;
-
-        }
-    }
-
-    if ( runRemoteCommand )
-    {
-        proc=new SshProcess ( sshConnection, this );
-        connect ( proc,SIGNAL ( sshFinished ( bool, QString,
-                                              SshProcess* ) ),
-                  this,SLOT ( slotRetRunCommand ( bool,
-                                                  QString,
-                                                  SshProcess* ) ) );
-
-        proc-&gt;startNormal ( cmd );
-    }
-#ifdef Q_WS_HILDON
-    //wait 5 seconds and execute xkbcomp
-    QTimer::singleShot ( 5000, this, SLOT ( slotExecXmodmap() ) );
-#endif
-}
-
-
-void ONMainWindow::runApplication(QString exec)
-{
-    SshProcess* proc=new SshProcess ( sshConnection, this );
-    proc-&gt;startNormal (&quot;PULSE_CLIENTCONFIG=~/.x2go/C-&quot;+
-                       resumingSession.sessionId+&quot;/.pulse-client.conf DISPLAY=:&quot;+
-                       resumingSession.display+
-                       &quot; setsid &quot;+exec+&quot;&gt;&amp; /dev/null &amp; exit&quot;);
-}
-
-void ONMainWindow::slotRetRunCommand ( bool result, QString output,
-                                       SshProcess* proc )
-{
-    if ( proc )
-        delete proc;
-    if ( result==false )
-    {
-        QString message=tr ( &quot;&lt;b&gt;Connection failed&lt;/b&gt;\n:\n&quot; ) +output;
-        if ( message.indexOf ( &quot;publickey,password&quot; ) !=-1 )
-        {
-            message=tr ( &quot;&lt;b&gt;Wrong password!&lt;/b&gt;&lt;br&gt;&lt;br&gt;&quot; ) +
-                    message;
-        }
-        QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),message,
-                                QMessageBox::Ok,
-                                QMessageBox::NoButton );
-    }
-    else
-    {
-        if (resumingSession.published)
-            readApplications();
-    }
-}
-
-void ONMainWindow::readApplications()
-{
-    SshProcess* proc=new SshProcess ( sshConnection, this );
-    connect ( proc,SIGNAL ( sshFinished ( bool, QString,
-                                          SshProcess* ) ),
-              this,SLOT ( slotReadApplications ( bool,
-                                                 QString,
-                                                 SshProcess* ) ) );
-    proc-&gt;startNormal ( &quot;x2gogetapps&quot; );
-    sbApps-&gt;setEnabled(false);
-}
-
-void ONMainWindow::slotReadApplications(bool result, QString output,
-                                        SshProcess* proc )
-{
-    if ( proc )
-        delete proc;
-    if ( result==false )
-    {
-        QString message=tr ( &quot;&lt;b&gt;Connection failed&lt;/b&gt;\n:\n&quot; ) +output;
-        if ( message.indexOf ( &quot;publickey,password&quot; ) !=-1 )
-        {
-            message=tr ( &quot;&lt;b&gt;Wrong password!&lt;/b&gt;&lt;br&gt;&lt;br&gt;&quot; ) +
-                    message;
-        }
-        QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),message,
-                                QMessageBox::Ok,
-                                QMessageBox::NoButton );
-        return;
-    }
-    sbApps-&gt;setEnabled(true);
-    applications.clear();
-    QString locallong=QLocale::system().name();
-    QString localshort=QLocale::system().name().split(&quot;_&quot;)[0];
-
-    foreach(QString appstr, output.split(&quot;&lt;/desktop&gt;&quot;,QString::SkipEmptyParts))
-    {
-        bool localcomment=false;
-        bool localname=false;
-        Application app;
-        app.category=Application::OTHER;
-        QStringList lines=appstr.split(&quot;\n&quot;, QString::SkipEmptyParts);
-        for (int i=0; i&lt;lines.count(); ++i)
-        {
-            QString line=lines[i];
-            if (line.indexOf(&quot;Name[&quot;+localshort+&quot;]=&quot;)!=-1  || line.indexOf(&quot;Name[&quot;+locallong+&quot;]=&quot;)!=-1)
-            {
-                app.name=QString::fromUtf8(line.split(&quot;=&quot;)[1].toAscii());
-//                 x2goDebug&lt;&lt;&quot;local name: &quot;&lt;&lt;app.name&lt;&lt;endl;
-                localname=true;
-            }
-            if (line.indexOf(&quot;Comment[&quot;+localshort+&quot;]=&quot;)!=-1 || line.indexOf(&quot;Comment[&quot;+locallong+&quot;]=&quot;)!=-1)
-            {
-                app.comment=QString::fromUtf8(line.split(&quot;=&quot;)[1].toAscii());
-//                 x2goDebug&lt;&lt;&quot;local comment: &quot;&lt;&lt;app.comment&lt;&lt;endl;
-                localcomment=true;
-            }
-            if (line.indexOf(&quot;Name=&quot;)!=-1 &amp;&amp; !localname)
-            {
-                app.name=line.split(&quot;=&quot;)[1];
-//                 x2goDebug&lt;&lt;&quot;name: &quot;&lt;&lt;app.name&lt;&lt;endl;
-            }
-            if (line.indexOf(&quot;Comment=&quot;)!=-1 &amp;&amp; !localcomment)
-            {
-                app.comment=line.split(&quot;=&quot;)[1];
-//                 x2goDebug&lt;&lt;&quot;comment: &quot;&lt;&lt;app.comment&lt;&lt;endl;
-            }
-            if (line.indexOf(&quot;Exec=&quot;)!=-1)
-            {
-                app.exec=line.split(&quot;=&quot;)[1];
-                app.exec.replace(&quot;%f&quot;,&quot;&quot;,Qt::CaseInsensitive);
-                app.exec.replace(&quot;%u&quot;,&quot;&quot;,Qt::CaseInsensitive);
-//                 x2goDebug&lt;&lt;&quot;exec: &quot;&lt;&lt;app.exec&lt;&lt;endl;
-            }
-            if (line.indexOf(&quot;Categories=&quot;)!=-1)
-            {
-                if (line.indexOf(&quot;Audio&quot;)!=-1)
-                    app.category=Application::MULTIMEDIA;
-                if (line.indexOf(&quot;Vide&quot;)!=-1)
-                    app.category=Application::MULTIMEDIA;
-                if (line.indexOf(&quot;Development&quot;)!=-1)
-                    app.category=Application::DEVELOPMENT;
-                if (line.indexOf(&quot;Education&quot;)!=-1)
-                    app.category=Application::EDUCATION;
-                if (line.indexOf(&quot;Game&quot;)!=-1)
-                    app.category=Application::GAME;
-                if (line.indexOf(&quot;Graphics&quot;)!=-1)
-                    app.category=Application::GRAPHICS;
-                if (line.indexOf(&quot;Network&quot;)!=-1)
-                    app.category=Application::NETWORK;
-                if (line.indexOf(&quot;Office&quot;)!=-1)
-                    app.category=Application::OFFICE;
-                if (line.indexOf(&quot;Settings&quot;)!=-1)
-                    app.category=Application::SETTINGS;
-                if (line.indexOf(&quot;System&quot;)!=-1)
-                    app.category=Application::SYSTEM;
-                if (line.indexOf(&quot;Utility&quot;)!=-1)
-                    app.category=Application::UTILITY;
-                if (line.indexOf(&quot;X2Go-Top&quot;,0,Qt::CaseInsensitive)!=-1)
-                    app.category=Application::TOP;
-            }
-            if (line.indexOf(&quot;&lt;icon&gt;&quot;)!=-1)
-            {
-                bool isSvg=false;
-                line=lines[++i];
-                QByteArray pic;
-                while (line.indexOf(&quot;&lt;/icon&gt;&quot;)==-1)
-                {
-                    pic+=QByteArray::fromBase64(line.toAscii());
-                    line=lines[++i];
-                    if (QString(QByteArray::fromBase64(line.toAscii())).indexOf(&quot;&lt;/svg&gt;&quot;,Qt::CaseInsensitive)!=-1)
-                    {
-                        isSvg=true;
-                    }
-                }
-                if (!isSvg)
-                    app.icon.loadFromData(pic);
-                else
-                {
-                    QPixmap pix(32,32);
-                    QSvgRenderer svgRenderer( pic );
-                    QPainter pixPainter(&amp;pix);
-                    svgRenderer.render(&amp;pixPainter);
-                    app.icon=pix;
-                }
-            }
-        }
-        if (app.name.length()&gt;0)
-        {
-            if (app.comment.length()&lt;=0)
-                app.comment=app.name;
-            applications.append(app);
-        }
-    }
-
-    qSort(applications.begin(), applications.end(),Application::lessThen);
-    plugAppsInTray();
-}
-
-
-bool ONMainWindow::parseParameter ( QString param )
-{
-    if ( param==&quot;--help&quot; )
-    {
-        showHelp();
-        return false;
-    }
-
-    if ( param==&quot;--help-pack&quot; )
-    {
-        showHelpPack();
-        return false;
-    }
-
-    if ( param == &quot;--portable&quot; )
-    {
-        ONMainWindow::portable=true;
-        return true;
-    }
-    if ( param == &quot;--clean-all-files&quot; )
-    {
-        cleanAllFiles=true;
-        return true;
-    }
-    if (param == &quot;--connectivity-test&quot;)
-    {
-        connTest=true;
-        return true;
-    }
-
-    if ( param==&quot;--no-menu&quot; )
-    {
-        drawMenu=false;
-        return true;
-    }
-
-    if ( param==&quot;--maximize&quot; )
-    {
-        startMaximized=true;
-        return true;
-    }
-    if ( param==&quot;--xinerama&quot; )
-    {
-        defaultXinerama=true;
-        return true;
-    }
-    if (param == &quot;--thinclient&quot;)
-    {
-        thinMode=true;
-        startMaximized=true;
-        return true;
-    }
-    if (param == &quot;--haltbt&quot;)
-    {
-        showHaltBtn=true;
-        return true;
-    }
-    if ( param==&quot;--hide&quot; )
-    {
-        startHidden=true;
-        return true;
-    }
-    if ( param==&quot;--pgp-card&quot; )
-    {
-        usePGPCard=true;
-        return true;
-    }
-    if ( param==&quot;--ldap-printing&quot; )
-    {
-        LDAPPrintSupport=true;
-        return true;
-    }
-    if ( param==&quot;--add-to-known-hosts&quot; )
-    {
-        acceptRsa=true;
-        return true;
-    }
-    if ( param==&quot;--no-session-edit&quot; )
-    {
-        noSessionEdit=true;
-        return true;
-    }
-    if ( param==&quot;--change-broker-pass&quot;)
-    {
-        changeBrokerPass=true;
-        return true;
-    }
-
-
-    QString setting,value;
-    QStringList vals=param.split ( &quot;=&quot; );
-    if ( vals.size() &lt;2 )
-    {
-        printError ( param );
-        return false;
-    }
-    setting=vals[0];
-    vals.removeFirst();
-    value=vals.join ( &quot;=&quot; );
-    if ( setting==&quot;--link&quot; )
-    {
-        return linkParameter ( value );
-    }
-    if ( setting==&quot;--sound&quot; )
-    {
-        return soundParameter ( value );
-    }
-    if ( setting==&quot;--geometry&quot; )
-    {
-        return geometry_par ( value );
-    }
-    if ( setting==&quot;--pack&quot; )
-    {
-        return packParameter ( value );
-    }
-    if ( setting==&quot;--kbd-layout&quot; )
-    {
-        defaultLayout=value.split(&quot;,&quot;,QString::SkipEmptyParts);
-        if (defaultLayout.size()==0)
-            defaultLayout&lt;&lt;tr(&quot;us&quot;);
-        return true;
-    }
-    if ( setting==&quot;--session&quot; )
-    {
-        defaultSession=true;
-        defaultSessionName=value;
-        return true;
-    }
-    if ( setting==&quot;--session-conf&quot; )
-    {
-        ONMainWindow::sessionCfg=value;
-        return true;
-    }
-    if ( setting==&quot;--sessionid&quot; )
-    {
-        defaultSession=true;
-        defaultSessionId=value;
-        return true;
-    }
-    if ( setting==&quot;--user&quot; )
-    {
-        defaultUser=true;
-        defaultUserName=value;
-        return true;
-    }
-    if ( setting==&quot;--kbd-type&quot; )
-    {
-        defaultKbdType=value;
-        return true;
-    }
-    if ( setting==&quot;--set-kbd&quot; )
-    {
-        return setKbd_par ( value );
-    }
-    if ( setting==&quot;--ldap&quot; )
-    {
-        return ldapParameter ( value );
-    }
-    if ( setting==&quot;--ldap1&quot; )
-    {
-        return ldap1Parameter ( value );
-    }
-    if ( setting==&quot;--ldap2&quot; )
-    {
-        return ldap2Parameter ( value );
-    }
-    if ( setting==&quot;--command&quot; )
-    {
-        defaultCmd=value;
-        return true;
-    }
-    if ( setting==&quot;--read-exports-from&quot; )
-    {
-        readExportsFrom=value;
-        return true;
-    }
-    if ( setting==&quot;--external-login&quot; )
-    {
-        extLogin=true;
-        readLoginsFrom=value;
-        return true;
-    }
-    if ( setting==&quot;--ssh-port&quot; )
-    {
-        defaultSshPort=value;
-        return true;
-    }
-    if ( setting==&quot;--dpi&quot; )
-    {
-        defaultSetDPI=true;
-        defaultDPI=value.toUInt();
-        return true;
-    }
-    if ( setting==&quot;--client-ssh-port&quot; )
-    {
-        clientSshPort=value;
-        return true;
-    }
-    if ( setting == &quot;--embed-into&quot; )
-    {
-        embedMode=true;
-        embedParent=value.toLong();
-        return true;
-    }
-    if ( setting == &quot;--broker-url&quot;)
-    {
-        brokerMode=true;
-        noSessionEdit=true;
-        config.brokerurl=value;
-        return true;
-    }
-    if ( setting == &quot;--broker-name&quot;)
-    {
-        config.brokerName=value;
-        return true;
-    }
-    if ( setting == &quot;--auth-id&quot;)
-    {
-        QFile file(value);
-        if (!file.open(QIODevice::ReadOnly | QIODevice::Text))
-        {
-            printError ( param + tr(&quot; (can't open file)&quot;));
-            return false;
-        }
-        QTextStream in(&amp;file);
-        config.brokerUserId = in.readLine();
-        return true;
-    }
-    if (setting == &quot;--support-menu&quot;)
-    {
-        if (! QFile::exists(value))
-        {
-            printError( param + tr(&quot; (file not exists)&quot;));
-            return false;
-        }
-        supportMenuFile=value;
-        return true;
-    }
-    if (setting == &quot;--background&quot;)
-    {
-        if (! QFile::exists(value))
-        {
-            printError( param + tr(&quot; (file not exists)&quot;));
-            return false;
-        }
-        BGFile=value;
-        return true;
-    }
-    if (setting == &quot;--session-icon&quot;)
-    {
-        if (! QFile::exists(value))
-        {
-            printError( param + tr(&quot; (file not exists)&quot;));
-            return false;
-        }
-        SPixFile=value;
-        return true;
-    }
-    if (setting == &quot;--home&quot;)
-    {
-        QDir dr;
-
-#ifdef Q_OS_WIN
-        int find=value.indexOf(&quot;(&quot;);
-        int lind=value.indexOf(&quot;)&quot;);
-        if (find!=-1 &amp;&amp; lind !=-1)
-        {
-            QString label=value.mid(find+1,lind-find-1);
-            x2goDebug&lt;&lt; &quot;searching for drive with label: &quot;&lt;&lt;label;
-            QString drive=wapiGetDriveByLabel(label);
-            value.replace(&quot;(&quot;+label+&quot;)&quot;,drive);
-            x2goDebug&lt;&lt;&quot;new path: &quot;&lt;&lt;value;
-        }
-#endif
-        if (! dr.exists(value))
-        {
-            printError( param + tr(&quot; (directory not exists)&quot;));
-            return false;
-        }
-        homeDir=value;
-        portableDataPath=value;
-        return true;
-    }
-
-    printError ( param );
-    return false;
-}
-
-
-bool ONMainWindow::linkParameter ( QString value )
-{
-    if ( value==&quot;modem&quot; )
-        defaultLink=MODEM;
-    else if ( value==&quot;isdn&quot; )
-        defaultLink=ISDN;
-    else if ( value==&quot;adsl&quot; )
-        defaultLink=ADSL;
-    else if ( value==&quot;wan&quot; )
-        defaultLink=WAN;
-    else if ( value==&quot;lan&quot; )
-        defaultLink=LAN;
-    else
-    {
-        qCritical (
-            &quot;%s&quot;,tr (
-                &quot;wrong value for argument\&quot;--link\&quot;&quot;
-            ).toLocal8Bit().data() );
-        return false;
-    }
-    return true;
-
-}
-
-bool ONMainWindow::soundParameter ( QString val )
-{
-    if ( val==&quot;1&quot; )
-        defaultUseSound=true;
-    else if ( val==&quot;0&quot; )
-        defaultUseSound=false;
-    else
-    {
-        qCritical (
-            &quot;%s&quot;,tr ( &quot;wrong value for &quot;
-                      &quot;argument\&quot;--sound\&quot;&quot; ).toLocal8Bit().data() );
-        return false;
-    }
-    return true;
-}
-
-bool ONMainWindow::geometry_par ( QString val )
-{
-    if ( val==&quot;fullscreen&quot; )
-        defaultFullscreen=true;
-    else
-    {
-        QStringList res=val.split ( &quot;x&quot; );
-        if ( res.size() !=2 )
-        {
-            qCritical (
-                &quot;%s&quot;,tr (
-                    &quot;wrong value for argument\&quot;--geometry\&quot;&quot; ).
-                toLocal8Bit().data() );
-            return false;
-        }
-        bool o1,o2;
-        defaultWidth=res[0].toInt ( &amp;o1 );
-        defaultHeight=res[1].toInt ( &amp;o2 );
-        if ( ! ( defaultWidth &gt;0 &amp;&amp; defaultHeight &gt;0 &amp;&amp; o1 &amp;&amp; o2 ) )
-        {
-            qCritical (
-                &quot;%s&quot;,tr (
-                    &quot;wrong value for argument\&quot;--geometry\&quot;&quot; ).
-                toLocal8Bit().data() );
-            return false;
-        }
-    }
-    return true;
-}
-
-bool ONMainWindow::setKbd_par ( QString val )
-{
-    if ( val==&quot;1&quot; )
-        defaultSetKbd=true;
-    else if ( val==&quot;0&quot; )
-        defaultSetKbd=false;
-    else
-    {
-        qCritical (
-            &quot;%s&quot;,tr (
-                &quot;wrong value for argument\&quot;--set-kbd\&quot;&quot; ).
-            toLocal8Bit().data() );
-        return false;
-    }
-    return true;
-}
-
-bool ONMainWindow::ldapParameter ( QString val )
-{
-    QString ldapstring=val;
-    useLdap=true;
-    ldapstring.replace ( &quot;\&quot;&quot;,&quot;&quot; );
-    QStringList lst=ldapstring.split ( ':',QString::SkipEmptyParts );
-    if ( lst.size() !=3 )
-    {
-        qCritical (
-            &quot;%s&quot;,tr (
-                &quot;wrong value for argument\&quot;--ldap\&quot;&quot; ).
-            toLocal8Bit().data() );
-        return false;
-    }
-    ldapOnly=true;
-    ldapServer=lst[0];
-    ldapPort=lst[1].toInt();
-    ldapDn=lst[2];
-
-
-    return true;
-}
-
-bool ONMainWindow::ldap1Parameter ( QString val )
-{
-    QString ldapstring=val;
-    ldapstring.replace ( &quot;\&quot;&quot;,&quot;&quot; );
-    QStringList lst=ldapstring.split ( ':',QString::SkipEmptyParts );
-    if ( lst.size() !=2 )
-    {
-        qCritical (
-            &quot;%s&quot;,tr (
-                &quot;wrong value for argument\&quot;--ldap1\&quot;&quot; ).
-            toLocal8Bit().data() );
-        return false;
-    }
-    ldapServer1=lst[0];
-    ldapPort1=lst[1].toInt();
-
-    return true;
-}
-
-bool ONMainWindow::ldap2Parameter ( QString val )
-{
-    QString ldapstring=val;
-    ldapstring.replace ( &quot;\&quot;&quot;,&quot;&quot; );
-    QStringList lst=ldapstring.split ( ':',QString::SkipEmptyParts );
-    if ( lst.size() !=2 )
-    {
-        qCritical ( &quot;%s&quot;,
-                    tr (
-                        &quot;wrong value for argument\&quot;--ldap2\&quot;&quot; ).
-                    toLocal8Bit().data() );
-        return false;
-    }
-    ldapServer2=lst[0];
-    ldapPort2=lst[1].toInt();
-
-    return true;
-}
-
-
-bool ONMainWindow::packParameter ( QString val )
-{
-
-    QFile file ( &quot;:/txt/packs&quot; );
-    if ( !file.open ( QIODevice::ReadOnly | QIODevice::Text ) )
-        return true;
-    QTextStream in ( &amp;file );
-    while ( !in.atEnd() )
-    {
-        QString pc=in.readLine();
-        if ( pc.indexOf ( &quot;-%&quot; ) !=-1 )
-        {
-            pc=pc.left ( pc.indexOf ( &quot;-%&quot; ) );
-
-            QStringList pctails=val.split ( &quot;-&quot; );
-            QString pcq=pctails[pctails.size()-1];
-            pctails.removeLast();
-
-            if ( pctails.join ( &quot;-&quot; ) ==pc )
-            {
-                bool ok;
-                int v=pcq.toInt ( &amp;ok );
-                if ( ok &amp;&amp; v&gt;=0 &amp;&amp; v&lt;=9 )
-                {
-                    defaultPack=pc;
-                    defaultQuality=v;
-                    return true;
-                }
-                else
-                    break;
-            }
-        }
-        else
-        {
-            if ( pc==val )
-            {
-                defaultPack=val;
-                return true;
-            }
-        }
-    }
-    file.close();
-    qCritical ( &quot;%s&quot;,tr ( &quot;wrong value for argument\&quot;--pack\&quot;&quot; ).
-                toLocal8Bit().data() );
-    return false;
-}
-
-
-void ONMainWindow::printError ( QString param )
-{
-    qCritical ( &quot;%s&quot;, ( tr ( &quot;wrong parameter: &quot; ) +param ).
-                toLocal8Bit().data() );
-#ifdef Q_OS_WIN
-    x2goDebug&lt;&lt;tr ( &quot;wrong parameter: &quot; ) +param &lt;&lt;endl;
-#endif
-}
-
-void ONMainWindow::showHelp()
-{
-    QString helpMsg=
-        &quot;Usage: x2goclient [Options]\n&quot;
-        &quot;Options:\n&quot;
-        &quot;--help\t\t\t\t show this message\n&quot;
-        &quot;--help-pack\t\t\t show available pack methods\n&quot;
-        &quot;--no-menu\t\t\t hide menu bar\n&quot;
-        &quot;--no-session-edit\t\t not allow user to edit preconfigured\n&quot;
-        &quot;\t\t\t\t sessions\n&quot;
-        &quot;--maximize\t\t\t start maximized\n&quot;
-        &quot;--hide\t\t\t\t start hidden\n&quot;
-        &quot;--portable\t\t\t start in \&quot;portable\&quot; mode\n&quot;
-        &quot;--pgp-card\t\t\t use openPGP card authentication\n&quot;
-        &quot;--xinerama\t\t\t use Xinerama by default\n&quot;
-        &quot;--ldap-printing\t\t\t allow client side printing in LDAP mode\n&quot;
-        &quot;--thinclient\t\t\t run without window manager\n&quot;
-        &quot;--haltbt\t\t\t show shutdown button\n&quot;
-        &quot;--add-to-known-hosts\t\t add RSA key fingerprint to &quot;
-        &quot;.ssh/known_hosts\n&quot;
-        &quot;\t\t\t\t if authenticity of server can't be established\n\n&quot;
-        &quot;--ldap=&lt;host:port:dn&gt; \t\t start with LDAP support. Example:\n&quot;
-        &quot;\t\t\t\t --ldap=ldapserver:389:o=organization,c=de\n\n&quot;
-        &quot;--ldap1=&lt;host:port&gt;\t\t LDAP failover server #1 \n&quot;
-        &quot;--ldap2=&lt;host:port&gt;\t\t LDAP failover server #2 \n&quot;
-        &quot;--ssh-port=&lt;port&gt;\t\t connect to this port, default 22\n&quot;
-        &quot;--client-ssh-port=&lt;port&gt;\t local ssh port (for fs export), &quot;
-        &quot;default 22\n&quot;
-        &quot;--command=&lt;cmd&gt;\t\t\t Set default command, default value 'KDE'\n&quot;
-        &quot;--session=&lt;session&gt;\t\t Start session 'session'\n&quot;
-        &quot;--user=&lt;username&gt;\t\t in LDAP mode, select user 'username'\n&quot;
-        &quot;--geomerty=&lt;W&gt;x&lt;H&gt;|fullscreen\t set default geometry, default &quot;
-        &quot;value '800x600'\n&quot;
-        &quot;--dpi=&lt;dpi&gt;\t\t\t set dpi of x2goagent to dpi, default not set\n&quot;
-        &quot;--link=&lt;modem|isdn|adsl|wan|lan&gt; set default link type, &quot;
-        &quot;default 'adsl'\n&quot;
-        &quot;--pack=&lt;packmethod&gt;\t\t set default pack method, default &quot;
-        &quot;'16m-jpeg-9'\n&quot;
-        &quot;--kbd-layout=&lt;layout&gt;\t\t set default keyboard layout or layouts\n&quot;
-        &quot;\t\t\t\t comma separated\n&quot;
-        &quot;--kbd-type=&lt;typed&gt;\t\t set default keyboard type\n&quot;
-        &quot;--home=&lt;dir&gt;\t\t\t set users home directory\n&quot;
-        &quot;--set-kbd=&lt;0|1&gt;\t\t\t overwrite current keyboard settings\n&quot;
-        &quot;--session-conf=&lt;file&gt;\t\t\t path to alternative session config\n&quot;;
-    qCritical ( &quot;%s&quot;,helpMsg.toLocal8Bit().data() );
-    QMessageBox::information ( this,tr ( &quot;Options&quot; ),helpMsg );
-}
-
-void ONMainWindow::showHelpPack()
-{
-    qCritical ( &quot;%s&quot;,tr (
-                    &quot;Available pack methodes:&quot; ).toLocal8Bit().data() );
-    QFile file ( &quot;:/txt/packs&quot; );
-    if ( !file.open ( QIODevice::ReadOnly | QIODevice::Text ) )
-        return;
-    QTextStream in ( &amp;file );
-    QString msg;
-    while ( !in.atEnd() )
-    {
-        QString pc=in.readLine();
-        if ( pc.indexOf ( &quot;-%&quot; ) !=-1 )
-        {
-            pc=pc.left ( pc.indexOf ( &quot;-%&quot; ) );
-            pc+=&quot;-[0-9]&quot;;
-        }
-        msg+=pc+&quot;\n&quot;;
-        qCritical ( &quot;%s&quot;,pc.toLocal8Bit().data() );
-    }
-    file.close();
-#ifdef Q_OS_WIN
-
-    QMessageBox::information ( this,tr ( &quot;Options&quot; ),msg );
-#endif
-
-}
-
-void ONMainWindow::slotGetServers ( bool result, QString output,
-                                    SshProcess* proc )
-{
-    if ( proc )
-        delete proc;
-    proc=0;
-    if ( result==false )
-    {
-        cardReady=false;
-        cardStarted=false;
-
-        QString message=tr ( &quot;&lt;b&gt;Connection failed&lt;/b&gt;\n&quot; ) +output;
-        if ( message.indexOf ( &quot;publickey,password&quot; ) !=-1 )
-        {
-            message=tr ( &quot;&lt;b&gt;Wrong password!&lt;/b&gt;&lt;br&gt;&lt;br&gt;&quot; ) +
-                    message;
-        }
-
-        QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),message,
-                                QMessageBox::Ok,
-                                QMessageBox::NoButton );
-// 		currentKey=QString::null;
-        setEnabled ( true );
-        passForm-&gt;setEnabled ( true );
-        pass-&gt;setFocus();
-        pass-&gt;selectAll();
-        return;
-    }
-
-    passForm-&gt;hide();
-    setUsersEnabled ( false );
-    uname-&gt;setEnabled ( false );
-    u-&gt;setEnabled ( false );
-    QStringList servers=output.trimmed().split ( '\n' );
-    for ( int i=0;i&lt;servers.size();++i )
-    {
-        QStringList lst=servers[i].simplified().split ( ' ' );
-        if ( lst.size() &gt;1 )
-        {
-            for ( int j=0;j&lt;x2goServers.size();++j )
-                if ( x2goServers[j].name==lst[0] )
-                {
-                    x2goServers[j].sess=
-                        lst[1].toInt() *
-                        x2goServers[j].factor;
-                    x2goDebug&lt;&lt;x2goServers[j].name&lt;&lt;
-                    &quot;: sessions &quot;&lt;&lt;
-                    lst[1].toInt() &lt;&lt;
-                    &quot;, multiplied &quot;&lt;&lt;x2goServers[j].sess;
-                    break;
-                }
-        }
-    }
-
-    qSort ( x2goServers.begin(),x2goServers.end(),serv::lt );
-
-    listedSessions.clear();
-    retSessions=0;
-    if (sshConnection)
-        sshConnection-&gt;disconnectSession();
-    QString passwd;
-    QString user=getCurrentUname();
-    passwd=getCurrentPass();
-    for (int i=0; i&lt; serverSshConnections.count();++i)
-    {
-        if (serverSshConnections[i])
-            serverSshConnections[i]-&gt;disconnectSession();
-    }
-    serverSshConnections.clear();
-    for ( int j=0;j&lt;x2goServers.size();++j )
-    {
-        QString host=x2goServers[j].name;
-        sshPort=x2goServers[j].sshPort;
-        serverSshConnections&lt;&lt;startSshConnection ( host,sshPort,acceptRsa,user,passwd,true,false,true);
-    }
-}
-
-
-void ONMainWindow::slotListAllSessions ( bool result,QString output,
-        SshProcess* proc )
-{
-    bool last=false;
-
-    ++retSessions;
-    if ( retSessions == x2goServers.size() )
-        last=true;
-    if ( proc )
-        delete proc;
-    proc=0;
-
-    if ( result==false )
-    {
-        QString message=tr ( &quot;&lt;b&gt;Connection failed&lt;/b&gt;\n&quot; ) +output;
-        if ( message.indexOf ( &quot;publickey,password&quot; ) !=-1 )
-        {
-            message=tr ( &quot;&lt;b&gt;Wrong password!&lt;/b&gt;&lt;br&gt;&lt;br&gt;&quot; ) +
-                    message;
-        }
-
-        QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),message,
-                                QMessageBox::Ok,
-                                QMessageBox::NoButton );
-        QString sv=output.split ( &quot;:&quot; ) [0];
-        for ( int j=0;j&lt;x2goServers.size();++j )
-        {
-            if ( x2goServers[j].name==sv )
-            {
-                x2goServers[j].connOk=false;
-            }
-        }
-    }
-    else
-    {
-        listedSessions+=output.trimmed().split ( '\n',
-                        QString::SkipEmptyParts );
-    }
-    if ( last )
-    {
-        if ( listedSessions.size() ==0||
-                ( listedSessions.size() ==1 &amp;&amp;
-                  listedSessions[0].length() &lt;5 ) )
-        {
-// 	x2goDebug&lt;&lt;&quot;start New Session&quot;;
-            startNewSession();
-        }
-        else if ( listedSessions.size() ==1 )
-        {
-// 	x2goDebug&lt;&lt;&quot;have one session&quot;;
-            x2goSession s=getSessionFromString (
-                              listedSessions[0] );
-// 		x2goDebug&lt;&lt;&quot;will procceed one session&quot;;
-            QDesktopWidget wd;
-            if ( s.status==&quot;S&quot; &amp;&amp; isColorDepthOk (
-                        wd.depth(),s.colorDepth ) )
-                resumeSession ( s );
-            else
-            {
-// 				x2goDebug&lt;&lt;&quot;select one Session&quot;;
-                selectSession ( listedSessions );
-            }
-        }
-        else
-        {
-            selectSession ( listedSessions );
-        }
-    }
-}
-
-void ONMainWindow::slotResize()
-{
-    if ( startHidden )
-    {
-        hide();
-        return;
-    }
-    if ( !startMaximized &amp;&amp; !mwMax )
-    {
-        resize ( mwSize );
-        move ( mwPos );
-        show();
-    }
-    else
-        showMaximized();
-}
-
-void ONMainWindow::slotExportDirectory()
-{
-    if ( shadowSession )
-        return;
-
-    bool hide_after=false;
-    if (isHidden())
-    {
-        showNormal();
-        hide_after=true;
-    }
-    QString path;
-    if ( !useLdap &amp;&amp; !embedMode )
-    {
-        ExportDialog dlg ( lastSession-&gt;id(),this );
-        if ( dlg.exec() ==QDialog::Accepted )
-            path=dlg.getExport();
-    }
-    else
-
-        path= QFileDialog::getExistingDirectory (
-                  this,QString::null,
-                  homeDir );
-    if (hide_after)
-        hide();
-#ifdef Q_OS_WIN
-    if ( ONMainWindow::getPortable() &amp;&amp;
-            ONMainWindow::U3DevicePath().length() &gt;0 )
-    {
-        path.replace ( &quot;(U3)&quot;,u3Device );
-    }
-
-    path=cygwinPath ( wapiShortFileName ( path ) );
-#endif
-    if ( path!=QString::null )
-        exportDirs ( path );
-}
-
-
-void ONMainWindow::exportDirs ( QString exports,bool removable )
-{
-    if ( shadowSession )
-        return;
-    if ( embedMode )
-    {
-        if ( config.confFS  &amp;&amp; ! ( config.useFs ) )
-        {
-            return;
-        }
-    }
-    fsExportKeyReady=false;
-    directory dr;
-
-
-    dr.dirList=exports;
-    dr.key=createRSAKey();
-    QString passwd;
-    x2goDebug&lt;&lt;&quot;key created on: &quot;&lt;&lt;dr.key;
-
-    passwd=getCurrentPass();
-
-    fsInTun=false;
-    if ( !useLdap )
-    {
-        if ( !embedMode )
-        {
-            X2goSettings st ( &quot;sessions&quot; );
-
-            QString sid=lastSession-&gt;id();
-
-            fsInTun=st.setting()-&gt;value ( sid+&quot;/fstunnel&quot;,
-                                          ( QVariant ) true ).toBool();
-        }
-        else
-            fsInTun=true;
-    }
-    if ( fsInTun )
-    {
-        if ( fsTunnel==0l )
-            if ( startSshFsTunnel() )
-                return;
-    }
-    SshProcess* lproc;
-    QString uname=getCurrentUname();
-    lproc=new SshProcess ( sshConnection, this );
-    connect ( lproc,SIGNAL ( sshFinished ( bool,QString,SshProcess* ) ),
-              this,SLOT ( slotCopyKey ( bool, QString,SshProcess* ) ) );
-    QString dst=dr.key;
-    QString dhdir=homeDir+&quot;/.x2go&quot;;
-#ifdef Q_OS_WIN
-    dhdir=wapiShortFileName ( dhdir );
-#endif
-    dst.replace ( dhdir +&quot;/ssh/gen/&quot;,&quot;&quot; );
-    dst=&quot;~&quot;+uname +&quot;/.x2go/ssh/&quot;+dst;
-    dr.dstKey=dst;
-    dr.isRemovable=removable;
-    exportDir.append ( dr );
-    QString keyFile=dr.key;
-    lproc-&gt;start_cp ( keyFile,dst );
-
-}
-
-
-void ONMainWindow::exportDefaultDirs()
-{
-    QStringList dirs;
-    bool clientPrinting= ( useLdap &amp;&amp; LDAPPrintSupport );
-
-    if ( !useLdap )
-    {
-        if ( !embedMode )
-        {
-
-            X2goSettings st ( &quot;sessions&quot; );
-            clientPrinting= st.setting()-&gt;value (
-                                lastSession-&gt;id() +
-                                &quot;/print&quot;, true ).toBool();
-
-            QString exd=st.setting()-&gt;value (
-                            lastSession-&gt;id() +&quot;/export&quot;,
-                            ( QVariant ) QString::null ).toString();
-            QStringList lst=exd.split ( &quot;;&quot;,
-                                        QString::SkipEmptyParts );
-            for ( int i=0;i&lt;lst.size();++i )
-            {
-#ifndef Q_OS_WIN
-                QStringList tails=lst[i].split (
-                                      &quot;:&quot;,
-                                      QString::SkipEmptyParts );
-#else
-
-                QStringList tails=lst[i].split (
-                                      &quot;#&quot;,
-                                      QString::SkipEmptyParts );
-#endif
-
-                if ( tails[1]==&quot;1&quot; )
-                {
-#ifdef Q_OS_WIN
-                    if ( ONMainWindow::getPortable() &amp;&amp;
-                            ONMainWindow::U3DevicePath (
-                            ).length() &gt;0 )
-                    {
-                        tails[0].replace (
-                            &quot;(U3)&quot;,u3Device );
-                    }
-
-                    tails[0]=cygwinPath (
-                                 wapiShortFileName (
-                                     tails[0] ) );
-#endif
-                    dirs+=tails[0];
-                }
-            }
-        }
-        else
-        {
-            clientPrinting=true;
-            if ( config.confFS )
-            {
-                clientPrinting=config.useFs;
-            }
-        }
-    }
-
-    if ( clientPrinting )
-    {
-        QString path= homeDir +
-                      &quot;/.x2go/S-&quot;+
-                      resumingSession.sessionId +&quot;/spool&quot;;
-        QDir spooldir;
-        if ( !spooldir.exists ( path ) )
-        {
-            if ( !spooldir.mkpath ( path ) )
-            {
-                QString message=
-                    tr (
-                        &quot;Unable to create folder:&quot; ) + path;
-                QMessageBox::critical ( 0l,tr (
-                                            &quot;Error&quot; ),message,
-                                        QMessageBox::Ok,
-                                        QMessageBox::NoButton );
-
-            }
-        }
-        spoolDir=path;
-#ifdef Q_OS_WIN
-        path=cygwinPath (
-                 wapiShortFileName (
-                     path ) );
-#endif
-        QFile::setPermissions (
-            path,QFile::ReadOwner|QFile::WriteOwner|QFile::ExeOwner );
-
-        path+=&quot;__PRINT_SPOOL_&quot;;
-        dirs+=path;
-        printSupport=true;
-        if ( spoolTimer )
-            delete spoolTimer;
-        spoolTimer=new QTimer ( this );
-        connect ( spoolTimer,SIGNAL ( timeout() ),this,
-                  SLOT ( slotCheckPrintSpool() ) );
-        spoolTimer-&gt;start ( 2000 );
-    }
-    if ( dirs.size() &lt;=0 )
-        return;
-    exportDirs ( dirs.join ( &quot;:&quot; ) );
-}
-
-QString ONMainWindow::createRSAKey()
-{
-    QDir dr;
-    QString keyPath=homeDir +&quot;/.x2go/ssh/gen&quot;;
-    dr.mkpath ( keyPath );
-#ifdef Q_OS_WIN
-    keyPath=wapiShortFileName ( keyPath );
-#endif
-    QTemporaryFile fl ( keyPath+&quot;/key&quot; );
-    fl.open();
-    QString keyName=fl.fileName();
-    fl.setAutoRemove ( false );
-    fl.close();
-    fl.remove();
-
-    QStringList args;
-
-    args&lt;&lt;&quot;-t&quot;&lt;&lt;&quot;rsa&quot;&lt;&lt;&quot;-b&quot;&lt;&lt;&quot;1024&quot;&lt;&lt;&quot;-N&quot;&lt;&lt;&quot;&quot;&lt;&lt;&quot;-f&quot;&lt;&lt;keyName;
-// 	x2goDebug &lt;&lt;keyName&lt;&lt;endl;
-
-    if ( QProcess::execute ( &quot;ssh-keygen&quot;,args ) !=0 )
-    {
-        x2goDebug &lt;&lt;&quot;ssh-keygen failed&quot; &lt;&lt;endl;
-        return QString::null;
-    }
-// 	x2goDebug &lt;&lt;&quot;ssh-keygen ok&quot; &lt;&lt;endl;
-
-    QFile rsa ( &quot;/etc/ssh/ssh_host_rsa_key.pub&quot; );
-#ifdef Q_OS_WIN
-    rsa.setFileName (
-        wapiShortFileName (
-            homeDir+&quot;\\.x2go\\etc\\ssh_host_dsa_key.pub&quot; ) );
-#else
-    if ( userSshd )
-        rsa.setFileName ( homeDir+&quot;/.x2go/etc/ssh_host_dsa_key.pub&quot; );
-
-#endif
-
-#ifdef Q_OS_DARWIN
-    rsa.setFileName ( &quot;/etc/ssh_host_rsa_key.pub&quot; );
-#endif
-    if ( !rsa.open ( QIODevice::ReadOnly | QIODevice::Text ) )
-    {
-#ifdef Q_OS_LINUX
-        generateHostDsaKey();
-        generateEtcFiles();
-        startSshd();
-        rsa.setFileName ( homeDir+&quot;/.x2go/etc/ssh_host_dsa_key.pub&quot; );
-        rsa.open ( QIODevice::ReadOnly | QIODevice::Text );
-#else
-        printSshDError();
-        return QString::null;
-#endif
-    }
-
-    QByteArray rsa_pub;
-
-    if ( !rsa.atEnd() )
-        rsa_pub = rsa.readLine();
-    else
-    {
-        x2goDebug&lt;&lt;&quot;error: rsa file empty&quot;;
-        return QString::null;
-    }
-
-    QFile file ( keyName );
-    if ( !file.open (
-                QIODevice::WriteOnly | QIODevice::Text | QIODevice::Append )
-       )
-    {
-        x2goDebug&lt;&lt;&quot;error openning key:&quot;&lt;&lt;keyName;
-        return keyName;
-    }
-    QTextStream out ( &amp;file );
-    out&lt;&lt;&quot;----BEGIN RSA IDENTITY----&quot;&lt;&lt;rsa_pub;
-    file.close();
-    return keyName;
-}
-
-void ONMainWindow::slotCopyKey ( bool result, QString output, SshProcess* proc )
-{
-    fsExportKey=proc-&gt;getSource();
-    if ( proc )
-        delete proc;
-    proc=0;
-    x2goDebug&lt;&lt;&quot;exported key &quot;&lt;&lt;fsExportKey;
-    QFile::remove ( fsExportKey );
-    x2goDebug&lt;&lt;&quot;key removed&quot;;
-    if ( result==false )
-    {
-        QString message=tr ( &quot;&lt;b&gt;Connection failed&lt;/b&gt;\n&quot; ) +output;
-        if ( message.indexOf ( &quot;publickey,password&quot; ) !=-1 )
-        {
-            message=tr ( &quot;&lt;b&gt;Wrong password!&lt;/b&gt;&lt;br&gt;&lt;br&gt;&quot; ) +
-                    message;
-        }
-
-        QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),message,
-                                QMessageBox::Ok,
-                                QMessageBox::NoButton );
-        QFile::remove ( fsExportKey+&quot;.pub&quot; );
-        return;
-    }
-    fsExportKeyReady=true;
-
-    //start reverse mounting if RSA Key and FS tunnel are ready
-    //start only once from slotFsTunnelOk() or slotCopyKey().
-    if ( !fsInTun || fsTunReady )
-        startX2goMount();
-
-}
-
-directory* ONMainWindow::getExpDir ( QString key )
-{
-    for ( int i=0;i&lt;exportDir.size();++i )
-    {
-        if ( exportDir[i].key==key )
-            return &amp;exportDir[i];
-    }
-    return 0l;
-}
-
-
-
-
-void ONMainWindow::slotRetExportDir ( bool result,QString output,
-                                      SshProcess* proc )
-{
-
-    QString key;
-    for ( int i=0;i&lt;exportDir.size();++i )
-        if ( exportDir[i].proc==proc )
-        {
-            key=exportDir[i].key;
-            exportDir.removeAt ( i );
-            break;
-        }
-
-    if ( proc )
-        delete proc;
-
-    if ( result==false )
-    {
-        QString message=tr ( &quot;&lt;b&gt;Connection failed&lt;/b&gt;\n&quot; ) +output;
-        if ( message.indexOf ( &quot;publickey,password&quot; ) !=-1 )
-        {
-            message=tr ( &quot;&lt;b&gt;Wrong password!&lt;/b&gt;&lt;br&gt;&lt;br&gt;&quot; ) +
-                    message;
-        }
-
-        QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),message,
-                                QMessageBox::Ok,
-                                QMessageBox::NoButton );
-    }
-    QFile file ( key+&quot;.pub&quot; );
-    if ( !file.open ( QIODevice::ReadOnly | QIODevice::Text ) )
-    {
-        printSshDError();
-        QFile::remove
-        ( key+&quot;.pub&quot; );
-        return;
-    }
-
-    QByteArray line = file.readLine();
-    file.close();
-    QString authofname=homeDir;
-#ifdef Q_OS_WIN
-    QDir dir;
-    dir.mkpath ( authofname+&quot;\\.x2go\\.ssh&quot; );
-    x2goDebug&lt;&lt;&quot;Creating &quot;&lt;&lt;authofname+&quot;\\.x2go\\.ssh&quot;&lt;&lt;endl;
-    authofname=wapiShortFileName ( authofname ) +&quot;/.x2go&quot;;
-#endif
-    authofname+=&quot;/.ssh/authorized_keys&quot; ;
-    file.setFileName ( authofname );
-    if ( !file.open ( QIODevice::ReadOnly | QIODevice::Text ) )
-    {
-        printSshDError();
-        QFile::remove
-        ( key+&quot;.pub&quot; );
-        return;
-    }
-
-
-    QTemporaryFile tfile ( authofname );
-    tfile.open();
-    tfile.setAutoRemove ( true );
-    QTextStream out ( &amp;tfile );
-
-    while ( !file.atEnd() )
-    {
-        QByteArray newline = file.readLine();
-        if ( newline!=line )
-            out&lt;&lt;newline;
-    }
-    file.close();
-    tfile.close();
-    file.remove();
-    tfile.copy ( authofname );
-    QFile::remove
-    ( key+&quot;.pub&quot; );
-}
-
-
-
-void ONMainWindow::exportsEdit ( SessionButton* bt )
-{
-    EditConnectionDialog dlg ( bt-&gt;id(),this,3 );
-    if ( dlg.exec() ==QDialog::Accepted )
-    {
-        bt-&gt;redraw();
-        bool vis=bt-&gt;isVisible();
-        placeButtons();
-        users-&gt;ensureVisible ( bt-&gt;x(),bt-&gt;y(),50,220 );
-        bt-&gt;setVisible ( vis );
-    }
-}
-
-
-void ONMainWindow::slotExtTimer()
-{
-
-    if ( QFile::permissions ( readLoginsFrom ) !=
-            ( QFile::ReadUser|QFile::WriteUser|QFile::ExeUser|
-              QFile::ReadOwner|QFile::WriteOwner|QFile::ExeOwner ) )
-    {
-        x2goDebug &lt;&lt;&quot;Wrong permissions on &quot;&lt;&lt;readLoginsFrom &lt;&lt;&quot;:&quot;&lt;&lt;endl;
-        x2goDebug &lt;&lt; ( int ) ( QFile::permissions (
-                                   readLoginsFrom+&quot;/.&quot; ) )
-        &lt;&lt;&quot;must be&quot;&lt;&lt; ( int ) ( QFile::ReadUser|QFile::WriteUser
-                                |QFile::ExeUser|QFile::ReadOwner|
-                                QFile::WriteOwner|
-                                QFile::ExeOwner ) &lt;&lt;endl;
-        if ( extLogin )
-            extTimer-&gt;stop();
-        return;
-    }
-    QString loginDir;
-    QString logoutDir;
-    QDir dir ( readLoginsFrom );
-    QStringList list = dir.entryList ( QDir::Files );
-    for ( int i=0;i&lt;list.size();++i )
-    {
-        QFile file ( readLoginsFrom+&quot;/&quot;+list[i] );
-        if ( !file.open ( QIODevice::ReadOnly | QIODevice::Text ) )
-            continue;
-        if ( !file.atEnd() )
-        {
-            QByteArray line = file.readLine();
-            QString ln ( line );
-            QStringList args=ln.split ( &quot;=&quot;,
-                                        QString::SkipEmptyParts );
-            if ( args.size() &gt;1 )
-            {
-                if ( args[0]==&quot;login&quot; )
-                {
-                    args[1].replace ( &quot;\n&quot;,&quot;&quot; );
-                    if ( args[1].size() )
-                        loginDir=args[1];
-                }
-                if ( args[0]==&quot;logout&quot; )
-                {
-                    x2goDebug &lt;&lt;
-                    &quot; I HAVE external logout&quot;&lt;&lt;
-                    endl;
-                    args[1].replace ( &quot;\n&quot;,&quot;&quot; );
-                    if ( args[1].size() )
-                        logoutDir=args[1];
-                }
-            }
-        }
-        file.close();
-        file.remove();
-    }
-    if ( exportTimer-&gt;isActive() ) //running session
-    {
-        if ( logoutDir != QString::null )
-        {
-            x2goDebug &lt;&lt;&quot;external logout&quot;&lt;&lt;endl;
-            externalLogout ( logoutDir );
-        }
-    }
-    else
-    {
-        if ( loginDir != QString::null )
-        {
-            x2goDebug &lt;&lt;&quot;external login&quot;&lt;&lt;endl;
-            externalLogin ( loginDir );
-        }
-    }
-}
-
-
-void ONMainWindow::slotExportTimer()
-{
-
-    if ( QFile::permissions ( readExportsFrom ) != ( QFile::ReadUser|
-            QFile::WriteUser|
-            QFile::ExeUser|
-            QFile::ReadOwner|QFile::WriteOwner|QFile::ExeOwner ) )
-    {
-        x2goDebug &lt;&lt;&quot;Wrong permissions on &quot;&lt;&lt;
-        readExportsFrom &lt;&lt;&quot;:&quot;&lt;&lt;endl;
-        x2goDebug &lt;&lt; ( int ) ( QFile::permissions (
-                                   readExportsFrom+&quot;/.&quot; ) )
-        &lt;&lt;&quot;must be&quot;&lt;&lt; ( int ) ( QFile::ReadUser|QFile::WriteUser
-                                |QFile::ExeUser|QFile::ReadOwner|
-                                QFile::WriteOwner|
-                                QFile::ExeOwner ) &lt;&lt;endl;
-        exportTimer-&gt;stop();
-        return;
-    }
-
-    QDir dir ( readExportsFrom );
-    QStringList list = dir.entryList ( QDir::Files );
-    QString expList;
-    QString unexpList;
-    QString loginDir;
-    QString logoutDir;
-    for ( int i=0;i&lt;list.size();++i )
-    {
-        QFile file ( readExportsFrom+&quot;/&quot;+list[i] );
-        if ( !file.open ( QIODevice::ReadOnly | QIODevice::Text ) )
-            continue;
-        if ( !file.atEnd() )
-        {
-            QByteArray line = file.readLine();
-            QString ln ( line );
-            QStringList args=ln.split ( &quot;=&quot;,
-                                        QString::SkipEmptyParts );
-            if ( args.size() &gt;1 )
-            {
-                if ( args[0]==&quot;export&quot; )
-                {
-                    args[1].replace ( &quot;\n&quot;,&quot;&quot; );
-                    if ( args[1].size() )
-                        expList+=&quot;:&quot;+args[1];
-                }
-                if ( args[0]==&quot;unexport&quot; )
-                {
-                    args[1].replace ( &quot;\n&quot;,&quot;&quot; );
-                    if ( args[1].size() )
-                        unexpList+=&quot;:&quot;+args[1];
-                }
-            }
-        }
-        file.close();
-        file.remove();
-    }
-    QStringList args=expList.split ( &quot;:&quot;,QString::SkipEmptyParts );
-    expList=args.join ( &quot;:&quot; );
-    if ( expList.size() &gt;0 )
-    {
-        exportDirs ( expList,true );
-    }
-    args.clear();
-    args=unexpList.split ( &quot;:&quot;,QString::SkipEmptyParts );
-
-    QString passwd=getCurrentPass();
-    QString user=getCurrentUname();
-    QString host=resumingSession.server;
-    QString sessionId=resumingSession.sessionId;
-
-    for ( int i=0;i&lt;args.size();++i )
-    {
-        SshProcess* sproc=new SshProcess (
-            sshConnection, this );
-        sproc-&gt;startNormal ( &quot;export HOSTNAME &amp;&amp; x2goumount_session &quot;+
-                             sessionId+&quot; &quot;+args[i] );
-    }
-}
-
-void ONMainWindow::slotAboutQt()
-{
-    QMessageBox::aboutQt ( this );
-}
-
-void ONMainWindow::slotSupport()
-{
-    QFile file(supportMenuFile);
-    if (!file.open(QIODevice::ReadOnly | QIODevice::Text))
-        return;
-
-    QTextStream in(&amp;file);
-    QString sup;
-    while (!in.atEnd())
-    {
-        sup+=in.readLine();
-    }
-    QMessageBox::information (this,tr ( &quot;Support&quot; ),sup);
-}
-
-void ONMainWindow::slotAbout()
-{
-    QString aboutStr=tr (
-                         &quot;&lt;/b&gt;&lt;br&gt; (C. 2006-2012 &lt;b&gt;obviously nice&lt;/b&gt;: &quot;
-                         &quot;Oleksandr Shneyder, Heinz-Markus Graesing)&lt;br&gt;&quot; );
-    if ( embedMode )
-        aboutStr+=tr ( &quot;&lt;br&gt;x2goplugin mode was sponsored by &quot;
-                       &quot;&lt;a href=\&quot;<A HREF="http://www.foss-group.de/\">http://www.foss-group.de/\</A>&quot;&gt;&quot;
-                       &quot;FOSS-Group GmbH(Freiburg)&lt;/a&gt;&lt;br&gt;&quot; );
-    aboutStr+=
-        tr (
-            &quot;&lt;br&gt;Client for use with the X2Go network based &quot;
-            &quot;computing environment. This Client will be able &quot;
-            &quot;to connect to X2Go server(s) and start, stop, &quot;
-            &quot;resume and terminate (running) desktop sessions. &quot;
-            &quot;X2Go Client stores different server connections &quot;
-            &quot;and may automatically request authentification &quot;
-            &quot;data from LDAP directories. Furthermore it can be &quot;
-            &quot;used as fullscreen loginscreen (replacement for &quot;
-            &quot;loginmanager like xdm). Please visit x2go.org for &quot;
-            &quot;further information.&quot; );
-    QMessageBox::about (
-        this,tr ( &quot;About X2GO client&quot; ),
-        tr ( &quot;&lt;b&gt;X2Go client V. &quot; ) +VERSION+
-        &quot; &lt;/b &gt;(Qt - &quot;+qVersion() +&quot;)&quot;+
-        aboutStr );
-}
-
-
-
-void ONMainWindow::slotRereadUsers()
-{
-    if ( !useLdap )
-        return;
-#ifdef USELDAP
-
-    if ( ld )
-    {
-        delete ld;
-        ld=0;
-    }
-
-
-    if ( ! initLdapSession ( false ) )
-    {
-        return;
-    }
-
-
-    list&lt;string&gt; attr;
-    attr.push_back ( &quot;uidNumber&quot; );
-    attr.push_back ( &quot;uid&quot; );
-
-
-    list&lt;LDAPBinEntry&gt; result;
-    try
-    {
-        ld-&gt;binSearch ( ldapDn.toStdString(),attr,
-                        &quot;objectClass=posixAccount&quot;,result );
-    }
-    catch ( LDAPExeption e )
-    {
-        QString message=&quot;Exeption in: &quot;;
-        message=message+e.err_type.c_str();
-        message=message+&quot; : &quot;+e.err_str.c_str();
-        QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),message,
-                                QMessageBox::Ok,QMessageBox::NoButton );
-        QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),
-                                tr ( &quot;Please check LDAP Settings&quot; ),
-                                QMessageBox::Ok,QMessageBox::NoButton );
-        slotConfig();
-        return;
-    }
-
-    list&lt;LDAPBinEntry&gt;::iterator it=result.begin();
-    list&lt;LDAPBinEntry&gt;::iterator end=result.end();
-
-    for ( ;it!=end;++it )
-    {
-        user u;
-        QString uin=LDAPSession::getBinAttrValues (
-                        *it,&quot;uidNumber&quot; ).front().getData();
-        u.uin=uin.toUInt();
-        if ( u.uin&lt;firstUid || u.uin&gt;lastUid )
-        {
-            continue;
-        }
-        u.uid=LDAPSession::getBinAttrValues (
-                  *it,&quot;uid&quot; ).front().getData();
-        if ( !findInList ( u.uid ) )
-        {
-            reloadUsers();
-            return;
-        }
-    }
-#endif
-}
-
-void ONMainWindow::reloadUsers()
-{
-    int i;
-    for ( i=0;i&lt;names.size();++i )
-        names[i]-&gt;close();
-    for ( i=0;i&lt;sessions.size();++i )
-        sessions[i]-&gt;close();
-
-    userList.clear();
-    sessions.clear();
-
-
-    loadSettings();
-    if ( useLdap )
-    {
-        act_new-&gt;setEnabled ( false );
-        act_edit-&gt;setEnabled ( false );
-        u-&gt;setText ( tr ( &quot;Login:&quot; ) );
-        QTimer::singleShot ( 1, this, SLOT ( readUsers() ) );
-    }
-    else
-    {
-        act_new-&gt;setEnabled ( true );
-        act_edit-&gt;setEnabled ( true );
-        u-&gt;setText ( tr ( &quot;Session:&quot; ) );
-        QTimer::singleShot ( 1, this, SLOT ( slotReadSessions() ) );
-    }
-    slotResize ( fr-&gt;size() );
-}
-
-
-bool ONMainWindow::findInList ( const QString&amp; uid )
-{
-    for ( int i=0;i&lt;userList.size();++i )
-    {
-        if ( userList[i].uid==uid )
-            return true;
-    }
-    return false;
-}
-
-void ONMainWindow::setUsersEnabled ( bool enable )
-{
-
-    if ( useLdap )
-    {
-        QScrollBar* bar=users-&gt;verticalScrollBar();
-        bar-&gt;setEnabled ( enable );
-        int upos=bar-&gt;value();
-        QDesktopWidget dw;
-        int height=dw.screenGeometry ( fr ).height();
-        QList&lt;UserButton*&gt;::iterator it;
-        QList&lt;UserButton*&gt;::iterator endit=names.end();
-        if ( !enable )
-        {
-            for ( it=names.begin();it!=endit;it++ )
-            {
-                QPoint pos= ( *it )-&gt;pos();
-                if ( ( pos.y() &gt;upos-height ) &amp;&amp;
-                        ( pos.y() &lt;upos+height ) )
-                    ( *it )-&gt;setEnabled ( false );
-                if ( pos.y() &gt;upos+height )
-                    break;
-            }
-        }
-        else
-        {
-            for ( it=names.begin();it!=endit;it++ )
-            {
-                if ( ! ( *it )-&gt;isEnabled() )
-                    ( *it )-&gt;setEnabled ( true );
-            }
-        }
-    }
-    else
-        users-&gt;setEnabled ( enable );
-}
-
-
-void ONMainWindow::externalLogin ( const QString&amp; loginDir )
-{
-    QFile file ( loginDir+&quot;/username&quot; );
-    QString user;
-
-    if ( !file.open ( QIODevice::ReadOnly | QIODevice::Text ) )
-        return;
-    QTextStream in ( &amp;file );
-    while ( !in.atEnd() )
-    {
-        user=in.readLine();
-        break;
-    }
-    file.close();
-
-
-    if ( passForm-&gt;isVisible() )
-        slotClosePass();
-    uname-&gt;setText ( user );
-    slotUnameEntered();
-    currentKey=loginDir+&quot;/dsa.key&quot;;
-    extStarted=true;
-    slotPassEnter();
-}
-
-
-void ONMainWindow::externalLogout ( const QString&amp; )
-{
-    if ( extStarted )
-    {
-        extStarted=false;
-        currentKey=QString::null;
-        if ( nxproxy )
-            if ( nxproxy-&gt;state() ==QProcess::Running )
-                nxproxy-&gt;terminate();
-    }
-}
-
-
-void ONMainWindow::slotStartPGPAuth()
-{
-    scDaemon=new QProcess ( this );
-    QStringList arguments;
-    arguments&lt;&lt;&quot;--multi-server&quot;;
-    connect ( scDaemon,SIGNAL ( readyReadStandardError() ),this,
-              SLOT ( slotScDaemonError() ) );
-    connect ( scDaemon,SIGNAL ( readyReadStandardOutput() ),this,
-              SLOT ( slotScDaemonOut() ) );
-    connect ( scDaemon,SIGNAL ( finished ( int,QProcess::ExitStatus ) ),
-              this,
-              SLOT (
-                  slotScDaemonFinished ( int, QProcess::ExitStatus ) ) );
-    scDaemon-&gt;start ( &quot;scdaemon&quot;,arguments );
-    QTimer::singleShot ( 3000, this, SLOT ( slotCheckScDaemon() ) );
-    isScDaemonOk=false;
-}
-
-void ONMainWindow::slotCheckScDaemon()
-{
-    if ( !isScDaemonOk )
-    {
-        scDaemon-&gt;kill();
-    }
-}
-
-void ONMainWindow::slotScDaemonError()
-{
-    QString stdOut ( scDaemon-&gt;readAllStandardError() );
-    stdOut=stdOut.simplified();
-    x2goDebug&lt;&lt;&quot;SCDAEMON err:&quot;&lt;&lt;stdOut&lt;&lt;endl;
-    if ( stdOut.indexOf ( &quot;updating slot&quot; ) !=-1 ||
-            stdOut.indexOf ( &quot;updating status of slot&quot; ) !=-1 )
-    {
-        isScDaemonOk=true;
-        //USABLE or PRESENT
-        if ( ( stdOut.indexOf ( &quot;0x0002&quot; ) !=-1 ) ||
-                ( stdOut.indexOf ( &quot;0x0007&quot; ) !=-1 ) )
-        {
-            scDaemon-&gt;kill();
-        }
-    }
-}
-
-void ONMainWindow::slotScDaemonOut()
-{
-    QString stdOut ( scDaemon-&gt;readAllStandardOutput() );
-    stdOut=stdOut.simplified();
-    x2goDebug&lt;&lt;&quot;SCDAEMON out:&quot;&lt;&lt;stdOut&lt;&lt;endl;
-}
-
-void ONMainWindow::slotScDaemonFinished ( int , QProcess::ExitStatus )
-{
-    scDaemon=0l;
-    if ( isScDaemonOk )
-    {
-        x2goDebug&lt;&lt;&quot;scDaemon finished&quot;&lt;&lt;endl;
-        gpg=new QProcess ( this );
-        QStringList arguments;
-        arguments&lt;&lt;&quot;--card-status&quot;;
-        connect ( gpg,SIGNAL ( readyReadStandardError() ),
-                  this,SLOT ( slotGpgError() ) );
-        connect ( gpg,SIGNAL ( finished ( int,
-                                          QProcess::ExitStatus ) ),this,
-                  SLOT ( slotGpgFinished ( int,
-                                           QProcess::ExitStatus ) ) );
-        gpg-&gt;start ( &quot;gpg&quot;,arguments );
-    }
-    else
-        slotStartPGPAuth();
-}
-
-
-
-void ONMainWindow::slotGpgError()
-{
-    QString stdOut ( gpg-&gt;readAllStandardError() );
-    stdOut=stdOut.simplified();
-    x2goDebug&lt;&lt;&quot;GPG err:&quot;&lt;&lt;stdOut&lt;&lt;endl;
-    if ( stdOut.indexOf ( &quot;failed&quot; ) !=-1 )
-    {
-        QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),
-                                tr ( &quot;No valid card found&quot; ),
-                                QMessageBox::Ok,
-                                QMessageBox::NoButton );
-        gpg-&gt;kill();
-    }
-}
-
-
-void ONMainWindow::slotGpgFinished ( int exitCode,
-                                     QProcess::ExitStatus exitStatus )
-{
-    x2goDebug&lt;&lt;&quot;gpg finished, exit code:&quot;&lt;&lt;exitCode&lt;&lt;&quot; exit status:&quot;&lt;&lt;
-    exitStatus&lt;&lt;endl;
-    if ( exitStatus==0 )
-    {
-        QString stdOut ( gpg-&gt;readAllStandardOutput() );
-        stdOut.chop ( 1 );
-        x2goDebug&lt;&lt;&quot;GPG out:&quot;&lt;&lt;stdOut&lt;&lt;endl;
-        QStringList lines=stdOut.split ( &quot;\n&quot; );
-        QString login;
-        QString appId;
-        QString authKey;
-        for ( int i=0;i&lt;lines.count();++i )
-        {
-            if ( lines[i].indexOf ( &quot;Application ID&quot; ) !=-1 )
-            {
-                appId=lines[i].split ( &quot;:&quot; ) [1];
-            }
-            else if ( lines[i].indexOf ( &quot;Login data&quot; ) !=-1 )
-            {
-                login=lines[i].split ( &quot;:&quot; ) [1];
-            }
-            else if ( lines[i].indexOf (
-                          &quot;Authentication key&quot; ) !=-1 )
-            {
-                authKey=lines[i].split ( &quot;:&quot; ) [1];
-                break;
-            }
-        }
-        appId=appId.simplified();
-        login=login.simplified();
-        authKey=authKey.simplified();
-        x2goDebug&lt;&lt;&quot;card data: &quot;&lt;&lt;appId&lt;&lt;login&lt;&lt;authKey&lt;&lt;endl;
-        if ( login==&quot;[not set]&quot; || authKey == &quot;[none]&quot; )
-        {
-            x2goDebug&lt;&lt;&quot;Card not configured\n&quot;;
-            QMessageBox::critical (
-                0l,tr ( &quot;Error&quot; ),
-                tr (
-                    &quot;This card is unknown by X2Go system&quot; ),
-                QMessageBox::Ok,
-                QMessageBox::NoButton );
-            QTimer::singleShot ( 1000, this,
-                                 SLOT ( slotStartPGPAuth() ) );
-        }
-        else
-            startGPGAgent ( login,appId );
-    }
-    else
-        QTimer::singleShot ( 1000, this, SLOT ( slotStartPGPAuth() ) );
-    gpg=0l;
-}
-
-
-
-void ONMainWindow::startGPGAgent ( const QString&amp; login, const QString&amp; appId )
-{
-    QString gpgPath=homeDir +&quot;/.x2goclient/gnupg&quot;;
-    QDir d;
-    cardLogin=login;
-    d.mkpath ( gpgPath );
-    QFile file ( gpgPath+&quot;/scd-event&quot; );
-    if ( !file.open ( QIODevice::WriteOnly | QIODevice::Text ) )
-    {
-        QMessageBox::critical (
-            0l,tr ( &quot;Error&quot; ),
-            tr (
-                &quot;Unable to create file: &quot; ) +
-            gpgPath+&quot;/scd-event&quot;
-            ,QMessageBox::Ok,
-            QMessageBox::NoButton );
-        exit ( -1 );
-    }
-    QTextStream out ( &amp;file );
-    out &lt;&lt; &quot;#!/bin/bash\n\n&quot;
-    &quot;if [ \&quot;$6\&quot; != \&quot;0x0002\&quot; ] &amp;&amp; [ \&quot;$6\&quot; != &quot;
-    &quot;\&quot;0x0007\&quot; ]\n\
-	then\n\
-	kill -9 $_assuan_pipe_connect_pid\n\
-	fi&quot;&lt;&lt;endl;
-    file.close();
-    file.setPermissions ( gpgPath+&quot;/scd-event&quot;,
-                          QFile::ReadOwner|
-                          QFile::WriteOwner|
-                          QFile::ExeOwner );
-
-    gpgAgent=new QProcess ( this );
-    QStringList arguments;
-    arguments&lt;&lt;&quot;--pinentry-program&quot;&lt;&lt;&quot;/usr/bin/pinentry-x2go&quot;&lt;&lt;
-    &quot;--enable-ssh-support&quot;&lt;&lt;&quot;--daemon&quot;&lt;&lt;&quot;--no-detach&quot;;
-
-    connect ( gpgAgent,SIGNAL ( finished ( int,QProcess::ExitStatus ) ),
-              this,
-              SLOT ( slotGpgAgentFinished ( int,
-                                            QProcess::ExitStatus ) ) );
-
-    QStringList env=QProcess::systemEnvironment();
-    env&lt;&lt;&quot;GNUPGHOME=&quot;+gpgPath&lt;&lt;&quot;CARDAPPID=&quot;+appId;
-    gpgAgent-&gt;setEnvironment ( env );
-    gpgAgent-&gt;start ( &quot;gpg-agent&quot;,arguments );
-}
-
-void ONMainWindow::slotGpgAgentFinished ( int , QProcess::ExitStatus )
-{
-    QString stdOut ( gpgAgent-&gt;readAllStandardOutput() );
-    stdOut=stdOut.simplified();
-    stdOut.replace ( &quot; &quot;,&quot;&quot; );
-    QStringList envLst=stdOut.split ( &quot;;&quot; );
-    QString gpg_agent_info=envLst[0].split ( &quot;=&quot; ) [1];
-    QString ssh_auth_sock=envLst[2].split ( &quot;=&quot; ) [1];
-    agentPid=envLst[4].split ( &quot;=&quot; ) [1];
-    x2goDebug&lt;&lt;gpg_agent_info&lt;&lt;ssh_auth_sock&lt;&lt;agentPid&lt;&lt;endl;
-    x2goDebug&lt;&lt;&quot;GPGAGENT out:&quot;&lt;&lt;envLst[0]&lt;&lt;envLst[2]&lt;&lt;envLst[4]&lt;&lt;endl;
-
-    agentCheckTimer-&gt;start ( 1000 );
-    cardReady=true;
-
-    sshEnv.clear();
-    sshEnv&lt;&lt;envLst[0]&lt;&lt;envLst[2]&lt;&lt;envLst[4];
-// 	x2goDebug&lt;&lt;&quot;sshenv:&quot;&lt;&lt;sshEnv&lt;&lt;endl;
-
-    if ( !useLdap )
-    {
-        if ( passForm-&gt;isVisible() &amp;&amp; !brokerMode)
-        {
-            if ( passForm-&gt;isEnabled() )
-            {
-                if ( login-&gt;isEnabled() )
-                {
-                    login-&gt;setText ( cardLogin );
-                    slotSessEnter();
-                    return;
-                }
-            }
-        }
-        QProcess sshadd ( this ); //using it to start scdaemon
-        sshadd.setEnvironment ( sshEnv );
-        QStringList arguments;
-        arguments&lt;&lt;&quot;-l&quot;;
-        sshadd.start ( &quot;ssh-add&quot;,arguments );
-        sshadd.waitForFinished ( -1 );
-        QString sshout ( sshadd.readAllStandardOutput() );
-        sshout=sshout.simplified();
-        x2goDebug&lt;&lt;&quot;SSH-ADD out:&quot;&lt;&lt;sshout&lt;&lt;endl;
-    }
-    else
-    {
-        if ( selectSessionDlg-&gt;isVisible() ||
-                sessionStatusDlg-&gt;isVisible() )
-        {
-            QProcess sshadd ( this ); //using it to start scdaemon
-            sshadd.setEnvironment ( sshEnv );
-            QStringList arguments;
-            arguments&lt;&lt;&quot;-l&quot;;
-            sshadd.start ( &quot;ssh-add&quot;,arguments );
-            sshadd.waitForFinished ( -1 );
-            QString sshout ( sshadd.readAllStandardOutput() );
-            sshout=sshout.simplified();
-            x2goDebug&lt;&lt;&quot;SSH-ADD out:&quot;&lt;&lt;sshout&lt;&lt;endl;
-            return;
-        }
-        if ( passForm-&gt;isVisible() )
-            slotClosePass();
-        uname-&gt;setText ( cardLogin );
-        slotUnameEntered();
-        slotPassEnter();
-    }
-}
-
-
-void ONMainWindow::slotCheckAgentProcess()
-{
-    if ( checkAgentProcess() )
-        return;
-    agentCheckTimer-&gt;stop();
-    cardReady=false;
-    if ( cardStarted )
-    {
-        cardStarted=false;
-        if ( nxproxy )
-            if ( nxproxy-&gt;state() ==QProcess::Running )
-            {
-                x2goDebug&lt;&lt;&quot;Suspending session\n&quot;;
-                slotSuspendSessFromSt();
-//                 nxproxy-&gt;terminate();
-            }
-    }
-
-    x2goDebug&lt;&lt;&quot;gpg-agent finished\n&quot;;
-    slotStartPGPAuth();
-}
-
-bool ONMainWindow::checkAgentProcess()
-{
-    QFile file ( &quot;/proc/&quot;+agentPid+&quot;/cmdline&quot; );
-    if ( file.open ( QIODevice::ReadOnly | QIODevice::Text ) )
-    {
-        QString line ( file.readLine() );
-        file.close();
-        if ( line.indexOf ( &quot;gpg-agent&quot; ) !=-1 )
-        {
-            return true;
-        }
-    }
-    return false;
-}
-
-#if defined ( Q_OS_DARWIN )
-QString ONMainWindow::getXDisplay()
-{
-    QLocalSocket unixSocket (this);
-    QString xsocket (getenv (&quot;DISPLAY&quot;));
-
-    // OS X starts the X11 server automatically, as soon as the launchd UNIX socket
-    // is accessed.
-    // On user login, the DISPLAY environment variable is set to this said existing
-    // socket.
-    // By now, we should have a socket. Test, if connecting works.
-    if ((!xsocket.isEmpty ()))
-    {
-        unixSocket.connectToServer (xsocket);
-
-        if (unixSocket.waitForConnected (10000))
-        {
-            unixSocket.disconnectFromServer ();
-            return (xsocket);
-        }
-    }
-    // And if not, error out.
-    QMessageBox::critical (
-        this,tr ( &quot;Can't connect to X server\nPlease check your settings&quot; ),
-        tr (
-            &quot;Can't start X server\nPlease check your settings&quot; ) );
-    slotConfig();
-    return QString::null;
-}
-#endif
-
-#ifdef Q_OS_WIN
-QString ONMainWindow::getXDisplay()
-{
-    if ( !isServerRunning ( 6000+xDisplay ) )
-    {
-        QMessageBox::critical (
-            this,QString::null,
-            tr (
-                &quot;Can't start X Server\nPlease check your installation&quot; )
-        );
-        close();
-    }
-    return QString::number ( xDisplay );
-
-}
-
-QString ONMainWindow::cygwinPath ( const QString&amp; winPath )
-{
-    QString cPath=&quot;/cygdrive/&quot;+winPath;
-    cPath.replace ( &quot;\\&quot;,&quot;/&quot; );
-    cPath.replace ( &quot;:&quot;,&quot;&quot; );
-    return cPath;
-}
-#endif
-
-bool ONMainWindow::isColorDepthOk ( int disp, int sess )
-{
-    if ( sess==0 )
-        return true;
-    if ( disp==sess )
-        return true;
-    if ( ( disp == 24 || disp == 32 ) &amp;&amp; ( sess == 24 || sess == 32 ) )
-        return true;
-    return false;
-}
-
-#ifndef Q_OS_LINUX
-void ONMainWindow::setWidgetStyle ( QWidget* widget )
-{
-    widget-&gt;setStyle ( widgetExtraStyle );
-}
-#else
-void ONMainWindow::setWidgetStyle ( QWidget* )
-{
-}
-#endif
-
-QString ONMainWindow::internAppName ( const QString&amp; transAppName, bool* found )
-{
-    if ( found )
-        *found=false;
-    int ind=_transApplicationsNames.indexOf ( transAppName );
-    if ( ind!=-1 )
-    {
-        if ( found )
-            *found=true;
-        return _internApplicationsNames[ind];
-    }
-    return transAppName;
-}
-
-
-QString ONMainWindow::transAppName ( const QString&amp; internAppName, bool* found )
-{
-    if ( found )
-        *found=false;
-    int ind=_internApplicationsNames.indexOf ( internAppName );
-    if ( ind!=-1 )
-    {
-        if ( found )
-            *found=true;
-        return _transApplicationsNames[ind];
-    }
-    return internAppName;
-}
-
-void ONMainWindow::addToAppNames ( QString intName, QString transName )
-{
-    _internApplicationsNames.append ( intName );
-    _transApplicationsNames.append ( transName );
-}
-
-
-void ONMainWindow::slotExecXmodmap()
-{
-#ifdef Q_WS_HILDON
-    QString passwd=getCurrentPass();
-    QString user=getCurrentUname();
-    QString host=resumingSession.server;
-    QString cmd;
-
-    cmd=&quot;(xmodmap -pke ;&quot;
-        &quot;echo keycode 73= ;&quot;
-// 	    &quot;echo clear shift ;&quot;
-// 	    &quot;echo clear lock ;&quot;
-// 	    &quot;echo clear control ;&quot;
-// 	    &quot;echo clear mod1 ;&quot;
-// 	    &quot;echo clear mod2 ;&quot;
-// 	    &quot;echo clear mod3 ;&quot;
-// 	    &quot;echo clear mod4 ;&quot;
-// 	    &quot;echo clear mod5 ;&quot;
-//  	    &quot;echo add shift = Shift_L ;&quot;
-        &quot;echo add control = Control_R &quot;
-//  	    &quot;echo add mod5 = ISO_Level3_Shift&quot;
-        &quot;)| DISPLAY=:&quot;
-        +resumingSession.display+&quot; xmodmap - &quot;;
-    x2goDebug&lt;&lt;&quot;cmd:&quot;&lt;&lt;cmd;
-    SshProcess* xmodProc;
-    try
-    {
-        xmodProc=new SshProcess ( this,user,host,sshPort,
-                                  cmd,
-                                  passwd,currentKey,acceptRsa );
-    }
-    catch ( QString message )
-    {
-        return;
-    }
-
-    if ( cardReady /*|| useSshAgent*/ )
-    {
-        QStringList env=xmodProc-&gt;environment();
-        env+=sshEnv;
-        xmodProc-&gt;setEnvironment ( env );
-    }
-    xmodProc-&gt;setFwX ( true );
-    xmodProc-&gt;startNormal();
-#endif
-}
-
-void ONMainWindow::check_cmd_status()
-{
-    QString passwd;
-    QString user=getCurrentUname();
-    QString host=resumingSession.server;
-    passwd=getCurrentPass();
-
-    x2goDebug&lt;&lt;&quot;check command message&quot;&lt;&lt;endl;
-    SshProcess* proc;
-    proc=new SshProcess ( sshConnection, this );
-    connect ( proc,SIGNAL ( sshFinished ( bool,QString,SshProcess* ) ),
-              this,SLOT ( slotCmdMessage ( bool, QString,SshProcess* ) ) );
-
-    proc-&gt;startNormal ( &quot;x2gocmdexitmessage &quot;+
-                        resumingSession.sessionId );
-}
-
-void ONMainWindow::slotCmdMessage ( bool result,QString output,
-                                    SshProcess* proc )
-{
-    if ( proc )
-        delete proc;
-    if ( result==false )
-    {
-        cardReady=false;
-        cardStarted=false;
-        QString message=tr ( &quot;&lt;b&gt;Connection failed&lt;/b&gt;\n&quot; ) +output;
-        if ( message.indexOf ( &quot;publickey,password&quot; ) !=-1 )
-        {
-            message=tr ( &quot;&lt;b&gt;Wrong password!&lt;/b&gt;&lt;br&gt;&lt;br&gt;&quot; ) +
-                    message;
-        }
-
-        QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),message,
-                                QMessageBox::Ok,
-                                QMessageBox::NoButton );
-// 		currentKey=QString::null;
-        setEnabled ( true );
-        passForm-&gt;setEnabled ( true );
-        pass-&gt;setFocus();
-        pass-&gt;selectAll();
-        sshConnection-&gt;disconnectSession();
-        return;
-    }
-    if ( output.indexOf ( &quot;X2GORUNCOMMAND ERR NOEXEC:&quot; ) !=-1 )
-    {
-        QString cmd=output;
-        cmd.replace ( &quot;X2GORUNCOMMAND ERR NOEXEC:&quot;,&quot;&quot; );
-        QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),
-                                tr ( &quot;Unable to execute: &quot; ) +
-                                cmd,QMessageBox::Ok,
-                                QMessageBox::NoButton );
-    }
-    sshConnection-&gt;disconnectSession();
-}
-
-
-int ONMainWindow::startSshFsTunnel()
-{
-    fsTunReady=false;
-    x2goDebug&lt;&lt;&quot;starting fs tunnel for:&quot;&lt;&lt;resumingSession.sessionId&lt;&lt;
-    &quot;\nfs port: &quot;&lt;&lt;resumingSession.fsPort;
-
-    if ( resumingSession.fsPort.length() &lt;=0 )
-    {
-        QString message=tr (
-                            &quot;Remote server does not &quot;
-                            &quot;support file system export &quot;
-                            &quot;through SSH Tunnel\n&quot;
-                            &quot;Please update to a newer &quot;
-                            &quot;x2goserver package&quot; );
-        slotFsTunnelFailed ( false,message,0 );
-        return 1;
-    }
-    QString passwd=getCurrentPass();
-    QString uname=getCurrentUname();
-
-    fsTunnel=new SshProcess ( sshConnection, this );
-
-    connect ( fsTunnel,SIGNAL ( sshFinished ( bool,
-                                QString,SshProcess* ) ),
-              this,SLOT ( slotFsTunnelFailed ( bool,
-                                               QString,SshProcess* ) ) );
-
-    connect ( fsTunnel,SIGNAL ( sshTunnelOk() ),
-              this,SLOT ( slotFsTunnelOk() ) );
-
-    fsTunnel-&gt;startTunnel ( &quot;localhost&quot;,resumingSession.fsPort.toUInt(),&quot;127.0.0.1&quot;,
-                            clientSshPort.toInt(), true );
-    return 0;
-}
-
-void ONMainWindow::slotFsTunnelFailed ( bool result,  QString output,
-                                        SshProcess* )
-{
-    if ( result==false )
-    {
-        if ( !managedMode )
-        {
-
-            QString message=tr ( &quot;Unable to create SSL tunnel:\n&quot; )
-                            +output;
-            QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),message,
-                                    QMessageBox::Ok,
-                                    QMessageBox::NoButton );
-        }
-        if ( fsTunnel )
-            delete fsTunnel;
-        fsTunnel=0l;
-        fsTunReady=false;
-    }
-}
-
-
-void ONMainWindow::slotFsTunnelOk()
-{
-    fsTunReady=true;
-    //start reverse mounting if RSA Key and FS tunnel are ready
-    //start only once from slotFsTunnelOk() or slotCopyKey().
-    if ( fsExportKeyReady )
-        startX2goMount();
-}
-
diff --git a/onmainwindow_part4.cpp b/onmainwindow_part4.cpp
deleted file mode 100644
index 731937a..0000000
--- a/onmainwindow_part4.cpp
+++ /dev/null
@@ -1,2861 +0,0 @@
-/**************************************************************************
-*   Copyright (C) 2005-2012 by Oleksandr Shneyder                         *
-*   <A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">oleksandr.shneyder at obviously-nice.de</A>                                  *
-*                                                                         *
-*   This program is free software; you can redistribute it and/or modify  *
-*   it under the terms of the GNU General Public License as published by  *
-*   the Free Software Foundation; either version 2 of the License, or     *
-*   (at your option) any later version.                                   *
-*                                                                         *
-*   This program is distributed in the hope that it will be useful,       *
-*   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
-*   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
-*   GNU General Public License for more details.                          *
-*                                                                         *
-*   You should have received a copy of the GNU General Public License     *
-*   along with this program; if not, write to the                         *
-*   Free Software Foundation, Inc.,                                       *
-*   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
-***************************************************************************/
-
-#include &quot;onmainwindow_privat.h&quot;
-
-void ONMainWindow::startX2goMount()
-{
-    QFile file ( fsExportKey+&quot;.pub&quot; );
-    if ( !file.open ( QIODevice::ReadOnly | QIODevice::Text ) )
-    {
-        QString message=tr ( &quot;Unable to read :\n&quot; ) +fsExportKey+&quot;.pub&quot;;
-        QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),message,
-                                QMessageBox::Ok,
-                                QMessageBox::NoButton );
-        QFile::remove
-        ( fsExportKey+&quot;.pub&quot; );
-        return;
-    }
-
-    QByteArray line = file.readLine();
-    file.close();
-    QString authofname=homeDir;
-#ifdef Q_OS_WIN
-    QDir tdir;
-    tdir.mkpath ( authofname+&quot;\\.x2go\\.ssh&quot; );
-    x2goDebug&lt;&lt;&quot;Creating &quot;&lt;&lt;authofname+&quot;\\.x2go\\.ssh&quot;&lt;&lt;endl;
-    authofname=wapiShortFileName ( authofname ) +&quot;/.x2go&quot;;
-#endif
-    authofname+= &quot;/.ssh/authorized_keys&quot; ;
-
-    QFile file1 ( authofname );
-
-    if ( !file1.open ( QIODevice::WriteOnly | QIODevice::Text |
-                       QIODevice::Append ) )
-    {
-        QString message=tr ( &quot;Unable to write :\n&quot; ) + authofname;
-        QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),message,
-                                QMessageBox::Ok,
-                                QMessageBox::NoButton );
-        QFile::remove
-        ( fsExportKey+&quot;.pub&quot; );
-        return;
-
-    }
-    QTextStream out ( &amp;file1 );
-    out&lt;&lt;line;
-    file1.close();
-    directory* dir=getExpDir ( fsExportKey );
-    bool rem=dir-&gt;isRemovable;
-    if ( !dir )
-        return;
-
-    QString passwd=getCurrentPass();
-    QString user=getCurrentUname();
-    QString host=resumingSession.server;
-    QString sessionId=resumingSession.sessionId;
-
-    QStringList env=QProcess::systemEnvironment();
-
-
-    QString cuser;
-#ifndef Q_WS_HILDON
-    for ( int i=0;i&lt;env.size();++i )
-    {
-        QStringList ls=env[i].split ( &quot;=&quot; );
-        if ( ls[0]==&quot;USER&quot; )
-
-        {
-            cuser=ls[1];
-            break;
-        }
-    }
-#else
-    cuser=&quot;user&quot;;
-#endif
-#ifdef Q_OS_WIN
-    cuser=&quot;sshuser&quot;;
-#endif
-    SshProcess* proc=0l;
-    QString cmd;
-    QString dirs=dir-&gt;dirList;
-
-    if ( !fsInTun &amp;&amp; clientSshPort!=&quot;22&quot; )
-    {
-        dirs=dirs+&quot;__SSH_PORT__&quot;+clientSshPort;
-    }
-    if ( fsInTun )
-    {
-        dirs=dirs+&quot;__REVERSESSH_PORT__&quot;+resumingSession.fsPort;
-    }
-    if ( !rem )
-        cmd=&quot;export HOSTNAME &amp;&amp; x2gomountdirs dir &quot;+sessionId+&quot; &quot;+cuser+
-            &quot; &quot;+dir-&gt;dstKey+&quot; &quot;+dirs;
-    else
-        cmd=&quot;export HOSTNAME &amp;&amp; x2gomountdirs rem &quot;+sessionId+&quot; &quot;+cuser+
-            &quot; &quot;+dir-&gt;dstKey+&quot; &quot;+dirs;
-
-#ifdef Q_OS_WIN
-
-    cmd=&quot;chmod 600 &quot;+dir-&gt;dstKey+&quot;&amp;&amp;&quot;+cmd;
-#endif
-
-
-
-    X2goSettings st ( &quot;sessions&quot; );
-
-    if ( !useLdap )
-    {
-        QString sid;
-        if ( !embedMode )
-            sid=lastSession-&gt;id();
-        else
-            sid=&quot;embedded&quot;;
-        if ( st.setting()-&gt;value (
-                    sid+&quot;/useiconv&quot;, ( QVariant ) false ).toBool() )
-        {
-            QString toCode=st.setting()-&gt;value (
-                               sid+&quot;/iconvto&quot;,
-                               ( QVariant ) &quot;UTF-8&quot; ).toString();
-
-#ifdef Q_OS_WIN
-            QString fromCode=st.setting()-&gt;value (
-                                 sid+&quot;/iconvfrom&quot;,
-                                 ( QVariant ) tr (
-                                     &quot;WINDOWS-1252&quot; ) ).toString();
-#endif
-#ifdef Q_OS_DARWIN
-            QString fromCode=st.setting()-&gt;value (
-                                 sid+&quot;/iconvfrom&quot;,
-                                 ( QVariant )
-                                 &quot;UTF-8&quot; ).toString();
-#endif
-#ifdef Q_OS_LINUX
-            QString fromCode=st.setting()-&gt;value (
-                                 sid+&quot;/iconvfrom&quot;,
-                                 ( QVariant ) tr (
-                                     &quot;ISO8859-1&quot; ) ).toString();
-#endif
-            cmd=&quot;export X2GO_ICONV=modules=iconv,from_code=&quot;+
-                fromCode+
-                &quot;,to_code=&quot;+toCode+&quot;&amp;&amp;&quot;+cmd;
-        }
-    }
-
-    proc=new SshProcess ( sshConnection, this );
-    dir-&gt;proc=proc;
-
-    connect ( proc,SIGNAL ( sshFinished ( bool, QString,SshProcess* ) ),
-              this,SLOT ( slotRetExportDir ( bool,
-                                             QString,SshProcess* ) ) );
-
-    proc-&gt;startNormal ( cmd );
-}
-
-void ONMainWindow::slotCheckPrintSpool()
-{
-    QDir dir ( spoolDir );
-    QStringList list = dir.entryList ( QDir::Files );
-    for ( int i=0;i&lt;list.size();++i )
-    {
-        if ( !list[i].endsWith ( &quot;.ready&quot; ) )
-            continue;
-        QFile file ( spoolDir+&quot;/&quot;+list[i] );
-        if ( !file.open ( QIODevice::ReadOnly | QIODevice::Text ) )
-            continue;
-        bool startProc=false;
-        QString fname,title;
-        if ( !file.atEnd() )
-        {
-            QByteArray line = file.readLine();
-            QString fn ( line );
-            fn.replace ( &quot;\n&quot;,&quot;&quot; );
-            fname=fn;
-            if ( !file.atEnd() )
-            {
-                line = file.readLine();
-                title=line;
-                title.replace ( &quot;\n&quot;,&quot;&quot; );
-            }
-            startProc=true;
-        }
-        file.close();
-        file.remove();
-        if ( startProc )
-            new PrintProcess ( spoolDir+&quot;/&quot;+fname,title ,this );
-
-    }
-}
-
-
-void ONMainWindow::cleanPrintSpool()
-{
-    QDir dir ( spoolDir );
-    QStringList list = dir.entryList ( QDir::Files );
-    for ( int i=0;i&lt;list.size();++i )
-    {
-        QFile::remove ( spoolDir+&quot;/&quot;+list[i] );
-    }
-}
-
-
-void ONMainWindow::cleanAskPass()
-{
-    QString path=homeDir +&quot;/.x2go/ssh/&quot;;
-    QDir dir ( path );
-    QStringList list = dir.entryList ( QDir::Files );
-    for ( int i=0;i&lt;list.size();++i )
-    {
-        if ( list[i].startsWith ( &quot;askpass&quot; ) )
-            QFile::remove ( path+list[i] );
-    }
-
-}
-
-
-#ifdef Q_OS_WIN
-#include &lt;windows.h&gt;
-#include &lt;winsock2.h&gt;
-#include &lt;ws2tcpip.h&gt;
-#endif
-
-
-bool ONMainWindow::isServerRunning ( int port )
-{
-#ifdef Q_OS_WIN
-    SOCKET ConnectSocket = INVALID_SOCKET;
-    struct sockaddr_in saServer;
-    hostent* localHost;
-    char* localIP;
-    int iResult;
-    WSADATA wsaData;
-
-    struct in_addr addr = { 0 };
-
-    iResult = WSAStartup(MAKEWORD(2, 2), &amp;wsaData);
-    if (iResult != 0)
-    {
-        x2goDebug&lt;&lt;&quot;WARNING: WSAStartup failed: &quot;&lt;&lt; iResult&lt;&lt;endl;
-        return false;
-    }
-
-    addr.s_addr = inet_addr(&quot;127.0.0.1&quot;);
-    if (addr.s_addr == INADDR_NONE)
-    {
-        x2goDebug&lt;&lt; &quot;WARNING:  The IPv4 address entered must be a legal address\n&quot;;
-        return false;
-    }
-
-
-    localHost = gethostbyaddr((char*)&amp;addr,4, AF_INET);
-    if (!localHost)
-    {
-        x2goDebug&lt;&lt;&quot;WARNING: gethostbyaddr failed: &quot;&lt;&lt;WSAGetLastError()&lt;&lt;endl;
-        return false;
-    }
-    x2goDebug&lt;&lt;&quot;got localhost&quot;&lt;&lt;endl;
-
-    localIP = inet_ntoa (*(struct in_addr *)*localHost-&gt;h_addr_list);
-
-    saServer.sin_family = AF_INET;
-    saServer.sin_addr.s_addr = inet_addr(localIP);
-    saServer.sin_port = htons(port);
-
-    ConnectSocket = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);
-    if (ConnectSocket == INVALID_SOCKET)
-    {
-        x2goDebug&lt;&lt;&quot;WARNING: socket failed with error: &quot;&lt;&lt; WSAGetLastError()&lt;&lt;endl;
-        return false;
-    }
-
-    iResult = ::connect( ConnectSocket, (SOCKADDR*) &amp;saServer, sizeof(saServer));
-    if (iResult == SOCKET_ERROR)
-    {
-        closesocket(ConnectSocket);
-        x2goDebug&lt;&lt;&quot;Port is free: &quot;&lt;&lt;port&lt;&lt;endl;
-        return false;
-    }
-    closesocket(ConnectSocket);
-    x2goDebug&lt;&lt;&quot;Port already used: &quot;&lt;&lt;port&lt;&lt;endl;
-    return true;
-#endif
-    QTcpSocket tcpSocket ( 0 );
-    tcpSocket.connectToHost ( &quot;127.0.0.1&quot;,port );
-
-    if ( tcpSocket.waitForConnected ( 1000 ) )
-    {
-        tcpSocket.close();
-        return true;
-    }
-    return false;
-}
-#ifdef Q_OS_WIN
-void ONMainWindow::slotCheckXOrgLog()
-{
-    xorgLogMutex.lock();
-    if ( xorgLogFile.length() &lt;=0 )
-    {
-        xorgLogMutex.unlock();
-        return;
-    }
-    QFile file ( xorgLogFile );
-    if ( !file.open ( QIODevice::ReadOnly | QIODevice::Text ) )
-    {
-        xorgLogMutex.unlock();
-        return;
-    }
-
-    QTextStream in ( &amp;file );
-    while ( !in.atEnd() )
-    {
-        QString line = in.readLine();
-        if ( line.indexOf ( &quot;successfully opened the display&quot; ) !=-1 )
-        {
-            xorgLogTimer-&gt;stop();
-            slotSetWinServersReady();
-            xorgLogMutex.unlock();
-            return;
-        }
-    }
-    xorgLogMutex.unlock();
-}
-
-void ONMainWindow::startXOrg ()
-{
-    while ( isServerRunning ( 6000+xDisplay ) )
-        ++xDisplay;
-    QString dispString;
-    QTextStream ( &amp;dispString ) &lt;&lt;&quot;:&quot;&lt;&lt;xDisplay;
-
-    QStringList args;
-    QString exec;
-    if (internalX==XMING)
-        exec=appDir+&quot;\\xming\\Xming.exe&quot;;
-    if (internalX==VCXSRV)
-        exec=appDir+&quot;\\vcxsrv\\vcxsrv.exe&quot;;
-    winServersReady=false;
-    x2goDebug&lt;&lt;&quot;using internal X: &quot;&lt;&lt;useInternalX;
-//#ifdef CFGCLIENT
-    if (!useInternalX || internalX!=XMING)
-    {
-        if (!useInternalX)
-            exec=xorgExe;
-        QString cmdLine;
-        if (startXorgOnStart)
-            cmdLine=xorgOptions;
-        else
-        {
-            switch (xorgMode)
-            {
-            case FS:
-                cmdLine=xorgFSOptions;
-                break;
-            case SAPP:
-                cmdLine=xorgSAppOptions;
-                break;
-            case WIN:
-                cmdLine=xorgWinOptions;
-                x2goDebug&lt;&lt;&quot;WxH:&quot;&lt;&lt;xorgWidth&lt;&lt;&quot;x&quot;&lt;&lt;xorgHeight&lt;&lt;endl;
-                cmdLine.replace(&quot;%w&quot;,xorgWidth);
-                cmdLine.replace(&quot;%h&quot;,xorgHeight);
-                x2goDebug&lt;&lt;cmdLine&lt;&lt;endl;
-                break;
-            }
-        }
-        QStringList options=cmdLine.split(&quot; &quot;,QString::SkipEmptyParts);
-        QString option;
-        foreach(option,options)
-        {
-            args&lt;&lt; option;
-        }
-        args&lt;&lt;dispString;
-    }
-//#endif
-    xorg=new QProcess ( 0 );
-    if (useInternalX &amp;&amp; (internalX==XMING))
-    {
-
-        QString workingDir=appDir+&quot;\\xming&quot;;
-        QStringList env=QProcess::systemEnvironment();
-        env&lt;&lt;&quot;GLWIN_ENABLE_DEBUG=0&quot;;
-        xorgLogMutex.lock();
-        xorgLogFile=homeDir+&quot;/.x2go/xorg&quot;;
-        QDir dr ( homeDir );
-        dr.mkpath ( xorgLogFile );
-        xorgLogFile=wapiShortFileName ( xorgLogFile ) +&quot;\\xorg.log.&quot;+
-                    QString::number ( xDisplay );
-        if ( QFile::exists ( xorgLogFile ) )
-            QFile::remove ( xorgLogFile );
-        xorgLogMutex.unlock();
-//run xming with clipboard support
-        args&lt;&lt;dispString&lt;&lt;&quot;-multiwindow&quot;&lt;&lt;&quot;-notrayicon&quot;&lt;&lt;&quot;-clipboard&quot;&lt;&lt;
-        &quot;-logfile&quot;&lt;&lt;xorgLogFile;
-        xorg-&gt;setEnvironment ( env );
-        xorg-&gt; setWorkingDirectory ( workingDir);
-    }
-
-    x2goDebug&lt;&lt;&quot;running&quot;&lt;&lt;exec&lt;&lt;&quot; &quot;&lt;&lt;args.join(&quot; &quot;);
-    xorg-&gt;start ( exec, args );
-
-
-    if ( !xorg-&gt;waitForStarted ( 3000 ) )
-    {
-        QMessageBox::critical (
-            0,QString::null,
-            tr ( &quot;Can't start X Server\n&quot;
-                 &quot;Please check your installation&quot; ) );
-        close();
-    }
-// #ifdef CFGCLIENT
-    if ( !useInternalX || internalX!= XMING)
-    {
-        //check connection in slot and launch setWinServerReady
-        waitingForX=0;
-        QTimer::singleShot(1000, this, SLOT(slotCheckXOrgConnection()));
-    }
-// #endif
-}
-
-void ONMainWindow::slotCheckXOrgConnection()
-{
-    ++waitingForX;
-    if (isServerRunning(6000+xDisplay))
-    {
-        x2goDebug&lt;&lt;&quot;X is started&quot;;
-        slotSetWinServersReady();
-    }
-    else
-    {
-        if (waitingForX &gt; 10)
-        {
-            QMessageBox::critical (
-                0,QString::null,
-                tr ( &quot;Can't start X Server\n&quot;
-                     &quot;Please check your installation&quot; ) );
-            close();
-        }
-        else
-        {
-            x2goDebug&lt;&lt;&quot;waiting for X&quot;;
-            QTimer::singleShot(1000, this, SLOT(slotCheckXOrgConnection()));
-        }
-    }
-}
-
-WinServerStarter::WinServerStarter ( daemon server, ONMainWindow * par ) :
-        QThread ( 0 )
-{
-    mode=server;
-    parent=par;
-}
-
-void WinServerStarter::run()
-{
-    switch ( mode )
-    {
-    case SSH:
-        parent-&gt;startSshd();
-        break;
-    case X:
-        parent-&gt;startXOrg();
-        break;
-    case PULSE:
-        parent-&gt;startPulsed();
-        break;
-    }
-}
-
-
-
-void ONMainWindow::startWinServers()
-{
-    x2goDebug&lt;&lt;&quot;Starting win servers&quot;&lt;&lt;endl;
-
-    QString etcDir=homeDir+&quot;/.x2go/etc&quot;;
-    QDir dr ( homeDir );
-
-    pulseServer=0l;
-
-    WinServerStarter* xStarter = new WinServerStarter ( WinServerStarter::X,
-            this );
-    WinServerStarter* sshStarter = new WinServerStarter (
-        WinServerStarter::SSH, this );
-
-    WinServerStarter* pulseStarter = new WinServerStarter (
-        WinServerStarter::PULSE, this );
-
-    if ( !embedMode || !config.confFS || ( config.confFS &amp;&amp; config.useFs ) )
-    {
-
-        dr.mkpath ( etcDir );
-        generateHostDsaKey();
-        generateEtcFiles();
-        sshStarter-&gt;start();
-    }
-    if ( !embedMode || !config.confSnd ||
-            ( config.confSnd &amp;&amp; config.useSnd ) )
-    {
-        pulseStarter-&gt;start();
-    }
-// #ifdef CFGCLIENT
-//     x2goDebug&lt;&lt;&quot;xorg settings: &quot;&lt;&lt;startXorgOnStart &lt;&lt;&quot; &quot;&lt;&lt; useXming&lt;&lt;endl;
-    if ( useInternalX &amp;&amp; (internalX== XMING))
-    {
-// #endif
-        xStarter-&gt;start();
-        xorgLogTimer=new QTimer ( this );
-        connect ( xorgLogTimer,SIGNAL ( timeout() ),this,
-                  SLOT ( slotCheckXOrgLog() ) );
-        xorgLogTimer-&gt;start ( 500 );
-// #ifdef CFGCLIENT
-    }
-    else
-    {
-        if (startXorgOnStart)
-        {
-            startXOrg();
-        }
-    }
-// #endif
-}
-
-
-bool ONMainWindow::haveCySolEntry()
-{
-    QSettings CySolSt ( &quot;HKEY_CURRENT_USER\\Software&quot;
-                        &quot;\\Cygnus Solutions&quot;,
-                        QSettings::NativeFormat );
-    return ( CySolSt.childGroups().count() &gt; 0 ||
-             CySolSt.childKeys().count() &gt; 0 );
-}
-
-bool ONMainWindow::haveCygwinEntry()
-{
-    QSettings CygwSt ( &quot;HKEY_CURRENT_USER\\Software&quot;
-                       &quot;\\Cygnus Solutions\\Cygwin&quot;,
-                       QSettings::NativeFormat );
-    return ( CygwSt.childGroups().count() &gt;0||CygwSt.childKeys().count() );
-}
-
-
-
-void ONMainWindow::saveCygnusSettings()
-{
-    if ( ONMainWindow::portable )
-    {
-        if ( haveCySolEntry() )
-        {
-            x2goDebug&lt;&lt;&quot;Cygnus Solutions entry exist&quot;;
-            cySolEntry=true;
-        }
-        else
-        {
-            cySolEntry=false;
-            x2goDebug&lt;&lt;&quot;Cygnus Solutions entry not exist&quot;;
-        }
-
-        if ( haveCygwinEntry() )
-        {
-            x2goDebug&lt;&lt;&quot;Cygwin entry exist&quot;;
-            cyEntry=true;
-        }
-        else
-        {
-            x2goDebug&lt;&lt;&quot;Cygwin entry not exist&quot;;
-            cyEntry=false;
-        }
-    }
-
-    QSettings etcst ( &quot;HKEY_CURRENT_USER\\Software&quot;
-                      &quot;\\Cygnus Solutions\\Cygwin\\mounts v2\\/etc&quot;,
-                      QSettings::NativeFormat );
-    oldEtcDir=QString::null;
-    oldEtcDir=etcst.value ( &quot;native&quot;,oldEtcDir ).toString();
-    x2goDebug&lt;&lt;&quot;old etc:&quot;&lt;&lt;oldEtcDir&lt;&lt;endl;
-    QString newEtc=homeDir+&quot;/.x2go/etc&quot;;
-    QDir d ( newEtc );
-    if ( !d.exists() )
-        d.mkpath ( newEtc );
-    newEtc.replace ( &quot;/&quot;,&quot;\\&quot; );
-
-    etcst.setValue ( &quot;native&quot;,wapiShortFileName ( newEtc ) );
-    etcst.sync();
-    x2goDebug&lt;&lt;&quot;new etc:&quot;&lt;&lt;wapiShortFileName ( newEtc ) &lt;&lt;endl;
-
-    QSettings binst ( &quot;HKEY_CURRENT_USER\\Software&quot;
-                      &quot;\\Cygnus Solutions\\Cygwin\\mounts v2\\/bin&quot;,
-                      QSettings::NativeFormat );
-    oldBinDir=QString::null;
-    oldBinDir=binst.value ( &quot;native&quot;,oldBinDir ).toString();
-    x2goDebug&lt;&lt;&quot;old bin:&quot;&lt;&lt;oldBinDir&lt;&lt;endl;
-    QString newBin=appDir;
-    newBin.replace ( &quot;/&quot;,&quot;\\&quot; );
-    binst.setValue ( &quot;native&quot;,wapiShortFileName ( newBin ) );
-    binst.sync();
-    x2goDebug&lt;&lt;&quot;new bin:&quot;&lt;&lt;newBin&lt;&lt;endl;
-
-    QSettings tmpst ( &quot;HKEY_CURRENT_USER\\Software&quot;
-                      &quot;\\Cygnus Solutions\\Cygwin\\mounts v2\\/tmp&quot;,
-                      QSettings::NativeFormat );
-    oldTmpDir=QString::null;
-    oldTmpDir=tmpst.value ( &quot;native&quot;,oldTmpDir ).toString();
-    x2goDebug&lt;&lt;&quot;old tmp:&quot;&lt;&lt;oldTmpDir&lt;&lt;endl;
-    QString newTmp=QDir::tempPath();
-    newTmp.replace ( &quot;/&quot;,&quot;\\&quot; );
-    tmpst.setValue ( &quot;native&quot;,wapiShortFileName ( newTmp ) );
-    tmpst.sync();
-    x2goDebug&lt;&lt;&quot;new tmp:&quot;&lt;&lt;newTmp&lt;&lt;endl;
-}
-
-void ONMainWindow::restoreCygnusSettings()
-{
-
-    if ( oldEtcDir==QString::null )
-    {
-        QSettings st ( &quot;HKEY_CURRENT_USER\\Software&quot;
-                       &quot;\\Cygnus Solutions\\Cygwin\\mounts v2\\/etc&quot;,
-                       QSettings::NativeFormat );
-        x2goDebug&lt;&lt;&quot;Removing /etc from cygwin mounts\n&quot;;
-        st.remove ( &quot;&quot; );
-        st.sync();
-    }
-    else
-    {
-        QSettings st ( &quot;HKEY_CURRENT_USER\\Software&quot;
-                       &quot;\\Cygnus Solutions\\Cygwin\\mounts v2\\/etc&quot;,
-                       QSettings::NativeFormat );
-        st.setValue ( &quot;native&quot;,oldEtcDir );
-        st.sync();
-        x2goDebug&lt;&lt;&quot;Restoring /etc in cygwin mounts\n&quot;;
-    }
-    if ( oldBinDir==QString::null )
-    {
-        QSettings st ( &quot;HKEY_CURRENT_USER\\Software&quot;
-                       &quot;\\Cygnus Solutions\\Cygwin\\mounts v2\\/bin&quot;,
-                       QSettings::NativeFormat );
-        x2goDebug&lt;&lt;&quot;Removing /bin from cygwin mounts\n&quot;;
-        st.remove ( &quot;&quot; );
-        st.sync();
-    }
-    else
-    {
-        QSettings st ( &quot;HKEY_CURRENT_USER\\Software&quot;
-                       &quot;\\Cygnus Solutions\\Cygwin\\mounts v2\\/bin&quot;,
-                       QSettings::NativeFormat );
-        st.setValue ( &quot;native&quot;,oldBinDir );
-        st.sync();
-        x2goDebug&lt;&lt;&quot;Restoring /bin in cygwin mounts\n&quot;;
-    }
-    if ( oldTmpDir==QString::null )
-    {
-        QSettings st ( &quot;HKEY_CURRENT_USER\\Software&quot;
-                       &quot;\\Cygnus Solutions\\Cygwin\\mounts v2\\/tmp&quot;,
-                       QSettings::NativeFormat );
-        x2goDebug&lt;&lt;&quot;Removing /tmp from cygwin mounts\n&quot;;
-        st.remove ( &quot;&quot; );
-        st.sync();
-    }
-    else
-    {
-        QSettings st ( &quot;HKEY_CURRENT_USER\\Software&quot;
-                       &quot;\\Cygnus Solutions\\Cygwin\\mounts v2\\/tmp&quot;,
-                       QSettings::NativeFormat );
-        st.setValue ( &quot;native&quot;,oldTmpDir );
-        st.sync();
-        x2goDebug&lt;&lt;&quot;Restoring /tmp in cygwin mounts\n&quot;;
-    }
-    if ( ONMainWindow::portable )
-    {
-        if ( !cyEntry )
-        {
-            removeCygwinEntry();
-        }
-        if ( !cySolEntry )
-        {
-            removeCySolEntry();
-        }
-    }
-}
-
-void ONMainWindow::removeCygwinEntry()
-{
-    QSettings st ( &quot;HKEY_CURRENT_USER\\Software&quot;
-                   &quot;\\Cygnus Solutions\\Cygwin&quot;,
-                   QSettings::NativeFormat );
-    x2goDebug&lt;&lt;&quot;Removing cygwin\n&quot;;
-    st.remove ( &quot;&quot; );
-    st.sync();
-
-}
-
-void ONMainWindow::removeCySolEntry()
-{
-    QSettings st ( &quot;HKEY_CURRENT_USER\\Software&quot;
-                   &quot;\\Cygnus Solutions&quot;,
-                   QSettings::NativeFormat );
-    x2goDebug&lt;&lt;&quot;Removing cygnus solutions\n&quot;;
-    st.remove ( &quot;&quot; );
-    st.sync();
-}
-
-void ONMainWindow::startPulsed()
-{
-    while ( isServerRunning ( pulsePort ) )
-        ++pulsePort;
-    esdPort=pulsePort+1;
-    while ( isServerRunning ( esdPort ) )
-        ++esdPort;
-
-    pulseDir=homeDir+&quot;/.x2go/pulse&quot;;
-    QDir dr ( homeDir );
-    dr.mkpath ( pulseDir );
-    pulseDir=wapiShortFileName ( pulseDir );
-    x2goDebug&lt;&lt;&quot;template: &quot;&lt;&lt;pulseDir+&quot;/tmp&quot;&lt;&lt;endl;
-    QTemporaryFile* fl=new QTemporaryFile ( pulseDir+&quot;/tmp&quot; );
-    fl-&gt;open();
-    pulseDir=fl-&gt;fileName();
-    fl-&gt;close();
-    delete fl;
-    QFile::remove ( pulseDir );
-    dr.mkpath ( pulseDir );
-    x2goDebug&lt;&lt;&quot;pulse tmp file: &quot;&lt;&lt;pulseDir&lt;&lt;endl;
-    QStringList pEnv=QProcess::systemEnvironment();
-    for ( int i=0; i&lt;pEnv.size();++i )
-    {
-        if ( pEnv[i].indexOf ( &quot;USERPROFILE=&quot; ) !=-1 )
-            pEnv[i]=&quot;USERPROFILE=&quot;+
-                    wapiShortFileName ( homeDir+&quot;/.x2go/pulse&quot; );
-        if ( pEnv[i].indexOf ( &quot;TEMP=&quot; ) !=-1 )
-            pEnv[i]=&quot;TEMP=&quot;+pulseDir;
-        if ( pEnv[i].indexOf ( &quot;USERNAME=&quot; ) !=-1 )
-            pEnv[i]=&quot;USERNAME=pulseuser&quot;;
-    }
-
-    QFile file ( pulseDir+&quot;/config.pa&quot; );
-    if ( !file.open ( QIODevice::WriteOnly | QIODevice::Text ) )
-        return;
-    QTextStream out ( &amp;file );
-    out &lt;&lt; &quot;load-module module-native-protocol-tcp port=&quot;+
-    QString::number ( pulsePort ) &lt;&lt;endl;
-    out &lt;&lt; &quot;load-module module-esound-protocol-tcp port=&quot;+
-    QString::number ( esdPort ) &lt;&lt;endl;
-    out &lt;&lt; &quot;load-module module-waveout&quot;&lt;&lt;endl;
-    file.close();
-    pulseServer=new QProcess ( 0 );
-    pulseServer-&gt;setEnvironment ( pEnv );
-    QStringList args;
-    args&lt;&lt;&quot;-n&quot;&lt;&lt;&quot;-F&quot;&lt;&lt;pulseDir+&quot;/config.pa&quot;;
-    pulseServer-&gt;setWorkingDirectory ( wapiShortFileName (
-                                           appDir+&quot;\\pulse&quot; ) );
-    pulseServer-&gt;start ( &quot;pulse\\pulseaudio.exe&quot;,args );
-    x2goDebug&lt;&lt;&quot;starting pulse\\pulseaudio.exe &quot;&lt;&lt;args.join ( &quot; &quot; ) &lt;&lt;
-    &quot; working dir: &quot;&lt;&lt;
-    wapiShortFileName ( appDir+&quot;\\pulse&quot; ) &lt;&lt;endl;
-}
-
-
-// #ifdef CFGCLIENT
-void ONMainWindow::xorgSettings()
-{
-    x2goDebug&lt;&lt;&quot;getting xorg settings&quot;&lt;&lt;endl;
-
-    X2goSettings st ( &quot;settings&quot; );
-
-    useInternalX=(st.setting()-&gt;value(&quot;useintx&quot;,true).toBool());
-
-    xorgExe=(st.setting()-&gt;value(&quot;xexec&quot;,&quot;C:\\program files\\vcxsrv\\vcxsrv.exe&quot;).toString());
-    xorgOptions=(st.setting()-&gt;value(&quot;options&quot;,&quot;-multiwindow -notrayicon -clipboard&quot;).toString());
-    startXorgOnStart=(st.setting()-&gt;value(&quot;onstart&quot;,true).toBool());
-    xorgWinOptions=(st.setting()-&gt;value(&quot;optionswin&quot;,&quot;-screen 0 %wx%h -notrayicon -clipboard&quot;).toString());
-    xorgFSOptions=(st.setting()-&gt;value(&quot;optionsfs&quot;,&quot;-fullscreen -notrayicon -clipboard&quot;).toString());
-    xorgSAppOptions=(st.setting()-&gt;value(&quot;optionssingle&quot;,&quot;-multiwindow -notrayicon -clipboard&quot;).toString());
-
-    if (QFile::exists(appDir+&quot;\\vcxsrv&quot;))
-        internalX=VCXSRV;
-    if (QFile::exists(appDir+&quot;\\xming&quot;))
-        internalX=XMING;
-    if (useInternalX)
-    {
-        startXorgOnStart=(internalX==XMING);
-        xorgOptions=&quot;-multiwindow -notrayicon -clipboard&quot;;
-        if (internalX==VCXSRV)
-        {
-// 	xorgWinOptions=&quot;-screen 0 %wx%h -notrayicon -clipboard&quot;;
-            xorgWinOptions=&quot;-multiwindow -notrayicon -clipboard&quot;;
-            xorgFSOptions=&quot;-fullscreen -notrayicon -clipboard&quot;;
-            xorgSAppOptions=&quot;-multiwindow -notrayicon -clipboard&quot;;
-        }
-    }
-
-}
-// #endif
-
-void ONMainWindow::slotSetWinServersReady()
-{
-    x2goDebug&lt;&lt;&quot;all winservers are started\n&quot;;
-    winServersReady=true;
-    restoreCygnusSettings();
-}
-
-#include &lt;windows.h&gt;
-#include&lt;sstream&gt;
-#endif
-
-void ONMainWindow::generateEtcFiles()
-{
-    QString etcDir=homeDir+&quot;/.x2go/etc&quot;;
-    QDir dr ( homeDir );
-    dr.mkpath ( etcDir );
-#ifdef Q_OS_WIN
-    if ( !QFile::exists ( etcDir+&quot;/passwd&quot; ) )
-    {
-        QString sid, sys, user, grsid, grname;
-        if ( !wapiAccountInfo ( &amp;sid,&amp;user,&amp;grsid, &amp;grname, &amp;sys ) )
-        {
-// 			x2goDebug&lt;&lt;&quot;Get account info failed\n&quot;;
-            close();
-        }
-
-// 		x2goDebug&lt;&lt;&quot;sid: &quot;&lt;&lt;sid &lt;&lt;&quot; system:&quot;&lt;&lt;
-// 		sys&lt;&lt; &quot; user: &quot;&lt;&lt;user&lt;&lt;&quot; group sid:&quot;&lt;&lt;grsid&lt;&lt;
-// 		&quot;group name: &quot;&lt;&lt;grname&lt;&lt;endl;
-
-        QStringList sidList=sid.split ( '-' );
-        QString rid=sidList[sidList.count()-1];
-        QStringList grsidList=grsid.split ( '-' );
-        QString grid=grsidList[grsidList.count()-1];
-        QFile file ( etcDir +&quot;/passwd&quot; );
-        if ( !file.open ( QIODevice::WriteOnly | QIODevice::Text ) )
-            return;
-        QTextStream out ( &amp;file );
-        out &lt;&lt;&quot;sshuser::&quot;&lt;&lt;rid&lt;&lt;&quot;:&quot;&lt;&lt;grid&lt;&lt;&quot;:&quot;&lt;&lt;sys&lt;&lt;&quot;\\sshuser,&quot;
-        &lt;&lt;sid&lt;&lt;&quot;:&quot;&lt;&lt;cygwinPath ( wapiShortFileName ( homeDir ) ) &lt;&lt;
-        &quot;/.x2go&quot;&lt;&lt;&quot;:/bin/bash\n&quot;;
-        file.close();
-    }
-
-    if ( !QFile::exists ( etcDir+&quot;/sshd_config&quot; ) )
-    {
-#endif
-        QFile file ( etcDir +&quot;/sshd_config&quot; );
-        if ( !file.open ( QIODevice::WriteOnly | QIODevice::Text ) )
-            return;
-        QTextStream out ( &amp;file );
-        out&lt;&lt;&quot;StrictModes no\n&quot;&lt;&lt;
-        &quot;UsePrivilegeSeparation no\n&quot;&lt;&lt;
-#ifdef Q_OS_WIN
-        &quot;Subsystem sftp /bin/sftp-server\n&quot;;
-#else
-        &quot;Subsystem sftp &quot;
-        &lt;&lt;appDir&lt;&lt;&quot;/sftp-server\n&quot;;
-#endif
-        file.close();
-        x2goDebug&lt;&lt;etcDir +&quot;/sshd_config created&quot;;
-#ifdef Q_OS_WIN
-    }
-#endif
-}
-
-void ONMainWindow::generateHostDsaKey()
-{
-    QString etcDir=homeDir+&quot;/.x2go/etc&quot;;
-    QDir dr ( homeDir );
-    dr.mkpath ( etcDir );
-    if ( !QFile::exists ( etcDir+&quot;/ssh_host_dsa_key&quot; ) ||
-            !QFile::exists ( etcDir+&quot;/ssh_host_dsa_key.pub&quot; ) )
-    {
-        /*		x2goDebug&lt;&lt;&quot;Generating host DSA key\n&quot;;*/
-#ifdef Q_OS_WIN
-        QString fname=cygwinPath ( wapiShortFileName ( etcDir ) ) +
-                      &quot;/ssh_host_dsa_key&quot;;
-#else
-        QString fname=etcDir+&quot;/ssh_host_dsa_key&quot;;
-#endif
-        QStringList args;
-        args&lt;&lt;&quot;-t&quot;&lt;&lt;&quot;dsa&quot;&lt;&lt;&quot;-N&quot;&lt;&lt;&quot;&quot;&lt;&lt;&quot;-C&quot;&lt;&lt;
-        &quot;x2goclient DSA host key&quot;&lt;&lt;&quot;-f&quot;&lt;&lt;fname;
-        QProcess::execute ( &quot;ssh-keygen&quot;,args );
-    }
-}
-
-void ONMainWindow::startSshd()
-{
-    if ( embedMode &amp;&amp; config.confFS &amp;&amp; !config.useFs )
-    {
-        return;
-    }
-#ifdef Q_OS_LINUX
-    clientSshPort=&quot;7022&quot;;
-#endif
-    QString etcDir=homeDir+&quot;/.x2go/etc&quot;;
-    int port=clientSshPort.toInt();
-    //clientSshPort have initvalue
-    while ( isServerRunning ( port ) )
-        ++port;
-    clientSshPort=QString::number ( port );
-#ifdef Q_OS_WIN
-    std::string clientdir=wapiShortFileName ( appDir ).toStdString();
-    std::stringstream strm;
-    strm&lt;&lt;clientdir&lt;&lt;&quot;\\sshd.exe -D -p&quot;&lt;&lt;clientSshPort.toInt();
-
-    STARTUPINFOA si;
-    std::string desktopName=&quot;x2go_&quot;;
-    desktopName+=getenv ( &quot;USERNAME&quot; );
-    char* desktop=new char[desktopName.size() +1];
-    strcpy ( desktop,desktopName.c_str() );
-    x2goDebug&lt;&lt;&quot;Creating desktop: &quot;&lt;&lt;desktop&lt;&lt;endl;
-    if ( !CreateDesktopA (
-                desktop,
-                0,
-                0,
-                0,
-                GENERIC_ALL,
-                0
-            ) )
-    {
-        strcpy ( desktop,&quot;&quot; );
-        x2goDebug&lt;&lt;&quot;Desktop creation failed, using default\n&quot;;
-    }
-    ZeroMemory ( &amp;si, sizeof ( si ) );
-    ZeroMemory ( &amp;sshd, sizeof ( sshd ) );
-    si.lpDesktop=desktop;
-    si.cb = sizeof ( si );
-    CreateProcessA ( NULL,  // No module name (use command line)
-                     ( LPSTR ) strm.str().c_str(),  // Command line
-                     NULL,           // Process handle not inheritable
-                     NULL,           // Thread handle not inheritable
-                     TRUE,          // Set handle inheritance to FALSE
-                     0/*CREATE_NO_WINDOW|CREATE_NEW_PROCESS_GROUP*/,
-                     //creation flags
-                     NULL,           // Use parent's environment block
-                     clientdir.c_str(), // Starting directory
-                     &amp;si,            // Pointer to STARTUPINFO structure
-                     &amp;sshd );// Pointer to PROCESS_INFORMATION structure
-    delete []desktop;
-    winSshdStarted=true;
-#else
-    userSshd=true;
-    sshd=new QProcess ( this );
-    QStringList arguments;
-    arguments&lt;&lt;&quot;-f&quot;&lt;&lt;etcDir +&quot;/sshd_config&quot;&lt;&lt; &quot;-h&quot; &lt;&lt;
-    etcDir+&quot;/ssh_host_dsa_key&quot;&lt;&lt;&quot;-D&quot;&lt;&lt;&quot;-p&quot;&lt;&lt;clientSshPort;
-    sshd-&gt;start ( appDir+&quot;/sshd&quot;,arguments );
-    x2goDebug&lt;&lt;&quot;Usermode sshd started&quot;;
-#endif
-}
-
-void ONMainWindow::setProxyWinTitle()
-{
-
-    QString title;
-
-    if (!useLdap)
-        title=lastSession-&gt;name();
-    else
-        title=getCurrentUname()+&quot;@&quot;+resumingSession.server;
-
-    QPixmap pixmap;
-
-    if (useLdap)
-        pixmap=lastUser-&gt;foto();
-    else
-        pixmap=*(lastSession-&gt;sessIcon());
-
-#ifdef Q_OS_LINUX
-
-    XStoreName(QX11Info::display(), proxyWinId, title.toLocal8Bit().data());
-
-    XWMHints* win_hints;
-
-
-    QByteArray bytes;
-    QBuffer buffer(&amp;bytes);
-    buffer.open(QIODevice::WriteOnly);
-    pixmap.save(&amp;buffer, &quot;XPM&quot;);
-
-
-    int rez;
-
-    if (image)
-        XFreePixmap(QX11Info::display(),image);
-    if (shape)
-        XFreePixmap(QX11Info::display(),shape);
-
-
-    rez=XpmCreatePixmapFromBuffer(QX11Info::display(), proxyWinId, bytes.data(),
-                                  (Pixmap *) &amp;image, (Pixmap *) &amp;shape, NULL);
-    if (!rez)
-    {
-
-        win_hints = XAllocWMHints();
-        if (win_hints)
-        {
-            win_hints-&gt;flags = IconPixmapHint|IconMaskHint;
-            win_hints-&gt;icon_pixmap = image;
-            win_hints-&gt;icon_mask = shape;
-            XSetWMHints(QX11Info::display(), proxyWinId, win_hints);
-            XFree(win_hints);
-        }
-    }
-
-#endif
-#ifdef Q_OS_WIN
-    wapiSetWindowText((HWND)proxyWinId, title);
-//       wapiSetWindowIcon((HWND)proxyWinId, pixmap);
-#endif
-}
-
-void ONMainWindow::slotSetProxyWinFullscreen()
-{
-
-#ifdef Q_OS_LINUX
-    XSync(QX11Info::display(),false);
-    XEvent event;
-    long emask = StructureNotifyMask | ResizeRedirectMask;
-    event.xclient.type = ClientMessage;
-    event.xclient.serial = 0;
-    event.xclient.send_event = True;
-    event.xclient.display = QX11Info::display();
-    event.xclient.window = proxyWinId;
-    event.xclient.message_type = XInternAtom(QX11Info::display(),&quot;_NET_WM_STATE&quot;,False);
-    event.xclient.format = 32;
-    event.xclient.data.l[0] = 1;
-    event.xclient.data.l[1] = XInternAtom(QX11Info::display(),&quot;_NET_WM_STATE_FULLSCREEN&quot;,False);
-    event.xclient.data.l[2] = 0;
-    event.xclient.data.l[3] = 0;
-    event.xclient.data.l[4] = 0;
-    Status st;
-    st=XSendEvent(QX11Info::display(), DefaultRootWindow(QX11Info::display()),
-                  False, emask,&amp;event);
-    XSync(QX11Info::display(),false);
-#endif
-#ifdef Q_OS_WIN
-    wapiSetFSWindow ( ( HWND ) proxyWinId,
-                      dispGeometry );
-
-#endif
-}
-
-
-void ONMainWindow::resizeProxyWinOnDisplay(int disp)
-{
-    QRect geom=QApplication::desktop()-&gt;screenGeometry(disp-1);
-    x2goDebug&lt;&lt;&quot;resizing proxy win to fit display &quot;&lt;&lt;disp&lt;&lt;&quot;(&quot;&lt;&lt;geom&lt;&lt;&quot;)&quot;&lt;&lt;endl;
-#ifdef Q_OS_LINUX
-    XSync(QX11Info::display(),false);
-    XMoveWindow(QX11Info::display(), proxyWinId,geom.x(),geom.y());
-#endif
-#ifdef Q_OS_WIN
-    dispGeometry=geom;
-#endif
-    QTimer::singleShot(500, this, SLOT(slotSetProxyWinFullscreen()));
-}
-
-
-QRect ONMainWindow::proxyWinGeometry()
-{
-#ifdef Q_OS_WIN
-    QRect proxyRect;
-    if (!wapiWindowRectWithoutDecoration((HWND)proxyWinId,proxyRect))
-        return QRect();
-    return proxyRect;
-#endif
-#ifdef Q_OS_LINUX
-    QRect proxyRect;
-    Window root;
-    int x,y;
-    uint w,h,border,depth;
-    if (XGetGeometry(QX11Info::display(), proxyWinId, &amp;root,&amp;x,&amp;y,&amp;w,&amp;h,&amp;border,&amp;depth))
-    {
-
-        int realx,realy;
-        Window child;
-        XTranslateCoordinates(QX11Info::display(), proxyWinId, root, 0, 0, &amp;realx, &amp;realy, &amp;child);
-        proxyRect.setRect(realx, realy, w,h);
-    }
-    return proxyRect;
-#endif
-    return QRect();
-}
-
-void ONMainWindow::slotConfigXinerama()
-{
-    QRect newGeometry=proxyWinGeometry();
-    if (newGeometry.isNull())
-    {
-//     x2goDebug&lt;&lt;&quot;error getting window geometry (window closed?)\n&quot;;
-        xineramaTimer-&gt;stop();
-        return;
-    }
-    if (newGeometry==lastDisplayGeometry)
-        return;
-    lastDisplayGeometry=newGeometry;
-    x2goDebug&lt;&lt;&quot;New proxy geometry: &quot;&lt;&lt;lastDisplayGeometry&lt;&lt;endl;
-    QDesktopWidget* root=QApplication::desktop();
-    QList&lt;QRect&gt; newXineramaScreens;
-    for (int i=0; i&lt; root-&gt;numScreens();++i)
-    {
-        QRect intersection;
-        if (resumingSession.fullscreen)
-            intersection=root-&gt;screenGeometry(i);
-        else
-            intersection=root-&gt;screenGeometry(i).intersected(lastDisplayGeometry);
-        if (!intersection.isNull())
-        {
-            x2goDebug&lt;&lt;&quot;intersected with &quot;&lt;&lt;i&lt;&lt;&quot;: &quot;&lt;&lt;intersection&lt;&lt;endl;
-            intersection.moveLeft(intersection.x()-lastDisplayGeometry.x());
-            intersection.moveTop(intersection.y()-lastDisplayGeometry.y());
-            x2goDebug&lt;&lt;&quot;xinerama screen: &quot;&lt;&lt;intersection&lt;&lt;endl;
-            newXineramaScreens&lt;&lt;intersection;
-        }
-    }
-    if (xineramaScreens != newXineramaScreens)
-    {
-        xineramaScreens=newXineramaScreens;
-        x2goDebug&lt;&lt;&quot;xinerama screen changed, new screens: &quot;&lt;&lt;xineramaScreens&lt;&lt;endl;
-        SshProcess* proc=new SshProcess(sshConnection, this);
-        xineramaTimer-&gt;stop();
-        connect (proc, SIGNAL(sshFinished(bool,QString,SshProcess*)), this, SLOT(slotXineramaConfigured()));
-        QStringList screens;
-        foreach (QRect disp, xineramaScreens)
-        screens&lt;&lt;QString::number(disp.x())+&quot; &quot;+QString::number(disp.y())+&quot; &quot;+QString::number(disp.width())+
-        &quot; &quot;+QString::number(disp.height());
-        QString cmd=&quot;export DISPLAY=:&quot;+resumingSession.display+&quot;;echo -e &quot;+screens.join(&quot;\\\\n&quot;)+&quot; &gt;  ~/.x2go/C-&quot;+
-                    resumingSession.sessionId+&quot;/xinerama.conf&quot;;
-
-        x2goDebug&lt;&lt;cmd&lt;&lt;endl;
-        proc-&gt;startNormal(cmd);
-    }
-}
-
-void ONMainWindow::slotXineramaConfigured()
-{
-    if (resumingSession.fullscreen)
-        return;
-    if (xinSizeInc == -1)
-        xinSizeInc=1;
-    else
-        xinSizeInc=-1;
-#ifdef Q_OS_LINUX
-    lastDisplayGeometry.setWidth(lastDisplayGeometry.width()+xinSizeInc);
-    XSync(QX11Info::display(),false);
-    XResizeWindow(QX11Info::display(), proxyWinId,
-                  lastDisplayGeometry.width(),lastDisplayGeometry.height());
-    XSync(QX11Info::display(),false);
-#endif
-#ifdef Q_OS_WIN
-    QRect geom;
-    wapiWindowRect ( (HWND) proxyWinId, geom );
-    wapiMoveWindow( (HWND) proxyWinId, geom.x(), geom.y(), geom.width()+xinSizeInc, geom.height(),true);
-    lastDisplayGeometry=proxyWinGeometry();
-#endif
-    xineramaTimer-&gt;start(500);
-}
-
-void ONMainWindow::slotFindProxyWin()
-{
-#ifndef Q_OS_DARWIN
-    x2goDebug&lt;&lt;&quot;search proxy win: &quot;&lt;&lt;&quot;X2GO-&quot;+resumingSession.sessionId;
-    proxyWinId=findWindow ( &quot;X2GO-&quot;+resumingSession.sessionId );
-    bool xinerama=defaultXinerama;
-    if ( proxyWinId )
-    {
-        x2goDebug&lt;&lt;&quot;proxy win found:&quot;&lt;&lt;proxyWinId;
-        setProxyWinTitle();
-        proxyWinTimer-&gt;stop();
-        if (!useLdap)
-        {
-            X2goSettings *st;
-            QString sid;
-            if ( !embedMode )
-                sid=lastSession-&gt;id();
-            else
-                sid=&quot;embedded&quot;;
-
-            if (brokerMode)
-                st=new X2goSettings(config.iniFile,QSettings::IniFormat);
-            else
-                st= new X2goSettings( &quot;sessions&quot; );
-            uint displays=QApplication::desktop()-&gt;numScreens();
-            xinerama=st-&gt;setting()-&gt;value ( sid+&quot;/xinerama&quot;,
-                                            ( QVariant ) defaultXinerama ).toBool();
-            if (st-&gt;setting()-&gt;value ( sid+&quot;/multidisp&quot;,
-                                       ( QVariant ) false ).toBool())
-            {
-                uint disp=st-&gt;setting()-&gt;value ( sid+&quot;/display&quot;,
-                                                 ( QVariant ) 1 ).toUInt();
-                if (disp&gt;displays)
-                {
-                    disp=1;
-                }
-                resizeProxyWinOnDisplay(disp);
-                return;
-            }
-        }
-        if (xinerama)
-        {
-            x2goDebug&lt;&lt;&quot;Starting xinerama timer\n&quot;;
-            lastDisplayGeometry=QRect();
-            xineramaScreens.clear();
-            xineramaTimer-&gt;start(500);
-        }
-
-        if ( embedMode )
-        {
-            if ( config.rootless )
-            {
-                x2goDebug&lt;&lt;&quot;win is rootless&quot;;
-                act_embedContol-&gt;setEnabled ( false );
-            }
-            else
-                slotAttachProxyWindow();
-        }
-#ifdef Q_OS_WIN
-        x2goDebug&lt;&lt;&quot;maximizeProxyWin: &quot;&lt;&lt;maximizeProxyWin;
-        if ( !startEmbedded )
-        {
-            if ( maximizeProxyWin )
-            {
-                QDesktopWidget dw;
-                x2goDebug&lt;&lt;&quot;making proxy win full screen&quot;;
-                wapiSetFSWindow ( ( HWND ) proxyWinId,
-                                  dw.screenGeometry ( this ) );
-                /*wapiShowWindow ( ( HWND ) proxyWinId,
-                   WAPI_SHOWMAXIMIZED );*/
-            }
-            else
-            {
-                wapiMoveWindow ( ( HWND ) proxyWinId,0,0,
-                                 proxyWinWidth,
-                                 proxyWinHeight,true );
-            }
-        }
-#endif
-    }
-#endif
-}
-
-
-QString ONMainWindow::getCurrentUname()
-{
-    return login-&gt;text();
-}
-
-QString ONMainWindow::getCurrentPass()
-{
-    return pass-&gt;text();
-}
-
-void ONMainWindow::slotDetachProxyWindow()
-{
-    proxyWinEmbedded=false;
-    bgFrame-&gt;show();
-    setStatStatus();
-    act_embedContol-&gt;setText ( tr ( &quot;Attach X2Go window&quot; ) );
-    act_embedContol-&gt;setIcon ( QIcon ( &quot;:icons/32x32/attach.png&quot; ) );
-#ifdef Q_OS_LINUX
-    //if QX11EmbedContainer cannot embed window, check if window exists
-    //and reconnect
-    if ( !embedControlChanged )
-    {
-        x2goDebug&lt;&lt;&quot;\n&quot;;
-        slotFindProxyWin();
-        x2goDebug&lt;&lt;&quot;proxy win detached, proxywin is:&quot;&lt;&lt;proxyWinId&lt;&lt;endl;
-    }
-#endif
-    embedControlChanged=false;
-}
-
-
-void ONMainWindow::slotAttachProxyWindow()
-{
-    x2goDebug&lt;&lt;&quot;slotAttachProxy&quot;;
-    if ( startEmbedded )
-    {
-        embedControlChanged=false;
-        bgFrame-&gt;hide();
-        proxyWinEmbedded=true;
-        setStatStatus();
-        act_embedContol-&gt;setText ( tr ( &quot;Detach X2Go window&quot; ) );
-        act_embedContol-&gt;setIcon (
-            QIcon ( &quot;:icons/32x32/detach.png&quot; ) );
-        QTimer::singleShot ( 100, this, SLOT ( slotEmbedWindow() ) );
-    }
-    else
-    {
-        x2goDebug&lt;&lt;&quot;start embedded was false&quot;;
-        startEmbedded=true;
-    }
-
-}
-
-void ONMainWindow::slotEmbedWindow()
-{
-#ifndef Q_OS_DARWIN
-#ifdef CFGPLUGIN
-    embedWindow ( proxyWinId );
-#endif
-    QTimer::singleShot ( 1000, this,
-                         SLOT ( slotActivateWindow() ) );
-
-#endif
-}
-
-void ONMainWindow::setEmbedSessionActionsEnabled ( bool enable )
-{
-    act_shareFolder-&gt;setEnabled ( enable );
-    act_suspend-&gt;setEnabled ( enable );
-    act_terminate-&gt;setEnabled ( enable );
-    act_embedContol-&gt;setEnabled ( enable );
-    act_reconnect-&gt;setEnabled ( !enable );
-}
-
-void ONMainWindow::slotEmbedControlAction()
-{
-#ifndef Q_OS_DARWIN
-    embedControlChanged=true;
-    if ( proxyWinEmbedded )
-    {
-#ifdef CFGPLUGIN
-        detachClient();
-#endif
-    }
-    else
-        slotAttachProxyWindow();
-#endif
-}
-
-void ONMainWindow::slotEmbedIntoParentWindow()
-{
-#ifndef Q_OS_DARWIN
-// 	embedInto ( embedParent );
-#endif
-}
-
-
-void ONMainWindow::processSessionConfig()
-{
-    sshProxy.use=false;
-    bool haveKey=false;
-
-    config.command=&quot;KDE&quot;;
-    config.sshport=&quot;22&quot;;
-    config.session=tr ( &quot;X2Go Session&quot; );
-    config.checkexitstatus=true;
-    config.showtermbutton=true;
-    config.showexpbutton=true;
-    config.showconfig=true;
-    config.showextconfig=true;
-    config.showtoolbar=true;
-    config.showstatusbar=true;
-    config.kbdType=getDefaultKbdType();
-    config.kbdLay=getDefaultLayout()[0];
-
-
-    config.confSnd=false;
-    config.confFS=false;
-    config.confConSpd=false;
-    config.confCompMet=false;
-    config.confImageQ=false;
-    config.confDPI=false;
-    config.confKbd=false;
-
-    QStringList lines=m_x2goconfig.split ( &quot;\n&quot; );
-
-
-    for ( int i=0;i&lt;lines.count();++i )
-    {
-        QString line = lines[i];
-        if ( ( line==&quot;-----BEGIN DSA PRIVATE KEY-----&quot; ) ||
-                ( line==&quot;-----BEGIN RSA PRIVATE KEY-----&quot; ) )
-        {
-            while ( i&lt;lines.count() )
-                config.key+=lines[i++] +&quot;\n&quot;;
-            haveKey=true;
-        }
-        else
-            processCfgLine ( line );
-    }
-    act_terminate-&gt;setVisible ( config.showtermbutton );
-    act_shareFolder-&gt;setVisible ( config.showexpbutton );
-    act_set-&gt;setVisible ( config.showconfig );
-    if (!config.showstatusbar)
-    {
-        statusBar()-&gt;hide();
-    }
-    if ( managedMode )
-    {
-        QTimer::singleShot ( 500, this, SLOT ( slotStartBroker() ) );
-        return;
-    }
-    slotSelectedFromList ( ( SessionButton* ) 0 );
-}
-
-
-void ONMainWindow::processCfgLine ( QString line )
-{
-    QStringList lst=line.split ( &quot;=&quot; );
-    if ( lst[0]==&quot;command&quot; )
-    {
-        config.command=lst[1];
-        return;
-    }
-    if ( lst[0]==&quot;server&quot; )
-    {
-        config.server=lst[1];
-        return;
-    }
-    if ( lst[0]==&quot;session&quot; )
-    {
-        config.session=lst[1];
-        return;
-    }
-    if ( lst[0]==&quot;sshport&quot; )
-    {
-        config.sshport=lst[1];
-        return;
-    }
-    if ( lst[0]==&quot;user&quot; )
-    {
-        config.user=lst[1];
-        return;
-    }
-    if ( lst[0]==&quot;rootless&quot; )
-    {
-        if ( lst[1]==&quot;true&quot; )
-            config.rootless=true;
-        else
-            config.rootless=false;
-        return;
-    }
-    if ( lst[0]==&quot;checkexitstatus&quot; )
-    {
-        if ( lst[1]==&quot;true&quot; )
-            config.checkexitstatus=true;
-        else
-            config.checkexitstatus=false;
-        return;
-    }
-    if ( lst[0]==&quot;showtermbutton&quot; )
-    {
-        if ( lst[1]==&quot;true&quot; )
-            config.showtermbutton=true;
-        else
-            config.showtermbutton=false;
-        return;
-    }
-    if ( lst[0]==&quot;showexpbutton&quot; )
-    {
-        if ( lst[1]==&quot;true&quot; )
-            config.showexpbutton=true;
-        else
-            config.showexpbutton=false;
-        return;
-    }
-    if ( lst[0]==&quot;showconfig&quot; )
-    {
-        if ( lst[1]==&quot;true&quot; )
-            config.showconfig=true;
-        else
-            config.showconfig=false;
-        return;
-    }
-    if ( lst[0]==&quot;showextconfig&quot; )
-    {
-        if ( lst[1]==&quot;true&quot; )
-            config.showextconfig=true;
-        else
-            config.showextconfig=false;
-        return;
-    }
-    if ( lst[0]==&quot;showstatusbar&quot; )
-    {
-        if ( lst[1]==&quot;true&quot; )
-            config.showstatusbar=true;
-        else
-            config.showstatusbar=false;
-        return;
-    }
-    if ( lst[0]==&quot;showtoolbar&quot; )
-    {
-        if ( lst[1]==&quot;true&quot; )
-            config.showtoolbar=true;
-        else
-            config.showtoolbar=false;
-        return;
-    }
-
-    if ( lst[0]==&quot;sound&quot; )
-    {
-        config.confSnd=true;
-        if ( lst[1]==&quot;true&quot; )
-            config.useSnd=true;
-        else
-            config.useSnd=false;
-        return;
-    }
-    if ( lst[0]==&quot;exportfs&quot; )
-    {
-        config.confFS=true;
-        if ( lst[1]==&quot;true&quot; )
-            config.useFs=true;
-        else
-            config.useFs=false;
-        return;
-    }
-
-    if ( lst[0]==&quot;speed&quot; )
-    {
-        config.confConSpd=true;
-        config.conSpeed=ADSL;
-
-        if ( lst[1]==&quot;modem&quot; )
-            config.conSpeed=MODEM;
-        else if ( lst[1]==&quot;isdn&quot; )
-            config.conSpeed=ISDN;
-        else if ( lst[1]==&quot;adsl&quot; )
-            config.conSpeed=ADSL;
-        else if ( lst[1]==&quot;wan&quot; )
-            config.conSpeed=WAN;
-        else if ( lst[1]==&quot;lan&quot; )
-            config.conSpeed=LAN;
-        else
-        {
-            qCritical (
-                &quot;%s&quot;,tr (
-                    &quot;wrong value for argument\&quot;speed\&quot;&quot;
-                ).toLocal8Bit().data() );
-        }
-        return;
-    }
-    if ( lst[0]==&quot;compression&quot; )
-    {
-        config.confCompMet=true;
-        config.compMet=lst[1];
-        return;
-    }
-    if ( lst[0]==&quot;quality&quot; )
-    {
-        config.confImageQ=true;
-        config.imageQ=lst[1].toInt();
-        return;
-    }
-    if ( lst[0]==&quot;dpi&quot; )
-    {
-        config.confDPI=true;
-        config.dpi=lst[1].toInt();
-        return;
-    }
-    if ( lst[0]==&quot;kbdlayout&quot; )
-    {
-        config.confKbd=true;
-        config.kbdLay=lst[1];
-        return;
-    }
-    if ( lst[0]==&quot;kbdtype&quot; )
-    {
-        config.confKbd=true;
-        config.kbdType=lst[1];
-        return;
-    }
-    if ( lst[0]==&quot;brokerurl&quot; )
-    {
-        config.brokerurl=lst[1];
-        managedMode=true;
-        acceptRsa=true;
-    }
-    if ( lst[0]==&quot;proxy&quot; )
-    {
-        config.proxy=sshProxy.host=lst[1];
-        sshProxy.use=true;
-#ifdef Q_OS_WIN
-        sshProxy.bin=cygwinPath ( wapiShortFileName ( appDir ) ) +&quot;/ssh&quot;;
-#else
-        sshProxy.bin=&quot;ssh&quot;;
-#endif
-        return;
-    }
-    if ( lst[0]==&quot;proxysshport&quot; )
-    {
-        config.proxyport=sshProxy.port=lst[1];
-        return;
-    }
-    if ( lst[0]==&quot;cookie&quot; )
-    {
-        config.cookie=lst[1];
-        return;
-    }
-    if ( lst[0]==&quot;x2gosession&quot; )
-    {
-        config.sessiondata=lst[1];
-        return;
-    }
-    if ( lst[0]==&quot;connectionts&quot; )
-    {
-        config.connectionts=lst[1];
-        return;
-    }
-}
-
-void ONMainWindow::slotChangeKbdLayout(const QString&amp; layout)
-{
-#ifdef Q_OS_LINUX
-    QStringList args;
-    args&lt;&lt;&quot;-layout&quot;&lt;&lt;layout;
-    x2goDebug&lt;&lt;&quot;running setxkbmap with params: &quot;&lt;&lt;args.join(&quot; &quot;);
-    QProcess::startDetached(&quot;setxkbmap&quot;,args);
-#endif
-}
-
-void ONMainWindow::initPassDlg()
-{
-    passForm = new SVGFrame ( &quot;:/svg/passform.svg&quot;,
-                              false,bgFrame );
-#ifdef Q_OS_WIN
-    passForm-&gt;setMainWidget ( ( QWidget* ) this );
-#endif
-    username-&gt;addWidget ( passForm );
-    passForm-&gt;hide();
-    setWidgetStyle ( passForm );
-    if ( !miniMode )
-        passForm-&gt;setFixedSize ( passForm-&gt;sizeHint() );
-    else
-        passForm-&gt;setFixedSize ( 310,180 );
-    QPalette pal=passForm-&gt;palette();
-    pal.setBrush ( QPalette::Window, QColor ( 255,255,255,0 ) );
-    pal.setColor ( QPalette::Active, QPalette::WindowText, QPalette::Mid );
-    pal.setColor ( QPalette::Active, QPalette::ButtonText, QPalette::Mid );
-    pal.setColor ( QPalette::Active, QPalette::Text, QPalette::Mid );
-    pal.setColor ( QPalette::Inactive, QPalette::WindowText, QPalette::Mid );
-    pal.setColor ( QPalette::Inactive, QPalette::ButtonText, QPalette::Mid );
-    pal.setColor ( QPalette::Inactive, QPalette::Text, QPalette::Mid );
-    passForm-&gt;setPalette ( pal );
-
-    pal.setColor ( QPalette::Button, QColor ( 255,255,255,0 ) );
-    pal.setColor ( QPalette::Window, QColor ( 255,255,255,255 ) );
-    pal.setColor ( QPalette::Base, QColor ( 255,255,255,255 ) );
-
-
-    QFont fnt=passForm-&gt;font();
-    if ( miniMode )
-#ifdef Q_WS_HILDON
-        fnt.setPointSize ( 10 );
-#else
-        fnt.setPointSize ( 9 );
-#endif
-    passForm-&gt;setFont ( fnt );
-
-    fotoLabel=new QLabel ( passForm );
-    fotoLabel-&gt;hide();
-
-    nameLabel=new QLabel ( &quot;&quot;,passForm );
-    nameLabel-&gt;hide();
-
-    loginPrompt=new QLabel ( tr ( &quot;Login:&quot; ),passForm );
-    passPrompt=new QLabel ( tr ( &quot;Password:&quot; ),passForm );
-    layoutPrompt=new QLabel ( tr ( &quot;Keyboard layout:&quot; ),passForm );
-
-    login=new ClickLineEdit ( passForm );
-    setWidgetStyle ( login );
-    login-&gt;setFrame ( false );
-    login-&gt;setEnabled ( false );
-
-    login-&gt;hide();
-    loginPrompt-&gt;hide();
-
-    pass=new ClickLineEdit ( passForm );
-    setWidgetStyle ( pass );
-    pass-&gt;setFrame ( false );
-    fnt.setBold ( true );
-    pass-&gt;setFont ( fnt );
-    pass-&gt;setEchoMode ( QLineEdit::Password );
-    pass-&gt;setFocus();
-
-#ifdef Q_OS_LINUX
-    connect ( login,SIGNAL ( clicked() ),this,
-              SLOT ( slotActivateWindow() ) );
-    connect ( pass,SIGNAL ( clicked() ),this,
-              SLOT ( slotActivateWindow() ) );
-#endif
-
-    pass-&gt;hide();
-    passPrompt-&gt;hide();
-
-
-    cbLayout=new QComboBox(passForm);
-    cbLayout-&gt;addItems(defaultLayout);
-    cbLayout-&gt;setFocusPolicy(Qt::NoFocus);
-    cbLayout-&gt;setFrame(false);
-    setWidgetStyle(cbLayout);
-    cbLayout-&gt;hide();
-    layoutPrompt-&gt;hide();
-    QHBoxLayout* cbLayoutLay=new QHBoxLayout();
-    cbLayoutLay-&gt;addWidget(cbLayout);
-    cbLayoutLay-&gt;addStretch();
-
-
-    ok=new QPushButton ( tr ( &quot;Ok&quot; ),passForm );
-    setWidgetStyle ( ok );
-    cancel=new QPushButton ( tr ( &quot;Cancel&quot; ),passForm );
-    setWidgetStyle ( cancel );
-    ok-&gt;hide();
-    cancel-&gt;hide();
-
-
-
-    cbLayout-&gt;setPalette ( pal );
-    ok-&gt;setPalette ( pal );
-    cancel-&gt;setPalette ( pal );
-
-
-
-#ifndef Q_WS_HILDON
-    ok-&gt;setFixedSize ( ok-&gt;sizeHint() );
-    cancel-&gt;setFixedSize ( cancel-&gt;sizeHint() );
-#else
-    QSize sz=cancel-&gt;sizeHint();
-    sz.setWidth ( ( int ) ( sz.width() /1.5 ) );
-    sz.setHeight ( ( int ) ( sz.height() /1.5 ) );
-    cancel-&gt;setFixedSize ( sz );
-    sz=ok-&gt;sizeHint();
-    sz.setWidth ( ( int ) ( sz.width() /1.5 ) );
-    sz.setHeight ( ( int ) ( sz.height() /1.5 ) );
-    ok-&gt;setFixedSize ( sz );
-#endif
-
-    QVBoxLayout *layout=new QVBoxLayout ( passForm );
-    QHBoxLayout *labelLay=new QHBoxLayout();
-    QHBoxLayout *inputLay=new QHBoxLayout();
-    QHBoxLayout *buttonLay=new QHBoxLayout();
-
-    labelLay-&gt;setSpacing ( 20 );
-    inputLay-&gt;setSpacing ( 10 );
-    layout-&gt;setContentsMargins ( 20,20,10,10 );
-    layout-&gt;addLayout ( labelLay );
-    layout-&gt;addStretch();
-    layout-&gt;addLayout ( inputLay );
-    layout-&gt;addStretch();
-    layout-&gt;addLayout ( buttonLay );
-
-    labelLay-&gt;addWidget ( fotoLabel );
-    labelLay-&gt;addWidget ( nameLabel );
-    labelLay-&gt;addStretch();
-
-    QVBoxLayout* il1=new QVBoxLayout();
-    il1-&gt;addWidget ( loginPrompt );
-    il1-&gt;addWidget ( passPrompt );
-    il1-&gt;addWidget ( layoutPrompt );
-
-    QVBoxLayout* il2=new QVBoxLayout();
-    il2-&gt;addWidget ( login );
-    il2-&gt;addWidget ( pass );
-    il2-&gt;addLayout ( cbLayoutLay );
-    inputLay-&gt;addLayout ( il1 );
-    inputLay-&gt;addLayout ( il2 );
-    inputLay-&gt;addStretch();
-
-    buttonLay-&gt;addStretch();
-    buttonLay-&gt;addWidget ( ok );
-    buttonLay-&gt;addWidget ( cancel );
-    buttonLay-&gt;addStretch();
-
-    pal.setColor ( QPalette::Base, QColor ( 239,239,239,255 ) );
-    login-&gt;setPalette ( pal );
-    pass-&gt;setPalette ( pal );
-
-    connect ( ok,SIGNAL ( clicked() ),this, SLOT ( slotSessEnter() ) );
-    connect ( cancel,SIGNAL ( clicked() ),this, SLOT ( slotClosePass() ) );
-    connect ( pass,SIGNAL ( returnPressed() ),this,
-              SLOT ( slotSessEnter() ) );
-    connect ( login,SIGNAL ( returnPressed() ),pass, SLOT ( selectAll() ) );
-    connect ( login,SIGNAL ( returnPressed() ),pass, SLOT ( setFocus() ) );
-
-    passPrompt-&gt;show();
-    pass-&gt;show();
-    ok-&gt;show();
-    cancel-&gt;show();
-    fotoLabel-&gt;show();
-    nameLabel-&gt;show();
-    if ( !useLdap )
-    {
-        login-&gt;show();
-        loginPrompt-&gt;show();
-    }
-    if ( embedMode )
-    {
-        cancel-&gt;setEnabled ( false );
-#ifdef Q_OS_WIN
-        QRect r;
-        wapiWindowRect ( ok-&gt;winId(),r );
-#endif
-    }
-    if (defaultLayout.size()&gt;1)
-    {
-        layoutPrompt-&gt;show();
-        cbLayout-&gt;show();
-        slotChangeKbdLayout(cbLayout-&gt;currentText());
-        connect (cbLayout,SIGNAL(currentIndexChanged(QString)),this,SLOT(slotChangeKbdLayout(QString)));
-    }
-}
-
-
-void ONMainWindow::initStatusDlg()
-{
-    sessionStatusDlg = new SVGFrame ( &quot;:/svg/passform.svg&quot;,
-                                      false,bgFrame );
-    sessionStatusDlg-&gt;hide();
-    if ( !miniMode )
-        sessionStatusDlg-&gt;setFixedSize (
-            sessionStatusDlg-&gt;sizeHint() );
-    else
-        sessionStatusDlg-&gt;setFixedSize ( 310,200 );
-    QFont fnt=sessionStatusDlg-&gt;font();
-    if ( miniMode )
-#ifdef Q_WS_HILDON
-        fnt.setPointSize ( 10 );
-#else
-        fnt.setPointSize ( 9 );
-#endif
-    sessionStatusDlg-&gt;setFont ( fnt );
-    username-&gt;addWidget ( sessionStatusDlg );
-    QPalette pal=sessionStatusDlg-&gt;palette();
-    pal.setBrush ( QPalette::Window, QColor ( 0,0,0,0 ) );
-    pal.setColor ( QPalette::Active, QPalette::WindowText, QPalette::Mid );
-    pal.setColor ( QPalette::Active, QPalette::ButtonText, QPalette::Mid );
-    pal.setColor ( QPalette::Active, QPalette::Text, QPalette::Mid );
-    pal.setColor ( QPalette::Inactive, QPalette::WindowText, QPalette::Mid );
-    pal.setColor ( QPalette::Inactive, QPalette::ButtonText, QPalette::Mid );
-    pal.setColor ( QPalette::Inactive, QPalette::Text, QPalette::Mid );
-
-    sessionStatusDlg-&gt;setPalette ( pal );
-
-    slName=new QLabel ( sessionStatusDlg );
-    slVal=new QLabel ( sessionStatusDlg );
-
-    slName-&gt;setText (
-        tr (
-            &quot;&lt;b&gt;Session ID:&lt;br&gt;Server:&lt;br&gt;Username:&quot;
-            &quot;&lt;br&gt;Display:&lt;br&gt;Creation time:&lt;br&gt;Status:&lt;/b&gt;&quot; ) );
-    slName-&gt;setFixedSize ( slName-&gt;sizeHint() );
-    slName-&gt;hide();
-
-    slVal-&gt;hide();
-    slVal-&gt;setFixedHeight ( slName-&gt;sizeHint().height() );
-
-    sbApps=new QToolButton (sessionStatusDlg );
-    sbApps-&gt;setToolTip(tr ( &quot;Applications...&quot; ));
-    sbApps-&gt;setIcon(QPixmap(&quot;:/icons/32x32/apps.png&quot;));
-    sbApps-&gt;setAutoRaise(true);
-    sbApps-&gt;setFocusPolicy(Qt::NoFocus);
-
-    sbExp=new QToolButton (sessionStatusDlg );
-    sbExp-&gt;setIcon(QPixmap(&quot;:/icons/32x32/open_dir.png&quot;));
-    sbExp-&gt;setToolTip (tr (&quot;Share folder...&quot; ));
-    sbExp-&gt;setAutoRaise(true);
-    sbExp-&gt;setFocusPolicy(Qt::NoFocus);
-
-    sbSusp=new QToolButton (sessionStatusDlg );
-    sbSusp-&gt;setIcon(QPixmap(&quot;:/icons/32x32/suspend_session.png&quot;));
-    sbSusp-&gt;setToolTip(tr ( &quot;Abort&quot; ));
-    sbSusp-&gt;setAutoRaise(true);
-    sbSusp-&gt;setFocusPolicy(Qt::NoFocus);
-
-
-    sbTerm=new QToolButton (sessionStatusDlg );
-    sbTerm-&gt;setIcon(QPixmap(&quot;:/icons/32x32/stop_session.png&quot;));
-    sbTerm-&gt;setToolTip(tr ( &quot;Terminate&quot; ));
-    sbTerm-&gt;setAutoRaise(true);
-    sbTerm-&gt;setFocusPolicy(Qt::NoFocus);
-
-
-    sbAdv=new QCheckBox ( tr ( &quot;Show details&quot; ),sessionStatusDlg );
-    setWidgetStyle ( sbTerm );
-    setWidgetStyle ( sbApps );
-    setWidgetStyle ( sbExp );
-    setWidgetStyle ( sbSusp );
-    setWidgetStyle ( sbAdv );
-
-    sbAdv-&gt;setFixedSize ( sbAdv-&gt;sizeHint() );
-    sbApps-&gt;setFixedSize ( 32,32 );
-    sbSusp-&gt;setFixedSize ( 32,32 );
-    sbTerm-&gt;setFixedSize ( 32,32 );
-    sbExp-&gt;setFixedSize ( 32,32 );
-
-    /*
-        sbApps-&gt;setFocusPolicy(Qt::NoFocus);
-        sbSusp-&gt;setFocusPolicy(Qt::NoFocus);
-        sbTerm-&gt;setFocusPolicy(Qt::NoFocus);
-        sbExp-&gt;setFocusPolicy(Qt::NoFocus);*/
-
-    sbAdv-&gt;hide();
-    sbSusp-&gt;hide();
-    sbTerm-&gt;hide();
-    sbExp-&gt;hide();
-    sbApps-&gt;hide();
-
-
-    pal.setColor ( QPalette::Button, QColor ( 255,255,255,0 ) );
-    pal.setColor ( QPalette::Window, QColor ( 255,255,255,255 ) );
-    pal.setColor ( QPalette::Base, QColor ( 255,255,255,255 ) );
-
-    sbAdv-&gt;setPalette ( pal );
-    sbApps-&gt;setPalette ( pal );
-    sbSusp-&gt;setPalette ( pal );
-    sbTerm-&gt;setPalette ( pal );
-    sbExp-&gt;setPalette ( pal );
-
-    stInfo=new QTextEdit ( sessionStatusDlg );
-    setWidgetStyle ( stInfo );
-    setWidgetStyle ( stInfo-&gt;verticalScrollBar() );
-    stInfo-&gt;setReadOnly ( true );
-    stInfo-&gt;hide();
-    stInfo-&gt;setFrameStyle ( QFrame::StyledPanel|QFrame::Plain );
-    stInfo-&gt;setPalette ( pal );
-
-    sbExp-&gt;setEnabled ( false );
-
-    connect ( sbSusp,SIGNAL ( clicked() ),this,
-              SLOT ( slotTestSessionStatus() ) );
-    connect ( sbTerm,SIGNAL ( clicked() ),this,
-              SLOT ( slotTermSessFromSt() ) );
-    connect ( sbAdv,SIGNAL ( clicked() ),this,
-              SLOT ( slotShowAdvancedStat() ) );
-    connect ( sbExp,SIGNAL ( clicked() ),this,
-              SLOT ( slotExportDirectory() ) );
-    connect ( sbApps,SIGNAL ( clicked() ),this,
-              SLOT ( slotAppDialog()) );
-
-    QVBoxLayout* layout=new QVBoxLayout ( sessionStatusDlg );
-    QHBoxLayout* ll=new QHBoxLayout();
-    ll-&gt;addWidget ( slName );
-    ll-&gt;addWidget ( slVal );
-    ll-&gt;addStretch();
-    ll-&gt;setSpacing ( 10 );
-    if ( !miniMode )
-        layout-&gt;setContentsMargins ( 25,25,10,10 );
-    else
-        layout-&gt;setContentsMargins ( 10,10,10,10 );
-
-    QHBoxLayout* bl=new QHBoxLayout();
-    bl-&gt;addStretch();
-    bl-&gt;addWidget ( sbApps );
-    bl-&gt;addWidget ( sbExp );
-    bl-&gt;addWidget ( sbSusp );
-    bl-&gt;addWidget ( sbTerm );
-//     bl-&gt;addStretch();
-    layout-&gt;addLayout ( ll );
-    layout-&gt;addStretch();
-    layout-&gt;addWidget ( stInfo );
-    layout-&gt;addWidget ( sbAdv );
-    layout-&gt;addStretch();
-    layout-&gt;addLayout ( bl );
-
-
-    slName-&gt;show();
-    slVal-&gt;show();
-    sbAdv-&gt;show();
-    if ( !embedMode )
-    {
-        sbSusp-&gt;show();
-        sbTerm-&gt;show();
-        sbExp-&gt;show();
-    }
-
-    X2goSettings st ( &quot;settings&quot; );
-
-
-    if ( st.setting()-&gt;value ( &quot;showStatus&quot;, ( QVariant ) false ).toBool() )
-    {
-        sbAdv-&gt;setChecked ( true );
-        slotShowAdvancedStat();
-    }
-#ifdef Q_OS_WIN
-    if ( embedMode )
-    {
-        QRect r;
-        wapiWindowRect ( sbAdv-&gt;winId(),r );
-        wapiWindowRect ( stInfo-&gt;verticalScrollBar ()-&gt;winId(),r );
-    }
-#endif
-
-}
-
-
-void ONMainWindow::initSelectSessDlg()
-{
-    selectSessionDlg = new SVGFrame ( &quot;:/svg/passform.svg&quot;,
-                                      false,bgFrame );
-    username-&gt;addWidget ( selectSessionDlg );
-    setWidgetStyle ( selectSessionDlg );
-    if ( !miniMode )
-        selectSessionDlg-&gt;setFixedSize ( selectSessionDlg-&gt;sizeHint() );
-    else
-        selectSessionDlg-&gt;setFixedSize ( 310,180 );
-    QPalette pal=selectSessionDlg-&gt;palette();
-    pal.setBrush ( QPalette::Window, QColor ( 255,255,255,0 ) );
-    pal.setColor ( QPalette::Active, QPalette::WindowText, QPalette::Mid );
-    pal.setColor ( QPalette::Active, QPalette::ButtonText, QPalette::Mid );
-    pal.setColor ( QPalette::Active, QPalette::Text, QPalette::Mid );
-    pal.setColor ( QPalette::Inactive, QPalette::WindowText, QPalette::Mid );
-    pal.setColor ( QPalette::Inactive, QPalette::ButtonText, QPalette::Mid );
-    pal.setColor ( QPalette::Inactive, QPalette::Text, QPalette::Mid );
-
-    selectSessionDlg-&gt;setPalette ( pal );
-
-    pal.setColor ( QPalette::Button, QColor ( 255,255,255,0 ) );
-    pal.setColor ( QPalette::Window, QColor ( 255,255,255,255 ) );
-    pal.setColor ( QPalette::Base, QColor ( 255,255,255,255 ) );
-
-    QFont fnt=selectSessionDlg-&gt;font();
-    if ( miniMode )
-#ifdef Q_WS_HILDON
-        fnt.setPointSize ( 10 );
-#else
-        fnt.setPointSize ( 9 );
-#endif
-    selectSessionDlg-&gt;setFont ( fnt );
-    selectSessionLabel=new QLabel ( tr ( &quot;Select session:&quot; ),
-                                    selectSessionDlg );
-    sOk=new QPushButton ( tr ( &quot;Resume&quot; ),selectSessionDlg );
-    setWidgetStyle ( sOk );
-    sCancel=new QPushButton ( tr ( &quot;Cancel&quot; ),selectSessionDlg );
-    setWidgetStyle ( sCancel );
-    bCancel=new QPushButton ( tr ( &quot;Cancel&quot; ),selectSessionDlg );
-    setWidgetStyle ( bCancel );
-
-    bSusp=new QPushButton ( tr ( &quot;Suspend&quot; ),selectSessionDlg );
-    setWidgetStyle ( bSusp );
-    bTerm=new QPushButton ( tr ( &quot;Terminate&quot; ),selectSessionDlg );
-    setWidgetStyle ( bTerm );
-
-    bNew=new QPushButton ( tr ( &quot;New&quot; ),selectSessionDlg );
-    setWidgetStyle ( bNew );
-
-    bShadow=new QPushButton ( tr ( &quot;Full access&quot; ),selectSessionDlg );
-    setWidgetStyle ( bShadow );
-
-    bShadowView=new QPushButton ( tr ( &quot;View only&quot; ),selectSessionDlg );
-    setWidgetStyle ( bShadowView );
-
-    sOk-&gt;setPalette ( pal );
-    sCancel-&gt;setPalette ( pal );
-
-    connect ( sCancel,SIGNAL ( clicked() ),this,
-              SLOT ( slotCloseSelectDlg() ) );
-    connect ( bCancel,SIGNAL ( clicked() ),this,
-              SLOT ( slotCloseSelectDlg() ) );
-
-    selectSessionDlg-&gt;show();
-#ifndef Q_WS_HILDON
-    sOk-&gt;setFixedSize ( ok-&gt;sizeHint() );
-    sCancel-&gt;setFixedSize ( cancel-&gt;sizeHint() );
-#else
-    QSize sz=sCancel-&gt;sizeHint();
-    sz.setWidth ( ( int ) ( sz.width() /1.5 ) );
-    sz.setHeight ( ( int ) ( sz.height() /1.5 ) );
-    sCancel-&gt;setFixedSize ( sz );
-    sz=sOk-&gt;sizeHint();
-    sz.setWidth ( ( int ) ( sz.width() /1.5 ) );
-    sz.setHeight ( ( int ) ( sz.height() /1.5 ) );
-    sOk-&gt;setFixedSize ( sz );
-    sz=bSusp-&gt;sizeHint();
-    if ( bTerm-&gt;sizeHint().width() &gt; sz.width() )
-        sz=bTerm-&gt;sizeHint();
-    if ( bNew-&gt;sizeHint().width() &gt; sz.width() )
-        sz=bNew-&gt;sizeHint();
-    sz.setWidth ( ( int ) ( sz.width() /1.5 ) );
-    sz.setHeight ( ( int ) ( sz.height() /1.5 ) );
-    bSusp-&gt;setFixedSize ( sz );
-    bTerm-&gt;setFixedSize ( sz );
-    bNew-&gt;setFixedSize ( sz );
-#endif
-    int bmaxw=bNew-&gt;size().width();
-    if ( bSusp-&gt;size().width() &gt;bmaxw )
-        bmaxw=bSusp-&gt;size().width();
-    if ( bTerm-&gt;size().width() &gt;bmaxw )
-        bmaxw=bTerm-&gt;size().width();
-
-    bNew-&gt;setFixedWidth ( bmaxw );
-    bSusp-&gt;setFixedWidth ( bmaxw );
-    bTerm-&gt;setFixedWidth ( bmaxw );
-
-
-
-    sOk-&gt;setEnabled ( true );
-    sCancel-&gt;setEnabled ( true );
-    selectSessionDlg-&gt;setEnabled ( true );
-    setEnabled ( true );
-
-    sessTv=new QTreeView ( selectSessionDlg );
-    setWidgetStyle ( sessTv );
-    setWidgetStyle ( sessTv-&gt;horizontalScrollBar() );
-    setWidgetStyle ( sessTv-&gt;verticalScrollBar() );
-    sessTv-&gt;setItemsExpandable ( false );
-    sessTv-&gt;setRootIsDecorated ( false );
-
-    model=new QStandardItemModel ( sessions.size(), 8 );
-    model-&gt;setHeaderData ( S_DISPLAY,Qt::Horizontal,
-                           QVariant ( ( QString ) tr ( &quot;Display&quot; ) ) );
-    model-&gt;setHeaderData ( S_STATUS,Qt::Horizontal,
-                           QVariant ( ( QString ) tr ( &quot;Status&quot; ) ) );
-    model-&gt;setHeaderData ( S_COMMAND,Qt::Horizontal,
-                           QVariant ( ( QString ) tr ( &quot;Command&quot; ) ) );
-    model-&gt;setHeaderData ( S_TYPE,Qt::Horizontal,
-                           QVariant ( ( QString ) tr ( &quot;Type&quot; ) ) );
-    model-&gt;setHeaderData ( S_SERVER,Qt::Horizontal,
-                           QVariant ( ( QString ) tr ( &quot;Server&quot; ) ) );
-    model-&gt;setHeaderData (
-        S_CRTIME,Qt::Horizontal,
-        QVariant ( ( QString ) tr ( &quot;Creation time&quot; ) ) );
-    model-&gt;setHeaderData ( S_IP,Qt::Horizontal,
-                           QVariant ( ( QString ) tr ( &quot;Client IP&quot; ) ) );
-    model-&gt;setHeaderData ( S_ID,Qt::Horizontal,
-                           QVariant ( ( QString ) tr ( &quot;Session ID&quot; ) ) );
-
-    modelDesktop=new QStandardItemModel ( sessions.size(), 2 );
-    modelDesktop-&gt;setHeaderData ( D_USER,Qt::Horizontal,
-                                  QVariant ( ( QString ) tr ( &quot;User&quot; ) ) );
-    modelDesktop-&gt;setHeaderData (
-        D_DISPLAY,Qt::Horizontal,
-        QVariant ( ( QString ) tr ( &quot;Display&quot; ) ) );
-
-    sessTv-&gt;setModel ( ( QAbstractItemModel* ) model );
-
-    QFontMetrics fm ( sessTv-&gt;font() );
-    sessTv-&gt;setEditTriggers ( QAbstractItemView::NoEditTriggers );
-    sessTv-&gt;setPalette ( pal );
-
-    sessTv-&gt;setModel ( ( QAbstractItemModel* ) model );
-
-    bNew-&gt;setPalette ( pal );
-    bShadow-&gt;setPalette ( pal );
-    bShadowView-&gt;setPalette ( pal );
-    bSusp-&gt;setPalette ( pal );
-    bTerm-&gt;setPalette ( pal );
-    sessTv-&gt;setFrameStyle ( QFrame::StyledPanel|QFrame::Plain );
-    sOk-&gt;setEnabled ( false );
-    bSusp-&gt;setEnabled ( false );
-    bTerm-&gt;setEnabled ( false );
-    bShadow-&gt;setEnabled ( false );
-    selectSessionLabel-&gt;hide();
-    bCancel-&gt;setPalette ( pal );
-    bCancel-&gt;hide();
-
-    desktopFilter=new QLineEdit ( selectSessionDlg );
-    setWidgetStyle ( desktopFilter );
-// 	desktopFilter-&gt;setFrame ( false );
-
-    desktopFilterCb=new QCheckBox ( tr ( &quot;Only my desktops&quot; ),
-                                    selectSessionDlg );
-    desktopFilterCb-&gt;hide();
-
-    QVBoxLayout* layout=new QVBoxLayout ( selectSessionDlg );
-    QHBoxLayout* filterLay=new QHBoxLayout();
-    QHBoxLayout* blay=new QHBoxLayout();
-    QVBoxLayout* alay=new QVBoxLayout();
-    QHBoxLayout* tvlay=new QHBoxLayout();
-
-    selectSesDlgLayout=layout;
-
-    layout-&gt;addWidget ( selectSessionLabel );
-    layout-&gt;addLayout ( filterLay );
-    layout-&gt;addLayout ( tvlay );
-    layout-&gt;addLayout ( blay );
-
-    filterLay-&gt;addWidget ( desktopFilter );
-    filterLay-&gt;addWidget ( desktopFilterCb );
-
-    alay-&gt;addWidget ( bSusp );
-    alay-&gt;addWidget ( bTerm );
-    alay-&gt;addWidget ( bShadowView );
-    alay-&gt;addWidget ( bShadow );
-    alay-&gt;addStretch();
-    alay-&gt;addWidget ( bNew );
-    alay-&gt;addWidget ( bCancel );
-
-    tvlay-&gt;addWidget ( sessTv );
-    tvlay-&gt;addLayout ( alay );
-
-    blay-&gt;addStretch();
-    blay-&gt;addWidget ( sOk );
-    blay-&gt;addWidget ( sCancel );
-    blay-&gt;addStretch();
-    if ( !miniMode )
-        layout-&gt;setContentsMargins ( 25,25,10,10 );
-    else
-        layout-&gt;setContentsMargins ( 10,10,10,10 );
-
-
-
-    sOk-&gt;hide();
-    sCancel-&gt;hide();
-    bNew-&gt;hide();
-    bSusp-&gt;hide();
-    bTerm-&gt;hide();
-
-    connect ( sessTv,SIGNAL ( clicked ( const QModelIndex&amp; ) ),
-              this,SLOT ( slotActivated ( const QModelIndex&amp; ) ) );
-
-    connect ( sessTv,SIGNAL ( doubleClicked ( const QModelIndex&amp; ) ),
-              this,SLOT ( slotResumeDoubleClick ( const QModelIndex&amp; ) ) );
-
-    connect ( sOk,SIGNAL ( clicked() ),this, SLOT ( slotResumeSess() ) );
-    connect ( bSusp,SIGNAL ( clicked() ),this, SLOT ( slotSuspendSess() ) );
-    connect ( bTerm,SIGNAL ( clicked() ),this, SLOT ( slotTermSess() ) );
-    connect ( bNew,SIGNAL ( clicked() ),this, SLOT ( slotNewSess() ) );
-
-    connect ( bShadow,SIGNAL ( clicked() ),this,
-              SLOT ( slotShadowSess() ) );
-    connect ( bShadowView,SIGNAL ( clicked() ),this,
-              SLOT ( slotShadowViewSess() ) );
-
-    connect ( desktopFilter,SIGNAL ( textEdited ( const QString&amp; ) ),this,
-              SLOT ( slotDesktopFilterChanged ( const QString&amp; ) ) );
-    connect ( desktopFilterCb,SIGNAL ( stateChanged ( int ) ),
-              this,
-              SLOT ( slotDesktopFilterCb ( int ) ) );
-
-    selectSessionLabel-&gt;show();
-    sOk-&gt;show();
-    sCancel-&gt;show();
-    bNew-&gt;show();
-    bSusp-&gt;show();
-    bTerm-&gt;show();
-    sessTv-&gt;show();
-    selectSessionDlg-&gt;hide();
-#ifdef Q_OS_WIN
-    if ( embedMode )
-    {
-        QRect r;
-        wapiWindowRect ( sOk-&gt;winId(),r );
-        wapiWindowRect ( sessTv-&gt;verticalScrollBar ()-&gt;winId(),r );
-        wapiWindowRect ( sessTv-&gt;horizontalScrollBar ()-&gt;winId(),r );
-        wapiWindowRect ( sessTv-&gt;header ()-&gt;viewport()-&gt;winId(),r );
-    }
-#endif
-
-}
-
-
-
-void ONMainWindow::printSshDError()
-{
-    if ( closeEventSent )
-        return;
-    QMessageBox::critical ( 0l,tr ( &quot;Error&quot; ),
-                            tr ( &quot;sshd not started, &quot;
-                                 &quot;you'll need sshd for printing &quot;
-                                 &quot;and file sharing\n&quot;
-                                 &quot;you can install sshd with\n&quot;
-                                 &quot;&lt;b&gt;sudo apt-get install &quot;
-                                 &quot;openssh-server&lt;/b&gt;&quot; ),
-                            QMessageBox::Ok,QMessageBox::NoButton );
-}
-
-void ONMainWindow::slotStartParec ()
-{
-    if ( !parecTunnelOk )
-    {
-// 		wait 1 sec and try again
-        QTimer::singleShot ( 1000, this, SLOT ( slotStartParec() ) );
-        return;
-    }
-    SshProcess* paProc;
-    QString passwd=getCurrentPass();
-    QString user=getCurrentUname();
-    QString host=resumingSession.server;
-    QString scmd=&quot;PULSE_CLIENTCONFIG=~/.x2go/C-&quot;+
-                 resumingSession.sessionId+
-                 &quot;/.pulse-client.conf &quot;+
-                 &quot;parec &gt; /dev/null &amp;sleep 1 &amp;&amp; kill %1&quot;;
-
-    paProc=new SshProcess ( sshConnection, this );
-    paProc-&gt;startNormal ( scmd );
-}
-
-
-void ONMainWindow::slotSndTunOk()
-{
-    parecTunnelOk=true;
-}
-
-
-void ONMainWindow::slotPCookieReady (	bool result,
-                                      QString ,
-                                      SshProcess* )
-{
-    if ( result )
-        slotStartParec();
-}
-
-
-void ONMainWindow::loadPulseModuleNativeProtocol()
-{
-    QProcess* proc=new QProcess ( this );
-    QStringList args;
-    args&lt;&lt;&quot;load-module&quot;&lt;&lt;&quot;module-native-protocol-tcp&quot;;
-    proc-&gt;start ( &quot;pactl&quot;,args );
-    proc-&gt;waitForFinished ( 3000 );
-}
-
-void ONMainWindow::slotEmbedToolBar()
-{
-    if ( statusLabel )
-    {
-        delete statusLabel;
-        statusLabel=0;
-    }
-    if ( embedTbVisible )
-    {
-        stb-&gt;clear();
-        act_embedToolBar-&gt;setIcon (
-            QIcon ( &quot;:icons/16x16/tbshow.png&quot; ) );
-        stb-&gt;addAction ( act_embedToolBar );
-        stb-&gt;setToolButtonStyle ( Qt::ToolButtonIconOnly );
-        stb-&gt;widgetForAction (
-            act_embedToolBar )-&gt;setFixedHeight ( 16 );
-        act_embedToolBar-&gt;setText ( tr ( &quot;Restore toolbar&quot; ) );
-        statusLabel=new QLabel;
-        stb-&gt;addWidget ( statusLabel );
-#ifndef Q_OS_WIN
-        statusBar()-&gt;hide();
-#endif
-    }
-    else
-    {
-        initEmbedToolBar();
-        act_embedToolBar-&gt;setIcon (
-            QIcon ( &quot;:icons/32x32/tbhide.png&quot; ) );
-        act_embedToolBar-&gt;setText ( tr ( &quot;Minimize toolbar&quot; ) );
-    }
-    embedTbVisible=!embedTbVisible;
-    if ( proxyWinEmbedded )
-        setStatStatus();
-    X2goSettings st ( &quot;sessions&quot; );
-    st.setting()-&gt;setValue ( &quot;embedded/tbvisible&quot;, embedTbVisible );
-    st.setting()-&gt;sync();
-}
-
-void ONMainWindow::initEmbedToolBar()
-{
-    stb-&gt;addAction ( act_embedToolBar );
-    stb-&gt;addSeparator();
-    stb-&gt;setToolButtonStyle ( Qt::ToolButtonTextUnderIcon );
-    stb-&gt;addAction ( act_shareFolder );
-    stb-&gt;addAction ( act_reconnect );
-    stb-&gt;addAction ( act_suspend );
-    stb-&gt;addAction ( act_terminate );
-    stb-&gt;addSeparator();
-    stb-&gt;addAction ( act_embedContol );
-    stb-&gt;addSeparator();
-    stb-&gt;addAction ( act_set );
-    stb-&gt;addAction ( act_abclient );
-}
-
-void ONMainWindow::slotEmbedToolBarToolTip()
-{
-    if ( !showTbTooltip )
-        return;
-    QWidget* widg=stb-&gt;widgetForAction (
-                      act_embedToolBar );
-    QToolTip::showText ( this-&gt;mapToGlobal ( QPoint ( 6,6 ) ),
-                         tr ( &quot;&lt;br&gt;&lt;b&gt;&nbsp;&nbsp;&nbsp;Click this &quot;
-                              &quot;button&nbsp;&nbsp;&nbsp;&lt;br&gt;&quot;
-                              &quot;&nbsp;&nbsp;&nbsp;to restore toolbar&quot;
-                              &quot;&nbsp;&nbsp;&nbsp;&lt;/b&gt;&lt;br&gt;&quot; ),
-                         widg );
-}
-
-
-void ONMainWindow::slotActivateWindow()
-{
-    if ( embedMode )
-    {
-        QApplication::setActiveWindow ( this ) ;
-        activateWindow();
-
-        /*		x2goDebug&lt;&lt;&quot;focus:&quot;&lt;&lt;pass-&gt;hasFocus();
-        		x2goDebug&lt;&lt;&quot;activ:&quot;&lt;&lt;pass-&gt;isActiveWindow();*/
-        QTimer::singleShot ( 50, this,
-                             SLOT ( slotEmbedToolBarToolTip() ) );
-    }
-}
-
-#ifndef Q_OS_WIN
-void ONMainWindow::mouseReleaseEvent ( QMouseEvent * event )
-{
-    QMainWindow::mouseReleaseEvent ( event );
-    slotActivateWindow();
-}
-#endif
-
-void ONMainWindow::slotHideEmbedToolBarToolTip()
-{
-    showTbTooltip=false;
-    QToolTip::hideText();
-}
-
-
-void ONMainWindow::slotDesktopFilterChanged ( const QString&amp; text )
-{
-    filterDesktops ( text );
-}
-
-
-void ONMainWindow::slotDesktopFilterCb ( int state )
-{
-    if ( state==Qt::Checked )
-    {
-        filterDesktops ( getCurrentUname(),true );
-        desktopFilter-&gt;setEnabled ( false );
-    }
-    else
-    {
-        filterDesktops ( desktopFilter-&gt;text() );
-        desktopFilter-&gt;setEnabled ( true );
-    }
-}
-
-
-void ONMainWindow::filterDesktops ( const QString&amp; filter, bool strict )
-{
-    modelDesktop-&gt;setRowCount ( 0 );
-    bShadow-&gt;setEnabled ( false );
-    bShadowView-&gt;setEnabled ( false );
-    QFontMetrics fm ( sessTv-&gt;font() );
-    uint nextRow=0;
-    for ( int row = 0; row &lt; selectedDesktops.size(); ++row )
-    {
-        QStringList desktop=selectedDesktops[row].split ( &quot;@&quot; );
-        if ( filter==tr ( &quot;Filter&quot; ) ||filter.length() &lt;=0||
-                ( strict &amp;&amp; desktop[0]==filter )  ||
-                ( !strict &amp;&amp; desktop[0].startsWith ( filter ) ) )
-        {
-            QStandardItem *item;
-            item= new QStandardItem ( desktop[0] );
-            modelDesktop-&gt;setItem ( nextRow,D_USER,item );
-            item= new QStandardItem ( desktop[1] );
-            modelDesktop-&gt;setItem ( nextRow++,D_DISPLAY,item );
-            for ( int j=0;j&lt;2;++j )
-            {
-                QString txt=
-                    modelDesktop-&gt;index (
-                        row,j ).data().toString();
-                if ( sessTv-&gt;header()-&gt;sectionSize ( j ) &lt;
-                        fm.width ( txt ) +6 )
-                {
-                    sessTv-&gt;header()-&gt;resizeSection (
-                        j,fm.width ( txt ) +6 );
-                }
-            }
-        }
-    }
-}
-
-
-void ONMainWindow::slotShadowSess()
-{
-    shadowMode=SHADOW_FULL;
-    slotShadowViewSess();
-}
-
-void ONMainWindow::slotShadowViewSess()
-{
-    shadowUser=sessTv-&gt;model()-&gt;index ( sessTv-&gt;currentIndex().row(),
-                                        D_USER ).data().toString();
-    shadowDisplay=sessTv-&gt;model()-&gt;index ( sessTv-&gt;currentIndex().row(),
-                                           D_DISPLAY ).data().toString();
-    startNewSession();
-}
-
-
-void ONMainWindow::slotReconnectSession()
-{
-    if ( !managedMode )
-        slotSelectedFromList ( ( SessionButton* ) 0 );
-    else
-    {
-        broker-&gt;getSInfoFromBroker();
-        setEnabled ( false );
-    }
-}
-
-
-QSize ONMainWindow::getEmbedAreaSize()
-{
-    if ( embedTbVisible &amp;&amp; config.showstatusbar )
-        statusBar()-&gt;show();
-    QSize sz=bgFrame-&gt;size();
-//     sz.setHeight(sz.height()-statusBar()-&gt;size().height());
-    statusBar()-&gt;hide();
-    return sz;
-}
-
-
-void ONMainWindow::slotStartBroker()
-{
-    config.brokerPass=pass-&gt;text();
-    config.brokerUser=login-&gt;text();
-    setStatStatus ( tr ( &quot;Connecting to broker&quot; ) );
-    stInfo-&gt;insertPlainText ( &quot;broker url: &quot;+config.brokerurl );
-    setEnabled ( false );
-    broker-&gt;getUserSessions();
-}
-
-void ONMainWindow::slotGetBrokerSession(const QString&amp; sinfo)
-{
-    //x2goDebug&lt;&lt;&quot;broker session: &quot;&lt;&lt;sinfo;
-    QStringList lst=sinfo.split(&quot;SERVER:&quot;,QString::SkipEmptyParts);
-    int keyStartPos=sinfo.indexOf(&quot;-----BEGIN DSA PRIVATE KEY-----&quot;);
-    QString endStr=&quot;-----END DSA PRIVATE KEY-----&quot;;
-    int keyEndPos=sinfo.indexOf(endStr);
-    if (! (keyEndPos == -1 || keyStartPos == -1 || lst.size()==0))
-        config.key=sinfo.mid(keyStartPos, keyEndPos+endStr.length()-keyStartPos);
-    QString serverLine=(lst[1].split(&quot;\n&quot;))[0];
-    QStringList words=serverLine.split(&quot;:&quot;,QString::SkipEmptyParts);
-    config.server=words[0];
-    if (words.count()&gt;1)
-        config.sshport=words[1];
-//    x2goDebug&lt;&lt;&quot;server: &quot;&lt;&lt;config.server&lt;&lt;endl&lt;&lt;&quot; key: &quot;&lt;&lt;config.key;
-    if (sinfo.indexOf(&quot;SESSION_INFO&quot;)!=-1)
-    {
-        QStringList lst=sinfo.split(&quot;SESSION_INFO:&quot;,QString::SkipEmptyParts);
-        config.sessiondata=(lst[1].split(&quot;\n&quot;))[0];
-// 	x2goDebug&lt;&lt;&quot;data: &quot;&lt;&lt;config.sessiondata;
-    }
-    slotSessEnter();
-}
-
-void ONMainWindow::slotStartNewBrokerSession ( )
-{
-    if ( managedMode )
-    {
-        setEnabled ( true );
-        slotSelectedFromList ( ( SessionButton* ) 0 );
-    }
-}
-
-#ifdef Q_OS_WIN
-QString ONMainWindow::u3DataPath()
-{
-    QStringList env=QProcess::systemEnvironment();
-    QString dpath;
-    for ( int i=0;i&lt;env.size();++i )
-    {
-// 		x2goDebug &lt;&lt; env[i];
-        //check if we have U3 System
-        if ( env[i].indexOf ( &quot;U3_APP_DATA_PATH=&quot; ) ==0 )
-        {
-            dpath=env[i];
-        }
-        if ( env[i].indexOf ( &quot;U3_DEVICE_PATH=&quot; ) ==0 )
-        {
-            u3Device=env[i];
-            u3Device.replace ( &quot;U3_DEVICE_PATH=&quot;,&quot;&quot; );
-        }
-
-    }
-
-    if ( dpath.length() &gt;0 )
-    {
-        dpath.replace ( &quot;U3_APP_DATA_PATH=&quot;,&quot;&quot; );
-        portableDataPath=dpath;
-        return dpath;
-    }
-    return QString::null;
-}
-
-#endif
-
-void ONMainWindow::cleanPortable()
-{
-    removeDir ( homeDir +&quot;/.ssh&quot; );
-    removeDir ( homeDir +&quot;/ssh&quot; );
-    removeDir ( homeDir+&quot;/.x2go&quot; );
-    if (cleanAllFiles)
-        removeDir(homeDir+&quot;/.x2goclient&quot;);
-}
-
-void ONMainWindow::removeDir ( QString path )
-{
-    x2goDebug&lt;&lt;&quot;entering &quot; &lt;&lt;path;
-    QDir dr ( path );
-    QStringList files=dr.entryList ( QDir::Files );
-    for ( int i=0;i&lt;files.size();++i )
-    {
-        if ( files[i]!=&quot;known_hosts&quot; || cleanAllFiles)
-        {
-            x2goDebug&lt;&lt;&quot;cleaning file:&quot;&lt;&lt;path+&quot;/&quot;+files[i];
-            dr.remove ( path+&quot;/&quot;+files[i] );
-        }
-    }
-    QStringList dirs=dr.entryList ( QDir::AllDirs|QDir::NoDotAndDotDot );
-    for ( int i=0;i&lt;dirs.size();++i )
-    {
-        removeDir ( path+&quot;/&quot;+dirs[i] );
-    }
-    dr.rmdir ( path );
-}
-
-#ifdef Q_OS_LINUX
-long ONMainWindow::X11FindWindow ( QString text, long rootWin )
-{
-    Window    wParent;
-    Window    wRoot;
-    Window   *child_list;
-    unsigned  nChildren;
-    long proxyId=0;
-    if ( !rootWin )
-        rootWin= XDefaultRootWindow ( QX11Info::display() );
-
-    if ( XQueryTree ( QX11Info::display(),rootWin,&amp;wRoot,&amp;wParent,
-                      &amp;child_list,&amp;nChildren ) )
-    {
-        for ( uint i=0;i&lt;nChildren;++i )
-        {
-            char *wname;
-            if ( XFetchName ( QX11Info::display(),
-                              child_list[i],&amp;wname ) )
-            {
-                QString title ( wname );
-                XFree ( wname );
-                if ( title==text )
-                {
-                    proxyId=child_list[i];
-                    break;
-                }
-            }
-            proxyId=X11FindWindow ( text, child_list[i] );
-            if ( proxyId )
-                break;
-        }
-        XFree ( child_list );
-    }
-    return proxyId;
-}
-#endif
-
-long ONMainWindow::findWindow ( QString text )
-{
-#ifdef Q_OS_LINUX
-    return X11FindWindow ( text );
-#endif
-#ifdef Q_OS_WIN
-    return ( long ) wapiFindWindow ( 0,text.utf16() );
-#endif
-}
-
-//////////////////////////plugin stuff//////////////
-
-#ifdef CFGPLUGIN
-void ONMainWindow::setX2goconfig ( const QString&amp; text )
-{
-    m_x2goconfig=text;
-    x2goDebug&lt;&lt;&quot;have session config&quot;;
-    initWidgetsEmbed();
-}
-
-void ONMainWindow::doPluginInit()
-{
-#ifdef Q_OS_LINUX
-    Dl_info info;
-    dladdr ( ( void* ) &amp; ( ONMainWindow::getPortable ),&amp;info );
-    QString fname=info.dli_fname;
-    x2goDebug&lt;&lt;&quot;Application name:&quot; &lt;&lt;fname;
-    QString clientDir;
-    QString pluginDir;
-    int pos=fname.lastIndexOf ( &quot;/&quot; );
-    pluginDir=fname.left ( pos );
-    x2goDebug&lt;&lt;&quot;Plugin Dir:&quot; &lt;&lt;pluginDir;
-    QDir dr ( pluginDir );
-    if ( dr.exists ( &quot;x2goclient/x2goclient&quot; ) )
-    {
-        clientDir=pluginDir+&quot;/x2goclient&quot;;
-    }
-    else if ( dr.exists ( &quot;x2goclient&quot; ) )
-    {
-        clientDir=pluginDir;
-    }
-    else
-    {
-        dr.cdUp();
-        if ( dr.exists ( &quot;x2goclient/x2goclient&quot; ) )
-        {
-            clientDir=dr.absolutePath() +&quot;/x2goclient&quot;;
-        }
-        else if ( dr.exists ( &quot;x2goclient&quot; ) )
-        {
-            clientDir=dr.absolutePath();
-        }
-        else
-        {
-            clientDir=pluginDir;
-        }
-    }
-    x2goDebug&lt;&lt;&quot;Client Dir:&quot;&lt;&lt;clientDir;
-    QString path=getenv ( &quot;PATH&quot; );
-    path=clientDir+&quot;:&quot;+pluginDir+&quot;:&quot;+path;
-    setenv ( &quot;PATH&quot;,path.toAscii (),1 );
-
-    path=getenv ( &quot;LD_LIBRARY_PATH&quot; );
-    path=clientDir+&quot;:&quot;+pluginDir+&quot;:&quot;+path;
-    setenv ( &quot;LD_LIBRARY_PATH&quot;,path.toAscii () ,1 );
-
-    setenv ( &quot;X2GO_LIB&quot;,clientDir.toAscii () ,1 );
-
-    QFile::setPermissions (
-        clientDir+&quot;/x2goclient&quot;,
-        QFile::ReadOwner|QFile::WriteOwner|QFile::ExeOwner|
-        QFile::ReadGroup|QFile::WriteGroup|QFile::ExeGroup|
-        QFile::ReadOther|QFile::WriteOther|QFile::ExeOther );
-    QFile::setPermissions (
-        clientDir+&quot;/nxproxy&quot;,
-        QFile::ReadOwner|QFile::WriteOwner|QFile::ExeOwner|
-        QFile::ReadGroup|QFile::WriteGroup|QFile::ExeGroup|
-        QFile::ReadOther|QFile::WriteOther|QFile::ExeOther );
-    QFile::setPermissions (
-        clientDir+&quot;/sshd&quot;,
-        QFile::ReadOwner|QFile::WriteOwner|QFile::ExeOwner|
-        QFile::ReadGroup|QFile::WriteGroup|QFile::ExeGroup|
-        QFile::ReadOther|QFile::WriteOther|QFile::ExeOther );
-    QFile::setPermissions (
-        clientDir+&quot;/sftp-server&quot;,
-        QFile::ReadOwner|QFile::WriteOwner|QFile::ExeOwner|
-        QFile::ReadGroup|QFile::WriteGroup|QFile::ExeGroup|
-        QFile::ReadOther|QFile::WriteOther|QFile::ExeOther );
-
-#endif
-}
-
-
-#ifndef Q_OS_DARWIN
-
-
-QSize ONMainWindow::getWindowSize ( long winId )
-{
-
-#ifdef Q_OS_LINUX
-    XWindowAttributes atr;
-    if ( XGetWindowAttributes ( QX11Info::display(),winId,&amp;atr ) )
-        return QSize ( atr.width,atr.height );
-    return QSize ( 0,0 );
-#endif
-#ifdef Q_OS_WIN
-    QRect rec;
-    if ( wapiClientRect ( ( HWND ) winId,rec ) )
-        return rec.size();
-    else
-        return QSize ( 0,0 );
-#endif
-}
-
-#ifdef Q_OS_WIN
-void ONMainWindow::slotUpdateEmbedWindow()
-{
-    if ( oldContainerSize!=embedContainer-&gt;size() ||
-            oldChildPos!= mapToGlobal (
-                QPoint ( 0,0 ) ) )
-    {
-        QRect geom=embedContainer-&gt;geometry();
-        if ( gcor==1 )
-            gcor=0;
-        else
-            gcor=1;
-        geom.setWidth ( geom.width()-gcor );
-        wapiSetFSWindow ( ( HWND ) childId,
-                          geom );
-        wapiUpdateWindow ( ( HWND ) childId );
-        oldContainerSize=embedContainer-&gt;size();
-        oldChildPos= mapToGlobal (
-                         QPoint ( 0,0 ) );
-        x2goDebug&lt;&lt;&quot;updating embedded window&quot;&lt;&lt;endl;
-    }
-}
-
-#endif
-
-
-
-void ONMainWindow::embedWindow ( long wndId )
-{
-    childId=wndId;
-    embedContainer-&gt;show();
-#ifdef Q_OS_LINUX
-    x2goDebug&lt;&lt;&quot;embedding &quot;&lt;&lt;wndId&lt;&lt;&quot; in container&quot;&lt;&lt;endl;
-    embedContainer-&gt;embedClient ( wndId );
-#endif
-#ifdef Q_OS_WIN
-    wapiSetParent ( ( HWND ) childId,
-                    ( HWND ) ( embedContainer-&gt;winId() ) );
-    oldContainerSize=embedContainer-&gt;size();
-    oldChildPos= ( mapToGlobal ( QPoint ( 0,0 ) ));
-    winFlags=wapiSetFSWindow ( ( HWND ) childId,
-                               embedContainer-&gt;geometry() );
-    updateTimer-&gt;start ( 500 );
-
-#endif
-}
-
-
-void ONMainWindow::detachClient()
-{
-    if ( !childId )
-        return;
-#ifdef Q_OS_LINUX
-    if ( embedContainer )
-    {
-        embedContainer-&gt;discardClient();
-    }
-#endif
-#ifdef Q_OS_WIN
-    wapiSetParent ( ( HWND ) childId, ( HWND ) 0 );
-    slotDetachProxyWindow();
-    updateTimer-&gt;stop();
-    if ( childId )
-    {
-        wapiRestoreWindow ( ( HWND ) childId, winFlags,
-                            embedContainer-&gt;geometry() );
-        wapiMoveWindow ( ( HWND ) childId,0,0,
-                         oldContainerSize.width(),
-                         oldContainerSize.height(),true );
-
-    }
-#endif
-    childId=0;
-}
-
-#endif //(Q_OS_DARWIN)
-
-
-
-
-
-QTNPFACTORY_BEGIN ( &quot;X2GoClient Plug-in &quot;VERSION,
-                    &quot;Allows you to start X2Go session in a webbrowser&quot; )
-QTNPCLASS ( ONMainWindow )
-QTNPFACTORY_END()
-
-#ifdef QAXSERVER
-#include &lt;ActiveQt/QAxFactory&gt;
-QAXFACTORY_BEGIN ( &quot;{aa3216bf-7e20-482c-84c6-06167bacb616}&quot;, &quot;{08538ca5-eb7a-4f24-a3c4-a120c6e04dc4}&quot; )
-QAXCLASS ( ONMainWindow )
-QAXFACTORY_END()
-#endif
-#endif
diff --git a/onmainwindow_privat.h b/onmainwindow_privat.h
index 33a8bc4..1d6266d 100644
--- a/onmainwindow_privat.h
+++ b/onmainwindow_privat.h
@@ -144,6 +144,7 @@
 
 #ifdef Q_OS_WIN
 #include &quot;wapi.h&quot;
+#include &lt;QHostInfo&gt;
 #endif
 
 #ifdef Q_OS_LINUX
diff --git a/resources.rcc b/resources.rcc
index 4263b23..3953a75 100644
--- a/resources.rcc
+++ b/resources.rcc
@@ -54,6 +54,7 @@
        &lt;file&gt;icons/16x16/delete.png&lt;/file&gt;
        &lt;file&gt;icons/16x16/edit.png&lt;/file&gt;
        &lt;file&gt;icons/16x16/gnome.png&lt;/file&gt;
+       &lt;file&gt;icons/16x16/unity.png&lt;/file&gt;
        &lt;file&gt;icons/16x16/kde.png&lt;/file&gt;
        &lt;file&gt;icons/16x16/new_file.png&lt;/file&gt;
        &lt;file&gt;icons/16x16/resolution.png&lt;/file&gt;
diff --git a/sessionbutton.cpp b/sessionbutton.cpp
index 63be020..f53d82a 100644
--- a/sessionbutton.cpp
+++ b/sessionbutton.cpp
@@ -337,6 +337,7 @@ void SessionButton::redraw()
     cmdBox-&gt;addItem ( &quot;KDE&quot; );
     cmdBox-&gt;addItem ( &quot;GNOME&quot; );
     cmdBox-&gt;addItem ( &quot;LXDE&quot; );
+    cmdBox-&gt;addItem ( &quot;UNITY&quot; );
     cmdBox-&gt;addItem ( tr ( &quot;RDP connection&quot; ) );
     cmdBox-&gt;addItem ( tr ( &quot;XDMCP&quot; ) );
     cmdBox-&gt;addItem ( tr ( &quot;Connection to local desktop&quot; ) );
@@ -355,6 +356,11 @@ void SessionButton::redraw()
         cmdpix.load ( par-&gt;iconsPath ( &quot;/16x16/gnome.png&quot; ) );
         cmdBox-&gt;setCurrentIndex ( GNOME );
     }
+    else if ( command ==&quot;UNITY&quot; )
+    {
+        cmdpix.load ( par-&gt;iconsPath ( &quot;/16x16/unity.png&quot; ) );
+        cmdBox-&gt;setCurrentIndex ( UNITY );
+    }
     else if ( command ==&quot;LXDE&quot; )
     {
         cmdpix.load ( par-&gt;iconsPath ( &quot;/16x16/lxde.png&quot; ) );
@@ -631,6 +637,11 @@ void SessionButton::slot_cmd_change ( const QString&amp; command )
         newRootless=false;
         pix.load ( par-&gt;iconsPath ( &quot;/16x16/lxde.png&quot; ) );
     }
+    else if ( command ==&quot;UNITY&quot; )
+    {
+        newRootless=false;
+        pix.load ( par-&gt;iconsPath ( &quot;/16x16/unity.png&quot; ) );
+    }
     else if ( command ==tr ( &quot;Connection to local desktop&quot; ) )
     {
         newRootless=false;
@@ -669,6 +680,11 @@ void SessionButton::slot_cmd_change ( const QString&amp; command )
         cmd=&quot;LXDE&quot;;
         newRootless=false;
     }
+    if ( command==&quot;unity&quot; )
+    {
+        cmd=&quot;UNITY&quot;;
+        newRootless=false;
+    }
     if (command== tr(&quot;Published applications&quot;))
     {
         published=true;
diff --git a/sessionbutton.h b/sessionbutton.h
index a12aaf6..c5eea1e 100644
--- a/sessionbutton.h
+++ b/sessionbutton.h
@@ -26,7 +26,7 @@ class SessionButton : public SVGFrame
 {
     Q_OBJECT
 public:
-    enum {KDE,GNOME,LXDE,RDP,XDMCP,SHADOW,PUBLISHED,OTHER,APPLICATION};
+    enum {KDE,GNOME,UNITY,LXDE,RDP,XDMCP,SHADOW,PUBLISHED,OTHER,APPLICATION};
     SessionButton ( ONMainWindow* mw, QWidget* parent,QString id );
     ~SessionButton();
     QString id() {
diff --git a/sessionwidget.cpp b/sessionwidget.cpp
index 6e12843..2f66aa2 100644
--- a/sessionwidget.cpp
+++ b/sessionwidget.cpp
@@ -124,6 +124,7 @@ SessionWidget::SessionWidget ( QString id, ONMainWindow * mw,
     sessBox-&gt;addItem ( &quot;KDE&quot; );
     sessBox-&gt;addItem ( &quot;GNOME&quot; );
     sessBox-&gt;addItem ( &quot;LXDE&quot; );
+    sessBox-&gt;addItem ( &quot;UNITY&quot; );
     sessBox-&gt;addItem ( tr ( &quot;Connect to Windows terminal server&quot; ) );
     sessBox-&gt;addItem ( tr ( &quot;XDMCP&quot; ) );
     sessBox-&gt;addItem ( tr ( &quot;Connect to local desktop&quot; ) );
@@ -391,6 +392,11 @@ void SessionWidget::readConfig()
             sessBox-&gt;setCurrentIndex ( LXDE );
             cmd-&gt;setEnabled ( false );
         }
+        else if ( command==&quot;UNITY&quot; )
+        {
+            sessBox-&gt;setCurrentIndex ( UNITY );
+            cmd-&gt;setEnabled ( false );
+        }
         else if ( command==&quot;SHADOW&quot; )
         {
             sessBox-&gt;setCurrentIndex ( SHADOW );
diff --git a/sessionwidget.h b/sessionwidget.h
index 5dd0bd4..869d9bb 100644
--- a/sessionwidget.h
+++ b/sessionwidget.h
@@ -40,7 +40,7 @@ private slots:
     void slot_rdpOptions();
 
 private:
-    enum {KDE,GNOME,LXDE,RDP,XDMCP,SHADOW,OTHER,APPLICATION,PUBLISHED};
+    enum {KDE,GNOME,LXDE,UNITY,RDP,XDMCP,SHADOW,OTHER,APPLICATION,PUBLISHED};
     QLineEdit* sessName;
     QLineEdit* uname;
     QLineEdit* server;
diff --git a/sshmasterconnection.cpp b/sshmasterconnection.cpp
index 1f7b724..9eba130 100644
--- a/sshmasterconnection.cpp
+++ b/sshmasterconnection.cpp
@@ -1,7 +1,7 @@
 
 /***************************************************************************
- *   Copyright (C) 2005-2012 by Oleksandr Shneyder   *
- *   <A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">oleksandr.shneyder at obviously-nice.de</A>   *
+ *   Copyright (C) 2005-2012 by Oleksandr Shneyder                         *
+ *   <A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">oleksandr.shneyder at obviously-nice.de</A>                                  *
  *                                                                         *
  *   This program is free software; you can redistribute it and/or modify  *
  *   it under the terms of the GNU General Public License as published by  *
@@ -46,6 +46,9 @@
 #undef DEBUG
 //#define DEBUG
 
+//#define SSH_DEBUG
+#undef SSH_DEBUG
+
 static bool isLibSshInited=false;
 
 
@@ -142,7 +145,12 @@ void SshMasterConnection::run()
     }
 #endif
 
-//     int verbosity=SSH_LOG_PROTOCOL;
+#ifdef SSH_DEBUG
+    int verbosity=SSH_LOG_PACKET;
+#else
+    int verbosity=SSH_LOG_NOLOG;
+#endif
+
     long timeout = 60;
 
     my_ssh_session = ssh_new();
@@ -159,7 +167,7 @@ void SshMasterConnection::run()
 #ifdef Q_OS_WIN
     ssh_options_set ( my_ssh_session, SSH_OPTIONS_SSH_DIR, (mainWnd-&gt;getHomeDirectory()+&quot;/ssh&quot;).toAscii());
 #endif
-//     ssh_options_set(my_ssh_session, SSH_OPTIONS_LOG_VERBOSITY, &amp;verbosity);
+    ssh_options_set(my_ssh_session, SSH_OPTIONS_LOG_VERBOSITY, &amp;verbosity);
 
     ssh_options_set(my_ssh_session, SSH_OPTIONS_TIMEOUT, &amp;timeout);
 
@@ -277,7 +285,8 @@ void SshMasterConnection::finalizeLibSsh()
 bool SshMasterConnection::sshConnect()
 {
     int rc;
-    ssh_options_set ( my_ssh_session, SSH_OPTIONS_HOST, host.toAscii() );
+    QByteArray tmpBA = host.toLocal8Bit();
+    ssh_options_set ( my_ssh_session, SSH_OPTIONS_HOST, tmpBA.data() );
     ssh_options_set ( my_ssh_session, SSH_OPTIONS_PORT, &amp;port );
     rc = ssh_connect ( my_ssh_session );
     if ( rc != SSH_OK )
diff --git a/svg/unity.svg b/svg/unity.svg
new file mode 100644
index 0000000..5c1f9cf
--- /dev/null
+++ b/svg/unity.svg
@@ -0,0 +1,8 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;
+&lt;!-- Created with Inkscape (<A HREF="http://www.inkscape.org/">http://www.inkscape.org/</A>) --&gt;
+&lt;!DOCTYPE svg PUBLIC &quot;-//W3C//DTD SVG 1.1//EN&quot; &quot;<A HREF="http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd</A>&quot;&gt;
+&lt;svg xmlns:dc=&quot;<A HREF="http://purl.org/dc/elements/1.1/">http://purl.org/dc/elements/1.1/</A>&quot; xmlns:cc=&quot;<A HREF="http://creativecommons.org/ns#">http://creativecommons.org/ns#</A>&quot; xmlns:rdf=&quot;<A HREF="http://www.w3.org/1999/02/22-rdf-syntax-ns#">http://www.w3.org/1999/02/22-rdf-syntax-ns#</A>&quot; xmlns:svg=&quot;<A HREF="http://www.w3.org/2000/svg">http://www.w3.org/2000/svg</A>&quot; xmlns=&quot;<A HREF="http://www.w3.org/2000/svg">http://www.w3.org/2000/svg</A>&quot; version=&quot;1.1&quot; width=&quot;60.513618&quot; height=&quot;60.513618&quot; id=&quot;svg3036&quot; style=&quot;display:inline&quot;&gt;
+ &lt;g transform=&quot;translate(-1.7431908,-1.4941635)&quot; id=&quot;layer1&quot; style=&quot;display:inline&quot;&gt;
+  &lt;path d=&quot;M 30.25,0 C 13.539626,0 0,13.539626 0,30.25 0,46.960374 13.539626,60.5 30.25,60.5 46.960374,60.5 60.5,46.960374 60.5,30.25 c 0,-2.078212 -0.194675,-4.102133 -0.59375,-6.0625 -0.304345,1.200557 -0.637476,2.348209 -1,3.46875 -0.410672,1.260002 -0.836505,2.461168 -1.3125,3.5625 -0.186671,0.419999 -0.388421,0.763832 -0.59375,1.0625 -0.196003,0.307998 -0.413587,0.553998 -0.65625,0.75 -0.242669,0.195998 -0.535753,0.344164 -0.84375,0.4375 -0.298669,0.09333 -0.617335,0.156247 -1,0.15625 -0.102668,-3e-6 -0.231751,-0.01259 -0.34375,-0.03125 -0.112001,-0.0093 -0.200501,-0.0345 -0.3125,-0.0625 -0.102667,-0.01867 -0.219167,-0.0345 -0.3125,-0.0625 -0.084,-0.028 -0.150167,-0.04384 -0.1875,-0.0625 l 0.25,-1.0625 c 0.102666,0.04666 0.247583,0.08767 0.40625,0.125 0.167999,0.04666 0.310082,0.0625 0.46875,0.0625 0.513332,-2e-6 0.929415,-0.110418 1.21875,-0.34375 0.289331,-0.224001 0.547914,-0.580417 0.78125,-1.09375 -0.588003,-1.119999 -1.142919,-2.311831 -1.65625,-3.5625 -0.504001,-
 1.259995 -0.914001,-2.524494 -1.25,-3.8125 l 1.375,0 c 0.102665,0.420007 0.234998,0.858423 0.375,1.34375 0.149331,0.485339 0.322664,0.986672 0.5,1.5 0.177331,0.513337 0.357164,1.01792 0.5625,1.53125 0.20533,0.513336 0.432246,1.024002 0.65625,1.5 0.354663,-0.979998 0.644912,-1.944913 0.90625,-2.90625 0.261328,-0.961328 0.516662,-1.95141 0.75,-2.96875 l 1.125,0 C 56.82527,10.149634 44.716711,0 30.25,0 z m 29.5625,23.71875 c 0.03198,0.145258 0.06387,0.291467 0.09375,0.4375 0.03784,-0.149571 0.08807,-0.286689 0.125,-0.4375 l -0.21875,0 z M 45.78125,20.6875 c 0.233331,10e-6 0.435081,0.06009 0.59375,0.21875 0.167997,0.149343 0.249997,0.363676 0.25,0.625 -3e-6,0.261343 -0.082,0.466342 -0.25,0.625 -0.158669,0.149342 -0.360419,0.218759 -0.59375,0.21875 -0.233335,9e-6 -0.425751,-0.06941 -0.59375,-0.21875 -0.158668,-0.158658 -0.218751,-0.363657 -0.21875,-0.625 -10e-7,-0.261324 0.06008,-0.475657 0.21875,-0.625 0.167999,-0.158656 0.360415,-0.21874 0.59375,-0.21875 z m 4.1875,0.75 0,2.281
 25 2.78125,0 0,1.09375 -2.78125,0 0,3.34375 c -2e-6,0.364002 0.03775,0.663585 0.09375,0.90625 0.056,0.233335 0.137997,0.422501 0.25,0.5625 0.111997,0.130668 0.269497,0.225251 0.4375,0.28125 0.167997,0.056 0.338497,0.09375 0.5625,0.09375 0.391996,1e-6 0.704162,-0.041 0.9375,-0.125 0.242662,-0.09333 0.406662,-0.181415 0.5,-0.21875 L 53.03125,30.75 c -0.130672,0.06533 -0.360838,0.156667 -0.6875,0.25 -0.326671,0.102667 -0.705004,0.125 -1.125,0.125 -0.49467,0 -0.923336,-0.03492 -1.25,-0.15625 C 49.651415,30.838083 49.414748,30.627 49.21875,30.375 49.022749,30.123001 48.865249,29.832751 48.78125,29.46875 48.70658,29.095419 48.6875,28.672836 48.6875,28.1875 l 0,-6.5 1.28125,-0.25 z m -38.9375,1.90625 5.1875,0 0,15.25 c -9e-6,3.546677 0.56749,6.063091 1.6875,7.59375 1.119988,1.530671 3.005569,2.312504 5.65625,2.3125 0.559983,4e-6 1.152649,-0.02516 1.75,-0.0625 0.597314,-0.03733 1.164814,-0.08766 1.6875,-0.125 0.522646,-0.07466 0.964312,-0.118912 1.375,-0.15625 0.447978,-0.07466 0.78
 2061,-0.144079 0.96875,-0.21875 l 0,-24.59375 5.1875,0 0,28.28125 c -1.194693,0.298667 -2.771358,0.63275 -4.75,0.96875 -1.941354,0.336 -4.205269,0.499999 -6.78125,0.5 -2.240014,-10e-7 -4.125595,-0.334084 -5.65625,-0.96875 -1.530676,-0.671999 -2.754174,-1.586581 -3.6875,-2.78125 -0.933339,-1.194662 -1.589339,-2.613411 -2,-4.21875 -0.410671,-1.642658 -0.625004,-3.458823 -0.625,-5.4375 l 0,-16.34375 z m 28.9375,0.21875 c 0.578662,7e-6 1.054828,0.08201 1.4375,0.25 0.382661,0.158674 0.682244,0.38884 0.90625,0.6875 0.233327,0.28934 0.40666,0.620589 0.5,1.03125 0.09333,0.410672 0.124993,0.880338 0.125,1.375 l 0,4.09375 -1.3125,0 0,-3.8125 c -6e-6,-0.447996 -0.02842,-0.838912 -0.09375,-1.15625 C 41.475244,25.713922 41.389995,25.446006 41.25,25.25 c -0.140005,-0.195994 -0.329172,-0.322244 -0.5625,-0.40625 -0.233338,-0.09333 -0.529671,-0.156244 -0.875,-0.15625 -0.140004,6e-6 -0.28817,0.02192 -0.4375,0.03125 -0.149337,0.0093 -0.297503,0.01259 -0.4375,0.03125 -0.13067,0.0093 -0.231753,0
 .04384 -0.34375,0.0625 -0.102669,0.01867 -0.172086,0.02192 -0.21875,0.03125 l 0,6.15625 -1.3125,0 0,-7.09375 c 0.298665,-0.07466 0.692831,-0.134743 1.1875,-0.21875 0.494664,-0.08399 1.074747,-0.124993 1.71875,-0.125 z m 5.1875,0.15625 1.3125,0 0,7.28125 -1.3125,0 0,-7.28125 z&quot; transform=&quot;translate(1.7431908,1.4941635)&quot; id=&quot;path3047&quot; style=&quot;fill:#982e6f;fill-opacity:1;stroke:none&quot; /&gt;
+ &lt;/g&gt;
+&lt;/svg&gt;
diff --git a/version.h b/version.h
index bae887b..2ca866f 100644
--- a/version.h
+++ b/version.h
@@ -1 +1,2 @@
-#define VERSION &quot;3.99.2.0&quot;
+#define VERSION &quot;3.99.2.1&quot;
+
diff --git a/x2goclient.pro b/x2goclient.pro
index 8e5ea80..e831f5b 100755
--- a/x2goclient.pro
+++ b/x2goclient.pro
@@ -76,9 +76,6 @@ SOURCES += sharewidget.cpp \
            imgframe.cpp \
            LDAPSession.cpp \
            onmainwindow.cpp \
-           onmainwindow_part2.cpp \
-           onmainwindow_part3.cpp \
-           onmainwindow_part4.cpp \
            sessionbutton.cpp \
            sessionmanagedialog.cpp \
            sshmasterconnection.cpp \
@@ -108,7 +105,7 @@ LIBS += -lssh
 plugin {
 	TARGET = x2goplugin
 }
-else{
+else {
 	RC_FILE = x2goclient.rc
 	SOURCES += x2goclient.cpp
 	TARGET = x2goclient
@@ -116,6 +113,24 @@ else{
 	message(if you want to build x2goplugin you should export X2GO_CLIENT_TARGET=plugin)
 }
 
+!isEmpty(TRANSLATIONS) {
+  isEmpty(QMAKE_LRELEASE) {
+    win32:QMAKE_LRELEASE = $$[QT_INSTALL_BINS]\lrelease.exe
+    else:QMAKE_LRELEASE = $$[QT_INSTALL_BINS]/lrelease
+  }
+
+  isEmpty(TS_DIR):TS_DIR = .
+
+  TSQM.name = lrelease ${QMAKE_FILE_IN}
+  TSQM.input = TRANSLATIONS
+  TSQM.output = $$TS_DIR/${QMAKE_FILE_BASE}.qm
+  TSQM.commands = $$QMAKE_LRELEASE ${QMAKE_FILE_IN}
+  TSQM.CONFIG = no_link
+  QMAKE_EXTRA_COMPILERS += TSQM
+  PRE_TARGETDEPS += compiler_TSQM_make_all
+}
+else:message(No translation files in project)
+
 TEMPLATE = app
 DEPENDPATH += .
 INCLUDEPATH += .
@@ -139,7 +154,7 @@ x2go_linux_static {
 macx {
 	message(building $$TARGET with ldap and cups)
 	LIBS += -framework LDAP -lcups -lcrypto -lssl -lz
-	CONFIG += x86 x86_64
+	CONFIG += x86 x86_64 ppc
 }
 win32-* {
 	message(building $$TARGET for windows without ldap and cups)
@@ -147,12 +162,12 @@ win32-* {
 	CONFIG += static release
 }
 QT += svg network
-ICON =icons/x2go-mac.icns
+ICON = icons/x2go-mac.icns
+QMAKE_INFO_PLIST = Info.plist
 QMAKE_MAC_SDK = /Developer/SDKs/MacOSX10.5.sdk
 QMAKE_MACOSX_DEPLOYMENT_TARGET = 10.5
 
-plugin{
-
+plugin {
 	DEFINES += CFGPLUGIN
 	linux-g++ {
 		include(qtbrowserplugin-2.4_1-opensource/src/qtbrowserplugin.pri)
@@ -164,7 +179,6 @@ plugin{
 		DEFINES += QT_NODLL
 		CONFIG += qaxserver
 		include(qtbrowserplugin-2.4_1-opensource/src/qtbrowserplugin.pri)
-		}
+	}
 	RC_FILE = x2goplugin.rc
-
 }
diff --git a/x2goclient_de.ts b/x2goclient_de.ts
index 4fa81da..8dccd18 100644
--- a/x2goclient_de.ts
+++ b/x2goclient_de.ts
@@ -6,77 +6,77 @@
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.ui&quot; line=&quot;14&quot;/&gt;
         &lt;source&gt;Published Applications&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Ver&#195;&#182;ffentlichte Anwendungen&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.ui&quot; line=&quot;60&quot;/&gt;
         &lt;source&gt;Search:&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Suche:&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.ui&quot; line=&quot;76&quot;/&gt;
         &lt;source&gt;&amp;Start&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;&amp;Starten&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.ui&quot; line=&quot;96&quot;/&gt;
         &lt;source&gt;&amp;Close&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;S&amp;chlie&#195;&#159;en&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.cpp&quot; line=&quot;105&quot;/&gt;
         &lt;source&gt;Multimedia&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Unterhaltungsmedien&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.cpp&quot; line=&quot;110&quot;/&gt;
         &lt;source&gt;Development&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Entwicklung&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.cpp&quot; line=&quot;115&quot;/&gt;
         &lt;source&gt;Education&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Bildung&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.cpp&quot; line=&quot;120&quot;/&gt;
         &lt;source&gt;Game&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Spiele&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.cpp&quot; line=&quot;125&quot;/&gt;
         &lt;source&gt;Graphics&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Grafik&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.cpp&quot; line=&quot;130&quot;/&gt;
         &lt;source&gt;Network&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Internet&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.cpp&quot; line=&quot;135&quot;/&gt;
         &lt;source&gt;Office&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;B&#195;&#188;roprogramme&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.cpp&quot; line=&quot;140&quot;/&gt;
         &lt;source&gt;Settings&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;Konfiguration&lt;/translation&gt;
+        &lt;translation&gt;Einstellungen&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.cpp&quot; line=&quot;145&quot;/&gt;
         &lt;source&gt;System&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Systemwerkzeuge&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.cpp&quot; line=&quot;150&quot;/&gt;
         &lt;source&gt;Utility&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Dienstprogramme&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.cpp&quot; line=&quot;155&quot;/&gt;
         &lt;source&gt;Other&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Sonstige&lt;/translation&gt;
     &lt;/message&gt;
 &lt;/context&gt;
 &lt;context&gt;
@@ -1011,7 +1011,7 @@ sound system connections through firewalls&lt;/source&gt;
         &lt;location filename=&quot;httpbrokerclient.cpp&quot; line=&quot;467&quot;/&gt;
         &lt;source&gt;Issued to:
 &lt;/source&gt;
-        &lt;translation&gt;Issued to:&#239;&#191;&#188;
+        &lt;translation&gt;Ausgestellt f&#195;&#188;r:&#239;&#191;&#188;
 &lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
@@ -1041,7 +1041,7 @@ sound system connections through firewalls&lt;/source&gt;
         &lt;location filename=&quot;httpbrokerclient.cpp&quot; line=&quot;479&quot;/&gt;
         &lt;source&gt;Issued by:
 &lt;/source&gt;
-        &lt;translation&gt;Issued by:&#239;&#191;&#188;
+        &lt;translation&gt;Ausgestellt von:&#239;&#191;&#188;
 &lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
@@ -1065,7 +1065,7 @@ sound system connections through firewalls&lt;/source&gt;
         &lt;location filename=&quot;httpbrokerclient.cpp&quot; line=&quot;493&quot;/&gt;
         &lt;source&gt;Fingerprints:
 &lt;/source&gt;
-        &lt;translation&gt;Fingerprints:&#239;&#191;&#188;
+        &lt;translation&gt;Fingerabdr&#195;&#188;cke:&#239;&#191;&#188;
 &lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
@@ -1681,8 +1681,8 @@ sound system connections through firewalls&lt;/source&gt;
 Please check your settings&lt;/source&gt;
         &lt;oldsource&gt;Can&apos;t connect to X-Server
 Please check your settings&lt;/oldsource&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;Verbindung zu X-Server konnte nicht hergestellt werden
-&#195;&#156;berpr&#195;&#188;fen Sie Ihre Einstellungen&lt;/translation&gt;
+        &lt;translation&gt;Verbindung zu X-Server konnte nicht hergestellt werden
+Bitte &#195;&#188;berpr&#195;&#188;fen Sie Ihre Einstellungen&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;source&gt;Can&apos;t start X-Server&lt;/source&gt;
@@ -1968,7 +1968,8 @@ Public key hash: &lt;/source&gt;
         &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;2232&quot;/&gt;
         &lt;source&gt;Can&apos;t start X server
 Please check your settings&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;X-Server l&#195;&#164;sst sich nicht starten. 
+Bitte &#195;&#188;berpr&#195;&#188;fen Sie Ihre Installation&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;2434&quot;/&gt;
@@ -2020,57 +2021,57 @@ Bitte installieren sie eine neuere Version von x2goserver&lt;/translation&gt;
     &lt;message&gt;
         &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1005&quot;/&gt;
         &lt;source&gt;Multimedia&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Unterhaltungsmedien&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1007&quot;/&gt;
         &lt;source&gt;Development&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Entwicklung&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1009&quot;/&gt;
         &lt;source&gt;Education&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Bildung&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1011&quot;/&gt;
         &lt;source&gt;Game&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Spiele&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1013&quot;/&gt;
         &lt;source&gt;Graphics&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Grafik&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1015&quot;/&gt;
         &lt;source&gt;Network&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Internet&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1017&quot;/&gt;
         &lt;source&gt;Office&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;B&#195;&#188;roprogramme&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1019&quot;/&gt;
         &lt;source&gt;Settings&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;Konfiguration&lt;/translation&gt;
+        &lt;translation&gt;Einstellungen&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1021&quot;/&gt;
         &lt;source&gt;System&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Systemwerkzeuge&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1023&quot;/&gt;
         &lt;source&gt;Utility&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Dienstprogramme&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1025&quot;/&gt;
         &lt;source&gt;Other&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Sonstige&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1062&quot;/&gt;
@@ -2284,7 +2285,7 @@ Sie k&#195;&#182;nnen SSHD &#195;&#188;ber folgenden Befehl installieren:
     &lt;message&gt;
         &lt;location filename=&quot;printdialog.cpp&quot; line=&quot;54&quot;/&gt;
         &lt;source&gt;You&apos;ve deactivated the x2go client printing dialog.&lt;/source&gt;
-        &lt;translation&gt;Sie haben den clientseitigen Druckdialog deaktiviert&lt;/translation&gt;
+        &lt;translation&gt;Sie haben den clientseitigen Druckdialog deaktiviert.&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;printdialog.cpp&quot; line=&quot;56&quot;/&gt;
@@ -2513,7 +2514,7 @@ Beispiel:
         &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;371&quot;/&gt;
         &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;659&quot;/&gt;
         &lt;source&gt;Published applications&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Ver&#195;&#182;ffentlichte Anwendungen&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;395&quot;/&gt;
@@ -2751,7 +2752,7 @@ Beispiel:
     &lt;message&gt;
         &lt;location filename=&quot;sessionwidget.cpp&quot; line=&quot;132&quot;/&gt;
         &lt;source&gt;Published applications&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Ver&#195;&#182;ffentlichte Anwendungen&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;sessionwidget.cpp&quot; line=&quot;134&quot;/&gt;
@@ -2832,7 +2833,7 @@ Beispiel:
     &lt;message&gt;
         &lt;location filename=&quot;sessionwidget.cpp&quot; line=&quot;233&quot;/&gt;
         &lt;source&gt;x2goclient is running in portable mode. You should use a path on your usb device to be able to access your data whereever you are&lt;/source&gt;
-        &lt;translation&gt;x2goclient befindet sich im portablen Ausf&#195;&#188;hrungsmodus. Wenn Sie einen Pfad ausserhalb des USB Ger&#195;&#164;ts w&#195;&#164;hlen, k&#195;&#182;nnen sie auf die Daten nicht von &#195;&#188;berall aus zugreifen.&lt;/translation&gt;
+        &lt;translation&gt;x2goclient wird gerade als portable Anwendung ausgef&#195;&#188;hrt. Sie sollten einen Pfad auf dem USB-Medium w&#195;&#164;hlen, um von &#195;&#188;berall aus auf Ihre Daten zugreifen zu k&#195;&#182;nnen.&lt;/translation&gt;
     &lt;/message&gt;
 &lt;/context&gt;
 &lt;context&gt;
diff --git a/x2goclient_nb_no.ts b/x2goclient_nb_no.ts
index 3355193..c41b517 100644
--- a/x2goclient_nb_no.ts
+++ b/x2goclient_nb_no.ts
@@ -6,77 +6,77 @@
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.ui&quot; line=&quot;14&quot;/&gt;
         &lt;source&gt;Published Applications&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Publiserte applikasjoner&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.ui&quot; line=&quot;60&quot;/&gt;
         &lt;source&gt;Search:&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;S&#195;&#184;k:&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.ui&quot; line=&quot;76&quot;/&gt;
         &lt;source&gt;&amp;Start&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;&amp;Start&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.ui&quot; line=&quot;96&quot;/&gt;
         &lt;source&gt;&amp;Close&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;&amp;Lukk&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.cpp&quot; line=&quot;105&quot;/&gt;
         &lt;source&gt;Multimedia&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Multimedia&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.cpp&quot; line=&quot;110&quot;/&gt;
         &lt;source&gt;Development&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Utvikling&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.cpp&quot; line=&quot;115&quot;/&gt;
         &lt;source&gt;Education&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Oppl&#195;&#166;ring&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.cpp&quot; line=&quot;120&quot;/&gt;
         &lt;source&gt;Game&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Spill&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.cpp&quot; line=&quot;125&quot;/&gt;
         &lt;source&gt;Graphics&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Grafikk&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.cpp&quot; line=&quot;130&quot;/&gt;
         &lt;source&gt;Network&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.cpp&quot; line=&quot;135&quot;/&gt;
         &lt;source&gt;Office&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Kontor&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.cpp&quot; line=&quot;140&quot;/&gt;
         &lt;source&gt;Settings&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;Innstillinger&lt;/translation&gt;
+        &lt;translation&gt;Innstillinger&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.cpp&quot; line=&quot;145&quot;/&gt;
         &lt;source&gt;System&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;System&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.cpp&quot; line=&quot;150&quot;/&gt;
         &lt;source&gt;Utility&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Verkt&#195;&#184;y&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.cpp&quot; line=&quot;155&quot;/&gt;
         &lt;source&gt;Other&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Andre&lt;/translation&gt;
     &lt;/message&gt;
 &lt;/context&gt;
 &lt;context&gt;
@@ -733,42 +733,42 @@
 &lt;context&gt;
     &lt;name&gt;ONMainWindow&lt;/name&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;87&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;482&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;90&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;495&quot;/&gt;
         &lt;source&gt;us&lt;/source&gt;
         &lt;translation&gt;no&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;88&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;91&quot;/&gt;
         &lt;source&gt;pc105/us&lt;/source&gt;
         &lt;translation&gt;pc105/de&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;339&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;345&quot;/&gt;
         &lt;source&gt;Support ...&lt;/source&gt;
         &lt;translatorcomment&gt;Need to double-check this one&lt;/translatorcomment&gt;
         &lt;translation&gt;St&#195;&#184;tte ...&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;674&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1960&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1815&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;680&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1985&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1834&quot;/&gt;
         &lt;source&gt;Session:&lt;/source&gt;
         &lt;translation&gt;Sesjon:&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;726&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;732&quot;/&gt;
         &lt;source&gt;&amp;Quit&lt;/source&gt;
         &lt;translation&gt;&amp;Avslutt&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;727&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;733&quot;/&gt;
         &lt;source&gt;Ctrl+Q&lt;/source&gt;
         &lt;translation&gt;Ctrl+Q&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;728&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1051&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;734&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1055&quot;/&gt;
         &lt;source&gt;Quit&lt;/source&gt;
         &lt;translation&gt;Avslutt&lt;/translation&gt;
     &lt;/message&gt;
@@ -777,7 +777,7 @@
         &lt;translation type=&quot;obsolete&quot;&gt;&amp;Neue Sitzung ...&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;732&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;738&quot;/&gt;
         &lt;source&gt;Ctrl+N&lt;/source&gt;
         &lt;translation&gt;Ctrl+N&lt;/translation&gt;
     &lt;/message&gt;
@@ -786,7 +786,7 @@
         &lt;translation type=&quot;obsolete&quot;&gt;Sitzungsverwaltung...&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;738&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;744&quot;/&gt;
         &lt;source&gt;Ctrl+E&lt;/source&gt;
         &lt;translation&gt;Ctrl+E&lt;/translation&gt;
     &lt;/message&gt;
@@ -795,7 +795,7 @@
         &lt;translation type=&quot;obsolete&quot;&gt;LDAP &amp;Konfiguration ...&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2307&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2334&quot;/&gt;
         &lt;source&gt;Restore toolbar&lt;/source&gt;
         &lt;translation&gt;Gjenopprett verkt&#195;&#184;ylinjen&lt;/translation&gt;
     &lt;/message&gt;
@@ -804,185 +804,183 @@
         &lt;translation type=&quot;obsolete&quot;&gt;&#195;&#156;ber X2GO Client&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;781&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;787&quot;/&gt;
         &lt;source&gt;About Qt&lt;/source&gt;
         &lt;translation&gt;Om QT&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2520&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2522&quot;/&gt;
         &lt;source&gt;Session&lt;/source&gt;
         &lt;translation&gt;Sesjon&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;798&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;804&quot;/&gt;
         &lt;source&gt;Ctrl+Q&lt;/source&gt;
         &lt;comment&gt;exit&lt;/comment&gt;
         &lt;translation&gt;Ctrl+Q&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;804&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;810&quot;/&gt;
         &lt;source&gt;&amp;Session&lt;/source&gt;
         &lt;translation&gt;&amp;Sesjon&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;805&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;811&quot;/&gt;
         &lt;source&gt;&amp;Options&lt;/source&gt;
         &lt;translation&gt;&amp;Innstillinger&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;824&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;830&quot;/&gt;
         &lt;source&gt;&amp;Help&lt;/source&gt;
         &lt;translation&gt;&amp;Hjelp&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;1665&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;1672&quot;/&gt;
         &lt;source&gt;Password:&lt;/source&gt;
         &lt;translation&gt;Passord:&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;1666&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;1673&quot;/&gt;
         &lt;source&gt;Keyboard layout:&lt;/source&gt;
         &lt;translation&gt;Tastatur utseende:&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;1707&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;1714&quot;/&gt;
         &lt;source&gt;Ok&lt;/source&gt;
         &lt;translation&gt;Ok&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;1709&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2011&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2013&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;1716&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2038&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2040&quot;/&gt;
         &lt;source&gt;Cancel&lt;/source&gt;
         &lt;translation&gt;Avbryt&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;1850&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;1863&quot;/&gt;
         &lt;source&gt;Applications...&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Applikasjoner...&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2507&quot;/&gt;
         &lt;source&gt;Invalid reply from broker&lt;/source&gt;
         &lt;translatorcomment&gt;Need to update/create the Norwegian documentation to make clear what the &quot;megeleren&quot; actually is in this context.&lt;/translatorcomment&gt;
-        &lt;translation&gt;Ugyldig svar fra megleren&lt;/translation&gt;
-    &lt;/message&gt;
-    &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;884&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;912&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1635&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1664&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1672&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1818&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1845&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1848&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;2095&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;2318&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;2332&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;2345&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;2379&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;2424&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;307&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;484&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;493&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;802&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1263&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1324&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1375&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1408&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1452&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1855&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1881&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2018&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;228&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;264&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;946&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1027&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1271&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1399&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1452&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1758&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1760&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1990&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;2038&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;2066&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;2402&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;2417&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;2471&quot;/&gt;
+        &lt;translation type=&quot;obsolete&quot;&gt;Ugyldig svar fra megleren&lt;/translation&gt;
+    &lt;/message&gt;
+    &lt;message&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;890&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;918&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1660&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1689&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1697&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1843&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1870&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1873&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;2120&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;2343&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;2357&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;2370&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;2404&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;2449&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;309&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;486&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;495&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;804&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1265&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1326&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1377&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1410&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1454&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1857&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1883&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2020&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;225&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;261&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;965&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1046&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1290&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1418&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1471&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1777&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1779&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;2009&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;2057&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;2085&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;2421&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;2436&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;2490&quot;/&gt;
         &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;29&quot;/&gt;
         &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;54&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2235&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2506&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2262&quot;/&gt;
         &lt;source&gt;Error&lt;/source&gt;
         &lt;translation&gt;Feil&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;2551&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;80&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;2576&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;74&quot;/&gt;
         &lt;source&gt;KDE&lt;/source&gt;
         &lt;translation&gt;KDE&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;2625&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;2650&quot;/&gt;
         &lt;source&gt; on &lt;/source&gt;
         &lt;translation&gt; p&#195;&#165; &lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;863&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1953&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1808&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;1664&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;869&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1978&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1827&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;1671&quot;/&gt;
         &lt;source&gt;Login:&lt;/source&gt;
         &lt;translation&gt;Brukernavn:&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1033&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2007&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1035&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2034&quot;/&gt;
         &lt;source&gt;Select session:&lt;/source&gt;
         &lt;translation&gt;Velg sesjon:&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2009&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2036&quot;/&gt;
         &lt;source&gt;Resume&lt;/source&gt;
         &lt;translation&gt;Gjenoppta&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;552&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1036&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2260&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2016&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;558&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1037&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2262&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2043&quot;/&gt;
         &lt;source&gt;Suspend&lt;/source&gt;
         &lt;translatorcomment&gt;I disagree with the word &apos;Suspend&apos; here, if it was suspending then the session would be paused. As this is not the case, it&apos;s more like disconnect (and the counterpart: reconnect). I used the translation fro &apos;Disconnect&apos; here, and will research the possibility of changing the Suspend word to Disconnect also in the english translation.&lt;/translatorcomment&gt;
         &lt;translation&gt;Koble fra&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;555&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1037&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;1855&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2018&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;561&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1038&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;1883&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2045&quot;/&gt;
         &lt;source&gt;Terminate&lt;/source&gt;
         &lt;translatorcomment&gt;Need to revisit this word to see if the chosen one is *strong* enough&lt;/translatorcomment&gt;
         &lt;translation&gt;Avslutte&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2021&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2048&quot;/&gt;
         &lt;source&gt;New&lt;/source&gt;
         &lt;translation&gt;Ny&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2522&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2088&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2110&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2524&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2115&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2137&quot;/&gt;
         &lt;source&gt;Display&lt;/source&gt;
         &lt;translation&gt;Skjerm&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2090&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2117&quot;/&gt;
         &lt;source&gt;Status&lt;/source&gt;
         &lt;translation&gt;Status&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2096&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2123&quot;/&gt;
         &lt;source&gt;Server&lt;/source&gt;
         &lt;translation&gt;Server&lt;/translation&gt;
     &lt;/message&gt;
@@ -991,20 +989,20 @@
         &lt;translation type=&quot;obsolete&quot;&gt;Startzeit&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2101&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2128&quot;/&gt;
         &lt;source&gt;Client IP&lt;/source&gt;
         &lt;translation&gt;Klient IP&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1049&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1143&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2224&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1051&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1145&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2226&quot;/&gt;
         &lt;source&gt;running&lt;/source&gt;
         &lt;translation&gt;aktiv&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1051&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1336&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1053&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1338&quot;/&gt;
         &lt;source&gt;suspended&lt;/source&gt;
         &lt;translation&gt;Frakoblet&lt;/translation&gt;
     &lt;/message&gt;
@@ -1017,46 +1015,46 @@
         &lt;translation type=&quot;obsolete&quot;&gt;Datei kann nicht geschrieben werden:&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2045&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2047&quot;/&gt;
         &lt;source&gt;Unable to create SSL Tunnel:
 &lt;/source&gt;
         &lt;translation&gt;Klarer ikke &#195;&#165; opprette SSL tunnel:
 &lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1184&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1204&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2047&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2436&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1186&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1206&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2049&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2438&quot;/&gt;
         &lt;source&gt;Warning&lt;/source&gt;
         &lt;translation&gt;Advarsel&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;153&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;189&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2208&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;156&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;190&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2210&quot;/&gt;
         &lt;source&gt;connecting&lt;/source&gt;
         &lt;translation&gt;kobler til&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2216&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2218&quot;/&gt;
         &lt;source&gt;starting&lt;/source&gt;
         &lt;translation&gt;starter&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2218&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2220&quot;/&gt;
         &lt;source&gt;resuming&lt;/source&gt;
         &lt;translation&gt;gjenopptar&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2280&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2552&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2570&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2282&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2554&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2572&quot;/&gt;
         &lt;source&gt;Connection timeout, aborting&lt;/source&gt;
         &lt;translation&gt;Tilkoblingen tidsavbrutt, avbryter&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2281&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2283&quot;/&gt;
         &lt;source&gt;aborting&lt;/source&gt;
         &lt;translation&gt;Avbryter&lt;/translation&gt;
     &lt;/message&gt;
@@ -1065,7 +1063,7 @@
         &lt;translation type=&quot;obsolete&quot;&gt;&lt;b&gt;Sitzungs ID:&lt;br&gt;Server:&lt;br&gt;Login:&lt;br&gt;Display:&lt;br&gt;Startzeit:&lt;br&gt;Status:&lt;/b&gt;&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;1854&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;1876&quot;/&gt;
         &lt;source&gt;Abort&lt;/source&gt;
         &lt;translation&gt;Avbryt&lt;/translation&gt;
     &lt;/message&gt;
@@ -1074,78 +1072,78 @@
         &lt;translation type=&quot;obsolete&quot;&gt;Zeige Details&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;579&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;597&quot;/&gt;
         &lt;source&gt; (can&apos;t open file)&lt;/source&gt;
         &lt;translation&gt; (kan ikke &#195;&#165;pne filen)&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;590&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;600&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;610&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;608&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;618&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;628&quot;/&gt;
         &lt;source&gt; (file not exists)&lt;/source&gt;
         &lt;translation&gt; (filen finnes ikke)&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;634&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;652&quot;/&gt;
         &lt;source&gt; (directory not exists)&lt;/source&gt;
         &lt;translation&gt; (mappen finnes ikke)&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;662&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;680&quot;/&gt;
         &lt;source&gt;wrong value for argument&quot;--link&quot;&lt;/source&gt;
         &lt;translatorcomment&gt;Chose to use &apos;parameteren&apos; here, the direct translation is &apos;argument&apos;, but didn&apos;t fit in my opinion. The cmdline arguments, will they be translated as well?&lt;/translatorcomment&gt;
         &lt;translation&gt;ugyldig verdi for parameteren &quot;--link&quot;&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;680&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;698&quot;/&gt;
         &lt;source&gt;wrong value for argument&quot;--sound&quot;&lt;/source&gt;
         &lt;translation&gt;ugyldig verdi for parameteren &quot;--sound&quot;&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;697&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;708&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;715&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;726&quot;/&gt;
         &lt;source&gt;wrong value for argument&quot;--geometry&quot;&lt;/source&gt;
         &lt;translation&gt;ugyldig verdi for parameteren &quot;--geometry&quot;&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;726&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;744&quot;/&gt;
         &lt;source&gt;wrong value for argument&quot;--set-kbd&quot;&lt;/source&gt;
         &lt;translation&gt;ugyldig verdi for parameteren &quot;--set-kbd&quot;&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;743&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;761&quot;/&gt;
         &lt;source&gt;wrong value for argument&quot;--ldap&quot;&lt;/source&gt;
         &lt;translation&gt;ugyldig verdi for parameteren &quot;--ldap&quot;&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;838&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;856&quot;/&gt;
         &lt;source&gt;wrong value for argument&quot;--pack&quot;&lt;/source&gt;
         &lt;translation&gt;ugyldig verdi for parameteren &quot;--pack&quot;&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;846&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;849&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;864&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;867&quot;/&gt;
         &lt;source&gt;wrong parameter: &lt;/source&gt;
         &lt;translation&gt;ugyldig parameter: &lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;902&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;921&quot;/&gt;
         &lt;source&gt;Available pack methodes:&lt;/source&gt;
         &lt;translation&gt;Tilgjengelige pakkemetoder:&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1690&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1709&quot;/&gt;
         &lt;source&gt;Support&lt;/source&gt;
         &lt;translatorcomment&gt;Will have to revisit this one, not sure if it fits&lt;/translatorcomment&gt;
         &lt;translation&gt;St&#195;&#184;tte&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1695&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1714&quot;/&gt;
         &lt;source&gt;&lt;/b&gt;&lt;br&gt; (C. 2006-2012 &lt;b&gt;obviously nice&lt;/b&gt;: Oleksandr Shneyder, Heinz-Markus Graesing)&lt;br&gt;&lt;/source&gt;
         &lt;translation&gt;&lt;/b&gt;&lt;br&gt; (C. 2006-2012 &lt;b&gt;obviously nice&lt;/b&gt;: Oleksandr Shneyder, Heinz-Markus Graesing)&lt;br&gt;&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1761&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1780&quot;/&gt;
         &lt;source&gt;Please check LDAP Settings&lt;/source&gt;
         &lt;translation&gt;Vennligst sjekk LDAP innstillingene&lt;/translation&gt;
     &lt;/message&gt;
@@ -1158,15 +1156,15 @@
         &lt;translation type=&quot;obsolete&quot;&gt;Sind Sie sicher, dass Sie die Sitzung l&#195;&#182;schen wollen?&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;300&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1317&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1401&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1434&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;939&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1020&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1392&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1445&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;2395&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;302&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1319&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1403&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1436&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;958&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1039&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1411&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1464&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;2414&quot;/&gt;
         &lt;source&gt;&lt;b&gt;Connection failed&lt;/b&gt;
 &lt;/source&gt;
         &lt;translation&gt;&lt;b&gt;Tilkoblingen feilet&lt;/b&gt;
@@ -1177,23 +1175,23 @@
         &lt;translation type=&quot;obsolete&quot;&gt;es konnte kein Server gefunden werden&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2103&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2130&quot;/&gt;
         &lt;source&gt;Session ID&lt;/source&gt;
         &lt;translation&gt;Sesjons ID&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1281&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1283&quot;/&gt;
         &lt;source&gt;suspending&lt;/source&gt;
         &lt;translation&gt;Kobler fra&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1303&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1305&quot;/&gt;
         &lt;source&gt;terminating&lt;/source&gt;
         &lt;translation&gt;Avslutter&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;222&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;258&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;219&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;255&quot;/&gt;
         &lt;source&gt;&lt;b&gt;Connection failed&lt;/b&gt;
 :
 &lt;/source&gt;
@@ -1248,18 +1246,18 @@
         &lt;translation type=&quot;obsolete&quot;&gt;&lt;b&gt;X2Go Client V. 2.0.1&lt;/b&gt;&lt;br&gt; (C. 2006-2007 Oleksandr Shneyder, Heinz-Markus Graesing)&lt;br&gt;&lt;br&gt;Ein Client f&#195;&#188;r den Zugriff auf die serverbasierende Anwendungsumgebung X2Go. Mit Hilfe dieser Anwendung k&#195;&#182;nnen Sie Sitzungen eines X2Go Servers starten, stoppen, laufende Sitzungen fortf&#195;&#188;hren oder anhalten und verschiedene Sitzungskonfigurationen verwalten. Die Authentifizierung kann &#195;&#188;ber LDAP erfolgen und das Programm kann im Vollbildmodus (als Ersatz f&#195;&#188;r XDM) gestartet werden. Weitere Informationen erhalten SIe auf x2go.org.&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1437&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1439&quot;/&gt;
         &lt;source&gt;&lt;b&gt;Wrong Password!&lt;/b&gt;&lt;br&gt;&lt;br&gt;&lt;/source&gt;
         &lt;translatorcomment&gt;Should we actually tell that it&apos;s the password that&apos;s wrong? Isn&apos;t that considered bad practice in regards to security? I propose to use &quot;Wrong Username or Password!&quot; instead.&lt;/translatorcomment&gt;
         &lt;translation&gt;&lt;b&gt;Feil passord!&lt;/b&gt;&lt;br&gt;&lt;br&gt;&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;765&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;783&quot;/&gt;
         &lt;source&gt;wrong value for argument&quot;--ldap1&quot;&lt;/source&gt;
         &lt;translation&gt;ugyldig verdi for parameteren &quot;--ldap1&quot;&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;784&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;802&quot;/&gt;
         &lt;source&gt;wrong value for argument&quot;--ldap2&quot;&lt;/source&gt;
         &lt;translation&gt;ugyldig verdi for parameteren &quot;--ldap2&quot;&lt;/translation&gt;
     &lt;/message&gt;
@@ -1288,12 +1286,12 @@
         &lt;translation type=&quot;obsolete&quot;&gt;Usage: x2goclient [Options]			Options:			--help                           Print this message			--help-pack                      Print availabel pack methods			--no-menu                        Hide menu bar			--maximize                       Start maximized			--add-to-known-hosts             Add RSA key fingerprint to .ssh/known_hosts 			if authenticity of server can&apos;t be established			--ldap=&lt;host:port:dn&gt;            Start with LDAP Support. Example:			--ldap=ldapserver:389:o=organization,c=de			--ldap1=&lt;host:port&gt;              LDAP Failover Server #1 			--ldap2=&lt;host:port&gt;              LDAP Failover Server #2 			--command=&lt;cmd&gt;                  Set default command, default value &apos;KDE&apos;			--sound=&lt;0|1&gt;                    Enable sound, default value &apos;1&apos;			--geomerty=&lt;W&gt;x&lt;H&gt;|fullscreen    Set default geometry, default value &apos;800x600&apos;			--link=&lt;modem|isdn|adsl|wan
 |lan&gt; Set default link type, default &apos;lan&apos;			--pack=&lt;packmethod&gt;              Set default pack method, default &apos;16m-jpeg-9&apos;			--kbd-layout=&lt;layout&gt;            Set default keyboard layout, default &apos;us&apos;			--kbd-type=&lt;typed&gt;               Set default keyboard type, default &apos;pc105/us&apos;			--set-kbd=&lt;0|1&gt;                  Overwrite current keyboard settings, default &apos;0&apos;&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;2067&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;2086&quot;/&gt;
         &lt;source&gt;Unable to create file: &lt;/source&gt;
         &lt;translation&gt;Klarer ikke &#195;&#165; opprette filen: &lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1991&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;2010&quot;/&gt;
         &lt;source&gt;No valid card found&lt;/source&gt;
         &lt;translation&gt;Ingen gyldige kort ble funnet&lt;/translation&gt;
     &lt;/message&gt;
@@ -1302,14 +1300,14 @@
         &lt;translation type=&quot;obsolete&quot;&gt;Diese Karte ist dem X2Go System unbekannt&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;335&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;341&quot;/&gt;
         &lt;source&gt;&amp;Settings ...&lt;/source&gt;
         &lt;translatorcomment&gt;Need to revisit the keybindings in all the Norwegian strings to check for consistency and collisions&lt;/translatorcomment&gt;
         &lt;translation&gt;&amp;Innstillinger&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;897&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;923&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;916&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;942&quot;/&gt;
         &lt;source&gt;Options&lt;/source&gt;
         &lt;translatorcomment&gt;Hm.. Should we actually use different words here in Norwegian? Or could they mean the same? Need to check the UI first&lt;/translatorcomment&gt;
         &lt;translation&gt;Alternativer&lt;/translation&gt;
@@ -1323,12 +1321,12 @@
         &lt;translation type=&quot;obsolete&quot;&gt;Klarte ikke &#195;&#165; koble til X-Serveren&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;2231&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;2250&quot;/&gt;
         &lt;source&gt;Can&apos;t connect to X server
 Please check your settings&lt;/source&gt;
         &lt;oldsource&gt;Can&apos;t connect to X-Server
 Please check your settings&lt;/oldsource&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;Klarte ikke &#195;&#165; koble til X-Serveren
+        &lt;translation&gt;Klarte ikke &#195;&#165; koble til X-Serveren
 Vennligst sjekk innstillingene dine&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
@@ -1342,33 +1340,33 @@ Please check your settings&lt;/source&gt;
 Vennligst sjekk instillingene dine&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1185&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1205&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1187&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1207&quot;/&gt;
         &lt;source&gt;Your current color depth is different to the color depth of your x2go-session. This may cause problems reconnecting to this session and in most cases &lt;b&gt;you will loose the session&lt;/b&gt; and have to start a new one! It&apos;s highly recommended to change the color depth of your Display to &lt;/source&gt;
         &lt;translation&gt;Din n&#195;&#165;v&#195;&#166;rende fargedybde er forskjellig fra fargedybden i din x2go sesjon. Dette kan skape problemer ved gjenoppkobling til denne sesjonen, og i de fleste tilfellene &lt;b&gt;vil du miste hele sesjonen&lt;/b&gt;. og du m&#195;&#165; starte en ny en! Det er sterkt anbefalt &#195;&#165; endre fargedybden p&#195;&#165; skjemen din til &lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1193&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1195&quot;/&gt;
         &lt;source&gt;24 or 32&lt;/source&gt;
         &lt;translation&gt;24 eller 32&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1194&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1214&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1196&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1216&quot;/&gt;
         &lt;source&gt; bit and restart your X-server before you reconnect to this x2go-session.&lt;br&gt;Resume this session anyway?&lt;/source&gt;
         &lt;translation&gt; bit og deretter restarte X-Serveren f&#195;&#184;r du kobler til denne x2go sesjonen. &lt;br&gt;Gjenoppta denne sesjonen uansett?&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;122&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1197&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1217&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;123&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1199&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1219&quot;/&gt;
         &lt;source&gt;Yes&lt;/source&gt;
         &lt;translation&gt;Ja&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;122&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1198&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1218&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;123&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1200&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1220&quot;/&gt;
         &lt;source&gt;No&lt;/source&gt;
         &lt;translation&gt;Nei&lt;/translation&gt;
     &lt;/message&gt;
@@ -1385,42 +1383,42 @@ Vennligst sjekk instillingene dine&lt;/translation&gt;
         &lt;translation type=&quot;obsolete&quot;&gt;&lt;/b&gt;&lt;br&gt; (C. 2006-2008 &lt;b&gt;obviously nice&lt;/b&gt;: Oleksandr Shneyder, Heinz-Markus Graesing)&lt;br&gt;&lt;br&gt;Ein Client f&#195;&#188;r den Zugriff auf die serverbasierende Anwendungsumgebung X2Go. Mit Hilfe dieser Anwendung k&#195;&#182;nnen Sie Sitzungen eines X2Go Servers starten, stoppen, laufende Sitzungen fortf&#195;&#188;hren oder anhalten und verschiedene Sitzungskonfigurationen verwalten. Die Authentifizierung kann &#195;&#188;ber LDAP erfolgen und das Programm kann im Vollbildmodus (als Ersatz f&#195;&#188;r XDM) gestartet werden. Weitere Informationen erhalten SIe auf x2go.org.&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;162&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;165&quot;/&gt;
         &lt;source&gt;OpenOffice.org&lt;/source&gt;
         &lt;translation&gt;OpenOffice.org&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;163&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;166&quot;/&gt;
         &lt;source&gt;Terminal&lt;/source&gt;
         &lt;translation&gt;Terminal&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;419&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;421&quot;/&gt;
         &lt;source&gt;unknown&lt;/source&gt;
         &lt;translation&gt;ukjent&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2092&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2119&quot;/&gt;
         &lt;source&gt;Command&lt;/source&gt;
         &lt;translation&gt;Kommando&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2094&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2121&quot;/&gt;
         &lt;source&gt;Type&lt;/source&gt;
         &lt;translation&gt;Type&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1057&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1059&quot;/&gt;
         &lt;source&gt;Desktop&lt;/source&gt;
         &lt;translation&gt;Skrivebord&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1059&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1061&quot;/&gt;
         &lt;source&gt;single application&lt;/source&gt;
         &lt;translation&gt;enkel applikasjon&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1061&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1063&quot;/&gt;
         &lt;source&gt;shadow session&lt;/source&gt;
         &lt;translatorcomment&gt;hm.. Need to revisit this one, not sure if I should use a better technical term in Norwegian&lt;/translatorcomment&gt;
         &lt;translation&gt;skygge sesjonen&lt;/translation&gt;
@@ -1430,315 +1428,316 @@ Vennligst sjekk instillingene dine&lt;/translation&gt;
         &lt;translation type=&quot;obsolete&quot;&gt;&lt;br&gt;Fehler in der Sudo Konfiguration&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;2418&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;2437&quot;/&gt;
         &lt;source&gt;Unable to execute: &lt;/source&gt;
         &lt;translation&gt;Klarte ikke &#195;&#165; utf&#195;&#184;re:&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;136&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;139&quot;/&gt;
         &lt;source&gt;X2Go client&lt;/source&gt;
         &lt;translation&gt;X2Go klient&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;160&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;163&quot;/&gt;
         &lt;source&gt;Internet browser&lt;/source&gt;
         &lt;translation&gt;Nettleser&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;161&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;164&quot;/&gt;
         &lt;source&gt;Email client&lt;/source&gt;
         &lt;translation&gt;Epost program&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;731&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;737&quot;/&gt;
         &lt;source&gt;&amp;New session ...&lt;/source&gt;
         &lt;translation&gt;&amp;Ny sesjon ...&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;737&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;743&quot;/&gt;
         &lt;source&gt;Session management...&lt;/source&gt;
         &lt;translation&gt;Sesjonsh&#195;&#165;ndtering...&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;775&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;796&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;781&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;802&quot;/&gt;
         &lt;source&gt;Show toolbar&lt;/source&gt;
         &lt;translation&gt;Vis verkt&#195;&#184;ylinje&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;346&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1715&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;352&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1734&quot;/&gt;
         &lt;source&gt;About X2GO client&lt;/source&gt;
         &lt;translation&gt;Om X2GO klient&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1636&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1819&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1849&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1661&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1844&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1874&quot;/&gt;
         &lt;source&gt;Please check LDAP settings&lt;/source&gt;
         &lt;translation&gt;Vennligst sjekk LDAP innstillingene&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1671&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1696&quot;/&gt;
         &lt;source&gt;no X2Go server found in LDAP &lt;/source&gt;
         &lt;translation&gt;Inge X2Go server ble funnet i LDAP &lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;2243&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;2268&quot;/&gt;
         &lt;source&gt;Are you sure you want to delete this session?&lt;/source&gt;
         &lt;translation&gt;Er du sikker p&#195;&#165; at du &#195;&#184;nsker &#195;&#165; fjerne denne sesjonen?&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;303&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1320&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1404&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;225&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;261&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;942&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1023&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1395&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1448&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;2398&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;305&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1322&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1406&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;222&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;258&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;961&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1042&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1414&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1467&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;2417&quot;/&gt;
         &lt;source&gt;&lt;b&gt;Wrong password!&lt;/b&gt;&lt;br&gt;&lt;br&gt;&lt;/source&gt;
         &lt;translation&gt;&lt;b&gt;Feil passord!&lt;/b&gt;&lt;br&gt;&lt;br&gt;&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;485&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;487&quot;/&gt;
         &lt;source&gt;No server availabel&lt;/source&gt;
         &lt;translation&gt;Ingen tilgjengelig server&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1003&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2121&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1009&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2123&quot;/&gt;
         &lt;source&gt;Not connected&lt;/source&gt;
         &lt;oldsource&gt;Active connection&lt;/oldsource&gt;
         &lt;translation&gt;Ikke tilkoblet&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2524&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2099&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2526&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2126&quot;/&gt;
         &lt;source&gt;Creation time&lt;/source&gt;
         &lt;translation&gt;Opprettelsestidspunkt&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1853&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1269&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1855&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1288&quot;/&gt;
         &lt;source&gt;Unable to create folder:&lt;/source&gt;
         &lt;translation&gt;Klarer ikke &#195;&#165; opprette katalogen:&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;79&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;80&quot;/&gt;
         &lt;source&gt;Host key for server changed.
 It is now: &lt;/source&gt;
         &lt;translation&gt;Vertsn&#195;&#184;kkel for serveren har endret seg.
 Den er n&#195;&#165;: &lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;80&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;81&quot;/&gt;
         &lt;source&gt;For security reasons, connection will be stopped&lt;/source&gt;
         &lt;translation&gt;Av hensyn til sikkerheten vil tilkoblingen bli stoppet&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;91&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;92&quot;/&gt;
         &lt;source&gt;The host key for this server was not found but an othertype of key exists.An attacker might change the default server key toconfuse your client into thinking the key does not exist&lt;/source&gt;
         &lt;translation&gt;Vertsn&#195;&#184;kkelen for denne serveren ble ikke funnet, men en annen type av n&#195;&#184;kkel eksisterer. En angriper kan endre standard server n&#195;&#184;kkel for &#195;&#165; lure klienten din til &#195;&#165; tro at n&#195;&#184;kkelen ikke finnes&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;113&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;114&quot;/&gt;
         &lt;source&gt;Could not find known host file.If you accept the host key here, the file will be automatically created&lt;/source&gt;
         &lt;translation&gt;Kan ikke finne &quot;known host&quot; filen. Om du aksepterer vertsn&#195;&#184;kkelen her vil filen automatisk bli opprettet&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;118&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;119&quot;/&gt;
         &lt;source&gt;The server is unknown. Do you trust the host key?
 Public key hash: &lt;/source&gt;
         &lt;translation&gt;Serveren er ukjent. Stoler du p&#195;&#165; vertsn&#195;&#184;kkelen?
 Offentlig n&#195;&#184;kkel: &lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;122&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;130&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;123&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;131&quot;/&gt;
         &lt;source&gt;Host key verification failed&lt;/source&gt;
         &lt;translation&gt;Verifiseringen av vertsn&#195;&#184;kkelen feilet&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;146&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;147&quot;/&gt;
         &lt;source&gt;Authentication failed&lt;/source&gt;
         &lt;translation&gt;P&#195;&#165;logging feilet&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;494&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;803&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1264&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1376&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;496&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;805&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1266&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1378&quot;/&gt;
         &lt;source&gt;Server not availabel&lt;/source&gt;
         &lt;translation&gt;Serveren er ikke tilgjengelig&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1879&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1881&quot;/&gt;
         &lt;source&gt;Unable to write file:&lt;/source&gt;
         &lt;translation&gt;Klarer ikke &#195;&#165; skrive til filen:&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2016&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;2469&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2018&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;2488&quot;/&gt;
         &lt;source&gt;Unable to create SSL tunnel:
 &lt;/source&gt;
         &lt;translation&gt;Klarte ikke &#195;&#165; opprette SSL tunnel:
 &lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;1842&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;1853&quot;/&gt;
         &lt;source&gt;&lt;b&gt;Session ID:&lt;br&gt;Server:&lt;br&gt;Username:&lt;br&gt;Display:&lt;br&gt;Creation time:&lt;br&gt;Status:&lt;/b&gt;&lt;/source&gt;
         &lt;translatorcomment&gt;Uncertain if the translation for &quot;Creation time&quot; is the most fitting one.&lt;/translatorcomment&gt;
         &lt;translation&gt;&lt;b&gt;Sesjons ID:&lt;br&gt;Server:&lt;br&gt;Brukernavn:&lt;br&gt;Skjerm:&lt;br&gt;Opprettet:&lt;br&gt;Status:&lt;/b&gt;&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;549&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1035&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;1852&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;555&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1036&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;1870&quot;/&gt;
         &lt;source&gt;Share folder...&lt;/source&gt;
         &lt;translation&gt;Del mappe...&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;1856&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;1888&quot;/&gt;
         &lt;source&gt;Show details&lt;/source&gt;
         &lt;translation&gt;Vis detailjer&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1716&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1735&quot;/&gt;
         &lt;source&gt;&lt;b&gt;X2Go client V. &lt;/source&gt;
         &lt;translation&gt;&lt;b&gt;X2Go klient v. &lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;2039&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;2058&quot;/&gt;
         &lt;source&gt;This card is unknown by X2Go system&lt;/source&gt;
         &lt;translatorcomment&gt;Need to double-check if the translation of &quot;card&quot; is suitable here&lt;/translatorcomment&gt;
         &lt;translation&gt;Dette kortet er ukjent for X2Go systemet&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;2232&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;2251&quot;/&gt;
         &lt;source&gt;Can&apos;t start X server
 Please check your settings&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Klarte ikke &#195;&#165; starte X-Serveren
+Vennligst sjekk instillingene dine&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;2434&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;2453&quot;/&gt;
         &lt;source&gt;Remote server does not support file system export through SSH Tunnel
 Please update to a newer x2goserver package&lt;/source&gt;
         &lt;translation&gt;Serveren st&#195;&#184;tter ikke eksport av filsystemet over en SSH Tunnel
 Vennligst oppdater til en nyere x2goserver pakke&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;748&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;754&quot;/&gt;
         &lt;source&gt;&amp;Create session icon on desktop...&lt;/source&gt;
         &lt;translation&gt;&amp;Opprett sesjonsikon p&#195;&#165; skrivebordet...&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;757&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;763&quot;/&gt;
         &lt;source&gt;&amp;Set broker password...&lt;/source&gt;
         &lt;translatorcomment&gt;Still uncertain what to best use as a translation for &quot;broker&quot;&lt;/translatorcomment&gt;
         &lt;translation&gt;&amp;Sett megler passord...&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;768&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;774&quot;/&gt;
         &lt;source&gt;&amp;Connectivity test...&lt;/source&gt;
         &lt;translation&gt;&amp;Tilkoblings-test...&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;884&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;890&quot;/&gt;
         &lt;source&gt;Operation failed&lt;/source&gt;
         &lt;translation&gt;Handlingen feilet&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;888&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;894&quot;/&gt;
         &lt;source&gt;Password changed&lt;/source&gt;
         &lt;translation&gt;Passordet er endret&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;912&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;918&quot;/&gt;
         &lt;source&gt;Wrong password!&lt;/source&gt;
         &lt;translation&gt;Feil passord!&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;961&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;967&quot;/&gt;
         &lt;source&gt;&lt;b&gt;Authentication&lt;/b&gt;&lt;/source&gt;
         &lt;translation&gt;&lt;b&gt;Autentisering&lt;/b&gt;&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1001&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1007&quot;/&gt;
         &lt;source&gt;Restore&lt;/source&gt;
         &lt;translation&gt;Gjenopprett&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1005&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1011&quot;/&gt;
         &lt;source&gt;Multimedia&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Multimedia&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1007&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1013&quot;/&gt;
         &lt;source&gt;Development&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Utvikling&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1009&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1015&quot;/&gt;
         &lt;source&gt;Education&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Oppl&#195;&#166;ring&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1011&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1017&quot;/&gt;
         &lt;source&gt;Game&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Spill&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1013&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1019&quot;/&gt;
         &lt;source&gt;Graphics&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Grafikk&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1015&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1021&quot;/&gt;
         &lt;source&gt;Network&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Nettverk&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1017&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1023&quot;/&gt;
         &lt;source&gt;Office&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Kontor&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1019&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1025&quot;/&gt;
         &lt;source&gt;Settings&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;Innstillinger&lt;/translation&gt;
+        &lt;translation&gt;Innstillinger&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1021&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1027&quot;/&gt;
         &lt;source&gt;System&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;System&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1023&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1029&quot;/&gt;
         &lt;source&gt;Utility&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Verkt&#195;&#184;y&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1025&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1031&quot;/&gt;
         &lt;source&gt;Other&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Andre&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1062&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1066&quot;/&gt;
         &lt;source&gt;Left mouse button to hide/restore - Right mouse button to display context menu&lt;/source&gt;
         &lt;oldsource&gt;Left click to open the X2GoClient window or right click to get the context menu.&lt;/oldsource&gt;
         &lt;translatorcomment&gt;According to the Norwegian skolelinux translation projects discussion on the words &quot;context menu&quot;, I&apos;ve chosen to follow their guidance and used &quot;sprettoppmeny&quot;&lt;/translatorcomment&gt;
         &lt;translation&gt;Venstre museknapp for &#195;&#165; skjule/gjenopprette  -  H&#195;&#184;yre museknapp viser sprettoppmeny&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1983&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;2008&quot;/&gt;
         &lt;source&gt;Create session icon on desktop&lt;/source&gt;
         &lt;translation&gt;Opprett sesjonsikon p&#195;&#165; skrivebordet&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1984&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;2009&quot;/&gt;
         &lt;source&gt;Desktop icons can be configured not to show x2goclient (hidden mode). If you like to use this feature you&apos;ll need to configure login by a gpg key or gpg smart card.
 
 Use x2goclient hidden mode?&lt;/source&gt;
@@ -1747,45 +1746,45 @@ Use x2goclient hidden mode?&lt;/source&gt;
 &#195;&#152;nsker du &#195;&#165; aktivere skjult modus for x2goklient?&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1995&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;2020&quot;/&gt;
         &lt;source&gt;New Session&lt;/source&gt;
         &lt;translation&gt;Ny sesjon&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;2095&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;2120&quot;/&gt;
         &lt;source&gt;X2Go sessions not found&lt;/source&gt;
         &lt;translation&gt;X2Go sesjoner ble ikke funnet&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;2613&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;2638&quot;/&gt;
         &lt;source&gt;RDP connection&lt;/source&gt;
         &lt;translation&gt;RDP tilkobling&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;2045&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;2070&quot;/&gt;
         &lt;source&gt;X2Go Link to session &lt;/source&gt;
         &lt;translatorcomment&gt;Uncertain of the context here, need to doublecheck this.&lt;/translatorcomment&gt;
         &lt;translation&gt;X2Go kobling til sesjon &lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;561&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;567&quot;/&gt;
         &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;1296&quot;/&gt;
         &lt;source&gt;Detach X2Go window&lt;/source&gt;
         &lt;translation&gt;L&#195;&#184;sne X2Go vindu&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1990&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1992&quot;/&gt;
         &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;1271&quot;/&gt;
         &lt;source&gt;Attach X2Go window&lt;/source&gt;
         &lt;translation&gt;Feste X2Go vindu&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2193&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2195&quot;/&gt;
         &lt;source&gt;Finished&lt;/source&gt;
         &lt;translation&gt;Ferdig&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2437&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;2439&quot;/&gt;
         &lt;source&gt;Are you sure you want to terminate this session?
 Unsaved documents will be lost&lt;/source&gt;
         &lt;translation&gt;Er du sikker p&#195;&#165; at du vil avslutte denne sesjonen?
@@ -1796,7 +1795,7 @@ Ulagrede data vil g&#195;&#165; tapt&lt;/translation&gt;
         &lt;translation type=&quot;obsolete&quot;&gt;&lt;/b&gt;&lt;br&gt; (C. 2006-2009 &lt;b&gt;obviously nice&lt;/b&gt;: Oleksandr Shneyder, Heinz-Markus Graesing)&lt;br&gt;&lt;br&gt;Ein Client f&#195;&#188;r den Zugriff auf die serverbasierende Anwendungsumgebung X2Go. Mit Hilfe dieser Anwendung k&#195;&#182;nnen Sie Sitzungen eines X2Go Servers starten, stoppen, laufende Sitzungen fortf&#195;&#188;hren oder anhalten und verschiedene Sitzungskonfigurationen verwalten. Die Authentifizierung kann &#195;&#188;ber LDAP erfolgen und das Programm kann im Vollbildmodus (als Ersatz f&#195;&#188;r XDM) gestartet werden. Weitere Informationen erhalten SIe auf x2go.org. &lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;2246&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;2265&quot;/&gt;
         &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;422&quot;/&gt;
         &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;450&quot;/&gt;
         &lt;source&gt;Can&apos;t start X Server
@@ -1810,13 +1809,13 @@ Vennligst sjekk din installasjon&lt;/translation&gt;
         &lt;translation&gt;X2Go sesjon&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;564&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2319&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;570&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2346&quot;/&gt;
         &lt;source&gt;Minimize toolbar&lt;/source&gt;
         &lt;translation&gt;Minimer verkt&#195;&#184;ylinje&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2352&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2379&quot;/&gt;
         &lt;source&gt;&lt;br&gt;&lt;b&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;Click this button&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;to restore toolbar&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/b&gt;&lt;br&gt;&lt;/source&gt;
         &lt;translation&gt;&lt;br&gt;&lt;b&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;Trykk her&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;for &#195;&#165; gjenopprette&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;verkt&#195;&#184;ylinjen&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/b&gt;&lt;br&gt;&lt;/translation&gt;
     &lt;/message&gt;
@@ -1825,7 +1824,7 @@ Vennligst sjekk din installasjon&lt;/translation&gt;
         &lt;translation type=&quot;obsolete&quot;&gt;Konfigurationsdatei l&#195;&#164;sst sich nicht &#195;&#182;ffnen:&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2236&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2263&quot;/&gt;
         &lt;source&gt;sshd not started, you&apos;ll need sshd for printing and file sharing
 you can install sshd with
 &lt;b&gt;sudo apt-get install openssh-server&lt;/b&gt;&lt;/source&gt;
@@ -1834,65 +1833,65 @@ Du kan installere sshd med:
 &lt;b&gt;sudo apt-get install openssh-server&lt;/b&gt;&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;2621&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;2646&quot;/&gt;
         &lt;source&gt;Connection to local desktop&lt;/source&gt;
         &lt;translation&gt;Tilkobling til lokalt skrivebord&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1094&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1096&quot;/&gt;
         &lt;source&gt;Information&lt;/source&gt;
         &lt;translation&gt;Informasjon&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1108&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2420&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1110&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2447&quot;/&gt;
         &lt;source&gt;Filter&lt;/source&gt;
         &lt;translation&gt;Filter&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1115&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1117&quot;/&gt;
         &lt;source&gt;Select desktop:&lt;/source&gt;
         &lt;translation&gt;Velg skrivebord:&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2027&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2054&quot;/&gt;
         &lt;source&gt;View only&lt;/source&gt;
         &lt;translation&gt;Kun vis&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2107&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2134&quot;/&gt;
         &lt;source&gt;User&lt;/source&gt;
         &lt;translation&gt;Bruker&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;2617&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;2642&quot;/&gt;
         &lt;source&gt;XDMCP&lt;/source&gt;
         &lt;translation&gt;XDMCP&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1095&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part2.cpp&quot; line=&quot;1097&quot;/&gt;
         &lt;source&gt;No accessible desktop found&lt;/source&gt;
         &lt;translation&gt;Ingen tilgjengelige skrivebord ble funnet&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2024&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2051&quot;/&gt;
         &lt;source&gt;Full access&lt;/source&gt;
         &lt;translation&gt;Full tilgang&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2138&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2165&quot;/&gt;
         &lt;source&gt;Only my desktops&lt;/source&gt;
         &lt;translation&gt;Kun mine skrivebord&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;557&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;563&quot;/&gt;
         &lt;source&gt;Reconnect&lt;/source&gt;
         &lt;translation&gt;Gjenoppkoble&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;916&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;2533&quot;/&gt;
-        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2489&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;922&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;2558&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;2516&quot;/&gt;
         &lt;source&gt;Connecting to broker&lt;/source&gt;
         &lt;translation&gt;Koble til megleren&lt;/translation&gt;
     &lt;/message&gt;
@@ -1901,12 +1900,12 @@ Du kan installere sshd med:
         &lt;translation type=&quot;obsolete&quot;&gt;&lt;/b&gt;&lt;br&gt; (C. 2006-2010 &lt;b&gt;obviously nice&lt;/b&gt;: Oleksandr Shneyder, Heinz-Markus Graesing)&lt;br&gt;&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1699&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1718&quot;/&gt;
         &lt;source&gt;&lt;br&gt;x2goplugin mode was sponsored by &lt;a href=&quot;<A HREF="http://www.foss-group.de/&amp;quot;&amp;gt;FOSS-Group">http://www.foss-group.de/&quot;&gt;FOSS-Group</A> GmbH(Freiburg)&lt;/a&gt;&lt;br&gt;&lt;/source&gt;
         &lt;translation&gt;&lt;br&gt;x2goplugin modusen ble sponset av &lt;a href=&quot;<A HREF="http://www.foss-group.de/&amp;quot;&amp;gt;FOSS-Group">http://www.foss-group.de/&quot;&gt;FOSS-Group</A> GmbH(Freiburg)&lt;/a&gt;&lt;br&gt;&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1703&quot;/&gt;
+        &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;1722&quot;/&gt;
         &lt;source&gt;&lt;br&gt;Client for use with the X2Go network based computing environment. This Client will be able to connect to X2Go server(s) and start, stop, resume and terminate (running) desktop sessions. X2Go Client stores different server connections and may automatically request authentification data from LDAP directories. Furthermore it can be used as fullscreen loginscreen (replacement for loginmanager like xdm). Please visit x2go.org for further information.&lt;/source&gt;
         &lt;translation&gt;&lt;br&gt;Ein Client f&#195;&#188;r den Zugriff auf die serverbasierende Anwendungsumgebung X2Go. Mit Hilfe dieser Anwendung k&#195;&#182;nnen Sie Sitzungen eines X2Go Servers starten, stoppen, laufende Sitzungen fortf&#195;&#188;hren oder anhalten und verschiedene Sitzungskonfigurationen verwalten. Die Authentifizierung kann &#195;&#188;ber LDAP erfolgen und das Programm kann im Vollbildmodus (als Ersatz f&#195;&#188;r XDM) gestartet werden. Weitere Informationen erhalten SIe auf x2go.org. &lt;/translation&gt;
     &lt;/message&gt;
@@ -2139,119 +2138,119 @@ Eksempel:
 &lt;context&gt;
     &lt;name&gt;SessionButton&lt;/name&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;116&quot;/&gt;
+        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;129&quot;/&gt;
         &lt;source&gt;Session preferences...&lt;/source&gt;
         &lt;translation&gt;Sesjonsinnstillinger...&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;120&quot;/&gt;
+        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;133&quot;/&gt;
         &lt;source&gt;Create session icon on desktop...&lt;/source&gt;
         &lt;translation&gt;Opprett sesjonsikon p&#195;&#165; skrivebordet...&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;125&quot;/&gt;
+        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;138&quot;/&gt;
         &lt;source&gt;Delete session&lt;/source&gt;
         &lt;translation&gt;Slett sesjon&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;138&quot;/&gt;
+        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;151&quot;/&gt;
         &lt;source&gt;Session actions&lt;/source&gt;
         &lt;translation&gt;Sesjonshandlinger&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;139&quot;/&gt;
+        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;152&quot;/&gt;
         &lt;source&gt;Select type&lt;/source&gt;
         &lt;translation&gt;Velg type&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;141&quot;/&gt;
+        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;154&quot;/&gt;
         &lt;source&gt;Select resolution&lt;/source&gt;
         &lt;translation&gt;Velg oppl&#195;&#184;sning&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;142&quot;/&gt;
+        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;155&quot;/&gt;
         &lt;source&gt;Toggle sound support&lt;/source&gt;
         &lt;translation&gt;Sl&#195;&#165; av/p&#195;&#165; lydst&#195;&#184;tte&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;272&quot;/&gt;
+        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;285&quot;/&gt;
         &lt;source&gt;New Session&lt;/source&gt;
         &lt;translation&gt;Ny sesjon&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;277&quot;/&gt;
+        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;290&quot;/&gt;
         &lt;source&gt;running&lt;/source&gt;
         &lt;translation&gt;aktiv&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;281&quot;/&gt;
+        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;294&quot;/&gt;
         &lt;source&gt;suspended&lt;/source&gt;
         &lt;translation&gt;frakoblet&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;314&quot;/&gt;
+        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;327&quot;/&gt;
         &lt;source&gt;KDE&lt;/source&gt;
         &lt;translation&gt;KDE&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;327&quot;/&gt;
-        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;360&quot;/&gt;
-        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;627&quot;/&gt;
+        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;340&quot;/&gt;
+        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;373&quot;/&gt;
+        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;640&quot;/&gt;
         &lt;source&gt;RDP connection&lt;/source&gt;
         &lt;translation&gt;RDP tilkobling&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;328&quot;/&gt;
-        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;366&quot;/&gt;
-        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;633&quot;/&gt;
+        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;341&quot;/&gt;
+        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;379&quot;/&gt;
+        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;646&quot;/&gt;
         &lt;source&gt;XDMCP&lt;/source&gt;
         &lt;translation&gt;XDMCP&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;329&quot;/&gt;
-        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;354&quot;/&gt;
-        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;621&quot;/&gt;
+        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;342&quot;/&gt;
+        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;367&quot;/&gt;
+        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;634&quot;/&gt;
         &lt;source&gt;Connection to local desktop&lt;/source&gt;
         &lt;translation&gt;Tilkobling til lokalt skrivebord&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;330&quot;/&gt;
-        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;371&quot;/&gt;
-        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;659&quot;/&gt;
+        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;343&quot;/&gt;
+        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;384&quot;/&gt;
+        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;672&quot;/&gt;
         &lt;source&gt;Published applications&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Publiserte applikasjoner&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;395&quot;/&gt;
-        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;412&quot;/&gt;
-        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;680&quot;/&gt;
+        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;408&quot;/&gt;
+        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;425&quot;/&gt;
+        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;693&quot;/&gt;
         &lt;source&gt;fullscreen&lt;/source&gt;
         &lt;translation&gt;fullskjerm&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;399&quot;/&gt;
-        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;422&quot;/&gt;
-        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;426&quot;/&gt;
-        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;686&quot;/&gt;
-        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;689&quot;/&gt;
+        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;412&quot;/&gt;
+        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;435&quot;/&gt;
+        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;439&quot;/&gt;
+        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;699&quot;/&gt;
+        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;702&quot;/&gt;
         &lt;source&gt;Display &lt;/source&gt;
         &lt;translation&gt;Skjerm &lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;407&quot;/&gt;
-        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;447&quot;/&gt;
+        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;420&quot;/&gt;
+        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;460&quot;/&gt;
         &lt;source&gt;window&lt;/source&gt;
         &lt;translation&gt;vindu&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;455&quot;/&gt;
-        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;585&quot;/&gt;
+        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;468&quot;/&gt;
+        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;598&quot;/&gt;
         &lt;source&gt;Enabled&lt;/source&gt;
         &lt;translation&gt;Aktivert&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;457&quot;/&gt;
-        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;587&quot;/&gt;
+        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;470&quot;/&gt;
+        &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;600&quot;/&gt;
         &lt;source&gt;Disabled&lt;/source&gt;
         &lt;translation&gt;Deaktivert&lt;/translation&gt;
     &lt;/message&gt;
@@ -2382,7 +2381,7 @@ Eksempel:
     &lt;message&gt;
         &lt;location filename=&quot;sessionwidget.cpp&quot; line=&quot;132&quot;/&gt;
         &lt;source&gt;Published applications&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Publiserte applikasjoner&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;sessionwidget.cpp&quot; line=&quot;134&quot;/&gt;
@@ -2675,85 +2674,85 @@ lydsystem forbindelser gjennom brannmurer&lt;/translation&gt;
 &lt;context&gt;
     &lt;name&gt;SshMasterConnection&lt;/name&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;sshmasterconnection.cpp&quot; line=&quot;124&quot;/&gt;
+        &lt;location filename=&quot;sshmasterconnection.cpp&quot; line=&quot;130&quot;/&gt;
         &lt;source&gt;Can not initialize libssh&lt;/source&gt;
         &lt;translatorcomment&gt;I need to revisit the word &apos;initiere&apos;, a better word could be &apos;klargj&#195;&#184;re&apos;&lt;/translatorcomment&gt;
         &lt;translation&gt;Klarer ikke &#195;&#165; initiere libssh&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;sshmasterconnection.cpp&quot; line=&quot;145&quot;/&gt;
+        &lt;location filename=&quot;sshmasterconnection.cpp&quot; line=&quot;151&quot;/&gt;
         &lt;source&gt;Can not create ssh session&lt;/source&gt;
         &lt;translation&gt;Klarer ikke &#195;&#165; opprette ssh sesjon&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;sshmasterconnection.cpp&quot; line=&quot;163&quot;/&gt;
+        &lt;location filename=&quot;sshmasterconnection.cpp&quot; line=&quot;169&quot;/&gt;
         &lt;source&gt;Can not connect to &lt;/source&gt;
         &lt;translation&gt;Klarer ikke &#195;&#165; koble til &lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;sshmasterconnection.cpp&quot; line=&quot;204&quot;/&gt;
+        &lt;location filename=&quot;sshmasterconnection.cpp&quot; line=&quot;210&quot;/&gt;
         &lt;source&gt;Authentication failed&lt;/source&gt;
         &lt;translation&gt;Autentisering feilet&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;sshmasterconnection.cpp&quot; line=&quot;220&quot;/&gt;
+        &lt;location filename=&quot;sshmasterconnection.cpp&quot; line=&quot;236&quot;/&gt;
         &lt;source&gt;channel_forward_listen failed&lt;/source&gt;
         &lt;translatorcomment&gt;I&apos;m not sure if this is a static variable which shouldn&apos;t be translated or not, but I left it as I believe it&apos;s a variable.&lt;/translatorcomment&gt;
         &lt;translation&gt;channel_forward_listen feilet&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;sshmasterconnection.cpp&quot; line=&quot;534&quot;/&gt;
+        &lt;location filename=&quot;sshmasterconnection.cpp&quot; line=&quot;550&quot;/&gt;
         &lt;source&gt;Can not open file &lt;/source&gt;
         &lt;translation&gt;Kan ikke &#195;&#165;pne filen &lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;sshmasterconnection.cpp&quot; line=&quot;546&quot;/&gt;
+        &lt;location filename=&quot;sshmasterconnection.cpp&quot; line=&quot;562&quot;/&gt;
         &lt;source&gt;Can not create remote file &lt;/source&gt;
         &lt;translation&gt;Klarer ikke &#195;&#165; opprette fil over nettverket &lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;sshmasterconnection.cpp&quot; line=&quot;559&quot;/&gt;
+        &lt;location filename=&quot;sshmasterconnection.cpp&quot; line=&quot;575&quot;/&gt;
         &lt;source&gt;Can not write to remote file &lt;/source&gt;
         &lt;translation&gt;Klarer ikke &#195;&#165; skrive til filen over nettverket &lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;sshmasterconnection.cpp&quot; line=&quot;609&quot;/&gt;
+        &lt;location filename=&quot;sshmasterconnection.cpp&quot; line=&quot;632&quot;/&gt;
         &lt;source&gt;can not connect to &lt;/source&gt;
         &lt;translation&gt;Klarer ikke &#195;&#165; koble til &lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;sshmasterconnection.cpp&quot; line=&quot;718&quot;/&gt;
+        &lt;location filename=&quot;sshmasterconnection.cpp&quot; line=&quot;741&quot;/&gt;
         &lt;source&gt;channel_open_forward failed&lt;/source&gt;
         &lt;translation&gt;channel_open_forward feilet&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;sshmasterconnection.cpp&quot; line=&quot;737&quot;/&gt;
+        &lt;location filename=&quot;sshmasterconnection.cpp&quot; line=&quot;760&quot;/&gt;
         &lt;source&gt;channel_open_session failed&lt;/source&gt;
         &lt;translation&gt;channel_open_session feilet&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;sshmasterconnection.cpp&quot; line=&quot;744&quot;/&gt;
+        &lt;location filename=&quot;sshmasterconnection.cpp&quot; line=&quot;767&quot;/&gt;
         &lt;source&gt;channel_request_exec failed&lt;/source&gt;
         &lt;translation&gt;channel_request_exec feilet&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;sshmasterconnection.cpp&quot; line=&quot;809&quot;/&gt;
+        &lt;location filename=&quot;sshmasterconnection.cpp&quot; line=&quot;832&quot;/&gt;
         &lt;source&gt;error writing to socket&lt;/source&gt;
         &lt;translatorcomment&gt;Really not any great words to best translate socket into...&lt;/translatorcomment&gt;
         &lt;translation&gt;feil ved skriving til sokkelen&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;sshmasterconnection.cpp&quot; line=&quot;827&quot;/&gt;
+        &lt;location filename=&quot;sshmasterconnection.cpp&quot; line=&quot;850&quot;/&gt;
         &lt;source&gt;error reading channel&lt;/source&gt;
         &lt;translation&gt;feil under lesing av kanalen&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;sshmasterconnection.cpp&quot; line=&quot;857&quot;/&gt;
+        &lt;location filename=&quot;sshmasterconnection.cpp&quot; line=&quot;880&quot;/&gt;
         &lt;source&gt;channel_write failed&lt;/source&gt;
         &lt;translation&gt;channel_write feilet&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
-        &lt;location filename=&quot;sshmasterconnection.cpp&quot; line=&quot;869&quot;/&gt;
+        &lt;location filename=&quot;sshmasterconnection.cpp&quot; line=&quot;892&quot;/&gt;
         &lt;source&gt;error reading tcp socket&lt;/source&gt;
         &lt;translation&gt;feil ved lesing av tcp sokkelen&lt;/translation&gt;
     &lt;/message&gt;
diff --git a/x2goclient_sv.ts b/x2goclient_sv.ts
index 6532b01..434baed 100644
--- a/x2goclient_sv.ts
+++ b/x2goclient_sv.ts
@@ -6,77 +6,77 @@
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.ui&quot; line=&quot;14&quot;/&gt;
         &lt;source&gt;Published Applications&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Publicerade applikationer&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.ui&quot; line=&quot;60&quot;/&gt;
         &lt;source&gt;Search:&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;S&#195;&#182;k:&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.ui&quot; line=&quot;76&quot;/&gt;
         &lt;source&gt;&amp;Start&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;&amp;Starta&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.ui&quot; line=&quot;96&quot;/&gt;
         &lt;source&gt;&amp;Close&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;S&amp;t&#195;&#164;ng&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.cpp&quot; line=&quot;105&quot;/&gt;
         &lt;source&gt;Multimedia&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Ljud och video&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.cpp&quot; line=&quot;110&quot;/&gt;
         &lt;source&gt;Development&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Programmering&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.cpp&quot; line=&quot;115&quot;/&gt;
         &lt;source&gt;Education&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Utbildning&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.cpp&quot; line=&quot;120&quot;/&gt;
         &lt;source&gt;Game&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Spel&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.cpp&quot; line=&quot;125&quot;/&gt;
         &lt;source&gt;Graphics&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Grafik&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.cpp&quot; line=&quot;130&quot;/&gt;
         &lt;source&gt;Network&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;N&#195;&#164;tverk&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.cpp&quot; line=&quot;135&quot;/&gt;
         &lt;source&gt;Office&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Kontor&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.cpp&quot; line=&quot;140&quot;/&gt;
         &lt;source&gt;Settings&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;Inst&#195;&#164;llningar&lt;/translation&gt;
+        &lt;translation&gt;Inst&#195;&#164;llningar&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.cpp&quot; line=&quot;145&quot;/&gt;
         &lt;source&gt;System&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;System&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.cpp&quot; line=&quot;150&quot;/&gt;
         &lt;source&gt;Utility&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Verktyg&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;appdialog.cpp&quot; line=&quot;155&quot;/&gt;
         &lt;source&gt;Other&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;&#195;&#150;vrigt&lt;/translation&gt;
     &lt;/message&gt;
 &lt;/context&gt;
 &lt;context&gt;
@@ -591,7 +591,7 @@
     &lt;message&gt;
         &lt;location filename=&quot;exportdialog.cpp&quot; line=&quot;73&quot;/&gt;
         &lt;source&gt;share folders&lt;/source&gt;
-        &lt;translation&gt;dela mappar&lt;/translation&gt;
+        &lt;translation&gt;Dela mappar&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;exportdialog.cpp&quot; line=&quot;139&quot;/&gt;
@@ -1016,57 +1016,57 @@
     &lt;message&gt;
         &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1005&quot;/&gt;
         &lt;source&gt;Multimedia&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Ljud och video&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1007&quot;/&gt;
         &lt;source&gt;Development&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Programmering&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1009&quot;/&gt;
         &lt;source&gt;Education&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Utbildning&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1011&quot;/&gt;
         &lt;source&gt;Game&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Spel&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1013&quot;/&gt;
         &lt;source&gt;Graphics&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Grafik&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1015&quot;/&gt;
         &lt;source&gt;Network&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;N&#195;&#164;tverk&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1017&quot;/&gt;
         &lt;source&gt;Office&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Kontor&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1019&quot;/&gt;
         &lt;source&gt;Settings&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;Inst&#195;&#164;llningar&lt;/translation&gt;
+        &lt;translation&gt;Inst&#195;&#164;llningar&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1021&quot;/&gt;
         &lt;source&gt;System&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;System&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1023&quot;/&gt;
         &lt;source&gt;Utility&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Verktyg&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1025&quot;/&gt;
         &lt;source&gt;Other&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;&#195;&#150;vrigt&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;onmainwindow.cpp&quot; line=&quot;1062&quot;/&gt;
@@ -1559,7 +1559,8 @@ Data som ej sparats kommer att f&#195;&#182;rloras&lt;/translation&gt;
         &lt;location filename=&quot;onmainwindow_part3.cpp&quot; line=&quot;2232&quot;/&gt;
         &lt;source&gt;Can&apos;t start X server
 Please check your settings&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Kan ej starta X-server
+Kontrollera dina inst&#195;&#164;llningar&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;source&gt;Can&apos;t connect to X-Server&lt;/source&gt;
@@ -1571,7 +1572,7 @@ Please check your settings&lt;/source&gt;
 Please check your settings&lt;/source&gt;
         &lt;oldsource&gt;Can&apos;t connect to X-Server
 Please check your settings&lt;/oldsource&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;Kan ej ansluta till X-server
+        &lt;translation&gt;Kan ej ansluta till X-server
 Kontrollera dina inst&#195;&#164;llningar&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
@@ -1666,7 +1667,7 @@ Uppdatera till en nyare version av x2goserver&lt;/translation&gt;
     &lt;message&gt;
         &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;1850&quot;/&gt;
         &lt;source&gt;Applications...&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Applikationer...&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;onmainwindow_part4.cpp&quot; line=&quot;1854&quot;/&gt;
@@ -2047,7 +2048,7 @@ Example:
         &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;371&quot;/&gt;
         &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;659&quot;/&gt;
         &lt;source&gt;Published applications&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Publicerade applikationer&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;sessionbutton.cpp&quot; line=&quot;395&quot;/&gt;
@@ -2210,7 +2211,7 @@ Example:
     &lt;message&gt;
         &lt;location filename=&quot;sessionwidget.cpp&quot; line=&quot;132&quot;/&gt;
         &lt;source&gt;Published applications&lt;/source&gt;
-        &lt;translation type=&quot;unfinished&quot;&gt;&lt;/translation&gt;
+        &lt;translation&gt;Publicerade applikationer&lt;/translation&gt;
     &lt;/message&gt;
     &lt;message&gt;
         &lt;location filename=&quot;sessionwidget.cpp&quot; line=&quot;134&quot;/&gt;
diff --git a/x2goplugin.rc b/x2goplugin.rc
index ef7a9ea..ea22b6a 100644
--- a/x2goplugin.rc
+++ b/x2goplugin.rc
@@ -1,8 +1,8 @@
 1 TYPELIB &quot;x2goplugin.rc&quot;
 
 1 VERSIONINFO
- FILEVERSION 3,99,2,0
- PRODUCTVERSION 3,99,2,0
+ FILEVERSION 3,99,2,1
+ PRODUCTVERSION 3,99,2,1
  FILEFLAGSMASK 0x3fL
 #ifdef _DEBUG
  FILEFLAGS 0x1L
@@ -21,13 +21,13 @@ BEGIN
             VALUE &quot;FileDescription&quot;, &quot;Allows you to start X2Go session in a webbrowser\0&quot;
 	    VALUE &quot;FileExtents&quot;, &quot;x2go\0&quot;
 	    VALUE &quot;FileOpenName&quot;, &quot;Configuration File for X2Go Session (*.x2go)\0&quot;
-            VALUE &quot;FileVersion&quot;, &quot;3, 99, 2 ,0\0&quot;
+            VALUE &quot;FileVersion&quot;, &quot;3, 99, 2 ,1\0&quot;
             VALUE &quot;InternalName&quot;, &quot;x2goplugin\0&quot;
             VALUE &quot;LegalCopyright&quot;, &quot;Copyright &#169; 2010-2012 Obviously Nice\0&quot;
 	    VALUE &quot;MIMEType&quot;, &quot;application/x2go\0&quot;
             VALUE &quot;OriginalFilename&quot;, &quot;npx2goplugin.dll\0&quot;
-            VALUE &quot;ProductName&quot;, &quot;X2GoClient Plug-in 3.99.2.0\0&quot;
-            VALUE &quot;ProductVersion&quot;, &quot;3, 99, 2, 0\0&quot;
+            VALUE &quot;ProductName&quot;, &quot;X2GoClient Plug-in 3.99.2.1\0&quot;
+            VALUE &quot;ProductVersion&quot;, &quot;3, 99, 2, 1\0&quot;
         END
     END
     BLOCK &quot;VarFileInfo&quot;


hooks/post-receive
-- 
x2goclient.git (X2Go Client)

This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;x2goclient.git&quot; (X2Go Client).

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002898.html">[X2go-Commits] x2goclient.git - master (branch) updated:	3.99.2.0-20-g26aac92
</A></li>
	<LI>Next message: <A HREF="002900.html">[X2go-Commits] pyhoca-cli.git - master (branch) updated:	0.1.4.2-14-g3816f7d
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2899">[ date ]</a>
              <a href="thread.html#2899">[ thread ]</a>
              <a href="subject.html#2899">[ subject ]</a>
              <a href="author.html#2899">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/x2go-commits">More information about the X2go-commits
mailing list</a><br>
</body></html>
