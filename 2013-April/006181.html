<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [X2Go-Commits] libpam-x2go.git - x2gosession (branch) updated:	7bcc0a5ff26e00089a7821efd55d241de9a3a985
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/x2go-commits/2013-April/index.html" >
   <LINK REL="made" HREF="mailto:x2go-commits%40lists.berlios.de?Subject=Re%3A%20%5BX2Go-Commits%5D%20libpam-x2go.git%20-%20x2gosession%20%28branch%29%20updated%3A%0A%097bcc0a5ff26e00089a7821efd55d241de9a3a985&In-Reply-To=%3C20130424164729.1D9805DB26%40ymir%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006180.html">
   <LINK REL="Next"  HREF="006182.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[X2Go-Commits] libpam-x2go.git - x2gosession (branch) updated:	7bcc0a5ff26e00089a7821efd55d241de9a3a985</H1>
    <B>X2Go dev team</B> 
    <A HREF="mailto:x2go-commits%40lists.berlios.de?Subject=Re%3A%20%5BX2Go-Commits%5D%20libpam-x2go.git%20-%20x2gosession%20%28branch%29%20updated%3A%0A%097bcc0a5ff26e00089a7821efd55d241de9a3a985&In-Reply-To=%3C20130424164729.1D9805DB26%40ymir%3E"
       TITLE="[X2Go-Commits] libpam-x2go.git - x2gosession (branch) updated:	7bcc0a5ff26e00089a7821efd55d241de9a3a985">git-admin at x2go.org
       </A><BR>
    <I>Wed Apr 24 18:47:29 CEST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="006180.html">[X2Go-Commits] libpam-x2go.git - x2gosession (branch) updated:	7d6377d559133048ddb17d39be6395b6c2281a19
</A></li>
        <LI>Next message: <A HREF="006182.html">[X2Go-Commits] libpam-x2go.git - x2gosession (branch) updated:	74540195ac67a579ba0f8a2479cfcadb6bee6cc8
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6181">[ date ]</a>
              <a href="thread.html#6181">[ thread ]</a>
              <a href="subject.html#6181">[ subject ]</a>
              <a href="author.html#6181">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch, x2gosession has been updated
  discards  b3857b0cb9d0ad808a40b39ae099feaac82d8b2b (commit)
  discards  58d01c2ab63c6e8ff3797e0b8a04117e413fa111 (commit)
  discards  b01690eee03b89b04cbccbf111a67d9e270d7149 (commit)
  discards  01847ab5a61a22986301ea0b9246f3f107786a51 (commit)
  discards  36a0f53434149c52ad0e41f3139c4761e13a474f (commit)
  discards  6f64adfc81105b9e76c3df530ebf6a5f401f7899 (commit)
  discards  e552688b70889a4879ef16ce38bc8c95e6f447c7 (commit)
       via  7bcc0a5ff26e00089a7821efd55d241de9a3a985 (commit)

This update added new revisions after undoing existing revisions.  That is
to say, the old revision is not a strict subset of the new revision.  This
situation occurs when you --force push a change and generate a repository
containing something like this:

 * -- * -- B -- O -- O -- O (b3857b0cb9d0ad808a40b39ae099feaac82d8b2b)
            \
             N -- N -- N (7bcc0a5ff26e00089a7821efd55d241de9a3a985)

When this happens we assume that you've already had alert emails for all
of the O revisions, and so we here report only the revisions in the N
branch from the common base, B.

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
-----------------------------------------------------------------------

Summary of changes:
 Makefile.am                   |    4 +-
 Makefile.am.coverage          |   48 ------------------
 configure.ac                  |   27 ----------
 m4/gcov.m4                    |   86 --------------------------------
 m4/gtest.m4                   |   63 -----------------------
 src/Makefile.am               |   11 ++---
 src/pam-freerdp.c             |   12 +++++
 tests/Makefile.am             |   55 ---------------------
 tests/mock_guest.c            |   51 -------------------
 tests/mock_guest.h            |   24 ---------
 tests/mock_pam.c              |  110 -----------------------------------------
 tests/mock_pam.h              |   23 ---------
 tests/test-freerdp-wrapper.cc |   69 --------------------------
 13 files changed, 16 insertions(+), 567 deletions(-)
 delete mode 100644 Makefile.am.coverage
 delete mode 100644 m4/gcov.m4
 delete mode 100644 m4/gtest.m4
 delete mode 100644 tests/Makefile.am
 delete mode 100644 tests/mock_guest.c
 delete mode 100644 tests/mock_guest.h
 delete mode 100644 tests/mock_pam.c
 delete mode 100644 tests/mock_pam.h
 delete mode 100644 tests/test-freerdp-wrapper.cc

The diff of changes is:
diff --git a/Makefile.am b/Makefile.am
index 9477c1c..769ade8 100644
--- a/Makefile.am
+++ b/Makefile.am
@@ -1,7 +1,6 @@
 
 SUBDIRS = \
-	src \
-	tests
+	src
 
 DISTCHECK_CONFIGURE_FLAGS = --enable-localinstall
 
@@ -31,4 +30,3 @@ dist-hook:
 				echo Failed to generate AUTHORS: not a branch &gt;&amp;2; \
 	fi
 
-include $(top_srcdir)/Makefile.am.coverage
diff --git a/Makefile.am.coverage b/Makefile.am.coverage
deleted file mode 100644
index fb97747..0000000
--- a/Makefile.am.coverage
+++ /dev/null
@@ -1,48 +0,0 @@
-
-# Coverage targets
-
-.PHONY: clean-gcno clean-gcda \
-	coverage-html generate-coverage-html clean-coverage-html \
-	coverage-gcovr generate-coverage-gcovr clean-coverage-gcovr
-
-clean-local: clean-gcno clean-coverage-html clean-coverage-gcovr
-
-if HAVE_GCOV
-
-clean-gcno:
-	@echo Removing old coverage instrumentation
-	-find -name '*.gcno' -print | xargs -r rm
-
-clean-gcda:
-	@echo Removing old coverage results
-	-find -name '*.gcda' -print | xargs -r rm
-  
-coverage-html: clean-gcda
-	-$(MAKE) $(AM_MAKEFLAGS) -k check
-	$(MAKE) $(AM_MAKEFLAGS) generate-coverage-html
-  
-generate-coverage-html:
-	@echo Collecting coverage data
-	$(LCOV) --directory $(top_builddir) --capture --output-file coverage.info --no-checksum --compat-libtool
-	LANG=C $(GENHTML) --prefix $(top_builddir) --output-directory coveragereport --title &quot;Code Coverage&quot; --legend --show-details coverage.info
-  
-clean-coverage-html: clean-gcda
-	-$(LCOV) --directory $(top_builddir) -z
-	-rm -rf coverage.info coveragereport
-
-if HAVE_GCOVR
-
-coverage-gcovr: clean-gcda
-	-$(MAKE) $(AM_MAKEFLAGS) -k check
-	$(MAKE) $(AM_MAKEFLAGS) generate-coverage-gcovr
-	
-generate-coverage-gcovr:
-	@echo Generating coverage GCOVR report
-	$(GCOVR) -x -r $(top_builddir) -o $(top_builddir)/coverage.xml
-	
-clean-coverage-gcovr: clean-gcda
-	-rm -rf $(top_builddir)/coverage.xml
-
-endif # HAVE_GCOVR
-
-endif # HAVE_GCOV
diff --git a/configure.ac b/configure.ac
index cee665d..aa8a3f9 100644
--- a/configure.ac
+++ b/configure.ac
@@ -5,8 +5,6 @@ AM_INIT_AUTOMAKE([1.11 -Wno-portability])
 AM_SILENT_RULES([yes])
 
 AC_PROG_CC
-# the Google Test targets are cpp
-AC_PROG_CXX
 AC_PROG_LIBTOOL
 
 LT_INIT([disable-static])
@@ -48,34 +46,9 @@ else
 fi
 AC_SUBST(PAMMODULEDIR)
 
-###########################
-# Google Test Dependencies
-###########################
-
-m4_include([m4/gtest.m4])
-CHECK_GTEST
-if test &quot;x$have_gtest&quot; != &quot;xyes&quot;; then
-   AC_MSG_ERROR([tests were requested but gtest is not installed.])
-fi
-
-###########################
-# gcov coverage reporting
-###########################
-
-m4_include([m4/gcov.m4])
-AC_TDD_GCOV
-AM_CONDITIONAL([HAVE_GCOV], [test &quot;x$ac_cv_check_gcov&quot; = xyes])
-AM_CONDITIONAL([HAVE_LCOV], [test &quot;x$ac_cv_check_lcov&quot; = xyes])
-AM_CONDITIONAL([HAVE_GCOVR], [test &quot;x$ac_cv_check_gcovr&quot; = xyes])
-AC_SUBST(COVERAGE_CFLAGS)
-AC_SUBST(COVERAGE_CXXFLAGS)
-AC_SUBST(COVERAGE_LDFLAGS)
-
-
 
 AC_CONFIG_FILES([
   Makefile
   src/Makefile
-  tests/Makefile
 ])
 AC_OUTPUT
diff --git a/m4/gcov.m4 b/m4/gcov.m4
deleted file mode 100644
index 3163584..0000000
--- a/m4/gcov.m4
+++ /dev/null
@@ -1,86 +0,0 @@
-# Checks for existence of coverage tools:
-#  * gcov
-#  * lcov
-#  * genhtml
-#  * gcovr
-# 
-# Sets ac_cv_check_gcov to yes if tooling is present
-# and reports the executables to the variables LCOV, GCOVR and GENHTML.
-AC_DEFUN([AC_TDD_GCOV],
-[
-  AC_ARG_ENABLE(gcov,
-  AS_HELP_STRING([--enable-gcov],
-		 [enable coverage testing with gcov]),
-  [use_gcov=$enableval], [use_gcov=no])
-
-  if test &quot;x$use_gcov&quot; = &quot;xyes&quot;; then
-  # we need gcc:
-  if test &quot;$GCC&quot; != &quot;yes&quot;; then
-    AC_MSG_ERROR([GCC is required for --enable-gcov])
-  fi
-
-  # Check if ccache is being used
-  AC_CHECK_PROG(SHTOOL, shtool, shtool)
-  case `$SHTOOL path $CC` in
-    *ccache*[)] gcc_ccache=yes;;
-    *[)] gcc_ccache=no;;
-  esac
-
-  if test &quot;$gcc_ccache&quot; = &quot;yes&quot; &amp;&amp; (test -z &quot;$CCACHE_DISABLE&quot; || test &quot;$CCACHE_DISABLE&quot; != &quot;1&quot;); then
-    AC_MSG_ERROR([ccache must be disabled when --enable-gcov option is used. You can disable ccache by setting environment variable CCACHE_DISABLE=1.])
-  fi
-
-  lcov_version_list=&quot;1.6 1.7 1.8 1.9&quot;
-  AC_CHECK_PROG(LCOV, lcov, lcov)
-  AC_CHECK_PROG(GENHTML, genhtml, genhtml)
-
-  if test &quot;$LCOV&quot;; then
-    AC_CACHE_CHECK([for lcov version], glib_cv_lcov_version, [
-      glib_cv_lcov_version=invalid
-      lcov_version=`$LCOV -v 2&gt;/dev/null | $SED -e 's/^.* //'`
-      for lcov_check_version in $lcov_version_list; do
-        if test &quot;$lcov_version&quot; = &quot;$lcov_check_version&quot;; then
-          glib_cv_lcov_version=&quot;$lcov_check_version (ok)&quot;
-        fi
-      done
-    ])
-  else
-    lcov_msg=&quot;To enable code coverage reporting you must have one of the following lcov versions installed: $lcov_version_list&quot;
-    AC_MSG_ERROR([$lcov_msg])
-  fi
-
-  case $glib_cv_lcov_version in
-    &quot;&quot;|invalid[)]
-      lcov_msg=&quot;You must have one of the following versions of lcov: $lcov_version_list (found: $lcov_version).&quot;
-      AC_MSG_ERROR([$lcov_msg])
-      LCOV=&quot;exit 0;&quot;
-      ;;
-  esac
-
-  if test -z &quot;$GENHTML&quot;; then
-    AC_MSG_ERROR([Could not find genhtml from the lcov package])
-  fi
-
-  ac_cv_check_gcov=yes
-  ac_cv_check_lcov=yes
-
-  # Remove all optimization flags from CFLAGS
-  changequote({,})
-  CFLAGS=`echo &quot;$CFLAGS&quot; | $SED -e 's/-O[0-9]*//g'`
-  changequote([,])
-
-  # Add the special gcc flags
-  COVERAGE_CFLAGS=&quot;-O0 -fprofile-arcs -ftest-coverage&quot;
-  COVERAGE_CXXFLAGS=&quot;-O0 -fprofile-arcs -ftest-coverage&quot;	
-  COVERAGE_LDFLAGS=&quot;-lgcov&quot;
-
-  # Check availability of gcovr
-  AC_CHECK_PROG(GCOVR, gcovr, gcovr)
-  if test -z &quot;$GCOVR&quot;; then
-    ac_cv_check_gcovr=no
-  else
-    ac_cv_check_gcovr=yes
-  fi
-
-fi
-]) # AC_TDD_GCOV
diff --git a/m4/gtest.m4 b/m4/gtest.m4
deleted file mode 100644
index 2de334c..0000000
--- a/m4/gtest.m4
+++ /dev/null
@@ -1,63 +0,0 @@
-# Copyright (C) 2012 Canonical, Ltd.
-#
-# Permission is hereby granted, free of charge, to any person obtaining a copy
-# of this software and associated documentation files (the &quot;Software&quot;), to deal
-# in the Software without restriction, including without limitation the rights
-# to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
-# copies of the Software, and to permit persons to whom the Software is
-# furnished to do so, subject to the following conditions:
-#
-# The above copyright notice and this permission notice (including the next
-# paragraph) shall be included in all copies or substantial portions of the
-# Software.
-#
-# THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
-# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
-# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
-# AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
-# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
-# OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
-# SOFTWARE.
-
-# Checks whether the gtest source is available on the system. Allows for
-# adjusting the include and source path. Sets have_gtest=yes if the source is
-# present. Sets GTEST_CPPFLAGS and GTEST_SOURCE to the preprocessor flags and
-# source location respectively.
-AC_DEFUN([CHECK_GTEST],
-[
-  AC_ARG_WITH([gtest-include-path],
-              [AS_HELP_STRING([--with-gtest-include-path],
-                              [location of the Google test headers])],
-              [GTEST_CPPFLAGS=&quot;-I$withval&quot;])
-
-  AC_ARG_WITH([gtest-source-path],
-              [AS_HELP_STRING([--with-gtest-source-path],
-                              [location of the Google test sources, defaults to /usr/src/gtest])],
-              [GTEST_SOURCE=&quot;$withval&quot;],
-              [GTEST_SOURCE=&quot;/usr/src/gtest&quot;])
-
-  GTEST_CPPFLAGS=&quot;$GTEST_CPPFLAGS -I$GTEST_SOURCE&quot;
-
-  AC_LANG_PUSH([C++])
-
-  tmp_CPPFLAGS=&quot;$CPPFLAGS&quot;
-  CPPFLAGS=&quot;$CPPFLAGS $GTEST_CPPFLAGS&quot;
-
-  AC_CHECK_HEADER([gtest/gtest.h])
-
-  CPPFLAGS=&quot;$tmp_CPPFLAGS&quot;
-
-  AC_LANG_POP
-
-  AC_CHECK_FILES([$GTEST_SOURCE/src/gtest-all.cc]
-                 [$GTEST_SOURCE/src/gtest_main.cc],
-                 [have_gtest_source=yes],
-                 [have_gtest_source=no])
-
-  AS_IF([test &quot;x$ac_cv_header_gtest_gtest_h&quot; = xyes -a \
-              &quot;x$have_gtest_source&quot; = xyes],
-        [have_gtest=yes]
-        [AC_SUBST(GTEST_CPPFLAGS)]
-        [AC_SUBST(GTEST_SOURCE)],
-        [have_gtest=no])
-]) # CHECK_GTEST
diff --git a/src/Makefile.am b/src/Makefile.am
index 962ef29..e5b04b2 100644
--- a/src/Makefile.am
+++ b/src/Makefile.am
@@ -8,16 +8,14 @@ pam_freerdp_la_SOURCES = \
 pam_freerdp_la_LDFLAGS = \
 	-no-undefined \
 	-module \
-	-avoid-version \
-	$(COVERAGE_LDFLAGS)
+	-avoid-version
 
 pam_freerdp_la_LIBADD = \
 	-lpam
 
 pam_freerdp_la_CFLAGS = \
 	-Wall -Werror \
-	-DAUTH_CHECK=&quot;\&quot;$(pkglibexecdir)/freerdp-auth-check\&quot;&quot; \
-	$(COVERAGE_CFLAGS)
+	-DAUTH_CHECK=&quot;\&quot;$(pkglibexecdir)/freerdp-auth-check\&quot;&quot;
 
 pkglibexec_PROGRAMS = \
 	freerdp-auth-check
@@ -25,9 +23,6 @@ pkglibexec_PROGRAMS = \
 freerdp_auth_check_SOURCES = \
 	freerdp-auth-check.c
 freerdp_auth_check_CFLAGS = \
-	$(FREERDP_CFLAGS) \
-	$(COVERAGE_CFLAGS)
+	$(FREERDP_CFLAGS)
 freerdp_auth_check_LDADD = \
 	$(FREERDP_LIBS)
-freerdp_auth_check_LDFLAGS = \
-	$(COVERAGE_LDFLAGS)
diff --git a/src/pam-freerdp.c b/src/pam-freerdp.c
index ebc98af..607e215 100644
--- a/src/pam-freerdp.c
+++ b/src/pam-freerdp.c
@@ -126,6 +126,18 @@ get_item (pam_handle_t * pamh, int type)
 		}
 	}
 
+	/* The way that xfreerdp does parsing means that we can't handle
+	   spaces in the username.  Let's block them as early as possible.
+	   Though, if the xfreerdp part gets fixed, we want this to disappear
+	     <A HREF="http://launchpad.net/bugs/1053102">http://launchpad.net/bugs/1053102</A>
+	*/
+	if (type == PAM_RUSER) {
+		if (strstr(promptval, &quot; &quot;) != NULL) {
+			free(promptval);
+			return NULL;
+		}
+	}
+
 	if (type == PAM_RHOST) {
 		char * subloc = strstr(promptval, &quot;://&quot;);
 		if (subloc != NULL) {
diff --git a/tests/Makefile.am b/tests/Makefile.am
deleted file mode 100644
index c5da385..0000000
--- a/tests/Makefile.am
+++ /dev/null
@@ -1,55 +0,0 @@
-CLEANFILES =
-DISTCLEANFILES =
-EXTRA_DIST =
-
-TESTS = \
-  test-freerdpclient-wrapper
-
-check_PROGRAMS = $(TESTS)
-
-AM_CPPFLAGS = $(GTEST_CPPFLAGS) \
-	$(REMOTE_APPS_MANAGER_CFLAGS) \
-	-I${top_srcdir}/src -Wall -Werror
-AM_CXXFLAGS = $(GTEST_CXXFLAGS) \
-	$(REMOTE_APPS_MANAGER_CFLAGS)
-
-AM_CFLAGS = \
-	 -Wall \
-	 -g
-
-##########################
-# Google Test Test Suite #
-##########################
-
-check_LIBRARIES = libgtest.a
-
-nodist_libgtest_a_SOURCES = \
-  $(GTEST_SOURCE)/src/gtest-all.cc \
-  $(GTEST_SOURCE)/src/gtest_main.cc
-
-libgtest_a_CPPFLAGS = \
-	$(GTEST_CPPFLAGS) -w \
-	$(AM_CPPFLAGS)
-libgtest_a_CXXFLAGS = \
-	$(AM_CXXFLAGS)
-
-##########################
-# Wrapper
-##########################
-
-test_freerdpclient_wrapper_SOURCES = \
-	mock_pam.c mock_pam.h \
-	mock_guest.c mock_guest.h \
-	test-freerdp-wrapper.cc
-
-test_freerdpclient_wrapper_LDADD = \
-	$(top_builddir)/src/pam_freerdp.la \
-	libgtest.a
-
-test_freerdpclient_wrapper_CXXFLAGS = \
-	$(AM_CXXFLAGS) \
-	-I${top_srcdir}/src
-
-test_freerdpclient_wrapper_LDFLAGS = \
-	-pthread
-
diff --git a/tests/mock_guest.c b/tests/mock_guest.c
deleted file mode 100644
index 2cf04b3..0000000
--- a/tests/mock_guest.c
+++ /dev/null
@@ -1,51 +0,0 @@
-/*
- * Copyright &#169; 2012 Canonical Ltd. All rights reserved.
- *
- * Author(s): David Barth &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">david.barth at canonical.com</A>&gt;
- *
- */
-
-#include &lt;pwd.h&gt;
-#include &lt;errno.h&gt;
-#include &lt;unistd.h&gt;
-#include &lt;sys/stat.h&gt;
-
-static struct passwd guest = { &quot;guest&quot;,
-							   &quot;password&quot;,
-							   500, 500,
-							   &quot;M. Guest&quot;,
-							   &quot;/tmp&quot;,
-							   &quot;/bin/true&quot; };
-struct passwd *
-getpwnam (const char *username)
-{ return &guest; }
-
-int
-setgroups(size_t size, const gid_t *list)
-{
-	errno = EPERM;
-	return -1;
-}
-
-int
-setgid(gid_t gid)
-{ return 0; }
-
-int
-setuid(uid_t uid)
-{ return 0; }
-
-int
-setegid(gid_t gid)
-{ return 0; }
-
-int
-seteuid(uid_t uid)
-{ return 0; }
-
-int chmod(const char *path, mode_t mode)
-{ return 0; }
-
-int chown(const char *path, uid_t owner, gid_t group)
-{ return 0; }
-
diff --git a/tests/mock_guest.h b/tests/mock_guest.h
deleted file mode 100644
index c4179b9..0000000
--- a/tests/mock_guest.h
+++ /dev/null
@@ -1,24 +0,0 @@
-/*
- * Copyright &#169; 2012 Canonical Ltd. All rights reserved.
- *
- * Author(s): David Barth &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">david.barth at canonical.com</A>&gt;
- *
- */
-
-#ifndef __MOCK_GUEST_H__
-#define __MOCK_GUEST_H__
-
-#include &lt;pwd.h&gt;
-#include &lt;unistd.h&gt;
-#include &lt;sys/stat.h&gt;
-
-struct passwd *getpwnam (const char *username);
-int setgroups(size_t size, const gid_t *list);
-int setgid(gid_t gid);
-int setuid(uid_t uid);
-int setegid(gid_t gid);
-int seteuid(uid_t uid);
-int chmod(const char *path, mode_t mode);
-int chown(const char *path, uid_t owner, gid_t group);
-
-#endif
diff --git a/tests/mock_pam.c b/tests/mock_pam.c
deleted file mode 100644
index 6368b84..0000000
--- a/tests/mock_pam.c
+++ /dev/null
@@ -1,110 +0,0 @@
-/*
- * Copyright &#169; 2012 Canonical Ltd. All rights reserved.
- *
- * Author(s): David Barth &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">david.barth at canonical.com</A>&gt;
- *
- */
-
-#include &lt;stdlib.h&gt;
-#include &lt;string.h&gt;
-
-#include &quot;mock_pam.h&quot;
-
-struct pam_handle {
-	void *item[PAM_NUM_ITEMS];
-
-	struct pam_conv *conv;
-
-	/* note: the other fields have been omitted */
-};
-
-int fake_conv (int num_msg, const struct pam_message **msg,
-				struct pam_response **resp, void *appdata_ptr)
-{
-	struct pam_response *response = NULL;
-	response = malloc (sizeof (struct pam_response));
-
-	if (response == NULL)
-		return PAM_BUF_ERR;
-
-	response-&gt;resp_retcode = 0;
-
-	if (strcmp((*msg)-&gt;msg, &quot;login:&quot;) == 0)
-		response-&gt;resp = strdup (&quot;guest&quot;); /* IMPORTANT: this needs to be in /etc/passwd */
-	else if (strcmp((*msg)-&gt;msg, &quot;remote login:&quot;) == 0)
-		response-&gt;resp = strdup (&quot;ruser&quot;);
-	else if (strcmp((*msg)-&gt;msg, &quot;remote host:&quot;) == 0)
-		response-&gt;resp = strdup (&quot;<A HREF="protocol://rhost/dummy">protocol://rhost/dummy</A>&quot;);
-	else if (strcmp((*msg)-&gt;msg, &quot;password:&quot;) == 0)
-		response-&gt;resp = strdup (&quot;password&quot;);
-	else if (strcmp((*msg)-&gt;msg, &quot;domain:&quot;) == 0)
-		response-&gt;resp = strdup (&quot;domain&quot;);
-	else
-		return PAM_SYMBOL_ERR; /* leaks... */
-
-	*resp = response;
-
-	return PAM_SUCCESS;
-}
-
-struct pam_conv static_conv = { &amp;fake_conv, (void *)NULL };
-
-pam_handle_t *pam_handle_new (void)
-{
-	pam_handle_t *newh = malloc (sizeof (pam_handle_t));
-
-	if (newh != NULL) {
-		newh-&gt;conv = &amp;static_conv;
-		memset(newh-&gt;item, 0, sizeof(void *) * PAM_NUM_ITEMS);
-	}
-
-	return newh;
-}
-
-int pam_get_item (const pam_handle_t *pamh, int type, const void **value)
-{
-	if (pamh == NULL)
-		return PAM_SYSTEM_ERR;
-
-	if (type == PAM_CONV)
-		*value = pamh-&gt;conv;
-	else  if (pamh-&gt;item[type] != NULL)
-		*value = pamh-&gt;item[type];
-	else 
-		*value = NULL; /* will result in a prompt conversation */
-
-	return PAM_SUCCESS;
-}
-
-int pam_set_item (pam_handle_t *pamh, int type, const void *value)
-{
-	if (pamh == NULL)
-		return PAM_SYSTEM_ERR;
-
-	void **slot, *tmp;
-	size_t nsize, osize;
-
-	slot = &amp;pamh-&gt;item[type];
-	osize = nsize = 0;
-
-	if (*slot != NULL)
-		osize = strlen((const char *)*slot) + 1;
-	if (value != NULL)
-		nsize = strlen((const char *)value) + 1;
-
-	if (*slot != NULL) {
-		memset(*slot, 0xd0, osize);
-		free(*slot);
-	}
-
-	if (value != NULL) {
-		if ((tmp = malloc(nsize)) == NULL)
-			return PAM_BUF_ERR;
-		memcpy(tmp, value, nsize);
-	} else {
-		tmp = NULL;
-	}
-	*slot = tmp;
-
-	return PAM_SUCCESS;
-}
diff --git a/tests/mock_pam.h b/tests/mock_pam.h
deleted file mode 100644
index eb88a2e..0000000
--- a/tests/mock_pam.h
+++ /dev/null
@@ -1,23 +0,0 @@
-/*
- * Copyright &#169; 2012 Canonical Ltd. All rights reserved.
- *
- * Author(s): David Barth &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">david.barth at canonical.com</A>&gt;
- *
- */
-
-#ifndef __MOCK_PAM_H__
-#define __MOCK_PAM_H__
-
-#include &lt;security/pam_modules.h&gt;
-#include &lt;security/pam_modutil.h&gt;
-#include &lt;security/pam_appl.h&gt;
-
-#define PAM_NUM_ITEMS PAM_AUTHTOK_TYPE
-
-typedef struct pam_handle pam_handle_t;
-
-pam_handle_t *pam_handle_new (void);
-int pam_get_item (const pam_handle_t *pamh, int type, const void **value);
-int pam_set_item (pam_handle_t *pamh, int type, const void *value);
-
-#endif
diff --git a/tests/test-freerdp-wrapper.cc b/tests/test-freerdp-wrapper.cc
deleted file mode 100644
index e53d94b..0000000
--- a/tests/test-freerdp-wrapper.cc
+++ /dev/null
@@ -1,69 +0,0 @@
-/*
- * Copyright &#169; 2012 Canonical Ltd. All rights reserved.
- *
- * Author(s): David Barth &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">david.barth at canonical.com</A>&gt;
- *
- */
-
-#include &lt;gtest/gtest.h&gt;
-
-extern &quot;C&quot; {
-
-#include &quot;mock_pam.h&quot;
-#include &quot;mock_guest.h&quot;
-
-	int freerdpclient_wrapper (int argc, char * argv[]);
-}
-
-namespace {
-
-  // The fixture for testing class Foo.
-  class FreerdpclientWrapperTest : public ::testing::Test {
-  protected:
-    // You can remove any or all of the following functions if its body
-    // is empty.
-
-    FreerdpclientWrapperTest() {
-      // You can do set-up work for each test here.
-		setenv(&quot;HOME&quot;, &quot;/tmp&quot;, 1 /* overwrite */);
-    }
-
-    virtual ~FreerdpclientWrapperTest() {
-      // You can do clean-up work that doesn't throw exceptions here.
-    }
-
-    // If the constructor and destructor are not enough for setting up
-    // and cleaning up each test, you can define the following methods:
-
-    virtual void SetUp() {
-      // Code here will be called immediately after the constructor (right
-      // before each test).
-		unlink(&quot;/tmp/.freerdp-socket&quot;);
-    }
-
-    virtual void TearDown() {
-      // Code here will be called immediately after each test (right
-      // before the destructor).
-		unlink(&quot;/tmp/.freerdp-socket&quot;);
-    }
-
-    // Objects declared here can be used by all tests in the test case for Foo.
-  };
-
-  TEST_F(FreerdpclientWrapperTest, canLinkTheWholeGang) {
-	  EXPECT_EQ (1, 1); // right, that's trivial, but that means
-	                    // that I got all of the wrapper and pam to link there
-  }
-
-  TEST_F(FreerdpclientWrapperTest, canCallPamOpenSession) {
-	  const char *argv[] = { NULL };
-
-	  pam_handle_t *pamh = pam_handle_new ();
-
-	  EXPECT_EQ (PAM_SUCCESS, 
-				 pam_sm_open_session (pamh, 0, 0, argv));
-	  EXPECT_EQ (PAM_SUCCESS, 
-				 pam_sm_close_session (pamh, 0, 0, argv));
-  }
-
-}


hooks/post-receive
-- 
libpam-x2go.git (Remote login session via X2Go (PAM module))

This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;libpam-x2go.git&quot; (Remote login session via X2Go (PAM module)).

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006180.html">[X2Go-Commits] libpam-x2go.git - x2gosession (branch) updated:	7d6377d559133048ddb17d39be6395b6c2281a19
</A></li>
	<LI>Next message: <A HREF="006182.html">[X2Go-Commits] libpam-x2go.git - x2gosession (branch) updated:	74540195ac67a579ba0f8a2479cfcadb6bee6cc8
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6181">[ date ]</a>
              <a href="thread.html#6181">[ thread ]</a>
              <a href="subject.html#6181">[ subject ]</a>
              <a href="author.html#6181">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/x2go-commits">More information about the X2Go-commits
mailing list</a><br>
</body></html>
