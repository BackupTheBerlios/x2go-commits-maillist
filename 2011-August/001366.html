<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [X2go-Commits] x2goagent.git - build-main (branch) updated:	3.4.0.5-17-g34f933e
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/x2go-commits/2011-August/index.html" >
   <LINK REL="made" HREF="mailto:x2go-commits%40lists.berlios.de?Subject=Re%3A%20%5BX2go-Commits%5D%20x2goagent.git%20-%20build-main%20%28branch%29%20updated%3A%0A%093.4.0.5-17-g34f933e&In-Reply-To=%3C20110817154825.6A6F35DB19%40ymir%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001365.html">
   <LINK REL="Next"  HREF="001367.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[X2go-Commits] x2goagent.git - build-main (branch) updated:	3.4.0.5-17-g34f933e</H1>
    <B>X2go dev team</B> 
    <A HREF="mailto:x2go-commits%40lists.berlios.de?Subject=Re%3A%20%5BX2go-Commits%5D%20x2goagent.git%20-%20build-main%20%28branch%29%20updated%3A%0A%093.4.0.5-17-g34f933e&In-Reply-To=%3C20110817154825.6A6F35DB19%40ymir%3E"
       TITLE="[X2go-Commits] x2goagent.git - build-main (branch) updated:	3.4.0.5-17-g34f933e">git-admin at x2go.org
       </A><BR>
    <I>Wed Aug 17 17:48:25 CEST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="001365.html">[X2go-Commits] nxcompshad.git - build-main (branch) updated:	3.4.0.4-9-g206dbbc
</A></li>
        <LI>Next message: <A HREF="001367.html">[X2go-Commits] nxcompext.git - master (branch) updated:	3.4.0.2-13-g140cc0c
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1366">[ date ]</a>
              <a href="thread.html#1366">[ thread ]</a>
              <a href="subject.html#1366">[ subject ]</a>
              <a href="author.html#1366">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The branch, build-main has been updated
       via  34f933eba3532aff808969c4c6a38b0d630554dc (commit)
       via  bb01e48b1461d241f682f1271907cac60ae80cdc (commit)
       via  24eee38cfe9e4933443ac2d861ba3e0afea8e22b (commit)
       via  16587ed8b30d7c11baf6102dde2799650ebab495 (commit)
       via  15ba0c4ed1535fcd0c8b1d26d7a9afe0e45329e3 (commit)
       via  2e7c9ecb90ac85781be862769e1b6e5e52193b47 (commit)
       via  0d26f66bef490708e1301eec3bf17e61e00ed08b (commit)
       via  d287da5ccdbf84ac3b515fdd5db42154341e24e0 (commit)
       via  a7e8f76164f44ed4b6a1d1dcc13e336d1c7fad20 (commit)
       via  e906831917d7d8dfbc3db298df70af9ae9e083d5 (commit)
       via  4f717e309762e477980733626000f2259dd25c73 (commit)
       via  586f759fdf1dafd73a5280bba7e4b9a7c4ad7700 (commit)
       via  8c8a3886d5fdc577060b30830f7a0777d16ac49b (commit)
       via  a3d809d61e0c79240ee974b8143b11a84def54c7 (commit)
      from  463b9238f8e3f7c040b5736fd1a6de1212274d50 (commit)

Those revisions listed above that are new to this repository have
not appeared on any other notification email; so we list those
revisions in full, below.

- Log -----------------------------------------------------------------
-----------------------------------------------------------------------

Summary of changes:
 CHANGELOG                                          |   14 +-
 CHANGELOG.NX                                       | 1069 -------------------
 CHANGELOG.NX.original                              | 1073 ++++++++++++++++++++
 .../cf/host.def.X.original =&gt; CHANGELOG.X.original |    0
 CHANGELOG.X =&gt; ChangeLog.X.org                     |    0
 LICENSE                                            |    5 +-
 VERSION                                            |    2 +-
 VERSION.x2goagent                                  |    1 +
 config/cf/host.def                                 |    2 +-
 config/cf/host.def.NX.original                     |    2 +-
 debian/changelog                                   |    8 +
 debian/control                                     |   41 +-
 debian/dirs                                        |    2 -
 debian/docs                                        |    2 -
 debian/source/format                               |    1 +
 debian/x2goagent.dirs                              |    4 +
 debian/x2goagent.docs                              |    3 +
 debian/x2goagent.install                           |    2 +
 extras/Mesa/src/mesa/main/WSDrawBuffer.h           |    2 +-
 .../Mesa/src/mesa/main/WSDrawBuffer.h.NX.original  |    2 +-
 include/Xpoll.h.in                                 |    2 +-
 include/Xpoll.h.in.NX.original                     |    2 +-
 lib/SM/sm_client.c                                 |    4 +-
 lib/X11/ConnDis.c                                  |    2 +-
 lib/X11/ConnDis.c.NX.original                      |    2 +-
 lib/X11/Imakefile.NX.original                      |    2 +-
 lib/X11/OpenDis.c                                  |    2 +-
 lib/X11/OpenDis.c.NX.original                      |    2 +-
 lib/X11/XlibAsync.c                                |    2 +-
 lib/X11/XlibAsync.c.NX.original                    |    2 +-
 lib/X11/XlibInt.c                                  |    2 +-
 lib/X11/XlibInt.c.NX.original                      |    2 +-
 lib/X11/Xlibint.h                                  |    2 +-
 lib/X11/Xlibint.h.NX.original                      |    2 +-
 lib/Xt/Imakefile                                   |    2 +-
 lib/Xt/Imakefile.NX.original                       |    2 +-
 lib/Xt/NextEvent.c                                 |    2 +-
 lib/Xt/NextEvent.c.NX.original                     |    2 +-
 lib/xtrans/Xtranssock.c                            |    2 +-
 lib/xtrans/Xtranssock.c.NX.original                |    2 +-
 programs/Imakefile                                 |    2 +-
 programs/Imakefile.NX.original                     |    2 +-
 programs/Xserver/GL/glx/render2.c                  |    2 +-
 programs/Xserver/GL/glx/render2swap.c              |    2 +-
 programs/Xserver/Imakefile.NX.original             |    2 +-
 programs/Xserver/Xext/Imakefile                    |    2 +-
 programs/Xserver/Xext/Imakefile.NX.original        |    2 +-
 programs/Xserver/Xext/security.c                   |    2 +-
 programs/Xserver/Xext/security.c.NX.original       |    2 +-
 programs/Xserver/hw/nxagent/Agent.h                |    2 +-
 programs/Xserver/hw/nxagent/Args.c                 |   15 +-
 programs/Xserver/hw/nxagent/Args.h                 |    2 +-
 programs/Xserver/hw/nxagent/Atoms.c                |   30 +-
 programs/Xserver/hw/nxagent/Atoms.h                |    4 +-
 programs/Xserver/hw/nxagent/Binder.c               |    2 +-
 programs/Xserver/hw/nxagent/Binder.h               |    2 +-
 programs/Xserver/hw/nxagent/CHANGELOG              |  156 +++-
 programs/Xserver/hw/nxagent/Client.c               |    2 +-
 programs/Xserver/hw/nxagent/Client.h               |    2 +-
 programs/Xserver/hw/nxagent/Clipboard.c            |    2 +-
 programs/Xserver/hw/nxagent/Clipboard.h            |    2 +-
 programs/Xserver/hw/nxagent/Colormap.c             |    2 +-
 programs/Xserver/hw/nxagent/Colormap.h             |    2 +-
 programs/Xserver/hw/nxagent/Composite.c            |    2 +-
 programs/Xserver/hw/nxagent/Composite.h            |    2 +-
 programs/Xserver/hw/nxagent/Cursor.c               |    2 +-
 programs/Xserver/hw/nxagent/Cursor.h               |    2 +-
 programs/Xserver/hw/nxagent/Dialog.c               |    2 +-
 programs/Xserver/hw/nxagent/Dialog.h               |    2 +-
 programs/Xserver/hw/nxagent/Display.c              |    2 +-
 programs/Xserver/hw/nxagent/Display.h              |    2 +-
 programs/Xserver/hw/nxagent/Drawable.c             |    2 +-
 programs/Xserver/hw/nxagent/Drawable.h             |    2 +-
 programs/Xserver/hw/nxagent/Error.c                |    2 +-
 programs/Xserver/hw/nxagent/Error.h                |    2 +-
 programs/Xserver/hw/nxagent/Events.c               |  477 ++++++++-
 programs/Xserver/hw/nxagent/Events.h               |    4 +-
 programs/Xserver/hw/nxagent/Extensions.c           |    2 +-
 programs/Xserver/hw/nxagent/Extensions.h           |    2 +-
 programs/Xserver/hw/nxagent/Font.c                 |    4 +-
 programs/Xserver/hw/nxagent/Font.h                 |    2 +-
 programs/Xserver/hw/nxagent/GC.c                   |    2 +-
 programs/Xserver/hw/nxagent/GCOps.c                |    2 +-
 programs/Xserver/hw/nxagent/GCOps.h                |    2 +-
 programs/Xserver/hw/nxagent/GCs.h                  |    2 +-
 programs/Xserver/hw/nxagent/Handlers.c             |    2 +-
 programs/Xserver/hw/nxagent/Handlers.h             |    2 +-
 programs/Xserver/hw/nxagent/Holder.c               |    2 +-
 programs/Xserver/hw/nxagent/Holder.h               |    2 +-
 programs/Xserver/hw/nxagent/Icons.h                |    2 +-
 programs/Xserver/hw/nxagent/Image.c                |    2 +-
 programs/Xserver/hw/nxagent/Image.h                |    2 +-
 programs/Xserver/hw/nxagent/Imakefile              |    3 +-
 programs/Xserver/hw/nxagent/Init.c                 |    6 +-
 programs/Xserver/hw/nxagent/Init.h                 |    2 +-
 programs/Xserver/hw/nxagent/Keyboard.c             |    2 +-
 programs/Xserver/hw/nxagent/Keyboard.h             |    2 +-
 programs/Xserver/hw/nxagent/Keystroke.c            |   26 +-
 programs/Xserver/hw/nxagent/Keystroke.h            |    2 +-
 programs/Xserver/hw/nxagent/LICENSE                |    2 +-
 programs/Xserver/hw/nxagent/Literals.h             |    2 +-
 programs/Xserver/hw/nxagent/Millis.c               |    2 +-
 programs/Xserver/hw/nxagent/Millis.h               |    2 +-
 programs/Xserver/hw/nxagent/NXdispatch.c           |    2 +-
 .../Xserver/hw/nxagent/NXdispatch.c.NX.original    |    2 +-
 programs/Xserver/hw/nxagent/NXdixfonts.c           |    2 +-
 .../Xserver/hw/nxagent/NXdixfonts.c.NX.original    |    2 +-
 programs/Xserver/hw/nxagent/NXevents.c             |    2 +-
 programs/Xserver/hw/nxagent/NXevents.c.NX.original |    2 +-
 programs/Xserver/hw/nxagent/NXextension.c          |    2 +-
 .../Xserver/hw/nxagent/NXextension.c.NX.original   |    2 +-
 programs/Xserver/hw/nxagent/NXglyph.c              |    2 +-
 programs/Xserver/hw/nxagent/NXglyph.c.NX.original  |    2 +-
 programs/Xserver/hw/nxagent/NXglyphcurs.c          |    2 +-
 .../Xserver/hw/nxagent/NXglyphcurs.c.NX.original   |    2 +-
 programs/Xserver/hw/nxagent/NXglyphstr.h           |    2 +-
 .../Xserver/hw/nxagent/NXglyphstr.h.NX.original    |    2 +-
 programs/Xserver/hw/nxagent/NXmiglyph.c            |    2 +-
 .../Xserver/hw/nxagent/NXmiglyph.c.NX.original     |    2 +-
 programs/Xserver/hw/nxagent/NXpicture.c            |    2 +-
 .../Xserver/hw/nxagent/NXpicture.c.NX.original     |    2 +-
 programs/Xserver/hw/nxagent/NXpicturestr.h         |    2 +-
 .../Xserver/hw/nxagent/NXpicturestr.h.NX.original  |    2 +-
 programs/Xserver/hw/nxagent/NXproperty.c           |    2 +-
 .../Xserver/hw/nxagent/NXproperty.c.NX.original    |    2 +-
 programs/Xserver/hw/nxagent/NXrandr.c              |    2 +-
 programs/Xserver/hw/nxagent/NXrandr.c.NX.original  |    2 +-
 programs/Xserver/hw/nxagent/NXrender.c             |    2 +-
 programs/Xserver/hw/nxagent/NXrender.c.NX.original |    2 +-
 programs/Xserver/hw/nxagent/NXwindow.c             |    2 +-
 programs/Xserver/hw/nxagent/NXwindow.c.NX.original |    2 +-
 programs/Xserver/hw/nxagent/NXxrandr.c             |    2 +-
 programs/Xserver/hw/nxagent/NXxrandr.h             |    2 +-
 programs/Xserver/hw/nxagent/NXxrandrint.h          |    2 +-
 programs/Xserver/hw/nxagent/Options.c              |    2 +-
 programs/Xserver/hw/nxagent/Options.h              |    9 +-
 programs/Xserver/hw/nxagent/Pixels.c               |    2 +-
 programs/Xserver/hw/nxagent/Pixels.h               |   20 +-
 programs/Xserver/hw/nxagent/Pixmap.c               |    2 +-
 programs/Xserver/hw/nxagent/Pixmaps.h              |    2 +-
 programs/Xserver/hw/nxagent/Pointer.c              |   36 +-
 programs/Xserver/hw/nxagent/Pointer.h              |   11 +-
 programs/Xserver/hw/nxagent/Reconnect.c            |    6 +-
 programs/Xserver/hw/nxagent/Reconnect.h            |    2 +-
 programs/Xserver/hw/nxagent/Render.c               |  293 +++++-
 programs/Xserver/hw/nxagent/Render.h               |    4 +-
 programs/Xserver/hw/nxagent/Rootless.c             |  101 ++-
 programs/Xserver/hw/nxagent/Rootless.h             |    2 +-
 programs/Xserver/hw/nxagent/Screen.c               |  130 +--
 programs/Xserver/hw/nxagent/Screen.h               |    6 +-
 programs/Xserver/hw/nxagent/Splash.c               |    2 +-
 programs/Xserver/hw/nxagent/Splash.h               |    2 +-
 programs/Xserver/hw/nxagent/Split.c                |    2 +-
 programs/Xserver/hw/nxagent/Split.h                |    2 +-
 programs/Xserver/hw/nxagent/TestExt.c              |    2 +-
 programs/Xserver/hw/nxagent/Trap.c                 |    2 +-
 programs/Xserver/hw/nxagent/Trap.h                 |    2 +-
 programs/Xserver/hw/nxagent/Utils.h                |    2 +-
 programs/Xserver/hw/nxagent/Visual.c               |    2 +-
 programs/Xserver/hw/nxagent/Visual.h               |    2 +-
 programs/Xserver/hw/nxagent/Window.c               |   90 ++-
 programs/Xserver/hw/nxagent/Windows.h              |    4 +-
 programs/Xserver/hw/nxagent/X/NXdamage.c           |    2 +-
 .../Xserver/hw/nxagent/X/NXdamage.c.NX.original    |    2 +-
 programs/Xserver/hw/nxagent/X/NXdispatch.c         |    2 +-
 .../Xserver/hw/nxagent/X/NXdispatch.c.NX.original  |    2 +-
 programs/Xserver/hw/nxagent/X/NXdixfonts.c         |    2 +-
 .../Xserver/hw/nxagent/X/NXdixfonts.c.NX.original  |    2 +-
 programs/Xserver/hw/nxagent/X/NXevents.c           |    2 +-
 .../Xserver/hw/nxagent/X/NXevents.c.NX.original    |    2 +-
 programs/Xserver/hw/nxagent/X/NXextension.c        |    2 +-
 .../Xserver/hw/nxagent/X/NXextension.c.NX.original |    2 +-
 programs/Xserver/hw/nxagent/X/NXglxext.c           |    2 +-
 .../Xserver/hw/nxagent/X/NXglxext.c.NX.original    |    2 +-
 programs/Xserver/hw/nxagent/X/NXglyph.c            |    2 +-
 .../Xserver/hw/nxagent/X/NXglyph.c.NX.original     |    2 +-
 programs/Xserver/hw/nxagent/X/NXglyphcurs.c        |    2 +-
 .../Xserver/hw/nxagent/X/NXglyphcurs.c.NX.original |    2 +-
 programs/Xserver/hw/nxagent/X/NXglyphstr.h         |    2 +-
 .../Xserver/hw/nxagent/X/NXglyphstr.h.NX.original  |    2 +-
 programs/Xserver/hw/nxagent/X/NXmiexpose.c         |    2 +-
 .../Xserver/hw/nxagent/X/NXmiexpose.c.NX.original  |    2 +-
 programs/Xserver/hw/nxagent/X/NXmiglyph.c          |    2 +-
 .../Xserver/hw/nxagent/X/NXmiglyph.c.NX.original   |    2 +-
 programs/Xserver/hw/nxagent/X/NXmitrap.c           |    2 +-
 .../Xserver/hw/nxagent/X/NXmitrap.c.NX.original    |    2 +-
 programs/Xserver/hw/nxagent/X/NXmiwindow.c         |    2 +-
 .../Xserver/hw/nxagent/X/NXmiwindow.c.NX.original  |    2 +-
 programs/Xserver/hw/nxagent/X/NXpicture.c          |   54 +-
 .../Xserver/hw/nxagent/X/NXpicture.c.NX.original   |   54 +-
 programs/Xserver/hw/nxagent/X/NXpicturestr.h       |    2 +-
 .../hw/nxagent/X/NXpicturestr.h.NX.original        |    2 +-
 programs/Xserver/hw/nxagent/X/NXproperty.c         |    2 +-
 .../Xserver/hw/nxagent/X/NXproperty.c.NX.original  |    2 +-
 programs/Xserver/hw/nxagent/X/NXrandr.c            |    2 +-
 .../Xserver/hw/nxagent/X/NXrandr.c.NX.original     |    2 +-
 programs/Xserver/hw/nxagent/X/NXrender.c           |   60 +-
 .../Xserver/hw/nxagent/X/NXrender.c.NX.original    |   60 +-
 programs/Xserver/hw/nxagent/X/NXresource.c         |    2 +-
 .../Xserver/hw/nxagent/X/NXresource.c.NX.original  |    2 +-
 programs/Xserver/hw/nxagent/X/NXshm.c              |    2 +-
 programs/Xserver/hw/nxagent/X/NXshm.c.NX.original  |    2 +-
 programs/Xserver/hw/nxagent/X/NXwindow.c           |    2 +-
 .../Xserver/hw/nxagent/X/NXwindow.c.NX.original    |    2 +-
 programs/Xserver/hw/nxagent/X/NXxvdisp.c           |    2 +-
 .../Xserver/hw/nxagent/X/NXxvdisp.c.NX.original    |    2 +-
 programs/Xserver/hw/nxagent/nxagent.xpm            |    2 +-
 programs/Xserver/hw/nxagent/nxmissing.xpm          |    2 +-
 programs/Xserver/hw/nxagent/os2Stub.c              |    2 +-
 programs/Xserver/hw/nxagent/screensaver            |    2 +-
 programs/Xserver/mi/Imakefile                      |    2 +-
 programs/Xserver/mi/Imakefile.NX.original          |    2 +-
 programs/Xserver/os/Imakefile                      |    2 +-
 programs/Xserver/os/Imakefile.NX.original          |    2 +-
 programs/Xserver/os/WaitFor.c                      |    2 +-
 programs/Xserver/os/WaitFor.c.NX.original          |    2 +-
 programs/Xserver/os/auth.c                         |    2 +-
 programs/Xserver/os/auth.c.NX.original             |    2 +-
 programs/Xserver/os/log.c                          |    2 +-
 programs/Xserver/os/log.c.NX.original              |    2 +-
 programs/Xserver/os/utils.c                        |    2 +-
 programs/Xserver/os/utils.c.NX.original            |    2 +-
 programs/nxauth/CHANGELOG                          |   10 +-
 programs/nxauth/Imakefile                          |    2 +-
 programs/nxauth/LICENSE                            |    2 +-
 programs/nxauth/parsedpy.c                         |    2 +-
 programs/nxauth/process.c                          |    2 +-
 programs/nxauth/xauth.c                            |    2 +-
 programs/xterm/Imakefile                           |    2 +-
 programs/xterm/Imakefile.NX.original               |    2 +-
 programs/xterm/charproc.c                          |    2 +-
 programs/xterm/charproc.c.NX.original              |    2 +-
 programs/xterm/main.c                              |    2 +-
 programs/xterm/main.c.NX.original                  |    2 +-
 234 files changed, 2777 insertions(+), 1507 deletions(-)
 delete mode 100644 CHANGELOG.NX
 create mode 100644 CHANGELOG.NX.original
 copy config/cf/host.def.X.original =&gt; CHANGELOG.X.original (100%)
 rename CHANGELOG.X =&gt; ChangeLog.X.org (100%)
 mode change 100644 =&gt; 120000 VERSION
 create mode 100644 VERSION.x2goagent
 delete mode 100644 debian/dirs
 delete mode 100644 debian/docs
 create mode 100644 debian/source/format
 create mode 100644 debian/x2goagent.dirs
 create mode 100644 debian/x2goagent.docs

The diff of changes is:
diff --git a/CHANGELOG b/CHANGELOG
index 96f4a81..20aa2a2 100644
--- a/CHANGELOG
+++ b/CHANGELOG
@@ -1,8 +1,18 @@
 ChangeLog:
 
-nx-X11-3.4.0.5
+x2go-X11-3.5.0.2
 
-- Changed version numbering scheme, upstream now maintained by X2go project
+- forked nx-X11-3.5.0-1
+
+nx-X11-3.5.0-1
+
+- Opened the 3.5.0 branch based on nx-X11-3.4.0-4.
+
+- Updated copyright to year 2011.
+
+nx-X11-3.4.0-4
+
+- Fixed TR06H02359. Removed compiler warnings.
 
 nx-X11-3.4.0-3
 
diff --git a/CHANGELOG.NX b/CHANGELOG.NX
deleted file mode 100644
index e433f2c..0000000
--- a/CHANGELOG.NX
+++ /dev/null
@@ -1,1069 +0,0 @@
-ChangeLog:
-
-nx-X11-3.4.0-3
-
-- Updated copyright to year 2010.
-
-nx-X11-3.4.0-2
-
-- Fixed TR04G02208. Added a path to rgb file.
-
-nx-X11-3.4.0-1
-
-- Opened the 3.4.0 branch based on nx-X11-3.3.0-7.
-
-- Updated copyright to year 2009.
-
-nx-X11-3.3.0-7
-
-- Fixed TR08G02257. The maximum client condition was reached because
-  available fd exhausted. This bug was caused by a function in font
-  library not closing the file before a return on error breaking the
-  flow of normal execution.
-
-- Fixed TR06G02225. The implementation of Xvprintf() has been reviewed
-  to work on more platforms. Previous implementation caused a failure
-  in the build of keyboard map on some platform like Solaris 8 and 9.
-
-nx-X11-3.3.0-6
-
-- Fixed TR03G02198. Reimplemented Xvprintf() in Xserver/os to handle
-  the case in which vsnprintf returned -1.
-
-- Returning from _XSeqSyncFunction() and _XReply() if an I/O error is
-  detected.
-
-nx-X11-3.3.0-5
-
-- Fixed TR01G02163. Signals need to be blocked before the call to
-  fork() in the Popen() utility.
- 
-- Fixed TR01G02164. Trapezoid data need to be validated before use.
-  This issue was the same of CVE-2007-2437.
-
-nx-X11-3.3.0-4
-
-- Enabled the code resetting the Xlib buffer if an IO error occured.
-
-nx-X11-3.3.0-3
-
-- Fixed the search path for the XKB base directory.
-
-nx-X11-3.3.0-2
-
-- Fixed TR10F02116. The X11 agent could enter an indefinite wait state
-  if connection to X display is broken and libX11 output buffer is not
-  empty.
-
-nx-X11-3.3.0-1
-
-- Opened the 3.3.0 branch based on nx-X11-3.2.0-2.
-
-nx-X11-3.2.0-2
-
-- Imported patch fixing issues from  X.Org security advisory, June
-  11th, 2008: Multiple vulnerabilities in X server extensions. CVE
-  IDs: CVE-2008-1377, CVE-2008-1379, CVE-2008-2360, CVE-2008-2361,
-  CVE-2008-2362.
-
-nx-X11-3.2.0-1
-
-- Opened the 3.2.0 branch based on nx-X11-3.1.0-6.
-
-nx-X11-3.1.0-6
-
-- Modified Xserver Imakefile to link the Xfixes library.
-
-nx-X11-3.1.0-5
-
-- Disabled the terminate action, just in case the TerminateServer
-  symbol is binded to a non default key sequence.
-
-nx-X11-3.1.0-4
-
-- Imported patch fixing issues from  X.Org security advisory, January
-  17th, 2008: Multiple vulnerabilities in the X server.  CVE IDs:
-  CVE-2007-5760    CVE-2007-5958    CVE-2007-6427   CVE-2007-6428
-  CVE-2007-6429    CVE-2008-0006.
-
-nx-X11-3.1.0-3
-
-- Moved a variable definition placed in _mesa_make_current().
-
-nx-X11-3.1.0-2
-
-- Fixed TR10E01924. A crash could occur in _mesa_make_current().
-
-- Initialized after_ret variable in _XcmsGetProperty().
-
-nx-X11-3.1.0-1
-
-- Opened the 3.1.0 branch based on nx-X11-3.0.0-37.
-
-nx-X11-3.0.0-37
-
-- Changed the Xserver Imakefile to link against Xcomposite on the
-  Cygwin platform too.
-
-nx-X11-3.0.0-36
-
-- Fixed TR07E01806. Modified host.def to build GLX code with symbol
-  __GLX_ALIGN64 defined on Solaris platform.
-
-nx-X11-3.0.0-35
-
-- Flush explicitly the NX link before entering the select() in the
-  WaitForReadable() and WaitForWritable() routines.
-
-nx-X11-3.0.0-34
-
-- Changed the agent Imakefile to link to the Xcomposite library.
-
-nx-X11-3.0.0-33
-
-- Fix the NX_TRANS_WAKEUP stuff in WaitForSomething() to not over-
-  ride a valid timeout.
-
-- Check if the requesting client is gone in the XFixes functions
-  sending the cursor events.
-
-nx-X11-3.0.0-32
-
-- Define DDXOSVERRORF and DDXOSFATALERROR symbols on Sun.
-
-- Changed the copyright attribution from Medialogic to NoMachine.
-
-nx-X11-3.0.0-31
-
-- Make SmartScheduleStopTimer() visible outside Xserver/os/utils.c
-  so that it can be called by the agent. Export the declaration in
-  dixstruct.h. 
-
-nx-X11-3.0.0-30
-
-- The OsVendorVErrorFFatal flag is set to 1 if the function pointed
-  by OsVendorVErrorFProc is called due to a fatal error.
-
-- Give the possibility to the agent to redirect the standard error
-  during a Popen() or a System() by setting the OsVendorStartRedir-
-  ectErrorFProc and OsVendorEndRedirectErrorFProc function pointers.
-
-nx-X11-3.0.0-29
-
-- Changed the default message printed on a fatal server error. The
-  new message is:
-
-  Error: Aborting session with 'Error text...'.
-
-- Hacked LogVWrite() to force all fatal error messages to have an
-  uppercase initial. Also remove the trailing newline and the full-
-  stop, if present.
-
-nx-X11-3.0.0-28
-
-- Corrected the typos in the ChangeLog.
-
-nx-X11-3.0.0-27
-
-- Fixed the cleanup of the X_RenderCompositeText16 padding bytes.
-
-- More code cleanup in the NX changes to the Xrender library.
-
-- Changed host.def to build the freetype and fontconfig libraries
-  if the agent server is also built. Freetype is built as a shared
-  library: this avoids the link error on 64 bit platforms.
-
-nx-X11-3.0.0-26
-
-- Applied the following security patches, from the X.Org security
-  advisory, April 3rd, 2007 &quot;Multiple vulnerability in X server,
-  libXfont and libX11&quot;:
-
-  xorg-xserver-1.2.0-xcmisc.diff
-  xorg-libXfont-1.2.7-bdf-fontdir.diff
-  xorg-libX11-1.1.1-xinitimage.diff
-
-nx-X11-3.0.0-25
-
-- Added the missing *.X.original file for ChkIfEv.c and Xlib.h.
-
-nx-X11-3.0.0-24
-
-- Changed Xrender to clean up the padding bytes in XRenderComposite-
-  Text functions.
-
-- Added function XRenderCleanGlyphs() cleaning the padding bytes in
-  the data section of RenderAddGlyphs requests.
-
-nx-X11-3.0.0-23
-
-- Removed the additional parameter from the call to NXTransFlush()
-  in _XReply().
-
-- Call NXTransExit() on AbortServer() (called by FatalError()) to
-  give the proxy a chance to shut down the NX transport.
-
-nx-X11-3.0.0-22
-
-- Moved the replacement of XCheckIfEvent() ChkIfEv.c with the name
-  XCheckIfEventNoFlush().
-
-nx-X11-3.0.0-21
-
-- Set BUFSIZE to 8192 bytes. While the output buffer size can be
-  configured by setting the XLIBBUFFERSIZE in the environment (see
-  OpenDis.c), this constant is still used when reading from the
-  socket.
-
-nx-X11-3.0.0-20
-
-- If set, the handler pointed by _NXDisplayWriteFunction is called
-  after that more data is written to the display connection.
-
-nx-X11-3.0.0-19
-
-- Added a RejectWellKnownSockets() stub to make possible to compile
-  the agent when the NX transport is disabled.
-
-- Added more useful logs to _XWaitForWritable().
-
-nx-X11-3.0.0-18
-
-- Changed Imakefile of X11 and Xserver in order to build nxcompshad
-  just before the NX agent server.
-
-- Changed Imakefile in Xserver to add NXdamage.o to NXAGENTOBJS.
-
-nx-X11-3.0.0-17
-
-- Changed host.def in order to build Xdamage and Xrandr libraries.
-
-- Changed host.def in order not to build NXWin.
-
-nx-X11-3.0.0-16
-
-- Changed host.def in order to build Xtst as a shared library.
-
-nx-X11-3.0.0-15
-
-- Changes to comply with nxcompshad library.
-
-- Changed configuration to statically build Xtst library.
-
-- Restored parser directory under Xserver/hw/xfree86.
-
-nx-X11-3.0.0-14
-
-- Changed the LICENSE file to state that the software is only made
-  available under the version 2 of the GPL.
-
-- Added file COPYING.
-
-- In nx-X11/programs and nx-X11/programs/Xserver/hw/xfree86, removed
-  files and directories not needed to build servers.
-
-nx-X11-3.0.0-13
-
-- Changes aimed to link servers with static versions of Xdmcp and Xau
-  libraries.
-
-nx-X11-3.0.0-12
-
-- Added references to implented FR in the ChangeLog.
-
-- Removed nx-X11/fonts and nx-X11/doc directories. They are not needed
-  for building the NX components.
-
-nx-X11-3.0.0-11
-
-- Updated the copyright notices to year 2007.
-
-nx-X11-3.0.0-10
-
-- Applied the following security patches:
-
-   x11r6.9.0-cidfonts.diff 
-   x11r6.9.0-dbe-render.diff
-   x11r6.9.0-geteuid.diff
-   x11r6.9.0-mitri.diff
-   x11r6.9.0-setuid.diff
-
-nx-X11-3.0.0-9
-
-- Merged the NX changes to X11 with the X11R6.9.0 version of X.org.
-
-nx-X11-3.0.0-8
-
-- Changes to build Xshadow library when building X11.
-
-- Changes to Xserver Imakefile to link Xshadow library.
-
-- Changes to host.def in order to build on old distributions.
-
-nx-X11-3.0.0-7
-
-- Imported changes up to nx-X11-2.1.0-2
-
-- Fixed TR08D01485. Updated rgb file paths validation in order to
-  support Ubuntu distribution.
-
-- Added Xtst to libraries to be linked by nxagent.
-
-- Changed Xpm Imakefile to build a shared library on Solaris.
-
-- Fixed build error on Solaris in xtrans.
-
-- Changed host.def not to build Xnest server.
-
-- Changed Xserver Imakefile to link nxaccess library.
-
-nx-X11-3.0.0-6
-
-- Added the path of nxaccess library to the server link command.
-
-nx-X11-3.0.0-5
-
-- Implemented FR10C01079 and FR10C01080. The merge of NX changes to
-  the X.org code is complete.
-
-- Merged changes in config/cf. The NX-*.def files have been dismissed.
-  Main platform dependent configurations have been moved to host.def.
-
-- Removed *.reference files from config/cf.
-
-- Fixed compilation for Cygwin platform.
-
-nx-X11-3.0.0-4
-
-- Imported all changes up to nx-X11-2.0.0-32.
-
-- Cleaned up lib/zlib directory.
-
-- Added missing file programs/Xserver/os/utils.c.NX.original.
-
-- Updated the copyright notice to year 2006.
-
-- The pointer to the display buffer is reset after an I/O error.
-  This prevents leaving the buffer in an inconsistent state if the
-  error occurs inside _XFlush().
-
-- Removed the modifications to the Xrender library. The cleanup of
-  the padding bytes is now performed by the NX transport.
-
-- NX uses the updated ZLIB from its build tree, so Imake.tmpl will
-  now assume that the platform as ZLIB unless otherwise stated.
-
-- The path of the SecurityPolicy file is searched and validated at
-  runtime.
-
-- Added the _X11TransSocketProxyConnInfo() function to Xtranssock.c
-  It returns the pointer to the XtransConnInfo private, if it is a
-  valid _NXProxyConnInfo structure.
-
-- The above function is used by OpenDis.c to detect if the NX trans-
-  port was requested on the display and avoid spurious error messa-
-  ges in the case of a connection failure.
-
-- Added NXmiwindow.o to the NXAGENTOBJS in the Xserver's Imakefile
-  and imported NXmiwindow.c in nxagent. This allows us to check the
-  pointer to the pOldClip region in miSetShape() before going on
-  freeing it.
-
-- The path of the XKB base directory and of the xkbcomp comand is
-  validated at runtime.
-
-- Also added a check to verify the validity of the rgb file path.
-
-- Added NXresource.o to NXAGENTOBJS in the Imakefile of nxagent. We
-  need this to a assign a resource to the pixmaps and other server
-  objects which need to be enumerated at reconnection. Some objects,
-  being created by the X server and not by the clients, don't pass
-  through the resource assignment process operated by the dix. To
-  ensure that all objects get a resource, we add a resource at the
-  time the object is created and temporarily assign the resource to
-  the server client. If the dix later assigns the resource to a va-
-  lid client, the resource is removed from the server client's list.
-  
-- The display block handler registered by the client is called in
-  WaitForReadable() and WaitForWritable() before every select(),
-  not only upon entering the function. The reason is that more
-  data can be possibly produced for the NX link by the proxy it-
-  self and, when setting the flush policy to deferred, the client
-  may not have the chance of flushing the NX link.
-
-- Fixed a bug in XkbUseExtension() that caused Xlib to query the
-  presence of the XKEYBOARD extension multiple times. This partial-
-  ly implents the FR01D01275. The complete implementation required
-  modifications to the X11 agent, implemented in nxagent-2.0.0-33.
-
-- Updated to comply with the new NXTransFlush() interface.
-
-- Both nxwin and nxagent now read the X authority file by using an
-  fopen() instead of the system command 'cat'.
-
-- Removed NXmiwindow.o from the NXAGENTOBJ list. The agent will now
-  use the original miwindow.c.
-
-- Added some additional logs in Xtranssock.c to follow the creation
-  and removal of the X server's Unix listener.
-
-- Avoided the sleep of 5 seconds forced by Xtransutil.c if the dir-
-  ectory where the Unix listener is created is not owned by root.
-  This sleep is not executed on Cygwin (where the X socket can be
-  hardly owned by root) but may delay the startup of the agent if
-  the user chose a different NX_TEMP directory. Furthermore, it is
-  unclear what real benefits such sleeps are intended to bring to
-  the security of the X server. This can be controlled by defining
-  the NX_TRANS_SLEEP directive in Xserver/os/Imakefile.
-
-- Added NXmiexpose.o to the NXAGENTOBJ.
-
-- Ensured that _X11TransSocketCloseConnInfo() now initiates the NX
-  shutdown by calling NXTransClose().
-
-- Corrected a misplaced #else that made SocketUNIXConnect() skip a
-  block if the connection was not to the NX transport.
-
-- Updated to comply with the new NX function prototypes introduced
-  in nxcomp-2.0.0-31.
-
-- Moved the most important Xtranssock.c modifications into separate
-  functions.
-
-- Ensured that the modifications enabling the internal connections
-  to the proxy are compiled only when the TRANS_CLIENT directive is
-  defined.
-
-- Solved a bug that prevented the X11 socket to be deleted at the X
-  server shutdown. This needs further tests.
-
-- Added nxcompext to the link of nxagent, now that the dependency
-  of libX11 from nxcompext is removed.
-
-- Improved the Xtranssock routines to never loop through the array
-  of connection info.
-
-- Added a congestion flag to the connection info structure and a
-  function querying the transport and reporting if a change in the
-  congestion state has occurred. The code is currently not enabled,
-  because instead of polling the transport, we let the proxy notify
-  the changes in congestion state by using the callback. The code
-  can be used in future to extend the library, for example, by add-
-  ing some counters tracking the bandwidth usage of the socket con-
-  nection, so that we can make the congestion notifications work
-  even with a plain X11 connection.
-
-- Profiled the routines in XlibInt.c to reduce the number of calls
-  to the error predicate function provided by the client.
-
-- Fixed the nxcompext build problem that caused make World to fail.
-
-- Added a 'CONF' target to the X11 and Xext Imakefiles so that the
-  configure script is not run if the config.status exists.
-
-- Added the _NXDisplayBlockHandler hook. The function is called by
-  Xlib before blocking. The parameter says if Xlib is going to wait
-  for more input or because it needs to write to the display  socket.
-  The client can use the hook to perform any internal operation that
-  may require some time to complete. The user, though, should not
-  try to read or write to the display inside the callback routine.
-
-- Removed the outdated NX_TRANS_PROCESS, NX_TRANS_THREAD and NX_TR-
-  ANS_INCLUDE defines.
-
-- Reverted the lib/Xext Imakefile to the original XF86 version and
-  moved the build of the nxcompext library among the libX11 depend-
-  encies.
-
-- Corrected the lib/X11 Imakefile so that a new build of nxcomp and
-  nxcompext is not attempted if the libraries are up-to-date.
-
-- Removed the unused display buffer and image cleanup functions.
-  
-- Reverted the PutImage.c file to the original XF86 version.
-  
-- Added the _NXDisplayErrorPredicate function in XlibInt.c. It is
-  actually a pointer to a function called whenever Xlib is going to
-  perform a network operation. If the function returns true, the
-  call will be aborted and Xlib will return the control to the ap-
-  plication. It is up to the application to set the XlibDisplayIO-
-  Error flag after the _NXDisplayErrorPredicate returns true. The
-  function can be used to activate additional checks, besides the
-  normal failures detected by Xlib on the display socket. For exam-
-  ple, the application can set the funciton to verify if an inter-
-  rupt was received or if any other event occurred mandating the
-  end of the session.
-
-- Modified XIfEvent(), XMaskEvent() and XPeekIfEvent() to check the
-  _NXDisplayErrorPredicate function and return immediately if the
-  function returns true.
-
-- Modified _XWaitForReadable() to never enter the loop if the dis-
-  play is broken.
-
-- Corrected a make problem on Windows that caused the nxcomp and
-  nxcompext libraries to be referred with the wrong name, with the
-  result that a new configure and make was attempted at each build
-  attempt.
-
-- Merged all the changes to os, Xext, xkb, dix.
-
-- Changed host.def to build only the agent server.
-
-- Merged the changes to Xtranssock.c
-
-nx-X11-3.0.0-3
-
-- Merged the changes to lib/X11. Restored original PutImage.c and
-  ClDisplay.c files.
-
-nx-X11-3.0.0-2
-
-- Created a directory named 'reference' to keep files that are chan-
-  ged during the development of nx-X11 since the 1.5.0-16 to 2.0.0-32
-  version. These files will be removed as long as the differences are
-  merged to the 3.0.0 version. When all differences are merged, this
-  directory will be removed.
-
-nx-X11-3.0.0-1
-
-- Opened the 3.0.0 branch based on the nx-X11-2.0.0-9. The 3.0.0
-  branch will now support the migration toward the X.org tree. Due
-  to time concerns, the 2.0.0 branch is going to be based on the
-  same nx-X11 as the 1.5.0.
-
-nx-X11-2.0.0-9
-
-- Modified the agent link arguments to explicitly include the NX
-  libraries.
-
-- Disabled the Xinerama extension to avoid further clashes with
-  the redefinition of GC in Xlib.
-
-- Added os/libos.a at the end of the agent link.
-
-nx-X11-2.0.0-8
-
-- Moved the declarations of _NXEnable* and related structures from
-  Xlibint.h to NXlibint.h.  
-
-- Added provision for building the agent. This can be controlled by
-  setting NXAgentServer to YES in host.def.
-
-- Setting the NXUpgradeAgentServer variable to YES in the host.def
-  file will make the agent assume that it is being built in the new
-  environment. This variable is normally unset when building in the
-  1.5.0 tree.
-
-nx-X11-2.0.0-7
-
-- Fixed a problem on AMD64 due to the size of the area pointed by
-  the argument of _X11TransBytesReadable(). BytesReadable_t is long,
-  at least on Linux, while the ioctl() requires a pointer to an int.
-  The original _X11TransBytesReadable() function simply calls the
-  ioctl() by passing the pointer that is provided. NXTransReadable(),
-  instead, was correctly returning the value assuming a pointer to
-  a long, but this crashes some applications, among them xterm. Now
-  NXTransReadable() follows the same schema of the ioctl() call and
-  stores the result assuming a pointer to an int.
-
-- Removed the outdated NX_TRANS_PROCESS and NX_TRANS_THREAD code.
-
-nx-X11-2.0.0-6
-
-- Made xterm work with the NX transport. This required small changes
-  to the Xt toolkit's and the xterm's files to let them use the NX
-  aware select(). This is useful to test the NX transport until the
-  nxagent server is integrated.
-
-- When the transport is gone _X11TransSocketBytesReadable() returns
-  EPIPE. This makes the client become aware of the closure of the
-  connection.
-
-- Added a call to NXTransDestroy() in XCloseDisplay().
-
-- The exit() function in XlibInt.c causes a call to NXTransExit().
-
-- Merged changes to dix/pixmap.c, xkb/xkbDflts.h, mi/Imakefile.
-
-- Removed unneeded changes and files containing patches already in
-  the latest X.org distribution: dix/dispatch.c, fb/fbcompose.c, fb/
-  fbgc.c, xkb/ddxList.c, font/fontfile/dirfile.c, font/fontfile/
-  encparse.c, font/fontfile/fontfile.c, font/FreeType/fttools.c,
-  Xrender/FillRect.c, Xrender/Picture.c.
-
-nx-X11-2.0.0-5
-
-- Changes to the lib/X11/Imakefile to cleanly build the tree. This
-  is obtained by creating a link to the Xcomp library in exports/lib
-  without having to modify the programs' Imakefiles.
-
-- Finished merging the NX changes in the lib/X11 files.
-
-- Merged the CHANGELOG with the one from the 1.5.0 tree.
-
-nx-X11-2.0.0-4
-
-- Merged the NX changes in most Xtrans and lib/X11 files.
-
-nx-X11-2.0.0-3
-
-- Temporarily disabled the use of the MMX extensions in the Xserver's
-  fb code to successfully compile with GCC 4.
-
-nx-X11-2.0.0-2
-
-- Imported the *.NX.reference and *.XF86.reference files that will
-  be needed for the merge. These files are the *.original from the
-  1.5.0 tree. They will be removed as long as the merge advances.
-
-nx-X11-2.0.0-1
-
-- Created the 2.0.0 branch based on X.org the 6.8.99.16 snapshot.
-
-nx-X11-1.5.0-16
-
-- Added the missing *.XF86.original and *.NX.original files.
-
-nx-X11-1.5.0-15
-
-- Made the nxagent server use select() instead of poll() on Solaris
-  so that it can leverage the new NX transport.
-
-- Moved the NXTransFlush() call to _XReply().
-
-nx-X11-1.5.0-14
-
-- Added the 'synchronous' parameter in the _XWaitForReadable() call
-  to NXTransFlush().
-
-nx-X11-1.5.0-13
-
-- Removed the log entry in XlibInt.c on calling the NXTransFlush().
-
-nx-X11-1.5.0-12
-
-- Changed XlibInt.c and utils.c to call NXTransExit().
-
-nx-X11-1.5.0-11
-
-- Changed XlibInt.c to comply with the new NXTransFlush() interfa-
-  ce introduced in nxcomp-1.5.0-42.
-
-- Cosmetic changes to messages printed for debug.
-
-nx-X11-1.5.0-10
-
-- Ensured that all calls to _XIOError() are followed by a return.
-
-- Put exiting the client program in the case of an I/O error under
-  the control of the _NXContinueOnDisplayError flag. If set, the
-  I/O error routine will simply return, leaving to the application
-  the responsibility of checking the state of the XlibDisplayIOEr-
-  ror flag.
-
-- Added some checks whenever a read or write is performed on the X
-  connection, so that we can exit the I/O loop if the X channel is
-  gone. It is likely that more work will be needed when trying to
-  support XTHREADS enabled connections. This should not be a pro-
-  blem for now, as the default is still to quit the application un-
-  less the _NXContinueOnDisplayError flag is explicitly set.
-
-nx-X11-1.5.0-9
-
-- Removed the references to the cygipc library in NXWin. Now use the
-  cygserver daemon to provide the MIT-SHM extension.
-
-- Fixed an error in the UseCygIPC definition.
-
-- Changed the cygwin.cf file to avoid redefinition of the BuildGlxExt,
-  XWinServer and BuildGlxExt symbols.
-
-nx-X11-1.5.0-8
-
-- Added provision for deferred writes in the NX transport. When en-
-  tering _XWaitForReadable() we must ensure that data is flushed to
-  the proxy link.
-
-- Added the UseCygIPC define to NX-Cygwin.def.
-
-- Updated the NoMachine copyright notice on the modified files.
-
-nx-X11-1.5.0-7
-
-- Added the GLX extension in NX-Sun.def.
-
-- Added some more logs in WaitFor.c.
-
-nx-X11-1.5.0-6
-
-- Modified Xlibint.h and XlibInt.c to remove the _NXFlushSize para-
-  meter. New agents run the NX transport in-process, so we don't get
-  any benefit from increasing the display buffer size.
-
-- Modified NX-Darwin.def to not build the NXDarwin server. Since the
-  1.4.0 version the NXDarwin server is unsupported and the NX client
-  for the Mac requires that the Apple X server is installed.
-
-- Changed NX-Linux.def to avoid the warning due to &quot;SharedLibGLw&quot;
-  being not defined.
-
-nx-X11-1.5.0-5
-
-- Modified the Xserver Imakefile to link nxagent with FbPostFbLibs
-  and avoid including mfb/libmfb.a.
-
-- Added the GLX extension in NX-Linux.def. This provides unaccelera-
-  ted support in nxagent, with GLX operations translated into core X
-  protocol primitives.
-
-- Fixed x-X11/programs/Xserver/GL/dri/Imakefile to look in ../../hw/
-  /xfree86/os-support/bus for includes.
-
-nx-X11-1.5.0-4
-
-- Avoid calling NXTransSelect() if the transport is gone, so that we
-  don't have to wait until the timeout.
-
-- Added the &quot;-fno-strict-aliasing&quot; option to linux.cf when compiling
-  with a GCC version &gt;= 4. In the words of Stefan Dirsch: &quot;The opt-
-  ion, which is default since gcc 3.1, can result in wrong code when
-  the gcc warnings related to it are ignored. And as there are seve-
-  ral warnings in X11 related to it, it has been disabled for X11
-  from the beginning. This didn't change for gcc4, so it still needs
-  to be used.&quot;
-
-- Added more logs in XlibInt.c and utils.c. A warning is printed if
-  the SmartScheduler is initialized.
-
-nx-X11-1.5.0-3
-
-- Started integration of nxcomp with the X libraries. The Xtrans
-  code creates an internal connection to the nxcomp library instead
-  of a child proxy process.
-
-- Changed Xpoll.h and XlibInt.c to replace the standard Select
-  with a version giving NX a chance to check its own descriptors.
-
-- Implemented the NXTransReadVector() and the NXTransWriteVector()
-  functions to replace READV() and WRITEV().
-
-- Implemented memory-to-memory communication with the NX proxy by
-  making use of the NXTransAgent() interface.
-
-nx-X11-1.5.0-2
-
-- We think that the way LoadAuthorization() is working is wrong.
-  It doesn't reset the list of stored authorizations before reading
-  the new cookies. Our take is that if a new auth file is to be
-  read, the only cookies that are to be accepted are those that are
-  in the new file, not those in the file -plus- those that have
-  been in the file in the past. Furthermore, if the list can't be
-  read or it is empty, it should assume that it ignores which co-
-  okies are valid and thus it should disable any access. Your mile-
-  age can vary. A less draconian approach could be to leave the old
-  cookies if the file can't be read and remove them only if the
-  file is empty.
-
-  Adding the cookies without removing the old values for the same
-  protocol has an important implication. If an user shares the co-
-  okie with somebody and later wants to revoke the access to the
-  display, changing the cookie will not work. This is especially
-  important with NX. For security reasons, after reconnecting the
-  session to a different display, it is advisable to generate a
-  new set of cookies, but doing that it is useless with the current
-  code, as the old cookies are going to be still accepted. On the
-  same topic, consider that once an user has got access to the X
-  server, he/she can freely enable host authentication from any
-  host, so the safe behaviour should be to reset the host based
-  authenthication at least at reconnection, and keep as valid only
-  the cookies that are actually in the file. This behaviour would
-  surely break many applications, among them a SSH connection run
-  inside a NX session, as ssh -X reads the cookie for the display
-  only at session startup and does not read the cookies again
-  when the auth file is changed.
-
-  Another bug (or feature, depending on how you want to consider
-  it) is that if the authority file contains entries for different
-  displays (as it is the norm when the authority file is the default
-  .Xauthority in the user's home), the X server will match -any- of
-  the cookies, even cookies that are not for its own display. This 
-  means that you have to be careful when passing an authority file
-  to nxagent and maybe keep separate files for letting nxagent find
-  the cookie to be used to connect to the remote display and for
-  letting it find what cookies to accept. If the file is the same,
-  clients will be able to connect to nxagent with both the cookies.
-  This bug obviously affects any X server, also the real X server
-  running on the workstation, so it is common to see nxagent being
-  able to connect to the X server even if no cookie matches the
-  real display.
-
-- Added a check in lib/Xau/AuRead.c to prevent the fread() call to
-  be interrupted by SIGCHLD while reading the auth file. Due to the
-  way the old code worked, this could lead to the server enabling
-  local host access to the display. This problem had been identified
-  in the past. We just found that all the code dealing with reading
-  the auth file was affected. The code calls sigprocmask() to block
-  the signal (though it leaves some other calls unprotected) but the
-  SIGCHLD was not included in the set.
-
-- Added SIGCHLD to the set of signals that are blocked when reading
-  the authorization file.
-
-- As I was at it, I changed the path to the SecurityPolicy file. A
-  few Linux ditributors ship the file in $LIBDIR/xserver, a few only
-  in /etc/X11/xserver, most others in both places. It seems that
-  those who ship in $LIBDIR/xserver do also in /etc/X11 but the op-
-  posite is not true, so I switched to /etc/X11.
-
-nx-X11-1.5.0-1
-
-- Opened the 1.5.0 branch.
-
-nx-X11-1.4.1-2
-
-- Set parameter UseCygIPC on cygwin conf file in order to force the
-  build of MIT-SHM estension.
-
-- Removed some spurius object file.
-
-nx-X11-1.4.1-1
-
-- Opened the 1.4.1 branch.
-
-nx-X11-1.4.0-8
-
-- Changed DefaultFontPath and DefaultRGBDatabase in 
-  NX-Cygwin.def.
-
-nx-X11-1.4.0-7
-
-- Imported dispatch in nxdarwin package, in order to let
-  nxdarwin being able to detect new client connection.
-
-- Changed the Xpm Imakefile to make also .a static library
-  on Solaris. To link nxviewer and nxdestkop staticaly.
-
-nx-X11-1.4.0-6
-
-- XInput extension enabled on MacOSX.
-
-- Added some missing backup files of the original XFree86
-  package.
-
-nx-X11-1.4.0-5
-
-- Changed the mi Imakefile in order to let xfree86 servers use
-  the normal mi extension initialization for the XInput exten-
-  sion.
-
-- XInput extension enabled on Solaris.
-
-nx-X11-1.4.0-4
-
-- Removed the RejectWellKnownSocket for the cygwin and
-  MacOSX environments that doesn't use the Xtransport library.
-
-nx-X11-1.4.0-3
-
-- Changed the implementation of the reject method in the
-  Xtransport library, now close any new incoming connection 
-  immediately without reading or writing to it.
-
-nx-X11-1.4.0-2
-
-- Implemented a reject method in the Xtransport library,
-  this function accept and close every connection attempt,
-  on the specified listening socket.
-
-- Added the new function RejectWellKnownSocket to the os
-  connection code.
-  This function use the new transport reject function on
-  all listening socket.
-
-nx-X11-1.4.0-1
-
-- Opened the 1.4.0 branch.
-
-- Removed forgotten nxagent-1.3.2-20 directory.
-
-nx-X11-1.3.2-9
-
-- Prevents NX Darwin server going through the reset. On Darwin
-  we found that the it is not possible to get the correct key-
-  board layout unless it is set on the local machine, before
-  the NX session is started, by using xmodmap. As we set the
-  keyboard locally, we must prevent the X server to reset, or
-  we would loose any local configuration.
-
-nx-X11-1.3.2-8
-
-- Removed action associated to keysym XK_Terminate_Server. This
-  could cause agent to be terminated when pressing shift + back-
-  space if using the default US keyboard mapping.
-
-- Disabled the remaining debug logs in lib/X11/PutImage.c
-
-nx-X11-1.3.2-7
-
-- Fixed the wrong programs/Xserver/Imakefile in 1.3.2-6 package.
-
-nx-X11-1.3.2-6
-
-- Changed the define from NX_CLEAN_IN_PLACE to NX_CLEAN_INPLACE.
-  Definition of symbol is now placed in the Imakefile.
-
-- The new _NXEnableCleanInplace Xlib variable does control which
-  algorithm is used to clean the images. Setting NX_IMAGEINPLACE
-  in the environment will activate the in-place cleanup.
-
-- The default value of _NXEnableCleanInplace is -1. Leaving it to
-  a value &lt;= 0 disables use of CleanInplace.
-
-nx-X11-1.3.2-5
-
-- Patch in config/cf/sun.cf. Fix for libfontconfig compilation
-  during gmake Everything on Solaris.
-
-- Patch in lib/X11/Imakefile. Fix for nxcomp compilation during
-  gmake World on Solaris.
-
-nx-X11-1.3.2-4
-
-- Image cleanup is now performed by using NXCleanInPlaceImage from
-  nxcompext. This function saves a buffer copy by cleaning the
-  padding bytes in the same buffer provided by the caller. Note that
-  to prevent memory violations in the case the image was allocated
-  in a static buffer, the function will temporarily redefine the
-  SIGSEGV handler. The former handler is restored before returning
-  to the caller. This can potentially affect some multithreaded
-  clients. Is to be decided if the function is safe enough to be
-  included in the production release.
-
-nx-X11-1.3.2-3
-
-- More debug logs in programs/Xserver/xkb/ddxLoad.c.
-
-nx-X11-1.3.2-2
-
-- Added NXmiwindow.o to NXAGENTOBJS in programs/Xserver/Imakefile.
-  File was not linked into the resulting nxagent. This solves the
-  problem of missing repaints in CDE and other Xt applications.
-
-nx-X11-1.3.2-1
-
-- Added some debug logs in programs/Xserver/xkb/ddxLoad.c. Function
-  XkbDDXCompileKeymapByNames is called by OpenOffice to read the
-  keyboard configuration whenever a drop-down menu is accessed. It
-  seem to always fail with the following error:
-
-  The XKEYBOARD keymap compiler (xkbcomp) reports:
-  &gt; Error:            Can't find file &quot;unknown&quot; for geometry include
-  &gt;                   Exiting
-  &gt;                   Abandoning geometry file &quot;default&quot;
-
-- Opened the 1.3.2 development branch.
-
-nx-X11-1.3.1-12
-
-- Fixed a problem in xkb/ddxLoad.c on Solaris where Pclose was
-  always returning an error code despite the fact that command
-  was executed properly.
-
-nx-X11-1.3.1-11
-
-- Changed default GCC flags from '-O2 -fno-strength-reduce' to
-  -O3. No platform where NX is targeted is currently using a
-  GCC 2.x affected by the -fno-strength-reduce bug. Note also
-  that nxcomp is already compiled with -O3 since 1.1.1, so it
-  can be considered safe.
-
-nx-X11-1.3.1-10
-
-- Imported an updated fbcompose.c file from XFree86-4.3.99.902.
-  This fixes &quot;uninitialized value&quot; problems reported by Valgrind.
-
-- Fixed further buffer overflows by updating the following file
-  with recent versions coming from the XFree86-4.3.99.902 tree.
-
-  nx-X11/lib/font/fontfile/dirfile.c
-  nx-X11/lib/font/fontfile/encparse.c
-  nx-X11/lib/font/fontfile/fontfile.c
-
-- Fixed a possible buffer overflow in lib/font/FreeType/fttools.c.
-  Verified that the change is already in the XFree86 4.4.0 CVS.
-
-nx-X11-1.3.1-9
-
-- Fixed Xserver/Imakefile which was still referencing NXpixmap.o.
-
-nx-X11-1.3.1-8
-
-- Imported an updated fbgc.c from XFree86-4.3.99.902. This fixes
-  some minor problems reported by Valgrind.
-
-- A major problem was reported by Valgrind about reading after
-  the block allocated in fbCreatePixmap from AllocatePixmap. The
-  file pixmap.c has been modified so that 4 bytes are added to
-  the pixmap buffer at any new allocation. This quick hack should
-  solve the problem for both nxagent and the NXWin server. Further
-  investigation is planned for the next release.
-
-- Fixed Xtranssock.c to compile on Solaris where struct sigaction
-  doesn't have the sa_restorer member.
-
-nx-X11-1.3.1-5
-
-- Renamed the NX-sun.def configuration file to NX-Sun.def.
-
-- Renamed the non-standard NX_iPAQ_XServer and NX_Zaurus_XServer
-  symbols to NXiPAQXServer and NXZaurusXServer.
-
-- Added the missing sun.cf.XF86.original file in config/cf.
-
-- Added the missing empty file host.def.XF86.original in the
-  same directory.
-
-- Added initialization of sa.sa_mask when setting sigaction()
-  for SIGCHLD. The problem was reported by Valgrind running
-  nxagent.
-
-- Removed an unused block of code from WaitFor.c. The code had
-  been commented out in previous versions.
-
-- Removed the non-standard colon at the end of version in this
-  CHANGELOG.
-
-- Removed the spurious spaces in this CHANGELOG.
-
-nx-X11-1.3.1-4
-
-- Added a little workaround to the top Imakefile intended to
-  hide the makedepend warnings about non portable whitespaces
-  in sources.
-
-nx-X11-1.3.1-3
-
-- Fixed compilation problem with nxagent-1.3.1-13.
-
-nx-X11-1.3.1-2
-
-- Changes in NX-sun.def configuration file for Solaris to allow
-  compilation of the XKB extension. 
-
-nx-X11-1.3.1-1
-
-- Opened the 1.3.1 development branch.
-
-nx-X11-1.3.0-6
-
-- Original output buffer size in stock XFree86 is 2048. We try
-  to reduce context switches and help stream compression by
-  increasing the maximum size of the buffer 8192. _NXFlushSize
-  determines when the display buffer is actually flushed. It is
-  set by default to 4096 but agents should set it to 0 if they
-  want to disable early flush.
-
-- Added the _NXLostSequenceFunction function pointer to let NX
-  agents suppress the error message and modify the default Xlib
-  behaviour when out-of-order sequence numbers are received.
diff --git a/CHANGELOG.NX.original b/CHANGELOG.NX.original
new file mode 100644
index 0000000..4faf2ad
--- /dev/null
+++ b/CHANGELOG.NX.original
@@ -0,0 +1,1073 @@
+ChangeLog:
+
+nx-X11-3.4.0-4
+
+- Fixed TR06H02359. Removed compiler warnings.
+
+nx-X11-3.4.0-3
+
+- Updated copyright to year 2010.
+
+nx-X11-3.4.0-2
+
+- Fixed TR04G02208. Added a path to rgb file.
+
+nx-X11-3.4.0-1
+
+- Opened the 3.4.0 branch based on nx-X11-3.3.0-7.
+
+- Updated copyright to year 2009.
+
+nx-X11-3.3.0-7
+
+- Fixed TR08G02257. The maximum client condition was reached because
+  available fd exhausted. This bug was caused by a function in font
+  library not closing the file before a return on error breaking the
+  flow of normal execution.
+
+- Fixed TR06G02225. The implementation of Xvprintf() has been reviewed
+  to work on more platforms. Previous implementation caused a failure
+  in the build of keyboard map on some platform like Solaris 8 and 9.
+
+nx-X11-3.3.0-6
+
+- Fixed TR03G02198. Reimplemented Xvprintf() in Xserver/os to handle
+  the case in which vsnprintf returned -1.
+
+- Returning from _XSeqSyncFunction() and _XReply() if an I/O error is
+  detected.
+
+nx-X11-3.3.0-5
+
+- Fixed TR01G02163. Signals need to be blocked before the call to
+  fork() in the Popen() utility.
+ 
+- Fixed TR01G02164. Trapezoid data need to be validated before use.
+  This issue was the same of CVE-2007-2437.
+
+nx-X11-3.3.0-4
+
+- Enabled the code resetting the Xlib buffer if an IO error occured.
+
+nx-X11-3.3.0-3
+
+- Fixed the search path for the XKB base directory.
+
+nx-X11-3.3.0-2
+
+- Fixed TR10F02116. The X11 agent could enter an indefinite wait state
+  if connection to X display is broken and libX11 output buffer is not
+  empty.
+
+nx-X11-3.3.0-1
+
+- Opened the 3.3.0 branch based on nx-X11-3.2.0-2.
+
+nx-X11-3.2.0-2
+
+- Imported patch fixing issues from  X.Org security advisory, June
+  11th, 2008: Multiple vulnerabilities in X server extensions. CVE
+  IDs: CVE-2008-1377, CVE-2008-1379, CVE-2008-2360, CVE-2008-2361,
+  CVE-2008-2362.
+
+nx-X11-3.2.0-1
+
+- Opened the 3.2.0 branch based on nx-X11-3.1.0-6.
+
+nx-X11-3.1.0-6
+
+- Modified Xserver Imakefile to link the Xfixes library.
+
+nx-X11-3.1.0-5
+
+- Disabled the terminate action, just in case the TerminateServer
+  symbol is binded to a non default key sequence.
+
+nx-X11-3.1.0-4
+
+- Imported patch fixing issues from  X.Org security advisory, January
+  17th, 2008: Multiple vulnerabilities in the X server.  CVE IDs:
+  CVE-2007-5760    CVE-2007-5958    CVE-2007-6427   CVE-2007-6428
+  CVE-2007-6429    CVE-2008-0006.
+
+nx-X11-3.1.0-3
+
+- Moved a variable definition placed in _mesa_make_current().
+
+nx-X11-3.1.0-2
+
+- Fixed TR10E01924. A crash could occur in _mesa_make_current().
+
+- Initialized after_ret variable in _XcmsGetProperty().
+
+nx-X11-3.1.0-1
+
+- Opened the 3.1.0 branch based on nx-X11-3.0.0-37.
+
+nx-X11-3.0.0-37
+
+- Changed the Xserver Imakefile to link against Xcomposite on the
+  Cygwin platform too.
+
+nx-X11-3.0.0-36
+
+- Fixed TR07E01806. Modified host.def to build GLX code with symbol
+  __GLX_ALIGN64 defined on Solaris platform.
+
+nx-X11-3.0.0-35
+
+- Flush explicitly the NX link before entering the select() in the
+  WaitForReadable() and WaitForWritable() routines.
+
+nx-X11-3.0.0-34
+
+- Changed the agent Imakefile to link to the Xcomposite library.
+
+nx-X11-3.0.0-33
+
+- Fix the NX_TRANS_WAKEUP stuff in WaitForSomething() to not over-
+  ride a valid timeout.
+
+- Check if the requesting client is gone in the XFixes functions
+  sending the cursor events.
+
+nx-X11-3.0.0-32
+
+- Define DDXOSVERRORF and DDXOSFATALERROR symbols on Sun.
+
+- Changed the copyright attribution from Medialogic to NoMachine.
+
+nx-X11-3.0.0-31
+
+- Make SmartScheduleStopTimer() visible outside Xserver/os/utils.c
+  so that it can be called by the agent. Export the declaration in
+  dixstruct.h. 
+
+nx-X11-3.0.0-30
+
+- The OsVendorVErrorFFatal flag is set to 1 if the function pointed
+  by OsVendorVErrorFProc is called due to a fatal error.
+
+- Give the possibility to the agent to redirect the standard error
+  during a Popen() or a System() by setting the OsVendorStartRedir-
+  ectErrorFProc and OsVendorEndRedirectErrorFProc function pointers.
+
+nx-X11-3.0.0-29
+
+- Changed the default message printed on a fatal server error. The
+  new message is:
+
+  Error: Aborting session with 'Error text...'.
+
+- Hacked LogVWrite() to force all fatal error messages to have an
+  uppercase initial. Also remove the trailing newline and the full-
+  stop, if present.
+
+nx-X11-3.0.0-28
+
+- Corrected the typos in the ChangeLog.
+
+nx-X11-3.0.0-27
+
+- Fixed the cleanup of the X_RenderCompositeText16 padding bytes.
+
+- More code cleanup in the NX changes to the Xrender library.
+
+- Changed host.def to build the freetype and fontconfig libraries
+  if the agent server is also built. Freetype is built as a shared
+  library: this avoids the link error on 64 bit platforms.
+
+nx-X11-3.0.0-26
+
+- Applied the following security patches, from the X.Org security
+  advisory, April 3rd, 2007 &quot;Multiple vulnerability in X server,
+  libXfont and libX11&quot;:
+
+  xorg-xserver-1.2.0-xcmisc.diff
+  xorg-libXfont-1.2.7-bdf-fontdir.diff
+  xorg-libX11-1.1.1-xinitimage.diff
+
+nx-X11-3.0.0-25
+
+- Added the missing *.X.original file for ChkIfEv.c and Xlib.h.
+
+nx-X11-3.0.0-24
+
+- Changed Xrender to clean up the padding bytes in XRenderComposite-
+  Text functions.
+
+- Added function XRenderCleanGlyphs() cleaning the padding bytes in
+  the data section of RenderAddGlyphs requests.
+
+nx-X11-3.0.0-23
+
+- Removed the additional parameter from the call to NXTransFlush()
+  in _XReply().
+
+- Call NXTransExit() on AbortServer() (called by FatalError()) to
+  give the proxy a chance to shut down the NX transport.
+
+nx-X11-3.0.0-22
+
+- Moved the replacement of XCheckIfEvent() ChkIfEv.c with the name
+  XCheckIfEventNoFlush().
+
+nx-X11-3.0.0-21
+
+- Set BUFSIZE to 8192 bytes. While the output buffer size can be
+  configured by setting the XLIBBUFFERSIZE in the environment (see
+  OpenDis.c), this constant is still used when reading from the
+  socket.
+
+nx-X11-3.0.0-20
+
+- If set, the handler pointed by _NXDisplayWriteFunction is called
+  after that more data is written to the display connection.
+
+nx-X11-3.0.0-19
+
+- Added a RejectWellKnownSockets() stub to make possible to compile
+  the agent when the NX transport is disabled.
+
+- Added more useful logs to _XWaitForWritable().
+
+nx-X11-3.0.0-18
+
+- Changed Imakefile of X11 and Xserver in order to build nxcompshad
+  just before the NX agent server.
+
+- Changed Imakefile in Xserver to add NXdamage.o to NXAGENTOBJS.
+
+nx-X11-3.0.0-17
+
+- Changed host.def in order to build Xdamage and Xrandr libraries.
+
+- Changed host.def in order not to build NXWin.
+
+nx-X11-3.0.0-16
+
+- Changed host.def in order to build Xtst as a shared library.
+
+nx-X11-3.0.0-15
+
+- Changes to comply with nxcompshad library.
+
+- Changed configuration to statically build Xtst library.
+
+- Restored parser directory under Xserver/hw/xfree86.
+
+nx-X11-3.0.0-14
+
+- Changed the LICENSE file to state that the software is only made
+  available under the version 2 of the GPL.
+
+- Added file COPYING.
+
+- In nx-X11/programs and nx-X11/programs/Xserver/hw/xfree86, removed
+  files and directories not needed to build servers.
+
+nx-X11-3.0.0-13
+
+- Changes aimed to link servers with static versions of Xdmcp and Xau
+  libraries.
+
+nx-X11-3.0.0-12
+
+- Added references to implented FR in the ChangeLog.
+
+- Removed nx-X11/fonts and nx-X11/doc directories. They are not needed
+  for building the NX components.
+
+nx-X11-3.0.0-11
+
+- Updated the copyright notices to year 2007.
+
+nx-X11-3.0.0-10
+
+- Applied the following security patches:
+
+   x11r6.9.0-cidfonts.diff 
+   x11r6.9.0-dbe-render.diff
+   x11r6.9.0-geteuid.diff
+   x11r6.9.0-mitri.diff
+   x11r6.9.0-setuid.diff
+
+nx-X11-3.0.0-9
+
+- Merged the NX changes to X11 with the X11R6.9.0 version of X.org.
+
+nx-X11-3.0.0-8
+
+- Changes to build Xshadow library when building X11.
+
+- Changes to Xserver Imakefile to link Xshadow library.
+
+- Changes to host.def in order to build on old distributions.
+
+nx-X11-3.0.0-7
+
+- Imported changes up to nx-X11-2.1.0-2
+
+- Fixed TR08D01485. Updated rgb file paths validation in order to
+  support Ubuntu distribution.
+
+- Added Xtst to libraries to be linked by nxagent.
+
+- Changed Xpm Imakefile to build a shared library on Solaris.
+
+- Fixed build error on Solaris in xtrans.
+
+- Changed host.def not to build Xnest server.
+
+- Changed Xserver Imakefile to link nxaccess library.
+
+nx-X11-3.0.0-6
+
+- Added the path of nxaccess library to the server link command.
+
+nx-X11-3.0.0-5
+
+- Implemented FR10C01079 and FR10C01080. The merge of NX changes to
+  the X.org code is complete.
+
+- Merged changes in config/cf. The NX-*.def files have been dismissed.
+  Main platform dependent configurations have been moved to host.def.
+
+- Removed *.reference files from config/cf.
+
+- Fixed compilation for Cygwin platform.
+
+nx-X11-3.0.0-4
+
+- Imported all changes up to nx-X11-2.0.0-32.
+
+- Cleaned up lib/zlib directory.
+
+- Added missing file programs/Xserver/os/utils.c.NX.original.
+
+- Updated the copyright notice to year 2006.
+
+- The pointer to the display buffer is reset after an I/O error.
+  This prevents leaving the buffer in an inconsistent state if the
+  error occurs inside _XFlush().
+
+- Removed the modifications to the Xrender library. The cleanup of
+  the padding bytes is now performed by the NX transport.
+
+- NX uses the updated ZLIB from its build tree, so Imake.tmpl will
+  now assume that the platform as ZLIB unless otherwise stated.
+
+- The path of the SecurityPolicy file is searched and validated at
+  runtime.
+
+- Added the _X11TransSocketProxyConnInfo() function to Xtranssock.c
+  It returns the pointer to the XtransConnInfo private, if it is a
+  valid _NXProxyConnInfo structure.
+
+- The above function is used by OpenDis.c to detect if the NX trans-
+  port was requested on the display and avoid spurious error messa-
+  ges in the case of a connection failure.
+
+- Added NXmiwindow.o to the NXAGENTOBJS in the Xserver's Imakefile
+  and imported NXmiwindow.c in nxagent. This allows us to check the
+  pointer to the pOldClip region in miSetShape() before going on
+  freeing it.
+
+- The path of the XKB base directory and of the xkbcomp comand is
+  validated at runtime.
+
+- Also added a check to verify the validity of the rgb file path.
+
+- Added NXresource.o to NXAGENTOBJS in the Imakefile of nxagent. We
+  need this to a assign a resource to the pixmaps and other server
+  objects which need to be enumerated at reconnection. Some objects,
+  being created by the X server and not by the clients, don't pass
+  through the resource assignment process operated by the dix. To
+  ensure that all objects get a resource, we add a resource at the
+  time the object is created and temporarily assign the resource to
+  the server client. If the dix later assigns the resource to a va-
+  lid client, the resource is removed from the server client's list.
+  
+- The display block handler registered by the client is called in
+  WaitForReadable() and WaitForWritable() before every select(),
+  not only upon entering the function. The reason is that more
+  data can be possibly produced for the NX link by the proxy it-
+  self and, when setting the flush policy to deferred, the client
+  may not have the chance of flushing the NX link.
+
+- Fixed a bug in XkbUseExtension() that caused Xlib to query the
+  presence of the XKEYBOARD extension multiple times. This partial-
+  ly implents the FR01D01275. The complete implementation required
+  modifications to the X11 agent, implemented in nxagent-2.0.0-33.
+
+- Updated to comply with the new NXTransFlush() interface.
+
+- Both nxwin and nxagent now read the X authority file by using an
+  fopen() instead of the system command 'cat'.
+
+- Removed NXmiwindow.o from the NXAGENTOBJ list. The agent will now
+  use the original miwindow.c.
+
+- Added some additional logs in Xtranssock.c to follow the creation
+  and removal of the X server's Unix listener.
+
+- Avoided the sleep of 5 seconds forced by Xtransutil.c if the dir-
+  ectory where the Unix listener is created is not owned by root.
+  This sleep is not executed on Cygwin (where the X socket can be
+  hardly owned by root) but may delay the startup of the agent if
+  the user chose a different NX_TEMP directory. Furthermore, it is
+  unclear what real benefits such sleeps are intended to bring to
+  the security of the X server. This can be controlled by defining
+  the NX_TRANS_SLEEP directive in Xserver/os/Imakefile.
+
+- Added NXmiexpose.o to the NXAGENTOBJ.
+
+- Ensured that _X11TransSocketCloseConnInfo() now initiates the NX
+  shutdown by calling NXTransClose().
+
+- Corrected a misplaced #else that made SocketUNIXConnect() skip a
+  block if the connection was not to the NX transport.
+
+- Updated to comply with the new NX function prototypes introduced
+  in nxcomp-2.0.0-31.
+
+- Moved the most important Xtranssock.c modifications into separate
+  functions.
+
+- Ensured that the modifications enabling the internal connections
+  to the proxy are compiled only when the TRANS_CLIENT directive is
+  defined.
+
+- Solved a bug that prevented the X11 socket to be deleted at the X
+  server shutdown. This needs further tests.
+
+- Added nxcompext to the link of nxagent, now that the dependency
+  of libX11 from nxcompext is removed.
+
+- Improved the Xtranssock routines to never loop through the array
+  of connection info.
+
+- Added a congestion flag to the connection info structure and a
+  function querying the transport and reporting if a change in the
+  congestion state has occurred. The code is currently not enabled,
+  because instead of polling the transport, we let the proxy notify
+  the changes in congestion state by using the callback. The code
+  can be used in future to extend the library, for example, by add-
+  ing some counters tracking the bandwidth usage of the socket con-
+  nection, so that we can make the congestion notifications work
+  even with a plain X11 connection.
+
+- Profiled the routines in XlibInt.c to reduce the number of calls
+  to the error predicate function provided by the client.
+
+- Fixed the nxcompext build problem that caused make World to fail.
+
+- Added a 'CONF' target to the X11 and Xext Imakefiles so that the
+  configure script is not run if the config.status exists.
+
+- Added the _NXDisplayBlockHandler hook. The function is called by
+  Xlib before blocking. The parameter says if Xlib is going to wait
+  for more input or because it needs to write to the display  socket.
+  The client can use the hook to perform any internal operation that
+  may require some time to complete. The user, though, should not
+  try to read or write to the display inside the callback routine.
+
+- Removed the outdated NX_TRANS_PROCESS, NX_TRANS_THREAD and NX_TR-
+  ANS_INCLUDE defines.
+
+- Reverted the lib/Xext Imakefile to the original XF86 version and
+  moved the build of the nxcompext library among the libX11 depend-
+  encies.
+
+- Corrected the lib/X11 Imakefile so that a new build of nxcomp and
+  nxcompext is not attempted if the libraries are up-to-date.
+
+- Removed the unused display buffer and image cleanup functions.
+  
+- Reverted the PutImage.c file to the original XF86 version.
+  
+- Added the _NXDisplayErrorPredicate function in XlibInt.c. It is
+  actually a pointer to a function called whenever Xlib is going to
+  perform a network operation. If the function returns true, the
+  call will be aborted and Xlib will return the control to the ap-
+  plication. It is up to the application to set the XlibDisplayIO-
+  Error flag after the _NXDisplayErrorPredicate returns true. The
+  function can be used to activate additional checks, besides the
+  normal failures detected by Xlib on the display socket. For exam-
+  ple, the application can set the funciton to verify if an inter-
+  rupt was received or if any other event occurred mandating the
+  end of the session.
+
+- Modified XIfEvent(), XMaskEvent() and XPeekIfEvent() to check the
+  _NXDisplayErrorPredicate function and return immediately if the
+  function returns true.
+
+- Modified _XWaitForReadable() to never enter the loop if the dis-
+  play is broken.
+
+- Corrected a make problem on Windows that caused the nxcomp and
+  nxcompext libraries to be referred with the wrong name, with the
+  result that a new configure and make was attempted at each build
+  attempt.
+
+- Merged all the changes to os, Xext, xkb, dix.
+
+- Changed host.def to build only the agent server.
+
+- Merged the changes to Xtranssock.c
+
+nx-X11-3.0.0-3
+
+- Merged the changes to lib/X11. Restored original PutImage.c and
+  ClDisplay.c files.
+
+nx-X11-3.0.0-2
+
+- Created a directory named 'reference' to keep files that are chan-
+  ged during the development of nx-X11 since the 1.5.0-16 to 2.0.0-32
+  version. These files will be removed as long as the differences are
+  merged to the 3.0.0 version. When all differences are merged, this
+  directory will be removed.
+
+nx-X11-3.0.0-1
+
+- Opened the 3.0.0 branch based on the nx-X11-2.0.0-9. The 3.0.0
+  branch will now support the migration toward the X.org tree. Due
+  to time concerns, the 2.0.0 branch is going to be based on the
+  same nx-X11 as the 1.5.0.
+
+nx-X11-2.0.0-9
+
+- Modified the agent link arguments to explicitly include the NX
+  libraries.
+
+- Disabled the Xinerama extension to avoid further clashes with
+  the redefinition of GC in Xlib.
+
+- Added os/libos.a at the end of the agent link.
+
+nx-X11-2.0.0-8
+
+- Moved the declarations of _NXEnable* and related structures from
+  Xlibint.h to NXlibint.h.  
+
+- Added provision for building the agent. This can be controlled by
+  setting NXAgentServer to YES in host.def.
+
+- Setting the NXUpgradeAgentServer variable to YES in the host.def
+  file will make the agent assume that it is being built in the new
+  environment. This variable is normally unset when building in the
+  1.5.0 tree.
+
+nx-X11-2.0.0-7
+
+- Fixed a problem on AMD64 due to the size of the area pointed by
+  the argument of _X11TransBytesReadable(). BytesReadable_t is long,
+  at least on Linux, while the ioctl() requires a pointer to an int.
+  The original _X11TransBytesReadable() function simply calls the
+  ioctl() by passing the pointer that is provided. NXTransReadable(),
+  instead, was correctly returning the value assuming a pointer to
+  a long, but this crashes some applications, among them xterm. Now
+  NXTransReadable() follows the same schema of the ioctl() call and
+  stores the result assuming a pointer to an int.
+
+- Removed the outdated NX_TRANS_PROCESS and NX_TRANS_THREAD code.
+
+nx-X11-2.0.0-6
+
+- Made xterm work with the NX transport. This required small changes
+  to the Xt toolkit's and the xterm's files to let them use the NX
+  aware select(). This is useful to test the NX transport until the
+  nxagent server is integrated.
+
+- When the transport is gone _X11TransSocketBytesReadable() returns
+  EPIPE. This makes the client become aware of the closure of the
+  connection.
+
+- Added a call to NXTransDestroy() in XCloseDisplay().
+
+- The exit() function in XlibInt.c causes a call to NXTransExit().
+
+- Merged changes to dix/pixmap.c, xkb/xkbDflts.h, mi/Imakefile.
+
+- Removed unneeded changes and files containing patches already in
+  the latest X.org distribution: dix/dispatch.c, fb/fbcompose.c, fb/
+  fbgc.c, xkb/ddxList.c, font/fontfile/dirfile.c, font/fontfile/
+  encparse.c, font/fontfile/fontfile.c, font/FreeType/fttools.c,
+  Xrender/FillRect.c, Xrender/Picture.c.
+
+nx-X11-2.0.0-5
+
+- Changes to the lib/X11/Imakefile to cleanly build the tree. This
+  is obtained by creating a link to the Xcomp library in exports/lib
+  without having to modify the programs' Imakefiles.
+
+- Finished merging the NX changes in the lib/X11 files.
+
+- Merged the CHANGELOG with the one from the 1.5.0 tree.
+
+nx-X11-2.0.0-4
+
+- Merged the NX changes in most Xtrans and lib/X11 files.
+
+nx-X11-2.0.0-3
+
+- Temporarily disabled the use of the MMX extensions in the Xserver's
+  fb code to successfully compile with GCC 4.
+
+nx-X11-2.0.0-2
+
+- Imported the *.NX.reference and *.XF86.reference files that will
+  be needed for the merge. These files are the *.original from the
+  1.5.0 tree. They will be removed as long as the merge advances.
+
+nx-X11-2.0.0-1
+
+- Created the 2.0.0 branch based on X.org the 6.8.99.16 snapshot.
+
+nx-X11-1.5.0-16
+
+- Added the missing *.XF86.original and *.NX.original files.
+
+nx-X11-1.5.0-15
+
+- Made the nxagent server use select() instead of poll() on Solaris
+  so that it can leverage the new NX transport.
+
+- Moved the NXTransFlush() call to _XReply().
+
+nx-X11-1.5.0-14
+
+- Added the 'synchronous' parameter in the _XWaitForReadable() call
+  to NXTransFlush().
+
+nx-X11-1.5.0-13
+
+- Removed the log entry in XlibInt.c on calling the NXTransFlush().
+
+nx-X11-1.5.0-12
+
+- Changed XlibInt.c and utils.c to call NXTransExit().
+
+nx-X11-1.5.0-11
+
+- Changed XlibInt.c to comply with the new NXTransFlush() interfa-
+  ce introduced in nxcomp-1.5.0-42.
+
+- Cosmetic changes to messages printed for debug.
+
+nx-X11-1.5.0-10
+
+- Ensured that all calls to _XIOError() are followed by a return.
+
+- Put exiting the client program in the case of an I/O error under
+  the control of the _NXContinueOnDisplayError flag. If set, the
+  I/O error routine will simply return, leaving to the application
+  the responsibility of checking the state of the XlibDisplayIOEr-
+  ror flag.
+
+- Added some checks whenever a read or write is performed on the X
+  connection, so that we can exit the I/O loop if the X channel is
+  gone. It is likely that more work will be needed when trying to
+  support XTHREADS enabled connections. This should not be a pro-
+  blem for now, as the default is still to quit the application un-
+  less the _NXContinueOnDisplayError flag is explicitly set.
+
+nx-X11-1.5.0-9
+
+- Removed the references to the cygipc library in NXWin. Now use the
+  cygserver daemon to provide the MIT-SHM extension.
+
+- Fixed an error in the UseCygIPC definition.
+
+- Changed the cygwin.cf file to avoid redefinition of the BuildGlxExt,
+  XWinServer and BuildGlxExt symbols.
+
+nx-X11-1.5.0-8
+
+- Added provision for deferred writes in the NX transport. When en-
+  tering _XWaitForReadable() we must ensure that data is flushed to
+  the proxy link.
+
+- Added the UseCygIPC define to NX-Cygwin.def.
+
+- Updated the NoMachine copyright notice on the modified files.
+
+nx-X11-1.5.0-7
+
+- Added the GLX extension in NX-Sun.def.
+
+- Added some more logs in WaitFor.c.
+
+nx-X11-1.5.0-6
+
+- Modified Xlibint.h and XlibInt.c to remove the _NXFlushSize para-
+  meter. New agents run the NX transport in-process, so we don't get
+  any benefit from increasing the display buffer size.
+
+- Modified NX-Darwin.def to not build the NXDarwin server. Since the
+  1.4.0 version the NXDarwin server is unsupported and the NX client
+  for the Mac requires that the Apple X server is installed.
+
+- Changed NX-Linux.def to avoid the warning due to &quot;SharedLibGLw&quot;
+  being not defined.
+
+nx-X11-1.5.0-5
+
+- Modified the Xserver Imakefile to link nxagent with FbPostFbLibs
+  and avoid including mfb/libmfb.a.
+
+- Added the GLX extension in NX-Linux.def. This provides unaccelera-
+  ted support in nxagent, with GLX operations translated into core X
+  protocol primitives.
+
+- Fixed x-X11/programs/Xserver/GL/dri/Imakefile to look in ../../hw/
+  /xfree86/os-support/bus for includes.
+
+nx-X11-1.5.0-4
+
+- Avoid calling NXTransSelect() if the transport is gone, so that we
+  don't have to wait until the timeout.
+
+- Added the &quot;-fno-strict-aliasing&quot; option to linux.cf when compiling
+  with a GCC version &gt;= 4. In the words of Stefan Dirsch: &quot;The opt-
+  ion, which is default since gcc 3.1, can result in wrong code when
+  the gcc warnings related to it are ignored. And as there are seve-
+  ral warnings in X11 related to it, it has been disabled for X11
+  from the beginning. This didn't change for gcc4, so it still needs
+  to be used.&quot;
+
+- Added more logs in XlibInt.c and utils.c. A warning is printed if
+  the SmartScheduler is initialized.
+
+nx-X11-1.5.0-3
+
+- Started integration of nxcomp with the X libraries. The Xtrans
+  code creates an internal connection to the nxcomp library instead
+  of a child proxy process.
+
+- Changed Xpoll.h and XlibInt.c to replace the standard Select
+  with a version giving NX a chance to check its own descriptors.
+
+- Implemented the NXTransReadVector() and the NXTransWriteVector()
+  functions to replace READV() and WRITEV().
+
+- Implemented memory-to-memory communication with the NX proxy by
+  making use of the NXTransAgent() interface.
+
+nx-X11-1.5.0-2
+
+- We think that the way LoadAuthorization() is working is wrong.
+  It doesn't reset the list of stored authorizations before reading
+  the new cookies. Our take is that if a new auth file is to be
+  read, the only cookies that are to be accepted are those that are
+  in the new file, not those in the file -plus- those that have
+  been in the file in the past. Furthermore, if the list can't be
+  read or it is empty, it should assume that it ignores which co-
+  okies are valid and thus it should disable any access. Your mile-
+  age can vary. A less draconian approach could be to leave the old
+  cookies if the file can't be read and remove them only if the
+  file is empty.
+
+  Adding the cookies without removing the old values for the same
+  protocol has an important implication. If an user shares the co-
+  okie with somebody and later wants to revoke the access to the
+  display, changing the cookie will not work. This is especially
+  important with NX. For security reasons, after reconnecting the
+  session to a different display, it is advisable to generate a
+  new set of cookies, but doing that it is useless with the current
+  code, as the old cookies are going to be still accepted. On the
+  same topic, consider that once an user has got access to the X
+  server, he/she can freely enable host authentication from any
+  host, so the safe behaviour should be to reset the host based
+  authenthication at least at reconnection, and keep as valid only
+  the cookies that are actually in the file. This behaviour would
+  surely break many applications, among them a SSH connection run
+  inside a NX session, as ssh -X reads the cookie for the display
+  only at session startup and does not read the cookies again
+  when the auth file is changed.
+
+  Another bug (or feature, depending on how you want to consider
+  it) is that if the authority file contains entries for different
+  displays (as it is the norm when the authority file is the default
+  .Xauthority in the user's home), the X server will match -any- of
+  the cookies, even cookies that are not for its own display. This 
+  means that you have to be careful when passing an authority file
+  to nxagent and maybe keep separate files for letting nxagent find
+  the cookie to be used to connect to the remote display and for
+  letting it find what cookies to accept. If the file is the same,
+  clients will be able to connect to nxagent with both the cookies.
+  This bug obviously affects any X server, also the real X server
+  running on the workstation, so it is common to see nxagent being
+  able to connect to the X server even if no cookie matches the
+  real display.
+
+- Added a check in lib/Xau/AuRead.c to prevent the fread() call to
+  be interrupted by SIGCHLD while reading the auth file. Due to the
+  way the old code worked, this could lead to the server enabling
+  local host access to the display. This problem had been identified
+  in the past. We just found that all the code dealing with reading
+  the auth file was affected. The code calls sigprocmask() to block
+  the signal (though it leaves some other calls unprotected) but the
+  SIGCHLD was not included in the set.
+
+- Added SIGCHLD to the set of signals that are blocked when reading
+  the authorization file.
+
+- As I was at it, I changed the path to the SecurityPolicy file. A
+  few Linux ditributors ship the file in $LIBDIR/xserver, a few only
+  in /etc/X11/xserver, most others in both places. It seems that
+  those who ship in $LIBDIR/xserver do also in /etc/X11 but the op-
+  posite is not true, so I switched to /etc/X11.
+
+nx-X11-1.5.0-1
+
+- Opened the 1.5.0 branch.
+
+nx-X11-1.4.1-2
+
+- Set parameter UseCygIPC on cygwin conf file in order to force the
+  build of MIT-SHM estension.
+
+- Removed some spurius object file.
+
+nx-X11-1.4.1-1
+
+- Opened the 1.4.1 branch.
+
+nx-X11-1.4.0-8
+
+- Changed DefaultFontPath and DefaultRGBDatabase in 
+  NX-Cygwin.def.
+
+nx-X11-1.4.0-7
+
+- Imported dispatch in nxdarwin package, in order to let
+  nxdarwin being able to detect new client connection.
+
+- Changed the Xpm Imakefile to make also .a static library
+  on Solaris. To link nxviewer and nxdestkop staticaly.
+
+nx-X11-1.4.0-6
+
+- XInput extension enabled on MacOSX.
+
+- Added some missing backup files of the original XFree86
+  package.
+
+nx-X11-1.4.0-5
+
+- Changed the mi Imakefile in order to let xfree86 servers use
+  the normal mi extension initialization for the XInput exten-
+  sion.
+
+- XInput extension enabled on Solaris.
+
+nx-X11-1.4.0-4
+
+- Removed the RejectWellKnownSocket for the cygwin and
+  MacOSX environments that doesn't use the Xtransport library.
+
+nx-X11-1.4.0-3
+
+- Changed the implementation of the reject method in the
+  Xtransport library, now close any new incoming connection 
+  immediately without reading or writing to it.
+
+nx-X11-1.4.0-2
+
+- Implemented a reject method in the Xtransport library,
+  this function accept and close every connection attempt,
+  on the specified listening socket.
+
+- Added the new function RejectWellKnownSocket to the os
+  connection code.
+  This function use the new transport reject function on
+  all listening socket.
+
+nx-X11-1.4.0-1
+
+- Opened the 1.4.0 branch.
+
+- Removed forgotten nxagent-1.3.2-20 directory.
+
+nx-X11-1.3.2-9
+
+- Prevents NX Darwin server going through the reset. On Darwin
+  we found that the it is not possible to get the correct key-
+  board layout unless it is set on the local machine, before
+  the NX session is started, by using xmodmap. As we set the
+  keyboard locally, we must prevent the X server to reset, or
+  we would loose any local configuration.
+
+nx-X11-1.3.2-8
+
+- Removed action associated to keysym XK_Terminate_Server. This
+  could cause agent to be terminated when pressing shift + back-
+  space if using the default US keyboard mapping.
+
+- Disabled the remaining debug logs in lib/X11/PutImage.c
+
+nx-X11-1.3.2-7
+
+- Fixed the wrong programs/Xserver/Imakefile in 1.3.2-6 package.
+
+nx-X11-1.3.2-6
+
+- Changed the define from NX_CLEAN_IN_PLACE to NX_CLEAN_INPLACE.
+  Definition of symbol is now placed in the Imakefile.
+
+- The new _NXEnableCleanInplace Xlib variable does control which
+  algorithm is used to clean the images. Setting NX_IMAGEINPLACE
+  in the environment will activate the in-place cleanup.
+
+- The default value of _NXEnableCleanInplace is -1. Leaving it to
+  a value &lt;= 0 disables use of CleanInplace.
+
+nx-X11-1.3.2-5
+
+- Patch in config/cf/sun.cf. Fix for libfontconfig compilation
+  during gmake Everything on Solaris.
+
+- Patch in lib/X11/Imakefile. Fix for nxcomp compilation during
+  gmake World on Solaris.
+
+nx-X11-1.3.2-4
+
+- Image cleanup is now performed by using NXCleanInPlaceImage from
+  nxcompext. This function saves a buffer copy by cleaning the
+  padding bytes in the same buffer provided by the caller. Note that
+  to prevent memory violations in the case the image was allocated
+  in a static buffer, the function will temporarily redefine the
+  SIGSEGV handler. The former handler is restored before returning
+  to the caller. This can potentially affect some multithreaded
+  clients. Is to be decided if the function is safe enough to be
+  included in the production release.
+
+nx-X11-1.3.2-3
+
+- More debug logs in programs/Xserver/xkb/ddxLoad.c.
+
+nx-X11-1.3.2-2
+
+- Added NXmiwindow.o to NXAGENTOBJS in programs/Xserver/Imakefile.
+  File was not linked into the resulting nxagent. This solves the
+  problem of missing repaints in CDE and other Xt applications.
+
+nx-X11-1.3.2-1
+
+- Added some debug logs in programs/Xserver/xkb/ddxLoad.c. Function
+  XkbDDXCompileKeymapByNames is called by OpenOffice to read the
+  keyboard configuration whenever a drop-down menu is accessed. It
+  seem to always fail with the following error:
+
+  The XKEYBOARD keymap compiler (xkbcomp) reports:
+  &gt; Error:            Can't find file &quot;unknown&quot; for geometry include
+  &gt;                   Exiting
+  &gt;                   Abandoning geometry file &quot;default&quot;
+
+- Opened the 1.3.2 development branch.
+
+nx-X11-1.3.1-12
+
+- Fixed a problem in xkb/ddxLoad.c on Solaris where Pclose was
+  always returning an error code despite the fact that command
+  was executed properly.
+
+nx-X11-1.3.1-11
+
+- Changed default GCC flags from '-O2 -fno-strength-reduce' to
+  -O3. No platform where NX is targeted is currently using a
+  GCC 2.x affected by the -fno-strength-reduce bug. Note also
+  that nxcomp is already compiled with -O3 since 1.1.1, so it
+  can be considered safe.
+
+nx-X11-1.3.1-10
+
+- Imported an updated fbcompose.c file from XFree86-4.3.99.902.
+  This fixes &quot;uninitialized value&quot; problems reported by Valgrind.
+
+- Fixed further buffer overflows by updating the following file
+  with recent versions coming from the XFree86-4.3.99.902 tree.
+
+  nx-X11/lib/font/fontfile/dirfile.c
+  nx-X11/lib/font/fontfile/encparse.c
+  nx-X11/lib/font/fontfile/fontfile.c
+
+- Fixed a possible buffer overflow in lib/font/FreeType/fttools.c.
+  Verified that the change is already in the XFree86 4.4.0 CVS.
+
+nx-X11-1.3.1-9
+
+- Fixed Xserver/Imakefile which was still referencing NXpixmap.o.
+
+nx-X11-1.3.1-8
+
+- Imported an updated fbgc.c from XFree86-4.3.99.902. This fixes
+  some minor problems reported by Valgrind.
+
+- A major problem was reported by Valgrind about reading after
+  the block allocated in fbCreatePixmap from AllocatePixmap. The
+  file pixmap.c has been modified so that 4 bytes are added to
+  the pixmap buffer at any new allocation. This quick hack should
+  solve the problem for both nxagent and the NXWin server. Further
+  investigation is planned for the next release.
+
+- Fixed Xtranssock.c to compile on Solaris where struct sigaction
+  doesn't have the sa_restorer member.
+
+nx-X11-1.3.1-5
+
+- Renamed the NX-sun.def configuration file to NX-Sun.def.
+
+- Renamed the non-standard NX_iPAQ_XServer and NX_Zaurus_XServer
+  symbols to NXiPAQXServer and NXZaurusXServer.
+
+- Added the missing sun.cf.XF86.original file in config/cf.
+
+- Added the missing empty file host.def.XF86.original in the
+  same directory.
+
+- Added initialization of sa.sa_mask when setting sigaction()
+  for SIGCHLD. The problem was reported by Valgrind running
+  nxagent.
+
+- Removed an unused block of code from WaitFor.c. The code had
+  been commented out in previous versions.
+
+- Removed the non-standard colon at the end of version in this
+  CHANGELOG.
+
+- Removed the spurious spaces in this CHANGELOG.
+
+nx-X11-1.3.1-4
+
+- Added a little workaround to the top Imakefile intended to
+  hide the makedepend warnings about non portable whitespaces
+  in sources.
+
+nx-X11-1.3.1-3
+
+- Fixed compilation problem with nxagent-1.3.1-13.
+
+nx-X11-1.3.1-2
+
+- Changes in NX-sun.def configuration file for Solaris to allow
+  compilation of the XKB extension. 
+
+nx-X11-1.3.1-1
+
+- Opened the 1.3.1 development branch.
+
+nx-X11-1.3.0-6
+
+- Original output buffer size in stock XFree86 is 2048. We try
+  to reduce context switches and help stream compression by
+  increasing the maximum size of the buffer 8192. _NXFlushSize
+  determines when the display buffer is actually flushed. It is
+  set by default to 4096 but agents should set it to 0 if they
+  want to disable early flush.
+
+- Added the _NXLostSequenceFunction function pointer to let NX
+  agents suppress the error message and modify the default Xlib
+  behaviour when out-of-order sequence numbers are received.
diff --git a/config/cf/host.def.X.original b/CHANGELOG.X.original
similarity index 100%
copy from config/cf/host.def.X.original
copy to CHANGELOG.X.original
diff --git a/CHANGELOG.X b/ChangeLog.X.org
similarity index 100%
rename from CHANGELOG.X
rename to ChangeLog.X.org
diff --git a/LICENSE b/LICENSE
index e394a65..d841e1c 100644
--- a/LICENSE
+++ b/LICENSE
@@ -1,6 +1,9 @@
-Copyright (c) 2001, 2010 NoMachine - <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>
+Copyright (c) 2001, 2011 NoMachine - <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>
+Copyright (c) 2011 X2go Project - <A HREF="http://wiki.x2go.org/.">http://wiki.x2go.org/.</A>
 
 NX-X11 and NX extensions to X are copyright of NoMachine.
+X2go-X11 (x2goagent) is a fork of NX-X11 (nxagent), the same
+license applies for X2go's NX-X11 fork.
 
 Redistribution and use of this software is allowed according to the
 following terms:
diff --git a/VERSION b/VERSION
deleted file mode 100644
index bb94d04..0000000
--- a/VERSION
+++ /dev/null
@@ -1 +0,0 @@
-3.4.0.5
diff --git a/VERSION b/VERSION
new file mode 120000
index 0000000..1da2874
--- /dev/null
+++ b/VERSION
@@ -0,0 +1 @@
+VERSION.x2goagent
\ No newline at end of file
diff --git a/VERSION.x2goagent b/VERSION.x2goagent
new file mode 100644
index 0000000..a9f07dd
--- /dev/null
+++ b/VERSION.x2goagent
@@ -0,0 +1 @@
+3.5.0.2
diff --git a/config/cf/host.def b/config/cf/host.def
index 607e4f0..e9f53c2 100644
--- a/config/cf/host.def
+++ b/config/cf/host.def
@@ -31,7 +31,7 @@ XCOMM $XFree86: xc/config/cf/xf86site.def,v 3.186 2003/06/25 18:06:22 eich Exp $
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/config/cf/host.def.NX.original b/config/cf/host.def.NX.original
index 607e4f0..e9f53c2 100644
--- a/config/cf/host.def.NX.original
+++ b/config/cf/host.def.NX.original
@@ -31,7 +31,7 @@ XCOMM $XFree86: xc/config/cf/xf86site.def,v 3.186 2003/06/25 18:06:22 eich Exp $
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/debian/changelog b/debian/changelog
index a9f178d..2ccae7e 100644
--- a/debian/changelog
+++ b/debian/changelog
@@ -1,3 +1,11 @@
+x2goagent (3.5.0.2-0~x2go1) UNRELEASED; urgency=low
+
+  * New upstream version (3.5.0.2):
+    - Patched in NX code from NX-X11-3.5.0-1
+  * Depend on NX libs &gt;= 3.5.0.
+
+ -- Mike Gabriel &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">mike.gabriel at das-netzwerkteam.de</A>&gt;  Sun, 03 Jul 2011 16:57:57 +0200
+
 x2goagent (3.4.0.5-0~x2go1) unstable; urgency=low
 
   * Changed version numbering scheme, upstream now maintained by
diff --git a/debian/control b/debian/control
index 212bdb1..ee244d0 100644
--- a/debian/control
+++ b/debian/control
@@ -2,21 +2,36 @@ Source: x2goagent
 Section: x11
 Priority: extra
 Maintainer: Oleksandr Shneyder &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/x2go-commits">oleksandr.shneyder at obviously-nice.de</A>&gt;
-Build-Depends: debhelper (&gt;= 7), libxcomp-dev, libxcompext-dev, libxcompshad-dev, zlib1g-dev, libfreetype6-dev, xorg-dev
-Standards-Version: 3.7.2
+Build-Depends:
+ debhelper (&gt;= 7),
+ libxcomp-dev (&gt;= 3.5.0),
+ libxcompext-dev (&gt;= 3.5.0),
+ libxcompshad-dev (&gt;= 3.5.0),
+ zlib1g-dev,
+ libfreetype6-dev,
+ xorg-dev,
+ xutils-dev
+Standards-Version: 3.9.2
+Homepage: <A HREF="http://code.x2go.org/releases/source/x2goagent">http://code.x2go.org/releases/source/x2goagent</A>
+Vcs-Git: <A HREF="git://code.x2go.org/x2goagent.git">git://code.x2go.org/x2goagent.git</A>
+Vcs-Browser: <A HREF="http://code.x2go.org/gitweb?p=x2goagent.git;a=summary">http://code.x2go.org/gitweb?p=x2goagent.git;a=summary</A>
 
 Package: x2goagent
 Architecture: any
-Depends: ${shlibs:Depends}, ${misc:Depends}
-Description: Special NX-ized client, was developed by NoMachine to handle X sessions
- This is thhe agent providing X transport of X session is nxagent. This
- is based on the well known Xnest &quot;nested&quot; server.  nxagent, like Xnest,
+Depends:
+ ${shlibs:Depends},
+ ${misc:Depends}
+Description: Special X2go-ized X agent, forked from NX-X11 (NoMachine)
+ x2goagent is an agent providing X transport of X sessions. The application
+ is based on the well known Xnest &quot;nested&quot; server. x2goagent, like Xnest,
  is an X server for its own clients, and at the same time, an X client
- for the real X server.  The main scope of nxagent is to eliminate X
- round-trips or transform them into asynchronous replies.  nxproxy does
- not make any effort to minimize round-trips by itself, this is demanded
- of nxagent. Being an X server, nxagent is able to resolve locally all
- the property/atoms related requests, ensuring that the most common
- source of round-trips are nearly reduced to zero.
+ for a system's local X server.
  .
- This version was modified for x2go system.
+ The main scope of x2goagent is to eliminate X round-trips or transform
+ them into asynchronous replies. x2goagent works together with nxproxy from
+ NoMachine. nxproxy itself does not make any effort to minimize round-trips
+ by itself, this is demanded of x2goagent.
+ .
+ Being an X server, x2goagent is able to resolve all the property/atoms related
+ requests locally, ensuring that the most common source of round-trips are nearly
+ reduced to zero.
diff --git a/debian/dirs b/debian/dirs
deleted file mode 100644
index ce61177..0000000
--- a/debian/dirs
+++ /dev/null
@@ -1,2 +0,0 @@
-/usr/lib/x2go
-/usr/bin/
\ No newline at end of file
diff --git a/debian/docs b/debian/docs
deleted file mode 100644
index f812472..0000000
--- a/debian/docs
+++ /dev/null
@@ -1,2 +0,0 @@
-CHANGELOG.NX
-CHANGELOG.X
diff --git a/debian/source/format b/debian/source/format
new file mode 100644
index 0000000..9f67427
--- /dev/null
+++ b/debian/source/format
@@ -0,0 +1 @@
+3.0 (native)
\ No newline at end of file
diff --git a/debian/x2goagent.dirs b/debian/x2goagent.dirs
new file mode 100644
index 0000000..b6dac84
--- /dev/null
+++ b/debian/x2goagent.dirs
@@ -0,0 +1,4 @@
+usr/bin
+usr/lib/x2go
+usr/share/x2go
+usr/share/x2go/versions
diff --git a/debian/x2goagent.docs b/debian/x2goagent.docs
new file mode 100644
index 0000000..4abf21a
--- /dev/null
+++ b/debian/x2goagent.docs
@@ -0,0 +1,3 @@
+CHANGELOG
+CHANGELOG.NX.original
+CHANGELOG.X.original
diff --git a/debian/x2goagent.install b/debian/x2goagent.install
index 470bb7b..bb4af31 100644
--- a/debian/x2goagent.install
+++ b/debian/x2goagent.install
@@ -2,3 +2,5 @@ lib/X11/lib*                usr/lib/x2go
 lib/Xext/lib*               usr/lib/x2go
 lib/Xrender/lib*            usr/lib/x2go
 programs/Xserver/x2goagent  usr/lib/x2go
+VERSION.x2goagent           usr/share/x2go/versions
+
diff --git a/extras/Mesa/src/mesa/main/WSDrawBuffer.h b/extras/Mesa/src/mesa/main/WSDrawBuffer.h
index 39910ea..b4d805d 100644
--- a/extras/Mesa/src/mesa/main/WSDrawBuffer.h
+++ b/extras/Mesa/src/mesa/main/WSDrawBuffer.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/extras/Mesa/src/mesa/main/WSDrawBuffer.h.NX.original b/extras/Mesa/src/mesa/main/WSDrawBuffer.h.NX.original
index 39910ea..b4d805d 100644
--- a/extras/Mesa/src/mesa/main/WSDrawBuffer.h.NX.original
+++ b/extras/Mesa/src/mesa/main/WSDrawBuffer.h.NX.original
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/include/Xpoll.h.in b/include/Xpoll.h.in
index b44b926..dcea39c 100644
--- a/include/Xpoll.h.in
+++ b/include/Xpoll.h.in
@@ -53,7 +53,7 @@ from The Open Group.
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/include/Xpoll.h.in.NX.original b/include/Xpoll.h.in.NX.original
index b44b926..dcea39c 100644
--- a/include/Xpoll.h.in.NX.original
+++ b/include/Xpoll.h.in.NX.original
@@ -53,7 +53,7 @@ from The Open Group.
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/lib/SM/sm_client.c b/lib/SM/sm_client.c
index 02f9ccd..499be5e 100644
--- a/lib/SM/sm_client.c
+++ b/lib/SM/sm_client.c
@@ -239,7 +239,9 @@ char 		*errorStringRet;
 		    SIZEOF (smRegisterClientMsg), WORD64COUNT (extra),
 		    smRegisterClientMsg, pMsg, pData);
 
-		STORE_ARRAY8 (pData, 0, NULL);
+                previousId = NULL;
+
+		STORE_ARRAY8 (pData, 0, previousId);
 
 		IceFlush (iceConn);
 
diff --git a/lib/X11/ConnDis.c b/lib/X11/ConnDis.c
index 5dba9cc..30146a9 100644
--- a/lib/X11/ConnDis.c
+++ b/lib/X11/ConnDis.c
@@ -28,7 +28,7 @@ in this Software without prior written authorization from The Open Group.
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/lib/X11/ConnDis.c.NX.original b/lib/X11/ConnDis.c.NX.original
index 5dba9cc..30146a9 100644
--- a/lib/X11/ConnDis.c.NX.original
+++ b/lib/X11/ConnDis.c.NX.original
@@ -28,7 +28,7 @@ in this Software without prior written authorization from The Open Group.
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/lib/X11/Imakefile.NX.original b/lib/X11/Imakefile.NX.original
index 3aca4df..d8d0601 100644
--- a/lib/X11/Imakefile.NX.original
+++ b/lib/X11/Imakefile.NX.original
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/lib/X11/OpenDis.c b/lib/X11/OpenDis.c
index c0e44da..e9d0197 100644
--- a/lib/X11/OpenDis.c
+++ b/lib/X11/OpenDis.c
@@ -27,7 +27,7 @@ in this Software without prior written authorization from The Open Group.
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/lib/X11/OpenDis.c.NX.original b/lib/X11/OpenDis.c.NX.original
index c0e44da..e9d0197 100644
--- a/lib/X11/OpenDis.c.NX.original
+++ b/lib/X11/OpenDis.c.NX.original
@@ -27,7 +27,7 @@ in this Software without prior written authorization from The Open Group.
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/lib/X11/XlibAsync.c b/lib/X11/XlibAsync.c
index 4764f13..70bd82b 100644
--- a/lib/X11/XlibAsync.c
+++ b/lib/X11/XlibAsync.c
@@ -29,7 +29,7 @@ from The Open Group.
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/lib/X11/XlibAsync.c.NX.original b/lib/X11/XlibAsync.c.NX.original
index 4764f13..70bd82b 100644
--- a/lib/X11/XlibAsync.c.NX.original
+++ b/lib/X11/XlibAsync.c.NX.original
@@ -29,7 +29,7 @@ from The Open Group.
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/lib/X11/XlibInt.c b/lib/X11/XlibInt.c
index 8ea4d32..47e2ea1 100644
--- a/lib/X11/XlibInt.c
+++ b/lib/X11/XlibInt.c
@@ -29,7 +29,7 @@ from The Open Group.
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/lib/X11/XlibInt.c.NX.original b/lib/X11/XlibInt.c.NX.original
index 8ea4d32..47e2ea1 100644
--- a/lib/X11/XlibInt.c.NX.original
+++ b/lib/X11/XlibInt.c.NX.original
@@ -29,7 +29,7 @@ from The Open Group.
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/lib/X11/Xlibint.h b/lib/X11/Xlibint.h
index 96ee095..56da234 100644
--- a/lib/X11/Xlibint.h
+++ b/lib/X11/Xlibint.h
@@ -30,7 +30,7 @@ from The Open Group.
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/lib/X11/Xlibint.h.NX.original b/lib/X11/Xlibint.h.NX.original
index 96ee095..56da234 100644
--- a/lib/X11/Xlibint.h.NX.original
+++ b/lib/X11/Xlibint.h.NX.original
@@ -30,7 +30,7 @@ from The Open Group.
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/lib/Xt/Imakefile b/lib/Xt/Imakefile
index a48081c..6399e46 100644
--- a/lib/Xt/Imakefile
+++ b/lib/Xt/Imakefile
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/lib/Xt/Imakefile.NX.original b/lib/Xt/Imakefile.NX.original
index a48081c..6399e46 100644
--- a/lib/Xt/Imakefile.NX.original
+++ b/lib/Xt/Imakefile.NX.original
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/lib/Xt/NextEvent.c b/lib/Xt/NextEvent.c
index af63651..e6cd9cb 100644
--- a/lib/Xt/NextEvent.c
+++ b/lib/Xt/NextEvent.c
@@ -61,7 +61,7 @@ in this Software without prior written authorization from The Open Group.
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/lib/Xt/NextEvent.c.NX.original b/lib/Xt/NextEvent.c.NX.original
index af63651..e6cd9cb 100644
--- a/lib/Xt/NextEvent.c.NX.original
+++ b/lib/Xt/NextEvent.c.NX.original
@@ -61,7 +61,7 @@ in this Software without prior written authorization from The Open Group.
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/lib/xtrans/Xtranssock.c b/lib/xtrans/Xtranssock.c
index b1e5a47..50b6770 100644
--- a/lib/xtrans/Xtranssock.c
+++ b/lib/xtrans/Xtranssock.c
@@ -55,7 +55,7 @@ from the copyright holders.
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/lib/xtrans/Xtranssock.c.NX.original b/lib/xtrans/Xtranssock.c.NX.original
index b1e5a47..50b6770 100644
--- a/lib/xtrans/Xtranssock.c.NX.original
+++ b/lib/xtrans/Xtranssock.c.NX.original
@@ -55,7 +55,7 @@ from the copyright holders.
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Imakefile b/programs/Imakefile
index dad15fa..9480baf 100644
--- a/programs/Imakefile
+++ b/programs/Imakefile
@@ -5,7 +5,7 @@ XCOMM $Xorg: Imakefile,v 1.4 2000/08/17 19:47:01 cpqbld Exp $
 XCOMM $XFree86: xc/programs/Imakefile,v 3.54 2003/04/14 20:37:16 herrb Exp $
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Imakefile.NX.original b/programs/Imakefile.NX.original
index dad15fa..9480baf 100644
--- a/programs/Imakefile.NX.original
+++ b/programs/Imakefile.NX.original
@@ -5,7 +5,7 @@ XCOMM $Xorg: Imakefile,v 1.4 2000/08/17 19:47:01 cpqbld Exp $
 XCOMM $XFree86: xc/programs/Imakefile,v 3.54 2003/04/14 20:37:16 herrb Exp $
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/GL/glx/render2.c b/programs/Xserver/GL/glx/render2.c
index 39d0c13..f4491b2 100644
--- a/programs/Xserver/GL/glx/render2.c
+++ b/programs/Xserver/GL/glx/render2.c
@@ -43,7 +43,7 @@
 #include &quot;unpack.h&quot;
 #include &quot;g_disptab.h&quot;
 #include &quot;g_disptab_EXT.h&quot;
-
+#include &quot;indirect_size.h&quot;
 
 void __glXDisp_Map1f(GLbyte *pc)
 {
diff --git a/programs/Xserver/GL/glx/render2swap.c b/programs/Xserver/GL/glx/render2swap.c
index 65ac5e1..0225970 100644
--- a/programs/Xserver/GL/glx/render2swap.c
+++ b/programs/Xserver/GL/glx/render2swap.c
@@ -43,7 +43,7 @@
 #include &quot;unpack.h&quot;
 #include &quot;g_disptab.h&quot;
 #include &quot;g_disptab_EXT.h&quot;
-
+#include &quot;indirect_size.h&quot;
 
 void __glXDispSwap_Map1f(GLbyte *pc)
 {
diff --git a/programs/Xserver/Imakefile.NX.original b/programs/Xserver/Imakefile.NX.original
index 8a29e66..6bf7801 100644
--- a/programs/Xserver/Imakefile.NX.original
+++ b/programs/Xserver/Imakefile.NX.original
@@ -2,7 +2,7 @@ XCOMM $XdotOrg: xc/programs/Xserver/Imakefile,v 1.37 2005/11/18 18:15:23 ajax Ex
 XCOMM $Xorg: Imakefile,v 1.4 2001/03/14 18:42:02 pookie Exp $
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/Xext/Imakefile b/programs/Xserver/Xext/Imakefile
index 697c8dd..b75f891 100644
--- a/programs/Xserver/Xext/Imakefile
+++ b/programs/Xserver/Xext/Imakefile
@@ -8,7 +8,7 @@ XCOMM $XFree86: xc/programs/Xserver/Xext/Imakefile,v 3.43 2003/04/21 18:56:48 sv
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/Xext/Imakefile.NX.original b/programs/Xserver/Xext/Imakefile.NX.original
index 697c8dd..b75f891 100644
--- a/programs/Xserver/Xext/Imakefile.NX.original
+++ b/programs/Xserver/Xext/Imakefile.NX.original
@@ -8,7 +8,7 @@ XCOMM $XFree86: xc/programs/Xserver/Xext/Imakefile,v 3.43 2003/04/21 18:56:48 sv
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/Xext/security.c b/programs/Xserver/Xext/security.c
index d271e1b..2139425 100644
--- a/programs/Xserver/Xext/security.c
+++ b/programs/Xserver/Xext/security.c
@@ -29,7 +29,7 @@ in this Software without prior written authorization from The Open Group.
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/Xext/security.c.NX.original b/programs/Xserver/Xext/security.c.NX.original
index d271e1b..2139425 100644
--- a/programs/Xserver/Xext/security.c.NX.original
+++ b/programs/Xserver/Xext/security.c.NX.original
@@ -29,7 +29,7 @@ in this Software without prior written authorization from The Open Group.
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Agent.h b/programs/Xserver/hw/nxagent/Agent.h
index 3f2c93f..dbed1e0 100644
--- a/programs/Xserver/hw/nxagent/Agent.h
+++ b/programs/Xserver/hw/nxagent/Agent.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Args.c b/programs/Xserver/hw/nxagent/Args.c
index c2e58bd..8fbb275 100644
--- a/programs/Xserver/hw/nxagent/Args.c
+++ b/programs/Xserver/hw/nxagent/Args.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
@@ -562,11 +562,15 @@ int ddxProcessArgument(int argc, char *argv[], int i)
       if (!strcmp(argv[i],&quot;fullscreen&quot;))
       {
         nxagentChangeOption(Fullscreen, True);
+
+        nxagentChangeOption(AllScreens, True);
       }
       else if (!strcmp(argv[i],&quot;ipaq&quot;))
       {
         nxagentChangeOption(Fullscreen, True);
 
+        nxagentChangeOption(AllScreens, True);
+
         nxagentIpaq = True;
       }
       else
@@ -1071,10 +1075,14 @@ static void nxagentParseOptions(char *name, char *value)
     else if (!strcmp(value, &quot;1&quot;))
     {
       nxagentChangeOption(Fullscreen, True);
+
+      nxagentChangeOption(AllScreens, True);
     }
     else if (!strcmp(value, &quot;0&quot;))
     {
       nxagentChangeOption(Fullscreen, False);
+
+      nxagentChangeOption(AllScreens, False);
     }
     else
     {
@@ -1680,6 +1688,11 @@ N/A
       nxagentChangeOption(Fullscreen, False);
     }
 
+    if (nxagentOption(AllScreens) == UNDEFINED)
+    {
+      nxagentChangeOption(AllScreens, False);
+    }
+
     if (nxagentOption(Binder) == UNDEFINED)
     {
       nxagentChangeOption(Binder, False);
diff --git a/programs/Xserver/hw/nxagent/Args.h b/programs/Xserver/hw/nxagent/Args.h
index 92650a4..9cb97ca 100644
--- a/programs/Xserver/hw/nxagent/Args.h
+++ b/programs/Xserver/hw/nxagent/Args.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Atoms.c b/programs/Xserver/hw/nxagent/Atoms.c
index 7f12406..578731f 100644
--- a/programs/Xserver/hw/nxagent/Atoms.c
+++ b/programs/Xserver/hw/nxagent/Atoms.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
@@ -66,19 +66,21 @@ Atom nxagentAtoms[NXAGENT_NUMBER_OF_ATOMS];
 
 static char *nxagentAtomNames[NXAGENT_NUMBER_OF_ATOMS + 1] =
 {
-  &quot;NX_IDENTITY&quot;,          /* 0  */
-  &quot;WM_PROTOCOLS&quot;,         /* 1  */
-  &quot;WM_DELETE_WINDOW&quot;,     /* 2  */
-  &quot;WM_NX_READY&quot;,          /* 3  */
-  &quot;MCOPGLOBALS&quot;,          /* 4  */
-  &quot;NX_CUT_BUFFER_SERVER&quot;, /* 5  */
-  &quot;TARGETS&quot;,              /* 6  */
-  &quot;TEXT&quot;,                 /* 7  */
-  &quot;NX_AGENT_SIGNATURE&quot;,   /* 8  */
-  &quot;NXDARWIN&quot;,             /* 9  */
-  &quot;CLIPBOARD&quot;,            /* 10 */
-  &quot;TIMESTAMP&quot;,            /* 11 */
-  &quot;UTF8_STRING&quot;,          /* 12 */
+  &quot;NX_IDENTITY&quot;,                 /* 0  */
+  &quot;WM_PROTOCOLS&quot;,                /* 1  */
+  &quot;WM_DELETE_WINDOW&quot;,            /* 2  */
+  &quot;WM_NX_READY&quot;,                 /* 3  */
+  &quot;MCOPGLOBALS&quot;,                 /* 4  */
+  &quot;NX_CUT_BUFFER_SERVER&quot;,        /* 5  */
+  &quot;TARGETS&quot;,                     /* 6  */
+  &quot;TEXT&quot;,                        /* 7  */
+  &quot;NX_AGENT_SIGNATURE&quot;,          /* 8  */
+  &quot;NXDARWIN&quot;,                    /* 9  */
+  &quot;CLIPBOARD&quot;,                   /* 10 */
+  &quot;TIMESTAMP&quot;,                   /* 11 */
+  &quot;UTF8_STRING&quot;,                 /* 12 */
+  &quot;_NET_WM_STATE&quot;,               /* 13 */
+  &quot;_NET_WM_STATE_FULLSCREEN&quot;,    /* 14 */
   NULL,
   NULL
 };
diff --git a/programs/Xserver/hw/nxagent/Atoms.h b/programs/Xserver/hw/nxagent/Atoms.h
index d8acb94..d5b7fe5 100644
--- a/programs/Xserver/hw/nxagent/Atoms.h
+++ b/programs/Xserver/hw/nxagent/Atoms.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
@@ -22,7 +22,7 @@
 #include &quot;../../include/window.h&quot;
 #include &quot;screenint.h&quot;
 
-#define NXAGENT_NUMBER_OF_ATOMS  14
+#define NXAGENT_NUMBER_OF_ATOMS  16
 
 extern Atom nxagentAtoms[NXAGENT_NUMBER_OF_ATOMS];
 
diff --git a/programs/Xserver/hw/nxagent/Binder.c b/programs/Xserver/hw/nxagent/Binder.c
index 34433bd..d40aaeb 100644
--- a/programs/Xserver/hw/nxagent/Binder.c
+++ b/programs/Xserver/hw/nxagent/Binder.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Binder.h b/programs/Xserver/hw/nxagent/Binder.h
index e0da3e3..f28a82b 100644
--- a/programs/Xserver/hw/nxagent/Binder.h
+++ b/programs/Xserver/hw/nxagent/Binder.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/CHANGELOG b/programs/Xserver/hw/nxagent/CHANGELOG
index a0e9bea..fc6f2a8 100644
--- a/programs/Xserver/hw/nxagent/CHANGELOG
+++ b/programs/Xserver/hw/nxagent/CHANGELOG
@@ -1,8 +1,160 @@
 ChangeLog:
 
-nxagent-3.4.0.5
+x2goagent-3.5.0.2
 
-- Changed version numbering scheme, upstream now maintained by X2go project.
+- forked nxagent-3.5.0-1
+
+nxagent-3.5.0-2
+
+- Fixed TR0502449. Initialized font server path even if font server
+  connection fails.
+
+nxagent-3.5.0-1
+
+- Opened the 3.5.0 branch based on nxagent-3.4.0-16.
+
+- Updated copyright to year 2009.
+
+- Fixed TR0302438. Added a check in function exporting property in
+  order to handle the case looking up an atom name returns a null
+  pointer.
+
+nxagent-3.4.0-16
+
+- Updated copyright to year 2011.
+
+nxagent-3.4.0-15
+
+- Added reference to fixed TR11H02405.
+
+nxagent-3.4.0-14
+
+- Reverted fix for TR03H02335 implemented in nxagent-3.4.0-6. The
+  emulation of right click by Control key + left click introduces
+  issues for some applications changing the reaction to the left click
+  depending on the state of Control key. Issue reported in TR03H02335
+  affects Apple laptop touchpads having a single button acting as
+  left button: on those devices the right button can be emulated by
+  a double-fingered tap (using two fingertips simultaneously).
+
+nxagent-3.4.0-13
+
+- Fixed TR12H02414. Exported property must be split if ChangeProperty
+  request exceeds 262140 bytes.
+
+- Reset AllScreens option at reconnection time if full screen mode
+  have to be automatically turned off.
+
+nxagent-3.4.0-12
+
+- If one of the two full screen modes is active ('one screen' or 'all
+  screens') both keystrokes Ctrl-Alt-F and Ctrl-Alt-Shift-F change the
+  mode back to 'windowed'.
+
+- Fixed TR11H02405. XRenderFreePicture is called only for pictures
+  that were actually created on the X server side.
+
+- Ctrl+Alt+f switch fullscreen to all monitors, while Ctrl+Alt+Shift+f
+  does it to one monitor only.
+
+- If the fullscreen option is enabled at the startup, session starts
+  in the fullscreen mode on all monitors.
+
+- Added a call to XReparentWindow in the nxagentSwitchAllScreens().
+
+- Corrected focus and grab when switching to fullscreen on
+  all monitors.
+
+- Removed a compile warning e deleted some unused variables.
+
+- Removed nxagentPointerAndKeyboardGrabbed variable. 
+
+- Use the override redirect attribute to switch to fullscreen to all
+  monitors instead of send _NET_WM_FULLSCREEN_MONITORS hint to the WM.
+
+- Added nxagentMinimizeFromFullScreen(), nxagentMaximizeToFullScreen()
+  and nxagentCreateIconWindow().
+
+- Removed check on EnterNotify to grab the keyboard in fullscreen
+  mode not only if mode is 'NotifyNormal'.
+
+nxagent-3.4.0-11
+
+- Corrected switching between viewport mode and resize mode.
+
+- Fixed TR04H02340. Keycode is correctly translated in shadow sessions
+  also if the remote X display is using evdev.
+
+nxagent-3.4.0-10
+
+- Handled XGrabKeyboard() return value.
+
+- Fixed TR10D01512. NumLock and CapsLock keys are now synchronized
+  between local and remote.
+
+nxagent-3.4.0-9
+
+- Fixed TR06H02362. No icon was swown in the task bar.
+
+- Fixed keyboard grab in fullscreen mode.
+
+- Fixed compiler warnings.
+
+nxagent-3.4.0-8
+
+- Grab the keyboard in fullscreen mode on EnterNotify only if mode is
+  'NotifyNormal'.
+
+- Yield control in the dispatch loop in case we stop the smart sche-
+  duler timer while waiting for a reply from the remote display.
+
+nxagent-3.4.0-7
+
+- Fixed TR08D01478. The communication with the compiz window manager
+  by means of the _NET_WM_PING property was not handled properly.
+
+- Fixed a type mismatch in XKB events on 64 bit platforms.
+
+- Moved grab/ungrab keyboard from focus in/out event to enter/leave
+  notify event.
+
+- Removed nxagentIconWindow because it's not longer used.
+
+nxagent-3.4.0-6
+
+- Fixed TR09F02102. Problem was with pointer buttons map.
+
+- Fixed TR02H02327. Some KeyRelease events was discarded.
+
+- Fixed up Num and Caps locks.
+
+- Fixed TR03H02335. Emulated right mouse button for Mac clients.
+
+- Added utilities to print info about internal and remote windows.
+
+- Fixed TR01F01995. Solved a picture resource leak by destroying remo-
+  te pictures only when their reference counter returns to zero.
+
+- Fixed TR04H02337. Errors occurred because pictures with no drawable
+  were handled badly.
+
+- Implemented handling nxagent's private for gradient pictures and so-
+  lid fill picture.
+
+- Fixed BadMatch condition check in function ProcRenderComposite.
+
+- Fixed nxagentComposite() to handle situations with source picture
+  drawable pointing to NULL.
+
+- Implemented render acceleration for requests:  CreateSolidFill,
+  CreateLinearGradient, CreateRadialGradient, CreateConicalGradient.
+
+- Fixed TR03G02196. Dialogs are shown to the fore when the NX session
+  is in fullscreen mode.
+
+- Changed mechanism to switch to fullscreen mode. Now the override
+  redirect attribute is no longer used and _NET_WM_STATE_FULLSCREEN
+  hint is sent to the WM.
 
 nxagent-3.4.0-5
 
diff --git a/programs/Xserver/hw/nxagent/Client.c b/programs/Xserver/hw/nxagent/Client.c
index acfaab7..63ed0e1 100644
--- a/programs/Xserver/hw/nxagent/Client.c
+++ b/programs/Xserver/hw/nxagent/Client.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Client.h b/programs/Xserver/hw/nxagent/Client.h
index 45f87fc..a9b06c8 100644
--- a/programs/Xserver/hw/nxagent/Client.h
+++ b/programs/Xserver/hw/nxagent/Client.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Clipboard.c b/programs/Xserver/hw/nxagent/Clipboard.c
index eb83023..2742e14 100644
--- a/programs/Xserver/hw/nxagent/Clipboard.c
+++ b/programs/Xserver/hw/nxagent/Clipboard.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Clipboard.h b/programs/Xserver/hw/nxagent/Clipboard.h
index 2750ddf..43189df 100644
--- a/programs/Xserver/hw/nxagent/Clipboard.h
+++ b/programs/Xserver/hw/nxagent/Clipboard.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Colormap.c b/programs/Xserver/hw/nxagent/Colormap.c
index 259aa3b..b0f0507 100644
--- a/programs/Xserver/hw/nxagent/Colormap.c
+++ b/programs/Xserver/hw/nxagent/Colormap.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Colormap.h b/programs/Xserver/hw/nxagent/Colormap.h
index 8321e80..b296059 100644
--- a/programs/Xserver/hw/nxagent/Colormap.h
+++ b/programs/Xserver/hw/nxagent/Colormap.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Composite.c b/programs/Xserver/hw/nxagent/Composite.c
index b0640ff..c79104f 100644
--- a/programs/Xserver/hw/nxagent/Composite.c
+++ b/programs/Xserver/hw/nxagent/Composite.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Composite.h b/programs/Xserver/hw/nxagent/Composite.h
index fb1d6d8..e875d00 100644
--- a/programs/Xserver/hw/nxagent/Composite.h
+++ b/programs/Xserver/hw/nxagent/Composite.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Cursor.c b/programs/Xserver/hw/nxagent/Cursor.c
index 141ba3a..9ed7c23 100644
--- a/programs/Xserver/hw/nxagent/Cursor.c
+++ b/programs/Xserver/hw/nxagent/Cursor.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Cursor.h b/programs/Xserver/hw/nxagent/Cursor.h
index 11e407e..df7dc44 100644
--- a/programs/Xserver/hw/nxagent/Cursor.h
+++ b/programs/Xserver/hw/nxagent/Cursor.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Dialog.c b/programs/Xserver/hw/nxagent/Dialog.c
index 2f807b1..0fb9491 100644
--- a/programs/Xserver/hw/nxagent/Dialog.c
+++ b/programs/Xserver/hw/nxagent/Dialog.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Dialog.h b/programs/Xserver/hw/nxagent/Dialog.h
index aa845c7..bd12f30 100644
--- a/programs/Xserver/hw/nxagent/Dialog.h
+++ b/programs/Xserver/hw/nxagent/Dialog.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Display.c b/programs/Xserver/hw/nxagent/Display.c
index c950ef1..2c5450d 100644
--- a/programs/Xserver/hw/nxagent/Display.c
+++ b/programs/Xserver/hw/nxagent/Display.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Display.h b/programs/Xserver/hw/nxagent/Display.h
index 35b7857..454150d 100644
--- a/programs/Xserver/hw/nxagent/Display.h
+++ b/programs/Xserver/hw/nxagent/Display.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Drawable.c b/programs/Xserver/hw/nxagent/Drawable.c
index 7505709..9c16774 100644
--- a/programs/Xserver/hw/nxagent/Drawable.c
+++ b/programs/Xserver/hw/nxagent/Drawable.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Drawable.h b/programs/Xserver/hw/nxagent/Drawable.h
index 146610e..c987fa1 100644
--- a/programs/Xserver/hw/nxagent/Drawable.h
+++ b/programs/Xserver/hw/nxagent/Drawable.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Error.c b/programs/Xserver/hw/nxagent/Error.c
index 963cfa2..43bf859 100644
--- a/programs/Xserver/hw/nxagent/Error.c
+++ b/programs/Xserver/hw/nxagent/Error.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Error.h b/programs/Xserver/hw/nxagent/Error.h
index 2d6083d..e55fd71 100644
--- a/programs/Xserver/hw/nxagent/Error.h
+++ b/programs/Xserver/hw/nxagent/Error.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Events.c b/programs/Xserver/hw/nxagent/Events.c
index ca21423..b9da934 100644
--- a/programs/Xserver/hw/nxagent/Events.c
+++ b/programs/Xserver/hw/nxagent/Events.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
@@ -76,7 +76,9 @@
 #include &quot;input.h&quot;
 #endif
 
+#define Time XlibXID
 #include &quot;XKBlib.h&quot;
+#undef Time
 
 #define GC     XlibGC
 #define Font   XlibFont
@@ -219,6 +221,16 @@ static void nxagentForwardRemoteExpose(void);
 static int nxagentClipAndSendExpose(WindowPtr pWin, pointer ptr);
 
 /*
+ * This is from NXproperty.c.
+ */
+
+int GetWindowProperty(WindowPtr pWin, Atom property, long longOffset,
+                          long longLength, Bool delete, Atom type,
+                              Atom *actualType, int *format, unsigned
+                                  long *nItems, unsigned long *bytesAfter,
+                                      unsigned char **propData);
+
+/*
  * Associate a resource to a drawable and
  * store the region affected by the split
  * operation.
@@ -274,6 +286,280 @@ void ProcessInputEvents()
   mieqProcessInputEvents();
 }
 
+#ifdef DEBUG_TREE
+
+/*
+ * Print ID and name of window.
+ */
+
+void nxagentRemoteWindowID(Window window, Bool newline)
+{
+#ifdef NO_I18N
+    char *winName;
+#else
+    XTextProperty tp;
+#endif
+
+  fprintf(stderr, &quot;0x%lx&quot;, window);
+
+  if (!window)
+  {
+    fprintf(stderr, &quot; (none) &quot;);
+  }
+  else
+  {
+    if (window == DefaultRootWindow(nxagentDisplay))
+    {
+      fprintf(stderr, &quot; (the root window) &quot;);
+    }
+
+#ifdef NO_I18N
+
+    if (!XFetchName(nxagentDisplay, window, &amp;winName))
+    {
+      fprintf(stderr, &quot; (has no name) &quot;);
+    }
+    else if (winName)
+    {
+      fprintf(stderr, &quot; \&quot;%s\&quot; &quot;, winName);
+      XFree(winName);
+    }
+
+#else
+
+    if (XGetWMName(nxagentDisplay, window, &amp;tp) != 0)
+    {
+      fprintf(stderr, &quot; (has no name) &quot;);
+    }
+    else if (tp.nitems &gt; 0)
+    {
+      int count = 0;
+      int i, ret;
+      char **list = NULL;
+
+      fprintf(stderr, &quot; \&quot;&quot;);
+
+      ret = XmbTextPropertyToTextList(nxagentDisplay, &amp;tp, &amp;list, &amp;count);
+
+      if ((ret == Success || ret &gt; 0) &amp;&amp; list != NULL)
+      {
+        for (i = 0; i &lt; count; i++)
+        {
+          fprintf(stderr, &quot;%s&quot;, list[i]);
+        }
+
+        XFreeStringList(list);
+      }
+      else
+      {
+        fprintf(stderr, &quot;%s&quot;, tp.value);
+      }
+
+      fprintf(stderr, &quot;\&quot; &quot;);
+    }
+
+#endif
+
+    else
+    {
+      fprintf(stderr, &quot; (has no name) &quot;);
+    }
+  }
+
+  if (newline == TRUE)
+  {
+    fprintf(stderr, &quot;\n&quot;);
+  }
+
+  return;
+}
+
+/*
+ * Print info about remote window.
+ */
+
+void nxagentRemoteWindowInfo(Window win, int indent, Bool newLine)
+{
+  XWindowAttributes attributes;
+  int i;
+
+  if (XGetWindowAttributes(nxagentDisplay, win, &amp;attributes) == 0)
+  {
+    return;
+  }
+
+  for (i = 0; i &lt; indent; i++)
+  {
+    fprintf(stderr, &quot; &quot;);
+  }
+
+  fprintf(stderr, &quot;x=%d y=%d width=%d height=%d class=%s map_state=%s &quot;
+             &quot;override_redirect=%s\n&quot;, attributes.x, attributes.y,
+                 attributes.width, attributes.height, (attributes.class == 0) ?
+                     &quot;InputOutput&quot; : &quot;InputOnly&quot;, (attributes.map_state == 0) ?
+                         &quot;IsUnmapped&quot; : (attributes.map_state == 1 ?
+                             &quot;IsUnviewable&quot; : &quot;IsViewable&quot;),
+                                 (attributes.override_redirect == 0) ?
+                                     &quot;No&quot; : &quot;Yes&quot; );
+
+  if (newLine == TRUE)
+  {
+    fprintf(stderr, &quot;\n&quot;);
+  }
+}
+
+/*
+ * Walk remote windows tree.
+ */
+
+void nxagentRemoteWindowsTree(Window window, int level)
+{
+  int i, j;
+  Window rootWin, parentWin;
+  unsigned int numChildren;
+  Window *childList;
+
+  if (!XQueryTree(nxagentDisplay, window, &amp;rootWin, &amp;parentWin, &amp;childList,
+                      &amp;numChildren))
+  {
+    fprintf(stderr, &quot;nxagentRemoteWindowsTree - XQueryTree failed.\n&quot;);
+
+    return;
+  }
+
+  if (level == 0)
+  {
+    fprintf(stderr, &quot;\n&quot;);
+
+    fprintf(stderr, &quot;  Root Window ID: &quot;);
+    nxagentRemoteWindowID(rootWin, TRUE);
+
+    fprintf(stderr, &quot;  Parent window ID: &quot;);
+    nxagentRemoteWindowID(parentWin, TRUE);
+  }
+
+  if (level == 0 || numChildren &gt; 0)
+  {
+    fprintf(stderr, &quot;     &quot;);
+
+    for (j = 0; j &lt; level; j++)
+    {
+      fprintf(stderr, &quot;    &quot;);
+    }
+
+    fprintf(stderr, &quot;%d child%s%s\n&quot;, numChildren, (numChildren == 1) ? &quot;&quot; :
+               &quot;ren&quot;, (numChildren == 1) ? &quot;:&quot; : &quot;.&quot;);
+  }
+
+  for (i = (int) numChildren - 1; i &gt;= 0; i--)
+  {
+    fprintf(stderr, &quot;      &quot;);
+
+    for (j = 0; j &lt; level; j++)
+    {
+      fprintf(stderr, &quot;     &quot;);
+    }
+
+    nxagentRemoteWindowID(childList[i], TRUE);
+
+    nxagentRemoteWindowInfo(childList[i], (level * 5) + 6, TRUE);
+
+    nxagentRemoteWindowsTree(childList[i], level + 1);
+  }
+
+  if (childList)
+  {
+    XFree((char *) childList);
+  }
+}
+
+/*
+ * Print info about internal window.
+ */
+
+void nxagentInternalWindowInfo(WindowPtr pWin, int indent, Bool newLine)
+{
+  int i;
+  int result;
+  unsigned long ulReturnItems;
+  unsigned long ulReturnBytesLeft;
+  Atom          atomReturnType;
+  int           iReturnFormat;
+  unsigned char *pszReturnData = NULL;
+
+  fprintf(stderr, &quot;Window ID=[0x%lx] Remote ID=[0x%lx] &quot;, pWin -&gt; drawable.id,
+             nxagentWindow(pWin));
+
+  result = GetWindowProperty(pWin, MakeAtom(&quot;WM_NAME&quot;, 7, False) , 0,
+                                sizeof(CARD32), False, AnyPropertyType,
+                                    &amp;atomReturnType, &amp;iReturnFormat,
+                                        &amp;ulReturnItems, &amp;ulReturnBytesLeft,
+                                            &amp;pszReturnData);
+
+  fprintf(stderr, &quot;Name: &quot;);
+
+  if (result == Success &amp;&amp; pszReturnData != NULL)
+  {
+    pszReturnData[ulReturnItems] = '\0';
+
+    fprintf(stderr, &quot;\&quot;%s\&quot;\n&quot;, (char *) pszReturnData);
+  }
+  else
+  {
+    fprintf(stderr, &quot;%s\n&quot;, &quot;( has no name )&quot;);
+  }
+
+  for (i = 0; i &lt; indent; i++)
+  {
+    fprintf(stderr, &quot; &quot;);
+  }
+
+  fprintf(stderr, &quot;x=%d y=%d width=%d height=%d class=%s map_state=%s &quot;
+             &quot;override_redirect=%s&quot;, pWin -&gt; drawable.x, pWin -&gt; drawable.y,
+                 pWin -&gt; drawable.width, pWin -&gt; drawable.height,
+                     (pWin -&gt; drawable.class == 0) ? &quot;InputOutput&quot; :
+                         &quot;InputOnly&quot;, (pWin -&gt; mapped == 0) ?
+                             &quot;IsUnmapped&quot; : (pWin -&gt; mapped == 1 ?
+                                 &quot;IsUnviewable&quot; : &quot;IsViewable&quot;),
+                                     (pWin -&gt; overrideRedirect == 0) ?
+                                         &quot;No&quot; : &quot;Yes&quot;);
+
+  if (newLine == TRUE)
+  {
+    fprintf(stderr, &quot;\n&quot;);
+  }
+}
+
+/*
+ * Walk internal windows tree.
+ */
+
+void nxagentInternalWindowsTree(WindowPtr pWin, int indent)
+{
+  WindowPtr pChild;
+  int i;
+
+  while (pWin)
+  {
+    pChild = pWin -&gt; firstChild;
+
+    for (i = 0; i &lt; indent; i++)
+    {
+      fprintf(stderr, &quot; &quot;);
+    }
+
+    nxagentInternalWindowInfo(pWin, indent, TRUE);
+
+    fprintf(stderr, &quot;\n&quot;);
+
+    nxagentInternalWindowsTree(pChild, indent + 4);
+
+    pWin = pWin -&gt; nextSib;
+  }
+}
+
+#endif /* DEBUG_TREE */
+
 void nxagentSwitchResizeMode(ScreenPtr pScreen)
 {
   XSizeHints sizeHints;
@@ -290,8 +576,14 @@ void nxagentSwitchResizeMode(ScreenPtr pScreen)
 
     nxagentLaunchDialog(DIALOG_DISABLE_DESKTOP_RESIZE_MODE);
 
-    sizeHints.max_width = nxagentOption(RootWidth);
-    sizeHints.max_height = nxagentOption(RootHeight);
+    if (nxagentOption(Fullscreen) == 0)
+    {
+      sizeHints.max_width = nxagentOption(RootWidth);
+      sizeHints.max_height = nxagentOption(RootHeight);
+
+      XSetWMNormalHints(nxagentDisplay, nxagentDefaultWindows[pScreen-&gt;myNum],
+                            &amp;sizeHints);
+    }
   }
   else
   {
@@ -299,7 +591,8 @@ void nxagentSwitchResizeMode(ScreenPtr pScreen)
 
     nxagentLaunchDialog(DIALOG_ENABLE_DESKTOP_RESIZE_MODE);
 
-    nxagentRRSetScreenConfig(pScreen, nxagentOption(Width), nxagentOption(Height));
+    nxagentRRSetScreenConfig(pScreen, nxagentOption(Width),
+                                 nxagentOption(Height));
 
     if (nxagentOption(ClientOs) == ClientOsWinnt)
     {
@@ -308,10 +601,10 @@ void nxagentSwitchResizeMode(ScreenPtr pScreen)
 
     sizeHints.max_width = WidthOfScreen(DefaultScreenOfDisplay(nxagentDisplay));
     sizeHints.max_height = HeightOfScreen(DefaultScreenOfDisplay(nxagentDisplay));
-  }
 
-  XSetWMNormalHints(nxagentDisplay, nxagentDefaultWindows[pScreen-&gt;myNum],
-                       &amp;sizeHints);
+    XSetWMNormalHints(nxagentDisplay, nxagentDefaultWindows[pScreen-&gt;myNum],
+                          &amp;sizeHints);
+  }
 }
 
 void nxagentShadowSwitchResizeMode(ScreenPtr pScreen)
@@ -511,6 +804,7 @@ void nxagentDispatchEvents(PredicateFuncPtr predicate)
   Bool startKbd = False;
   Bool closeSession = False;
   Bool switchFullscreen = False;
+  Bool switchAllScreens = False;
 
   /*
    * Last entered top level window.
@@ -655,6 +949,22 @@ void nxagentDispatchEvents(PredicateFuncPtr predicate)
           {
             break;
           }
+
+          #ifdef DEBUG_TREE
+
+          case doDebugTree:
+          {
+            fprintf(stderr, &quot;\n ========== nxagentRemoteWindowsTree ==========\n&quot;);
+            nxagentRemoteWindowsTree(nxagentWindow(WindowTable[0]), 0);
+
+            fprintf(stderr, &quot;\n========== nxagentInternalWindowsTree ==========\n&quot;);
+            nxagentInternalWindowsTree(WindowTable[0], 0);
+
+            break;
+          }
+
+          #endif /* DEBUG_TREE */
+
           case doCloseSession:
           {
             closeSession = TRUE;
@@ -679,6 +989,12 @@ void nxagentDispatchEvents(PredicateFuncPtr predicate)
 
             break;
           }
+          case doSwitchAllScreens:
+          {
+            switchAllScreens = TRUE;
+
+            break;
+          }
           case doViewportMoveUp:
           {
             nxagentMoveViewport(pScreen, 0, -nxagentOption(Height));
@@ -779,6 +1095,8 @@ void nxagentDispatchEvents(PredicateFuncPtr predicate)
 
         if (nxagentOption(ViewOnly) == 0 &amp;&amp; nxagentOption(Shadow) == 1 &amp;&amp; result == doNothing)
         {
+          X.xkey.keycode = nxagentConvertKeycode(X.xkey.keycode);
+
           NXShadowEvent(nxagentDisplay, X);
         }
 
@@ -790,14 +1108,21 @@ void nxagentDispatchEvents(PredicateFuncPtr predicate)
         int sendKey = 0;
 
 /*
+FIXME: If we don't flush the queue here, it could happen
+       that the inputInfo structure will not be up to date
+       when we perform the following check on down keys.
+*/
+        ProcessInputEvents();
+
+/*
 FIXME: Don't enqueue the KeyRelease event if the key was
        not already pressed. This workaround avoids a fake
        KeyPress is enqueued by the XKEYBOARD extension.
        Another solution would be to let the events are
        enqueued and to remove the KeyPress afterwards.
 */
-
-        if (inputInfo.keyboard -&gt; key -&gt; down[X.xkey.keycode &gt;&gt; 3] &amp; (1 &lt;&lt; (X.xkey.keycode &amp; 7)))
+        if (BitIsOn(inputInfo.keyboard -&gt; key -&gt; down,
+                       nxagentConvertKeycode(X.xkey.keycode)))
         {
           sendKey = 1;
         }
@@ -854,6 +1179,8 @@ FIXME: Don't enqueue the KeyRelease event if the key was
 
           if (nxagentOption(ViewOnly) == 0 &amp;&amp; nxagentOption(Shadow))
           {
+            X.xkey.keycode = nxagentConvertKeycode(X.xkey.keycode);
+
             NXShadowEvent(nxagentDisplay, X);
           }
         }
@@ -917,7 +1244,7 @@ FIXME: Don't enqueue the KeyRelease event if the key was
                     X.xbutton.subwindow == None))
         {
           x.u.u.type = ButtonPress;
-          x.u.u.detail = X.xbutton.button;
+          x.u.u.detail = inputInfo.pointer -&gt; button -&gt; map[nxagentReversePointerMap[X.xbutton.button - 1]];
           x.u.keyButtonPointer.time = nxagentLastEventTime = GetTimeInMillis();
 
           if (nxagentOption(Rootless))
@@ -990,7 +1317,7 @@ FIXME: Don't enqueue the KeyRelease event if the key was
         if (minimize != True)
         {
           x.u.u.type = ButtonRelease;
-          x.u.u.detail = X.xbutton.button;
+          x.u.u.detail = inputInfo.pointer -&gt; button -&gt; map[nxagentReversePointerMap[X.xbutton.button - 1]];
           x.u.keyButtonPointer.time = nxagentLastEventTime = GetTimeInMillis();
 
           if (nxagentOption(Rootless))
@@ -1344,13 +1671,11 @@ FIXME: Don't enqueue the KeyRelease event if the key was
           nxagentScreenTrap = 0;
         }
 
-        if (nxagentOption(Fullscreen))
+        if (nxagentOption(Fullscreen) == 1 &amp;&amp;
+                X.xcrossing.window == nxagentFullscreenWindow &amp;&amp;
+                    X.xcrossing.detail != NotifyInferior)
         {
-          if (X.xcrossing.window == nxagentFullscreenWindow &amp;&amp;
-                  X.xcrossing.detail != NotifyInferior)
-          {
-            nxagentGrabPointerAndKeyboard(&amp;X);
-          }
+          nxagentGrabPointerAndKeyboard(&amp;X);
         }
 
         if (X.xcrossing.detail != NotifyInferior)
@@ -1399,14 +1724,11 @@ FIXME: Don't enqueue the KeyRelease event if the key was
           nxagentLastEnteredWindow = NULL;
         }
 
-        if (nxagentOption(Fullscreen))
+        if (X.xcrossing.window == nxagentDefaultWindows[0] &amp;&amp;
+                X.xcrossing.detail != NotifyInferior &amp;&amp;
+                    X.xcrossing.mode == NotifyNormal)
         {
-          if (X.xcrossing.window == nxagentFullscreenWindow &amp;&amp;
-                  X.xcrossing.detail != NotifyInferior &amp;&amp;
-                      X.xcrossing.mode == NotifyNormal)
-          {
-            nxagentUngrabPointerAndKeyboard(&amp;X);
-          }
+          nxagentUngrabPointerAndKeyboard(&amp;X);
         }
 
         if (X.xcrossing.detail != NotifyInferior)
@@ -1660,7 +1982,8 @@ FIXME: Don't enqueue the KeyRelease event if the key was
         }
 
         if (nxagentUseNXTrans == 1 &amp;&amp; nxagentOption(Rootless) == 0 &amp;&amp;
-                nxagentOption(Nested) == 0 &amp;&amp; X.xmap.window != nxagentIconWindow)
+                nxagentOption(Nested) == 0 &amp;&amp;
+                    X.xmap.window != nxagentIconWindow)
         {
           nxagentVisibility = VisibilityFullyObscured;
         }
@@ -1699,14 +2022,17 @@ FIXME: Don't enqueue the KeyRelease event if the key was
           }
         }
 
-        if (nxagentOption(Fullscreen) == 1)
+        if (nxagentOption(AllScreens) == 1)
         {
           if (X.xmap.window == nxagentIconWindow)
           {
             pScreen = nxagentScreen(X.xmap.window);
             nxagentMaximizeToFullScreen(pScreen);
           }
+        }
 
+        if (nxagentOption(Fullscreen) == 1)
+        {
           nxagentVisibility = VisibilityUnobscured;
           nxagentVisibilityStop = False;
           nxagentVisibilityTimeout = GetTimeInMillis() + 2000;
@@ -1716,10 +2042,17 @@ FIXME: Don't enqueue the KeyRelease event if the key was
       }
       case MappingNotify:
       {
+        XMappingEvent *mappingEvent = (XMappingEvent *) &X;
+
         #ifdef DEBUG
         fprintf(stderr, &quot;nxagentDispatchEvents: WARNING! Going to handle new MappingNotify event.\n&quot;);
         #endif
 
+        if (mappingEvent -&gt; request == MappingPointer)
+        {
+            nxagentInitPointerMap();
+        }
+
         break;
       }
       default:
@@ -1793,20 +2126,40 @@ FIXME: Don't enqueue the KeyRelease event if the key was
 
     if (nxagentWMIsRunning)
     {
-      if (nxagentOption(Fullscreen))
+      if (nxagentOption(AllScreens))
       {
         nxagentMinimizeFromFullScreen(pScreen);
       }
       else
       {
-        XIconifyWindow(nxagentDisplay, nxagentDefaultWindows[0], DefaultScreen(nxagentDisplay));
+        XIconifyWindow(nxagentDisplay, nxagentDefaultWindows[0],
+                           DefaultScreen(nxagentDisplay));
       }
     }
   }
 
   if (switchFullscreen)
   {
-    nxagentSwitchFullscreen(pScreen, !nxagentOption(Fullscreen));
+    if (nxagentOption(AllScreens) == 1 &amp;&amp; nxagentOption(Fullscreen) == 1)
+    {
+      nxagentSwitchAllScreens(pScreen, 0);
+    }
+    else
+    {
+      nxagentSwitchFullscreen(pScreen, !nxagentOption(Fullscreen));
+    }
+  }
+
+  if (switchAllScreens)
+  {
+    if (nxagentOption(AllScreens) == 0 &amp;&amp; nxagentOption(Fullscreen) == 1)
+    {
+      nxagentSwitchFullscreen(pScreen, 0);
+    }
+    else
+    {
+      nxagentSwitchAllScreens(pScreen, !nxagentOption(AllScreens));
+    }
   }
 
   if (startKbd)
@@ -1959,8 +2312,16 @@ int nxagentHandleKeyPress(XEvent *X, enum HandleEventResult *result)
     return 1;
   }
 
-  nxagentLastEventTime = nxagentLastKeyPressTime = GetTimeInMillis();
+  if (X -&gt; xkey.keycode == 66)
+  {
+    nxagentXkbState.Caps = (~nxagentXkbState.Caps &amp; 1);
+  }
+  else if (X -&gt; xkey.keycode == 77)
+  {
+    nxagentXkbState.Num = (~nxagentXkbState.Num &amp; 1);
+  }
 
+  nxagentLastEventTime = nxagentLastKeyPressTime = GetTimeInMillis();
   
   x.u.u.type = KeyPress;
   x.u.u.detail = nxagentConvertKeycode(X -&gt; xkey.keycode);
@@ -2398,7 +2759,8 @@ int nxagentHandleClientMessageEvent(XEvent *X, enum HandleEventResult *result)
         }
 
         if (X -&gt; xclient.window == (nxagentOption(Fullscreen) ?
-              nxagentIconWindow : nxagentDefaultWindows[0]))
+                nxagentIconWindow : nxagentDefaultWindows[0]) ||
+                    nxagentWMIsRunning == 0)
         {
           *result = doCloseSession;
         }
@@ -2995,7 +3357,7 @@ int nxagentHandleConfigureNotify(XEvent* X)
 
     if (X -&gt; xconfigure.window == nxagentDefaultWindows[pScreen -&gt; myNum])
     {
-      if (nxagentOption(Fullscreen) == 0)
+      if (nxagentOption(AllScreens) == 0)
       {
         if (nxagentOption(DesktopResize) == 1)
         {
@@ -3064,6 +3426,34 @@ int nxagentHandleConfigureNotify(XEvent* X)
           doRandR = 0;
         }
 
+        nxagentChangeOption(Width, X -&gt; xconfigure.width);
+        nxagentChangeOption(Height, X -&gt; xconfigure.height);
+
+        XMoveResizeWindow(nxagentDisplay, nxagentInputWindows[0], 0, 0,
+                              X -&gt; xconfigure.width, X -&gt; xconfigure.height);
+
+        if (nxagentOption(Fullscreen) == 0)
+        {
+          nxagentMoveViewport(pScreen, 0, 0);
+        }
+        else
+        {
+          nxagentChangeOption(RootX, (nxagentOption(Width) -
+                                  nxagentOption(RootWidth)) / 2);
+          nxagentChangeOption(RootY, (nxagentOption(Height) -
+                                  nxagentOption(RootHeight)) / 2);
+          nxagentChangeOption(ViewportXSpan, nxagentOption(Width) -
+                                  nxagentOption(RootWidth));
+          nxagentChangeOption(ViewportYSpan, nxagentOption(Height) -
+                                  nxagentOption(RootHeight));
+
+          nxagentUpdateViewportFrame(0, 0, nxagentOption(RootWidth),
+                                         nxagentOption(RootHeight));
+
+          XMoveWindow(nxagentDisplay, nxagentWindow(WindowTable[pScreen -&gt; myNum]),
+                          nxagentOption(RootX), nxagentOption(RootY));
+        }
+
         if (doRandR)
         {
           #ifdef TEST
@@ -3085,8 +3475,6 @@ int nxagentHandleConfigureNotify(XEvent* X)
 
 int nxagentHandleReparentNotify(XEvent* X)
 {
-  ScreenPtr pScreen = nxagentScreen(X -&gt; xreparent.window);
-
   #ifdef TEST
   fprintf(stderr, &quot;nxagentHandleReparentNotify: Going to handle a new reparent event.\n&quot;);
   #endif
@@ -3203,7 +3591,6 @@ int nxagentHandleReparentNotify(XEvent* X)
     XlibWindow *childrenReturn = NULL;
     unsigned int nchildrenReturn = 0;
     Status result;
-    XSizeHints hints;
     XWindowAttributes attributes;
     int x, y;
     int xParent, yParent;
@@ -3443,6 +3830,8 @@ void nxagentGrabPointerAndKeyboard(XEvent *X)
 
   int resource;
 
+  int result;
+
   #ifdef TEST
   fprintf(stderr, &quot;nxagentGrabPointerAndKeyboard: Grabbing pointer and keyboard with event at [%p].\n&quot;,
               (void *) X);
@@ -3461,8 +3850,22 @@ void nxagentGrabPointerAndKeyboard(XEvent *X)
   fprintf(stderr, &quot;nxagentGrabPointerAndKeyboard: Going to grab the keyboard in context [B1].\n&quot;);
   #endif
 
-  XGrabKeyboard(nxagentDisplay, nxagentFullscreenWindow,
-                    True, GrabModeAsync, GrabModeAsync, now);
+  result = XGrabKeyboard(nxagentDisplay, nxagentFullscreenWindow,
+                             True, GrabModeAsync, GrabModeAsync, now);
+
+  if (result != GrabSuccess)
+  {
+    return;
+  }
+
+  /*
+   * The smart scheduler could be stopped while
+   * waiting for the reply. In this case we need
+   * to yield explicitly to avoid to be stuck in
+   * the dispatch loop forever.
+   */
+
+  isItTimeToYield = 1;
 
   #ifdef TEST
   fprintf(stderr, &quot;nxagentGrabPointerAndKeyboard: Going to grab the pointer in context [B2].\n&quot;);
diff --git a/programs/Xserver/hw/nxagent/Events.h b/programs/Xserver/hw/nxagent/Events.h
index 238a229..c74fa15 100644
--- a/programs/Xserver/hw/nxagent/Events.h
+++ b/programs/Xserver/hw/nxagent/Events.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
@@ -29,9 +29,11 @@ enum HandleEventResult
 {
   doNothing = 0,
   doMinimize,
+  doDebugTree,
   doCloseSession,
   doStartKbd,
   doSwitchFullscreen,
+  doSwitchAllScreens,
   doViewportMoveUp,
   doViewportMoveLeft,
   doViewportMoveRight,
diff --git a/programs/Xserver/hw/nxagent/Extensions.c b/programs/Xserver/hw/nxagent/Extensions.c
index e76cbb4..aced24f 100644
--- a/programs/Xserver/hw/nxagent/Extensions.c
+++ b/programs/Xserver/hw/nxagent/Extensions.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Extensions.h b/programs/Xserver/hw/nxagent/Extensions.h
index 620645d..5335cf8 100644
--- a/programs/Xserver/hw/nxagent/Extensions.h
+++ b/programs/Xserver/hw/nxagent/Extensions.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Font.c b/programs/Xserver/hw/nxagent/Font.c
index 13b8193..178ed3c 100644
--- a/programs/Xserver/hw/nxagent/Font.c
+++ b/programs/Xserver/hw/nxagent/Font.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
@@ -1269,7 +1269,7 @@ Bool nxagentReconnectFailedFonts(void *p0)
   const int maxAttempt = 5;
 
   char **fontPaths, **localFontPaths, **newFontPaths;
-  char fontServerPath[256];
+  char fontServerPath[256] = &quot;&quot;;
   int nPaths = 0;
 
   Bool repeat = True;
diff --git a/programs/Xserver/hw/nxagent/Font.h b/programs/Xserver/hw/nxagent/Font.h
index 75ae3f6..63cb6aa 100644
--- a/programs/Xserver/hw/nxagent/Font.h
+++ b/programs/Xserver/hw/nxagent/Font.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/GC.c b/programs/Xserver/hw/nxagent/GC.c
index c53e3b9..71562d9 100644
--- a/programs/Xserver/hw/nxagent/GC.c
+++ b/programs/Xserver/hw/nxagent/GC.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/GCOps.c b/programs/Xserver/hw/nxagent/GCOps.c
index 8573079..e18b034 100644
--- a/programs/Xserver/hw/nxagent/GCOps.c
+++ b/programs/Xserver/hw/nxagent/GCOps.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/GCOps.h b/programs/Xserver/hw/nxagent/GCOps.h
index 7ae6d99..fa4967a 100644
--- a/programs/Xserver/hw/nxagent/GCOps.h
+++ b/programs/Xserver/hw/nxagent/GCOps.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/GCs.h b/programs/Xserver/hw/nxagent/GCs.h
index bec2900..f7e1347 100644
--- a/programs/Xserver/hw/nxagent/GCs.h
+++ b/programs/Xserver/hw/nxagent/GCs.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Handlers.c b/programs/Xserver/hw/nxagent/Handlers.c
index be407f1..310b572 100644
--- a/programs/Xserver/hw/nxagent/Handlers.c
+++ b/programs/Xserver/hw/nxagent/Handlers.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Handlers.h b/programs/Xserver/hw/nxagent/Handlers.h
index fe8aeef..3d3b335 100644
--- a/programs/Xserver/hw/nxagent/Handlers.h
+++ b/programs/Xserver/hw/nxagent/Handlers.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Holder.c b/programs/Xserver/hw/nxagent/Holder.c
index a9ac77c..bfd907c 100644
--- a/programs/Xserver/hw/nxagent/Holder.c
+++ b/programs/Xserver/hw/nxagent/Holder.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Holder.h b/programs/Xserver/hw/nxagent/Holder.h
index 9896aee..c39b987 100644
--- a/programs/Xserver/hw/nxagent/Holder.h
+++ b/programs/Xserver/hw/nxagent/Holder.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Icons.h b/programs/Xserver/hw/nxagent/Icons.h
index 2189238..3ac2e1a 100644
--- a/programs/Xserver/hw/nxagent/Icons.h
+++ b/programs/Xserver/hw/nxagent/Icons.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Image.c b/programs/Xserver/hw/nxagent/Image.c
index e8405ed..e499b7a 100644
--- a/programs/Xserver/hw/nxagent/Image.c
+++ b/programs/Xserver/hw/nxagent/Image.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Image.h b/programs/Xserver/hw/nxagent/Image.h
index 7805b03..57272ab 100644
--- a/programs/Xserver/hw/nxagent/Image.h
+++ b/programs/Xserver/hw/nxagent/Image.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Imakefile b/programs/Xserver/hw/nxagent/Imakefile
index 0b3d3b1..254267e 100644
--- a/programs/Xserver/hw/nxagent/Imakefile
+++ b/programs/Xserver/hw/nxagent/Imakefile
@@ -206,7 +206,8 @@ DEFINES = -g $(OS_DEFINES) $(EXT_DEFINES) $(UPG_DEFINES) \
           -DNXAGENT_SPLASH \
           -DNXAGENT_ARTSD \
           -UNX_DEBUG_INPUT \
-          -UPANORAMIX
+          -UPANORAMIX \
+          -UDEBUG_TREE
 
 all:: $(OBJS)
 
diff --git a/programs/Xserver/hw/nxagent/Init.c b/programs/Xserver/hw/nxagent/Init.c
index 15335e3..89a85db 100644
--- a/programs/Xserver/hw/nxagent/Init.c
+++ b/programs/Xserver/hw/nxagent/Init.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
@@ -74,7 +74,7 @@ is&quot; without express or implied warranty.
 #undef  DEBUG
 #undef  DUMP
 
-#define NXAGENT_VERSION  &quot;3.4.0.5&quot;
+#define NXAGENT_VERSION  &quot;3.5.0.2&quot;
 
 /*
  * ProcVector array defined in tables.c.
@@ -193,7 +193,7 @@ void InitOutput(ScreenInfo *screenInfo, int argc, char *argv[])
   if (serverGeneration &lt;= 1)
   {
     fprintf(stderr, &quot;\nNXAGENT - Version &quot; NXAGENT_VERSION &quot;\n\n&quot;);
-    fprintf(stderr, &quot;Copyright (C) 2001, 2010 NoMachine.\n&quot;);
+    fprintf(stderr, &quot;Copyright (C) 2001, 2011 NoMachine.\n&quot;);
     fprintf(stderr, &quot;See <A HREF="http://www.nomachine.com/">http://www.nomachine.com/</A> for more information.\n\n&quot;);
 
     fprintf(stderr, &quot;Info: Agent running with pid '%d'.\n&quot;, getpid());
diff --git a/programs/Xserver/hw/nxagent/Init.h b/programs/Xserver/hw/nxagent/Init.h
index 576c1a7..cf154e8 100644
--- a/programs/Xserver/hw/nxagent/Init.h
+++ b/programs/Xserver/hw/nxagent/Init.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Keyboard.c b/programs/Xserver/hw/nxagent/Keyboard.c
index b991072..a34bce7 100644
--- a/programs/Xserver/hw/nxagent/Keyboard.c
+++ b/programs/Xserver/hw/nxagent/Keyboard.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Keyboard.h b/programs/Xserver/hw/nxagent/Keyboard.h
index 1a95335..0e11a8a 100644
--- a/programs/Xserver/hw/nxagent/Keyboard.h
+++ b/programs/Xserver/hw/nxagent/Keyboard.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Keystroke.c b/programs/Xserver/hw/nxagent/Keystroke.c
index a2e4fb0..6c6e477 100644
--- a/programs/Xserver/hw/nxagent/Keystroke.c
+++ b/programs/Xserver/hw/nxagent/Keystroke.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
@@ -92,6 +92,18 @@ int nxagentCheckSpecialKeystroke(XKeyEvent *X, enum HandleEventResult *result)
   {
     switch (sym)
     {
+      #ifdef DEBUG_TREE
+
+      case XK_q:
+      case XK_Q:
+      {
+        *result = doDebugTree;
+
+        break;
+      }
+
+      #endif /* DEBUG_TREE */
+
       case XK_t:
       case XK_T:
       {
@@ -104,7 +116,7 @@ int nxagentCheckSpecialKeystroke(XKeyEvent *X, enum HandleEventResult *result)
       {
         if (nxagentOption(Rootless) == False)
         {
-          *result = doSwitchFullscreen;
+          *result = doSwitchAllScreens;
         }
 
         break;
@@ -270,6 +282,16 @@ int nxagentCheckSpecialKeystroke(XKeyEvent *X, enum HandleEventResult *result)
   {
     switch (sym)
     {
+      case XK_f:
+      case XK_F:
+      {
+        if (nxagentOption(Rootless) == 0)
+        {
+          *result = doSwitchFullscreen;
+        }
+
+        break;
+      }
       case XK_Left:
       case XK_KP_Left:
       {
diff --git a/programs/Xserver/hw/nxagent/Keystroke.h b/programs/Xserver/hw/nxagent/Keystroke.h
index e9ca59f..ef71a88 100644
--- a/programs/Xserver/hw/nxagent/Keystroke.h
+++ b/programs/Xserver/hw/nxagent/Keystroke.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/LICENSE b/programs/Xserver/hw/nxagent/LICENSE
index 141ca13..8446e6f 100644
--- a/programs/Xserver/hw/nxagent/LICENSE
+++ b/programs/Xserver/hw/nxagent/LICENSE
@@ -1,4 +1,4 @@
-Copyright (c) 2001, 2010 NoMachine - <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>
+Copyright (c) 2001, 2011 NoMachine - <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>
 
 NXAGENT and NX extensions to X are copyright of NoMachine.
 
diff --git a/programs/Xserver/hw/nxagent/Literals.h b/programs/Xserver/hw/nxagent/Literals.h
index 377dd7e..aaa3430 100644
--- a/programs/Xserver/hw/nxagent/Literals.h
+++ b/programs/Xserver/hw/nxagent/Literals.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Millis.c b/programs/Xserver/hw/nxagent/Millis.c
index bde85f0..e9c739e 100644
--- a/programs/Xserver/hw/nxagent/Millis.c
+++ b/programs/Xserver/hw/nxagent/Millis.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Millis.h b/programs/Xserver/hw/nxagent/Millis.h
index 2125eca..69d247b 100644
--- a/programs/Xserver/hw/nxagent/Millis.h
+++ b/programs/Xserver/hw/nxagent/Millis.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/NXdispatch.c b/programs/Xserver/hw/nxagent/NXdispatch.c
index 5106ffa..4f59b80 100644
--- a/programs/Xserver/hw/nxagent/NXdispatch.c
+++ b/programs/Xserver/hw/nxagent/NXdispatch.c
@@ -6,7 +6,7 @@
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/NXdispatch.c.NX.original b/programs/Xserver/hw/nxagent/NXdispatch.c.NX.original
index 5106ffa..4f59b80 100644
--- a/programs/Xserver/hw/nxagent/NXdispatch.c.NX.original
+++ b/programs/Xserver/hw/nxagent/NXdispatch.c.NX.original
@@ -6,7 +6,7 @@
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/NXdixfonts.c b/programs/Xserver/hw/nxagent/NXdixfonts.c
index 0d85842..1cccfd9 100644
--- a/programs/Xserver/hw/nxagent/NXdixfonts.c
+++ b/programs/Xserver/hw/nxagent/NXdixfonts.c
@@ -6,7 +6,7 @@
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/NXdixfonts.c.NX.original b/programs/Xserver/hw/nxagent/NXdixfonts.c.NX.original
index 0d85842..1cccfd9 100644
--- a/programs/Xserver/hw/nxagent/NXdixfonts.c.NX.original
+++ b/programs/Xserver/hw/nxagent/NXdixfonts.c.NX.original
@@ -6,7 +6,7 @@
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/NXevents.c b/programs/Xserver/hw/nxagent/NXevents.c
index cd8ced7..f697cf3 100644
--- a/programs/Xserver/hw/nxagent/NXevents.c
+++ b/programs/Xserver/hw/nxagent/NXevents.c
@@ -6,7 +6,7 @@
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/NXevents.c.NX.original b/programs/Xserver/hw/nxagent/NXevents.c.NX.original
index cd8ced7..f697cf3 100644
--- a/programs/Xserver/hw/nxagent/NXevents.c.NX.original
+++ b/programs/Xserver/hw/nxagent/NXevents.c.NX.original
@@ -6,7 +6,7 @@
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/NXextension.c b/programs/Xserver/hw/nxagent/NXextension.c
index 852ad15..1d86bf8 100644
--- a/programs/Xserver/hw/nxagent/NXextension.c
+++ b/programs/Xserver/hw/nxagent/NXextension.c
@@ -6,7 +6,7 @@
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/NXextension.c.NX.original b/programs/Xserver/hw/nxagent/NXextension.c.NX.original
index 852ad15..1d86bf8 100644
--- a/programs/Xserver/hw/nxagent/NXextension.c.NX.original
+++ b/programs/Xserver/hw/nxagent/NXextension.c.NX.original
@@ -6,7 +6,7 @@
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/NXglyph.c b/programs/Xserver/hw/nxagent/NXglyph.c
index 5524819..22483b3 100644
--- a/programs/Xserver/hw/nxagent/NXglyph.c
+++ b/programs/Xserver/hw/nxagent/NXglyph.c
@@ -6,7 +6,7 @@
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/NXglyph.c.NX.original b/programs/Xserver/hw/nxagent/NXglyph.c.NX.original
index 5524819..22483b3 100644
--- a/programs/Xserver/hw/nxagent/NXglyph.c.NX.original
+++ b/programs/Xserver/hw/nxagent/NXglyph.c.NX.original
@@ -6,7 +6,7 @@
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/NXglyphcurs.c b/programs/Xserver/hw/nxagent/NXglyphcurs.c
index 614d2db..9212bf4 100644
--- a/programs/Xserver/hw/nxagent/NXglyphcurs.c
+++ b/programs/Xserver/hw/nxagent/NXglyphcurs.c
@@ -6,7 +6,7 @@
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/NXglyphcurs.c.NX.original b/programs/Xserver/hw/nxagent/NXglyphcurs.c.NX.original
index 614d2db..9212bf4 100644
--- a/programs/Xserver/hw/nxagent/NXglyphcurs.c.NX.original
+++ b/programs/Xserver/hw/nxagent/NXglyphcurs.c.NX.original
@@ -6,7 +6,7 @@
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/NXglyphstr.h b/programs/Xserver/hw/nxagent/NXglyphstr.h
index 08ffb35..0f122be 100644
--- a/programs/Xserver/hw/nxagent/NXglyphstr.h
+++ b/programs/Xserver/hw/nxagent/NXglyphstr.h
@@ -6,7 +6,7 @@
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/NXglyphstr.h.NX.original b/programs/Xserver/hw/nxagent/NXglyphstr.h.NX.original
index 08ffb35..0f122be 100644
--- a/programs/Xserver/hw/nxagent/NXglyphstr.h.NX.original
+++ b/programs/Xserver/hw/nxagent/NXglyphstr.h.NX.original
@@ -6,7 +6,7 @@
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/NXmiglyph.c b/programs/Xserver/hw/nxagent/NXmiglyph.c
index 806cf29..09901ba 100644
--- a/programs/Xserver/hw/nxagent/NXmiglyph.c
+++ b/programs/Xserver/hw/nxagent/NXmiglyph.c
@@ -6,7 +6,7 @@
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/NXmiglyph.c.NX.original b/programs/Xserver/hw/nxagent/NXmiglyph.c.NX.original
index 806cf29..09901ba 100644
--- a/programs/Xserver/hw/nxagent/NXmiglyph.c.NX.original
+++ b/programs/Xserver/hw/nxagent/NXmiglyph.c.NX.original
@@ -6,7 +6,7 @@
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/NXpicture.c b/programs/Xserver/hw/nxagent/NXpicture.c
index a9c501b..d32cdb6 100644
--- a/programs/Xserver/hw/nxagent/NXpicture.c
+++ b/programs/Xserver/hw/nxagent/NXpicture.c
@@ -6,7 +6,7 @@
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/NXpicture.c.NX.original b/programs/Xserver/hw/nxagent/NXpicture.c.NX.original
index a9c501b..d32cdb6 100644
--- a/programs/Xserver/hw/nxagent/NXpicture.c.NX.original
+++ b/programs/Xserver/hw/nxagent/NXpicture.c.NX.original
@@ -6,7 +6,7 @@
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/NXpicturestr.h b/programs/Xserver/hw/nxagent/NXpicturestr.h
index 26a95fe..91eab01 100644
--- a/programs/Xserver/hw/nxagent/NXpicturestr.h
+++ b/programs/Xserver/hw/nxagent/NXpicturestr.h
@@ -6,7 +6,7 @@
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/NXpicturestr.h.NX.original b/programs/Xserver/hw/nxagent/NXpicturestr.h.NX.original
index 26a95fe..91eab01 100644
--- a/programs/Xserver/hw/nxagent/NXpicturestr.h.NX.original
+++ b/programs/Xserver/hw/nxagent/NXpicturestr.h.NX.original
@@ -6,7 +6,7 @@
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/NXproperty.c b/programs/Xserver/hw/nxagent/NXproperty.c
index 14b6136..20a6bd6 100644
--- a/programs/Xserver/hw/nxagent/NXproperty.c
+++ b/programs/Xserver/hw/nxagent/NXproperty.c
@@ -6,7 +6,7 @@
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/NXproperty.c.NX.original b/programs/Xserver/hw/nxagent/NXproperty.c.NX.original
index 14b6136..20a6bd6 100644
--- a/programs/Xserver/hw/nxagent/NXproperty.c.NX.original
+++ b/programs/Xserver/hw/nxagent/NXproperty.c.NX.original
@@ -6,7 +6,7 @@
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/NXrandr.c b/programs/Xserver/hw/nxagent/NXrandr.c
index b7039e1..d593fa6 100644
--- a/programs/Xserver/hw/nxagent/NXrandr.c
+++ b/programs/Xserver/hw/nxagent/NXrandr.c
@@ -6,7 +6,7 @@
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/NXrandr.c.NX.original b/programs/Xserver/hw/nxagent/NXrandr.c.NX.original
index b7039e1..d593fa6 100644
--- a/programs/Xserver/hw/nxagent/NXrandr.c.NX.original
+++ b/programs/Xserver/hw/nxagent/NXrandr.c.NX.original
@@ -6,7 +6,7 @@
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/NXrender.c b/programs/Xserver/hw/nxagent/NXrender.c
index 0940a36..43607ac 100644
--- a/programs/Xserver/hw/nxagent/NXrender.c
+++ b/programs/Xserver/hw/nxagent/NXrender.c
@@ -31,7 +31,7 @@
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/NXrender.c.NX.original b/programs/Xserver/hw/nxagent/NXrender.c.NX.original
index 0940a36..43607ac 100644
--- a/programs/Xserver/hw/nxagent/NXrender.c.NX.original
+++ b/programs/Xserver/hw/nxagent/NXrender.c.NX.original
@@ -31,7 +31,7 @@
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/NXwindow.c b/programs/Xserver/hw/nxagent/NXwindow.c
index 0954cf8..95ecde9 100644
--- a/programs/Xserver/hw/nxagent/NXwindow.c
+++ b/programs/Xserver/hw/nxagent/NXwindow.c
@@ -6,7 +6,7 @@
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/NXwindow.c.NX.original b/programs/Xserver/hw/nxagent/NXwindow.c.NX.original
index 0954cf8..95ecde9 100644
--- a/programs/Xserver/hw/nxagent/NXwindow.c.NX.original
+++ b/programs/Xserver/hw/nxagent/NXwindow.c.NX.original
@@ -6,7 +6,7 @@
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/NXxrandr.c b/programs/Xserver/hw/nxagent/NXxrandr.c
index 8d05175..37b2c74 100644
--- a/programs/Xserver/hw/nxagent/NXxrandr.c
+++ b/programs/Xserver/hw/nxagent/NXxrandr.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/NXxrandr.h b/programs/Xserver/hw/nxagent/NXxrandr.h
index 4e800e9..160dc65 100644
--- a/programs/Xserver/hw/nxagent/NXxrandr.h
+++ b/programs/Xserver/hw/nxagent/NXxrandr.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/NXxrandrint.h b/programs/Xserver/hw/nxagent/NXxrandrint.h
index ae3a03d..97ae77e 100644
--- a/programs/Xserver/hw/nxagent/NXxrandrint.h
+++ b/programs/Xserver/hw/nxagent/NXxrandrint.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Options.c b/programs/Xserver/hw/nxagent/Options.c
index 1f04b0d..5d78556 100644
--- a/programs/Xserver/hw/nxagent/Options.c
+++ b/programs/Xserver/hw/nxagent/Options.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Options.h b/programs/Xserver/hw/nxagent/Options.h
index 1bc7eaa..7850a05 100644
--- a/programs/Xserver/hw/nxagent/Options.h
+++ b/programs/Xserver/hw/nxagent/Options.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
@@ -103,6 +103,13 @@ typedef struct _AgentOptions
   int Fullscreen;
 
   /*
+   * True if the fullscreen NX session will
+   * extend on all available screens.
+   */
+
+  int AllScreens;
+
+  /*
    * Set to the auto-disconnect timeout, if
    * the user activated this feature.
    */
diff --git a/programs/Xserver/hw/nxagent/Pixels.c b/programs/Xserver/hw/nxagent/Pixels.c
index 10c705d..d3ab9dd 100644
--- a/programs/Xserver/hw/nxagent/Pixels.c
+++ b/programs/Xserver/hw/nxagent/Pixels.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Pixels.h b/programs/Xserver/hw/nxagent/Pixels.h
index e046771..918d74d 100644
--- a/programs/Xserver/hw/nxagent/Pixels.h
+++ b/programs/Xserver/hw/nxagent/Pixels.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
@@ -108,6 +108,12 @@ FIXME: The condition checking for the render
        avoid problems with the render composi-
        te on XFree86 remote server.
 */
+/*
+FIXME: Changed macro: NXAGENT_SHOULD_DEFER_COMPOSITE
+       to handle situation, when pSrc -&gt; pDrawable
+       is NULL. This case happens with gradients
+       and solid fill.
+
 #define NXAGENT_SHOULD_DEFER_COMPOSITE(pSrc, pMask, pDst)                 \
     ((nxagentRenderVersionMajor == 0 &amp;&amp;                                   \
      nxagentRenderVersionMinor == 8 &amp;&amp;                                \
@@ -118,6 +124,18 @@ FIXME: The condition checking for the render
           nxagentOption(DeferLevel) == 1) ||               \
              (nxagentOption(DeferLevel) &gt;= 2 &amp;&amp;           \
               nxagentOption(LinkType) &lt; LINK_TYPE_ADSL))
+*/
+#define NXAGENT_SHOULD_DEFER_COMPOSITE(pSrc, pMask, pDst)                                                \
+    ((nxagentRenderVersionMajor == 0 &amp;&amp;                                                                  \
+      nxagentRenderVersionMinor == 8 &amp;&amp;                                                                  \
+      (pDst) -&gt; pDrawable -&gt; type == DRAWABLE_PIXMAP) ||                                                 \
+         (nxagentOption(DeferLevel) &gt;= 2 &amp;&amp;                                                              \
+          nxagentOption(LinkType) &lt; LINK_TYPE_ADSL) ||                                                   \
+             (nxagentOption(DeferLevel) == 1 &amp;&amp;                                                          \
+              (pDst) -&gt; pDrawable -&gt; type == DRAWABLE_PIXMAP &amp;&amp;                                          \
+              (((pSrc) -&gt; pDrawable &amp;&amp; nxagentDrawableStatus((pSrc) -&gt; pDrawable) == NotSynchronized) || \
+              ((pMask) &amp;&amp; nxagentDrawableStatus((pMask) -&gt; pDrawable) == NotSynchronized))))
+
 
 #define NXAGENT_SHOULD_DEFER_PUTIMAGE(pDrawable) \
     (nxagentSplitTrap == 0 &amp;&amp;                    \
diff --git a/programs/Xserver/hw/nxagent/Pixmap.c b/programs/Xserver/hw/nxagent/Pixmap.c
index 1718c73..ad7e9c3 100644
--- a/programs/Xserver/hw/nxagent/Pixmap.c
+++ b/programs/Xserver/hw/nxagent/Pixmap.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Pixmaps.h b/programs/Xserver/hw/nxagent/Pixmaps.h
index 234650d..98d5666 100644
--- a/programs/Xserver/hw/nxagent/Pixmaps.h
+++ b/programs/Xserver/hw/nxagent/Pixmaps.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Pointer.c b/programs/Xserver/hw/nxagent/Pointer.c
index 34012d3..a751974 100644
--- a/programs/Xserver/hw/nxagent/Pointer.c
+++ b/programs/Xserver/hw/nxagent/Pointer.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
@@ -57,6 +57,13 @@ is&quot; without express or implied warranty.
 #undef  TEST
 #undef  DEBUG
 
+/*
+ * The nxagentReversePointerMap array is used to
+ * memorize remote display pointer map.
+ */
+
+unsigned char nxagentReversePointerMap[MAXBUTTONS];
+
 void nxagentChangePointerControl(DeviceIntPtr pDev, PtrCtrl *ctrl)
 {
   /*
@@ -125,6 +132,8 @@ int nxagentPointerProc(DeviceIntPtr pDev, int onoff)
         return Success;
       }
 
+      nxagentInitPointerMap();
+
       nxagentEnablePointerEvents();
 
       break;
@@ -155,3 +164,28 @@ int nxagentPointerProc(DeviceIntPtr pDev, int onoff)
 
   return Success;
 }
+
+void nxagentInitPointerMap(void)
+{
+  int numButtons;
+
+  int i;
+
+  unsigned char pointerMap[MAXBUTTONS];
+
+  #ifdef DEBUG
+  fprintf(stderr, &quot;nxagentInitPointerMap: Going to retrieve the &quot;
+              &quot;pointer map from remote display.\n&quot;);
+  #endif
+
+  numButtons = XGetPointerMapping(nxagentDisplay, pointerMap, MAXBUTTONS);
+
+  /*
+   * Computing revers pointer map.
+   */
+
+  for (i = 1; i &lt;= numButtons; i++)
+  {
+    nxagentReversePointerMap[pointerMap[i - 1] - 1] = i;
+  }
+}
diff --git a/programs/Xserver/hw/nxagent/Pointer.h b/programs/Xserver/hw/nxagent/Pointer.h
index 0807b08..3b9ccce 100644
--- a/programs/Xserver/hw/nxagent/Pointer.h
+++ b/programs/Xserver/hw/nxagent/Pointer.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
@@ -38,8 +38,17 @@ is&quot; without express or implied warranty.
   (ButtonPressMask | ButtonReleaseMask | PointerMotionMask | \
        EnterWindowMask | LeaveWindowMask)
 
+/*
+ * The nxagentReversePointerMap array is used to
+ * memorize remote display pointer map.
+ */
+
+extern unsigned char nxagentReversePointerMap[MAXBUTTONS];
+
 void nxagentChangePointerControl(DeviceIntPtr pDev, PtrCtrl *ctrl);
 
 int nxagentPointerProc(DeviceIntPtr pDev, int onoff);
 
+void nxagentInitPointerMap(void);
+
 #endif /* __Pointer_H__ */
diff --git a/programs/Xserver/hw/nxagent/Reconnect.c b/programs/Xserver/hw/nxagent/Reconnect.c
index 598ffc1..b786602 100644
--- a/programs/Xserver/hw/nxagent/Reconnect.c
+++ b/programs/Xserver/hw/nxagent/Reconnect.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
@@ -81,6 +81,8 @@ extern Bool nxagentUninstallFontServerPath(void);
 
 extern void nxagentRemoveXConnection(void);
 
+extern void nxagentInitPointerMap(void);
+
 static char *nxagentGetReconnectError(void);
 
 void nxagentInitializeRecLossyLevel(void);
@@ -584,6 +586,8 @@ Bool nxagentReconnectSession(void)
     nxagentOldKeyboard = NULL;
   }
 
+  nxagentInitPointerMap();
+
   nxagentDeactivatePointerGrab();
 
   nxagentWakeupByReconnect();
diff --git a/programs/Xserver/hw/nxagent/Reconnect.h b/programs/Xserver/hw/nxagent/Reconnect.h
index 12d0742..c321bfa 100644
--- a/programs/Xserver/hw/nxagent/Reconnect.h
+++ b/programs/Xserver/hw/nxagent/Reconnect.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Render.c b/programs/Xserver/hw/nxagent/Render.c
index 6bc54c8..6c74c14 100644
--- a/programs/Xserver/hw/nxagent/Render.c
+++ b/programs/Xserver/hw/nxagent/Render.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
@@ -147,8 +147,6 @@ void nxagentCursorPostSaveRenderInfo(CursorPtr pCursor, ScreenPtr pScreen,
 
 int nxagentCreatePicture(PicturePtr pPicture, Mask mask);
 
-void nxagentDestroyPicture(PicturePtr pPicture);
-
 int nxagentChangePictureClip(PicturePtr pPicture, int clipType, int nRects,
                                  xRectangle *rects, int xOrigin, int yOrigin);
 
@@ -586,16 +584,16 @@ XRenderPictFormat *nxagentMatchingFormats(PictFormatPtr pFormat)
 
 void nxagentDestroyPicture(PicturePtr pPicture)
 {
+  if (pPicture == NULL || nxagentPicturePriv(pPicture) -&gt; picture == 0)
+  {
+    return;
+  }
+
   #ifdef TEST
   fprintf(stderr, &quot;nxagentDestroyPicture: Going to destroy picture at [%p].\n&quot;,
               (void *) pPicture);
   #endif
 
-  if (pPicture == NULL)
-  {
-    return;
-  }
-
   XRenderFreePicture(nxagentDisplay,
                      nxagentPicturePriv(pPicture) -&gt; picture);
   
@@ -1010,12 +1008,15 @@ void nxagentComposite(CARD8 op, PicturePtr pSrc, PicturePtr pMask, PicturePtr pD
 
   #ifdef DEBUG
 
-  fprintf(stderr, &quot;nxagentComposite: Source Picture [%lu][%p] with drawable [%s%s][%p].\n&quot;,
-              nxagentPicturePriv(pSrc) -&gt; picture, (void *) pSrc,
-              (pSrc -&gt; pDrawable -&gt; type == DRAWABLE_PIXMAP &amp;&amp;
-                   nxagentIsShmPixmap((PixmapPtr) pSrc -&gt; pDrawable)) ? &quot;Shared &quot; : &quot;&quot;,
-                       pSrc -&gt; pDrawable -&gt; type == DRAWABLE_PIXMAP ? &quot;Pixmap&quot; : &quot;Window&quot;,
-                           (void *) pSrc -&gt; pDrawable);
+  if (pSrc -&gt; pDrawable != NULL)
+  {
+    fprintf(stderr, &quot;nxagentComposite: Source Picture [%lu][%p] with drawable [%s%s][%p].\n&quot;,
+                nxagentPicturePriv(pSrc) -&gt; picture, (void *) pSrc,
+                (pSrc -&gt; pDrawable -&gt; type == DRAWABLE_PIXMAP &amp;&amp;
+                     nxagentIsShmPixmap((PixmapPtr) pSrc -&gt; pDrawable)) ? &quot;Shared &quot; : &quot;&quot;,
+                         pSrc -&gt; pDrawable -&gt; type == DRAWABLE_PIXMAP ? &quot;Pixmap&quot; : &quot;Window&quot;,
+                             (void *) pSrc -&gt; pDrawable);
+  }
 
   fprintf(stderr, &quot;nxagentComposite: Destination Picture [%lu][%p] with drawable [%s%s][%p].\n&quot;,
               nxagentPicturePriv(pDst) -&gt; picture, (void *) pDst,
@@ -1064,16 +1065,19 @@ void nxagentComposite(CARD8 op, PicturePtr pSrc, PicturePtr pMask, PicturePtr pD
    * the wrong data.
    */
 
-  nxagentSynchronizeShmPixmap(pSrc -&gt; pDrawable, xSrc, ySrc, width, height);
-
-  if (nxagentDrawableStatus(pSrc -&gt; pDrawable) == NotSynchronized)
+  if (pSrc -&gt; pDrawable != NULL)
   {
-    #ifdef TEST
-    fprintf(stderr, &quot;nxagentComposite: Synchronizing the source drawable [%p].\n&quot;,
-                (void *) pSrc -&gt; pDrawable);
-    #endif
+    nxagentSynchronizeShmPixmap(pSrc -&gt; pDrawable, xSrc, ySrc, width, height);
 
-    nxagentSynchronizeDrawable(pSrc -&gt; pDrawable, DO_WAIT, NEVER_BREAK, NULL);
+    if (nxagentDrawableStatus(pSrc -&gt; pDrawable) == NotSynchronized)
+    {
+      #ifdef TEST
+      fprintf(stderr, &quot;nxagentComposite: Synchronizing the source drawable [%p].\n&quot;,
+                  (void *) pSrc -&gt; pDrawable);
+      #endif
+
+      nxagentSynchronizeDrawable(pSrc -&gt; pDrawable, DO_WAIT, NEVER_BREAK, NULL);
+    }
   }
 
   if (pDst -&gt; pDrawable != pSrc -&gt; pDrawable)
@@ -2811,3 +2815,248 @@ Bool nxagentDisconnectAllPicture()
   return True;
 }
 
+void nxagentRenderCreateSolidFill(PicturePtr pPicture, xRenderColor *color)
+{
+  Picture id;
+
+  if (nxagentRenderEnable == False)
+  {
+    return;
+  }
+
+  #ifdef DEBUG
+
+  fprintf(stderr, &quot;nxagentRenderCreateSolidFill: Got called.\n&quot;);
+
+  if (pPicture == NULL)
+  {
+    fprintf(stderr, &quot;nxagentRenderCreateSolidFill: WARNING! pPicture pointer is NULL.\n&quot;);
+  }
+
+  if (color == NULL)
+  {
+    fprintf(stderr, &quot;nxagentRenderCreateSolidFill: WARNING! color pointer is NULL.\n&quot;);
+  }
+
+  #endif /* #ifdef DEBUG */
+
+  memset(&amp;(nxagentPicturePriv(pPicture) -&gt; lastServerValues), 0,
+             sizeof(XRenderPictureAttributes_));
+
+  id = XRenderCreateSolidFill(nxagentDisplay, (XRenderColor *) color);
+
+  #ifdef DEBUG
+  XSync(nxagentDisplay, 0);
+  #endif
+
+  #ifdef TEST
+  fprintf(stderr, &quot;nxagentRenderCreateSolidFill: Created solid fill xid [%lu].\n&quot;, id);
+  #endif
+
+  nxagentPicturePriv(pPicture) -&gt; picture = id;
+}
+
+void nxagentRenderCreateLinearGradient(PicturePtr pPicture, xPointFixed *p1,
+                                           xPointFixed *p2, int nStops,
+                                               xFixed *stops,
+                                                   xRenderColor *colors)
+{
+  Picture id;
+
+  XLinearGradient linearGradient;
+
+  if (nxagentRenderEnable == False)
+  {
+    return;
+  }
+
+  #ifdef DEBUG
+
+  fprintf(stderr, &quot;nxagentRenderCreateLinearGradient: Got called.\n&quot;);
+
+  if (pPicture == NULL)
+  {
+    fprintf(stderr, &quot;nxagentRenderCreateLinearGradient: WARNING! pPicture pointer is NULL.\n&quot;);
+  }
+
+  if (p1 == NULL)
+  {
+    fprintf(stderr, &quot;nxagentRenderCreateLinearGradient: WARNING! p1 pointer is NULL.\n&quot;);
+  }
+
+  if (p2 == NULL)
+  {
+    fprintf(stderr, &quot;nxagentRenderCreateLinearGradient: WARNING! p2 pointer is NULL.\n&quot;);
+  }
+
+  if (stops == NULL)
+  {
+    fprintf(stderr, &quot;nxagentRenderCreateLinearGradient: WARNING! stops pointer is NULL.\n&quot;);
+  }
+
+  if (colors == NULL)
+  {
+    fprintf(stderr, &quot;nxagentRenderCreateLinearGradient: WARNING! colors pointer is NULL.\n&quot;);
+  }
+
+  #endif /* #ifdef DEBUG */
+
+  memset(&amp;(nxagentPicturePriv(pPicture) -&gt; lastServerValues), 0,
+             sizeof(XRenderPictureAttributes_));
+
+  linearGradient.p1.x = (XFixed) p1 -&gt; x;
+  linearGradient.p1.y = (XFixed) p1 -&gt; y;
+  linearGradient.p2.x = (XFixed) p2 -&gt; x;
+  linearGradient.p2.y = (XFixed) p2 -&gt; y;
+
+  id = XRenderCreateLinearGradient(nxagentDisplay, &amp;linearGradient,
+                                      (XFixed *) stops,
+                                          (XRenderColor *) colors, nStops);
+
+  #ifdef DEBUG
+  XSync(nxagentDisplay, 0);
+  #endif
+
+  #ifdef TEST
+  fprintf(stderr, &quot;nxagentRenderCreateLinearGradient: Created linear gradient xid [%lu].\n&quot;, id);
+  #endif
+
+  nxagentPicturePriv(pPicture) -&gt; picture = id;
+}
+
+void nxagentRenderCreateRadialGradient(PicturePtr pPicture, xPointFixed *inner,
+                                           xPointFixed *outer,
+                                               xFixed innerRadius,
+                                                   xFixed outerRadius,
+                                                       int nStops,
+                                                           xFixed *stops,
+                                                               xRenderColor *colors)
+{
+  Picture id;
+
+  XRadialGradient radialGradient;
+
+  if (nxagentRenderEnable == False)
+  {
+    return;
+  }
+
+  #ifdef DEBUG
+
+  fprintf(stderr, &quot;nxagentRenderCreateRadialGradient: Got called.\n&quot;);
+
+  if (pPicture == NULL)
+  {
+    fprintf(stderr, &quot;nxagentRenderCreateRadialGradient: WARNING! pPicture pointer is NULL.\n&quot;);
+  }
+
+  if (inner == NULL)
+  {
+    fprintf(stderr, &quot;nxagentRenderCreateRadialGradient: WARNING! inner pointer is NULL.\n&quot;);
+  }
+
+  if (outer == NULL)
+  {
+    fprintf(stderr, &quot;nxagentRenderCreateRadialGradient: WARNING! outer pointer is NULL.\n&quot;);
+  }
+
+  if (stops == NULL)
+  {
+    fprintf(stderr, &quot;nxagentRenderCreateRadialGradient: WARNING! stops pointer is NULL.\n&quot;);
+  }
+
+  if (colors == NULL)
+  {
+    fprintf(stderr, &quot;nxagentRenderCreateRadialGradient: WARNING! colors pointer is NULL.\n&quot;);
+  }
+
+  #endif /* #ifdef DEBUG */
+
+  memset(&amp;(nxagentPicturePriv(pPicture) -&gt; lastServerValues), 0,
+               sizeof(XRenderPictureAttributes_));
+
+  radialGradient.inner.x = (XFixed) inner -&gt; x;
+  radialGradient.inner.y = (XFixed) inner -&gt; y;
+  radialGradient.inner.radius = (XFixed) innerRadius;
+  radialGradient.outer.x = (XFixed) outer -&gt; x;
+  radialGradient.outer.y = (XFixed) outer -&gt; y;
+  radialGradient.outer.radius = (XFixed) outerRadius;
+
+  id = XRenderCreateRadialGradient(nxagentDisplay, &amp;radialGradient,
+                                       (XFixed *) stops,
+                                           (XRenderColor *) colors, nStops);
+
+  #ifdef DEBUG
+  XSync(nxagentDisplay, 0);
+  #endif
+
+  #ifdef TEST
+  fprintf(stderr, &quot;nxagentRenderCreateRadialGradient: Created radial gradient xid [%lu].\n&quot;, id);
+  #endif
+
+  nxagentPicturePriv(pPicture) -&gt; picture = id;
+}
+
+void nxagentRenderCreateConicalGradient(PicturePtr pPicture,
+                                            xPointFixed *center,
+                                                xFixed angle, int nStops, 
+                                                    xFixed *stops, 
+                                                        xRenderColor *colors)
+{
+  Picture id;
+
+  XConicalGradient conicalGradient;
+
+  if (nxagentRenderEnable == False)
+  {
+    return;
+  }
+
+  #ifdef DEBUG
+
+  fprintf(stderr, &quot;nxagentRenderCreateConicalGradient: Got called.\n&quot;);
+
+  if (pPicture == NULL)
+  {
+    fprintf(stderr, &quot;nxagentRenderCreateConicalGradient: WARNING! pPicture pointer is NULL.\n&quot;);
+  }
+
+  if (center == NULL)
+  {
+    fprintf(stderr, &quot;nxagentRenderCreateConicalGradient: WARNING! center pointer is NULL.\n&quot;);
+  }
+
+  if (stops == NULL)
+  {
+    fprintf(stderr, &quot;nxagentRenderCreateConicalGradient: WARNING! stops pointer is NULL.\n&quot;);
+  }
+
+  if (colors == NULL)
+  {
+    fprintf(stderr, &quot;nxagentRenderCreateConicalGradient: WARNING! colors pointer is NULL.\n&quot;);
+  }
+
+  #endif /* #ifdef DEBUG */
+
+  memset(&amp;(nxagentPicturePriv(pPicture) -&gt; lastServerValues), 0,
+             sizeof(XRenderPictureAttributes_));
+
+  conicalGradient.center.x = (XFixed) center -&gt; x;
+  conicalGradient.center.y = (XFixed) center -&gt; y;
+  conicalGradient.angle = (XFixed) angle;
+
+  id = XRenderCreateConicalGradient(nxagentDisplay, &amp;conicalGradient,
+                                        (XFixed *) stops,
+                                            (XRenderColor *) colors, nStops);
+
+  #ifdef DEBUG
+  XSync(nxagentDisplay, 0);
+  #endif
+
+  #ifdef TEST
+  fprintf(stderr, &quot;nxagentRenderCreateConicalGradient: Created conical gradient xid [%lu].\n&quot;, id);
+  #endif
+
+  nxagentPicturePriv(pPicture) -&gt; picture = id;
+}
+
diff --git a/programs/Xserver/hw/nxagent/Render.h b/programs/Xserver/hw/nxagent/Render.h
index 81ba336..6f61ca8 100644
--- a/programs/Xserver/hw/nxagent/Render.h
+++ b/programs/Xserver/hw/nxagent/Render.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
@@ -105,4 +105,6 @@ void nxagentDisconnectPicture(pointer p0, XID x1, void* p2);
 
 void nxagentReconnectGlyphSet(void* p0, XID x1, void *p2);
 
+void nxagentDestroyPicture(PicturePtr pPicture);
+
 #endif /* __Render_H__ */
diff --git a/programs/Xserver/hw/nxagent/Rootless.c b/programs/Xserver/hw/nxagent/Rootless.c
index a8ce4c7..74d2d1f 100644
--- a/programs/Xserver/hw/nxagent/Rootless.c
+++ b/programs/Xserver/hw/nxagent/Rootless.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
@@ -625,7 +625,9 @@ int nxagentExportProperty(pWin, property, type, format, mode, nUnits, value)
   {
     XlibAtom *atoms = malloc(nUnits * sizeof(*atoms));
     Atom *input = value;
+    char *atomName = NULL;
     int i;
+    int j = 0;
 
     freeMem = True;
     export = True;
@@ -633,16 +635,41 @@ int nxagentExportProperty(pWin, property, type, format, mode, nUnits, value)
 
     for (i = 0; i &lt; nUnits; i++)
     {
-       atoms[i] = nxagentLocalToRemoteAtom(input[i]);
-
-       if (atoms[i] == None)
-       {
-         #ifdef WARNING
-         fprintf(stderr, &quot;nxagentExportProperty: WARNING! Failed to convert local atom %ld [%s].\n&quot;,
-                     (long int) input[i], validateString(NameForAtom(input[i])));
-         #endif
-       }
+      /*
+       * Exporting the _NET_WM_PING property could
+       * result in rootless windows being grayed out
+       * when the compiz window manager is running.
+       *
+       * Better solution would probably be to handle
+       * the communication with the window manager
+       * instead of just getting rid of the property.
+       */
+
+      if ((atomName = NameForAtom(input[i])) != NULL &amp;&amp;
+              strcmp(atomName, &quot;_NET_WM_PING&quot;) != 0)
+      {
+        atoms[j] = nxagentLocalToRemoteAtom(input[i]);
+
+        if (atoms[j] == None)
+        {
+          #ifdef WARNING
+          fprintf(stderr, &quot;nxagentExportProperty: WARNING! Failed to convert local atom %ld [%s].\n&quot;,
+                      (long int) input[i], validateString(atomName));
+          #endif
+        }
+
+        j++;
+      }
+      #ifdef TEST
+      else
+      {
+        fprintf(stderr, &quot;nxagentExportProperty: WARNING! &quot;
+                    &quot;Not exporting the _NET_WM_PING property.\n&quot;);
+      }
+      #endif
     }
+
+    nUnits = j;
   }
   else if (strcmp(typeS, &quot;WINDOW&quot;) == 0)
   {
@@ -700,7 +727,57 @@ int nxagentExportProperty(pWin, property, type, format, mode, nUnits, value)
     }
     else
     {
-      XChangeProperty(nxagentDisplay, nxagentWindow(pWin), propertyX, typeX, format, mode, (void*)output, nUnits);
+      #ifdef TEST
+      fprintf(stderr, &quot;nxagentExportProperty: Property [%lu] format [%i] &quot;
+                  &quot;units [%lu].\n&quot;, propertyX, format, nUnits);
+      #endif
+
+      if ((format &gt;&gt; 3) * nUnits + sizeof(xChangePropertyReq) &lt;
+              (MAX_REQUEST_SIZE &lt;&lt; 2))
+      {
+        XChangeProperty(nxagentDisplay, nxagentWindow(pWin), propertyX, typeX,
+                            format, mode, (void*)output, nUnits);
+      }
+      else if (mode == PropModeReplace)
+      {
+        int n;
+        char *data;
+
+        XDeleteProperty(nxagentDisplay, nxagentWindow(pWin), propertyX);
+
+        data = (char *) output;
+
+        while (nUnits &gt; 0)
+        {
+          if ((format &gt;&gt; 3) * nUnits + sizeof(xChangePropertyReq) &lt;
+                  (MAX_REQUEST_SIZE &lt;&lt; 2))
+          {
+            n = nUnits;
+          }
+          else
+          {
+            n = ((MAX_REQUEST_SIZE &lt;&lt; 2) - sizeof(xChangePropertyReq)) /
+                    (format &gt;&gt; 3);
+          }
+
+          XChangeProperty(nxagentDisplay, nxagentWindow(pWin), propertyX,
+                              typeX, format, PropModeAppend, (void*) data, n);
+
+          nUnits -= n;
+
+          data = (char *) data + n * (format &gt;&gt; 3);
+        }
+      }
+      else
+      {
+        #ifdef WARNING
+        fprintf(stderr, &quot;nxagentExportProperty: WARNING! &quot;
+                    &quot;Property [%lu] too long.\n&quot;, propertyX);
+        #endif
+
+        goto nxagentExportPropertyError;
+      }
+
       nxagentAddPropertyToList(propertyX, pWin);
     }
   }
@@ -715,6 +792,8 @@ int nxagentExportProperty(pWin, property, type, format, mode, nUnits, value)
     #endif
   }
 
+  nxagentExportPropertyError:
+
   if (freeMem)
   {
     xfree(output);
diff --git a/programs/Xserver/hw/nxagent/Rootless.h b/programs/Xserver/hw/nxagent/Rootless.h
index ece4c9d..1ea258d 100644
--- a/programs/Xserver/hw/nxagent/Rootless.h
+++ b/programs/Xserver/hw/nxagent/Rootless.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Screen.c b/programs/Xserver/hw/nxagent/Screen.c
index 28f17ca..2919970 100644
--- a/programs/Xserver/hw/nxagent/Screen.c
+++ b/programs/Xserver/hw/nxagent/Screen.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
@@ -292,7 +292,7 @@ void nxagentMinimizeFromFullScreen(ScreenPtr pScreen)
 {
   XUnmapWindow(nxagentDisplay, nxagentFullscreenWindow);
 
-  if(nxagentIpaq)
+  if (nxagentIpaq)
   {
     XMapWindow(nxagentDisplay, nxagentIconWindow);
     XIconifyWindow(nxagentDisplay, nxagentIconWindow,
@@ -307,7 +307,7 @@ void nxagentMinimizeFromFullScreen(ScreenPtr pScreen)
 
 void nxagentMaximizeToFullScreen(ScreenPtr pScreen)
 {
-  if(nxagentIpaq)
+  if (nxagentIpaq)
   {
     XUnmapWindow(nxagentDisplay, nxagentIconWindow);
 
@@ -334,7 +334,7 @@ FIXME: We'll chech for ReparentNotify and LeaveNotify events after XReparentWind
     for (i = 0; i &lt; 100 &amp;&amp; nxagentWMIsRunning; i++)
     {
       #ifdef TEST
-      fprintf(stderr, &quot;nxagentSwitchFullscreen: WARNING! Going to wait for the ReparentNotify event.\n&quot;);
+      fprintf(stderr, &quot;nxagentMaximizeToFullscreen: WARNING! Going to wait for the ReparentNotify event.\n&quot;);
       #endif
 
       if (XCheckTypedWindowEvent(nxagentDisplay, nxagentFullscreenWindow, ReparentNotify, &amp;e))
@@ -981,6 +981,10 @@ Bool nxagentOpenScreen(int index, ScreenPtr pScreen,
 
     nxagentChangeOption(Fullscreen, False);
 
+    nxagentChangeOption(AllScreens, False);
+
+    nxagentFullscreenWindow = 0;
+
     resetAgentPosition = True;
   }
 
@@ -1384,10 +1388,13 @@ N/A
       nxagentChangeOption(Height, gattributes.height);
     }
 
-    if (nxagentOption(Fullscreen))
+    if (nxagentOption(AllScreens))
     {
-      attributes.override_redirect = True;
+      attributes.override_redirect = True; 
+    }
 
+    if (nxagentOption(Fullscreen))
+    {
       /*
        * We need to disable the host's screensaver or
        * it will otherwise grab the screen even if it
@@ -1614,7 +1621,7 @@ N/A
           nxagentReconnectTrap == 1)
   {
     valuemask = CWBackPixel | CWEventMask | CWColormap |
-                    (nxagentOption(Fullscreen) == 1 ? CWOverrideRedirect : 0);
+                    (nxagentOption(AllScreens) == 1 ? CWOverrideRedirect : 0);
 
     attributes.background_pixel = nxagentBlackPixel;
 
@@ -1622,10 +1629,13 @@ N/A
 
     attributes.colormap = nxagentDefaultVisualColormap(nxagentDefaultVisual(pScreen));
 
-    if (nxagentOption(Fullscreen) == 1)
+    if (nxagentOption(AllScreens) == 1)
     {
       attributes.override_redirect = True;
+    }
 
+    if (nxagentOption(Fullscreen) == 1)
+    {
       if (nxagentReconnectTrap)
       {
         /*
@@ -1771,7 +1781,7 @@ N/A
     sizeHints.width = nxagentOption(RootWidth);
     sizeHints.height = nxagentOption(RootHeight);
 
-    if (nxagentOption(DesktopResize) == 1)
+    if (nxagentOption(DesktopResize) == 1 || nxagentOption(Fullscreen) == 1)
     {
       sizeHints.max_width = WidthOfScreen(DefaultScreenOfDisplay(nxagentDisplay));
       sizeHints.max_height = HeightOfScreen(DefaultScreenOfDisplay(nxagentDisplay));
@@ -1816,30 +1826,14 @@ N/A
 
     XClearWindow(nxagentDisplay, nxagentDefaultWindows[pScreen-&gt;myNum]);
 
-    if (nxagentOption(Fullscreen))
-    {
-      valuemask = CWBackPixmap | CWColormap | CWOverrideRedirect;
-    }
-    else
-    {
-      valuemask = CWBackPixmap | CWColormap;
-    }
-
-    attributes.background_pixmap = nxagentScreenSaverPixmap;
-    attributes.colormap = DefaultColormap(nxagentDisplay, DefaultScreen(nxagentDisplay));
-
-    if (nxagentOption(Fullscreen))
+    if (nxagentOption(AllScreens))
     {
-      attributes.override_redirect = False;
       if (nxagentReconnectTrap)
       {
         XGrabKeyboard(nxagentDisplay, nxagentFullscreenWindow, True, GrabModeAsync,
                       GrabModeAsync, CurrentTime);
       }
-    }
 
-    if (nxagentOption(Fullscreen))
-    {
       nxagentIconWindow = nxagentCreateIconWindow();
     }
     else
@@ -1897,13 +1891,6 @@ N/A
        */
 
       XSetWMProtocols(nxagentDisplay, nxagentDefaultWindows[pScreen-&gt;myNum], &amp;deleteWMatom, 1);
-
-      /*
-      if (nxagentOption(Fullscreen))
-      {
-        XSetWMProtocols(nxagentDisplay, nxagentIconWindow, &amp;deleteWMatom, 1);
-      }
-      */
     }
     else
     {
@@ -2202,8 +2189,6 @@ Bool nxagentResizeScreen(ScreenPtr pScreen, int width, int height,
   int oldMmWidth;
   int oldMmHeight;
 
-  RegionPtr pRootWinSize;
-
   #ifdef TEST
   nxagentPrintAgentGeometry(&quot;Before Resize Screen&quot;, &quot;nxagentResizeScreen:&quot;);
   #endif
@@ -2283,13 +2268,10 @@ FIXME: We should try to restore the previously
 
   if (nxagentOption(Fullscreen))
   {
-    nxagentChangeOption(Width, WidthOfScreen(DefaultScreenOfDisplay(nxagentDisplay)));
-    nxagentChangeOption(Height, HeightOfScreen(DefaultScreenOfDisplay(nxagentDisplay)));
-
-    nxagentChangeOption(RootX, (WidthOfScreen(DefaultScreenOfDisplay(nxagentDisplay))
-                            - nxagentOption(RootWidth)) / 2);
-    nxagentChangeOption(RootY,  (HeightOfScreen(DefaultScreenOfDisplay(nxagentDisplay))
-                            - nxagentOption(RootHeight)) / 2);
+    nxagentChangeOption(RootX, (nxagentOption(Width) -
+                            nxagentOption(RootWidth)) / 2);
+    nxagentChangeOption(RootY, (nxagentOption(Height) -
+                            nxagentOption(RootHeight)) / 2);
   }
   else
   {
@@ -2301,62 +2283,6 @@ FIXME: We should try to restore the previously
   nxagentChangeOption(ViewportYSpan, nxagentOption(Height) - nxagentOption(RootHeight));
 
   /*
-   * Change agent window size and size hints.
-   */
-
-  sizeHints.flags = PPosition | PMinSize | PMaxSize;
-  sizeHints.x = nxagentOption(X);
-  sizeHints.y = nxagentOption(Y);
-
-  sizeHints.min_width = MIN_NXAGENT_WIDTH;
-  sizeHints.min_height = MIN_NXAGENT_HEIGHT;
-  sizeHints.width = width;
-  sizeHints.height = height;
-
-  if (nxagentOption(DesktopResize) == 1)
-  {
-    sizeHints.max_width = WidthOfScreen(DefaultScreenOfDisplay(nxagentDisplay));
-    sizeHints.max_height = HeightOfScreen(DefaultScreenOfDisplay(nxagentDisplay));
-  }
-  else
-  {
-    sizeHints.max_width = nxagentOption(RootWidth);
-    sizeHints.max_height = nxagentOption(RootHeight);
-  }
-
-  if (nxagentUserGeometry.flag &amp; XValue || nxagentUserGeometry.flag &amp; YValue)
-  {
-    sizeHints.flags |= USPosition;
-  }
-
-  if (nxagentUserGeometry.flag &amp; WidthValue || nxagentUserGeometry.flag &amp; HeightValue)
-  {
-    sizeHints.flags |= USSize;
-  }
-
-  XSetWMNormalHints(nxagentDisplay, nxagentDefaultWindows[pScreen-&gt;myNum], &amp;sizeHints);
-
-  if (nxagentOption(Fullscreen))
-  {
-    XResizeWindow(nxagentDisplay, nxagentDefaultWindows[pScreen-&gt;myNum],
-                      WidthOfScreen(DefaultScreenOfDisplay(nxagentDisplay)),
-                          HeightOfScreen(DefaultScreenOfDisplay(nxagentDisplay)));
-
-    XResizeWindow(nxagentDisplay, nxagentInputWindows[pScreen -&gt; myNum],
-                      WidthOfScreen(DefaultScreenOfDisplay(nxagentDisplay)),
-                          HeightOfScreen(DefaultScreenOfDisplay(nxagentDisplay)));
-  }
-  else
-  {
-    XResizeWindow(nxagentDisplay, nxagentDefaultWindows[pScreen-&gt;myNum], width, height);
-
-    if (nxagentOption(Rootless) == 0)
-    {
-      XResizeWindow(nxagentDisplay, nxagentInputWindows[pScreen -&gt; myNum], width, height);
-    }
-  }
-
-  /*
    * Set properties for the agent root window.
    */
 
@@ -2377,8 +2303,6 @@ FIXME: We should try to restore the previously
 
   (*pScreen -&gt; PositionWindow)(WindowTable[pScreen -&gt; myNum], 0, 0);
 
-  pRootWinSize = &amp;WindowTable[pScreen -&gt; myNum] -&gt; winSize;
-
   nxagentSetRootClip(pScreen, 1);
 
   XMoveWindow(nxagentDisplay, nxagentWindow(WindowTable[0]),
@@ -2386,6 +2310,12 @@ FIXME: We should try to restore the previously
 
   nxagentMoveViewport(pScreen, 0, 0);
 
+  /*
+   * Update pointer bounds.
+   */
+
+  ScreenRestructured(pScreen);
+
   #ifdef TEST
   nxagentPrintAgentGeometry(&quot;After Resize Screen&quot;, &quot;nxagentResizeScreen:&quot;);
   #endif
diff --git a/programs/Xserver/hw/nxagent/Screen.h b/programs/Xserver/hw/nxagent/Screen.h
index 6ffebe0..5b19577 100644
--- a/programs/Xserver/hw/nxagent/Screen.h
+++ b/programs/Xserver/hw/nxagent/Screen.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
@@ -48,6 +48,7 @@ extern ScreenPtr nxagentDefaultScreen;
 extern Pixmap nxagentPixmapLogo;
 
 extern Window nxagentIconWindow;
+
 extern Window nxagentFullscreenWindow;
 
 extern RegionRec nxagentShadowUpdateRegion;
@@ -61,6 +62,8 @@ extern short nxagentShadowUid;
 void nxagentSetScreenInfo(ScreenInfo *screenInfo);
 void nxagentSetPixmapFormats(ScreenInfo *screenInfo);
 
+void nxagentPrintGeometry();
+
 extern Window nxagentDefaultWindows[MAXSCREENS];
 extern Window nxagentInputWindows[MAXSCREENS];
 extern Window nxagentScreenSaverWindows[MAXSCREENS];
@@ -87,6 +90,7 @@ extern int nxagentBitsPerPixel(int depth);
 void nxagentSetScreenSaverTime(void);
 
 void nxagentMinimizeFromFullScreen(ScreenPtr pScreen);
+
 void nxagentMaximizeToFullScreen(ScreenPtr pScreen);
 
 Window nxagentCreateIconWindow(void);
diff --git a/programs/Xserver/hw/nxagent/Splash.c b/programs/Xserver/hw/nxagent/Splash.c
index 7425bac..027a7a3 100644
--- a/programs/Xserver/hw/nxagent/Splash.c
+++ b/programs/Xserver/hw/nxagent/Splash.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Splash.h b/programs/Xserver/hw/nxagent/Splash.h
index 91f18b7..ee6908a 100644
--- a/programs/Xserver/hw/nxagent/Splash.h
+++ b/programs/Xserver/hw/nxagent/Splash.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Split.c b/programs/Xserver/hw/nxagent/Split.c
index bf7f705..4cc2ea6 100644
--- a/programs/Xserver/hw/nxagent/Split.c
+++ b/programs/Xserver/hw/nxagent/Split.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Split.h b/programs/Xserver/hw/nxagent/Split.h
index 60be29b..2be449a 100644
--- a/programs/Xserver/hw/nxagent/Split.h
+++ b/programs/Xserver/hw/nxagent/Split.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/TestExt.c b/programs/Xserver/hw/nxagent/TestExt.c
index 1d5fdee..6bce2ea 100644
--- a/programs/Xserver/hw/nxagent/TestExt.c
+++ b/programs/Xserver/hw/nxagent/TestExt.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Trap.c b/programs/Xserver/hw/nxagent/Trap.c
index 22de3bc..f5e6bde 100644
--- a/programs/Xserver/hw/nxagent/Trap.c
+++ b/programs/Xserver/hw/nxagent/Trap.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Trap.h b/programs/Xserver/hw/nxagent/Trap.h
index aa6937e..9258e3b 100644
--- a/programs/Xserver/hw/nxagent/Trap.h
+++ b/programs/Xserver/hw/nxagent/Trap.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Utils.h b/programs/Xserver/hw/nxagent/Utils.h
index 830b275..f5bd55d 100644
--- a/programs/Xserver/hw/nxagent/Utils.h
+++ b/programs/Xserver/hw/nxagent/Utils.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Visual.c b/programs/Xserver/hw/nxagent/Visual.c
index f389316..b086c0e 100644
--- a/programs/Xserver/hw/nxagent/Visual.c
+++ b/programs/Xserver/hw/nxagent/Visual.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Visual.h b/programs/Xserver/hw/nxagent/Visual.h
index c682f92..8436f79 100644
--- a/programs/Xserver/hw/nxagent/Visual.h
+++ b/programs/Xserver/hw/nxagent/Visual.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/Window.c b/programs/Xserver/hw/nxagent/Window.c
index 449458a..3e6d41d 100644
--- a/programs/Xserver/hw/nxagent/Window.c
+++ b/programs/Xserver/hw/nxagent/Window.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
@@ -692,6 +692,73 @@ void nxagentRestackWindow(WindowPtr pWin, WindowPtr pOldNextSib)
 
 void nxagentSwitchFullscreen(ScreenPtr pScreen, Bool switchOn)
 {
+  XEvent e;
+
+  if (nxagentOption(Rootless) == 1)
+  {
+    return;
+  }
+
+  if (switchOn == 0)
+  {
+    nxagentWMDetect();
+
+    /*
+     * The smart scheduler could be stopped while
+     * waiting for the reply. In this case we need
+     * to yield explicitly to avoid to be stuck in
+     * the dispatch loop forever.
+     */
+
+    isItTimeToYield = 1;
+
+    if (nxagentWMIsRunning == 0)
+    {
+      #ifdef WARNING
+      fprintf(stderr, &quot;Warning: Can't switch to window mode, no window manager &quot;
+                  &quot;has been detected.\n&quot;);
+      #endif
+
+      return;
+    }
+  }
+
+  #ifdef TEST
+  fprintf(stderr, &quot;nxagentSwitchFullscreen: Switching to %s mode.\n&quot;,
+              switchOn ? &quot;fullscreen&quot; : &quot;windowed&quot;);
+  #endif
+
+  nxagentChangeOption(Fullscreen, switchOn);
+
+  memset(&amp;e, 0, sizeof(e));
+
+  e.xclient.type = ClientMessage;
+  e.xclient.message_type = nxagentAtoms[13]; /* _NET_WM_STATE */
+  e.xclient.display = nxagentDisplay;
+  e.xclient.window = nxagentDefaultWindows[pScreen -&gt; myNum];
+  e.xclient.format = 32;
+  e.xclient.data.l[0] = nxagentOption(Fullscreen) ? 1 : 0;
+  e.xclient.data.l[1] = nxagentAtoms[14]; /* _NET_WM_STATE_FULLSCREEN */
+
+  XSendEvent(nxagentDisplay, DefaultRootWindow(nxagentDisplay), False,
+                 SubstructureRedirectMask, &amp;e);
+
+  if (switchOn == 1)
+  {
+    nxagentFullscreenWindow = nxagentDefaultWindows[pScreen -&gt; myNum];
+
+    nxagentGrabPointerAndKeyboard(NULL);
+  }
+  else
+  {
+    nxagentFullscreenWindow = None;
+
+    nxagentUngrabPointerAndKeyboard(NULL);
+  } 
+}
+
+void nxagentSwitchAllScreens(ScreenPtr pScreen, Bool switchOn)
+{
   Window w;
   XSetWindowAttributes attributes;
   unsigned long valuemask;
@@ -721,6 +788,8 @@ void nxagentSwitchFullscreen(ScreenPtr pScreen, Bool switchOn)
   XUnmapWindow(nxagentDisplay, w);
   XChangeWindowAttributes(nxagentDisplay, w, valuemask, &amp;attributes);
 
+  XReparentWindow(nxagentDisplay, w, DefaultRootWindow(nxagentDisplay), 0, 0);
+
   if (switchOn)
   {
     /*
@@ -738,7 +807,7 @@ void nxagentSwitchFullscreen(ScreenPtr pScreen, Bool switchOn)
     for (i = 0; i &lt; 100 &amp;&amp; nxagentWMIsRunning; i++)
     {
       #ifdef TEST
-      fprintf(stderr, &quot;nxagentSwitchFullscreen: WARNING! Going to wait for the ReparentNotify event.\n&quot;);
+      fprintf(stderr, &quot;nxagentSwitchAllScreens: WARNING! Going to wait for the ReparentNotify event.\n&quot;);
       #endif
 
       if (XCheckTypedWindowEvent(nxagentDisplay, w, ReparentNotify, &amp;e))
@@ -767,6 +836,8 @@ void nxagentSwitchFullscreen(ScreenPtr pScreen, Bool switchOn)
        */
 
       nxagentChangeOption(Fullscreen, True);
+      nxagentChangeOption(AllScreens, True);
+      
 
       /*
        * Save the window-mode configuration.
@@ -845,9 +916,9 @@ void nxagentSwitchFullscreen(ScreenPtr pScreen, Bool switchOn)
        */
 
       #ifdef WARNING
-      fprintf(stderr, &quot;nxagentSwitchFullscreen: WARNING! Expected ReparentNotify event missing.\n&quot;);
+      fprintf(stderr, &quot;nxagentSwitchAllScreens: WARNING! Expected ReparentNotify event missing.\n&quot;);
       #endif
-
+ 
       nxagentWMIsRunning = False;
       attributes.override_redirect = False;
       XChangeWindowAttributes(nxagentDisplay, w, valuemask, &amp;attributes);
@@ -861,7 +932,6 @@ void nxagentSwitchFullscreen(ScreenPtr pScreen, Bool switchOn)
      * It could be necessary:
      * - To restore screensaver.
      * - To set or reset nxagentForceBackingStore flag.
-     * - To grab keyboard.
      * - To propagate device settings to the X server if no WM is running.
      */
 
@@ -870,7 +940,10 @@ void nxagentSwitchFullscreen(ScreenPtr pScreen, Bool switchOn)
      */
 
     nxagentChangeOption(Fullscreen, False);
+    nxagentChangeOption(AllScreens, False);
+
     XDestroyWindow(nxagentDisplay, nxagentIconWindow);
+
     nxagentIconWindow = nxagentFullscreenWindow = None;
 
     if (nxagentOption(DesktopResize) == 1)
@@ -920,7 +993,7 @@ void nxagentSwitchFullscreen(ScreenPtr pScreen, Bool switchOn)
   XMoveResizeWindow(nxagentDisplay, nxagentInputWindows[0], 0, 0,
                         nxagentOption(Width), nxagentOption(Height));
 
-  nxagentSetPrintGeometry(pScreen -&gt; myNum);
+  nxagentSetPrintGeometry(pScreen -&gt; myNum); 
 }
 
 #ifdef VIEWPORT_FRAME
@@ -2422,6 +2495,11 @@ void nxagentMapDefaultWindows()
         #endif
 
         XMapWindow(nxagentDisplay, nxagentDefaultWindows[pScreen-&gt;myNum]);
+
+        if (nxagentOption(Fullscreen) == 1 &amp;&amp; nxagentWMIsRunning == 1)
+        {
+          nxagentMaximizeToFullScreen(pScreen);
+        }
       }
 
       /*
diff --git a/programs/Xserver/hw/nxagent/Windows.h b/programs/Xserver/hw/nxagent/Windows.h
index 6fc97b3..3ca74ba 100644
--- a/programs/Xserver/hw/nxagent/Windows.h
+++ b/programs/Xserver/hw/nxagent/Windows.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
@@ -222,6 +222,8 @@ void nxagentSetTopLevelEventMask(WindowPtr pWin);
 
 void nxagentSwitchFullscreen(ScreenPtr pScreen, Bool switchOn);
 
+void nxagentSwitchAllScreens(ScreenPtr pScreen, Bool switchOn);
+
 void nxagentMoveViewport(ScreenPtr pScreen, int hShift, int vShift);
 
 #ifdef VIEWPORT_FRAME
diff --git a/programs/Xserver/hw/nxagent/X/NXdamage.c b/programs/Xserver/hw/nxagent/X/NXdamage.c
index 7bc1c74..cf5d48b 100644
--- a/programs/Xserver/hw/nxagent/X/NXdamage.c
+++ b/programs/Xserver/hw/nxagent/X/NXdamage.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXdamage.c.NX.original b/programs/Xserver/hw/nxagent/X/NXdamage.c.NX.original
index 7bc1c74..cf5d48b 100644
--- a/programs/Xserver/hw/nxagent/X/NXdamage.c.NX.original
+++ b/programs/Xserver/hw/nxagent/X/NXdamage.c.NX.original
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXdispatch.c b/programs/Xserver/hw/nxagent/X/NXdispatch.c
index ba4e1e6..69ad30d 100644
--- a/programs/Xserver/hw/nxagent/X/NXdispatch.c
+++ b/programs/Xserver/hw/nxagent/X/NXdispatch.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXdispatch.c.NX.original b/programs/Xserver/hw/nxagent/X/NXdispatch.c.NX.original
index ba4e1e6..69ad30d 100644
--- a/programs/Xserver/hw/nxagent/X/NXdispatch.c.NX.original
+++ b/programs/Xserver/hw/nxagent/X/NXdispatch.c.NX.original
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXdixfonts.c b/programs/Xserver/hw/nxagent/X/NXdixfonts.c
index 225ecda..04fc047 100644
--- a/programs/Xserver/hw/nxagent/X/NXdixfonts.c
+++ b/programs/Xserver/hw/nxagent/X/NXdixfonts.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXdixfonts.c.NX.original b/programs/Xserver/hw/nxagent/X/NXdixfonts.c.NX.original
index 225ecda..04fc047 100644
--- a/programs/Xserver/hw/nxagent/X/NXdixfonts.c.NX.original
+++ b/programs/Xserver/hw/nxagent/X/NXdixfonts.c.NX.original
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXevents.c b/programs/Xserver/hw/nxagent/X/NXevents.c
index 8e87d58..c5593ad 100644
--- a/programs/Xserver/hw/nxagent/X/NXevents.c
+++ b/programs/Xserver/hw/nxagent/X/NXevents.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXevents.c.NX.original b/programs/Xserver/hw/nxagent/X/NXevents.c.NX.original
index 8e87d58..c5593ad 100644
--- a/programs/Xserver/hw/nxagent/X/NXevents.c.NX.original
+++ b/programs/Xserver/hw/nxagent/X/NXevents.c.NX.original
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXextension.c b/programs/Xserver/hw/nxagent/X/NXextension.c
index 6e67b7f..ead9b9d 100644
--- a/programs/Xserver/hw/nxagent/X/NXextension.c
+++ b/programs/Xserver/hw/nxagent/X/NXextension.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXextension.c.NX.original b/programs/Xserver/hw/nxagent/X/NXextension.c.NX.original
index 6e67b7f..ead9b9d 100644
--- a/programs/Xserver/hw/nxagent/X/NXextension.c.NX.original
+++ b/programs/Xserver/hw/nxagent/X/NXextension.c.NX.original
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXglxext.c b/programs/Xserver/hw/nxagent/X/NXglxext.c
index 172252b..51c5479 100644
--- a/programs/Xserver/hw/nxagent/X/NXglxext.c
+++ b/programs/Xserver/hw/nxagent/X/NXglxext.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXglxext.c.NX.original b/programs/Xserver/hw/nxagent/X/NXglxext.c.NX.original
index 172252b..51c5479 100644
--- a/programs/Xserver/hw/nxagent/X/NXglxext.c.NX.original
+++ b/programs/Xserver/hw/nxagent/X/NXglxext.c.NX.original
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXglyph.c b/programs/Xserver/hw/nxagent/X/NXglyph.c
index 6340de5..cd65fdc 100644
--- a/programs/Xserver/hw/nxagent/X/NXglyph.c
+++ b/programs/Xserver/hw/nxagent/X/NXglyph.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXglyph.c.NX.original b/programs/Xserver/hw/nxagent/X/NXglyph.c.NX.original
index 6340de5..cd65fdc 100644
--- a/programs/Xserver/hw/nxagent/X/NXglyph.c.NX.original
+++ b/programs/Xserver/hw/nxagent/X/NXglyph.c.NX.original
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXglyphcurs.c b/programs/Xserver/hw/nxagent/X/NXglyphcurs.c
index d6cd966..7a1d813 100644
--- a/programs/Xserver/hw/nxagent/X/NXglyphcurs.c
+++ b/programs/Xserver/hw/nxagent/X/NXglyphcurs.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXglyphcurs.c.NX.original b/programs/Xserver/hw/nxagent/X/NXglyphcurs.c.NX.original
index d6cd966..7a1d813 100644
--- a/programs/Xserver/hw/nxagent/X/NXglyphcurs.c.NX.original
+++ b/programs/Xserver/hw/nxagent/X/NXglyphcurs.c.NX.original
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXglyphstr.h b/programs/Xserver/hw/nxagent/X/NXglyphstr.h
index e78a1bf..fa6b5fb 100644
--- a/programs/Xserver/hw/nxagent/X/NXglyphstr.h
+++ b/programs/Xserver/hw/nxagent/X/NXglyphstr.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXglyphstr.h.NX.original b/programs/Xserver/hw/nxagent/X/NXglyphstr.h.NX.original
index e78a1bf..fa6b5fb 100644
--- a/programs/Xserver/hw/nxagent/X/NXglyphstr.h.NX.original
+++ b/programs/Xserver/hw/nxagent/X/NXglyphstr.h.NX.original
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXmiexpose.c b/programs/Xserver/hw/nxagent/X/NXmiexpose.c
index c71ea81..3fc73cf 100644
--- a/programs/Xserver/hw/nxagent/X/NXmiexpose.c
+++ b/programs/Xserver/hw/nxagent/X/NXmiexpose.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXmiexpose.c.NX.original b/programs/Xserver/hw/nxagent/X/NXmiexpose.c.NX.original
index c71ea81..3fc73cf 100644
--- a/programs/Xserver/hw/nxagent/X/NXmiexpose.c.NX.original
+++ b/programs/Xserver/hw/nxagent/X/NXmiexpose.c.NX.original
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXmiglyph.c b/programs/Xserver/hw/nxagent/X/NXmiglyph.c
index efb2958..5f32334 100644
--- a/programs/Xserver/hw/nxagent/X/NXmiglyph.c
+++ b/programs/Xserver/hw/nxagent/X/NXmiglyph.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXmiglyph.c.NX.original b/programs/Xserver/hw/nxagent/X/NXmiglyph.c.NX.original
index efb2958..5f32334 100644
--- a/programs/Xserver/hw/nxagent/X/NXmiglyph.c.NX.original
+++ b/programs/Xserver/hw/nxagent/X/NXmiglyph.c.NX.original
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXmitrap.c b/programs/Xserver/hw/nxagent/X/NXmitrap.c
index d2bead0..f418654 100644
--- a/programs/Xserver/hw/nxagent/X/NXmitrap.c
+++ b/programs/Xserver/hw/nxagent/X/NXmitrap.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXmitrap.c.NX.original b/programs/Xserver/hw/nxagent/X/NXmitrap.c.NX.original
index d2bead0..f418654 100644
--- a/programs/Xserver/hw/nxagent/X/NXmitrap.c.NX.original
+++ b/programs/Xserver/hw/nxagent/X/NXmitrap.c.NX.original
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXmiwindow.c b/programs/Xserver/hw/nxagent/X/NXmiwindow.c
index be1096c..1902949 100644
--- a/programs/Xserver/hw/nxagent/X/NXmiwindow.c
+++ b/programs/Xserver/hw/nxagent/X/NXmiwindow.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXmiwindow.c.NX.original b/programs/Xserver/hw/nxagent/X/NXmiwindow.c.NX.original
index be1096c..1902949 100644
--- a/programs/Xserver/hw/nxagent/X/NXmiwindow.c.NX.original
+++ b/programs/Xserver/hw/nxagent/X/NXmiwindow.c.NX.original
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXpicture.c b/programs/Xserver/hw/nxagent/X/NXpicture.c
index 18697a5..d9054b4 100644
--- a/programs/Xserver/hw/nxagent/X/NXpicture.c
+++ b/programs/Xserver/hw/nxagent/X/NXpicture.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
@@ -62,6 +62,7 @@
 #include &quot;Screen.h&quot;
 #include &quot;Pixmaps.h&quot;
 #include &quot;Drawable.h&quot;
+#include &quot;Render.h&quot;
 
 #define PANIC
 #define WARNING
@@ -872,6 +873,9 @@ AllocatePicture (ScreenPtr  pScreen)
 	else
 	    ppriv-&gt;ptr = (pointer)NULL;
     }
+
+    nxagentPicturePriv(pPicture) -&gt; picture = 0;
+
     return pPicture;
 }
 
@@ -1063,7 +1067,49 @@ static void initGradient(SourcePictPtr pGradient, int stopCount,
 static PicturePtr createSourcePicture(void)
 {
     PicturePtr pPicture;
-    pPicture = (PicturePtr) xalloc(sizeof(PictureRec));
+
+    extern int nxagentPicturePrivateIndex;
+
+    unsigned int totalPictureSize;
+
+    DevUnion *ppriv;
+
+    char *privPictureRecAddr;
+
+    int i;
+
+    /*
+     * Compute size of entire PictureRect, plus privates.
+     */
+
+    totalPictureSize = sizeof(PictureRec) +
+                           picturePrivateCount * sizeof(DevUnion) +
+                               sizeof(nxagentPrivPictureRec);
+
+    pPicture = (PicturePtr) xalloc(totalPictureSize);
+
+    if (pPicture != NULL)
+    {
+      ppriv = (DevUnion *) (pPicture + 1);
+
+      for (i = 0; i &lt; picturePrivateCount; ++i)
+      {
+        /*
+         * Other privates are inaccessible.
+         */
+
+        ppriv[i].ptr = NULL;
+      }
+
+      privPictureRecAddr = (char *) &amp;ppriv[picturePrivateCount];
+
+      ppriv[nxagentPicturePrivateIndex].ptr = (pointer) privPictureRecAddr;
+
+      pPicture -&gt; devPrivates = ppriv;
+
+      nxagentPicturePriv(pPicture) -&gt; picture = 0;
+    }
+
     pPicture-&gt;pDrawable = 0;
     pPicture-&gt;pFormat = 0;
     pPicture-&gt;pNext = 0;
@@ -1697,6 +1743,10 @@ FreePicture (pointer	value,
 
     if (--pPicture-&gt;refcnt == 0)
     {
+#ifdef NXAGENT_SERVER
+        nxagentDestroyPicture(pPicture);
+#endif
+
 	if (pPicture-&gt;transform)
 	    xfree (pPicture-&gt;transform);
         if (!pPicture-&gt;pDrawable) {
diff --git a/programs/Xserver/hw/nxagent/X/NXpicture.c.NX.original b/programs/Xserver/hw/nxagent/X/NXpicture.c.NX.original
index 18697a5..d9054b4 100644
--- a/programs/Xserver/hw/nxagent/X/NXpicture.c.NX.original
+++ b/programs/Xserver/hw/nxagent/X/NXpicture.c.NX.original
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
@@ -62,6 +62,7 @@
 #include &quot;Screen.h&quot;
 #include &quot;Pixmaps.h&quot;
 #include &quot;Drawable.h&quot;
+#include &quot;Render.h&quot;
 
 #define PANIC
 #define WARNING
@@ -872,6 +873,9 @@ AllocatePicture (ScreenPtr  pScreen)
 	else
 	    ppriv-&gt;ptr = (pointer)NULL;
     }
+
+    nxagentPicturePriv(pPicture) -&gt; picture = 0;
+
     return pPicture;
 }
 
@@ -1063,7 +1067,49 @@ static void initGradient(SourcePictPtr pGradient, int stopCount,
 static PicturePtr createSourcePicture(void)
 {
     PicturePtr pPicture;
-    pPicture = (PicturePtr) xalloc(sizeof(PictureRec));
+
+    extern int nxagentPicturePrivateIndex;
+
+    unsigned int totalPictureSize;
+
+    DevUnion *ppriv;
+
+    char *privPictureRecAddr;
+
+    int i;
+
+    /*
+     * Compute size of entire PictureRect, plus privates.
+     */
+
+    totalPictureSize = sizeof(PictureRec) +
+                           picturePrivateCount * sizeof(DevUnion) +
+                               sizeof(nxagentPrivPictureRec);
+
+    pPicture = (PicturePtr) xalloc(totalPictureSize);
+
+    if (pPicture != NULL)
+    {
+      ppriv = (DevUnion *) (pPicture + 1);
+
+      for (i = 0; i &lt; picturePrivateCount; ++i)
+      {
+        /*
+         * Other privates are inaccessible.
+         */
+
+        ppriv[i].ptr = NULL;
+      }
+
+      privPictureRecAddr = (char *) &amp;ppriv[picturePrivateCount];
+
+      ppriv[nxagentPicturePrivateIndex].ptr = (pointer) privPictureRecAddr;
+
+      pPicture -&gt; devPrivates = ppriv;
+
+      nxagentPicturePriv(pPicture) -&gt; picture = 0;
+    }
+
     pPicture-&gt;pDrawable = 0;
     pPicture-&gt;pFormat = 0;
     pPicture-&gt;pNext = 0;
@@ -1697,6 +1743,10 @@ FreePicture (pointer	value,
 
     if (--pPicture-&gt;refcnt == 0)
     {
+#ifdef NXAGENT_SERVER
+        nxagentDestroyPicture(pPicture);
+#endif
+
 	if (pPicture-&gt;transform)
 	    xfree (pPicture-&gt;transform);
         if (!pPicture-&gt;pDrawable) {
diff --git a/programs/Xserver/hw/nxagent/X/NXpicturestr.h b/programs/Xserver/hw/nxagent/X/NXpicturestr.h
index b6cee91..0d1a8e1 100644
--- a/programs/Xserver/hw/nxagent/X/NXpicturestr.h
+++ b/programs/Xserver/hw/nxagent/X/NXpicturestr.h
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXpicturestr.h.NX.original b/programs/Xserver/hw/nxagent/X/NXpicturestr.h.NX.original
index b6cee91..0d1a8e1 100644
--- a/programs/Xserver/hw/nxagent/X/NXpicturestr.h.NX.original
+++ b/programs/Xserver/hw/nxagent/X/NXpicturestr.h.NX.original
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXproperty.c b/programs/Xserver/hw/nxagent/X/NXproperty.c
index d02f3f0..cd1ec6d 100644
--- a/programs/Xserver/hw/nxagent/X/NXproperty.c
+++ b/programs/Xserver/hw/nxagent/X/NXproperty.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXproperty.c.NX.original b/programs/Xserver/hw/nxagent/X/NXproperty.c.NX.original
index d02f3f0..cd1ec6d 100644
--- a/programs/Xserver/hw/nxagent/X/NXproperty.c.NX.original
+++ b/programs/Xserver/hw/nxagent/X/NXproperty.c.NX.original
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXrandr.c b/programs/Xserver/hw/nxagent/X/NXrandr.c
index e1bb441..5f460f2 100644
--- a/programs/Xserver/hw/nxagent/X/NXrandr.c
+++ b/programs/Xserver/hw/nxagent/X/NXrandr.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXrandr.c.NX.original b/programs/Xserver/hw/nxagent/X/NXrandr.c.NX.original
index e1bb441..5f460f2 100644
--- a/programs/Xserver/hw/nxagent/X/NXrandr.c.NX.original
+++ b/programs/Xserver/hw/nxagent/X/NXrandr.c.NX.original
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXrender.c b/programs/Xserver/hw/nxagent/X/NXrender.c
index ffc1997..89e7901 100644
--- a/programs/Xserver/hw/nxagent/X/NXrender.c
+++ b/programs/Xserver/hw/nxagent/X/NXrender.c
@@ -26,7 +26,7 @@
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
@@ -116,7 +116,6 @@ int  nxagentCursorSaveRenderInfo(ScreenPtr, CursorPtr);
 void nxagentCursorPostSaveRenderInfo(CursorPtr, ScreenPtr, PicturePtr, int, int);
 int  nxagentRenderRealizeCursor(ScreenPtr, CursorPtr);
 int  nxagentCreatePicture(PicturePtr, Mask);
-void nxagentDestroyPicture(PicturePtr pPicture);
 void nxagentChangePicture(PicturePtr, Mask);
 int  nxagentChangePictureClip(PicturePtr, int, int, xRectangle *, int, int);
 void nxagentComposite(CARD8, PicturePtr, PicturePtr, PicturePtr, INT16, INT16,
@@ -132,6 +131,28 @@ void nxagentSetPictureFilter(PicturePtr pPicture, char *filter, int name_size,
 void nxagentTrapezoids(CARD8 op, PicturePtr pSrc, PicturePtr pDst, PictFormatPtr maskFormat,
                            INT16 xSrc, INT16 ySrc, int ntrap, xTrapezoid *traps);
 
+void nxagentRenderCreateSolidFill(PicturePtr pPicture, xRenderColor *color);
+
+void nxagentRenderCreateLinearGradient(PicturePtr pPicture, xPointFixed *p1,
+                                           xPointFixed *p2, int nStops,
+                                               xFixed *stops,
+                                                   xRenderColor *colors);
+
+void nxagentRenderCreateRadialGradient(PicturePtr pPicture, xPointFixed *inner,
+                                           xPointFixed *outer,
+                                               xFixed innerRadius,
+                                                   xFixed outerRadius,
+                                                       int nStops,
+                                                           xFixed *stops,
+                                                               xRenderColor *colors);
+
+void nxagentRenderCreateConicalGradient(PicturePtr pPicture,
+                                            xPointFixed *center,
+                                                xFixed angle, int nStops, 
+                                                    xFixed *stops, 
+                                                        xRenderColor *colors);
+
+
 /*
  * The void pointer is actually a XGlyphElt8.
  */
@@ -823,8 +844,6 @@ ProcRenderFreePicture (ClientPtr client)
     VERIFY_PICTURE (pPicture, stuff-&gt;picture, client, SecurityDestroyAccess,
 		    RenderErrBase + BadPicture);
 
-    nxagentDestroyPicture(pPicture);
-
     FreeResource (stuff-&gt;picture, RT_NONE);
     return(client-&gt;noClientException);
 }
@@ -926,9 +945,16 @@ ProcRenderComposite (ClientPtr client)
 		    RenderErrBase + BadPicture);
     VERIFY_ALPHA (pMask, stuff-&gt;mask, client, SecurityReadAccess, 
 		  RenderErrBase + BadPicture);
+/*
+FIXME: Imported change from newest version of Xorg. Changed pSrc to pDst.
+
     if ((pSrc-&gt;pDrawable &amp;&amp; pSrc-&gt;pDrawable-&gt;pScreen != pDst-&gt;pDrawable-&gt;pScreen) ||
 	(pMask &amp;&amp; pMask-&gt;pDrawable &amp;&amp; pSrc-&gt;pDrawable-&gt;pScreen != pMask-&gt;pDrawable-&gt;pScreen))
 	return BadMatch;
+*/
+    if ((pSrc-&gt;pDrawable &amp;&amp; pSrc-&gt;pDrawable-&gt;pScreen != pDst-&gt;pDrawable-&gt;pScreen) ||
+	(pMask &amp;&amp; pMask-&gt;pDrawable &amp;&amp; pDst-&gt;pDrawable-&gt;pScreen != pMask-&gt;pDrawable-&gt;pScreen))
+	return BadMatch;
 
     ValidatePicture (pSrc);
     if (pMask)
@@ -2336,6 +2362,11 @@ static int ProcRenderCreateSolidFill(ClientPtr client)
     pPicture = CreateSolidPicture(stuff-&gt;pid, &amp;stuff-&gt;color, &amp;error);
     if (!pPicture)
 	return error;
+    /* AGENT SERVER */
+
+    nxagentRenderCreateSolidFill(pPicture, &amp;stuff -&gt; color);
+
+    /* AGENT SERVER */
     if (!AddResource (stuff-&gt;pid, PictureType, (pointer)pPicture))
 	return BadAlloc;
     return Success;
@@ -2367,6 +2398,12 @@ static int ProcRenderCreateLinearGradient (ClientPtr client)
                                             stuff-&gt;nStops, stops, colors, &amp;error);
     if (!pPicture)
 	return error;
+    /* AGENT SERVER */
+
+    nxagentRenderCreateLinearGradient(pPicture, &amp;stuff-&gt;p1, &amp;stuff-&gt;p2,
+                                          stuff-&gt;nStops, stops, colors);
+
+    /* AGENT SERVER */
     if (!AddResource (stuff-&gt;pid, PictureType, (pointer)pPicture))
 	return BadAlloc;
     return Success;
@@ -2397,6 +2434,14 @@ static int ProcRenderCreateRadialGradient (ClientPtr client)
                                             stuff-&gt;nStops, stops, colors, &amp;error);
     if (!pPicture)
 	return error;
+    /* AGENT SERVER */
+
+    nxagentRenderCreateRadialGradient(pPicture, &amp;stuff-&gt;inner, &amp;stuff-&gt;outer,
+                                          stuff-&gt;inner_radius,
+                                              stuff-&gt;outer_radius, 
+                                                  stuff-&gt;nStops, stops, colors);
+
+    /* AGENT SERVER */
     if (!AddResource (stuff-&gt;pid, PictureType, (pointer)pPicture))
 	return BadAlloc;
     return Success;
@@ -2426,6 +2471,13 @@ static int ProcRenderCreateConicalGradient (ClientPtr client)
                                              stuff-&gt;nStops, stops, colors, &amp;error);
     if (!pPicture)
 	return error;
+    /* AGENT SERVER */
+
+    nxagentRenderCreateConicalGradient(pPicture, &amp;stuff-&gt;center,
+                                           stuff-&gt;angle, stuff-&gt;nStops, stops,
+                                               colors);
+
+    /* AGENT SERVER */
     if (!AddResource (stuff-&gt;pid, PictureType, (pointer)pPicture))
 	return BadAlloc;
     return Success;
diff --git a/programs/Xserver/hw/nxagent/X/NXrender.c.NX.original b/programs/Xserver/hw/nxagent/X/NXrender.c.NX.original
index ffc1997..89e7901 100644
--- a/programs/Xserver/hw/nxagent/X/NXrender.c.NX.original
+++ b/programs/Xserver/hw/nxagent/X/NXrender.c.NX.original
@@ -26,7 +26,7 @@
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
@@ -116,7 +116,6 @@ int  nxagentCursorSaveRenderInfo(ScreenPtr, CursorPtr);
 void nxagentCursorPostSaveRenderInfo(CursorPtr, ScreenPtr, PicturePtr, int, int);
 int  nxagentRenderRealizeCursor(ScreenPtr, CursorPtr);
 int  nxagentCreatePicture(PicturePtr, Mask);
-void nxagentDestroyPicture(PicturePtr pPicture);
 void nxagentChangePicture(PicturePtr, Mask);
 int  nxagentChangePictureClip(PicturePtr, int, int, xRectangle *, int, int);
 void nxagentComposite(CARD8, PicturePtr, PicturePtr, PicturePtr, INT16, INT16,
@@ -132,6 +131,28 @@ void nxagentSetPictureFilter(PicturePtr pPicture, char *filter, int name_size,
 void nxagentTrapezoids(CARD8 op, PicturePtr pSrc, PicturePtr pDst, PictFormatPtr maskFormat,
                            INT16 xSrc, INT16 ySrc, int ntrap, xTrapezoid *traps);
 
+void nxagentRenderCreateSolidFill(PicturePtr pPicture, xRenderColor *color);
+
+void nxagentRenderCreateLinearGradient(PicturePtr pPicture, xPointFixed *p1,
+                                           xPointFixed *p2, int nStops,
+                                               xFixed *stops,
+                                                   xRenderColor *colors);
+
+void nxagentRenderCreateRadialGradient(PicturePtr pPicture, xPointFixed *inner,
+                                           xPointFixed *outer,
+                                               xFixed innerRadius,
+                                                   xFixed outerRadius,
+                                                       int nStops,
+                                                           xFixed *stops,
+                                                               xRenderColor *colors);
+
+void nxagentRenderCreateConicalGradient(PicturePtr pPicture,
+                                            xPointFixed *center,
+                                                xFixed angle, int nStops, 
+                                                    xFixed *stops, 
+                                                        xRenderColor *colors);
+
+
 /*
  * The void pointer is actually a XGlyphElt8.
  */
@@ -823,8 +844,6 @@ ProcRenderFreePicture (ClientPtr client)
     VERIFY_PICTURE (pPicture, stuff-&gt;picture, client, SecurityDestroyAccess,
 		    RenderErrBase + BadPicture);
 
-    nxagentDestroyPicture(pPicture);
-
     FreeResource (stuff-&gt;picture, RT_NONE);
     return(client-&gt;noClientException);
 }
@@ -926,9 +945,16 @@ ProcRenderComposite (ClientPtr client)
 		    RenderErrBase + BadPicture);
     VERIFY_ALPHA (pMask, stuff-&gt;mask, client, SecurityReadAccess, 
 		  RenderErrBase + BadPicture);
+/*
+FIXME: Imported change from newest version of Xorg. Changed pSrc to pDst.
+
     if ((pSrc-&gt;pDrawable &amp;&amp; pSrc-&gt;pDrawable-&gt;pScreen != pDst-&gt;pDrawable-&gt;pScreen) ||
 	(pMask &amp;&amp; pMask-&gt;pDrawable &amp;&amp; pSrc-&gt;pDrawable-&gt;pScreen != pMask-&gt;pDrawable-&gt;pScreen))
 	return BadMatch;
+*/
+    if ((pSrc-&gt;pDrawable &amp;&amp; pSrc-&gt;pDrawable-&gt;pScreen != pDst-&gt;pDrawable-&gt;pScreen) ||
+	(pMask &amp;&amp; pMask-&gt;pDrawable &amp;&amp; pDst-&gt;pDrawable-&gt;pScreen != pMask-&gt;pDrawable-&gt;pScreen))
+	return BadMatch;
 
     ValidatePicture (pSrc);
     if (pMask)
@@ -2336,6 +2362,11 @@ static int ProcRenderCreateSolidFill(ClientPtr client)
     pPicture = CreateSolidPicture(stuff-&gt;pid, &amp;stuff-&gt;color, &amp;error);
     if (!pPicture)
 	return error;
+    /* AGENT SERVER */
+
+    nxagentRenderCreateSolidFill(pPicture, &amp;stuff -&gt; color);
+
+    /* AGENT SERVER */
     if (!AddResource (stuff-&gt;pid, PictureType, (pointer)pPicture))
 	return BadAlloc;
     return Success;
@@ -2367,6 +2398,12 @@ static int ProcRenderCreateLinearGradient (ClientPtr client)
                                             stuff-&gt;nStops, stops, colors, &amp;error);
     if (!pPicture)
 	return error;
+    /* AGENT SERVER */
+
+    nxagentRenderCreateLinearGradient(pPicture, &amp;stuff-&gt;p1, &amp;stuff-&gt;p2,
+                                          stuff-&gt;nStops, stops, colors);
+
+    /* AGENT SERVER */
     if (!AddResource (stuff-&gt;pid, PictureType, (pointer)pPicture))
 	return BadAlloc;
     return Success;
@@ -2397,6 +2434,14 @@ static int ProcRenderCreateRadialGradient (ClientPtr client)
                                             stuff-&gt;nStops, stops, colors, &amp;error);
     if (!pPicture)
 	return error;
+    /* AGENT SERVER */
+
+    nxagentRenderCreateRadialGradient(pPicture, &amp;stuff-&gt;inner, &amp;stuff-&gt;outer,
+                                          stuff-&gt;inner_radius,
+                                              stuff-&gt;outer_radius, 
+                                                  stuff-&gt;nStops, stops, colors);
+
+    /* AGENT SERVER */
     if (!AddResource (stuff-&gt;pid, PictureType, (pointer)pPicture))
 	return BadAlloc;
     return Success;
@@ -2426,6 +2471,13 @@ static int ProcRenderCreateConicalGradient (ClientPtr client)
                                              stuff-&gt;nStops, stops, colors, &amp;error);
     if (!pPicture)
 	return error;
+    /* AGENT SERVER */
+
+    nxagentRenderCreateConicalGradient(pPicture, &amp;stuff-&gt;center,
+                                           stuff-&gt;angle, stuff-&gt;nStops, stops,
+                                               colors);
+
+    /* AGENT SERVER */
     if (!AddResource (stuff-&gt;pid, PictureType, (pointer)pPicture))
 	return BadAlloc;
     return Success;
diff --git a/programs/Xserver/hw/nxagent/X/NXresource.c b/programs/Xserver/hw/nxagent/X/NXresource.c
index 8c69217..d1c8325 100644
--- a/programs/Xserver/hw/nxagent/X/NXresource.c
+++ b/programs/Xserver/hw/nxagent/X/NXresource.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXresource.c.NX.original b/programs/Xserver/hw/nxagent/X/NXresource.c.NX.original
index 8c69217..d1c8325 100644
--- a/programs/Xserver/hw/nxagent/X/NXresource.c.NX.original
+++ b/programs/Xserver/hw/nxagent/X/NXresource.c.NX.original
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXshm.c b/programs/Xserver/hw/nxagent/X/NXshm.c
index b99cbe3..eaaa920 100644
--- a/programs/Xserver/hw/nxagent/X/NXshm.c
+++ b/programs/Xserver/hw/nxagent/X/NXshm.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXshm.c.NX.original b/programs/Xserver/hw/nxagent/X/NXshm.c.NX.original
index b99cbe3..eaaa920 100644
--- a/programs/Xserver/hw/nxagent/X/NXshm.c.NX.original
+++ b/programs/Xserver/hw/nxagent/X/NXshm.c.NX.original
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXwindow.c b/programs/Xserver/hw/nxagent/X/NXwindow.c
index 4022bc3..76e86fd 100644
--- a/programs/Xserver/hw/nxagent/X/NXwindow.c
+++ b/programs/Xserver/hw/nxagent/X/NXwindow.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXwindow.c.NX.original b/programs/Xserver/hw/nxagent/X/NXwindow.c.NX.original
index 4022bc3..76e86fd 100644
--- a/programs/Xserver/hw/nxagent/X/NXwindow.c.NX.original
+++ b/programs/Xserver/hw/nxagent/X/NXwindow.c.NX.original
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXxvdisp.c b/programs/Xserver/hw/nxagent/X/NXxvdisp.c
index aa90222..f6dad31 100644
--- a/programs/Xserver/hw/nxagent/X/NXxvdisp.c
+++ b/programs/Xserver/hw/nxagent/X/NXxvdisp.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/X/NXxvdisp.c.NX.original b/programs/Xserver/hw/nxagent/X/NXxvdisp.c.NX.original
index aa90222..f6dad31 100644
--- a/programs/Xserver/hw/nxagent/X/NXxvdisp.c.NX.original
+++ b/programs/Xserver/hw/nxagent/X/NXxvdisp.c.NX.original
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/nxagent.xpm b/programs/Xserver/hw/nxagent/nxagent.xpm
index 5955f17..dd8be6c 100644
--- a/programs/Xserver/hw/nxagent/nxagent.xpm
+++ b/programs/Xserver/hw/nxagent/nxagent.xpm
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/nxmissing.xpm b/programs/Xserver/hw/nxagent/nxmissing.xpm
index e7dee27..854e0a6 100644
--- a/programs/Xserver/hw/nxagent/nxmissing.xpm
+++ b/programs/Xserver/hw/nxagent/nxmissing.xpm
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/os2Stub.c b/programs/Xserver/hw/nxagent/os2Stub.c
index 80419d8..9ec7e6b 100644
--- a/programs/Xserver/hw/nxagent/os2Stub.c
+++ b/programs/Xserver/hw/nxagent/os2Stub.c
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/hw/nxagent/screensaver b/programs/Xserver/hw/nxagent/screensaver
index 4c5c106..ef7cd66 100644
--- a/programs/Xserver/hw/nxagent/screensaver
+++ b/programs/Xserver/hw/nxagent/screensaver
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAGENT, NX protocol compression and NX extensions to this software    */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/mi/Imakefile b/programs/Xserver/mi/Imakefile
index 322ad09..b85a9f9 100644
--- a/programs/Xserver/mi/Imakefile
+++ b/programs/Xserver/mi/Imakefile
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/mi/Imakefile.NX.original b/programs/Xserver/mi/Imakefile.NX.original
index 322ad09..b85a9f9 100644
--- a/programs/Xserver/mi/Imakefile.NX.original
+++ b/programs/Xserver/mi/Imakefile.NX.original
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/os/Imakefile b/programs/Xserver/os/Imakefile
index 3acf663..22be060 100644
--- a/programs/Xserver/os/Imakefile
+++ b/programs/Xserver/os/Imakefile
@@ -7,7 +7,7 @@ XCOMM $XFree86: xc/programs/Xserver/os/Imakefile,v 3.40 2003/09/09 03:20:41 dawe
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/os/Imakefile.NX.original b/programs/Xserver/os/Imakefile.NX.original
index 3acf663..22be060 100644
--- a/programs/Xserver/os/Imakefile.NX.original
+++ b/programs/Xserver/os/Imakefile.NX.original
@@ -7,7 +7,7 @@ XCOMM $XFree86: xc/programs/Xserver/os/Imakefile,v 3.40 2003/09/09 03:20:41 dawe
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/os/WaitFor.c b/programs/Xserver/os/WaitFor.c
index 31b8f12..2ef4742 100644
--- a/programs/Xserver/os/WaitFor.c
+++ b/programs/Xserver/os/WaitFor.c
@@ -50,7 +50,7 @@ SOFTWARE.
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/os/WaitFor.c.NX.original b/programs/Xserver/os/WaitFor.c.NX.original
index 31b8f12..2ef4742 100644
--- a/programs/Xserver/os/WaitFor.c.NX.original
+++ b/programs/Xserver/os/WaitFor.c.NX.original
@@ -50,7 +50,7 @@ SOFTWARE.
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/os/auth.c b/programs/Xserver/os/auth.c
index 711f40b..dfb6f88 100644
--- a/programs/Xserver/os/auth.c
+++ b/programs/Xserver/os/auth.c
@@ -30,7 +30,7 @@ from The Open Group.
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/os/auth.c.NX.original b/programs/Xserver/os/auth.c.NX.original
index 711f40b..dfb6f88 100644
--- a/programs/Xserver/os/auth.c.NX.original
+++ b/programs/Xserver/os/auth.c.NX.original
@@ -30,7 +30,7 @@ from The Open Group.
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/os/log.c b/programs/Xserver/os/log.c
index d3aef03..04e24b8 100644
--- a/programs/Xserver/os/log.c
+++ b/programs/Xserver/os/log.c
@@ -80,7 +80,7 @@ OR PERFORMANCE OF THIS SOFTWARE.
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/os/log.c.NX.original b/programs/Xserver/os/log.c.NX.original
index d3aef03..04e24b8 100644
--- a/programs/Xserver/os/log.c.NX.original
+++ b/programs/Xserver/os/log.c.NX.original
@@ -80,7 +80,7 @@ OR PERFORMANCE OF THIS SOFTWARE.
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/os/utils.c b/programs/Xserver/os/utils.c
index 5821dd6..7e62654 100644
--- a/programs/Xserver/os/utils.c
+++ b/programs/Xserver/os/utils.c
@@ -54,7 +54,7 @@ OR PERFORMANCE OF THIS SOFTWARE.
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/Xserver/os/utils.c.NX.original b/programs/Xserver/os/utils.c.NX.original
index 5821dd6..7e62654 100644
--- a/programs/Xserver/os/utils.c.NX.original
+++ b/programs/Xserver/os/utils.c.NX.original
@@ -54,7 +54,7 @@ OR PERFORMANCE OF THIS SOFTWARE.
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/nxauth/CHANGELOG b/programs/nxauth/CHANGELOG
index 1134b40..1efd1cf 100644
--- a/programs/nxauth/CHANGELOG
+++ b/programs/nxauth/CHANGELOG
@@ -1,8 +1,14 @@
 ChangeLog:
 
-nxauth-3.4.0.5
+x2goauth-3.5.0.2
 
-- Changed version numbering scheme, upstream now maintained by X2go project.
+- forked nxauth-3.5.0-1
+
+nxauth-3.5.0-1
+
+- Opened the 3.5.0 branch based on nxauth-3.4.0-3.
+
+- Updated copyright to year 2011.
 
 nxauth-3.4.0-3
 
diff --git a/programs/nxauth/Imakefile b/programs/nxauth/Imakefile
index 07b1ca7..00bfa92 100644
--- a/programs/nxauth/Imakefile
+++ b/programs/nxauth/Imakefile
@@ -7,7 +7,7 @@ XCOMM $XFree86: xc/programs/xauth/Imakefile,v 3.5 2001/03/30 02:15:23 keithp Exp
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAUTH, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/nxauth/LICENSE b/programs/nxauth/LICENSE
index 626b9c5..6fe38fe 100644
--- a/programs/nxauth/LICENSE
+++ b/programs/nxauth/LICENSE
@@ -1,4 +1,4 @@
-Copyright (c) 2001, 2010 NoMachine - <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>
+Copyright (c) 2001, 2011 NoMachine - <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>
 
 NXAUTH and NX extensions to X are copyright of NoMachine.
 
diff --git a/programs/nxauth/parsedpy.c b/programs/nxauth/parsedpy.c
index 8ce4681..52cc380 100644
--- a/programs/nxauth/parsedpy.c
+++ b/programs/nxauth/parsedpy.c
@@ -32,7 +32,7 @@ in this Software without prior written authorization from The Open Group.
 /* $XFree86: xc/programs/xauth/parsedpy.c,v 3.6 2001/12/14 20:01:15 dawes Exp $ */
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAUTH, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/nxauth/process.c b/programs/nxauth/process.c
index 57090e2..eaf9354 100644
--- a/programs/nxauth/process.c
+++ b/programs/nxauth/process.c
@@ -30,7 +30,7 @@ from The Open Group.
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAUTH, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/nxauth/xauth.c b/programs/nxauth/xauth.c
index 5a37c34..77130a1 100644
--- a/programs/nxauth/xauth.c
+++ b/programs/nxauth/xauth.c
@@ -32,7 +32,7 @@ in this Software without prior written authorization from The Open Group.
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NXAUTH, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/xterm/Imakefile b/programs/xterm/Imakefile
index 349190d..4620c2c 100644
--- a/programs/xterm/Imakefile
+++ b/programs/xterm/Imakefile
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/xterm/Imakefile.NX.original b/programs/xterm/Imakefile.NX.original
index 349190d..4620c2c 100644
--- a/programs/xterm/Imakefile.NX.original
+++ b/programs/xterm/Imakefile.NX.original
@@ -1,6 +1,6 @@
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/xterm/charproc.c b/programs/xterm/charproc.c
index f8f53d5..78bb9a1 100644
--- a/programs/xterm/charproc.c
+++ b/programs/xterm/charproc.c
@@ -84,7 +84,7 @@ in this Software without prior written authorization from The Open Group.
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/xterm/charproc.c.NX.original b/programs/xterm/charproc.c.NX.original
index f8f53d5..78bb9a1 100644
--- a/programs/xterm/charproc.c.NX.original
+++ b/programs/xterm/charproc.c.NX.original
@@ -84,7 +84,7 @@ in this Software without prior written authorization from The Open Group.
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/xterm/main.c b/programs/xterm/main.c
index b1393d0..36068a4 100644
--- a/programs/xterm/main.c
+++ b/programs/xterm/main.c
@@ -93,7 +93,7 @@ SOFTWARE.
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */
diff --git a/programs/xterm/main.c.NX.original b/programs/xterm/main.c.NX.original
index b1393d0..36068a4 100644
--- a/programs/xterm/main.c.NX.original
+++ b/programs/xterm/main.c.NX.original
@@ -93,7 +93,7 @@ SOFTWARE.
 
 /**************************************************************************/
 /*                                                                        */
-/* Copyright (c) 2001, 2010 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
+/* Copyright (c) 2001, 2011 NoMachine, <A HREF="http://www.nomachine.com/.">http://www.nomachine.com/.</A>         */
 /*                                                                        */
 /* NX-X11, NX protocol compression and NX extensions to this software     */
 /* are copyright of NoMachine. Redistribution and use of the present      */


hooks/post-receive
-- 
x2goagent.git (X2go (NX-like) Agent)

This is an automated email from the git hooks/post-receive script. It was
generated because a ref change was pushed to the repository containing
the project &quot;x2goagent.git&quot; (X2go (NX-like) Agent).


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001365.html">[X2go-Commits] nxcompshad.git - build-main (branch) updated:	3.4.0.4-9-g206dbbc
</A></li>
	<LI>Next message: <A HREF="001367.html">[X2go-Commits] nxcompext.git - master (branch) updated:	3.4.0.2-13-g140cc0c
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1366">[ date ]</a>
              <a href="thread.html#1366">[ thread ]</a>
              <a href="subject.html#1366">[ subject ]</a>
              <a href="author.html#1366">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/x2go-commits">More information about the X2go-commits
mailing list</a><br>
</body></html>
